var svg,g_itemChanged="N",g_enableItemLocHighlight=$v("P27_ENBL_ITEM_LOC_HIGH"),g_locHighlightColor=$v("P27_ITEM_LOC_HIGH_COLOR");async function create_module_from_json(e,t,o,n,i,a,s,l,r,_,g,f="Y",c,d,u,h,I,p,m,b,v,y,S,w,E,D,x,j,O,N,T,M,L,H,A,Y,C,P,B,$,R,G,W,F,V,X,k,z,Q){try{if(logDebug("function : create_module_from_json; POG_JSON_arr : "+e+"new_pog_ind : "+t+"pog_type: "+o,"S"),await create_module_from_json_lib(e,t,o,n,i,l,r,c,d,u,null,!1,_,g,h,I,p,m,b,v,y,S,w,E,D,x,j,O,N,T,"Y",null,1,M,L,H,T,A,Y,A,C,P,"N",F,V,void 0!==g_scene_objects[Q]?g_scene_objects[Q].scene.children[0]:g_scene_objects[g_scene_objects.length-1].scene.children[0],Q,g,$v("P27_POGCR_NOTCH_START_VALUE"),"N","N"),"Y"==l&&("Y"==B||0==g_ItemImages.length&&"Y"==$)?(g_show_item_desc="Y",await showHideItemDescription("Y",A,Y,Q),"Y"==B&&(g_show_live_image="N")):g_show_item_desc="N","Y"==f)await get_all_images(Q,"N","N",X,k,z);if("Y"==l&&g_ItemImages.length>0&&"N"==s&&"Y"==$&&"N"==B&&"Y"==f)try{await recreate_image_items("Y",M,L,H,A,C,Y,T,P,Q,"N","N,0.018",[]),animate_pog(Q)}catch(e){}if("Y"==l){"Y"==R&&(g_show_notch_label="Y",show_notch_labels("Y",P,"Y",Q)),"Y"==G&&(g_show_fixel_label="Y",show_fixel_labels("Y",Q)),"Y"==W&&(g_show_item_label="Y",show_item_labels("Y",A,C,Q));var q=get_min_max_xy(Q).split("###");set_camera_z(g_scene_objects[Q].scene.children[0],parseFloat(q[2]),parseFloat(q[3]),parseFloat(q[0]),parseFloat(q[1]),g_offset_z,parseFloat(q[4]),parseFloat(q[5]),!0,Q),render()}"undefined"!=typeof regionloadWait&&null!==regionloadWait&&"Y"==a&&removeLoadingIndicator(regionloadWait),logDebug("function : create_module_from_json; ","E")}catch(e){error_handling(e)}return"SUCCESS"}async function add_status_bar(e,t,o,n,a,s,l){try{logDebug("function : add_status_bar; ","S");var r=e.split(","),_="";if(g_pog_json.length>0){var[g,f,c,d,u,h,I]=get_pog_info(a,o);if(""!==t){$(t).contents().filter((function(){return 3==this.nodeType})).remove();$(document),$(window),$(t);var p=0,m=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;for(i=0;i<r.length;i++){var b=0,v=i>0?" | ":"";if("POG_CODE"==r[i])if("Y"==s){var y=(I<10?"00":I<100?"0":"")+I,S=(h<10?"0":"")+h,w=(c.length<2?"0":"")+c;_=_+'<span style="color:#001fff">'+get_message("TEMP_HEAD_POG_CODE")+": </span>"+g_pog_json[a].POGCode+f+w+y+S,b=(get_message("TEMP_HEAD_POG_CODE")+": "+g_pog_json[a].POGCode+f+w+y+S).visualLength("ruler"),_=_+' | <span style="color:#001fff">'+get_message("TEMP_HEAD_VERSION")+": </span>"+g_pog_json[a].Version,b=(get_message("TEMP_HEAD_VERSION")+": "+g_pog_json[a].Version).visualLength("ruler")}else _=_+'<span style="color:#001fff">'+get_message("TEMP_HEAD_POG_CODE")+": </span>"+g_pog_json[a].POGCode+"-"+g_pog_json[a].Version,b=(get_message("TEMP_HEAD_POG_CODE")+": "+g_pog_json[a].POGCode+"-"+g_pog_json[a].Version).visualLength("ruler");"MODULE"==r[i]&&(_=_+"("+f+")",b=("("+f+")").visualLength("ruler")),"ITEM"==r[i]&&(_=_+v+'<span style="color:#001fff">'+get_message("ITEM")+": </span>"+o,b=(" | "+get_message("ITEM")+": "+o).visualLength("ruler")),"LOCID"==r[i]&&(_=_+v+'<span style="color:#001fff">'+get_message("LOCATION_ID")+": </span>"+u.LocID,b=("-"+I).visualLength("ruler")),"DESC"==r[i]&&(_=_+"-"+u.Desc,b=("-"+d).visualLength("ruler")),"SHELF"==r[i]&&(_=_+v+'<span style="color:#001fff">'+get_message("TEMP_HEAD_ITEM_SHELF")+": </span>"+c,b=(" | "+c).visualLength("ruler")),"VERT_FACING"==r[i]&&(_=_+v+'<span style="color:#001fff">'+get_message("TEMP_HEAD_VERT_FACING")+": </span>"+u.BVert,b=(" | "+c).visualLength("ruler")),"HORIZ_FACING"==r[i]&&(_=_+v+'<span style="color:#001fff">'+get_message("TEMP_HEAD_HORIZ_FACING")+": </span>"+u.BHoriz,b=(" | "+c).visualLength("ruler")),"DEPTH_FACING"==r[i]&&(_=_+v+'<span style="color:#001fff">'+get_message("TEMP_HEAD_DEPTH_FACING")+": </span>"+u.BaseD,b=(" | "+c).visualLength("ruler"))}"Y"==n&&(_=_+' | <span style="color:#001fff">'+get_message("POGCR_LS_LBL")+": </span>"+g_pog_list[a].SOH,b=("|"+g_pog_list[a].SOH).visualLength("ruler")),(p+=b)>m&&(_+="<br>",p=0);var E=document.getElementById("ruler");E.style.fontSize=l+"px",E.innerHTML=_;var D=E.offsetHeight+7,x=_.visualLength("ruler"),j=document.getElementById("object_info");j.classList.add("active"),$(t).html(_),j.style.top=window.innerHeight-D+"px",j.style.width=x+"px",j.style.height=D+"px",j.style.fontSize=l+"px",j.style.fontFamily="Tahoma",j.style.left="0px"}}return g}catch(e){error_handling(e)}}async function setDefaultState(e,t,o,n,i,a){try{logDebug("function : setDefaultState; pShowLiveImag: "+e,"S"),g_show_item_label=a,g_show_item_desc=t,g_show_live_image="Y"==t?"N":e,g_show_notch_label=o,g_show_fixel_label=n,g_show_avail_qty=i,logDebug("function : setDefaultState; pShowLiveImag: "+e,"E")}catch(e){error_handling(e)}}async function remove_text_box(e,t,o){try{if(logDebug("function : remove_text_box; p_pog_index: "+e,"S"),"N"==t){if(text_list=[],"F"==o[e].DesignType){var n=0;for(const t of o[e].ModuleInfo){var i=0;for(const s of t.ShelfInfo){if("TEXTBOX"==s.ObjType)if(s.Y>=t.H+o[e].BaseH||s.Y+s.H<=0)(a={}).MIndex=n,a.SIndex=i,a.ObjID=s.ObjID,a.Shelf=s.Shelf,text_list.push(a);i++}n++}}else{n=0;for(const t of o[e].ModuleInfo){i=0;for(const e of t.ShelfInfo){var a;if("TEXTBOX"==e.ObjType)if(e.Y-e.H/2>t.Y+t.H/2||e.Y+e.H/2<t.Y-t.H/2)(a={}).MIndex=n,a.SIndex=i,a.ObjID=e.ObjID,a.Shelf=e.Shelf,text_list.push(a);i++}n++}}for(const t of text_list){n=0;for(const a of o[e].ModuleInfo){i=0;for(const s of a.ShelfInfo)"TEXTBOX"==s.ObjType&&t.Shelf==s.Shelf&&o[e].ModuleInfo[n].ShelfInfo.splice(i,1),i++;n++}}}logDebug("function : remove_text_box; p_pog_index: "+e,"E")}catch(e){error_handling(e)}}async function showItemAvailQty(e,t,o,n,i){try{logDebug("function : showItemAvailQty; g_show_item_desc : "+g_show_item_desc,"S");var a=g_pog_json[i].ModuleInfo,s=g_camera.position.z,l=parseInt(t.replace("#","0x"),16);new THREE.Color(l);if("N"==e){var r=0;for(const e of a){if(void 0===e.ParentModule||null==e.ParentModule){var _=e.ShelfInfo,g=(g_pog_json[i].ModuleInfo[r].Carpark,0);for(const e of _){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.ItemInfo.length>0){var f=e.ItemInfo,c=0;for(const e of f){if("DIVIDER"!==e.Item&&e.Item==o){var d=g_scene_objects[i].scene.children[2].getObjectById(e.ObjID);if(void 0!==e.QtyID&&-1!==e.QtyID&&void 0!==d){var u=d.getObjectById(e.QtyID);d.remove(u)}g_pog_json[i].ModuleInfo[r].ShelfInfo[g].ItemInfo[c].QtyID=-1}c+=1}}g+=1}}r+=1}}else{g_camera.position.z=5;r=0;for(const e of a){if(void 0===e.ParentModule||null==e.ParentModule){_=e.ShelfInfo,g_pog_json[i].ModuleInfo[r].Carpark,g=0;for(const e of _){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.ItemInfo.length>0){f=e.ItemInfo,c=0;for(const e of f){if("DIVIDER"!==e.Item&&e.Item==o){d=g_scene_objects[i].scene.children[2].getObjectById(e.ObjID);var h=g_pog_json[i].ModuleInfo[r].ShelfInfo[g].Color;if(null==hexToRgb(h))parseInt("FF",16),parseInt("FF",16),parseInt("FF",16);else hexToRgb(h).r,hexToRgb(h).r,hexToRgb(h).g;"#000000";var I="AQ\n "+n;if(void 0!==e.QtyID&&-1!==e.QtyID){u=d.getObjectById(e.QtyID);d.remove(u)}var p=addAvailQty(I,120,.09,"#000000","center","#ffffff","N,0.07",e.W,e.H);d.add(p),p.position.x=e.W/5,p.position.y=-e.H/3,p.position.z=6e-4,d.WireframeObj.material.color.setHex(0),g_pog_json[i].ModuleInfo[r].ShelfInfo[g].ItemInfo[c].QtyID=p.id}c+=1}}g+=1}}r+=1}g_camera.position.z=s}render(),logDebug("function : showItemAvailQty","E")}catch(e){error_handling(e)}}function addAvailQty(e,t,o,n,i,a,s,l,r){try{logDebug("function : addlabelText; text : "+e+"; textHeight : "+t+"; actualFontSize : "+o+"; font_color : "+n+"; txt_align : "+i+"; back_color : "+a,"S");var _=e.split("\n"),g=10*l,f=10*r,c=document.createElement("canvas"),d=c.getContext("2d");d.fillStyle="#000000";d.measureText(e).width;if("N"==s.split(",")[0])o=s.split(",")[1];else o=s.split(",")[1];if(_.length>1){var u=0;for(obj of _)obj.length>u&&(obj,u=obj.length)}_.length>1&&(o=o/1.5*_.length);var[h,I]=get_visible_size(.012,g,f,g_canvas,g_camera),[p,m]=get_visible_text_dim(e,t);if(c.width=h,c.height=I,d.font=t+"px Arial",d.textAlign=i,d.textBaseline="middle",d.fillStyle=n,_.length>1)for(var b=0+t/2,v=0;v<_.length;v++){var y=0-(l-d.measureText(_[v]).width)/2+2;d.fillText(_[v],y,b),b+=1.11*t}else d.fillText(e,l/2,r/2);let D=new THREE.CanvasTexture(c);D.minFilter=THREE.LinearFilter,D.matrixAutoUpdate=!0,D.needsUpdate=!0,D.isCanvasTexture=!0;var S=new THREE.PlaneGeometry(l,r),w=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:D,transparent:!0});w.map.minFilter=THREE.LinearFilter;var E=new THREE.Mesh(S,w);return E.uuid="addAvailQty",logDebug("function : addlabelText","E"),E}catch(e){error_handling(e)}}async function ShowHideAvailQty(e,t,o,n,i,a,s,l,r,_,g,f,c,d){try{if(logDebug("function : showItemAvailQty p_pog_index:"+d,"S"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0){if(addLoadingIndicator(),g_intersected=[],"Y"==e)"Y"==f?await showHideItemDescription("N",t,o,d):"Y"==g&&await recreate_image_items("N",n,i,a,t,s,o,l,r,d,"N","N,0.018",[]),await showItemAvailQty(e,t,_,g_pog_list[d].SOH,d);else if(await showItemAvailQty("N",t,_,g_pog_list[d].SOH,d),"LIVE"==c)await recreate_image_items("N",n,i,a,t,s,o,l,r,d,"N","N,0.018",[]);else await showHideItemDescription("Y",t,o,d);removeLoadingIndicator(regionloadWait)}logDebug("function : showItemAvailQty p_pog_index:"+d,"E")}catch(e){error_handling(e)}}function get_sqrt(e){return Math.sqrt((e[0].clientX-e[1].clientX)*(e[0].clientX-e[1].clientX)+(e[0].clientY-e[1].clientY)*(e[0].clientY-e[1].clientY))}function SetupTouchCanvas(e,t,o,n){logDebug("function : SetupTouchCanvas","S");var i=0,a=0;if(void 0!==window.ontouchstart){document.getElementById("maincanvas");window.addEventListener("touchstart",(function(t){"touchstart"===t.type&&2===touch.length&&(t.preventDefault(),a=get_sqrt(touch)),e(t,a)})),window.addEventListener("touchmove",(function(e){"touchmove"===e.type&&2===touch.length&&(i=get_sqrt(touch),t(e,i,a))})),window.myParam=n,window.addEventListener("touchend",(function(e){o(e)}))}logDebug("function : SetupTouchCanvas","E")}function handleStart(e,t){try{logDebug("function : handleStart ","S"),touch=e.touches||e.changedTouches,"touchstart"===e.type&&2===touch.length&&(e.preventDefault(),g_lastDistance=get_sqrt(touch)),logDebug("function : handleStart ","E")}catch(e){error_handling(e)}}function handleMove(e){try{logDebug("function : handleMove ","S");var t=e.touches||e.changedTouches;"touchmove"===e.type&&2===t.length&&(g_distance=get_sqrt(t),scaleCanvasTouch(e.currentTarget.myParam)),logDebug("function : handleMove ","E")}catch(e){error_handling(e)}}function handleEnd(e){g_distance=0}async function navigate_button_action(e,t,o,n,i,a,s,l,r,_,g,f,c,d,u,h,I,p,m,b,v,y,S,w,E,D,x,j,O,N,T,M,L,H,A,Y,C,P,B,$,R,G,W,F,V,X){if(logDebug("function : prev_action ","S"),"N"==W&&G<g_pog_json.length-1||"P"==W&&G>0){if("P"==W&&G>0)var k=G-1;else k=G+1;return await recreate_next_pog(k,e,t,o,n,i,a,s,l,r,_,g,f,c,d,u,h,I,p,m,b,v,y,S,w,E,D,x,j,O,N,T,M,L,H,A,Y,C,P,B,$,R,G,F,X,V)}logDebug("function : prev_action ","E")}async function recreate_next_pog(e,t,o,n,i,a,s,l,r,_,g,f,c,d,u,h,I,p,m,b,v,y,S,w,E,D,x,j,O,N,T,M,L,H,A,Y,C,P,B,R,G,W,F,V,X,k,F){try{logDebug("function : recreate_next_pog pNextPog: "+e,"S");var z=JSON.parse(JSON.stringify(g_pog_json)),Q="D"==z[e].DesignType?"Y":"N";F=e,g_offset_z=0,g_intersected=[],init_lib("Y","N","Y",F),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects[e]=objects,await setDefaultState(O,j,N,T,L,M),addLoadingIndicator(),sessionStorage.setItem("org_mod_index",g_pog_json.org_mod_index);await create_module_from_json(z,Q,"F","N","E","Y","N","Y","Y","N",z[0].org_mod_index,$v("P27_IMG_ACTIVE"),t,o,n,i,a,s,l,r,_,g,f,c,d,u,h,I,p,m,b,v,y,S,w,E,D,x,j,O,N,T,M,P,B,R,G,W,F);return"Y"==V&&(await auto_align_peg_items(F,v,y,S,w,D,E,b),await auto_position_all(g_camera,F,F)),$s("P27_CURRENT_POG_CODE",g_pog_json[F].POGCode),await add_status_bar(H,A,C,"N",F,X,k),render_blink_effect(),$(Y).text(e+1+" of "+g_pog_json.length),F=e,"SUCCESS"}catch(e){error_handling(e)}}async function create_pog_first(e,t,o,n,a,s,l,r,_,g,f,c,d,u,h,I,p,m,b,v,y,S,w,E,D,x,j,O,N,T,M,L,H,A,Y,C,P,B,R,G,W,F,V,X,z,Q,q,J,U,Z,K,ee,te,oe){try{logDebug("function : create_pog_first ","S"),addLoadingIndicator(),$("#LIVE_STOCK,#LIVE_IMAGE,#FLOOR_PLAN").addClass("apex_disabled"),oe=0,g_offset_z=0,g_scene_objects=[],g_intersected=[],init_lib("Y","N","Y",oe),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects);var ne=[];g_pog_json=[],g_multi_pog_json=[];var ie=0;if(""!==e){g_pog_list=JSON.parse(e),$(F).text("1 of "+g_pog_list.length),console.log("g_pog_list",g_pog_list);for(const e of g_pog_list){await get_json_data_json(e.PogCode,e.PogVersion,"N",""),ne.push(JSON.parse(JSON.stringify(g_pog_json_data[0]))),console.log("temp_pog",ne);var ae=0,se="D"==ne[ie].DesignType?"Y":"N";if(await setDefaultState(Y,A,C,P,R,B),oe=ie,g_module_obj_array=[],"Y"==e.Exclude){var le=-1,re=-1,_e=-1,ge=ne[ie].ModuleInfo;i=0;for(const e of ge){if(-1!==_e)break;if(null==e.ParentModule||"undefined"==e.ParentModule){var fe=0;for(const t of e.ShelfInfo){if(-1!==_e)break;if(void 0!==t&&null!==t.ItemInfo){k=0;for(const e of t.ItemInfo){if(e.Item==X){le=i,re=fe,_e=k;break}k++}}fe++}}i++}var ce=JSON.parse(JSON.stringify(ne[ie].ModuleInfo[le])),de=JSON.parse(JSON.stringify(ce.ShelfInfo[re])),ue=JSON.parse(JSON.stringify(ce.ShelfInfo[re].ItemInfo[_e]));ne[ie].W=1,ne[ie].H=1,ce.W=1,ce.H=1,de.W=1,de.H=.02,de.X=de.W,de.Y=.5,ue.X=0,ue.Y=.5+de.H,ce.ShelfInfo=[],de.ItemInfo=[],ce.ShelfInfo[0]=de,ce.ShelfInfo[0].ItemInfo=[],ce.ShelfInfo[0].ItemInfo[0]=ue,ne[ie].ModuleInfo=[],ne[ie].ModuleInfo[0]=ce,ne[ie].TotalModWidth=1}else{var he=-1,Ie=[],pe=-1,me=e.PogModule;oe=ie,""!==me&&(ne.length>0&&($.each(ne[ie].ModuleInfo,(function(e,t){null==t.ParentModule&&t.Module==me&&(pe=e,Ie.push(t),he=t.W)})),$.each(ne[ie].ModuleInfo,(function(e,t){null==t.ParentModule&&e<pe&&(ae+=t.W)}))),ne[ie].ModuleInfo=Ie,ne[ie].W=he,ne[ie].TotalModWidth=ae),await remove_text_box(ie,V,ne)}0==ie?($(t).show(),$(o).show(),$(n).show(),$(a).show(),await create_module_from_json(ne,se,"F","N","E","Y","N","Y","Y","Y",pe,g_show_live_image,r,_,g,f,c,d,u,h,I,p,m,b,v,y,S,w,E,D,x,j,O,N,T,M,L,H,A,Y,C,P,B,Q,q,J,U,Z,oe),render(),g_pog_index=ie,g_pog_json[0].org_mod_index=pe,"Y"==K&&(await auto_align_peg_items(oe,j,O,N,T,L,M,x),await auto_position_all(g_camera,oe,oe)),$s("P27_CURRENT_POG_CODE",g_pog_json[oe].POGCode),render_blink_effect(),$(z).addClass("apex_disabled"),$(z).removeClass("apex_disabled")):g_scene_objects.length>0&&await create_module_from_json(ne,se,"F","N","E","N","N","N","Y","Y",pe,g_show_live_image,r,_,g,f,c,d,u,h,I,p,m,b,v,y,S,w,E,D,x,j,O,N,T,M,L,H,A,Y,C,P,B,Q,q,J,U,Z,oe),ie++}g_pog_json=g_multi_pog_json}return $("#prev_btn").css("display","block"),$("#next_btn").css("display","block"),$("#LIVE_STOCK").removeClass("apex_disabled"),$("#LIVE_IMAGE").removeClass("apex_disabled"),$("#FLOOR_PLAN").removeClass("apex_disabled"),logDebug("function : create_pog_first ","E"),oe}catch(e){error_handling(e)}}async function get_pog_search(e,t,o,n,i,a,s,l,r,_,g,f,c,d,u,h,I,p,m,b,v,y,S,w,E,D,x,j,O,N,T,M,L,H,A,Y,C,P,B,R,G,W,F,V,X,k,z,Q,q,J,U,Z,K,ee,te,oe,ne){try{logDebug("function : get_pog_search ","S"),g_auto_x_space=parseFloat($v("P27_POGCR_CHEST_ITEM_H_SPC"))/100,g_auto_y_space=parseFloat($v("P27_POGCR_CHEST_ITEM_V_SPC"))/100;var ie="";apex.server.process("GET_ITEM",{x01:e,x02:t},{dataType:"text",success:function(e){if(""!=$.trim(e)){var t=$.trim(e).split(",");"ERROR"==t[0]?(g_itemChanged="N",removeLoadingIndicator(regionloadWait),raise_error(t[1])):(g_ItemImages=[],g_pog_json=[],ie=$.trim(e),$s(o,`${ie}`),apex.server.process("GET_POG_LIST",{x01:ie,x02:"N",x03:n,x04:i,pageItems:o},{dataType:"text",success:async function(e){if(""!=$.trim(e)){var t=$.trim(e).split(",");if("ERROR"==t[0])g_itemChanged="N",removeLoadingIndicator(regionloadWait),raise_error(t[1]);else{$("#prev_btn").css("display","none"),$("#next_btn").css("display","none"),g_pog_json=[];await create_pog_first($.trim(e),a,s,l,r,_,g,f,c,d,u,h,I,p,m,b,v,y,S,w,E,D,x,j,O,N,T,M,L,H,A,Y,C,P,B,R,G,W,F,V,X,k,z,ie,Q,q,J,U,Z,K,ee,te,oe,ne);try{await add_status_bar(V,X,ie,"N",ne,oe,te)}catch(e){console.warn("add_status_bar failed after create_pog_first",e)}g_itemChanged="N",logDebug("function : get_pog_search ","E")}}else g_itemChanged="N",removeLoadingIndicator(regionloadWait)}}))}}})}catch(e){g_itemChanged="N",error_handling(e)}}function set_store_info(e,t,o,n,i,a,s,l,r,_,g,f,c){$(e).contents().filter((function(){return 3==this.nodeType})).remove();var d="",u=0,h=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;if(d=d+'<span style="color:#001fff">'+get_message("STORE")+":</span> "+t+' | <span style="color:#001fff">'+get_message("LOC_ID")+":</span> "+o.join(","),line_width=(get_message("STORE")+": "+t+get_message("LOC_ID")+": "+o).visualLength("ruler"),"Y"==r){var I=(c<10?"00":c<100?"0":"")+c,p=(l<10?"0":"")+l,m=(i.length<2?"0":"")+i;d=d+' | <span style="color:#001fff">'+get_message("TEMP_HEAD_POG_CODE")+": </span>"+n+a+m+I+p,line_width=(get_message("TEMP_HEAD_POG_CODE")+": "+n+a+m+I+p).visualLength("ruler"),d=d+' | <span style="color:#001fff">'+get_message("TEMP_HEAD_VERSION")+": </span>"+s,line_width=(get_message("TEMP_HEAD_VERSION")+": "+s).visualLength("ruler"),d=d+"("+a+")",line_width=("("+a+")").visualLength("ruler"),d=d+' | <span style="color:#001fff">'+get_message("ITEM")+": </span>"+_,line_width=(" | "+get_message("ITEM")+": "+_).visualLength("ruler"),d=d+"-"+g,line_width=("-"+g).visualLength("ruler")}(u+=line_width)>h&&(d+="<br>",u=0);var b=document.getElementById("ruler");b.style.fontSize=f+"px",b.innerHTML=d;var v=b.offsetHeight+7,y=d.visualLength("ruler"),S=document.getElementById("object_info");S.classList.add("active"),$(e).html(d),S.style.top=window.innerHeight-v+"px",S.style.width=y+"px",S.style.height=v+"px",S.style.fontSize=f+"px",S.style.fontFamily="Tahoma",S.style.left="0px"}function get_pog_info(e,t){var o,n,i,a,s,l,r="N";for(const _ of g_pog_json[e].ModuleInfo){for(const g of _.ShelfInfo){if("BASE"!==g.ObjType&&"NOTCH"!==g.ObjType&&"DIVIDER"!==g.ObjType&&"TEXTBOX"!==g.ObjType){for(const f of g.ItemInfo){if(t==f.Item){selectedObj=g_scene_objects[e].scene.children[2].getObjectById(f.ObjID);highlightProduct(selectedObj,4,f.W,f.H,f.D,f.Z);g_intersected.push(selectedObj),o=_.Module,n=g.Shelf,a=f,i=f.Desc,s=f.BHoriz,l=f.LocID,r="Y"}0}}0}0}return[r,o,n,i,a,s,l]}function getImageClob(e,t,o,n,i,a,s,l){try{logDebug("function : getImageClob ","S");var r=g_pog_list[i].LocationID.split(","),_=g_pog_json[i].POGCode,g=g_pog_json[i].Version;apex.server.process("GET_SVG_CLOB",{x01:n,x02:g_pog_list[i].FPVersion},{dataType:"json",success:function(f){if("success"==f.result){openInlineDialog(o,150,150);var[c,d,u,I,p,m,b]=get_pog_info(i,a);set_store_info(e,n,r,_,u,d,g,m,s,a,I,l,b);var v=$.parseXML(f.response),y=$(v).find("svg");$(t+" svg").remove(),$(t).append(y).ready((function(){activateZoomInOut(t),$("svg title").text(""),Hide_paths(),document.querySelectorAll("path").forEach((e=>{if(null!==e.getAttribute("Location_ID")){h=0;for(const t of r)e.getAttribute("Location_ID").toUpperCase()==r[h]&&(console.log(e.getAttribute("Location_ID")),console.log(r[h]),add_highlight(e.getAttribute("Location_ID"),_,d,s)),h++;r[0].includes(e.getAttribute("Location_ID").toUpperCase())&&e.setAttribute("style","fill: red")}})),$("path").click((function(){var e=$(this).attr("Location_ID"),t=0;for(const o of r)r[t].includes(e)&&add_highlight(path.getAttribute("Location_ID"),_,d,s),t++})),"Y"==g_enableItemLocHighlight&&markItemLocation(),logDebug("function : getImageClob ","E")}))}else raise_error(get_message("SVG_NOT_FOUND",n))},loadingIndicatorPosition:"page"})}catch(e){error_handling(e)}}function markItemLocation(){try{var e=g_pog_list.map((function(e){return e.LocationID.split(",")})).flat();for(locId of e)drawItemLoaction(locId)}catch(e){error_handling(e)}}function drawItemLoaction(e){try{logDebug("function : drawItemLoaction location_id: "+e,"S"),document.querySelectorAll("svg").forEach((t=>{t.querySelectorAll("g").forEach((t=>{var o;t.querySelectorAll("path").forEach((n=>{if(null!==n.getAttribute("Location_ID")&&n.getAttribute("Location_ID")==e.toUpperCase()){var i=n.getBBox();(o=document.createElementNS("http://www.w3.org/2000/svg","rect")).setAttributeNS(null,"id","Hrect_"+e),o.setAttributeNS(null,"x",i.x-4),o.setAttributeNS(null,"y",i.y-4),o.setAttributeNS(null,"width",i.width+8),o.setAttributeNS(null,"height",i.height+8),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"stroke",g_locHighlightColor),o.setAttributeNS(null,"stroke-width",2),t.prepend(o)}}))}))})),logDebug("function : drawItemLoaction location_id: "+e,"E")}catch(e){error_handling(e)}}function activateZoomInOut(e){try{logDebug("function : activateZoomInOut","S");const t=document.querySelector(e),o=t.querySelectorAll("svg"),n=new Map;o.forEach((e=>{const t={x:e.viewBox.baseVal.x,y:e.viewBox.baseVal.y,w:e.viewBox.baseVal.width,h:e.viewBox.baseVal.height};n.set(e,{viewBox:{...t},originalViewBox:t,isPanning:!1,startPoint:{x:0,y:0},scale:1})}));const i=(e,t)=>{e.setAttribute("viewBox",`${t.x} ${t.y} ${t.w} ${t.h}`)};t.addEventListener("wheel",(e=>{const t=e.target.closest("svg");if(!t||!n.has(t))return;e.preventDefault();const o=n.get(t),a=t.clientWidth,s=t.clientHeight,l=o.viewBox,r=o.originalViewBox,_=-Math.sign(e.deltaY),g=.05*l.w*_,f=.05*l.h*_,c=e.offsetX/a*l.w+l.x,d=e.offsetY/s*l.h+l.y,u={x:Math.max(r.x,Math.min(l.x+g*c/l.w,r.x+r.w-l.w-g)),y:Math.max(r.y,Math.min(l.y+f*d/l.h,r.y+r.h-l.h-f)),w:Math.max(10,l.w-g),h:Math.max(10,l.h-f)};o.viewBox=u,o.scale=a/u.w,i(t,u)})),t.addEventListener("mousedown",(e=>{const t=e.target.closest("svg");if(!t||!n.has(t))return;const o=n.get(t);o.isPanning=!0,o.startPoint={x:e.clientX,y:e.clientY}})),t.addEventListener("mousemove",(e=>{const t=e.target.closest("svg");if(!t||!n.has(t))return;const o=n.get(t);if(!o.isPanning)return;const a=(o.startPoint.x-e.clientX)/o.scale,s=(o.startPoint.y-e.clientY)/o.scale,l=o.viewBox,r=o.originalViewBox;l.x=Math.max(r.x,Math.min(r.x+r.w-l.w,l.x+a)),l.y=Math.max(r.y,Math.min(r.y+r.h-l.h,l.y+s)),i(t,l),o.startPoint={x:e.clientX,y:e.clientY}})),t.addEventListener("mouseup",(()=>{n.forEach((e=>{e.isPanning=!1}))})),t.addEventListener("mouseleave",(()=>{n.forEach((e=>{e.isPanning=!1}))})),t.addEventListener("dblclick",(e=>{const t=e.target.closest("svg");if(!t||!n.has(t))return;const o=n.get(t);o.viewBox={...o.originalViewBox},o.scale=1,i(t,o.viewBox)})),logDebug("function : activateZoomInOut","E")}catch(e){error_handling(e)}}function add_highlight(e,t,o,n){try{logDebug("function : add_highlight location_id: "+e,"S");var i=t.substring(0,4);document.querySelectorAll("svg").forEach((t=>{t.querySelectorAll("g").forEach((t=>{var a,s,l;t.querySelectorAll("path").forEach((r=>{if(null!==r.getAttribute("Location_ID")&&r.getAttribute("Location_ID")==e.toUpperCase()){r.setAttribute("style","fill: red");var _=r.getBBox(),g=_.width>_.height?_.width:_.height;(a=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttributeNS(null,"id","Harrow"),a.setAttributeNS(null,"d","M100 20 L80 100 L103 80 L125 100 Z"),a.setAttributeNS(null,"stroke","black"),a.setAttributeNS(null,"stroke-width",1),a.setAttributeNS(null,"transform","translate("+(_.x+g/2-105)+","+(_.y+(_.width>_.height?0:g)-10)+")"),(s=document.createElementNS("http://www.w3.org/2000/svg","circle")).setAttributeNS(null,"id","Hcircle"),s.setAttributeNS(null,"cx",_.x+g/2),s.setAttributeNS(null,"cy",_.y+(_.width>_.height?0:g)+150),s.setAttributeNS(null,"r",50),s.setAttributeNS(null,"fill","red"),(l=document.createElementNS("http://www.w3.org/2000/svg","text")).textContent="Y"==n?i+o:e.toUpperCase(),l.setAttributeNS(null,"id","Htext"),l.setAttributeNS(null,"x",_.x+g/2),l.setAttributeNS(null,"y",_.y+(_.width>_.height?0:g)+150),l.setAttributeNS(null,"text-anchor","middle"),l.setAttributeNS(null,"font-size","2vh"),l.setAttributeNS(null,"font-family","Arial"),l.setAttributeNS(null,"font-weight","bold"),l.setAttributeNS(null,"fill","yellow"),l.setAttributeNS(null,"dy",".5em"),t.prepend(a),t.prepend(l),t.prepend(s)}}))}))})),logDebug("function : add_highlight location_id: "+e,"E")}catch(e){error_handling(e)}}async function auto_align_peg_items(e,t,o,n,i,a,s,l){var r=0;for(const E of g_pog_json[e].ModuleInfo){if(null==E.ParentModule){var _=0;for(const D of E.ShelfInfo){0;var g=D.Y+D.H/2,f=D.Y-D.H/2,c=(D.X,D.W,D.X+D.W/2);if("PEGBOARD"==D.ObjType){var d=0,u="Y";for(const e of D.ItemInfo)if(e.Y+e.H/2>g||e.Y+e.H/2<f||e.X-e.W/2>c){u="Y";break}if("Y"==u){d=0,JSON.parse(JSON.stringify(D.ItemInfo));var h=g_pog_json[e].ModuleInfo[r].ShelfInfo[_].ItemInfo;g_pog_json[e].ModuleInfo[r].ShelfInfo[_].AutoPlacing="N";for(const e of h)e.LocID=""!==e.LocID?parseInt(e.LocID):"";var I={LocID:"asc"};if(h.keySort(I),h.length>1){d=0;for(const t of h){var p=get_closest_peg(t.H,r,_,g-t.H/2,e)-t.H/2;t.FromProductList="Y",t.Y=p,t.Exists="N",t.Edited="N",d++}var m=0;d=0;h=g_pog_json[e].ModuleInfo[r].ShelfInfo[_].ItemInfo;for(const e of h)0==d&&(m=e.Y+e.H/2),m<e.Y+e.H/2&&(m=e.Y+e.H/2),d++;d=0;I={LocID:"asc"};(h=g_pog_json[e].ModuleInfo[r].ShelfInfo[_].ItemInfo).keySort(I);for(const e of h)e.Y=m-e.H/2;var b=0;h=D.ItemInfo,d=0;for(const e of h)b+=e.W,d++;var v=D.X-D.W/2-b/2;d=0;for(const e of h)e.X=v+e.W/2+D.HorizSpacing,v+=e.W+D.HorizSpacing,d++;if(reorder_items(r,_,e)){d=0;var y=D.HorizGap,S=y,w=D.SpreadItem;I={LocID:"asc"};(h=g_pog_json[e].ModuleInfo[r].ShelfInfo[_].ItemInfo).keySort(I),console.log("items_list",h);for(const t of h)console.log("items before",t.Item,t.LocID,t.X,t.Y),new_x=get_item_xaxis(t.W,t.H,t.D,t.CType,-1,S,w,y,r,_,d,"Y",h.length,"N",e),g_pog_json[e].ModuleInfo[r].ShelfInfo[_].ItemInfo[d].X=new_x,d++}for(const e of D.ItemInfo)g_world.remove(g_world.getObjectById(e.ObjID)),e.LocID=""!==e.LocID?parseInt(e.LocID):"";if(reorder_items(r,_,e)){await recreate_pegboard_items(r,_,D.ObjType,"N",-1,-1,h.length,"Y","N",-1,-1,1,"",e,t,o,n,i,a,s,l);for(const t of g_pog_json[e].ModuleInfo[r].ShelfInfo[_].ItemInfo)t.FromProductList="N",t.Exists="E",t.Edited="N",d++;"Y"==g_show_live_image&&animate_pog(e)}}}}_++}}r++}render(e)}async function recreate_pegboard_items(e,t,o,n,i,a,s,l,r,_,g,f,c,d,u,h,I,p,m,b,v){logDebug("function : recreate_all_items; p_module_index : "+e+"; p_shelf_index : "+t+"; shelf_obj_type : "+o+"; p_edit_ind : "+n+"; locationX : "+i+"; edit_item_index : "+a+"; item_length : "+s+"; shelf_edit : "+r+"; redoX : "+_+"; create_canvas : "+f,"S");try{g_world=g_scene_objects[d].scene.children[2];var y=g_show_live_image,S=g_pog_json[d].ModuleInfo[e].ShelfInfo[t].HorizGap,w=S,E=g_pog_json[d].ModuleInfo[e].ShelfInfo[t].SpreadItem,D=g_pog_json[d].ModuleInfo[e].ShelfInfo[t].X-g_pog_json[d].ModuleInfo[e].ShelfInfo[t].W/2,x=g_pog_json[d].ModuleInfo[e].ShelfInfo[t].Y-g_pog_json[d].ModuleInfo[e].ShelfInfo[t].H/2,j=[],O=0,N=0;for(const e of j){var T=g_world.getObjectById(e.ObjID);g_world.remove(T),e.W,N++}N=0,j=g_pog_json[d].ModuleInfo[e].ShelfInfo[t].ItemInfo;for(const a of j){O=get_item_xaxis(a.W,a.H,a.D,o,i,w,E,S,e,t,N,n,g_pog_json[d].ModuleInfo[e].ShelfInfo[t].ItemInfo.length,r,d),g_pog_json[d].ModuleInfo[e].ShelfInfo[t].ItemInfo[N].Distance=O-a.W/2-D,"PEGBOARD"==g_pog_json[d].ModuleInfo[e].ShelfInfo[t].ObjType&&(g_pog_json[d].ModuleInfo[e].ShelfInfo[t].ItemInfo[N].PegBoardX=O-a.W/2-D,g_pog_json[d].ModuleInfo[e].ShelfInfo[t].ItemInfo[N].PegBoardY=g_pog_json[d].ModuleInfo[e].ShelfInfo[t].ItemInfo[N].Y-a.H/2-x,g_pog_json[d].ModuleInfo[e].ShelfInfo[t].ItemInfo[N].FromProductList="N"),g_pog_json[d].ModuleInfo[e].ShelfInfo[t].ItemInfo[N].OldObjID=a.ObjID;a.ObjID;if("Y"==y&&"DIVIDER"!==a.Item&&3!=j[N].MerchStyle)var M=g_orientation_json[g_pog_json[d].ModuleInfo[e].ShelfInfo[t].ItemInfo[N].Orientation].split("###"),L=await add_items_with_image(a.ItemID,a.W,a.H,a.D,a.Color,O,g_pog_json[d].ModuleInfo[e].ShelfInfo[t].ItemInfo[N].Y,"",e,t,N,a.BHoriz,a.BVert,a.Item,parseInt(M[0]),parseInt(M[1]),"N",l,u,h,I,p,m,b,d);else L=await add_items_prom(a.ItemID,a.W,a.H,a.D,a.Color,O,g_pog_json[d].ModuleInfo[e].ShelfInfo[t].ItemInfo[N].Y,"",e,t,N,"N",l,v,p,b,p,m,d);"PEGBOARD"==g_pog_json[d].ModuleInfo[e].ShelfInfo[t].ObjType&&(g_final_z=g_pog_json[d].ModuleInfo[e].ShelfInfo[t].Z+g_pog_json[d].ModuleInfo[e].ShelfInfo[t].D/2+a.D/2),g_pog_json[d].ModuleInfo[e].ShelfInfo[t].ItemInfo[N].X=O,g_pog_json[d].ModuleInfo[e].ShelfInfo[t].ItemInfo[N].Z=g_final_z,g_pog_json[d].ModuleInfo[e].ShelfInfo[t].ItemInfo[N].ObjID=L,g_pog_json[d].ModuleInfo[e].ShelfInfo[t].ItemInfo[N].CType=g_pog_json[d].ModuleInfo[e].ShelfInfo[t].ObjType,N+=1}return"Y"==g_show_live_image&&animate_pog(d),logDebug("function : recreate_all_items","E"),O}catch(e){console.log("err",e),error_handling(e)}}