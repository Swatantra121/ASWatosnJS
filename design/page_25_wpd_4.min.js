var l_show_max_merch_comp="N";function get_detail_array(e,o,_,n,t,i,a,s,g,l,r,d,c,f,I,p,h,u,m,O,S){var P={};return P.MIndex=e,P.SIndex=o,P.IIndex=_,P.ShelfObjType=n,P.ShelfInfo=t,P.Shelf=i,P.NewShelfRecreated=a,P.ItemInfo=s,P.Item=g,P.Corrected=l,P.ErrorCategory=r,P.POGCode=d,P.Version=c,P.Desc=f,P.Module=I,P.CapFacing=p,P.CapDepth=h,P.CapHorz=u,P.BHoriz=m,P.BVert=O,P.BaseD=S,P}async function validate_pog(e,o="N",_="N"){logDebug("function : validate_pog","S");try{g_errored_items=[];var n=0,t="N";await set_shelf_item_index(e);for(const u of g_pog_json[e].ModuleInfo){if(null==u.ParentModule||"undefined"==u.ParentModule){var i=0;for(const m of u.ShelfInfo){if(void 0!==m)if("NOTCH"!==m.ObjType&&"BASE"!==m.ObjType&&"DIVIDER"!==m.ObjType&&"TEXTBOX"!==m.ObjType&&"CHEST"!==m.ObjType)if("HANGINGBAR"==m.ObjType){if("N"==validate_shelf_min_distance(n,i,m.Y,m.ItemInfo,m.AllowAutoCrush,n,m.X,"N",m,e))var a=get_detail_array(n,i,g,m.ObjType,JSON.parse(JSON.stringify(m)),m.Shelf,"N",{},"","Y",g_error_category,g_pog_json[e].POGCode,g_pog_json[e].Version,"",g_pog_json[e].ModuleInfo[n].Module,"","","","","","")}else if(m.ItemInfo.length>0){var s=JSON.parse(JSON.stringify(m.ItemInfo));m.ItemInfo=[];var g=0;if("R"==m.SpreadItem)for(var l=s.length-1;l>=0;l--){m.ItemInfo.splice(0,0,s[l]);var r=[],d=[],c=[];(h=[]).push(wpdSetFixed(s[l].D)),r.push(wpdSetFixed(s[l].H)),d.push(wpdSetFixed(s[l].W)),c.push(g);var f=m.AllowAutoCrush,I=[];if((a=get_detail_array(n,i,g,m.ObjType,JSON.parse(JSON.stringify(m)),m.Shelf,"N",JSON.parse(JSON.stringify(s[l])),s[l].Item,"N","",g_pog_json[e].POGCode,g_pog_json[e].Version,s[l].Desc,g_pog_json[e].ModuleInfo[n].Module,s[l].CapFacing,s[l].CapDepth,s[l].CapHorz,s[l].BHoriz,s[l].BVert,s[l].BaseD)).NewShelfInd="",a.W=s[l].W,a.H=s[l].H,a.D=s[l].D,"SHELF"==m.ObjType||"CHEST"==m.ObjType&&"N"==g_chest_as_pegboard||"PALLET"==m.ObjType||"HANGINGBAR"==m.ObjType)"Y"==item_height_validation(s[l].H,n,i,g,"N",s[l].X,f,s[l].CrushVert,s[l].Fixed,"N",s[l].D,"Y",e,_)&&(a.ErrorCategory=g_error_category,a.Errored="Y",g_errored_items.push(a),t="Y");if(!validate_items(d,r,h,c,m.ObjType,n,i,g,"N",0,0,0,s[l].X,"N","N","N","N","Y",I,"N","Y","N",e)){a.ErrorCategory=g_error_category,a.Errored="Y";var p="N";for(obj of g_errored_items)if(obj.MIndex==n&&obj.SIndex==i&&obj.IIndex==l){p="Y";break}("Y"==o||"N"==p)&&g_errored_items.push(JSON.parse(JSON.stringify(a))),t="Y"}if(!validate_items(d,r,h,c,m.ObjType,n,i,g,"N",0,0,0,s[l].X,"N","N","N","N","Y",I,"N","N","Y",e)){a.ErrorCategory=g_error_category,a.Errored="Y";p="N";for(obj of g_errored_items)if(obj.MIndex==n&&obj.SIndex==i&&obj.IIndex==l){p="Y";break}("Y"==o||"N"==p)&&g_errored_items.push(JSON.parse(JSON.stringify(a))),t="Y"}}else for(const l of s){m.ItemInfo.push(l);var h;r=[],d=[],c=[];(h=[]).push(wpdSetFixed(l.D)),r.push(wpdSetFixed(l.H)),d.push(wpdSetFixed(l.W)),c.push(g);f=m.AllowAutoCrush,I=[];if((a=get_detail_array(n,i,g,m.ObjType,JSON.parse(JSON.stringify(m)),m.Shelf,"N",JSON.parse(JSON.stringify(l)),l.Item,"N","",g_pog_json[e].POGCode,g_pog_json[e].Version,l.Desc,g_pog_json[e].ModuleInfo[n].Module,l.CapFacing,l.CapDepth,l.CapHorz,l.BHoriz,l.BVert,l.BaseD)).NewShelfInd="",a.W=l.W,a.H=l.H,a.D=l.D,"SHELF"==m.ObjType||"CHEST"==m.ObjType&&"N"==g_chest_as_pegboard||"PALLET"==m.ObjType||"HANGINGBAR"==m.ObjType)"Y"==item_height_validation(l.H,n,i,g,"N",l.X,f,l.CrushVert,l.Fixed,"N",l.D,"Y",e,_)&&(a.ErrorCategory=g_error_category,g_errored_items.push(JSON.parse(JSON.stringify(a))),t="Y");if(!validate_items(d,r,h,c,m.ObjType,n,i,g,"N",0,0,0,l.X,"N","N","N","N","Y",I,"N","Y","N",e)){a.ErrorCategory=g_error_category;p="N";for(obj of g_errored_items)if(obj.MIndex==n&&obj.SIndex==i&&obj.IIndex==g){p="Y";break}("Y"==o||"N"==p)&&g_errored_items.push(JSON.parse(JSON.stringify(a))),t="Y"}if(!validate_items(d,r,h,c,m.ObjType,n,i,g,"N",0,0,0,l.X,"N","N","N","N","Y",I,"N","N","Y",e)){a.ErrorCategory=g_error_category;p="N";for(obj of g_errored_items)if(obj.MIndex==n&&obj.SIndex==i&&obj.IIndex==g){p="Y";break}("Y"==o||"N"==p)&&g_errored_items.push(JSON.parse(JSON.stringify(a))),t="Y"}g++}}i++}}n++}if(g_errored_items.length>0)for(const o of g_errored_items){var u,m=g_pog_json[e].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex],O=g_pog_json[e].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex].ItemInfo[o.IIndex];if("N"==(u=await check_crush_facing_correct(o.MIndex,o.SIndex,o.IIndex,"Y",O.X,O,m,"Y","C",o.ErrorCategory,e)))if("Y"==(u=await check_crush_facing_correct(o.MIndex,o.SIndex,o.IIndex,"Y",O.X,O,m,"Y","F",o.ErrorCategory,e)))o.CorrectionMethod="F";else{var S="H"==o.ErrorCategory?o.ItemInfo.H:"W"==o.ErrorCategory?o.ItemInfo.W:"D"==o.ErrorCategory?o.ItemInfo.D:-1,[u,P]=await check_fixel_avail_space(o.MIndex,o.SIndex,o.IIndex,o.ErrorCategory,S,"Y",-1,O,e);"Y"==u?(o.CorrectionMethod="NF",o.NewShelfInd=P,o.FixelChange=g_pog_json[e].ModuleInfo[o.MIndex].ShelfInfo[P].Shelf):o.CorrectionMethod="FAIL"}else o.CorrectionMethod="C"}return logDebug("function : validate_pog","E"),t}catch(e){error_handling(e)}}async function check_fixel_avail_space(e,o,_,n,t,i,a,s,g){logDebug("function : check_fixel_avail_space; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+_+"; category : "+n+"; check_dim : "+t+"; check_ind : "+i+"; new_shelf_ind : "+a,"S");try{var l=0;if("Y"==i){a=-1;for(const _ of g_pog_json[g].ModuleInfo[e].ShelfInfo){if(void 0!==_&&"NOTCH"!==_.ObjType&&"BASE"!==_.ObjType&&"DIVIDER"!==_.ObjType&&"TEXTBOX"!==_.ObjType&&l!==o){var r=wpdSetFixed(_.Y+_.H/2);if("PEGBOARD"==_.ObjType)var d=_.VertiSpacing;else d=_.HorizGap;var c=height_valid=depth_valid="N",f=0;for(const e of _.ItemInfo)"SHELF"==_.ObjType?wpdSetFixed(e.Y-e.H/2)==r&&(d>0?f+=wpdSetFixed(e.W+d):f=wpdSetFixed(f+e.W)):d>0?f+=wpdSetFixed(e.W+d):f=wpdSetFixed(f+e.W);if(g_errored_items.length>0)for(const e of g_errored_items)"NF"==e.CorrectionMethod&&e.NewShelfInd==l&&(d>0?f+=wpdSetFixed(e.W+d):f=wpdSetFixed(f+e.W));if(wpdSetFixed(_.W-f)>=t&&(c="Y"),t<=get_max_merch(e,l,-1,"Y",_.X,g)&&(height_valid="Y"),t<=_.D&&(depth_valid="Y"),"Y"==c&&"Y"==height_valid&&"Y"==depth_valid){a=l;break}}l++}}if(-1!==a&&"N"==i){var I=-1,p=0;for(item_details of g_pog_json[g].ModuleInfo[e].ShelfInfo[o].ItemInfo){if(item_details.IIndex==s.IIndex){I=p;break}p++}if(g_pog_json[g].ModuleInfo[e].ShelfInfo[o].ItemInfo.splice(I,1),"R"==g_pog_json[g].ModuleInfo[e].ShelfInfo[o].SpreadItem)g_pog_json[g].ModuleInfo[e].ShelfInfo[a].ItemInfo.splice(0,0,s);else{g_pog_json[g].ModuleInfo[e].ShelfInfo[a].ItemInfo.push(s);var h=g_pog_json[g].ModuleInfo[e].ShelfInfo[a].ItemInfo.length-1,u=g_pog_json[g].ModuleInfo[e].ShelfInfo[a].ItemInfo[h],m=g_pog_json[g].ModuleInfo[e].ShelfInfo[a];s=u;if("PEGBOARD"==m.ObjType)d=m.VertiSpacing;else d=m.HorizGap;var[O,S]=get_item_xy(m,s,s.W,s.H,g);u.Y=wpdSetFixed(S),u.X=get_item_xaxis(s.W,s.H,s.D,m.ObjType,-1,d,m.SpreadItem,d,e,a,h,"Y",m.ItemInfo.length,"N",g);var P=1,E=s.RD/s.BaseD;P=Math.floor(100*m.D/(100*E));var v=nvl(s.MPogDepthFacings)>0?s.MPogDepthFacings:s.MDepthFacings;P=v<P&&v>-1?v:P,u.D=E*(P>0?P:1),u.BaseD=P>0?P:1}return logDebug("function : check_fixel_avail_space","E"),["Y",a]}if(-1!==a&&"Y"==i)return logDebug("function : check_fixel_avail_space","E"),["Y",a];if("Y"==i)return logDebug("function : check_fixel_avail_space","E"),["N",a]}catch(e){error_handling(e)}}async function check_crush_facing_correct(e,o,_,n,t,a,s,g,l,r,d){logDebug("function : check_crush_facing_correct; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+_+"; p_edit_ind : "+n+"; i_final_x : "+t+"; check_ind : "+g+"; check_type : "+l+"; category : "+r,"S");try{l_max_merch=get_max_merch(e,o,_,n,t,d);var c=[],f=[],I=[],p=[],h=[];c.push(wpdSetFixed(a.D)),f.push(wpdSetFixed(a.H)),I.push(wpdSetFixed(a.W)),p.push(_);var u=g_pog_json[d].ModuleInfo[e].ShelfInfo[o].ItemInfo[_],m=g_pog_json[d].ModuleInfo[e].ShelfInfo[o],O=g_pog_json[d].ModuleInfo[e];if("C"==l){if("H"==r){var S="N",P=get_cap_max_merch(e,o,O,m,d,g_dft_max_merch);if(("1"==u.CapStyle||"2"==u.CapStyle||"3"==u.CapStyle)&&P<u.H)S=await set_item_capping(d,e,o,_,"N","Y"==g?"N":"Y");if("N"==S){var E=a.CrushVert>0?a.CrushVert:a.CHPerc,v=0,D=0;for(i=1;i<E;i++)if(D=a.H-a.H*i/100,l_max_merch>=D){v=i;break}if(v>0)if("Y"==g)S="Y";else{u.H=D,u.RH=D;var[C,T]=get_item_xy(s,a,a.W,a.H,d);u.Y=T,u.HChanged="Y"}else"Y"==g&&(S="N")}return S}if("W"==r){if(validate_items(I,f,c,p,s.ObjType,e,o,_,"N",0,0,0,a.X,"N","N","N","N","Y",h,"Y","Y","N",d)){if("Y"==g)return $.each(g_pog_json[d].ModuleInfo[e].ShelfInfo[o].ItemInfo,(function(e,o){o.W=o.RW})),"Y"}else if("Y"==g)return"N"}else if("D"==r)if(validate_items(I,f,c,p,s.ObjType,e,o,_,"N",0,0,0,a.X,"N","N","N","N","Y",h,"Y","N","Y",d)){if("Y"==g)return $.each(g_pog_json[d].ModuleInfo[e].ShelfInfo[o].ItemInfo,(function(e,o){o.D=o.RD})),"Y"}else if("Y"==g)return"N"}else if("F"==l)if("H"==r){if(a.BVert>1){var b=0;(0==(b=Math.floor(100*l_max_merch/(a.RH/a.BVert*100)))||b<0)&&(b=1);var j=nvl(a.MPogVertFacings)>0?a.MPogVertFacings:a.MVertFacings;if(b=j<b&&j>-1?j:b,(D=a.RH/a.BVert*b)>l_max_merch){if("Y"==g)return"N"}else{if("Y"==g)return"Y";u.H=D,u.RH=D,u.BVert=b,u.Y=s.Y+s.H/2+D/2}}else if("Y"==g)return"N"}else if("W"==r){if(a.BVert>1){var N=a.AvlSpace,x=1;if("PEGBOARD"==s.ObjType)var M=s.VertiSpacing;else M=s.HorizGap;x=0==(x=Math.floor(100*N/(a.RW/a.BHoriz*100)))||x<0?1:x;var R;if(N<(R=wpdSetFixed(a.RW/a.BHoriz*x+M*(I.length-1)))){if("Y"==g)return"N"}else{if("Y"==g)return"Y";u.W=R,u.RW=R,u.BHoriz=x,u.X=get_item_xaxis(R,a.H,a.D,s.ObjType,-1,M,s.SpreadItem,M,e,o,_,"Y",s.ItemInfo.length,"N",d)}}}else"D"==r&&await maximizeItemDepthFacings("D",e,o,_,d);logDebug("function : check_crush_facing_correct","E")}catch(e){error_handling(e)}}async function fixel_merch(){logDebug("function : fixel_merch","S");var e=g_pog_index;if("N"==g_show_max_merch?(g_show_max_merch="Y",$(".fixel_merch").addClass("max_merch_active")):(g_show_max_merch="N",$(".fixel_merch").removeClass("max_merch_active")),"N"==g_all_pog_flag)await add_merch(g_show_max_merch,g_pog_index);else{var o=0;for(pogJson of g_pog_json)(o!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex)&&(g_renderer=g_scene_objects[o].renderer,g_scene=g_scene_objects[o].scene,g_camera=g_scene_objects[o].scene.children[0],await add_merch(g_show_max_merch,o),set_indicator_objects(o)),o++;g_renderer=g_scene_objects[e].renderer,g_scene=g_scene_objects[e].scene,g_camera=g_scene_objects[e].scene.children[0]}logDebug("function : fixel_merch","E")}async function create_side(e,o,_){logDebug("function : create_side; view_ind : "+e,"S");try{return new Promise((function(n,t){if(g_pog_json[_]=JSON.parse(JSON.stringify(g_pog_json[o])),g_pog_json[_].POGCode=g_pog_json[_].POGCode+"-"+e,"BACK"==e)var i=back_side("Y",o,_);else{var a=h=depth=baseheight=u=m=z=0,s="N",g=g_pog_json;g_compare_pog_flag="Y",min_x=max_x=min_y=max_y=0;var l=g[o].ModuleInfo;if(g[o].BaseH>0){"LEFT"==e||"RIGHT"==e?(a=g[o].BaseD,h=g[o].BaseH,max_y=h,depth=.001):"TOP"==e&&(a=g[o].BaseW,h=g[o].BaseD,max_y=h,depth=.001),"LEFT"==e?u=g[o].BaseD/2:"RIGHT"==e?u=-g[o].BaseD/2+g[o].BackDepth:"TOP"==e&&(u=g[o].BaseX),"LEFT"==e||"RIGHT"==e?m=g[o].BaseH/2:"TOP"!=e&&"BOTTOM"!=e||(m=-h/2),z=0;var r=parseInt(g[o].Color.replace("#","0x"),16),d=new THREE.Color(r);i=add_objects("pog_base",a,h,depth,d,u,m,z,g_scene_objects[_].scene.children[2],0,0,"N","","","",o);console.log("returnval",i,"pog_base",a,h,depth,d,u,m,z,g_scene_objects[_].scene.children[2],0,0,"N","","","",o),g_pog_json[o].CompBaseObjID=i.id,g_pog_json[_].BaseObjID=i.id,g_pog_json[_].CompBaseObjID=g_pog_json[o].BaseObjID,max_x=a}var c=-1,f=.05,I=.05,p=.6;$.each(l,(function(n,t){if(null==t.ParentModule||"undefined"==t.ParentModule){if(c=-1==c?0:1,"N"==s){"LEFT"==e||"RIGHT"==e?(a=g[o].BackDepth,h=t.H,depth=.001,u=a/2,m=h/2+g[o].BaseH,s="Y"):"TOP"!=e&&"BOTTOM"!=e||(a=t.W,h=g[o].BackDepth,depth=.001,u=t.X,m=0,s="N"),z=0;var i=parseInt(t.Color.replace("#","0x"),16),l=new THREE.Color(i);min_x=Math.min(min_x,u-a/2),max_x=Math.max(max_x,u+a/2),min_y=Math.min(min_y,m-h/2),max_y=Math.max(max_y,m+h/2);var r=add_objects(t.Module,a,h,depth,l,u,m,z,g_scene_objects[_].scene.children[2],0,0,"N","","","",o);g_pog_json[o].ModuleInfo[n].CompMObjID=r.id,g_pog_json[_].ModuleInfo[n].MObjID=r.id,g_pog_json[_].ModuleInfo[n].CompMObjID=g_pog_json[o].ModuleInfo[n].MObjID}$.each(t.ShelfInfo,(function(t,i){if(void 0!==i){if("NOTCH"!==i.ObjType&&"BASE"!==i.ObjType){"LEFT"==e||"RIGHT"==e?(a=i.D,h=i.H,m=i.Y,"LEFT"==e?i.X<0?(z=p-1e-4,p-=1e-4):(z=f-1e-4,f-=1e-4):(z=I+1e-4,I+=1e-4)):"TOP"!=e&&"BOTTOM"!=e||(a=i.W,h=i.D,m=-(i.Z+g[o].BackDepth/2),"BOTTOM"==e?(z=I,I-=1e-4):(z=I+1e-4,I+=1e-4)),depth=.001;var s=parseInt(i.Color.replace("#","0x"),16),l=new THREE.Color(s);if("LEFT"==e)var r=(u=i.Z)+a/2,d=u-a/2;else if("RIGHT"==e)r=(u=-i.Z+g[o].BackDepth)-a/2,d=u+a/2;else if("TOP"==e||"BOTTOM"==e){u=i.X;r=m-h/2,d=m+h/2}var c=add_objects(i.Shelf,a,h,depth,l,u,m,z,g_scene_objects[_].scene.children[2],i.Rotation,i.Slope,0!==i.Rotation||0!==i.Slope?"Y":"N","","","",o);g_pog_json[o].ModuleInfo[n].ShelfInfo[t].CompShelfObjID=c.id,g_pog_json[_].ModuleInfo[n].ShelfInfo[t].SObjID=c.id,g_pog_json[_].ModuleInfo[n].ShelfInfo[t].CompShelfObjID=g_pog_json[o].ModuleInfo[n].ShelfInfo[t].SObjID,min_x=Math.min(min_x,u-a/2),max_x=Math.max(max_x,u+a/2),min_y=Math.min(min_y,m-h/2),max_y=Math.max(max_y,m+h/2)}if(i.ItemInfo.length>0){var O=prev_width=prev_y=prev_height=-1,S=0,P=0,E=0,v=0;"ROD"==i.ObjType&&$.each(i.ItemInfo,(function(e,o){0==i.DGap&&"E"==i.SpreadItem?o.BaseD>1&&(S=o.OD*o.BaseD):i.DGap>0&&"E"==i.SpreadItem&&o.BaseD>1&&(S=o.D+i.DGap*(o.BaseD-1)),v+=S,"F"==i.SpreadItem&&(E+=o.OD*o.BaseD,P+=o.BaseD)})),$.each(i.ItemInfo,(function(s,l){var c=i.ItemInfo.length,D=0;"ROD"==i.ObjType?(S=0==i.DGap&&"E"==i.SpreadItem?l.OD*l.BaseD:i.DGap>0&&"E"==i.SpreadItem?l.D+i.DGap*(l.BaseD-1):l.D,"E"==i.SpreadItem?D=(i.D-v)/(c-1):"F"==i.SpreadItem&&(D=(i.D-E)/(P-1),S=l.D+D*(l.BaseD-1))):S=l.D,"LEFT"==e||"RIGHT"==e?(a=S,h=l.H,m=l.Y,"LEFT"==e?i.X<0?(z=p-1e-4,p-=1e-4):(z=f-1e-4,f-=1e-4):(z=I+1e-4,I+=1e-4)):"TOP"!=e&&"BOTTOM"!=e||(a=l.W,h=S,u=l.X,"BOTTOM"==e?(z=I-1e-4,I-=1e-4):(z=I+1e-4,I+=1e-4)),depth=.001;var C=parseInt(l.Color.replace("#","0x"),16),T=new THREE.Color(C);"LEFT"==e?"PEGBOARD"==i.ObjType||"HANGINGBAR"==i.ObjType||"CHEST"==i.ObjType&&"Y"==g_chest_as_pegboard?u=r+a/2:"ROD"==i.ObjType?(u="FR"!=i.SpreadItem?0==s?g[o].BackDepth+S/2:O+prev_width/2+S/2+D:0==s?g[o].BackDepth+i.D-S/2:O-prev_width/2-S/2+D,O=u,prev_width=a):u=r-a/2:"RIGHT"==e?"PEGBOARD"==i.ObjType||"HANGINGBAR"==i.ObjType||"CHEST"==i.ObjType&&"Y"==g_chest_as_pegboard?u=r-a/2:"ROD"==i.ObjType?(u="FR"!=i.SpreadItem?0==s?d-a/2:O-prev_width/2-a/2-D:0==s?r+a/2:O+prev_width/2+a/2+D,O=u,prev_width=a):u=r+a/2:"TOP"!=e&&"BOTTOM"!=e||("PEGBOARD"==i.ObjType||"HANGINGBAR"==i.ObjType||"CHEST"==i.ObjType&&"Y"==g_chest_as_pegboard?m=r-h/2:"ROD"==i.ObjType?(m="FR"!=i.SpreadItem?0==s?-(g[o].BackDepth+h/2):prev_y-prev_height/2-h/2-D:0==s?-(g[o].BackDepth+i.D-h/2):prev_y+prev_height/2+h/2-D,O=u,prev_y=m,prev_width=a,prev_height=h):m="PALLET"==i.ObjType?-(g[o].BackDepth+i.D-l.Z):r+h/2);var b=add_objects(l.Item,a,h,depth,T,u,m,z,g_scene_objects[_].scene.children[2],0,0,0!==i.Rotation||0!==i.Slope?"Y":"N","","","",o);b.ItemID=l.Item,b.Description=l.Desc,b.HorizFacing=l.BHoriz,b.VertFacing=l.BVert,b.DimUpdate=l.DimUpdate,b.SellingPrice=l.SellingPrice,b.SalesUnit=l.SalesUnit,b.NetSales=l.NetSales,b.GrossProfit=l.GrossProfit,b.CogsAdj=l.CogsAdj,b.RegMovement=l.RegMovement,b.AvgSales=l.AvgSales,b.ItemStatus=l.ItemStatus,b.CDTLvl1=l.CDTLvl1,b.CDTLvl2=l.CDTLvl2,b.CDTLvl3=l.CDTLvl3,b.StoreCnt=l.StoreCnt,b.WeeksOfInventory=l.WeeksOfInventory,b.WeeksCount=l.WeeksCount,b.MovingItem=l.MovingItem,b.Profit=l.Profit,b.TotalMargin=l.TotalMargin,b.Status=l.Status,b.DescSecond=l.DescSecond,b.DFacing=l.BaseD,b.ActualDPP=l.ActualDPP,b.StoreSOH=l.StoreSOH,b.DPPLoc=l.DPPLoc,b.StoreNo=l.StoreNo,b.W=l.W,b.H=l.H,b.D=l.D,b.Color=l.Color,b.Barcode=l.Barcode,b.Desc=l.Desc,b.Brand=l.Brand,b.BrandType=l.BrandType,b.Group=l.Group,b.Dept=l.Dept,b.Class=l.Class,b.SubClass=l.SubClass,b.StdUOM=l.StdUOM,b.SizeDesc=l.SizeDesc,b.Supplier=l.Supplier,b.SupplierName=l.SupplierName,b.LocID=l.LocID,b.ItemDim=(100*l.OW).toFixed(2)+" : "+(100*l.OH).toFixed(2)+" : "+(100*l.OD).toFixed(2),b.OrientationDesc=l.OrientationDesc,b.Orientation=l.Orientation,b.StoreCnt=l.StoreCnt,b.OW=100*l.OW,b.OH=100*l.OH,b.OD=100*l.OD,b.Shelf=i.Shelf,b.Rotation=0,b.ItemSlope=0,b.ImageExists="N",b.UnitperCase=l.UnitperCase,b.UnitperTray=l.UnitperTray,b.DfacingUpd=l.DfacingUpd,b.ItmDescChi=l.ItmDescChi,b.ItmDescEng=l.ItmDescEng,b.TotalUnitsCalc=l.BHoriz*l.BVert*l.BaseD,b.PkSiz=l.PkSiz,b.CapFacing=l.CapFacing,b.CapDepth=l.CapDepth,b.CapHorz=l.CapHorz;var j=l.CapFacing*l.CapDepth*l.CapHorz;if(b.Cpct=l.BHoriz*l.BVert*l.BaseD+(isNaN(j)?0:j),b.Brand_Category=l.Brand_Category,b.Uda_item_status=l.Uda_item_status,b.Gobecobrand=l.Gobecobrand,b.Internet=l.Internet,b.GoGreen=l.GoGreen,b.Categ=l.Categ,b.ItemSize=l.ItemSize,b.SplrLbl=l.SplrLbl,b.COO=l.COO,b.EDLP=l.EDLP,b.LoGrp=l.LoGrp,b.SqzPer=(void 0!==l.CrushHoriz?l.CrushHoriz:0)+":"+(void 0!==l.CrushVert?l.CrushVert:0)+":"+(void 0!==l.CrushD?l.CrushD:0),b.InternationalRng=l.InternationalRng,b.NewItem=l.NewItem,b.LiveNewItem=l.LiveNewItem,b.DaysOfSupply=l.DaysOfSupply,b.CapDepthChanged=l.CapDepthChanged,b.MassCrushH=l.MassCrushH,b.MassCrushV=l.MassCrushV,b.MassCrushD=l.MassCrushD,b.ShelfPrice=l.ShelfPrice,b.PromoPrice=l.PromoPrice,b.DiscountRate=l.DiscountRate,b.PriceChangeDate=l.PriceChangeDate,b.WeeksOfInventory=l.WeeksOfInventory,b.Qty=l.Qty,b.WhStock=l.WhStock,b.StoreStock=l.StoreStock,b.StockIntransit=l.StockIntransit,b.ItemCondition=l.ItemCondition,b.AUR=l.AUR,b.ItemRanking=l.ItemRanking,b.WeeklySales=l.WeeklySales,b.WeeklyNetMargin=l.WeeklyNetMargin,b.WeeklyQty=l.WeeklyQty,b.NetMarginPercent=l.NetMarginPercent,b.CumulativeNM=l.CumulativeNM,b.TOP80B2=l.TOP80B2,b.ItemBrandC=l.ItemBrandC,b.ItemPOGDept=l.ItemPOGDept,b.ItemRemark=l.ItemRemark,b.RTVStatus=l.RTVStatus,b.Pusher=l.Pusher,b.Divider=l.Divider,b.BackSupport=l.BackSupport,b.CWPerc=l.CWPerc,b.CHPerc=l.CHPerc,b.CDPerc=l.CDPerc,b.OOSPerc=l.OOSPerc,b.InitialItemDesc=l.InitialItemDesc,b.InitialBrand=l.InitialBrand,b.InitialBarcode=l.InitialBarcode,min_x=Math.min(min_x,u-a/2),max_x=Math.max(max_x,u+a/2),min_y=Math.min(min_y,m-h/2),max_y=Math.max(max_y,m+h/2),g_pog_json[o].ModuleInfo[n].ShelfInfo[t].ItemInfo[s].CompItemObjID=b.id,g_pog_json[_].ModuleInfo[n].ShelfInfo[t].ItemInfo[s].ObjID=b.id,g_pog_json[_].ModuleInfo[n].ShelfInfo[t].ItemInfo[s].CompItemObjID=g_pog_json[o].ModuleInfo[n].ShelfInfo[t].ItemInfo[s].ObjID,"DIVIDER"==l.Item){var N=g_pog_json[o].ModuleInfo[n].ShelfInfo,x=-1;$.each(N,(function(e,o){o.Shelf==l.ItemID&&"DIVIDER"==o.ObjType&&(x=e)})),g_pog_json[o].ModuleInfo[n].ShelfInfo[x].X=u,g_pog_json[o].ModuleInfo[n].ShelfInfo[x].CompShelfDivObjID=b.id}}))}}}))}}));a=max_x-min_x;var h=max_y-min_y,u=min_x+a/2,m=min_y+h/2;if("BOTTOM"==e){g_scene_objects[_].scene.children[0].position.y=0;var O=get_min_max_xy(g_pog_index).split("###");set_camera_z(g_scene_objects[_].scene.children[0],parseFloat(O[2]),max_y/2,parseFloat(O[0]),max_y,g_offset_z,parseFloat(O[4]),parseFloat(O[5]),!0,g_pog_index),g_pog_json[_].CompCamX=parseFloat(O[2]),g_pog_json[_].CompCamY=max_y/2,g_pog_json[_].CompCamWidth=parseFloat(O[0]),g_pog_json[_].CompCamHeight=max_y}else set_camera_z(g_scene_objects[_].scene.children[0],u,m,a,h,g_offset_z,a/2,h/2,!0,g_pog_index),g_pog_json[_].CompCamX=u,g_pog_json[_].CompCamY=m,g_pog_json[_].CompCamWidth=a,g_pog_json[_].CompCamHeight=h}render(_),logDebug("function : create_side","E"),n("SUCESS")}))}catch(e){error_handling(e)}}async function get_compare_pog(e,o,_,n,t,a="N"){logDebug("function : get_compare_pog; compare_ind : "+e+"; pog_code : "+o+"; pog_version : "+_+"; draft_id : "+n+"; prev_version : "+t,"S");try{"Y"==t&&$(".item_color_legends").css("display","none"),addLoadingIndicator();var s,g,l=g_pog_index;"1"==e?(s="N",g="E"):(s="Y",g="N"),apex.server.process("GET_COMPARE_JSON",{x01:e,x02:o,x03:_,x04:n},{dataType:"html"}).done((function(e){var o=$.trim(e);if(o.match(/ERROR.*/))raise_error(o),removeLoadingIndicator(regionloadWait);else if(""!==o){g_json=JSON.parse($.trim(e));JSON.parse(JSON.stringify(g_pog_json));g_pog_json_data=g_json;var _=g_pog_json_data[0].ModuleInfo;i=0;for(const e of _){if(null!=e.ShelfInfo&&void 0!==e.ShelfInfo||(e.ShelfInfo=[]),void 0===e.ParentModule||null==e.ParentModule){null!==e.SubDept&&void 0!==e.SubDept&&(subdept=e.SubDept),j=0;for(const o of e.ShelfInfo)void 0!==o.ItemInfo&&null!=o.ItemInfo||(o.ItemInfo=[]),j+=1}i+=1}$(".live_image").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".open_pdf").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".open_pdf_online").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),async function(){g_pog_json_data[0].PreVersion="";var e,o=g_pog_json_data[0];g_comp_base_code=o.POGCode,o.PreVersion="Y",o.POGCode="Y"!=a?o.POGCode+"-PREV_VERSION":o.POGCode,g_ComBaseIndex=l,g_colorBackup="N",g_comp_view_code=o.POGCode,"Y"==g_compare_pog_flag&&"PREV_VERSION"==g_compare_view?(g_pog_json[g_ComViewIndex]=o,g_ComViewIndex=g_ComViewIndex,init(g_ComViewIndex),(e={}).scene=g_scene,e.renderer=g_renderer,g_scene_objects[g_ComViewIndex]=e):(g_pog_json.push(o),g_ComViewIndex=g_pog_json.length-1,appendMultiCanvasRowCol(g_pog_json.length,$v("P25_POGCR_TILE_VIEW")),init(g_ComViewIndex),(e={}).scene=g_scene,e.renderer=g_renderer,g_scene_objects.push(e));var _=JSON.parse(JSON.stringify(g_pog_json));if(g_json=[g_pog_json[g_ComViewIndex]],g_compare_view="Y"==t?"PREV_VERSION":"POG",g_compare_pog_flag="Y",set_indicator_objects(g_ComViewIndex),modifyWindowAfterMinMax(g_scene_objects),g_pog_index=g_ComViewIndex,g_multi_pog_json=[],g_world=g_scene_objects[g_ComViewIndex].scene.children[2],g_camera=g_scene_objects[g_ComViewIndex].scene.children[0],await create_module_from_json(_,s,"F",$v("P25_PRODUCT_BTN_CLICK"),g,"N","N","Y","Y","","Y",g_scene_objects[g_ComViewIndex].scene.children[0],g_scene_objects[g_ComViewIndex].scene,g_pog_index,g_ComViewIndex),g_scene_objects[g_pog_index].Indicators.LiveImage="N",await recreate_image_items("N",$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_NOTCH_HEAD"),g_pog_index,"N","Y",g_hide_show_dos_label),g_show_live_image="N",removeLoadingIndicator(regionloadWait),render(g_ComViewIndex),"Y"==t){if("Y"==g_show_item_color)await showItemColor("OFF",g_ComViewIndex);await two_pog_diff_checker(g_ComBaseIndex,g_ComViewIndex,a),await calculateFixelAndSupplyDays("N",g_ComViewIndex)}render(g_pog_index),g_pog_index=l,add_pog_code_header()}(),$s("P25_OPEN_DRAFT","Y"),g_auto_position_ind="N",g_dblclick_opened="N"}}))}catch(e){error_handling(e),removeLoadingIndicator(regionloadWait)}}async function close_compare(){if(logDebug("function : close_compare","S"),"Y"==g_compare_pog_flag){if(addLoadingIndicator(),"PREV_VERSION"==g_compare_view)await ShowColorBackup(g_pog_index);g_ComViewIndex>-1&&"Y"==g_compare_pog_flag&&(g_pog_json.splice(g_ComViewIndex,1),g_scene_objects.splice(g_ComViewIndex,1),g_canvas_objects.splice(g_ComViewIndex,1));var e=JSON.parse(JSON.stringify(g_pog_json));appendMultiCanvasRowCol(e.length,$v("P25_POGCR_TILE_VIEW")),modifyWindowAfterMinMax(g_scene_objects),g_pog_index=0,add_pog_code_header(),removeLoadingIndicator(regionloadWait),g_pog_json=e,g_compare_view="NONE",g_compare_pog_flag="N",g_curr_canvas=1,g_edit_pallet_mod_ind=-1,g_edit_pallet_shelf_ind=-1,g_ComViewIndex=-1,g_ComBaseIndex=-1,g_comp_view_code="",g_comp_base_code="",g_canvas=$(".canvas-content [data-indx="+g_pog_index+"]")[0],set_select_canvas(g_pog_index)}logDebug("function : close_compare","E")}async function create_side_view(e){logDebug("function : create_side_view; view_ind : "+e,"S"),g_compare_view=e,g_ComViewIndex>-1&&"Y"==g_compare_pog_flag&&(g_pog_json.splice(g_ComViewIndex,1),g_scene_objects.splice(g_ComViewIndex,1),g_canvas_objects.splice(g_ComViewIndex,1));var o=g_pog_index;console.log("view_ind",e,g_multiselect);var _=g_pog_index;if("CUTAWAY"!==e){var n=JSON.parse(JSON.stringify(g_pog_json[g_pog_index]));n.POGCode=n.POGCode+"-"+e,g_comp_view_code=n.POGCode,g_comp_base_code=g_pog_json[g_pog_index].POGCode,g_pog_json.push(n),g_ComViewIndex=g_pog_json.length-1,g_ComBaseIndex=o;var t=JSON.parse(JSON.stringify(g_pog_json));appendMultiCanvasRowCol(g_pog_json.length,$v("P25_POGCR_TILE_VIEW")),init(g_pog_json.length-1),(a={}).scene=g_scene,a.renderer=g_renderer,g_scene_objects.push(a),modifyWindowAfterMinMax(g_scene_objects),g_pog_index=o}if("undefined"!=typeof g_pog_json&&g_pog_json.length>0){if($(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),"LEFT"==e?$(".left_view").addClass("active"):"RIGHT"==e?$(".right_view").addClass("active"):"TOP"==e?$(".top_view").addClass("active"):"BOTTOM"==e?$(".bottom_view").addClass("active"):"BACK"==e?$(".back_view").addClass("active"):"CUTAWAY"==e&&$(".cutaway_view").addClass("active"),console.log("view_ind",e,g_multiselect),"CUTAWAY"==e){if("Y"==g_multiselect){addLoadingIndicator(),g_compare_pog_flag="Y";var i=JSON.parse(JSON.stringify(g_pog_json[g_pog_index]));i.POGCode="CUTAWAY-"+g_pog_json[g_pog_index].POGCode,g_pog_json.push(i);var a,s=JSON.parse(JSON.stringify(g_pog_json));s.POGCode=s.POGCode+"-"+e,g_ComViewIndex=g_pog_json.length-1,g_ComBaseIndex=g_pog_index,appendMultiCanvasRowCol(g_pog_json.length,$v("P25_POGCR_TILE_VIEW")),init(g_pog_json.length-1),(a={}).scene=g_scene,a.renderer=g_renderer,g_scene_objects.push(a),set_indicator_objects(g_ComViewIndex),modifyWindowAfterMinMax(g_scene_objects),(t=JSON.parse(JSON.stringify(g_pog_json))).POGCode=t.POGCode+"-"+e,g_world=g_scene_objects[g_ComViewIndex].scene.children[2],g_camera=g_scene_objects[g_ComViewIndex].scene.children[0];await create_module_from_json(t,"Y","F",$v("P25_PRODUCT_BTN_CLICK"),"N","N","N","Y","Y","","N",g_scene_objects[g_ComViewIndex].scene.children[0],g_scene_objects[g_ComViewIndex].scene,g_ComViewIndex,g_ComViewIndex);g_multiselect="Y",render(g_ComViewIndex),select_zoom(g_scene_objects[g_ComViewIndex].scene.children[0],g_ComViewIndex),g_pog_index=o;await render_all_pog();removeLoadingIndicator(regionloadWait)}}else{if(addLoadingIndicator(),g_compare_pog_flag="Y",console.log("height",g_pog_json[_].H),g_pog_json[_].H<.2)await create_compare_pog(e);else{await create_side(e,_,g_ComViewIndex);g_scene_objects[g_ComViewIndex].scene.children[0].updateProjectionMatrix()}await render_all_pog();removeLoadingIndicator(regionloadWait)}add_pog_code_header(),g_canvas=$(".canvas-content [data-indx="+g_pog_index+"]")[0],set_select_canvas(g_pog_index),$(".fixel_merch").removeClass("max_merch_active"),$(".fixel_label").removeClass("fixel_label_active"),$(".item_label").removeClass("item_label_active"),$(".notch_label").removeClass("notch_label_active"),$(".item_color").removeClass("item_label_active"),$(".overhung_shelf").removeClass("overhung_shelf_active"),g_overhung_shelf_active="N",g_show_fixel_label="N",g_show_item_label="N",g_show_notch_label="N",g_show_max_merch="N"}logDebug("function : create_side_view","E")}function add_objects(e,o,_,n,t,i,a,s,g,l,r,d,c,f,I,p){logDebug("function : add_objects; uuid : "+e+"; width : "+o+"; height : "+_+"; depth : "+n+"; color : "+t+"; x : "+i+"; y : "+a+"; z : "+s+"; rotation : "+l+"; slope : "+r+"; shelf_rotate : "+d+"; pegx : "+f+"; pegy : "+I,"S"),object=new THREE.Mesh(new THREE.BoxGeometry(o,_,.001),new THREE.MeshStandardMaterial({color:t}));add_wireframe(object,2);return object.position.x=i,object.position.y=a,object.position.z=s,object.uuid=e,g.add(object),object.W=o,object.H=_,object.D=n,object.Color=t,object.Rotation=l,object.ItemSlope=r,object.Rotation=d,object.Distance=c,object.PegBoardX=f,object.PegBoardY=I,logDebug("function : add_objects","E"),object}async function back_side(e,o,_){logDebug("function : back_side; rotate : "+e,"S");var n=g_scene_objects[_].scene.children[2],t=g_scene_objects[_].scene.children[0];if(g_pog_json[o].BaseH>0){width=g_pog_json[o].BaseW,height=g_pog_json[o].BaseH,max_y=height,depth=.001,x=g_pog_json[o].BaseX,y=g_pog_json[o].BaseY;var i=parseInt(g_pog_json[o].Color.replace("#","0x"),16),a=new THREE.Color(i),s=add_objects("pog_base",width,height,depth,a,x,y,0,n,0,0,"N","","","",o);g_pog_json[o].CompBaseObjID=s.id,s.position.z=0,s.rotateY(180*Math.PI/180)}$.each(g_pog_json[o].ModuleInfo,(function(e,_){if(null==_.ParentModule||"undefined"==_.ParentModule){var t=parseInt(_.Color.replace("#","0x"),16),i=new THREE.Color(t),a=add_objects(_.Module,_.W,_.H,_.D,i,_.X,_.Y,0,n,0,0,"N","","","",o);g_pog_json[o].ModuleInfo[e].CompMObjID=a.id,a.position.z=_.Z,$.each(_.ShelfInfo,(function(_,t){if(void 0!==t){if("NOTCH"!==t.ObjType&&"BASE"!==t.ObjType&&"DIVIDER"!==t.ObjType){var i=parseInt(t.Color.replace("#","0x"),16),a=new THREE.Color(i),s=add_objects(t.Shelf,t.W,t.H,t.D,a,t.X,t.Y,0,n,t.Rotation,t.Slope,0!==t.Rotation||0!==t.Slope?"Y":"N","","","",o);g_pog_json[o].ModuleInfo[e].ShelfInfo[_].CompShelfObjID=s.id,s.position.z=t.Z}t.ItemInfo.length>0&&$.each(t.ItemInfo,(function(i,a){var s=parseInt(a.Color.replace("#","0x"),16),g=new THREE.Color(s),l=add_objects(a.Item,a.W,a.H,a.Dept,g,a.X,a.Y,0,n,0,0,0!==t.Rotation||0!==t.Slope?"Y":"N","","","",o);g_pog_json[o].ModuleInfo[e].ShelfInfo[_].ItemInfo[i].CompItemObjID=l.id,l.ItemID=a.Item,l.Description=a.Desc,l.HorizFacing=a.BHoriz,l.VertFacing=a.BVert,l.DimUpdate=a.DimUpdate,l.SellingPrice=a.SellingPrice,l.ShelfPrice=a.ShelfPrice,l.PromoPrice=a.PromoPrice,l.DiscountRate=a.DiscountRate,l.PriceChangeDate=a.PriceChangeDate,l.WeeksOfInventory=a.WeeksOfInventory,l.Qty=a.Qty,l.WhStock=a.WhStock,l.StoreStock=a.StoreStock,l.StockIntransit=a.StockIntransit,l.SalesUnit=a.SalesUnit,l.NetSales=a.NetSales,l.GrossProfit=a.GrossProfit,l.CogsAdj=a.CogsAdj,l.RegMovement=a.RegMovement,l.AvgSales=a.AvgSales,l.ItemStatus=a.ItemStatus,l.CDTLvl1=a.CDTLvl1,l.CDTLvl2=a.CDTLvl2,l.CDTLvl3=a.CDTLvl3,l.StoreCnt=a.StoreCnt,l.WeeksOfInventory=a.WeeksOfInventory,l.WeeksCount=a.WeeksCount,l.MovingItem=a.MovingItem,l.Profit=a.Profit,l.TotalMargin=a.TotalMargin,l.Status=a.Status,l.DescSecond=a.DescSecond,l.DFacing=a.BaseD,l.ActualDPP=a.ActualDPP,l.StoreSOH=a.StoreSOH,l.DPPLoc=a.DPPLoc,l.StoreNo=a.StoreNo,l.W=a.W,l.H=a.H,l.D=a.D,l.Color=a.Color,l.Barcode=a.Barcode,l.Desc=a.Desc,l.Brand=a.Brand,l.BrandType=a.BrandType,l.Group=a.Group,l.Dept=a.Dept,l.Class=a.Class,l.SubClass=a.SubClass,l.StdUOM=a.StdUOM,l.SizeDesc=a.SizeDesc,l.Supplier=a.Supplier,l.SupplierName=a.SupplierName,l.LocID=a.LocID,l.ItemDim=(100*a.OW).toFixed(2)+" : "+(100*a.OH).toFixed(2)+" : "+(100*a.OD).toFixed(2),l.OrientationDesc=a.OrientationDesc,l.Orientation=a.Orientation,l.StoreCnt=a.StoreCnt,l.RotationDegree=rotation,l.OW=100*a.OW,l.OH=100*a.OH,l.OD=100*a.OD,l.Shelf=shelfdtl.Shelf,l.Rotation=0,l.ItemSlope=0,l.RotationFlag=0!==rotation||0!==slope?"Y":"N",l.ImageExists="N",l.UnitperCase=a.UnitperCase,l.UnitperTray=a.UnitperTray,l.DfacingUpd=a.DfacingUpd,l.ItmDescChi=a.ItmDescChi,l.ItmDescEng=a.ItmDescEng,l.TotalUnitsCalc=a.BHoriz*a.BVert*a.BaseD,l.PkSiz=a.PkSiz,l.CapFacing=a.CapFacing,l.CapDepth=a.CapDepth,l.CapHorz=a.CapHorz;var r=a.CapFacing*a.CapDepth*a.CapHorz;if(l.Cpct=a.BHoriz*a.BVert*a.BaseD+(isNaN(r)?0:r),l.Brand_Category=a.Brand_Category,l.Uda_item_status=a.Uda_item_status,l.Gobecobrand=a.Gobecobrand,l.Internet=a.Internet,l.GoGreen=a.GoGreen,l.Categ=a.Categ,l.ItemSize=a.ItemSize,l.SplrLbl=a.SplrLbl,l.COO=a.COO,l.EDLP=a.EDLP,l.LoGrp=a.LoGrp,l.SqzPer=(void 0!==a.CrushHoriz?a.CrushHoriz:0)+":"+(void 0!==a.CrushVert?a.CrushVert:0)+":"+(void 0!==a.CrushD?a.CrushD:0),l.InternationalRng=a.InternationalRng,l.NewItem=a.NewItem,l.LiveNewItem=a.LiveNewItem,l.DaysOfSupply=a.DaysOfSupply,l.CapDepthChanged=a.CapDepthChanged,l.MassCrushH=a.MassCrushH,l.MassCrushV=a.MassCrushV,l.MassCrushD=a.MassCrushD,l.position.z=a.Z,l.ItemCondition=a.ItemCondition,l.AUR=a.AUR,l.ItemRanking=a.ItemRanking,l.WeeklySales=a.WeeklySales,l.WeeklyNetMargin=a.WeeklyNetMargin,l.WeeklyQty=a.WeeklyQty,l.NetMarginPercent=a.NetMarginPercent,l.CumulativeNM=a.CumulativeNM,l.TOP80B2=a.TOP80B2,l.ItemBrandC=a.ItemBrandC,l.ItemPOGDept=a.ItemPOGDept,l.ItemRemark=a.ItemRemark,l.RTVStatus=a.RTVStatus,l.Pusher=a.Pusher,l.Divider=a.Divider,l.BackSupport=a.BackSupport,l.CWPerc=a.CWPerc,l.CHPerc=a.CHPerc,l.CDPerc=a.CDPerc,l.OOSPerc=a.OOSPerc,l.InitialItemDesc=a.InitialItemDesc,l.InitialBrand=a.InitialBrand,l.InitialBarcode=a.InitialBarcode,"DIVIDER"==a.Item){var d=g_pog_json[o].ModuleInfo[e].ShelfInfo,c=-1;$.each(d,(function(e,o){o.Shelf==a.ItemID&&"DIVIDER"==o.ObjType&&(c=e)})),g_pog_json[o].ModuleInfo[e].ShelfInfo[c].X=a.X,g_pog_json[o].ModuleInfo[e].ShelfInfo[c].CompShelfDivObjID=l.id}}))}}))}}));var g=get_min_max_xy(g_pog_index).split("###");if("Y"==e){n.rotateY(Math.PI);var l=-parseFloat(g[2])}else l=parseFloat(g[2]);set_camera_z(t,l,parseFloat(g[3]),parseFloat(g[0]),parseFloat(g[1]),g_offset_z,parseFloat(g[4]),parseFloat(g[5]),!1,g_pog_index),g_pog_json[o].CompCamX=l,g_pog_json[o].CompCamY=parseFloat(g[3]),g_pog_json[o].CompCamWidth=parseFloat(g[0]),g_pog_json[o].CompCamHeight=parseFloat(g[1]),logDebug("function : back_side","E")}async function create_compare_pog(e){logDebug("function : create_compare_pog; view_ind : "+e,"S");var o=0,_=g_pog_json[p_pog_index].ModuleInfo;if(g_pog_json[p_pog_index].BaseH>0){var n=parseInt(g_pog_json[p_pog_index].Color.replace("#","0x"),16),t=new THREE.Color(n),i=new THREE.Mesh(new THREE.BoxGeometry(g_pog_json[p_pog_index].BaseW,g_pog_json[p_pog_index].BaseH,.001),new THREE.MeshStandardMaterial({color:t})),a=add_wireframe(i,2);i.position.x=g_pog_json[p_pog_index].BaseX,i.position.y=g_pog_json[p_pog_index].BaseY,i.position.z=g_pog_json[p_pog_index].BaseZ,g_scene_objects[PComViewIndex].scene.children[2].add(i)}for(const e of _){if(void 0===e.ParentModule||null==e.ParentModule){n=parseInt(e.Color.replace("#","0x"),16),t=new THREE.Color(n);if(g_module=new THREE.Mesh(new THREE.BoxGeometry(e.W,e.H,.001),new THREE.MeshStandardMaterial({color:t})),e.VertSpacing>0||e.HorzSpacing>0){var s=add_dots_to_object(width-2*e.NotchW,height,7e-4,e.VertStart,e.VertSpacing,e.HorzStart,e.HorzSpacing,g_module,"MODULE","",o,g_peg_holes_active,p_pog_index);e.NotchW>0&&add_notches("MODULE"+edit_module_index+"_NOTCHES",e.NotchW,e.H,e.NotchStart,e.NotchSpacing,t,"N",e.W,o,s),s.position.x=e.X,s.position.y=e.Y,s.position.z=0,s.uuid=e.Module;a=add_wireframe(s,2);g_module.WFrameID=a,g_scene_objects[PComViewIndex].scene.children[2].add(s)}else{e.NotchW>0&&add_notches("MODULE"+edit_module_index+"_NOTCHES",e.NotchW,e.H,e.NotchStart,e.NotchSpacing,t,"N",e.W,o,g_module),g_module.position.x=e.X,g_module.position.y=e.Y,g_module.position.z=0,g_module.uuid=e.Module;a=add_wireframe(g_module,2);g_module.WFrameID=a,g_scene_objects[PComViewIndex].scene.children[2].add(g_module)}if(e.ShelfInfo.length>0){j=0;for(const _ of e.ShelfInfo){if("BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType){n=parseInt(_.Color.replace("#","0x"),16),t=new THREE.Color(n);if(0!==_.Rotation||0!==_.Slope)new_shelf=new THREE.Mesh(new THREE.BoxGeometry(_.W,_.H,_.D),new THREE.MeshStandardMaterial({color:t})),_.Slope>0?slope=0-_.Slope:slope=-_.Slope,new_shelf.rotateY(_.Rotation*Math.PI/180),0==_.Rotation?new_shelf.rotateX(slope/2*Math.PI/180):new_shelf.rotateX(slope*Math.PI/180),new_shelf.position.set(_.X,_.Y,_.Z);else{new_shelf=new THREE.Mesh(new THREE.BoxGeometry(_.W,_.H,_.D),new THREE.MeshStandardMaterial({color:t}));"TEXTBOX"==_.ObjType?.0021:"PEGBOARD"==_.ObjType?.003:5e-4,new_shelf.position.set(_.X,_.Y,_.Z)}a=add_wireframe(new_shelf,2);new_shelf.WFrameID=a,g_scene_objects[PComViewIndex].scene.children[2].add(new_shelf);var g=0;for(const e of _.ItemInfo){n=parseInt(e.Color.replace("#","0x"),16),t=new THREE.Color(n);if(0!==_.Rotation||0!==_.Slope){new_item=new THREE.Mesh(new THREE.BoxGeometry(e.W,e.H,e.D),new THREE.MeshStandardMaterial({color:t})),g_scene_objects[PComViewIndex].scene.updateMatrixWorld(),new_item.updateMatrixWorld();var l=e.RotationX,r=e.RotationY,d=e.RotationZ,c=new THREE.Vector3(l,r,d).applyMatrix4(new_shelf.matrixWorld);new_item.position.x=c.x,new_item.position.y=c.y,new_item.position.z=c.z,new_item.quaternion.copy(new_shelf.quaternion),new_item.updateMatrix()}else new_item=new THREE.Mesh(new THREE.BoxGeometry(e.W,e.H,e.D),new THREE.MeshStandardMaterial({color:t})),new_item.position.set(e.X,e.Y,e.Z);g_scene_objects[PComViewIndex].scene.children[2].add(new_item);a=add_wireframe(new_item,4);add_item_borders(o,j,g,new_item,e.W,e.H,-1,p_pog_index),g+=1}}j+=1}}}o+=1}var f=get_min_max_xy(g_pog_index).split("###");return set_camera_z(g_scene_objects[PComViewIndex].scene.children[0],parseFloat(f[2]),parseFloat(f[3]),parseFloat(f[0]),parseFloat(f[1]),g_offset_z,parseFloat(f[4]),parseFloat(f[5]),!0,g_pog_index),"LEFT"==e?g_scene_objects[PComViewIndex].scene.children[2].rotateY(95*Math.PI/180):"RIGHT"==e?g_scene_objects[PComViewIndex].scene.children[2].rotateY(275*Math.PI/180):"TOP"==e?(g_scene_objects[PComViewIndex].scene.children[2].rotateX(90*Math.PI/180),g_scene_objects[PComViewIndex].scene.children[0].position.y=0):"BOTTOM"==e?(g_scene_objects[PComViewIndex].scene.children[2].rotateX(270*Math.PI/180),g_scene_objects[PComViewIndex].scene.children[0].position.y=0):"BACK"==e&&(g_scene_objects[PComViewIndex].scene.children[2].rotateY(180*Math.PI/180),g_scene_objects[PComViewIndex].scene.children[0].position.x=-g_scene_objects[PComViewIndex].scene.children[0].position.x),render(g_pog_index),logDebug("function : create_compare_pog","E"),"success"}function select_zoom_init(){logDebug("function : select_zoom_init","S"),select_zoom(g_scene_objects[g_pog_index].scene.children[0],g_pog_index),g_ctrl_select="N",logDebug("function : select_zoom_init","E")}function select_zoom(e,o){logDebug("function : select_zoom","S");var _=s=g=l=0;try{if(g_cutaway_cam_detail=[],0!==g_DragMouseStart.x&&0!==g_DragMouseEnd.x&&"Y"==g_multiselect){if(g_DragMouseStart.x>g_DragMouseEnd.x?(_=g_DragMouseStart.x-g_DragMouseEnd.x,g=g_DragMouseEnd.x+_/2):(_=g_DragMouseEnd.x-g_DragMouseStart.x,g=g_DragMouseStart.x+_/2),g_DragMouseStart.y>g_DragMouseEnd.y?(s=g_DragMouseStart.y-g_DragMouseEnd.y,l=g_DragMouseEnd.y+s/2):(s=g_DragMouseEnd.y-g_DragMouseStart.y,l=g_DragMouseStart.y+s/2),set_camera_z(e,g,l,_,s,0,g,l,!0,g_pog_index),g_manual_zoom_ind="Y",(d={}).x=g,d.y=l,d.width=_,d.height=s,d.offset=0,g_cutaway_cam_detail.push(d),g_intersected){for(var n=0;n<g_intersected.length;n++)g_select_color=g_intersected[n].BorderColour,g_intersected[n].WireframeObj.material.color.setHex(g_select_color),"Y"==g_intersected[n].ImageExists&&"Y"==g_show_live_image&&(g_intersected[n].WireframeObj.material.transparent=!0,g_intersected[n].WireframeObj.material.opacity=.0025);clearInterval(g_myVar),g_select_color=0,render(o)}g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_multiselect="N",g_intersected=[]}else if(g_select_zoom_arr.length>0){var t=maxx=miny=maxy=-1;for(n=0;n<g_select_zoom_arr.length;n++){var i="N",a="N";$.each(g_pog_json[o].ModuleInfo,(function(e,_){if("Y"==i)return!1;if(null==_.ParentModule||"undefined"==_.ParentModule){if(_.MObjID==g_select_zoom_arr[n].id)return t=-1==t?_.X-_.W/2:Math.min(t,_.X-_.W/2),-1==miny?miny=_.Y-_.H/2+g_pog_json[o].BaseH:miny=Math.min(miny,_.Y-_.H/2+g_pog_json[o].BaseH),maxx=Math.max(maxx,_.X+_.W/2),maxy=Math.max(maxy,_.Y+_.H/2+g_pog_json[o].BaseH),i="Y",a="Y",!1;$.each(_.ShelfInfo,(function(e,o){if("Y"==i)return!1;if(void 0!==o&&"NOTCH"!==o.ObjType&&"BASE"!==o.ObjType&&"DIVIDER"!==o.ObjType){if(o.SObjID==g_select_zoom_arr[n].id)return 0!==o.Rotation||0!==o.Slope?(shelf_width=void 0===o.ShelfRotateWidth?o.W:o.ShelfRotateWidth,shelf_height=void 0===o.ShelfRotateHeight?o.W:o.ShelfRotateHeight):(shelf_width=o.W,shelf_height=o.H),t=-1==t?o.X-shelf_width/2:Math.min(t,o.X-shelf_width/2),-1==miny?miny=o.Y-shelf_height/2:miny=Math.min(miny,o.Y-shelf_height/2),maxx=Math.max(maxx,o.X+shelf_width/2),maxy=Math.max(maxy,o.Y+shelf_height/2),i="Y",a="Y",!1;o.ItemInfo.length>0&&$.each(o.ItemInfo,(function(e,_){if(_.ObjID==g_select_zoom_arr[n].id)return 0!==o.Rotation||0!==o.Slope?(item_width=void 0===_.RotationWidth||null==_.RotationWidth||0==_.RotationWidth?_.W:_.RotationWidth,item_height=void 0===_.RotationHeight||null==_.RotationHeight||0==_.RotationHeight?_.H:_.RotationHeight):(item_width=_.W,item_height=_.H),t=-1==t?_.X-item_width/2:Math.min(t,_.X-item_width/2),-1==miny?miny=_.Y-item_height/2:miny=Math.min(miny,_.Y-item_height/2),maxx=Math.max(maxx,_.X+item_width/2),maxy=Math.max(maxy,_.Y+item_height/2),i="Y",a="Y",!1}))}}))}}))}if("Y"==a){if(g_intersected){for(n=0;n<g_intersected.length;n++)g_select_color=g_intersected[n].BorderColour,g_intersected[n].WireframeObj.material.color.setHex(g_select_color),"Y"!=g_intersected[n].ImageExists||"Y"!=g_show_live_image&&"Y"!=g_show_live_image_comp||(g_intersected[n].WireframeObj.material.transparent=!0,g_intersected[n].WireframeObj.material.opacity=.0025);clearInterval(g_myVar),g_select_color=0,render(o)}_=maxx-t;var s=maxy-miny,g=t+_/2,l=miny+s/2;set_camera_z(e,g,l,_,s,.5,g,l,!0,g_pog_index),(d={}).x=g,d.y=l,d.width=_,d.height=s,d.offset=.5,g_cutaway_cam_detail.push(d),g_manual_zoom_ind="Y",g_select_zoom_arr=[],render(o)}}else{if("Y"==g_module_edit_flag){_=g_pog_json[o].ModuleInfo[g_module_index].W,s=g_pog_json[o].ModuleInfo[g_module_index].H,g=g_pog_json[o].ModuleInfo[g_module_index].X,l=g_pog_json[o].ModuleInfo[g_module_index].Y;var r=g_offset_z}else if("Y"==g_shelf_edit_flag){_=g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].W,s=g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].H,g=g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X,l=g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y;r=0}else if("Y"==g_item_edit_flag){_=g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].W,s=g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].H,g=g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].X,l=g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Y;r=0}var d;if(_>0)set_camera_z(e,g,l,_,s,r,g,l,!0,g_pog_index),(d={}).x=g,d.y=l,d.width=_,d.height=s,d.offset=r,g_cutaway_cam_detail.push(d),g_manual_zoom_ind="Y",render(o)}}catch(e){error_handling(e)}logDebug("function : select_zoom","E")}async function last_action(){logDebug("function : last_action","S");try{if(g_undo_final_obj_arr.length-1>=0){var e;g_undo_details=[],g_cut_copy_arr=[],g_cut_support_obj_arr=[];var o=g_undo_final_obj_arr[g_undo_final_obj_arr.length-1].previousAction;e=g_undo_final_obj_arr[g_undo_final_obj_arr.length-1].g_MultiObjects;var _=g_undo_final_obj_arr[g_undo_final_obj_arr.length-1].hasSupportArr;g_clearInfoType=g_undo_final_obj_arr[g_undo_final_obj_arr.length-1].clearInfoType,"Y"==e?(g_delete_details=g_undo_final_obj_arr[g_undo_final_obj_arr.length-1][0],g_cut_copy_arr=g_undo_final_obj_arr[g_undo_final_obj_arr.length-1][1],g_delete_details.multi_delete_shelf_ind=g_undo_final_obj_arr[g_undo_final_obj_arr.length-1].multi_delete_shelf_ind,"Y"==_&&(g_cut_support_obj_arr=g_undo_final_obj_arr[g_undo_final_obj_arr.length-1][2][0])):(g_undo_details=g_undo_final_obj_arr[g_undo_final_obj_arr.length-1][0],g_cut_copy_arr=g_undo_final_obj_arr[g_undo_final_obj_arr.length-1][1],"Y"==_&&(g_cut_support_obj_arr=g_undo_final_obj_arr[g_undo_final_obj_arr.length-1][2][0])),g_undo_final_obj_arr.pop()}return logDebug("function : last_action","E"),o}catch(e){error_handling(e)}}function redo_drag_log(){logDebug("function : redo_drag_log","S"),g_redo_all_obj_arr.actionType=g_undo_final_obj_arr[g_undo_final_obj_arr.length-1].previousAction,g_redo_all_obj_arr.push(g_undo_final_obj_arr[g_undo_final_obj_arr.length-1][0]),g_redo_all_obj_arr.push(g_undo_final_obj_arr[g_undo_final_obj_arr.length-1][1]),g_redo_final_obj_arr.push(g_redo_all_obj_arr),g_undo_final_obj_arr.pop(),g_redo_all_obj_arr=[],logDebug("function : redo_drag_log","E")}function last_redo_action(e){logDebug("function : last_redo_action; actionType : "+e,"S");try{var o;if(g_redo_final_obj_arr.length-1>=0){g_undo_details=[],g_cut_copy_arr=[],g_cut_support_obj_arr=[],g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[];var _=g_redo_final_obj_arr[g_redo_final_obj_arr.length-1].previousAction;o=g_redo_final_obj_arr[g_redo_final_obj_arr.length-1].g_MultiObjects,hasSupportArr=g_redo_final_obj_arr[g_redo_final_obj_arr.length-1].hasSupportArr,g_clearInfoType=g_redo_final_obj_arr[g_redo_final_obj_arr.length-1].clearInfoType,"Y"==o?(g_delete_details=g_redo_final_obj_arr[g_redo_final_obj_arr.length-1][0],"Y"==hasSupportArr&&"undefined"!=typeof hasSupportArr&&(g_cut_support_obj_arr=g_redo_final_obj_arr[g_undo_final_obj_arr.length-1][2][0]),g_delete_details.multi_delete_shelf_ind=g_redo_final_obj_arr[g_redo_final_obj_arr.length-1].multi_delete_shelf_ind,g_cut_copy_arr=g_redo_final_obj_arr[g_redo_final_obj_arr.length-1][1],g_undo_details=g_redo_final_obj_arr[g_redo_final_obj_arr.length-1][0]):(g_cut_copy_arr=g_redo_final_obj_arr[g_redo_final_obj_arr.length-1][1],g_undo_details=g_redo_final_obj_arr[g_redo_final_obj_arr.length-1][0],"Y"==hasSupportArr&&(g_cut_support_obj_arr=g_redo_final_obj_arr[g_undo_final_obj_arr.length-1][2][0]),g_delete_details.multi_delete_shelf_ind="N"),g_redo_final_obj_arr.pop()}return logDebug("function : last_redo_action","E"),_}catch(e){error_handling(e)}}async function update_undo_redo_objID(e){logDebug("function : update_undo_redo_objID","S");try{if(g_redo_final_obj_arr.length>0){for(var o=g_redo_final_obj_arr.length-1;o>=0;o--)for(var _=g_redo_final_obj_arr[o][0].length-1;_>=0;_--)$.each(e[p_pog_index].ModuleInfo,(function(e,n){void 0!==n.ParentModule&&null!=n.ParentModule||$.each(n.ShelfInfo,(function(e,n){"BASE"!==n.ObjType&&"NOTCH"!==n.ObjType&&"DIVIDER"!==n.ObjType&&"TEXTBOX"!==n.ObjType&&$.each(n.ItemInfo,(function(e,n){g_redo_final_obj_arr[o][0][_].ObjID==n.OldObjID&&(g_redo_final_obj_arr[o][0][_].ObjID=n.ObjID)}))}))}));for(o=g_redo_final_obj_arr.length-1;o>=0;o--)for(_=g_redo_final_obj_arr[o][1].length-1;_>=0;_--){var n=g_redo_final_obj_arr[o][1][_].ItemInfo;$.each(n,(function(n,t){$.each(e[p_pog_index].ModuleInfo,(function(e,n){void 0!==n.ParentModule&&null!=n.ParentModule||$.each(n.ShelfInfo,(function(e,n){"BASE"!==n.ObjType&&"NOTCH"!==n.ObjType&&"DIVIDER"!==n.ObjType&&"TEXTBOX"!==n.ObjType&&$.each(n.ItemInfo,(function(e,n){t.ObjID==n.OldObjID&&g_redo_final_obj_arr[o][1].length>0&&(g_redo_final_obj_arr[o][1][_].ObjID=n.ObjID)}))}))}))}))}}if(g_undo_final_obj_arr.length>0){var t=g_undo_final_obj_arr;g_undo_final_obj_arr;for(u=0;u<=t.length-1;u++)$.each(e[p_pog_index].ModuleInfo,(function(e,o){void 0!==o.ParentModule&&null!=o.ParentModule||$.each(o.ShelfInfo,(function(e,o){"BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType&&$.each(o.ItemInfo,(function(e,o){t[u][1].length>0&&$.each(t[u][1],(function(e,_){t[u][1][e].ObjID==o.OldObjID&&(void 0!==g_undo_final_obj_arr[u][1][e]&&(g_undo_final_obj_arr[u][1][e].ObjID=o.ObjID),void 0!==g_undo_final_obj_arr[u][0][e]&&(g_undo_final_obj_arr[u][0][e].ObjID=o.ObjID))}))}))}))}))}if(g_redo_final_obj_arr.length>0){var i=g_redo_final_obj_arr;g_redo_final_obj_arr;for(u=0;u<=i.length-1;u++)$.each(e[p_pog_index].ModuleInfo,(function(e,o){void 0!==o.ParentModule&&null!=o.ParentModule||$.each(o.ShelfInfo,(function(e,o){"BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType&&$.each(o.ItemInfo,(function(e,o){i[u][1].length>0&&i[u][1][0].ObjID==o.OldObjID&&(g_redo_final_obj_arr[u][1][0].ObjID=o.ObjID,g_redo_final_obj_arr[u][0][0].ObjID=o.ObjID)}))}))}))}}catch(e){error_handling(e)}logDebug("function : update_undo_redo_objID","E")}function area_zoom(){logDebug("function : area_zoom","S"),"N"==g_area_zoom_ind?($(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),$(".area_zoom").addClass("active"),g_area_zoom_ind="Y",g_select_zoom_arr=[],g_mselect_drag="N",g_delete_details=[]):($(".area_zoom").removeClass("active"),g_area_zoom_ind="N"),logDebug("function : area_zoom","E")}async function deleted_items_log(e,o,_){logDebug("function : deleted_items_log; deleted_item : "+e+"; actionType : "+o,"S");try{var n,t=[],i=[],a=g_pog_json[_].POGCode,s=0;for(const o of e){for(const e of g_pog_json[_].ModuleInfo){if(null==e.ParentModule)for(const _ of e.ShelfInfo){if("BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType&&"TEXTBOX"!==_.ObjType)for(const e of _.ItemInfo)if(e.ItemID==o&&(n=!0,i.push(nvl(e.DaysOfSupply))),n)break;if(n)break}if(n)break}s++,n=!1}var g=apex.region("draggable_table").widget().interactiveGrid("getViews","grid").model;for(const n of e)if(void 0!==n&&""!==n){var l,r=null;if(void 0!==g&&(r=g.getRecord(n)),"D"==o)(l=get_similar_items(n,"I",_,"Y"==g_all_pog_flag?"N":"Y")).length>0?t.push("N"):t.push("Y"),"R"!=o&&"D"!=o||null!=r&&(0==l.length?($("#draggable_table [data-id="+n+"] td").css("color","red"),g.setValue(r,"EXISTING","R")):($("#draggable_table [data-id="+n+"] td").css("color","green"),g.setValue(r,"EXISTING","Y")));else t.push("N"),null!=r&&g.setValue(r,"EXISTING","Y"),$("#draggable_table [data-id="+n+"] td").css("color","green")}var d=[];for(const o of e){var c=0;for(const e of g_pog_json[_].ModuleInfo)if(null==e.ParentModule)for(const _ of e.ShelfInfo)if("BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType&&"TEXTBOX"!==_.ObjType)for(const e of _.ItemInfo)e.ItemID==o&&(c=Math.max(c,e.BaseD));s++,d.push(c)}a="Y"==g_all_pog_flag?"":g_pog_json[_].POGCode;s=0;pogJson=JSON.stringify([g_pog_json[_]]);for(s=0;s<e.length;s++);if(e.length>0)return new Promise((function(_,n){apex.server.process("UPDATE_ITEM_LIST",{f01:e,f02:t,f03:d,x02:o,x03:a,p_clob_01:pogJson},{dataType:"text",success:function(e){console.log($.trim(e)),""!=$.trim(e)&&_($.trim(e))}}).done((function(e){g_deletedItems=[],logDebug("function : deleted_items_log","E"),_("success")}))}))}catch(e){error_handling(e)}}function open_draft(){logDebug("function : open_draft","S"),$(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),$(".open_draft").addClass("active"),sessionStorage.removeItem("g_color_arr"),sessionStorage.removeItem("g_highlightArr"),"Collapse"==$(".a-Splitter-thumb").attr("aria-label")&&$(".a-Splitter-thumb").click(),g_color_arr=[],g_highlightArr=[],apex.event.trigger("#P25_POG_TEMPLATE","apexrefresh"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&"Y"==g_pog_edited_ind?confirm(get_message("POGCR_CHANGE_REVERT_WARN"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){openCustomDialog("OPEN_DRAFT",$v("P25_OPEN_DRAFT_URL"),"P25_DRAFT_TRIGGER_ELEMENT")})):openCustomDialog("OPEN_DRAFT",$v("P25_OPEN_DRAFT_URL"),"P25_DRAFT_TRIGGER_ELEMENT"),g_dblclick_opened="Y",logDebug("function : open_draft","E")}function open_save_draft(){if(logDebug("function : open_save_draft","S"),g_pog_json.length>0){if(console.log("templete opened"),"Y"==g_all_pog_flag)$s("P25_SAVE_OPTION","SAVE"),$s("P25_POG_DESCRIPTION",""),$s("P25_POG_DESCRIPTION",""!==g_pog_json[g_pog_index].Desc7?g_pog_json[g_pog_index].Desc7:g_pog_json[g_pog_index].POGCode),$("#P25_POG_DESCRIPTION_CONTAINER").hide(),$("#P25_SAVE_OPTION_CONTAINER").addClass("apex_disabled");else{var e=g_pog_json[g_pog_index]?.Desc7,o=void 0!==e&&""!==e?e:g_pog_json[g_pog_index]?.POGCode;if("undefined"==o||""==o)for(var _ of g_seqArr){if(_.index==g_pog_index){get_draft_Desc(_.seqId,_.pogCode,_.pogVersion);break}g_draftPogInd="D"}else g_draftPogInd="D";$s("P25_POG_DESCRIPTION",void 0!==g_pog_json[g_pog_index]?.Desc7&&""!==g_pog_json[g_pog_index].Desc7?g_pog_json[g_pog_index].Desc7:g_pog_json[g_pog_index]?.POGCode),$("#P25_SAVE_OPTION_CONTAINER").removeClass("apex_disabled"),$("#P25_POG_DESCRIPTION_CONTAINER").show(),$s("P25_DRAFT_SAVE_TYPE","S")}openInlineDialog("open_save_draft",30,35)}logDebug("function : open_save_draft","E")}function open_template(){logDebug("function : open_template","S"),$s("P25_DRAFT_LIST",""),$s("P25_POG_DESCRIPTION",""),$s("P25_EXISTING_DRAFT_VER",""),$(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),$(".open_template").addClass("active"),$s("P25_PT_DIVISION",""),$s("P25_PT_DEPT",""),$s("P25_PT_TEMPLATE",""),$s("P25_PT_SUBDEPT",""),$s("P25_PT_FIXTURE_GENERATION",""),$s("P25_PT_FIXTURE_FAMILY",""),$s("P25_PT_FIXTURE_TYPE",""),$s("P25_PT_FIXTURE_CODE",""),"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&"Y"==g_pog_edited_ind?confirm(get_message("POGCR_CHANGE_REVERT_WARN"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){g_module_obj_array=[],apex.event.trigger("#P25_POG_TEMPLATE","apexrefresh"),openInlineDialog("pog_template_list",61,61),g_dblclick_opened="Y"})):(g_module_obj_array=[],apex.event.trigger("#P25_POG_TEMPLATE","apexrefresh"),openInlineDialog("pog_template_list",61,61),g_dblclick_opened="Y"),logDebug("function : open_template","E")}function open_pdf(){logDebug("function : open_pdf","S"),"N"==g_upload_file_flag&&apex.server.process("POG_PDF_CHECK",{x01:g_pog_json[g_pog_index].POGCode,x02:g_pog_json[g_pog_index].Version},{dataType:"text",success:function(e){if("Y"==$.trim(e))confirm(get_message("PDF_OVERRIDE_WARN"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){g_dblclick_opened="Y",$("#P25_SAVE_WITH_PDF_CONTAINER").hide(),$("#SAVE_POG").hide(),$("#SAVE_PDF").show(),$s("P25_SAVE_WITH_PDF","Y");let e=$v("P25_PDF_TEMPLATE"),o=e.split("-")[10];e&&"Y"==o?($s("P25_DEFAULT_LIVE_VERSION","Y"),$s("P25_PREV_POG_CODE",g_pog_json[g_pog_index].POGCode),$("#P25_DEFAULT_LIVE_VERSION_CONTAINER").show()):($s("P25_DEFAULT_LIVE_VERSION","Y"),$("#P25_DEFAULT_LIVE_VERSION_CONTAINER").hide()),$("#P25_POG_PDF_REMINDER_MSG_CONTAINER").show(),$("#P25_PDF_TEMPLATE_CONTAINER").show(),$("#ui-id-14").text("Generate PDF");var _=check_cookie_name("PDF_TEMPLATE",$v("P25_BU_ID"));""!==_&&$s("P25_PDF_TEMPLATE",_),openInlineDialog("open_pdf_modal",25,25)}));else{g_dblclick_opened="Y",$("#P25_SAVE_WITH_PDF_CONTAINER").hide(),$("#SAVE_POG").hide(),$("#SAVE_PDF").show(),$s("P25_SAVE_WITH_PDF","Y");let e=$v("P25_PDF_TEMPLATE"),_=e.split("-")[10];e&&"Y"==_?($s("P25_DEFAULT_LIVE_VERSION","Y"),$s("P25_PREV_POG_CODE",g_pog_json[g_pog_index].POGCode),$("#P25_DEFAULT_LIVE_VERSION_CONTAINER").show()):($s("P25_DEFAULT_LIVE_VERSION","Y"),$("#P25_DEFAULT_LIVE_VERSION_CONTAINER").hide()),$("#P25_POG_PDF_REMINDER_MSG_CONTAINER").show(),$("#P25_PDF_TEMPLATE_CONTAINER").show(),$("#ui-id-14").text("Generate PDF");var o=check_cookie_name("PDF_TEMPLATE",$v("P25_BU_ID"));""!==o&&$s("P25_PDF_TEMPLATE",o),openInlineDialog("open_pdf_modal",25,25)}logDebug("function : open_pdf","E")},loadingIndicatorPosition:"page"})}function open_product(e){logDebug("function : open_product; type : "+e,"S"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&("N"==g_all_pog_flag?($s("P25_PAR_POG_CODE",`${g_pog_json[g_pog_index].POGCode}`),$s("P25_OPEN_POG_CODE",`${g_pog_json[g_pog_index].POGCode}`),$s("P25_OPEN_POG_VERSION",`${g_pog_json[g_pog_index].Version}`)):($s("P25_OPEN_POG_CODE",""),$s("P25_OPEN_POG_VERSION","")));if($s("P25_USED_ITEM","R"),"Collapse"==$(".a-Splitter-thumb").attr("aria-label"))if("OPEN_PAR"!==e)if("Y"==g_open_productlist)g_open_productlist="N",g_show_plano_rate="N",$(".a-Splitter-thumb").click();else{if($("#par_region").hide(),$("#draggable_table").show(),g_open_productlist="Y",g_show_plano_rate="N",$("#wpdSplitter_splitter_second").css("overflow","hidden"),"Y"==$v("P25_POGCR_ENBL_PRODUCT_SEQ")){let e=apex.region("draggable_table");e.widget().interactiveGrid("getActions").set("edit",!0);let o=e.widget().interactiveGrid("getViews","grid").model;$(".is-readonly").prop("disabled",!0);let _=1;o.forEach((function(e){o.setValue(e,"SEQ_NUMBER",_++)})),$(".is-readonly").prop("disabled",!1),$("#draggable_table tr").each((function(){let e=$(this).attr("data-id");e&&$(`tr[data-id='${e}'] td.is-changed`).removeClass("is-changed")}))}region.widget().interactiveGrid("getActions").set("edit",!1),apex.region("draggable_table").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("draggable_table").widget().interactiveGrid("getViews").grid.curInst._refreshGrid()}else"Y"==g_show_plano_rate?(g_open_productlist="N",g_show_plano_rate="N",$(".a-Splitter-thumb").click()):(g_open_productlist="N",g_show_plano_rate="Y",$("#draggable_table").hide(),$("#par_region").show(),$("#wpdSplitter_splitter_second").css("scrollbar-width","thin").css("overflow","auto"));else{if("OPEN_PAR"!==e){if(g_open_productlist="Y",g_show_plano_rate="N","Y"==$v("P25_POGCR_ENBL_PRODUCT_SEQ")){let e=apex.region("draggable_table").widget().interactiveGrid("getViews","grid").model;$(".is-readonly").prop("disabled",!0);let o=1;e.forEach((function(_){if(e.allowEdit(_))try{e.setValue(_,"SEQ_NUMBER",o++)}catch(e){console.warn("Cannot set value for this record:",_,e)}})),$(".is-readonly").prop("disabled",!1),$("#draggable_table tr").each((function(){let e=$(this).attr("data-id");e&&$(`tr[data-id='${e}'] td.is-changed`).removeClass("is-changed")}))}}else g_show_plano_rate="Y",g_open_productlist="N",apex.region("asp_curr_chart").refresh(),apex.region("asp_prev_chart").refresh(),apex.region("csp_curr_chart").refresh(),apex.region("csp_prev_chart").refresh(),apex.region("pas_curr_chart").refresh();$(".a-Splitter-thumb").click()}"OPEN_PAR"!==e&&set_grid_background_color()}async function save_pog(){if(logDebug("function : save_pog","S"),"Y"==g_upload_file_flag?($s("P25_SAVE_WITH_PDF","Y"),$("#P25_SAVE_WITH_PDF").addClass("apex_disabled")):($s("P25_SAVE_WITH_PDF","N"),$("#P25_SAVE_WITH_PDF").removeClass("apex_disabled")),"undefined"!=typeof g_pog_json&&g_pog_json.length>0){var e="N",o="",_="";for(const _ of g_pog_json)$.each(_.ModuleInfo,(function(_,n){if((void 0===n.ParentModule||null==n.ParentModule)&&n.Carpark.length>0&&_==g_pog_index)for(obj of(e="Y",n.Carpark))o=o+(""!==o?", ":"")+obj.Shelf}));if("N"==e&&(_=await check_caprpark_inpog()),""!==_||""!==o)confirm(get_message("POGCR_CARPARK_ITEM_WARN",_+(""!==_?", ":"")+o),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){{$("#SAVE_POG").show(),$("#SAVE_PDF").hide(),$("#P25_SAVE_WITH_PDF_CONTAINER").show(),$s("P25_PREV_POG_CODE",g_pog_json[g_pog_index].POGCode),$s("P25_SAVE_WITH_PDF",$v("P25_POG_SAVE_WITH_WTOT_PDF")),$("#ui-id-11").text("Save POG"),$("#P25_PDF_TEMPLATE_CONTAINER").hide(),$("#P25_POG_PDF_REMINDER_MSG_CONTAINER").hide();var e=check_cookie_name("PDF_TEMPLATE",$v("P25_BU_ID"));""!==e&&$s("P25_PDF_TEMPLATE",e);let o=$v("P25_PDF_TEMPLATE"),_=o.split("-")[10];o&&"Y"==_&&"Y"==$v("P25_SAVE_WITH_PDF")?($s("P25_DEFAULT_LIVE_VERSION","Y"),$("#P25_DEFAULT_LIVE_VERSION_CONTAINER").show()):($s("P25_DEFAULT_LIVE_VERSION","Y"),$("#P25_DEFAULT_LIVE_VERSION_CONTAINER").hide(),$("#P25_PREV_PDF_POG_VERSION_CONTAINER").hide()),openInlineDialog("open_pdf_modal",25,25)}}));else{$("#SAVE_POG").show(),$("#SAVE_PDF").hide(),$("#P25_SAVE_WITH_PDF_CONTAINER").show(),$s("P25_PREV_POG_CODE",g_pog_json[g_pog_index].POGCode),$s("P25_SAVE_WITH_PDF",$v("P25_POG_SAVE_WITH_WTOT_PDF")),$("#P25_PDF_TEMPLATE_CONTAINER").hide(),$("#P25_POG_PDF_REMINDER_MSG_CONTAINER").hide();var n=check_cookie_name("PDF_TEMPLATE",$v("P25_BU_ID"));""!==n&&$s("P25_PDF_TEMPLATE",n);let e=$v("P25_PDF_TEMPLATE"),o=e.split("-")[10];e&&"Y"==o&&"Y"==$v("P25_SAVE_WITH_PDF")?($s("P25_DEFAULT_LIVE_VERSION","Y"),$("#P25_DEFAULT_LIVE_VERSION_CONTAINER").show()):($s("P25_DEFAULT_LIVE_VERSION","Y"),$("#P25_DEFAULT_LIVE_VERSION_CONTAINER").hide(),$("#P25_PREV_PDF_POG_VERSION_CONTAINER").hide()),openInlineDialog("open_pdf_modal",25,25)}}logDebug("function : save_pog","E")}function open_3d_popup(){logDebug("function : open_3d_popup","S"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&""!==g_pog_index&&(POG_json=JSON.stringify([g_pog_json[g_pog_index]]),apex.server.process("3DVIEW_JSON_COLLECTION",{x01:g_pog_json[g_pog_index].POGCode,x02:g_show_live_image,p_clob_01:POG_json},{dataType:"text",async:!0,success:function(e){if(""!=$.trim(e))raise_error(e);else{try{sessionStorage.setItem("g_ItemImages",JSON.stringify(g_ItemImages)),sessionStorage.setItem("IndexedDB_ind","N")}catch{add_img_indexeddb(g_ItemImages),sessionStorage.setItem("IndexedDB_ind","Y")}sessionStorage.setItem("g_chest_as_pegboard",g_chest_as_pegboard),sessionStorage.setItem("g_show_live_image",g_show_live_image),apex.server.process("PREPARE_MODAL_URL",{x01:34,x04:"P25_3D_VIEW_TRIGGER_ELEMENT"},{dataType:"text",async:!0,success:function(e){""!=$.trim(e)&&(logDebug("function : open_3d_popup","E"),apex.navigation.redirect($.trim(e)))},loadingIndicatorPosition:"page"})}},loadingIndicatorPosition:"page"})),logDebug("function : open_3d_popup","E")}async function fill_undo_detail_arr(e,o,_,n,t,i,a,s,g,l,r,d,c,f,I,p,l,r,d){logDebug("function : fill_undo_detail_arr; objId : "+e+"; moduleIndex : "+o+"; shelfIndex : "+_+"; itemIndex : "+n+"; objType : "+t+"; ItemCode : "+i+"; ModuleObjID : "+a+"; ShelfObjID : "+s+"; ItemID : "+g+"; XAxis : "+l+"; YAxis : "+r+"; ZAxis : "+d+"; i_shelf_object_type : "+c+"; NewModIndex : "+f+"; NewShelfIndex : "+I+"; NewItemIndex : "+p+"; XAxis : "+l+"; YAxis : "+r+"; ZAxis : "+d,"S");try{var h,u={};h="DIVIDER"==i?"Y":"N",u.ObjID=e,u.MIndex=o,u.SIndex=_,u.IIndex=n,u.ObjType=t,u.IsDivider=h,u.Object="ITEM",u.MObjID=a,u.SObjID=s,u.ItemID=g,u.XAxis=l,u.YAxis=r,u.ZAxis=d,u.NewModIndex=f,u.NewShelfIndex=I,u.NewItemIndex=p,u.Item=i,u.ShelfObjType=c,g_undo_details.push(u)}catch(e){error_handling(e)}logDebug("function : fill_undo_detail_arr","E")}function undo_clear_pog_info(e){logDebug("function : undo_clear_pog_info","S");try{var o,_={};if(o="REDO"==g_undoRedoAction?"U":"R",""!==g_undo_details[0].OldPOGCode&&void 0!==g_undo_details[0].OldPOGCode){_.OldPOGCode=g_pog_json[e].POGCode,_.OldPOGName=g_pog_json[e].Name,_.OldPOGDivision=g_pog_json[e].Division,_.OldPOGDept=g_pog_json[e].Dept,_.OldPOGSubDept=g_pog_json[e].SubDept,_.OldEffStartDate=g_pog_json[e].EffStartDate,g_pog_json[e].POGCode=g_undo_details[0].OldPOGCode,g_pog_json[e].Name=g_undo_details[0].OldPOGName,g_pog_json[e].Division=g_undo_details[0].OldPOGDivision,g_pog_json[e].Dept=g_undo_details[0].OldPOGDept,g_pog_json[e].SubDept=g_undo_details[0].OldPOGSubDept,g_pog_json[e].EffStartDate=g_undo_details[0].OldEffStartDate,$s("P25_POG_DIVISION","");var n=g_pog_json[e].ModuleInfo;if($.each(n,(function(o,_){void 0!==_.ParentModule&&null!=_.ParentModule||(g_pog_json[e].ModuleInfo[o].SubDept=g_pog_json[e].ModuleInfo[o].OldPOGModuleSubDept,g_pog_json[e].ModuleInfo[o].OldPOGModuleSubDept="")})),g_undo_details=[],g_undo_details.push(_),"U"==o?(g_delete_details.multi_delete_shelf_ind="N",g_undo_all_obj_arr=[],g_undo_all_obj_arr.push(g_undo_details),g_undo_all_obj_arr.push(g_cut_copy_arr),g_undo_all_obj_arr.previousAction="CLEAR_POG_ATT",g_undo_all_obj_arr.clearInfoType="Y",g_cut_support_obj_arr.length>0?g_undo_all_obj_arr.hasSupportArr="Y":g_undo_all_obj_arr.hasSupportArr="N",g_undo_all_obj_arr.g_MultiObjects="N",g_undo_all_obj_arr.multi_delete_shelf_ind="N",g_undo_final_obj_arr.push(g_undo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]):(g_delete_details.multi_delete_shelf_ind="N",g_redo_all_obj_arr=[],g_redo_all_obj_arr.push(g_undo_details),g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.previousAction="CLEAR_POG_ATT",g_redo_all_obj_arr.clearInfoType="Y",g_cut_support_obj_arr.length>0?g_redo_all_obj_arr.hasSupportArr="Y":g_redo_all_obj_arr.hasSupportArr="N",g_redo_all_obj_arr.g_MultiObjects="N",g_redo_all_obj_arr.multi_delete_shelf_ind="N",g_redo_final_obj_arr.push(g_redo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]),"REDO"==action)last_redo_action();else last_action();var t=0;[].push(g_undo_details);for(const d of g_delete_details){if("ITEM"==d.Object){var i;$.each(g_pog_json[e].ModuleInfo,(function(e,o){o.MObjID==d.MObjID&&(g_module_index=e)})),$.each(g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo,(function(e,o){o.SObjID==d.SObjID&&(g_shelf_index=e)}));for(const c of g_cut_copy_arr)d.ObjID==c.ObjID&&(i=c);g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.push(i);var a=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X-g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].W/2,s=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y;async function g(){await context_create_items(i,g_module_index,g_shelf_index,g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.length-1,a,"N",s,g_camera,"Y",e)}g(),g_cut_copy_arr.push(JSON.parse(JSON.stringify(g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[d.IIndex])));var l=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[d.IIndex].ObjID;async function r(){await fill_undo_detail_arr(l,g_module_index,g_shelf_index,d.IIndex,g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType,d.Item,g_pog_json[e].ModuleInfo[g_module_index].MObjID,g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].SObjID,d.Item,"","","","SHELF")}r()}t++}g_delete_details.multi_delete_shelf_ind="N",g_redo_all_obj_arr=[],g_redo_all_obj_arr.push(g_undo_details),g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.hasSupportArr="N",g_redo_all_obj_arr.previousAction="CREATE_ITEM",g_redo_all_obj_arr.clearPog="Y",g_redo_all_obj_arr.g_MultiObjects=t>1?"Y":"N",g_redo_all_obj_arr.multi_delete_shelf_ind="N",g_redo_final_obj_arr.push(g_redo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]}}catch{error_handling(err)}logDebug("function : undo_clear_pog_info","E")}function save_common_color(e,o){logDebug("function : save_common_color; new_color : "+e,"S");try{var _=parseInt(e.replace("#","0x"),16),n=new THREE.Color(_);if(undoObjectsInfo=[],g_allUndoObjectsInfo=[],g_delete_details.length>0){var t="Y";for(const e of g_delete_details){for(i of(e.MIndex,e.SIndex,g_allUndoObjectsInfo))t=i.moduleIndex==e.MIndex&&i.shelfIndex==e.SIndex?"N":"Y";if("Y"==t)if("SHELF"==e.Object){var a=JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].SObjID)),s=JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex]));undoObjectsInfo=[],undoObjectsInfo.push(s),undoObjectsInfo.moduleIndex=e.MIndex,undoObjectsInfo.module=g_pog_json[o].ModuleInfo[e.MIndex].Module,undoObjectsInfo.moduleObjectID=g_pog_json[o].ModuleInfo[e.MIndex].MObjID,undoObjectsInfo.shelfIndex=e.SIndex,undoObjectsInfo.actionType="ITEM_DELETE",undoObjectsInfo.startCanvas=g_start_canvas,undoObjectsInfo.objectID=a,undoObjectsInfo.g_deletedItems=g_deletedItems,g_allUndoObjectsInfo.push(undoObjectsInfo)}else if("ITEM"==e.Object){undoObjectsInfo=[];a=JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].SObjID)),s=JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex]));undoObjectsInfo.push(s),undoObjectsInfo.moduleIndex=e.MIndex,undoObjectsInfo.module=g_pog_json[o].ModuleInfo[e.MIndex].Module,undoObjectsInfo.moduleObjectID=g_pog_json[o].ModuleInfo[e.MIndex].MObjID,undoObjectsInfo.shelfIndex=e.SIndex,undoObjectsInfo.actionType="ITEM_DELETE",undoObjectsInfo.startCanvas=g_start_canvas,undoObjectsInfo.objectID=a,undoObjectsInfo.g_deletedItems=g_deletedItems,g_allUndoObjectsInfo.push(undoObjectsInfo)}}}if(g_delete_details.length>0)for(const _ of g_delete_details)"SHELF"==_.Object?(g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].Color=e,selectedObject=g_scene_objects[o].scene.children[2].getObjectById(g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].SObjID),"undefined"!=typeof selectedObject&&(selectedObject.material.color=n)):"ITEM"==_.Object&&(g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[_.IIndex].Color=e,g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[_.IIndex].ShowColorBackup=e,selectedObject=g_scene_objects[o].scene.children[2].getObjectById(g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[_.IIndex].ObjID),"undefined"!=typeof selectedObject&&"N"==selectedObject.ImageExists&&(selectedObject.material.color=n));else{undoObjectsInfo=[];a=JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].SObjID)),s=JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index]));undoObjectsInfo.push(s),undoObjectsInfo.moduleIndex=g_module_index,undoObjectsInfo.module=g_pog_json[o].ModuleInfo[g_module_index].Module,undoObjectsInfo.moduleObjectID=g_pog_json[o].ModuleInfo[g_module_index].MObjID,undoObjectsInfo.shelfIndex=g_shelf_index,undoObjectsInfo.actionType="ITEM_DELETE",undoObjectsInfo.startCanvas=g_start_canvas,undoObjectsInfo.objectID=a,undoObjectsInfo.g_deletedItems=g_deletedItems,g_allUndoObjectsInfo.push(undoObjectsInfo),g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Color=e,g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].ShowColorBackup=e,selectedObject=g_scene_objects[o].scene.children[2].getObjectById(g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].ObjID),"undefined"!=typeof selectedObject&&"N"==selectedObject.ImageExists&&(selectedObject.material.color=n)}logFinalUndoObjectsInfo("ITEM_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","Y"),g_allUndoObjectsInfo=[]}catch(e){error_handling(e)}g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],render(o),g_dblclick_opened="N",g_mselect_drag="N",closeInlineDialog("EDIT_COLOR"),logDebug("function : save_common_color","E")}async function two_pog_diff_checker(e,o,_="N"){logDebug("function : two_pog_diff_checker","S");await reset_colors("O",e),await ShowColorBackup(e);var n=[],t=[],i=[],a=[],s=[],g=0,l=["SHELF","PALLET","HANGINGBAR","PEGBOARD","CHEST"];g_world=g_scene_objects[e].scene.children[2],await recreate_image_items("N",$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_NOTCH_HEAD"),e,"N","",g_hide_show_dos_label),"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&void 0!==g_pog_json[o].ModuleInfo&&($.each(g_pog_json[e].ModuleInfo,(function(e,_){var i="N";$.each(g_pog_json[o].ModuleInfo,(function(e,o){if(o.Module==_.Module){i="Y",o.ModuleFound="Y";var n=_.ShelfInfo,a=o.ShelfInfo;$.each(n,(function(e,o){if(-1!==l.indexOf(o.ObjType)){var _="N";$.each(a,(function(e,n){-1!==l.indexOf(n.ObjType)&&o.Shelf==n.Shelf&&(_="Y")})),"N"==_&&t.push(o.Shelf)}}))}})),"N"==i&&n.push(_.Module)})),$.each(g_pog_json[o].ModuleInfo,(function(o,_){$.each(_.ShelfInfo,(function(o,_){-1!==l.indexOf(_.ObjType)&&$.each(_.ItemInfo,(function(o,_){var n="N";$.each(g_pog_json[e].ModuleInfo,(function(e,o){$.each(o.ShelfInfo,(function(e,o){-1!==l.indexOf(o.ObjType)&&$.each(o.ItemInfo,(function(e,o){_.ItemID==o.ItemID&&(n="Y")}))}))})),"N"==n&&i.push(_.ItemID)}))}))})),$.each(g_pog_json[e].ModuleInfo,(function(e,_){$.each(_.ShelfInfo,(function(e,_){-1!==l.indexOf(_.ObjType)&&$.each(_.ItemInfo,(function(e,_){var n="N";$.each(g_pog_json[o].ModuleInfo,(function(e,o){$.each(o.ShelfInfo,(function(e,o){-1!==l.indexOf(o.ObjType)&&$.each(o.ItemInfo,(function(e,o){_.ItemID==o.ItemID&&(n="Y")}))}))})),"N"==n&&a.push(_.ItemID)}))}))})),"N"==_&&($.each(g_pog_json[o].ModuleInfo,(function(o,_){$.each(_.ShelfInfo,(function(o,n){-1!==l.indexOf(n.ObjType)&&$.each(n.ItemInfo,(function(o,t){$.each(g_pog_json[e].ModuleInfo,(function(e,t){$.each(t.ShelfInfo,(function(e,i){$.each(i.ItemInfo,(function(e,a){_.Module==t.Module&&n.Shelf==i.Shelf&&(void 0!==i.ItemInfo[o]?n.ItemInfo[o].ItemID==i.ItemInfo[o].ItemID?"Y":(s[g]={},s[g].Module=t.Module,s[g].Shelf=i.Shelf,s[g].ItemID=i.ItemInfo[o].ItemID,g++):(s[g]={},s[g].Module=_.Module,s[g].Shelf=n.Shelf,s[g].ItemID=n.ItemInfo[o].ItemID,g++))}))}))}))}))}))})),$.each(g_pog_json[e].ModuleInfo,(function(e,_){$.each(_.ShelfInfo,(function(e,n){-1!==l.indexOf(n.ObjType)&&$.each(n.ItemInfo,(function(e,t){$.each(g_pog_json[o].ModuleInfo,(function(o,t){$.each(t.ShelfInfo,(function(o,i){$.each(i.ItemInfo,(function(o,a){_.Module==t.Module&&n.Shelf==i.Shelf&&(void 0!==i.ItemInfo[e]?n.ItemInfo[e].ItemID==i.ItemInfo[e].ItemID?"Y":(s[g]={},s[g].Module=t.Module,s[g].Shelf=i.Shelf,s[g].ItemID=i.ItemInfo[e].ItemID,g++):(s[g]={},s[g].Module=_.Module,s[g].Shelf=n.Shelf,s[g].ItemID=n.ItemInfo[e].ItemID,g++))}))}))}))}))}))}))),$.each(g_pog_json[o].ModuleInfo,(function(e,_){$.each(_.ShelfInfo,(function(_,n){-1!==l.indexOf(n.ObjType)&&$.each(n.ItemInfo,(function(n,t){var a=g_scene_objects[o].scene.children[2].getObjectById(t.ObjID);-1!==i.indexOf(t.ItemID)?("N"==g_show_live_image&&a.material.color.setHex(16737894),g_pog_json[o].ModuleInfo[e].ShelfInfo[_].ItemInfo[n].Color="0xff6666"):("N"==g_show_live_image&&a.material.color.setHex(16777215),g_pog_json[o].ModuleInfo[e].ShelfInfo[_].ItemInfo[n].Color="0xFFFFFF")}))}))})),render(o),$.each(g_pog_json[e].ModuleInfo,(function(o,n){$.each(n.ShelfInfo,(function(i,g){-1!==l.indexOf(g.ObjType)&&$.each(g.ItemInfo,(function(l,r){var d=!1;for(let e of s)if(e.ItemID==r.ItemID&&e.Shelf==g.Shelf&&e.Module==n.Module){d=!0;break}if(!d&&-1===t.indexOf(g.Shelf)||"N"!=_){c=g_scene_objects[e].scene.children[2].getObjectById(r.ObjID);"N"==g_show_live_image&&c.material.color.setHex(16777215),g_pog_json[e].ModuleInfo[o].ShelfInfo[i].ItemInfo[l].Color="0xFFFFFF"}else{var c=g_scene_objects[e].scene.children[2].getObjectById(r.ObjID);"N"==g_show_live_image&&c.material.color.setHex(8421631),g_pog_json[e].ModuleInfo[o].ShelfInfo[i].ItemInfo[l].Color="0x8080ff"}if(-1!==a.indexOf(r.ItemID)){c=g_scene_objects[e].scene.children[2].getObjectById(r.ObjID);"N"==g_show_live_image&&c.material.color.setHex(8454016),g_pog_json[e].ModuleInfo[o].ShelfInfo[i].ItemInfo[l].Color="0x80ff80"}if("Y"==r.NewYN){c=g_scene_objects[e].scene.children[2].getObjectById(r.ObjID);"N"==g_show_live_image&&c.material.color.setHex(8421504),g_pog_json[e].ModuleInfo[o].ShelfInfo[i].ItemInfo[l].Color="0x808080"}}))}))})),render(e)),logDebug("function : two_pog_diff_checker","E")}async function reset_colors(e,o){logDebug("function : reset_colors; resetType : "+e,"S"),"O"==e&&"N"==g_colorBackup&&"undefined"!=typeof g_pog_json&&g_pog_json.length>0?($.each(g_pog_json[o].ModuleInfo,(function(e,_){if(void 0===_.ParentModule||null==_.ParentModule){var n=_.ShelfInfo;g_pog_json[o].ModuleInfo[e].ShelfInfo;$.each(n,(function(_,n){$.each(n.ItemInfo,(function(n,t){g_pog_json[o].ModuleInfo[e].ShelfInfo[_].ItemInfo[n].OldItemColor=g_pog_json[o].ModuleInfo[e].ShelfInfo[_].ItemInfo[n].Color}))}))}})),g_colorBackup="Y"):"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&($.each(g_pog_json[o].ModuleInfo,(function(e,_){if(void 0===_.ParentModule||null==_.ParentModule){var n=_.ShelfInfo;g_pog_json[o].ModuleInfo[e].ShelfInfo;$.each(n,(function(_,n){$.each(n.ItemInfo,(function(n,t){g_pog_json[o].ModuleInfo[e].ShelfInfo[_].ItemInfo[n].Color=g_pog_json[o].ModuleInfo[e].ShelfInfo[_].ItemInfo[n].OldItemColor}))}))}})),g_colorBackup="N"),render(o),logDebug("function : reset_colors","E")}function blockUIForDownload(e,o,_){logDebug("function : blockUIForDownload; reportName : "+e,"S");var n="";if("Y"==_){var t=0;for(const e of g_pog_json)(t!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex)&&(n=n+"$"+e.POGCode),t++;n.replace(/(^\$)/,"")}else n=g_pog_json[o].POGCode;var i=[],a=[];i[0]="AI_PROCESSING_IND",a[0]="N",apex.server.process("dummy",{p_arg_names:i,p_arg_values:a},{dataType:"text",success:function(_){wait_icon_display=apex.widget.waitPopup(),$.blockUI({message:null});var t="f?p="+$v("pFlowId")+":"+$v("pFlowStepId")+":"+$v("pInstance")+":APPLICATION_PROCESS=DOWNLOAD_POG_ITEM_DTL:NO::AI_RANDOM_STRING,AI_POG_CODE,AI_POG_VERSION,AI_REPORT_NAME:"+(new Date).getTime()+","+n+","+g_pog_json[o].Version+","+e;apex.navigation.redirect(t),g_fileDownloadCheckTimer=window.setInterval((function(){apex.server.process("GET_REPORT_RUNNING_STATE",{x01:apex.item("AI_PROCESSING_IND").getValue()},{dataType:"text",success:function(e){"Y"==$.trim(e)&&("undefined"!=typeof wait_icon_display&&wait_icon_display.remove(),$.unblockUI(),finishDownload(),logDebug("function : blockUIForDownload","E"))}})}),1e3)}}),logDebug("function : blockUIForDownload","E")}function finishDownload(){logDebug("function : finishDownload","S"),window.clearInterval(g_fileDownloadCheckTimer),logDebug("function : finishDownload","E")}async function download_pog_report(e,o,_){logDebug("function : download_pog_report; reportName : "+e,"S");try{"POG_EXCEPTION_WPD_SCRN"==e&&await identifyOverhungItems(o,"N","Y");var n="N"==_?[g_pog_json[o]]:g_pog_json;await set_shelf_item_index(o),await save_pog_to_json(n),blockUIForDownload(e,o,_)}catch(e){error_handling(e),removeLoadingIndicator(regionloadWait)}logDebug("function : download_pog_report","E")}async function enable_maximize_facings(e,o){logDebug("function : enable_maximize_facings; optionType : "+e,"S"),addLoadingIndicator();var _=o;if("S"==e)if("N"==g_max_facing_enabled?(g_max_facing_enabled="Y",$(".max_facing").addClass("item_label_active")):(g_max_facing_enabled="N",$(".max_facing").removeClass("item_label_active")),"Y"==g_all_pog_flag)var n=0;else n=o;else if("A"==e){if("Y"==g_all_pog_flag)n=0;else n=o;for(const e of g_pog_json){if(n!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex){g_camera=g_scene_objects[n].scene.children[0],g_world=g_scene_objects[n].scene.children[2],g_temp_cut_arr.push(JSON.parse(JSON.stringify(g_pog_json[n].ModuleInfo))),g_max_facing_enabled_all="N";var t=0;for(const e of g_pog_json[n].ModuleInfo){if(void 0===e.ParentModule||null==e.ParentModule){var i=0;for(const o of e.ShelfInfo){if("SHELF"==o.ObjType){var a=o.ItemInfo;if(await set_auto_facings(t,i,-1,a,"B","S","D",n,"Y"),reorder_items(t,i,n))await recreate_all_items(t,i,"SHELF","N",-1,-1,o.ItemInfo.length,"N","N",-1,-1,n,"",n,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")}i++}}t++}g_delete_details.multi_delete_shelf_ind="N",g_undo_all_obj_arr=[],g_redo_final_obj_arr=[],g_redo_all_obj_arr=[],g_undo_all_obj_arr.push(g_temp_cut_arr),g_undo_all_obj_arr.push(g_undo_details),g_undo_all_obj_arr.previousAction="MAX_ALL_FACINGS",g_undo_all_obj_arr.g_MultiObjects="Y",g_undo_all_obj_arr.multi_delete_shelf_ind="N",g_undo_final_obj_arr.push(g_undo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],cut_copy_arr1=[],g_undo_details=[],g_mselect_drag="N",g_multiselect="N",g_undo_all_obj_arr=[],g_temp_cut_arr=[]}if("Y"!=g_all_pog_flag)break;n++}animate_all_pog(),$(".max_facing_all").removeClass("enable_maximize_facings_All"),g_scene=g_scene_objects[_].scene,g_camera=g_scene_objects[_].scene.children[0]}removeLoadingIndicator(regionloadWait),logDebug("function : enable_maximize_facings","E")}async function set_auto_facings(e,o,_,n,t,i,a,s,g="N"){logDebug("function : set_auto_facings; moduleIndex : "+e+"; ShelfIndex : "+o+"; itemIndex : "+_+"; facingType : "+t+"; facingsOf : "+i+"; itemType : "+a,"S"),max_facings_allowed=$v("P25_POGCR_AUTO_MAX_VFACING");var l=$v("P25_POGCR_DFLT_VERT_FACING"),r=g_pog_json[s].ModuleInfo[e].ShelfInfo[o];if("S"==i){if(("D"==t||"B"==t)&&("SHELF"==r.ObjType||"CHEST"==r.ObjType||"HANGINGBAR"==r.ObjType&&"Y"==g_auto_hangbar_facings||"PEGBOARD"==r.ObjType&&"Y"==r.AutoFillPeg)){var d=0;for(const _ of n)0==_.CrushD&&0==_.CrushHoriz&&0==_.CrushVert&&maximizeItemFacings("D",e,o,d,max_facings_allowed,l,a,s,g),d++}if(!("Y"!=g_max_facing_enabled&&"Y"!=g||"SHELF"!=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ObjType||"H"!=t&&"B"!=t)){var c=g_pog_json[s].ModuleInfo[e];r=g_pog_json[s].ModuleInfo[e].ShelfInfo[o];max_merch=get_shelf_max_merch(c,r,e,o,s,parseFloat($v("P25_POGCR_DFT_MAX_MERCH")));d=0;for(const _ of n)"DIVIDER"!==_.Item&&(maximizeItemFacings("H",e,o,d,max_facings_allowed,l,a,s,g),0!==_.CrushVert&&crushItem(s,e,o,d,"H","Y",[_.D],[d])),d++}}else"I"==i&&maximizeItemFacings("B",e,o,_,max_facings_allowed,l,a,s,g);logDebug("function : set_auto_facings","E")}async function drag_fixel(e,o,_,n,t){if(logDebug("function : drag_fixel; moduleIndex : "+e+"; shelfIndex : "+o+"; dragDirection : "+n,"S"),g_prevKeyPressed==n&&"Y"==g_validationAlert);else{if(g_validationAlert="N",""!==_&&void 0!==_||(_=g_current_div_index),void 0!==_&&-1!=_&&""!==_){g_item_index=_;var i=g_pog_json[0].ModuleInfo[e].ShelfInfo[o].ItemInfo[g_item_index].Item}if("Y"==g_shelf_edit_flag||"DIVIDER"==i||"Y"==g_multiselect){var a=g_delete_details.filter((e=>-1===e.IIndex));if(("Y"==g_shelf_edit_flag||"Y"==g_multiselect)&&a.length>0){g_shelf_edit_flag="Y";let e=g_delete_details;g_delete_details.is_dragging="Y";for(let e=0;e<a.length;e++){var s=await shelfInsidePOG(t,a[e].MIndex,a[e].SIndex);await drag_shelf(n,t,a[e].MIndex,a[e].SIndex,s)}g_delete_details=e}else{drag_shelf(n,t,-1,-1,s=await shelfInsidePOG(t,g_module_index,g_shelf_index))}}}g_prevKeyPressed=n,logDebug("function : drag_fixel","E")}async function shelfInsidePOG(e,o,_){try{var n=g_pog_json[e].ModuleInfo,t=wpdSetFixed(g_pog_json[e].ModuleInfo[o].ShelfInfo[_].X-g_pog_json[e].ModuleInfo[o].ShelfInfo[_].W/2),i=wpdSetFixed(g_pog_json[e].ModuleInfo[o].ShelfInfo[_].X+g_pog_json[e].ModuleInfo[o].ShelfInfo[_].W/2),a=wpdSetFixed(g_pog_json[e].ModuleInfo[o].ShelfInfo[_].Y+g_pog_json[e].ModuleInfo[o].ShelfInfo[_].H/2),s=wpdSetFixed(g_pog_json[e].ModuleInfo[o].ShelfInfo[_].Y-g_pog_json[e].ModuleInfo[o].ShelfInfo[_].H/2);for(module of n)if(void 0===module.ParentModule||null==module.ParentModule){var g=wpdSetFixed(module.Y+module.H/2),l=wpdSetFixed(module.Y-module.H/2),r=wpdSetFixed(module.X-module.W/2),d=wpdSetFixed(module.X+module.W/2);if(!(a<l||s>g||i<r||t>d))return"Y"}return"N"}catch(e){error_handling(e)}}async function drag_shelf(e,o,_=-1,n=-1,t="Y"){logDebug("function : drag_shelf; dragDirection : "+e,"S");var i=-1==_?g_module_index:_,a=-1==n?g_shelf_index:n,s=parseInt($v("P25_POGCR_SHELF_DRAG_PIXEL")),g=parseInt($v("P25_POGCR_DFT_NOTCH_VAL")),l=g_pog_json[o].ModuleInfo[i].ShelfInfo[a],r=g_pog_json[o].ModuleInfo[i];if(void 0!==s&&s<=0?s=.01:s/=100,"Y"==t&&l.X>r.X-r.Y/2&&l.X<r.X+r.Y/2&&r.NotchSpacing>0&&("undefined"==typeof g_item_index||-1==g_item_index)){var d=g_pog_json[o].BaseH+r.NotchStart+r.NotchSpacing-r.NotchSpacing/2;if("U"==e&&l.Y+l.H/2<=g_pog_json[o].BaseH){var c=d-l.Y+l.H/2;s=l.Y+l.H/2+c,"N"}else"U"==e&&l.Y+l.H/2>=g_pog_json[o].BaseH?(s=l.Y+r.NotchSpacing*g,"N"):"D"==e&&l.Y+l.H/2>=g_pog_json[o].BaseH&&(s=l.Y-r.NotchSpacing*g,"N")}var f=l.X,I=l.Y,p=i,h=a;if(console.log("g_item_index drag shelf",g_item_index,i,a,l),"undefined"!=typeof g_item_index&&-1!=g_item_index&&""!==g_item_index){var u=l.ItemInfo,m=0,O=g_pog_json[o].ModuleInfo[i].ShelfInfo[a].ItemInfo[g_item_index],S=(l.ItemInfo[g_item_index].Y,l.ItemInfo[g_item_index].H,l.Y+l.H/2),P=O.Item;if("U"==e)O.X,O.Y;else if("D"==e)O.X,O.Y;g_current_div_index=g_item_index}if(void 0!==P&&"DIVIDER"==P&&"BASKET"==g_shelf_object_type){if("U"==e)var E=O.X,v=O.Y+s;else if("D"==e)E=O.X,v=O.Y-s;else if("L"==e)E=O.X-s,v=O.Y;else if("R"==e)E=O.X+s,v=O.Y;if("Y"==validate_divider(e,E,v,l)){var D=[],C=[];C.push(g_pog_json[o].ModuleInfo[i].ShelfInfo[a]),D.moduleIndex=i,D.module=g_pog_json[o].ModuleInfo[i].Module,D.moduleObjectID=g_pog_json[o].ModuleInfo[i].MObjID,D.shelfIndex=a,D.actionType="ITEM_DELETE",D.startCanvas=g_start_canvas,D.objectID=g_pog_json[o].ModuleInfo[i].ShelfInfo[a].SObjID,D.g_deletedItems=C,D.push(JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[i].ShelfInfo[a]))),g_allUndoObjectsInfo.push(D),logFinalUndoObjectsInfo("ITEM_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","N");m=0;if(g_pog_json[o].ModuleInfo[i].ShelfInfo[a].ItemInfo[g_item_index].X=E,g_pog_json[o].ModuleInfo[i].ShelfInfo[a].ItemInfo[g_item_index].Y=v,g_pog_json[o].ModuleInfo[i].ShelfInfo[a].ItemInfo[g_item_index].YDistance=v-S,(V=g_scene_objects[o].scene.children[2].getObjectById(g_pog_json[o].ModuleInfo[i].ShelfInfo[a].ItemInfo[g_item_index].ObjID)).position.set(E,v),"U"==e||"D"==e){g_intersected=[];await recreate_all_items(i,a,l.ObjType,"N",-1,-1,l.ItemInfo.length,"N","N",-1,-1,g_start_canvas,"N",o,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y"),u=g_pog_json[o].ModuleInfo[i].ShelfInfo[a].ItemInfo;for(var T of u){if("DIVIDER"==T.Item&&g_current_div_index==m){var b=g_scene_objects[o].scene.children[2].getObjectById(T.ObjID);g_intersected.push(b),console.log("selectObject",g_intersected);break}m++}render_animate_selected()}}else if(alert(get_message("POGCR_VALIDATE_DIVIDER")),g_validationAlert="Y","U"==e||"D"==e)await recreate_all_items(i,a,l.ObjType,"N",-1,-1,l.ItemInfo.length,"N","N",-1,-1,g_start_canvas,"N",o,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")}else{var j=0,N=wpdSetFixed(l.Y+l.H/2);for(k=0;k<100;k++){if(N<wpdSetFixed(g_pog_json[o].BaseH+r.NotchStart/2)&&r.NotchStart>0){j=-1;break}if(N<=wpdSetFixed(g_pog_json[o].BaseH+r.NotchStart/2)&&r.NotchStart>0){j=0;break}if(N<=wpdSetFixed(g_pog_json[o].BaseH)&&0==r.NotchStart){j=0;break}if(N<=wpdSetFixed(g_pog_json[o].BaseH+r.NotchStart+r.NotchSpacing*k)){j=k;break}}if("U"==e){var x=l.X;if(g_pog_json[o].ModuleInfo[i].NotchSpacing>0&&"Y"==t){if(-1==j){var M=g_pog_json[o].BaseH+l.H/2;if(l.NotchNo=0,0==(j=0))if(j+=1,g_pog_json[o].ModuleInfo[i].NotchStart>0)M=g_pog_json[o].BaseH+g_pog_json[o].ModuleInfo[i].NotchStart-l.H/2;else M=g_pog_json[o].BaseH}else if(j>=0)if(wpdSetFixed(l.Y-l.H/2)==wpdSetFixed(g_pog_json[o].BaseH)&&g_pog_json[o].ModuleInfo[i].NotchStart>0||wpdSetFixed(g_pog_json[o].BaseH+g_pog_json[o].ModuleInfo[i].NotchStart+g_pog_json[o].ModuleInfo[i].NotchSpacing*j)!==wpdSetFixed(l.Y+l.H/2)&&wpdSetFixed(l.Y-l.H/2)<=wpdSetFixed(g_pog_json[o].BaseH)&&0==g_pog_json[o].ModuleInfo[i].NotchStart||(j+=1),wpdSetFixed(l.Y-l.H/2)>=wpdSetFixed(g_pog_json[o].BaseH))M=wpdSetFixed(g_pog_json[o].BaseH+g_pog_json[o].ModuleInfo[i].NotchStart+g_pog_json[o].ModuleInfo[i].NotchSpacing*j-l.H/2);else M=wpdSetFixed(g_pog_json[o].BaseH+l.H/2);l.NotchNo=j}else{M=l.Y+s;"N"==t&&(l.NotchNo=0)}}else if("D"==e){x=l.X;if(wpdSetFixed(l.Y+l.H/2)<wpdSetFixed(g_pog_json[o].BaseH+r.NotchStart/2)&&"Y"==t)M=wpdSetFixed(g_pog_json[o].BaseH+l.H/2);else if(g_pog_json[o].ModuleInfo[i].NotchSpacing>0&&"Y"==t){if(e=>0)if(0==j)M=wpdSetFixed(g_pog_json[o].BaseH+l.H/2);else if(-1==j){j=0,alert(get_message("POGCR_NO_NOTCH_AVAILABLE"));M=wpdSetFixed(g_pog_json[o].BaseH+l.H/2)}else M=wpdSetFixed(g_pog_json[o].BaseH+g_pog_json[o].ModuleInfo[i].NotchStart+g_pog_json[o].ModuleInfo[i].NotchSpacing*(j-1)-l.H/2);l.NotchNo=j}else{M=l.Y-s;"N"==t&&(l.NotchNo=0)}wpdSetFixed(M-l.H/2)<wpdSetFixed(g_pog_json[o].BaseH)&&"Y"==t&&(M=wpdSetFixed(g_pog_json[o].BaseH+l.H/2))}else if("L"==e)x=l.X-s,M=l.Y;else if("R"==e)x=l.X+s,M=l.Y;var R,L=l,[A,y,$,w]=get_curr_module(x,M,g_shelf_edit_flag,i,a,L,o);R=await getconfirm_shelfmove(o),"Y"==g_shelf_edit_flag&&(org_shelf_x=l.X,org_shelf_y=l.Y,org_shelf_z=l.Z,l.X=x,l.Y=M,g_pog_json[o].ModuleInfo[A].H>.1&&"ROD"!==g_shelf_object_type&&"TEXTBOX"!==g_shelf_object_type&&"Y"==g_auto_position_ind&&"Y"==R&&await auto_position_shelf(i,A,a,$,x,M,"N",o));var Y=g_pog_json[o].ModuleInfo[A].ShelfInfo[a].ItemInfo,G=l.AllowAutoCrush;if("Y"==g_shelf_edit_flag&&"Y"==R){"Y"==g_max_facing_enabled&&reset_auto_crush(i,a,-1,o,i,a,o);await set_auto_facings(A,a,-1,Y,"B","S","D",o)}if("Y"==g_shelf_edit_flag&&"ROD"!==g_shelf_object_type&&"TEXTBOX"!==g_shelf_object_type&&"N"==$&&"Y"==R){var H=A==i?i:A;await set_all_items(H,a,x,M,g_shelf_edit_flag,"N","Y",o,o);var F=await validate_shelf_min_distance(H,a,M,Y,G,i,x,"Y",L,o)}else F="Y"==$?"N":"Y";if("N"==R&&(F="N"),"Y"!=F&&"R"!=F||"Y"!=g_shelf_edit_flag){if("N"==F&&"Y"==g_shelf_edit_flag){if("Y"==$&&alert(get_message("LOST_FROM_SHELF_ROTATION_ERR",l.Shelf,g_pog_json[o].POGCode+g_pog_json[o].ModuleInfo[i].Module)),g_validationAlert="Y",l.ItemInfo.length>0&&"N"==$){async function B(){await set_all_items(i,a,f,I,g_shelf_edit_flag,"E","Y",o,o)}B()}l.X=f,l.Y=I,(V=g_scene_objects[o].scene.children[2].getObjectById(l.SObjID)).position.set(f,I,V.position.z),g_module_index=p,g_shelf_index=h,render(o)}}else{g_pog_edited_ind="Y";l.SObjID;var V,W=l.ObjType,[H,U]=(g_pog_json[o].ModuleInfo[i].MObjID,await set_shelf_after_drag(F,g_shelf_edit_flag,i,A,a,x,M,"N","Y","","",o,o));(V=g_scene_objects[o].scene.children[2].getObjectById(g_pog_json[o].ModuleInfo[H].ShelfInfo[U].SObjID)).position.set(x,M,V.position.z),g_pog_json[o].ModuleInfo[H].ShelfInfo[U].Combine="N","PALLET"!==W&&await generateCombinedShelfs(o,H,U,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y","","Y"),g_undo_details=[],g_undo_obj_arr=[],g_undo_supp_obj_arr=[],g_redo_final_obj_arr=[],g_redo_all_obj_arr=[];g_pog_json[o].ModuleInfo[H].ShelfInfo[U].SpreadItem,D=[];var X=l.SObjID;if(D.moduleIndex=i,D.shelfIndex=a,D.actionType="SHELF_DRAG",D.startCanvas=g_start_canvas,D.objectID=X,D.g_deletedItems=[],D.moduleObjectID=g_pog_json[o].ModuleInfo[i].MObjID,D.module=g_pog_json[o].ModuleInfo[i].Module,D.push(JSON.parse(JSON.stringify(l))),g_allUndoObjectsInfo.push(D),logFinalUndoObjectsInfo("SHELF_DRAG","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","N"),g_allUndoObjectsInfo=[],"Y"==g_show_max_merch||"Y"==l_show_max_merch_comp){async function B(){await add_merch("N",o),await add_merch("Y",o)}B()}!async function(){await recreate_compare_views(g_compare_view,"N")}();await update_single_notch_label("Y",H,U,$v("P25_NOTCH_HEAD"),"",o,"N");if("Y"==g_fixel_label)await show_fixel_labels("Y",o);Y.length>0&&(g_pog_json[o].ModuleInfo[H].EditFlag="Y"),g_pog_json[o].ModuleInfo[H].ShelfInfo[U].ItemInfo.length>0&&g_scene.updateMatrixWorld(),render(o),g_module_index=H,g_shelf_index=U}}logDebug("function : drag_shelf","E")}function delete_pog_list(){logDebug("function : delete_pog_list","S");var e=apex.region("ig_pog_list").widget().interactiveGrid("getViews").grid,o=e.getSelectedRecords(),_=[];$.each(o,(function(o,n){seq_id=e.model.getValue(n,"SEQUENCE_ID"),_.push(seq_id)})),_.length>0?confirm(get_message("DELETE_CONFIRM_MSG"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){apex.server.process("DELETE_POG_LIST",{f01:_},{dataType:"text",success:function(e){""!=$.trim(e)?raise_error(e):(apex.region("ig_pog_list").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("ig_pog_list").refresh(),apex.message.showPageSuccess(apex.lang.getMessage("APEX.IG.CHANGES_SAVED")),logDebug("function : delete_pog_list","E"))},loadingIndicatorPosition:"page"})})):alert(get_message("SELECT_ATLEAST_ONE_REC")),logDebug("function : delete_pog_list","E")}function peg_holes(e){logDebug("function : peg_holes","S");var o=get_canvas_json("LABEL");if("Y"==g_all_pog_flag)var _=0;else _=g_pog_index;if(void 0!==o&&o.length>0){"N"==g_peg_holes_active?(g_peg_holes_active="Y",$(".peg_holes").addClass("peg_hole_acive")):(g_peg_holes_active="N",$(".peg_holes").removeClass("peg_hole_acive"));for(const e of o){if("N"==g_peg_holes_active){var n=o[_].ModuleInfo;$.each(n,(function(e,o){null!=o.ParentModule&&"undefined"!=o.ParentModule||$.each(o.ShelfInfo,(function(e,o){if(void 0!==o&&"PEGBOARD"==o.ObjType){var n=parseInt(o.Color.replace("#","0x"),16),t=new THREE.Color(n),i=g_scene_objects[_].scene.children[2].getObjectById(o.SObjID);for(const e of i.children)"pegdots"==e.uuid&&(e.material.color=t,e.position.z=5e-4)}}))}))}else{n=o[_].ModuleInfo;$.each(n,(function(e,o){null!=o.ParentModule&&"undefined"!=o.ParentModule||$.each(o.ShelfInfo,(function(e,o){if(void 0!==o&&"PEGBOARD"==o.ObjType){var n=g_scene_objects[_].scene.children[2].getObjectById(o.SObjID);for(const e of n.children)if("pegdots"==e.uuid){var t=new THREE.Color(0);e.material.color=t,e.position.z=7e-4}}}))}))}if(render(_),"Y"!=g_all_pog_flag)break;_++}}logDebug("function : peg_holes","E")}async function show_pegTages(e,o,_,n,t,a,s){if(logDebug("function : show_pegTages; showAll : "+e+"; itemInfo : "+o+"; object : "+_+"; moduleIndex : "+n+"; shelfIndex : "+t+"; itemIndex : "+a,"S"),void 0===e&&(e="Y",s=g_pog_index),"Y"==e&&("Y"==g_show_peg_tags?(g_show_peg_tags="N",$(".peg_tag").removeClass("fixel_label_active")):(g_show_peg_tags="Y",$(".peg_tag").addClass("fixel_label_active"))),"Y"==g_show_peg_tags){if("Y"!=e){var g=_;return new Promise((function(e,_){apex.server.process("GET_PEG_DETAIL",{x01:o.PegID},{dataType:"text",success:function(_){var l,r,d,c,f,I=$.trim(_).split("-");if(l=I[0],r=I[1],I[2],d=I[3],c=I[4],f=I[5],void 0!==l&&l>0){g_pog_json[s].ModuleInfo[n].ShelfInfo[t].ItemInfo[a].pegHeadRoom=f;var p=o.H,h=o.H/o.BVert,u=0-p/2;for(j=1;j<=o.BVert;j++){var m=o.W,O=o.W/o.BHoriz,S=0-m/2;for(i=1;i<=o.BHoriz;i++)addPegTags(g,l,r,h+u,"ITEM",d,c,f,O/2+S,o.W),S=O+S;u+=h}}logDebug("function : show_pegTages","E"),e("SUCCESS")},loadingIndicatorPosition:"page"})}))}$.each(g_pog_json[s].ModuleInfo,(function(e,o){void 0!==o.ParentModule&&null!=o.ParentModule||$.each(o.ShelfInfo,(function(o,_){if("HANGINGBAR"==_.ObjType||"PEGBOARD"==_.ObjType){var n=-1,t=_.ItemInfo.length;$.each(_.ItemInfo,(function(a,g){return new Promise((function(l,r){apex.server.process("GET_PEG_DETAIL",{x01:g.PegID},{dataType:"text",success:function(r){var d,c,f=$.trim(r).split("-");if(d=f[0],f[1],f[2],f[3],f[4],c=f[5],void 0!==d&&d>0){g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[a].pegHeadRoom=c;g_scene_objects[s].scene.children[2].getObjectById(g.ObjID),g.H;var I=g.H/g.BVert;for(j=1;j<=g.BVert;j++){var p=g.W,h=g.W/g.BHoriz,u=0-p/2;for(i=1;i<=g.BHoriz;i++)u=h+u;I}}if(1==n&&a==t-1){(async function(){recreate_all_items(e,o,"SHELF","N",-1,-1,_.ItemInfo.length,"N","Y",-1,-1,g_start_canvas,"",s,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")})()}logDebug("function : show_pegTages","E"),l("SUCCESS")},loadingIndicatorPosition:"page"})}))})),n=1}}))}))}else await hide_pegTags(s);logDebug("function : show_pegTages","E")}async function addPegTags(e,o,_,n,t,i,a,s,g,l){logDebug("function : addPegTags; width : "+o+"; height : "+_+"; itemHeight : "+n+"; obj_type : "+t+"; peg_right : "+i+"; peg_down : "+a+"; peg_headroom : "+s+"; peg_headroom : "+s+"; itemWidth : "+g+"; totalWidth : "+l,"S"),o/=100,_/=100,i/=100,a/=100,s/=100;var r=new THREE.BoxGeometry(o,_,0),d=new THREE.EdgesGeometry(r),c=new THREE.LineBasicMaterial({color:16711680,linewidth:2}),f=new THREE.LineSegments(d,c);e.add(f),f.uuid="peg_tag",e.merchid=f.id,f.position.x=g+o/2-i/2,"Y"==g_show_live_image?f.position.y=n+s+a-_/2:f.position.y=n+s/2+a-_/2,f.position.z=.001,render(g_pog_index),logDebug("function : addPegTags","E")}async function hide_pegTags(e){logDebug("function : hide_pegTags","S");var o=0;for(modules_info of g_pog_json[e].ModuleInfo){var _=0;for(shelf of modules_info.ShelfInfo){var n=-1;for(mt of shelf.ItemInfo){if(void 0!==mt.PegID||""!==mt.PegID){n=1;var t=g_scene_objects[e].scene.children[2].getObjectById(mt.ObjID),i=t.children;if(void 0!==t)for(var a of i)if("peg_tag"==a.uuid){var s=t.getObjectById(a.id);t.remove(s)}}0}if(1==n&&(reset_auto_crush(o,_,-1,e,o,_,e),reorder_items(o,_,e)))await recreate_all_items(o,_,shelf.ObjType,"Y",-1,-1,shelf.ItemInfo.length,"N","N",-1,-1,g_start_canvas,"",e,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y");_++}o++}render(e),logDebug("function : hide_pegTags","E")}function setItemHeadRoom(e,o,_){try{logDebug("function : setItemHeadRoom; moduleIndex : "+e+"; shelfIndex : "+o+"; itemIndex : "+_,"S");var n=g_pog_json[p_pog_index].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].PegID,t=(g_pog_json[p_pog_index].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].H,g_pog_json[p_pog_index].ModuleInfo[e].ShelfInfo[o].ItemInfo[_]);g_scene_objects[p_pog_index].scene.children[2].getObjectById(t.ObjID);return new Promise((function(e,o){apex.server.process("GET_PEG_DETAIL",{x01:n},{dataType:"text",success:function(o){var _,n=$.trim(o).split("-");return n[0],n[1],n[2],n[3],n[4],_=n[5],peg_head_t=_,logDebug("function : setItemHeadRoom","E"),e("SUCCESS"),peg_head_t}}),logDebug("function : setItemHeadRoom","E")}))}catch(e){error_handling(e)}}async function auto_set_items(e,o,_,n,t,i,a,s){try{logDebug("function : auto_set_items; p_module_index : "+e+"; p_shelf_index : "+o+"; finalX : "+n+"; ItemHeight : "+t+"; itemID : "+i+"; itemWidth : "+a,"S");g_pog_json[s].ModuleInfo[e].ShelfInfo[o].HorizGap,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].SpreadItem,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].HorizGap;var g,l=_,r=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].Y,d=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].H;shelfInfo=g_pog_json[s].ModuleInfo[e].ShelfInfo;var c=[],f=0;shelfInfo.keySort({Y:"desc"});for(const e of shelfInfo)if(e.Y<r){f=r-e.Y-(e.H/2+d/2),g=e;break}var I=0;for(const e of g.ItemInfo)I<e.H&&(I=e.H);availableSpace=f-I;for(const e of l)e.H>availableSpace&&c.push(e.ItemID);for(const e of g.ItemInfo){var p=e.X-e.W/2,h=e.X+e.W/2,u=n-a/2,m=n+a/2;(u>=p&&u<=h||m>=p&&m<=h)&&e.H}logDebug("function : auto_set_items","E")}catch(e){error_handling(e)}}async function manage_multi_edit(e,o){logDebug("function : manage_multi_edit; edit_type : "+e,"S");try{if("F"==e){var _=parseFloat(g_shelf_details[0].MaxMerch)/100,n=parseFloat(g_shelf_details[0].LOverhang)/100,t=parseFloat(g_shelf_details[0].ROverhang)/100,i=g_shelf_details[0].AllowAutoCrush,a=g_shelf_details[0].SpreadItem,s=g_shelf_details[0].Color,g="",l="",r=g_shelf_details[0].Combine,d=g_shelf_details[0].H/100,c=g_shelf_details[0].W/100,f=g_shelf_details[0].D/100,I=g_shelf_details[0].Slope,p=g_shelf_details[0].Rotation,h=g_shelf_details[0].ManualCrush,u=g_shelf_details[0].DivCreated,m=parseFloat(g_shelf_details[0].DivHeight)/100,O=parseFloat(g_shelf_details[0].DivWidth)/100,S=g_shelf_details[0].DivPst,P=g_shelf_details[0].DivPed,E=g_shelf_details[0].DivPbtwFace,v=parseFloat(g_shelf_details[0].DivStX)/100,D=parseFloat(g_shelf_details[0].DivSpaceX)/100,C=g_shelf_details[0].DivFillCol,T=g_shelf_details[0].NoDivIDShow,b=g_shelf_details[0].FSize,j=g_shelf_details[0].FStyle,N=g_shelf_details[0].FBold,x=0==nvl(g_shelf_details[0].ColorChng)?"N":g_shelf_details[0].ColorChng,M=0==nvl(g_shelf_details[0].Height)?"N":g_shelf_details[0].Height,R=0==nvl(g_shelf_details[0].Width)?"N":g_shelf_details[0].Width,L=0==nvl(g_shelf_details[0].Depth)?"N":g_shelf_details[0].Depth,A=0==nvl(g_shelf_details[0].Rotation)?"N":g_shelf_details[0].Rotation,y=0==nvl(g_shelf_details[0].Slope)?"N":g_shelf_details[0].Slope,w=0==nvl(g_shelf_details[0].DivHChng)?"N":g_shelf_details[0].DivHChng,Y=0==nvl(g_shelf_details[0].DivWChng)?"N":g_shelf_details[0].DivWChng,G=0==nvl(g_shelf_details[0].DivPSChng)?"N":g_shelf_details[0].DivPSChng,H=0==nvl(g_shelf_details[0].DivPEChng)?"N":g_shelf_details[0].DivPEChng,F=0==nvl(g_shelf_details[0].DivPDBFChng)?"N":g_shelf_details[0].DivPDBFChng,B=0==nvl(g_shelf_details[0].DivIDChng)?"N":g_shelf_details[0].DivIDChng,V=0==nvl(g_shelf_details[0].DivFCChng)?"N":g_shelf_details[0].DivFCChng,k=0==nvl(g_shelf_details[0].LoverhungChng)?"N":g_shelf_details[0].LoverhungChng,W=0==nvl(g_shelf_details[0].RoverhungChng)?"N":g_shelf_details[0].RoverhungChng,U=0==nvl(g_shelf_details[0].SpreadPrdct)?"N":g_shelf_details[0].SpreadPrdct,X=0==nvl(g_shelf_details[0].FSizeChng)?"N":g_shelf_details[0].FSizeChng,z=0==nvl(g_shelf_details[0].FStyleChng)?"N":g_shelf_details[0].FStyleChng,J=0==nvl(g_shelf_details[0].FBoldChng)?"N":g_shelf_details[0].FBoldChng,K=[],q=0,Z=-1;if(g_delete_details.length>0)for(const e of g_delete_details){if((so=g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].SObjID)!==Z)Z=g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].SObjID,(go=[]).moduleIndex=e.MIndex,go.module=g_pog_json[o].ModuleInfo[e.MIndex].Module,go.shelfIndex=e.SIndex,go.actionType="ITEM_DELETE",go.startCanvas=g_start_canvas,go.objectID=so,go.g_deletedItems=K,go.moduleObjectID=g_pog_json[o].ModuleInfo[e.MIndex].MObjID,go.push(JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex]))),g_allUndoObjectsInfo.push(go);q++}if(g_delete_details.length>0){var Q=0,ee="N";for(const e of g_delete_details)if("SHELF"==e.Object&&"N"==e.IsDivider){var oe="N",_e=g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex],ne=JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex])),[te,ie]=[-1,-1];if(_e.Combine="S"==r?ne.Combine:r,""!==a&&"Y"==U&&(_e.SpreadItem=a,oe="Y",[te,ie]=getCombinationShelf(o,_e.Shelf),-1!==te&&-1!==ie&&(g_combinedShelfs[te].SpreadItem=a,g_combinedShelfs[te][ie].SpreadItem=a)),"S"==r&&"N"!==ne.Combine?"Y"==ee&&"N"!==r?(await generateCombinedShelfs(o,e.MIndex,e.SIndex,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y","","Y"),[te,ie]=getCombinationShelf(o,_e.Shelf),-1==te&&Q>0?alert(get_message("MULTI_COMB_ERR_MSG",_e.Shelf)):oe="Y"):"N"==r&&(await generateCombinedShelfs(o,e.MIndex,e.SIndex,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y","","Y"),[te,ie]=getCombinationShelf(o,_e.Shelf),oe="Y"):"S"!==r&&"N"!==ne.Combine?(await generateCombinedShelfs(o,e.MIndex,e.SIndex,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y","","Y","Y"),[te,ie]=getCombinationShelf(o,_e.Shelf),oe="Y"):"S"!==r&&"N"!==r&&"N"==ne.Combine&&(await generateCombinedShelfs(o,e.MIndex,e.SIndex,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y","","Y","D","Y"),[te,ie]=getCombinationShelf(o,_e.Shelf),oe="Y"),ce=g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo,""!==_&&0!==_&&"Y"!==g_shelf_details[0].ShelfEdit?_e.MaxMerch=g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].MaxMerch:""!==_&&0==_&&"Y"!==g_shelf_details[0].ShelfEdit?_e.MaxMerch=ne.MaxMerch:_e.MaxMerch=_,""!==h&&"CHEST"==_e.ObjType&&(_e.ManualCrush=h),""!==n&&"Y"==k&&(_e.LOverhang=n,oe="Y"),""!==t&&"Y"==W&&(_e.ROverhang=t,oe="Y"),""!==i?(_e.AllowAutoCrush=i,[te,ie]=getCombinationShelf(o,_e.Shelf),-1!==te&&(0==ie&&(g_combinedShelfs[te].AllowAutoCrush=i),g_combinedShelfs[te][ie].AllowAutoCrush=i)):_e.AllowAutoCrush=ne.AllowAutoCrush,""!==s&&"Y"==x)g=parseInt(s.replace("#","0x"),16),l=new THREE.Color(g),_e.Color=s,(Pe=g_scene_objects[o].scene.children[2].getObjectById(e.ObjID)).material.color=l;else g=parseInt(_e.Color.replace("#","0x"),16),l=new THREE.Color(g),(Pe=g_scene_objects[o].scene.children[2].getObjectById(e.ObjID)).material.color=l;if(""!==a&&"Y"==U&&(_e.SpreadItem=a,oe="Y"),"N"!==r&&(ee="Y"),""!==d&&"Y"==M&&d>0&&(_e.H=d,oe="Y",ee="Y"),""!==c&&"Y"==R&&c>0&&(_e.W=c,oe="Y",ee="Y"),""!==f&&"Y"==L&&f>0&&(_e.D=f,oe="Y"),"Y"==y&&(_e.Slope=""==I?0:I,oe="Y",ee="Y"),"Y"==A&&(_e.Rotation=""==p?0:p,oe="Y",ee="Y"),"TEXTBOX"==_e.ObjType&&(""!==b&&"Y"==X&&""!=b&&(_e.FSize=b,oe="Y",ee="Y"),""!==j&&"Y"==z&&""!=j&&(_e.FStyle=j,oe="Y",ee="Y"),""!==N&&"Y"==J&&""!=N&&(_e.FBold=N,oe="Y",ee="Y"))," "!==E&&m>0&&O>0&&"Y"==u&&"SHELF"==_e.ObjType&&(g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].DivCreated=u,"Y"==w&&(g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].DivHeight=m),"Y"==Y&&(g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].DivWidth=O),"Y"==G&&(g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].DivPst=S),"Y"==H&&(g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].DivPed=P),"Y"==F&&(g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].DivPbtwFace=E),g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].DivStX=v,g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].DivSpaceX=D,("Y"==V||void 0===g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].DivFillCol)&&(g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].DivFillCol=C),"Y"==B&&(g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].NoDivIDShow=T),await create_shelf_dividers(o,e.MIndex,e.SIndex),oe="Y",ee="Y"),"Y"==ee){if("ROD"===_e.ObjType||"PEGBOARD"===_e.ObjType||"CHEST"==_e.ObjType&&"Y"==g_chest_as_pegboard)ae="Y";else if(reorder_items(e.MIndex,e.SIndex,o)){_e=g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex];var ae=validate_shelf_min_distance(e.MIndex,e.SIndex,_e.Y,ce,_e.AllowAutoCrush,e.MIndex,_e.X,"Y",_e,o)}_e.OldObjID=_e.SObjID;var se,ge="N";if(("CHEST"!=_e.ObjType||"Y"!=g_chest_as_pegboard)&&"PEGBOARD"!=_e.ObjType)if(-1!==te)for(shelf_info of g_combinedShelfs[te]){console.log(shelf_info.Shelf);var le=shelf_info.MIndex,re=shelf_info.SIndex,de=g_pog_json[o].ModuleInfo[le].ShelfInfo[re].ItemInfo;q=0;for(xo of de){if(!(void 0!==xo.BottomObjID&&""!=xo.BottomObjID||void 0!==xo.TopObjID&&""!=xo.TopObjID))ge=update_validate_item_height(xo,le,re,q,xo.X,_e.ObjType,-1,o);q++}}else{q=0;for(xo of ce){if(!(void 0!==xo.BottomObjID&&""!=xo.BottomObjID||void 0!==xo.TopObjID&&""!=xo.TopObjID))ge=update_validate_item_height(xo,e.MIndex,e.SIndex,q,xo.X,_e.ObjType,-1,o);q++}}se="TEXTBOX"==_e.ObjType?.0021:"PEGBOARD"==_e.ObjType?.003:"DIVIDER"==_e.ObjType?.001:5e-4,await set_all_items(e.MIndex,e.SIndex,_e.X,_e.Y,"Y","N","Y",o,o);var ce=g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo,fe=(await set_auto_facings(e.MIndex,e.SIndex,-1,ce,"B","S","D",o,o),[]),Ie=[],pe=[],he=[];$.each(ce,(function(_,n){fe.push(wpdSetFixed(n.W)),Ie.push(wpdSetFixed(n.H)),pe.push(wpdSetFixed(n.D)),he.push(_),g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[_].Exists="E"}));if("Y"!=ae&&"R"!=ae||!validate_items(fe,Ie,pe,he,_e.ObjType,e.MIndex,e.SIndex,-1,"N",0,0,0,-1,"N","N","Y","N","N",[],"Y","Y","Y",o))" "!==E&&m>0&&O>0&&"Y"==u&&remove_shelf_dividers(o,e.MIndex,_e.Shelf),g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo.splice(e.SIndex,1),g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo.splice(e.SIndex,0,ne),await set_all_items(e.MIndex,e.SIndex,_e.X,_e.Y,"Y","N","Y",o,o);else{if(g_pog_edited_ind="Y",g_dblclick_objid=_e.SObjID,"PEGBOARD"==_e.ObjType)ge=await add_pegboard(_e.Shelf,_e.W,_e.H,_e.D,l,_e.X,_e.Y,se,"Y",_e.VertiStart,_e.VertiSpacing,_e.HorizStart,_e.HorizSpacing,e.MIndex,e.SIndex,_e.Rotation,_e.Slope,"Y",$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),o);else if("ROD"==_e.ObjType)ge=await add_rod(_e.Shelf,_e.ObjType,_e.W,_e.H,_e.D,l,_e.X,_e.Y,se,edited,e.MIndex,e.SIndex,o);else if("TEXTBOX"==_e.ObjType){g=parseInt(_e.Color.replace("#","0x"),16),l=new THREE.Color(g);var ue=_e.Z,me=g_world.getObjectById(_e.SObjID).position.z,Oe=-1,Se=(q=0,{});for(const e of g_pog_json[o].ModuleInfo){if(e.ObjID==_e.SObjID){Se=g_pog_json[o].ModuleInfo[q],Oe=q;break}q++}if("Y"==g_show_live_image&&""!==_e.TextImg&&void 0!==_e.TextImg&&null!==_e.TextImg)ge=await add_text_box_with_image(_e.Shelf,"SHELF",_e.W,_e.H,_e.D,l,_e.X,_e.Y,.0021,"Y",e.MIndex,_e.InputText,g,_e.WrapText,_e.ReduceToFit,_e.Color,e.SIndex,_e.Rotation,_e.Slope,"Y",_e.FStyle,_e.FSize,_e.FBold,$v("P25_NOTCH_HEAD"),o);else ge=add_text_box(_e.Shelf,"SHELF",_e.W,_e.H,_e.D,l,_e.X,_e.Y,.0021,"Y",e.MIndex,_e.InputText,g,_e.WrapText,_e.ReduceToFit,_e.Color,e.SIndex,_e.Rotation,_e.Slope,"Y",_e.FStyle,_e.FSize,_e.FBold,2,o,g_pogcr_enhance_textbox_fontsize,_e.TextDirection);var Pe=g_scene_objects[o].scene.children[2].getObjectById(ge);-1==Oe&&(Se.SeqNo=g_pog_json[o].ModuleInfo.length+1,Se.Module=_e.Shelf,Se.ParentModule=g_pog_json[o].ModuleInfo[e.MIndex].Module,Se.POGModuleName=_e.Desc,Se.SubDept=g_pog_json[o].ModuleInfo[e.MIndex].SubDept,Se.Remarks=g_pog_json[o].ModuleInfo[e.MIndex].Remarks,Se.D=0,Se.Rotation=0,Se.NotchW=0,Se.NotchStart=0,Se.NotchSpacing=0,Se.HorzStart=0,Se.HorzSpacing=0,Se.VertStart=0,Se.VertSpacing=0,Se.AllowOverlap=0,Se.LNotch=0,Se.Backboard=0,Se.RNotch=0,Se.X=0,Se.Y=0,Se.Z=0,Se.LastCount=0,Se.EditFlag="N",Se.Carpark=[],Se.ShelfInfo=[],Se.H=_e.H,Se.W=_e.W,Se.Color=_e.Color,g_pog_json[o].ModuleInfo.push(Se),Oe=g_pog_json[o].ModuleInfo.length-1),g_pog_json[o].ModuleInfo[Oe].ObjID=ge,Pe.position.z=me,g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].Z=ue}else{var[ge,Ee]=await add_shelf(_e.Shelf,_e.ObjType,_e.W,_e.H,_e.D,l,_e.X,_e.Y,se,"Y",e.MIndex,_e.Rotation,_e.Slope,e.SIndex,"Y","N","Y",-1,$v("P25_POG_CP_SHELF_DFLT_COLOR"),$v("P25_NOTCH_HEAD"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),o);updateObjID(_e.OldObjID,ge,"S")}_e.SObjID=ge}}await reset_auto_crush(e.MIndex,e.SIndex,-1,o,e.MIndex,e.SIndex,o),"Y"==oe&&"N"==ee&&(ce=g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo,$.each(ce,(function(_,n){g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[_].W=n.RW})),reorder_items(e.MIndex,e.SIndex,o)&&await recreate_all_items(e.MIndex,e.SIndex,g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ObjType,"Y",-1,-1,g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo.length,"Y","N",-1,-1,g_start_canvas,"",o,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")),Q++}if($s("P25_MULTI_EDIT","N"),"N"==g_show_max_merch){await add_merch("N",g_pog_index)}else{await add_merch("Y",g_pog_index)}}await calculateFixelAndSupplyDays("N",o);render(o),"Y"==g_show_live_image&&animate_all_pog(),g_mselect_drag="N",g_multiselect="N",g_delete_details=[],g_ctrl_select="N",g_dblclick_opened="N"}else{addLoadingIndicator();var ve=null!==sessionStorage.getItem("items_details")?JSON.parse(sessionStorage.getItem("items_details")):{},De=ve.PegID,Ce=ve.PegSpread,Te=ve.Fixed,be=ve.Orientation,je=ve.MerchStyle,Ne=(s=ve.Color,g=parseInt(s.replace("#","0x"),16),l=new THREE.Color(g),ve.NestingVal),xe=ve.ItemNesting,Me=ve.NW,Re=ve.NH,Le=ve.ND,Ae=ve.CapStyle,ye=ve.CapFacing,$e=ve.CapMerch,we=ve.CapOrientaion,Ye=ve.CapDepth,Ge=ve.CapHorz,He=ve.CapMaxH,Fe=ve.MaxHCapStyle,Be=ve.MCapTopFacing,Ve=0==nvl(ve.OrientationChng)?"N":ve.OrientationChng,ke=0==nvl(ve.MerchChng)?"N":ve.MerchChng,We=0==nvl(ve.FixedChng)?"N":ve.FixedChng,Ue=0==nvl(ve.PegIdChng)?"N":ve.PegIdChng,Xe=0==nvl(ve.PegSpreadChng)?"N":ve.PegSpreadChng,ze=0==nvl(ve.ColorChng)||void 0!==ve.OldColor&&ve.Color==ve.OldColor?"N":ve.ColorChng,Je=0==nvl(ve.POGMaxVFacingChng)?"N":ve.POGMaxVFacingChng,Ke=0==nvl(ve.POGMaxHFacingChng)?"N":ve.POGMaxHFacingChng,qe=0==nvl(ve.POGMaxDFacingChng)?"N":ve.POGMaxDFacingChng,Ze=0==nvl(ve.CapStyleChng)?"N":ve.CapStyleChng,Qe=0==nvl(ve.CapMaxHChng)?"N":ve.CapMaxHChng,eo=0==nvl(ve.MaxHCapStyleChng)?"N":ve.MaxHCapStyleChng,oo=0==nvl(ve.CapDepthChanged)?"N":ve.CapDepthChanged,_o=0==nvl(ve.CapMerchChng)?"N":ve.CapMerchChng,no=0==nvl(ve.CapOrientaionChng)?"N":ve.CapOrientaionChng,to=0==nvl(ve.CapFacingChng)?"N":ve.CapFacingChng,io=0==nvl(ve.ItemNestingChng)?"N":ve.ItemNestingChng,ao="N";K=[],q=0,Z=-1;if(g_delete_details.length>0)for(const e of g_delete_details){var so,go;if((so=g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].SObjID)!==Z)Z=g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].SObjID,(go=[]).moduleIndex=e.MIndex,go.module=g_pog_json[o].ModuleInfo[e.MIndex].Module,go.shelfIndex=e.SIndex,go.actionType="ITEM_DELETE",go.startCanvas=g_start_canvas,go.objectID=so,go.g_deletedItems=K,go.moduleObjectID=g_pog_json[o].ModuleInfo[e.MIndex].MObjID,go.push(JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex]))),g_allUndoObjectsInfo.push(go);q++}if(g_delete_details.length>0){for(const e of g_delete_details)"ITEM"==e.Object&&(e.ItemInfo=[],e.ItemInfo.push(JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex]))));for(const e of g_delete_details)if("ITEM"==e.Object){oe="N";valid="N";if(""!==De&&"Y"==Ue&&(g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].PegID=De,!(void 0===De&&""===De||"Y"!=g_show_peg_tags||"HANGINGBAR"!=g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ObjType&&"PEGBOARD"!=g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ObjType))){var lo=(Pe=g_scene_objects[o].scene.children[2].getObjectById(e.ObjID)).children,ro=[];if(void 0!==Pe){for(var co of lo)"peg_tag"==co.uuid&&ro.push(co.id);for(var fo of ro){var Io=Pe.getObjectById(fo);Pe.remove(Io)}render(o);show_pegTages("N",g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.ShelfIndex].ItemInfo[e.IIndex],Pe,e.MIndex,e.SIndex,e.IIndex,o)}}de=g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex];void 0!==ve.OrgUW&&""!==ve.OrgUW&&"Y"==ve.UWchgInd&&(de.OrgUW=ve.OrgUW,de.UW=ve.OrgUW,valid="Y"),void 0!==ve.OrgUH&&""!==ve.OrgUH&&"Y"==ve.UHchgInd&&(de.OrgUH=ve.OrgUH,de.UH=ve.OrgUH,valid="Y"),void 0!==ve.OrgUD&&""!==ve.OrgUD&&"Y"==ve.UDchgInd&&(de.OrgUD=ve.OrgUD,de.UD=ve.OrgUD,valid="Y"),void 0!==ve.OrgTW&&""!==ve.OrgTW&&"Y"==ve.TWchgInd&&(de.OrgTW=ve.OrgTW,valid="Y"),void 0!==ve.OrgTH&&""!==ve.OrgTH&&"Y"==ve.THchgInd&&(de.OrgTH=ve.OrgTH,valid="Y"),void 0!==ve.OrgTD&&""!==ve.OrgTD&&"Y"==ve.TDchgInd&&(de.OrgTD=ve.OrgTD,valid="Y"),void 0!==ve.OrgDW&&""!==ve.OrgDW&&"Y"==ve.DWchgInd&&(de.OrgDW=ve.OrgDW,valid="Y"),void 0!==ve.OrgDH&&""!==ve.OrgDH&&"Y"==ve.DHchgInd&&(de.OrgDH=ve.OrgDH,valid="Y"),void 0!==ve.OrgDD&&""!==ve.OrgDD&&"Y"==ve.DDchgInd&&(de.OrgDD=ve.OrgDD,valid="Y"),void 0!==ve.OrgCW&&""!==ve.OrgCW&&"Y"==ve.CWchgInd&&(de.OrgCW=ve.OrgCW,valid="Y"),void 0!==ve.OrgCH&&""!==ve.OrgCH&&"Y"==ve.CHchgInd&&(de.OrgCH=ve.OrgCH,valid="Y"),void 0!==ve.OrgCD&&""!==ve.OrgCD&&"Y"==ve.CDchgInd&&(de.OrgCD=ve.OrgCD,valid="Y"),void 0!==ve.OrgCWPerc&&""!==ve.OrgCWPerc&&"Y"==ve.RWchgInd&&(de.OrgCWPerc=ve.OrgCWPerc,de.CWPerc=ve.OrgCWPerc,valid="Y"),void 0!==ve.OrgCHPerc&&""!==ve.OrgCHPerc&&"Y"==ve.RHchgInd&&(de.OrgCHPerc=ve.OrgCHPerc,de.CHPerc=ve.OrgCHPerc,valid="Y"),void 0!==ve.OrgCDPerc&&""!==ve.OrgCDPerc&&"Y"==ve.RDchgInd&&(de.OrgCDPerc=ve.OrgCDPerc,de.CDPerc=ve.OrgCDPerc,valid="Y"),void 0!==ve.CnW&&""!==ve.CnW&&"Y"==ve.OWchgInd&&(de.CnW=ve.CnW,valid="Y"),void 0!==ve.CnH&&""!==ve.CnH&&"Y"==ve.OHchgInd&&(de.CnH=ve.CnH,valid="Y"),void 0!==ve.CnD&&""!==ve.CnD&&"Y"==ve.ODchgInd&&(de.CnD=ve.CnD,valid="Y");var[po,ho,uo,mo,Oo,So]=get_new_orientation_dim(de.Orientation);if(void 0!==ve.CWPerc&&""!==ve.CWPerc&&0!==ve.CWPerc){de.CWPerc=ve.CWPerc;var Po="N";void 0!==ve.MHorizCrushed&&"Y"==ve.MHorizCrushed?(Po="Y","W"==Oo?de.MHorizCrushed="Y":"W"==mo?de.MVertCrushed="Y":"W"==So&&(de.MDepthCrushed="Y")):de.MHorizCrushed="N",valid="Y","Y"==Po&&(de.CrushHoriz=ve.CrushHoriz),await crushItem(o,e.MIndex,e.SIndex,e.IIndex,"W","Y",-1,-1)}if(void 0!==ve.CHPerc&&""!==ve.CHPerc&&0!==ve.CHPerc){de.CHPerc=ve.CHPerc;var Eo="N";void 0!==ve.MVertCrushed&&"Y"==ve.MVertCrushed?(Eo="Y","H"==Oo?de.MHorizCrushed="Y":"H"==mo?de.MVertCrushed="Y":"H"==So&&(de.MDepthCrushed="Y")):de.MVertCrushed="N","Y"==Eo&&(de.CrushVert=ve.CrushVert),valid="Y",await crushItem(o,e.MIndex,e.SIndex,e.IIndex,"H","Y",-1,-1)}if(void 0!==ve.CDPerc&&""!==ve.CDPerc&&0!==ve.CDPerc){de.CDPerc=ve.CDPerc;var vo="N";void 0!==ve.MDepthCrushed&&"Y"==ve.MDepthCrushed?(vo="Y","D"==Oo?de.MHorizCrushed="Y":"D"==mo?de.MVertCrushed="Y":"D"==So&&(de.MDepthCrushed="Y")):de.MDepthCrushed="N","Y"==vo&&(de.CrushD=ve.CrushD),valid="Y",await crushItem(o,e.MIndex,e.SIndex,e.IIndex,"D","Y",[de.D],[e.IIndex])}if("Y"==Je&&void 0!==ve.MPogVertFacings&&""!==ve.MPogVertFacings&&0!==ve.MPogVertFacings&&(de.MPogVertFacings=ve.MPogVertFacings,valid="Y"),"Y"==Ke&&void 0!==ve.MPogHorizFacings&&""!==ve.MPogHorizFacings&&0!==ve.MPogHorizFacings&&(de.MPogHorizFacings=ve.MPogHorizFacings,valid="Y"),"Y"==qe&&void 0!==ve.MPogDepthFacings&&""!==ve.MPogDepthFacings&&0!==ve.MPogDepthFacings&&(de.MPogDepthFacings=ve.MPogDepthFacings,valid="Y"),"Y"==Xe&&""!==Ce&&(de.PegSpread=Ce,valid="Y"),"Y"==ze&&""!==s)de.Color=s,de.ShowColorBackup=s,(Pe=g_scene_objects[o].scene.children[2].getObjectById(e.ObjID)).material.color=l,valid="Y";if("Y"==We&&""!==Te&&(de.Fixed=Te,valid="Y"),"Y"==Ve&&""!==be&&(de.Orientation=be,de.OrientationDesc=$("#P25_ITEM_ORIENTATION :selected").text(),await get_edit_item_img(e.MIndex,e.SIndex,e.IIndex,de,be,de.MerchStyle,o),valid="Y"),"Y"==ke&&""!==je&&(de.MerchStyle=je,valid="Y"),void 0!==Me&&"Y"==ve.NWchgInd&&(de.NW=Me,de.OrgNW=Me),void 0!==Re&&"Y"==ve.NHchgInd&&(de.NH=Re,de.OrgNH=Re),void 0!==Le&&"Y"==ve.NDchgInd&&(de.ND=Le,de.OrgND=Le),"Y"===io&&""!=xe||(de.ItemNesting=xe,de.NVal="W"==xe?de.NW:"H"==xe?de.NH:"D"==xe?de.ND:0,valid="Y"),"Y"!=io||""===Ne||"H"!=xe&&"W"!=xe&&"D"!=xe||("Y"==ve.NWchgInd||"Y"==ve.NHchgInd||"Y"==ve.NDchgInd?0==Ne?(de.NVal=Ne,de.ItemNesting=""):(de.NVal=Ne,de.ItemNesting=xe):(0==Ne&&("W"==xe?de.NVal=de.NW:"H"==xe?de.NVal=de.NH:"D"==xe&&(de.NVal=de.ND)),de.ItemNesting=xe),valid="Y"),"Y"==Qe&&(de.CapMaxH=He,valid="Y"),"Y"==eo&&(de.MaxHCapStyle=Fe,valid="Y"),"Y"!=Ze&&"1"!=Ae&&"2"!=Ae&&"3"!=Ae||(de.CapStyle=Ae,"Y"==to&&(de.CapFacing=ye),"Y"==_o&&(de.CapMerch=$e),"Y"==no&&(de.CapOrientaion=we),"Y"==oo&&(de.CapDepth=Ye),await get_edit_item_img(e.MIndex,e.SIndex,e.IIndex,de,de.CapOrientaion,de.CapMerch,o),de.CapHorz=Ge,de.MCapTopFacing=Be,de.CapDepthChanged=oo,valid="Y"),"Y"==valid){de=g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex];"SHELF"==(_e=g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex]).ObjType&&"Y"==ve.ShelfAutoCrush&&(_e.AllowAutoCrush="Y");var[Do,Co,To]=get_select_dim(de);if("F"==g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].SpreadItem&&(ce=g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo,$.each(ce,(function(e,o){o.W=o.RW}))),0==Do||0==Co||0==To){alert(get_message("DIM_NOT_NULL")),e.Recreate="N",ao="Y",e.Valid="N";break}const[_,n,t,i,a,s]=set_dim_validate_item(e.MIndex,e.SIndex,e.IIndex,Do,Co,To,de.ItemNesting,de.NVal,de.BHoriz,de.BVert,de.BaseD,de.Orientation,de.OrgCWPerc,de.OrgCHPerc,de.OrgCDPerc,"Y","Y","N",o);if("ERROR"===_){e.Recreate="N",ao="Y",e.Valid="N";break}var[bo,jo]=get_item_xy(_e,de,_,n,o),No=g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex];No.X=bo,No.Y=jo,No.Exists="E",No.W=_,No.H=n,No.D=t,No.RW=i,No.RH=a,No.RD=s,No.OW=Do,No.OH=Co,No.OD=To;de=No;update_top_bottom_xy(e.MIndex,e.SIndex,e.IIndex,de,o),e.Recreate="Y",e.Valid="Y"}else e.Recreate="N"}if("N"==ao){var xo,Mo={},Ro=(de=g_delete_details,[]);for(q=0;xo=de[q++];)if("ITEM"==xo.Object&&"Y"==xo.Recreate){var Lo;if(!((Lo=xo.SIndex+"-"+xo.MIndex)in Mo)){Mo[Lo]=1;var Ao={};Ao.SIndex=xo.SIndex,Ao.MIndex=xo.MIndex,Ao.ObjType=xo.ObjType,Ro.push(Ao)}}for(const e of Ro)if(reorder_items(e.MIndex,e.SIndex,o)){if("SHELF"==e.ObjType)reset_top_bottom_objects(e.MIndex,e.SIndex,"N",o);ge=await recreate_all_items(e.MIndex,e.SIndex,e.ObjType,"Y",-1,-1,g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo.length,"N","N",-1,-1,g_start_canvas,"",o,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")}removeLoadingIndicator(regionloadWait),apex.message.showPageSuccess(g_item_shelf_updated_msg),render(o),async function(){await recreate_compare_views(g_compare_view,"N")}()}else{for(const e of g_delete_details)"ITEM"==e.Object&&void 0!==e.ItemInfo&&(g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex]=e.ItemInfo[0]);removeLoadingIndicator(regionloadWait)}}logFinalUndoObjectsInfo("SHELF_DRAG","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","N"),g_allUndoObjectsInfo=[],g_mselect_drag="N",g_multiselect="N",g_delete_details=[],g_ctrl_select="N",g_dblclick_opened="N",logDebug("function : manage_multi_edit","E")}}catch(e){error_handling(e)}}function context_multi_edit(e){logDebug("function : context_multi_edit; edit_type : "+e,"S");try{new_details=JSON.parse(JSON.stringify(g_delete_details));for(const e of new_details)e.ShelfInfo="";if(("Y"==g_multiselect||"Y"==g_ctrl_select)&&new_details.length>0)if("P"==e){var o={};o.g_multiselect=g_multiselect,o.g_ctrl_select=g_ctrl_select,o.delete_details=new_details,o.g_carpark_item_flag=g_carpark_item_flag,sessionStorage.setItem("items_details",JSON.stringify(o)),openCustomDialog("OPEN_PRODUCT",$v("P25_PRODUCT_DETAILS_URL"),"P25_PRODUCT_DETAILS_TRIGGER")}else{var _=[],n={};if((JsonContainsAll(new_details,{Object:"SHELF",ObjType:"TEXTBOX"})&&JsonContainsAll(new_details,{Object:"ITEM",ObjType:"SHELF"})||JsonContainsAll(new_details,{Object:"SHELF",ObjType:"TEXTBOX"}))&&!JsonContainsAll(new_details,{Object:"SHELF",ObjType:"SHELF"})){const e=["P25_TEXT_WIDTH","P25_TEXT_HEIGHT","P25_TEXT_COLOR","P25_TEXT_SLOPE","P25_TEXT_ROTATION","P25_FONT_STYLE","P25_FONT_SIZE","P25_BOLD","P25_TEXT","P25_WRAP_TEXT","P25_REDUCETOFIT","P25_IMG_FILENAME"];for(const o of e)$("#"+o+"_CONTAINER .inc_tag_icon").remove(),$("#"+o).removeClass("apex-item-has-icon"),$("#"+o+"_CONTAINER").removeClass("apex-item-wrapper--has-icon");if($s("P25_IMG_FILENAME",""),$("#IMAGE_AREA canvas").remove(),$("#VIEW_IMAGE canvas").remove(),n.g_multiselect=g_multiselect,n.g_ctrl_select=g_ctrl_select,n.delete_details=new_details,n.g_carpark_item_flag=g_carpark_item_flag,_.push(n),setIconForInconsistentTag(_[0].delete_details,"W","P25_TEXT_WIDTH","S"),setIconForInconsistentTag(_[0].delete_details,"H","P25_TEXT_HEIGHT","S"),setIconForInconsistentTag(_[0].delete_details,"Color","P25_TEXT_COLOR","S"),setIconForInconsistentTag(_[0].delete_details,"Slope","P25_TEXT_SLOPE","S"),setIconForInconsistentTag(_[0].delete_details,"Rotation","P25_TEXT_ROTATION","S"),setIconForInconsistentTag(_[0].delete_details,"FStyle","P25_FONT_STYLE","S"),setIconForInconsistentTag(_[0].delete_details,"FSize","P25_FONT_SIZE","S"),setIconForInconsistentTag(_[0].delete_details,"FBold","P25_BOLD","S"),setIconForInconsistentTag(_[0].delete_details,"InputText","P25_TEXT","S"),setIconForInconsistentTag(_[0].delete_details,"WrapText","P25_WRAP_TEXT","S","Y"),setIconForInconsistentTag(_[0].delete_details,"ReduceToFit","P25_REDUCETOFIT","S","Y"),setIconForInconsistentTag(_[0].delete_details,"TextDirection","P25_TEXT_DIRECTION","S"),checkValueConsistency(_[0].delete_details,"TextImg","","S")){var t={};if(t.FileName=_[0].delete_details[0].TextImgFilename,t.MimeType=_[0].delete_details[0].TextImgMimeType,t.Image=_[0].delete_details[0].TextImg,g_temp_image_arr.push(t),g_temp_image_arr.length>0){var i=new Image;i.src="data:image/png;base64,"+g_temp_image_arr[0].Image,i.onload=function(){const e=document.createElement("canvas");e.width=500,e.height=100;e.getContext("2d").drawImage(i,0,0,500,100),$("#VIEW_IMAGE canvas").remove(),document.getElementById("VIEW_IMAGE").append(e)}}}else $s("P25_IMG_FILENAME",""),$("#IMAGE_AREA canvas").remove(),$("#VIEW_IMAGE canvas").remove(),$("#P25_IMG_FILENAME_CONTAINER").addClass("apex-item-wrapper--has-icon"),$("#P25_IMG_FILENAME").addClass("apex-item-has-icon"),$("#P25_IMG_FILENAME").after('<span class="inc_tag_icon apex-item-icon fa fa-exclamation-triangle-o" aria-hidden="true"></span>');$s("P25_TEXT_ID","Mixed"),$s("P25_TEXT_NAME","Mixed"),$("#P25_TEXT_ID, #P25_TEXT_NAME").addClass("apex_disabled"),$s("P25_SHELF_EDIT_IND","Y"),openInlineDialog("add_textbox",75,85)}else n.g_multiselect=g_multiselect,n.g_ctrl_select=g_ctrl_select,n.delete_details=new_details,n.g_carpark_item_flag=g_carpark_item_flag,_.push(n),sessionStorage.setItem("shelf_arr",JSON.stringify(_)),openCustomDialog("SHELF_EDIT",$v("P25_SHELF_URL"),"P25_SHELF_TRIGGER_ELEMENT")}logDebug("function : context_multi_edit","E")}catch(e){error_handling(e)}}function clearUndoRedoInfo(){try{logDebug("function : clearUndoRedoInfo","S"),g_undo_final_obj_arr=[],g_redo_final_obj_arr=[],g_undo_all_obj_arr=[],g_redo_all_obj_arr=[],g_undo_details=[],g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_support_obj_arr=[],g_cut_loc_arr=[],g_cut_copy_arr=[],g_undoRedoAction="REDO",logDebug("function : clearUndoRedoInfo","E")}catch(e){error_handling(e)}}async function edit_pallet_init(){try{logDebug("function : edit_pallet_init","S"),"Y"==g_shelf_edit_flag&&"PALLET"==g_shelf_object_type?(g_ComViewIndex>-1&&"Y"==g_compare_pog_flag&&g_pog_json.splice(g_ComViewIndex,1),g_pog_index!==g_ComViewIndex&&(addLoadingIndicator(),await edit_pallet("Y",g_module_index,g_shelf_index,g_pog_index,"Y"),removeLoadingIndicator(regionloadWait))):alert(get_message("POGCR_EDIT_PALLET_ERR")),logDebug("function : edit_pallet_init","E")}catch(e){error_handling(e)}}function add_pallet_objects(e,o,_,n,t,i,a,s,g,l,r,d,c,f){try{logDebug("function : add_pallet_objects; uuid : "+e+"; width : "+o+"; height : "+_+"; depth : "+n+"; color : "+t+"; x : "+i+"; y : "+a+"; p_module_index : "+s+"; p_shelf_index : "+g,"S"),g_shelf=new THREE.Mesh(new THREE.BoxGeometry(o,_,.001),new THREE.MeshStandardMaterial({color:t}));var I=add_wireframe(g_shelf,2);g_shelf.WFrameID=I,g_shelf.position.x=i,g_shelf.position.y=a,g_shelf.position.z=5e-4,g_shelf.uuid=e,g_shelf.FixelID=r.Shelf,g_shelf.Module=g_pog_json[c].ModuleInfo[s].Module,g_shelf.W=r.W,g_shelf.H=r.H,g_shelf.D=r.D,g_shelf.Color=r.Color,g_shelf.Rotation=0,g_shelf.ItemSlope=0,g_shelf.Rotation="N",g_shelf.ImageExists="N",g_scene_objects[f].scene.children[2].add(g_shelf),g_pog_json[f].ModuleInfo[0].ShelfInfo[0].SObjID=g_shelf.id,g_pog_json[c].ModuleInfo[s].ShelfInfo[g].CompShelfObjID=g_shelf.id;var p=0;for(const e of l){var h=parseInt(e.Color.replace("#","0x"),16),u=new THREE.Color(h);l=new THREE.Mesh(new THREE.BoxGeometry(e.W,e.D,.001),new THREE.MeshStandardMaterial({color:u}));var m=e.Distance+e.W/2,O=e.Z;l.position.x=m,l.position.y=O;var S=.001;""!==e.BottomObjID&&void 0!==e.BottomObjID&&(S+=S*(p/100)),l.position.z=S,l.uuid=e.Item;I=add_wireframe(l,2);g_scene_objects[f].scene.children[2].add(l);var P=0;for(const o of g_pog_json[f].ModuleInfo[0].ShelfInfo[0].ItemInfo){if(e.ObjID==o.ObjID){void 0!==g_pog_json[c].ModuleInfo[s].ShelfInfo[g].ItemInfo[P]&&(g_pog_json[c].ModuleInfo[s].ShelfInfo[g].ItemInfo[P].CompItemObjID=l.id),g_pog_json[f].ModuleInfo[0].ShelfInfo[0].ItemInfo[P].BaseItemOldX=g_pog_json[f].ModuleInfo[0].ShelfInfo[0].ItemInfo[P].X,g_pog_json[f].ModuleInfo[0].ShelfInfo[0].ItemInfo[P].BaseItemOldZ=g_pog_json[f].ModuleInfo[0].ShelfInfo[0].ItemInfo[P].Z,g_pog_json[f].ModuleInfo[0].ShelfInfo[0].ItemInfo[P].ObjID=l.id,g_pog_json[f].ModuleInfo[0].ShelfInfo[0].ItemInfo[P].ObjID=l.id,g_pog_json[f].ModuleInfo[0].ShelfInfo[0].ItemInfo[P].X=m,g_pog_json[f].ModuleInfo[0].ShelfInfo[0].ItemInfo[P].Y=O,g_pog_json[f].ModuleInfo[0].ShelfInfo[0].ItemInfo[P].Z=S;break}P+=1}p++}logDebug("function : add_pallet_objects","E")}catch(e){error_handling(e)}}async function edit_pallet(e,o,_,n,t){logDebug("function : edit_pallet; create_main : "+e,"S");try{console.log("edit pallet called",e,o,_,n),"Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&g_scene_objects.splice(g_ComViewIndex,1);var i={};i.POGCode="PALLET_"+g_pog_json[n].POGCode,i.BaseH=g_pog_json[n].BaseH,i.ModuleInfo=[],g_pog_json.push(i);var a={};a.Module=g_pog_json[n].ModuleInfo[o].Module,a.H=g_pog_json[n].ModuleInfo[o].H,a.ShelfInfo=[],g_pog_json[g_pog_json.length-1].ModuleInfo.push(a),g_pog_json[g_pog_json.length-1].ModuleInfo[0].ShelfInfo.push(JSON.parse(JSON.stringify(g_pog_json[n].ModuleInfo[o].ShelfInfo[_]))),g_pog_json[g_pog_json.length-1].ModuleInfo[0].ShelfInfo[0].PrimeShelfObjID=g_pog_json[n].ModuleInfo[o].ShelfInfo[_].SObjID,g_comp_view_code=i.POGCode,g_comp_base_code=g_pog_json[n].POGCode,g_ComViewIndex=g_pog_json.length-1,g_ComBaseIndex=n,g_edit_pallet_mod_ind=o,g_edit_pallet_shelf_ind=_;var s=g_pog_json[n].ModuleInfo[o].ShelfInfo[_].SObjID;g_pog_json[g_ComViewIndex].ModuleInfo[0].ShelfInfo[0].PrimeShelfObjID=s,g_compare_pog_flag="Y",g_compare_view="EDIT_PALLET";JSON.parse(JSON.stringify(g_pog_json));"Y"==t&&appendMultiCanvasRowCol(g_pog_json.length,$v("P25_POGCR_TILE_VIEW")),init(g_ComViewIndex);var g={};g.scene=g_scene,g.renderer=g_renderer,g_scene_objects.push(g),set_indicator_objects(g_ComViewIndex),"Y"==t&&modifyWindowAfterMinMax(g_scene_objects);var l=g_pog_json[g_ComViewIndex].ModuleInfo[0].ShelfInfo[0],[r,d]=get_shelf_index(s,n);console.log("mod_ind, shelf_ind",r,d,s,n);var c=parseInt(l.Color.replace("#","0x"),16),f=new THREE.Color(c);add_pallet_objects(l.Shelf,l.W,l.D,l.H,f,l.W/2,l.D/2,r,d,l.ItemInfo,l,e,n,g_ComViewIndex),set_camera_z(g_scene_objects[g_ComViewIndex].scene.children[0],l.W/2,l.D/2,l.W,l.D,g_offset_z,l.W,l.D,!0,g_ComViewIndex),render(g_ComViewIndex),console.log("scene_objects 4",g_scene_objects[0].scene.uuid),"Y"==t&&add_pog_code_header(),g_pog_index=g_ComBaseIndex;var I=g_canvas_objects[g_ComBaseIndex].getAttribute("id");$("[data-pog]").removeClass("multiPogList_active"),$(".canvas_highlight").removeClass("canvas_highlight"),$("#"+I+"-btns").addClass("canvas_highlight"),$("[data-indx="+g_pog_index+"]").addClass("multiPogList_active"),g_edit_pallet_shelfid=s,logDebug("function : edit_pallet","E")}catch(e){error_handling(e)}}function check_item_hit(e,o,_,n,t){try{logDebug("function : check_item_hit; i_final_x : "+_+"; p_final_y : "+n,"S"),item_start=wpdSetFixed(_-o.W/2),item_end=wpdSetFixed(_+o.W/2),item_top=wpdSetFixed(n+o.D/2),item_bottom=wpdSetFixed(n-o.D/2);var i="Y";return $.each(e,(function(e,_){if(_.ObjID!==o.ObjID&&-1==t.indexOf(_.ObjID)&&(div_start=wpdSetFixed(_.X-_.W/2),div_end=wpdSetFixed(_.X+_.W/2),div_top=wpdSetFixed(_.Y+_.D/2),div_bottom=wpdSetFixed(_.Y-_.D/2),(div_start<item_end&&div_start>=item_start||div_end>item_start&&div_end<=item_end)&&(div_bottom<item_top&&div_bottom>=item_bottom||div_top<=item_top&&div_top>item_bottom)||(item_start<div_start&&item_end>div_start||item_start<div_end&&item_end>=div_end)&&item_top<=div_top&&item_bottom>=div_bottom||(div_start<=item_start&&div_end>=item_end||div_start>=item_start&&div_end<=item_end)&&(div_top>=item_top&&item_bottom>=div_bottom||div_top>=item_top&&div_bottom<=item_bottom||div_top>item_top&&div_bottom<=item_top)||item_start<div_start&&item_end>=div_end&&item_top<=div_top&&item_top>div_bottom&&item_bottom<=div_bottom||item_start>div_start&&item_end<=div_end&&item_top>=div_top&&item_bottom<div_top&&item_bottom<=div_bottom||item_start<div_start&&item_end>=div_end&&item_top<=div_top&&item_bottom>=div_bottom||item_start<div_start&&item_end>=div_end&&item_top<div_top&&item_top>div_bottom||item_start>=div_start&&item_start<div_end&&item_bottom>=div_bottom&&item_bottom<div_top))return i="N",!1})),logDebug("function : check_item_hit","E"),i}catch(e){error_handling(e)}}function update_item_edit_pallet(e,o,_,n,t,i,a,s){try{console.log(" edit pallet",e,o,_,n,t,i,a),logDebug("function : update_item_edit_pallet; i_final_x : "+e+"; p_final_y : "+o+"; p_module_index : "+_+"; p_shelf_index : "+n+"; i_item_index : "+t+"; i_item_edit_flag : "+i,"S");var g=g_pog_json[s].ModuleInfo[_].ShelfInfo[n].ItemInfo,l=g_pog_json[s].ModuleInfo[_].ShelfInfo[n].ItemInfo[t];g_temp_cut_arr=[];var r=[];if(g_drag_items_arr.length>0)for(const e of g_drag_items_arr)r.push(e.id);if(e<0||e+l.W/2>g_pog_json[s].ModuleInfo[0].ShelfInfo[0].W||o<0||o+l.D/2>g_pog_json[s].ModuleInfo[0].ShelfInfo[0].D)if(alert(get_message("ITEM_OUTSIDE_PEGBOARD",g_pog_json[s].ModuleInfo[0].ShelfInfo[0].Shelf)),g_drag_items_arr.length>0)for(const e of g_drag_items_arr)e.position.set(e.old_position_x,e.old_position_y,e.old_position_z);else void 0!==(S=g_scene_objects[s].scene.children[2].getObjectById(l.ObjID))&&(S.position.x=l.X,S.position.y=l.Y);else if("N"==check_item_hit(g,l,e,o,r)){if(alert(get_message("POGCR_ITEM_OVERLAP")),g_drag_items_arr.length>0)for(const e of g_drag_items_arr)e.position.set(e.old_position_x,e.old_position_y,e.old_position_z);else void 0!==(S=g_scene_objects[s].scene.children[2].getObjectById(l.ObjID))&&(S.position.x=l.X,S.position.y=l.Y)}else{if(g_drag_items_arr.length>0)for(const _ of g_drag_items_arr){var d=0;for(const e of g_pog_json[s].ModuleInfo[0].ShelfInfo[0].ItemInfo){if(e.ObjID==_.id){l=e,d;break}d++}l.old_position_x=l.X,l.old_position_y=l.Y,_.old_position_x=l.X,_.old_position_y=l.Y,g_temp_cut_arr.push(JSON.parse(JSON.stringify(l))),l.X=e,l.Y=o,l.X=e,l.Y=o,l.Distance=e-l.W/2;var[c,f,I]=get_item_index(l.ObjID,"C",a),p=g_pog_json[a].ModuleInfo[c].ShelfInfo[f].ItemInfo[I].X;g_pog_json[a].ModuleInfo[c].ShelfInfo[f].ItemInfo[I].Z=o;var h=g_pog_json[a].ModuleInfo[c].ShelfInfo[f],u=g_pog_json[a].ModuleInfo[c].ShelfInfo[f].ItemInfo[I],m=h.X-h.W/2+e;g_pog_json[a].ModuleInfo[c].ShelfInfo[f].ItemInfo[I].X=m;var O=(S=g_scene_objects[a].scene.children[2].getObjectById(u.ObjID)).position.z;g_pog_json[a].ModuleInfo[c].ShelfInfo[f].ItemInfo[I].BaseItemOldX=p,g_pog_json[a].ModuleInfo[c].ShelfInfo[f].ItemInfo[I].BaseItemOldZ=O,S.position.x=m,S.position.z=.001+g_pog_json[a].ModuleInfo[c].ShelfInfo[f].D/1e3-g_pog_json[a].ModuleInfo[c].ShelfInfo[f].ItemInfo[I].Z/1e3}else{l.old_position_x=l.X,l.old_position_y=l.Y,g_temp_cut_arr.push(JSON.parse(JSON.stringify(l))),l.X=e,l.Y=o,l.Distance=e-l.W/2;var[c,f,I]=get_item_index(l.ObjID,"C",a);p=g_pog_json[a].ModuleInfo[c].ShelfInfo[f].ItemInfo[I].X;g_pog_json[a].ModuleInfo[c].ShelfInfo[f].ItemInfo[I].Z=o;h=g_pog_json[a].ModuleInfo[c].ShelfInfo[f],u=g_pog_json[a].ModuleInfo[c].ShelfInfo[f].ItemInfo[I],m=h.X-h.W/2+e;g_pog_json[a].ModuleInfo[c].ShelfInfo[f].ItemInfo[I].X=m;var S;O=(S=g_scene_objects[a].scene.children[2].getObjectById(u.ObjID)).position.z;S.position.x=m,S.position.z=.001+g_pog_json[a].ModuleInfo[c].ShelfInfo[f].D/1e3-g_pog_json[a].ModuleInfo[c].ShelfInfo[f].ItemInfo[I].Z/1e3,update_item_distance(c,f,a)}undoObjectsInfo=[],undoObjectsInfo.moduleIndex=_,undoObjectsInfo.shelfIndex=n,undoObjectsInfo.actionType="DRAG_ITEM",undoObjectsInfo.startCanvas=s,undoObjectsInfo.BaseItemOldZ=O,undoObjectsInfo.g_drag_items_arr=g_temp_cut_arr,undoObjectsInfo.objectID=g_pog_json[s].ModuleInfo[_].ShelfInfo[n].SObjID,undoObjectsInfo.module=g_pog_json[s].ModuleInfo[_].Module,undoObjectsInfo.moduleObjectID=g_pog_json[s].ModuleInfo[_].MObjID,undoObjectsInfo.push(JSON.parse(JSON.stringify(g_pog_json[s].ModuleInfo[_].ShelfInfo[n]))),g_allUndoObjectsInfo.push(undoObjectsInfo),logFinalUndoObjectsInfo("DRAG_ITEM","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","Y",g_carpark_item_flag),g_delete_details=[],g_temp_cut_arr=[],undoObjectsInfo=[],g_allUndoObjectsInfo=[]}calculateFixelAndSupplyDays("N",a);render(a),logDebug("function : update_item_edit_pallet","E")}catch(e){error_handling(e)}}async function uploadFile(e){try{logDebug("function : uploadFile; pFileIndex : "+e,"S");var o=document.getElementById("P25_UPLOAD_PDF"),_=(document.getElementById("P25_UPLOAD_PDF").innerHTML,0),n=o.files[_];if(!n)return;validate_file_type(n.name);var t=new FileReader;validate_file_type(n.name)&&(t.onload=(i=n,function(e){if(i){var t=binaryArray2base64(e.target.result),a=[];a=clob2Array(t,3e4,a),apex.server.process("UPLOAD_FILE",{x01:n.name,x02:n.type,f01:a},{dataType:"json",success:function(e){"success"==e.result?++_<o.files.length?uploadFile(_):(o.value="",$s("P25_FILE_NAME",n.name),g_pog_json[p_pog_index].UploadedPDF="Y",g_upload_file_flag="Y",logDebug("function : uploadFile","E")):alert(get_message("INTERNAL_ERROR"))},loadingIndicatorPosition:"page"})}}),t.readAsArrayBuffer(n))}catch(e){error_handling(e)}var i}function get_pog_file(e,o){try{return logDebug("function : get_pog_file; pog_code : "+e+"; pog_draft : "+o,"S"),new Promise((function(_,n){JSON.stringify(g_pog_json);apex.server.process("GET_POG_FILE",{x01:e,x02:o},{dataType:"text",success:function(e){""!=$.trim(e)&&($s("P25_FILE_NAME",$.trim(e)),logDebug("function : get_pog_file","E"),_($.trim(e)))},loadingIndicatorPosition:"page"})}))}catch(e){error_handling(e)}}function validate_bookend(e,o,_,n,t,i,a){try{logDebug("function : validate_bookend; shelfIndex : "+o+"; moduleIndex : "+_+"; itemIndex : "+n+"; finalX : "+t+"; movedItemWidth : "+i+"; objID : "+a,"S");var g,l,r=[],d=[],c=(i=i,{}),f=g_pog_json[p_pog_index].ModuleInfo[_].ShelfInfo[o].X-g_pog_json[p_pog_index].ModuleInfo[_].ShelfInfo[o].W/2,I=g_pog_json[p_pog_index].ModuleInfo[_].ShelfInfo[o].X+g_pog_json[p_pog_index].ModuleInfo[_].ShelfInfo[o].W/2,p=t+i/2,h=t-i/2,u=0,m=-1,O="N",S="N",P=[],E="N",v="Y",D="N";for(items of e)items.ObjID==a&&"B"==items.Fixed&&(S="Y"),0==u&&r.push(f),m=items.X+items.W/2,"B"==items.Fixed&&m<t&&items.ObjID!==a&&(r.push(items.X+items.W/2),O="Y"),u++;var C=0;for(items1 of(g=Math.max.apply(Math,r),e))C==e.length-1&&d.push(I),m=items1.X-items1.W/2,"B"==items1.Fixed&&m>t&&m>g&&items1.ObjID!==a&&(d.push(items1.X-items1.W/2),O="Y"),C++;l=Math.min.apply(Math,d);var T=0,b=0,j=0;for(items2 of e)items2.X>g&&items2.X<l&&(c.ItemID=items2.ItemID,c.IIndex=j,c.W=items2.W,c.ItemStart=items2.X-items2.W/2,c.ItemEnd=items2.X+items2.W/2,c.X=items2.X,c.ObjID=items2.ObjID,P.push(c),T+=items2.W,c={}),j++;g_itemDragX>g&&g_itemDragX<l||g_itemDragX<g&&g_itemDragX>l?(b=l-g,E="Y"):(E="N",c.ItemID="",c.IIndex="",c.W=i,b=l-g-T);var N=g;if("Y"==S&&"N"==E)for(s of P)s.W<h-N&&"N"==D?N+=s.W:s.W<l-p?(p+=s.W,D="Y"):(v="N",D="Y");else for(s of P)if(s.ObjID!==a)if(s.W<h-N&&"N"==D)N+=s.W;else{if(!(s.W<l-p)){v="N",D="Y";break}p+=s.W,D="Y"}return logDebug("function : validate_bookend","E"),"Y"==O&&(b<i||"N"==v)?"N":"Y"}catch(e){error_handling(e)}}async function updateObjID(e,o,_,n,t){try{logDebug("function : updateObjID; oldObjID : "+e+"; newObjID : "+o+"; updType : "+_,"S");var i=0;if("M"==_){for(undo of g_undo_final_obj_arr){var a=0;for(undoDet of undo[0])void 0!==undoDet.module&&"undefined"!==e&&undoDet.module.toLowerCase()==e.toLowerCase()&&(g_undo_final_obj_arr[i][0][a].moduleIndex=o),a++;i++}i=0;for(redo of g_redo_final_obj_arr){a=0;for(redoDet of redo[0])void 0!==redoDet.module&&void 0!==e&&redoDet.module.toLowerCase()==e.toLowerCase()&&(g_redo_final_obj_arr[i][0][a].moduleIndex=o),a++;i++}if(g_combinedShelfs.length>0){i=0;for(combination of g_combinedShelfs){for(shelf of combination)shelf.MObjID==e&&(shelf.MObjID=o);i++}}}else{for(undo of g_undo_final_obj_arr){a=0;for(undoDet of undo[0])undoDet.objectID==e&&(g_undo_final_obj_arr[i][0][a].objectID=o),a++;i++}i=0;for(redo of g_redo_final_obj_arr){a=0;for(redoDet of redo[0])redoDet.objectID==e&&(g_redo_final_obj_arr[i][0][a].objectID=o),a++;i++}if(g_combinedShelfs.length>0){i=0;for(combination of g_combinedShelfs){for(shelf_info of combination){if(shelf_info.SObjID==e){shelf_info.SObjID=o;break}0}i++}if(void 0!==n){i=0;for(combination of g_combinedShelfs){for(shelf_info of combination)shelf_info.Shelf==n&&(shelf_info.Shelf=t);i++}}}}logDebug("function : updateObjID","E")}catch(e){error_handling(e)}}function set_pog_page_items(e){try{logDebug("function : set_pog_page_items","S"),apex.item("P25_POG_WIDTH").setValue((100*g_pog_json[e].W).toFixed(2)),apex.item("P25_POG_DEPTH").setValue((100*g_pog_json[e].D).toFixed(2)),apex.item("P25_BACK_DEPTH").setValue((100*g_pog_json[e].BackDepth).toFixed(2)),"NaN"!==(100*g_pog_json[e].SegmentW).toFixed(2)&&apex.item("P25_POG_SEGMENT_WIDTH").setValue((100*g_pog_json[e].SegmentW).toFixed(2)),apex.item("P25_TRAFFIC_FLOW").setValue(g_pog_json[e].TrafficFlow),apex.item("P25_POG_BASE_HEIGHT").setValue((100*g_pog_json[e].BaseH).toFixed(2)),apex.item("P25_POG_BASE_WIDTH").setValue((100*g_pog_json[e].BaseW).toFixed(2)),apex.item("P25_POG_BASE_DEPTH").setValue((100*g_pog_json[e].BaseD).toFixed(2)),apex.item("P25_POG_NOTCH_WIDTH").setValue((100*g_pog_json[e].NotchW).toFixed(2)),apex.item("P25_POG_NOTCH_START").setValue((100*g_pog_json[e].NotchStart).toFixed(2)),apex.item("P25_POG_NOTCH_SPACING").setValue((100*g_pog_json[e].NotchSpacing).toFixed(2)),apex.item("P25_POG_COLOR").setValue(g_pog_json[e].Color),apex.item("P25_HORZ_START").setValue((100*g_pog_json[e].HorzStart).toFixed(2)),apex.item("P25_HORZ_SPACING").setValue((100*g_pog_json[e].HorzSpacing).toFixed(2)),apex.item("P25_POG_VERT_START").setValue((100*g_pog_json[e].VertStart).toFixed(2)),apex.item("P25_POG_VERT_SPACING").setValue((100*g_pog_json[e].VertSpacing).toFixed(2)),apex.item("P25_ALLOW_OVERLAP").setValue(g_pog_json[e].AllowOverlap),apex.item("P25_SPECIAL_TYPE").setValue(g_pog_json[e].SpecialType),apex.item("P25_SPECIAL_TYPE_DESC").setValue(g_pog_json[e].SpecialTypeDesc),apex.item("P25_DISPLAY_METERAGE").setValue(g_pog_json[e].DisplayMeterage),apex.item("P25_RPT_METERAGE").setValue(g_pog_json[e].RPTMeterage),apex.item("P25_EFF_START_DATE").setValue(g_pog_json[e].EffStartDate),apex.item("P25_BRAND_GROUP_ID").setValue(g_pog_json[e].BrandGroupID),apex.item("P25_REMARKS").setValue(g_pog_json[e].Remarks),apex.item("P25_STORE_SEGMENT").setValue(g_pog_json[e].StoreSegment),apex.item("P25_DESC_7").setValue(g_pog_json[e].Desc7),apex.item("P25_AREA").setValue(g_pog_json[e].Area),apex.item("P25_PLN_DEPT").setValue(g_pog_json[e].PLNDept),g_isPogItemsSet="Y",logDebug("function : set_pog_page_items","E")}catch(e){error_handling(e)}}async function showItemDescription(){try{logDebug("function : showItemDescription","S");var e,o=g_pog_index;if("N"==g_show_item_desc?(g_show_item_desc="Y",$(".item_desc").addClass("item_label_active")):(g_show_item_desc="N",$(".item_desc").removeClass("item_label_active")),"Y"==g_all_pog_flag)var _=0;else _=g_pog_index;"Y"==g_show_days_of_supply&&"Y"==g_show_item_desc&&(g_show_days_of_supply="N",$(".supply_days").removeClass("item_label_active"));for(const o of g_pog_json){if(_!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex){if(g_renderer=g_scene_objects[_].renderer,g_scene=g_scene_objects[_].scene,g_camera=g_scene_objects[_].scene.children[0],g_world=g_scene_objects[_].scene.children[2],e=g_show_item_desc,"Y"==g_scene_objects[_].Indicators.LiveImage){g_scene_objects[_].Indicators.LiveImage="N";await recreate_image_items("N",$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_NOTCH_HEAD"),_,"N","Y",g_hide_show_dos_label);g_show_live_image="N"}g_scene_objects[_].Indicators.ItemDesc=e;await showHideItemDescription(e,$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),_),await showHideDaysOfSupplyLabel("N","N",_,"Y","Y",$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label);set_indicator_objects(_)}if("Y"!=g_all_pog_flag)break;_++}"Y"==g_show_live_image&&(g_show_live_image="N",$(".live_image").removeClass("live_image_active")),g_renderer=g_scene_objects[o].renderer,g_scene=g_scene_objects[o].scene,g_camera=g_scene_objects[o].scene.children[0],g_world=g_scene_objects[o].scene.children[2],g_prev_undo_action="ITEM_DESC",logDebug("function : showItemDescription","E")}catch(e){error_handling(e)}}function checkSelected(e){try{logDebug("function : checkSelected; ig_static_id : "+e,"S");var o=apex.region(e).widget().interactiveGrid("getViews","grid").model;if(0==(_=$v("P25_SELECTED_RECORDS").split(":")).length&&""!==sessionStorage.getItem("pog_list"))var _=sessionStorage.getItem("pog_list").split(":");var n=o.getFieldKey("POG_CODE"),t=[];o.forEach((function(e,a,s){var g=e[n];o.getRecordMetadata(s);for(i=0;i<_.length;i++)g==_[i]&&t.push(e)})),_.length>1&&apex.region(e).widget().interactiveGrid("setSelectedRecords",t),logDebug("function : checkSelected","E")}catch(e){error_handling(e)}}async function showItemColor(e,o){try{if(logDebug("function : showItemColor; p_type : "+e,"S"),console.log("item color",e,o),"Y"==g_show_live_image&&($(".live_image").removeClass("live_image_active"),g_show_live_image="N"),g_color_arr=[],$s("P25_SELECT_COLOR_TYPE",e),old_pogIndex=o,"Y"==g_all_pog_flag)var _=0;else _=o;for(const o of g_pog_json){if(g_ComViewIndex>-1||-1==g_ComViewIndex){if(g_world=g_scene_objects[_].scene.children[2],g_camera=g_scene_objects[_].scene.children[0],"OFF"!==e){g_show_item_color="Y",g_scene_objects[_].Indicators.LiveImage="N",g_scene_objects[_].Indicators.canvas_color_flag=e;await recreate_image_items("N",$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_NOTCH_HEAD"),_,"N","",g_hide_show_dos_label);$("#item_group_sub a").removeClass("item_color_active"),$("."+e).addClass("item_color_active");await generateItemColors(e,_)}else g_show_item_color="N",g_scene_objects[_].Indicators.canvas_color_flag="",$s("P25_SELECT_COLOR_TYPE",null),$("#item_group_sub a").removeClass("item_color_active"),$(".item_color_legends").css("display","none"),ShowColorBackup(_);g_scene_objects[_].Indicators.ItemColor=g_show_item_color}if("Y"!=g_all_pog_flag)break;_++}return g_world=g_scene_objects[old_pogIndex].scene.children[2],g_camera=g_scene_objects[old_pogIndex].scene.children[0],new Promise((function(o,_){console.log("g_color_arr",g_color_arr),apex.server.process("CREATE_ITEMS_COLOR_COLL",{x01:e,p_clob_01:JSON.stringify(g_color_arr)},{dataType:"text",success:function(e){""!=$.trim(e)&&(g_color_arr=[]),logDebug("function : generateItemColors","E")}})}))}catch(e){error_handling(e)}}async function item_grouping(p_pog_index,p_type){try{logDebug("function : item_grouping; p_type : "+p_type,"S");var prev_desc="",prev_supplier=-1,prev_subclass=-1,color_detail={},desc;switch("N"==g_all_pog_flag&&$s("P25_SELECTED_CANVAS",`${p_pog_index}`),p_type){case"IB":desc="it.Brand";break;case"IS":desc="it.Supplier";break;case"IC":desc="it.SubClass";break;case"IL":desc="it.Class";break;case"IG":desc="it.Group";break;case"ID":desc="it.Dept";break;case"ICDT1":desc="it.CDTLvl1";break;case"ICDT2":desc="it.CDTLvl2";break;case"ICDT3":desc="it.CDTLvl3"}var i=0;for(const modules_info of g_pog_json[p_pog_index].ModuleInfo){var carparkInfo=g_pog_json[p_pog_index].ModuleInfo[i].Carpark,k=0;for(const shelf of modules_info.ShelfInfo){var ItemInfo=shelf.ItemInfo,m=0;for(const it of ItemInfo){const randColor=()=>"0x"+Math.floor(16777216*Math.random()).toString(16).padStart(6,"0").toUpperCase();if(color_detail={},color_detail.DESCRIPTION=eval(desc),color_detail.COLOR_CODE=randColor(),color_detail.TYPE=p_type,color_detail.CANVAS=p_pog_index,color_detail.POG_CODE=g_pog_json[p_pog_index].POGCode,"Y"==g_all_pog_flag)for(const e of g_color_arr)if(e.DESCRIPTION==color_detail.DESCRIPTION&&e.CANVAS!==p_pog_index){color_detail.COLOR_CODE=e.COLOR_CODE;break}var exists=checkDuplicate(eval(desc),i,k,"g_color_arr",p_pog_index);0==exists&&g_color_arr.push(color_detail),m++}k++}if(void 0!==carparkInfo&&carparkInfo.length>0){var m=0;for(const it of carparkInfo[0].ItemInfo){const randColor=()=>"0x"+Math.floor(16777216*Math.random()).toString(16).padStart(6,"0").toUpperCase();if(color_detail={},color_detail.DESCRIPTION=eval(desc),color_detail.COLOR_CODE=randColor(),color_detail.TYPE=p_type,color_detail.CANVAS=p_pog_index,color_detail.POG_CODE=g_pog_json[p_pog_index].POGCode,"Y"==g_all_pog_flag)for(const e of g_color_arr)if(e.DESCRIPTION==color_detail.DESCRIPTION&&e.CANVAS!==p_pog_index){color_detail.COLOR_CODE=e.COLOR_CODE;break}var exists=checkDuplicate(eval(desc),i,k,"g_color_arr");0==exists&&g_color_arr.push(color_detail),m++}}i++}logDebug("function : item_grouping","E")}catch(e){error_handling(e)}}async function set_items_color(p_pog_index,p_type){try{var color_code,desc;switch(logDebug("function : set_items_color; p_type : "+p_type,"S"),p_type){case"IB":desc="it.Brand";break;case"IS":desc="it.Supplier";break;case"IC":desc="it.SubClass";break;case"IL":desc="it.Class";break;case"IG":desc="it.Group";break;case"ID":desc="it.Dept";break;case"ICDT1":desc="it.CDTLvl1";break;case"ICDT2":desc="it.CDTLvl2";break;case"ICDT3":desc="it.CDTLvl3"}var checkCondition="b.DESCRIPTION == "+desc+"&& b.CANVAS == "+p_pog_index,i=0;for(var modules_info of g_pog_json[p_pog_index].ModuleInfo){var carparkInfo=g_pog_json[p_pog_index].ModuleInfo[i].Carpark,k=0;for(var shelf of modules_info.ShelfInfo){var m=0;for(var it of shelf.ItemInfo){for(b of g_color_arr)if(eval(checkCondition)){color_code=b.COLOR_CODE;break}var selectedObject=g_scene_objects[p_pog_index].scene.children[2].getObjectById(it.ObjID);selectedObject.material.color.setHex(color_code);var child=selectedObject.children;for(n=0;n<child.length;n++)"horiz_facing"==child[n].uuid&&child[n].material.color.setHex(color_code);g_pog_json[p_pog_index].ModuleInfo[i].ShelfInfo[k].ItemInfo[m].Color=color_code,m++}k++}if(void 0!==carparkInfo&&carparkInfo.length>0){var m=0;for(var it of carparkInfo[0].ItemInfo){for(b of g_color_arr)if(eval(checkCondition)){color_code=b.COLOR_CODE;break}var selectedObject=g_scene_objects[p_pog_index].scene.children[2].getObjectById(it.ObjID);selectedObject.material.color.setHex(color_code);var child=selectedObject.children;for(n=0;n<child.length;n++)"horiz_facing"==child[n].uuid&&child[n].material.color.setHex(color_code);g_pog_json[p_pog_index].ModuleInfo[i].Carpark[0].ItemInfo[m].Color=color_code,m++}}render(p_pog_index),i++}logDebug("function : set_items_color","E")}catch(e){error_handling(e)}}async function generateItemColors(e,o){try{logDebug("function : generateItemColors; p_type : "+e,"S"),g_show_item_color="OFF"==e?"N":"Y";if("Y"==g_show_item_color?$(".item_color_legends").css("display","block"):$(".item_color_legends").css("display","none"),"Y"==g_show_item_color){addLoadingIndicator();await ShowColorBackup(o),await item_grouping(o,e),await set_items_color(o,e);removeLoadingIndicator(regionloadWait)}else ShowColorBackup(g_pog_index);logDebug("function : generateItemColors","E")}catch(e){error_handling(e)}}function showItemLegends(){logDebug("function : showItemLegends","S"),apex.region("item_color_details").refresh(),openInlineDialog("show_item_color_legends",35,45),logDebug("function : showItemLegends","E")}async function ShowColorBackup(e){try{if(logDebug("function : ShowColorBackup","S"),void 0===g_pog_json[e].ColorBackup)$.each(g_pog_json[e].ModuleInfo,(function(o,_){if(void 0===_.ParentModule||null==_.ParentModule){var n=g_pog_json[e].ModuleInfo[o].Carpark,t=_.ShelfInfo,i=0;for(const _ of t){var a=0;for(const n of _.ItemInfo){var s=g_pog_json[e].ModuleInfo[o].ShelfInfo[i].ItemInfo[a];s.ShowColorBackup=s.Color,g_pog_json[e].ColorBackup="Y",(g=g_scene_objects[e].scene.children[2].getObjectById(n.ObjID)).ShowColorBackup=g.material.color.getHex,a++}i++}if(void 0!==n&&n.length>0){a=0;for(const _ of n[0].ItemInfo){var g;g_pog_json[e].ModuleInfo[o].Carpark[0].ItemInfo[a].ShowColorBackup=g_pog_json[e].ModuleInfo[o].Carpark[0].ItemInfo[a].Color,g_pog_json[e].ColorBackup="Y",(g=g_scene_objects[e].scene.children[2].getObjectById(_.ObjID)).ShowColorBackup=g.material.color.getHex,a++}}}render(e)}));else{var o=0;for(const r of g_pog_json[e].ModuleInfo){if(void 0===r.ParentModule||null==r.ParentModule){var _=g_pog_json[e].ModuleInfo[o].Carpark,n=r.ShelfInfo,t=0;for(const _ of n){var i=0;for(const n of _.ItemInfo){var a=g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[i];a.Color=a.ShowColorBackup;var s=g_scene_objects[e].scene.children[2].getObjectById(n.ObjID),g=a.Color.replace(/#/g,"0x");s.material.color.setHex(g);var l=s.children;for(m=0;m<l.length;m++)"horiz_facing"==l[m].uuid&&l[m].material.color.setHex(g);g_pog_json[e].ColorBackup="Y",i++}t++}if(void 0!==_&&_.length>0){i=0;for(const n of _[0].ItemInfo){g_pog_json[e].ModuleInfo[o].Carpark[0].ItemInfo[i].Color=g_pog_json[e].ModuleInfo[o].Carpark[0].ItemInfo[i].ShowColorBackup;s=g_scene_objects[e].scene.children[2].getObjectById(n.ObjID),g=g_pog_json[e].ModuleInfo[o].Carpark[0].ItemInfo[i].Color.replace(/#/g,"0x");s.material.color.setHex(g);l=s.children;for(m=0;m<l.length;m++)"horiz_facing"==l[m].uuid&&l[m].material.color.setHex(g);g_pog_json[e].ColorBackup="Y",i++}}}o++}render(e)}logDebug("function : ShowColorBackup","E")}catch(e){error_handling(e)}}function checkDuplicate(e,o,_,n,t){try{if(logDebug("function : checkDuplicate; description : "+e,"S"),"g_color_arr"==n)return g_color_arr.some((function(o){return logDebug("function : checkDuplicate","E"),o.DESCRIPTION===e&&o.CANVAS===t}));if("BACKUP"==n)return g_pogBackup.some((function(e){return logDebug("function : checkDuplicate","E"),e.moduleIndex===o&&e.shelfIndex===_}))}catch(e){error_handling(e)}}function findItemInfoByObjID(e,o){for(const _ of g_pog_json[o].ModuleInfo)if(null==_.ParentModule){if(_.Carpark)for(const o of _.Carpark)if(o.ItemInfo)for(const _ of o.ItemInfo)if(_.ObjID===e)return _;for(const o of _.ShelfInfo)if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType)for(const _ of o.ItemInfo)if(_.ObjID===e)return _}return null}async function find_highlight_frame(){try{if(!Array.isArray(g_scene_objects)||0===g_scene_objects.length)return[];const e=[];if(g_scene_objects.forEach((o=>{const _=o.scene;if(!_)return;const n=[];_.traverse((e=>{try{if(!e)return;"highlight_frame"!==e.uuid&&"highlight_frame"!==e.name||n.push(e)}catch(e){}})),n.forEach((o=>{try{o.traverse((e=>{try{e.geometry&&e.geometry.dispose()}catch(e){}try{if(e.material){(Array.isArray(e.material)?e.material:[e.material]).forEach((e=>{try{e.map&&e.map.dispose(),e.lightMap?.dispose&&e.lightMap.dispose(),e.envMap?.dispose&&e.envMap.dispose(),e.dispose?.()}catch(e){}}))}}catch(e){}}))}catch(e){}try{o.parent?o.parent.remove(o):_.remove(o)}catch(e){}e.push(o)}))})),render_all_pog(),"Y"!==g_scene_objects[0].Indicators.LiveImage)for(let e=0;e<g_pog_json.length;e++)clearFrame(e);return e}catch(e){error_handling(e)}}async function clearFrame(e){try{const o=g_scene_objects[e].scene.children[2],_=g_pog_json[e].ModuleInfo;for(let e=0;e<_.length;e++){const n=_[e].ShelfInfo||[];for(let e=0;e<n.length;e++){const _=n[e].ItemInfo||[];for(let e=0;e<_.length;e++){const n=_[e],t=o.getObjectById(n.ObjID);if(t&&t.material&&n.Color){const e=n.Color.replace(/#/g,"0x");if(t.material.color.setHex(e),t.children&&t.children.length)for(let o=0;o<t.children.length;o++)"horiz_facing"===t.children[o].uuid&&t.children[o].material.color.setHex(e)}}}}render(e)}catch(e){error_handling(e)}}function findData(e,o,_,n){try{if(console.log("find item",e,o,_,n),logDebug("function : findData; findValues : "+e+"; searchType : "+o+"; searchIn : "+_,"S"),l_highlightStatus=$v("P25_POGCR_HIGHLIGHT_SEARCHED_ITEM"),"Y"==l_highlightStatus&&find_highlight_frame(),"P"==o){var t=get_similar_items(e,_,n);if(console.log("item_list",t),g_intersected=[],t.length>0)for(var i=0;i<t.length;i++){var a=t[i];if("Y"==l_highlightStatus)for(let e=0;e<g_pog_json.length;e++){var s=findItemInfoByObjID(a.id,e);if(s){var g=g_scene_objects[e]?.scene?.children?.[2]?.getObjectById(s.ObjID);g&&highlightProduct(g,4,s.W,s.H,s.D,s.Z)}}g_intersected.push(t[i])}}else g_intersected=[],$.each(g_pog_json[n].ModuleInfo,(function(o,_){if(void 0===_.ParentModule||null==_.ParentModule){var t=_.ShelfInfo;g_pog_json[n].ModuleInfo[o].ShelfInfo;$.each(t,(function(o,_){if(_.Shelf==e){var t=g_scene_objects[n].scene.children[2].getObjectById(_.SObjID);g_intersected.push(t)}}))}}));0==g_intersected.length?alert(get_message("ITEM_SEARCH_NO_DATA_FOUND")):(clearInterval(g_myVar),g_select_color=0,render_animate_selected(),"Y"==l_highlightStatus&&render_blink_effect(),closeInlineDialog("find")),logDebug("function : findData","E")}catch(e){error_handling(e)}}function incrementFacingsFromKey(e,o){try{if(console.log("p_facingskey, p_noOfFacings",e,o),logDebug("function : incrementFacingsFromKey; facingskey : "+e+"; noOfFacings : "+o,"S"),o>0)"undefined"!=typeof g_incre_item_index&&""==g_item_index&&(g_item_index=g_incre_item_index),incrementValue(undefined,e,parseInt(o));logDebug("function : incrementFacingsFromKey","E")}catch(e){error_handling(e)}}async function recal_compare(){"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&($(".recal_compare").addClass("recal_compare_active"),await two_pog_diff_checker(g_ComBaseIndex,g_ComViewIndex),await calculateFixelAndSupplyDays("N",g_ComViewIndex))}async function live_image(){try{if(logDebug("function : live_image","S"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0){var e=g_pog_index;if("Y"==g_all_pog_flag)var o=0;else o=g_pog_index;"N"==g_show_live_image?(g_show_live_image="Y",$(".live_image").addClass("live_image_active")):(g_show_item_color="N",g_show_live_image="N",$(".live_image").removeClass("live_image_active"));for(const e of g_pog_json){if(g_ComViewIndex>-1||-1==g_ComViewIndex){if(g_world=g_scene_objects[o].scene.children[2],g_camera=g_scene_objects[o].scene.children[0],"Y"==g_scene_objects[o].Indicators.ItemColor&&"PREV_VERSION"!==g_compare_view){g_scene_objects[o].Indicators.ItemColor="N",$s("P25_SELECT_COLOR_TYPE",null),$("#item_group_sub a").removeClass("item_color_active");await ShowColorBackup(o)}if("Y"==g_scene_objects[o].Indicators.ItemDesc&&"Y"==g_show_live_image){g_scene_objects[o].Indicators.ItemDesc="N",g_show_item_desc="N",$(".item_desc").removeClass("live_image_active");await showHideItemDescription("N",$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),o)}"Y"==g_show_live_image&&(g_scene_objects[o].Indicators.LiveImage="Y"),"PREV_VERSION"!==g_compare_view&&await ShowColorBackup(o);await recreate_image_items(g_show_live_image,$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_NOTCH_HEAD"),o,g_show_days_of_supply,$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label);render(o)}if("Y"!=g_all_pog_flag)break;o++}var _="N";for(const e of g_scene_objects)"Y"==e.Indicators.ItemColor&&(_="Y");"N"==_&&$(".item_color_legends").css("display","none"),g_world=g_scene_objects[e].scene.children[2],g_camera=g_scene_objects[e].scene.children[0],"Y"==g_show_live_image&&animate_all_pog(),set_indicator_objects(g_pog_index)}logDebug("function : live_image","E")}catch(e){error_handling(e)}}function save_template(){try{logDebug("function : save_template","S"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&($(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),$(".save_template").addClass("active"),$s("P25_TEMPLATE_NAME",""!==g_pog_json[g_pog_index].POGCode?g_pog_json[g_pog_index].POGCode:$v("P25_POG_TEMPLATE")),openInlineDialog("save_as_template",20,20),g_dblclick_opened="Y"),logDebug("function : save_template","E")}catch(e){error_handling(e)}}function open_fixel(){try{if(logDebug("function : open_fixel","S"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0||"undefined"!=typeof g_pog_json_comp&&g_pog_json_comp.length>0){!async function(){await set_shelf_item_index(g_pog_index)}(),POG_json=JSON.stringify([g_pog_json[g_pog_index]]),apex.server.process("ADD_JSON_TO_COLL",{x01:"I",p_clob_01:POG_json},{dataType:"text",success:function(e){""!=$.trim(e)?raise_error(e):($(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),apex.region("fixel_details").refresh(),apex.region("fixel_details").widget().interactiveGrid("getCurrentView").view$.grid("setSelectedRecords",[],!0),openInlineDialog("open_fixel_modal",50,60),g_dblclick_opened="Y",logDebug("function : open_fixel","E"))},loadingIndicatorPosition:"page"})}}catch(e){error_handling(e)}}function open_fixel_label(){try{logDebug("function : open_fixel_label","S");var e=g_pog_index;if("N"==g_show_fixel_label?(g_show_fixel_label="Y",$(".fixel_label").addClass("fixel_label_active")):(g_show_fixel_label="N",$(".fixel_label").removeClass("fixel_label_active")),"N"==g_all_pog_flag)var o=g_pog_index;else o=0;for(const e of g_pog_json){if((o!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex)&&(g_renderer=g_scene_objects[o].renderer,g_scene=g_scene_objects[o].scene,g_camera=g_scene_objects[o].scene.children[0],show_fixel_labels(g_show_fixel_label,o),set_indicator_objects(o)),"N"==g_all_pog_flag)break;o++}g_renderer=g_scene_objects[e].renderer,g_scene=g_scene_objects[e].scene,g_camera=g_scene_objects[e].scene.children[0],g_prev_undo_action="FIXEL_LABEL",logDebug("function : open_fixel_label","E")}catch(e){error_handling(e)}}function open_item_label(){try{if(logDebug("function : open_item_label","S"),"N"==g_all_pog_flag)var e=g_pog_index;else e=0;var o=g_pog_index;"N"==g_show_item_label?(g_show_item_label="Y",$(".item_label").addClass("item_label_active")):(g_show_item_label="N",$(".item_label").removeClass("item_label_active"));for(const o of g_pog_json){if((e!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex)&&(g_renderer=g_scene_objects[e].renderer,g_scene=g_scene_objects[e].scene,g_camera=g_scene_objects[e].scene.children[0],show_fixel_labels(g_show_fixel_label,e),show_item_labels(g_show_item_label,$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),e),set_indicator_objects(e)),"N"==g_all_pog_flag)break;e++}g_renderer=g_scene_objects[o].renderer,g_scene=g_scene_objects[o].scene,g_camera=g_scene_objects[o].scene.children[0],g_prev_undo_action="ITEM_LABEL",logDebug("function : open_item_label","E")}catch(e){error_handling(e)}}function open_notch_label(e){try{logDebug("function : open_notch_label","S");var o=g_pog_index;"N"==g_show_notch_label?(g_show_notch_label="Y",$(".notch_label").addClass("notch_label_active")):(g_show_notch_label="N",$(".notch_label").removeClass("notch_label_active"));o=g_pog_index;if("N"==g_all_pog_flag)var _=g_pog_index;else _=0;for(const e of g_pog_json){if((_!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex)&&(g_renderer=g_scene_objects[_].renderer,g_scene=g_scene_objects[_].scene,g_camera=g_scene_objects[_].scene.children[0],show_notch_labels(g_show_notch_label,$v("P25_NOTCH_HEAD"),"Y",_),set_indicator_objects(_)),"N"==g_all_pog_flag)break;_++}g_renderer=g_scene_objects[o].renderer,g_scene=g_scene_objects[o].scene,g_camera=g_scene_objects[o].scene.children[0],g_prev_undo_action="NOTCH_LABEL",logDebug("function : open_notch_label","E")}catch(e){error_handling(e)}}function open_pog(){try{logDebug("function : open_pog","S"),$s("P25_OPEN_POG_CODE",""),$s("P25_DIVISION",""),$s("P25_EXISTING_POG_TYPE","R"),$s("P25_POG_STATUS",""),$s("P25_DRAFT_LIST",""),$s("P25_POG_DESCRIPTION",""),$s("P25_EXISTING_DRAFT_VER",""),$s("P25_MULTI_POG_CODE",""),sessionStorage.removeItem("g_color_arr"),sessionStorage.removeItem("g_highlightArr"),g_highlightArr=[],g_dblclick_opened="Y","Collapse"==$(".a-Splitter-thumb").attr("aria-label")&&$(".a-Splitter-thumb").click(),"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&"Y"==g_pog_edited_ind?confirm(get_message("POGCR_CHANGE_REVERT_WARN"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){openCustomDialog("OPEN_EXITPOG",$v("P25_EXIST_POG_URL"),"P25_EXISTPOG_TRIGGER_ELEMENT")})):openCustomDialog("OPEN_EXITPOG",$v("P25_EXIST_POG_URL"),"P25_EXISTPOG_TRIGGER_ELEMENT"),logDebug("function : open_pog","E")}catch(e){error_handling(e)}}function compare_pog(){try{logDebug("function : compare_pog","S"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&(apex.event.trigger("#P25_DRAFT_LIST","apexrefresh"),$x("P25_COMPARE_WITH_0").checked=!0,apex.event.trigger("#P25_COMPARE_WITH","apexrefresh"),openInlineDialog("open_comp_pog",33,33)),logDebug("function : compare_pog","E")}catch(e){error_handling(e)}}function get_pog_exist_flag(e,o){try{return new Promise((function(_,n){apex.server.process("CHECK_EXIST_POG",{x01:e,x02:o},{dataType:"text",success:function(e){""!=$.trim(e)?_($.trim(e)):_("N")},loadingIndicatorPosition:"page"})}))}catch(o){console.log("error 3",e)}}async function sales_refresh(){try{if(logDebug("function : sales_refresh","S"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0){$s("P25_SALES_INFO","");var e="N";if("Y"==g_all_pog_flag){$s("P25_OPEN_POG_CODE","");var o=0,_="";for(const n of g_pog_json)void 0!==g_pog_json[o].SalesRrshDtl&&""!==g_pog_json[o].SalesRrshDtl&&(_=_+"\n"+g_pog_json[o].SalesRrshDtl),"Y"!=g_pog_json[o].NewPOG&&void 0!==g_pog_json[o].NewPOG||(e="Y"),o++;$s("P25_SALES_INFO",_)}else void 0!==g_pog_json[g_pog_index].SalesRrshDtl&&""!==g_pog_json[g_pog_index].SalesRrshDtl&&$s("P25_SALES_INFO",g_pog_json[g_pog_index].SalesRrshDtl),"Y"!=g_pog_json[g_pog_index].NewPOG&&void 0!==g_pog_json[g_pog_index].NewPOG&&"Y"!=$v("P25_POGCR_REFRESH_SALES_WTCCN")||(e="Y");"N"==e?($s("P25_STORE",""),$s("P25_SALES_POG_CODE",""),$("#P25_STORE_CONTAINER").css("display","none"),$("#P25_SALES_POG_CODE_CONTAINER").css("display","none"),$s("P25_MULTIPLE_STORE",""),$("#P25_STORE_MULTIPLE_CONTAINER").css("display","none"),"Y"==$v("P25_POGCR_SALES_REFRESH_HIDE_STORE")&&"Y"==$v("P25_SHOW_HIDE_WEEK_SELECTION")&&($s("P25_WEEK_SELECTION",""),$("#P25_WEEK_SELECTION_CONTAINER").css("display","none"))):"N"==$v("P25_POGCR_SALES_REFRESH_HIDE_STORE")?($("#P25_STORE_CONTAINER").css("display","block"),$("#P25_STORE_MULTIPLE_CONTAINER").css("display","block"),$("#P25_SALES_POG_CODE_CONTAINER").css("display","none"),apex.server.process("GET_POG_LIVE_STORE",{x01:g_pog_json[g_pog_index].POGCode,x02:g_pog_json[g_pog_index].Version},{dataType:"text",success:function(e){""!=$.trim(e)?$s("P25_MULTIPLE_STORE",$.trim(e)):$s("P25_MULTIPLE_STORE","")}})):("Y"==$v("P25_SHOW_HIDE_WEEK_SELECTION")&&($s("P25_WEEK_SELECTION",""),$("#P25_WEEK_SELECTION_CONTAINER").css("display","none")),$("#P25_SALES_POG_CODE_CONTAINER").css("display","block"),$("#P25_STORE_CONTAINER").css("display","none"),$("#P25_STORE_MULTIPLE_CONTAINER").css("display","none")),openInlineDialog("open_refresh_sales",33,33)}logDebug("function : sales_refresh","E")}catch(e){error_handling(e)}}function prev_ver(e){try{var o;logDebug("function : prev_ver","S");var _=$("#open_prev_ver");"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&""!==$v("P25_OPEN_POG_CODE")&&("DIFF"==e?($s("P25_PREV_POG_CODE",""),$s("P25_PREV_POG_VERSION",""),$("#P25_PREV_POG_CODE_CONTAINER").hide(),$("#P25_PREV_POG_VERSION_CONTAINER").hide(),$("#COMP_PREV_POG").hide(),$("#P25_SEL_PREV_POG_CODE_CONTAINER").show(),$("#P25_SEL_POG_VERSION_CONTAINER").show(),$("#COMPARE_POG").show(),$s("P25_SEL_PREV_POG_CODE",g_pog_json[g_pog_index].POGCode),apex.event.trigger("#P25_SEL_POG_VERSION","apexrefresh"),o=get_message("COMPARE_POG_TT")):($s("P25_SEL_PREV_POG_CODE",""),$s("P25_SEL_POG_VERSION",""),$("#P25_SEL_PREV_POG_CODE_CONTAINER").hide(),$("#P25_SEL_POG_VERSION_CONTAINER").hide(),$("#COMPARE_POG").hide(),$("#P25_PREV_POG_CODE_CONTAINER").show(),$("#P25_PREV_POG_VERSION_CONTAINER").show(),$("#COMP_PREV_POG").show(),$s("P25_PREV_POG_CODE",g_pog_json[g_pog_index].POGCode),apex.event.trigger("#P25_PREV_POG_VERSION","apexrefresh"),o=get_message("POGCR_PREVIOUS_VERSION_TT")),_.dialog("option","title",o),apex.event.trigger("#P25_DRAFT_LIST","apexrefresh"),$x("P25_COMPARE_WITH_0").checked=!0,apex.event.trigger("#P25_COMPARE_WITH","apexrefresh"),openInlineDialog("open_prev_ver",33,33)),logDebug("function : prev_ver","E")}catch(e){error_handling(e)}}async function open_renumbering(){try{logDebug("function : open_renumbering","S"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&(g_dblclick_opened="Y",g_renum_json.length>0?($s("P25_LOC_FIXT",g_renum_json[0].Id),$s("P25_DIRECTION",g_renum_json[0].NumberingDirection),$s("P25_ORDER_TYPE",g_renum_json[0].OrderType),$s("P25_START_ONE_FIXEL",g_renum_json[0].StartForfixel),$s("P25_MODULE_DIR",g_renum_json[0].OrderDirection),$s("P25_START_ONE_MOD_LOC",g_renum_json[0].StartForOrder),$s("P25_START_ONE_MOD",g_renum_json[0].StartForOrderFixel),$s("P25_INCLUDE_MOD_NAME",g_renum_json[0].IncludeModuledetails),$s("P25_SEPARATOR",g_renum_json[0].Seprator),"L"==g_renum_json[0].Id?($s("P25_LEADING_TEXT",""),$s("P25_TRAILING_TEXT","")):($s("P25_LEADING_TEXT",g_renum_json[0].LeadingText),$s("P25_TRAILING_TEXT",g_renum_json[0].TrailingText)),console.log("detailsrenum",g_renum_json[0].Id,g_renum_json[0].NumberingDirection)):($s("P25_LOC_FIXT","L"),$s("P25_START_ONE_FIXEL",$v("P25_POGCR_DEFAULT_START_FIXEL")),$s("P25_DIRECTION",$v("P25_POGCR_DEFAULT_DIRECTION")),"Y"==$v("P25_UNQ_POG_MODULE_ITEM_LOC")&&"1"!==$v("P25_POGCR_DEFAULT_START_FIXEL")?($s("P25_ORDER_TYPE","2"),$s("P25_START_ONE_MOD_LOC","2")):($s("P25_ORDER_TYPE","1"),$s("P25_START_ONE_MOD_LOC","1")),"L"==$v("P25_LOC_FIXT")?($s("P25_LEADING_TEXT"," "),$s("P25_TRAILING_TEXT"," "),$s("P25_START_ONE_MOD"," "),$s("P25_POGCR_DEFAULT_START_FIXEL",$v("P25_START_ONE_FIXEL")),$s("P25_POGCR_DEFAULT_DIRECTION",$v("P25_DIRECTION")),"Y"==$v("P25_UNQ_POG_MODULE_ITEM_LOC")&&"1"!==$v("P25_POGCR_DEFAULT_START_FIXEL")?($s("P25_ORDER_TYPE","2"),$s("P25_START_ONE_MOD_LOC","2")):($s("P25_ORDER_TYPE","1"),$s("P25_START_ONE_MOD_LOC","1"))):($s("P25_START_ONE_FIXEL",""),$s("P25_START_ONE_MOD",""),$s("P25_ORDER_TYPE","2"),$s("P25_IGNORE","T:D"),$s("P25_DIRECTION","LRTB"))),openInlineDialog("renumbering",55,75),g_l_module_dir=$v("P25_MODULE_DIR"),g_l_direction=$v("P25_DIRECTION"),g_l_ignore=$v("P25_IGNORE"),g_l_order_type=$v("P25_ORDER_TYPE"),g_l_start_one_mod=$v("P25_START_ONE_MOD"),g_l_include_mod_name=$v("P25_INCLUDE_MOD_NAME"),g_l_separator=$v("P25_SEPARATOR"),g_l_leading_text=$v("P25_LEADING_TEXT"),g_l_trailing_text=$v("P25_TRAILING_TEXT"),g_l_start_one_fixel=$v("P25_START_ONE_FIXEL")),logDebug("function : open_renumbering","E")}catch(e){error_handling(e)}}async function renumber(){try{if(logDebug("function : renumber","S"),g_pog_edited_ind="Y","Y"==g_all_pog_flag)var e=0;else e=g_pog_index;for(const a of g_pog_json){if(e!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex){var o=g_pog_json[e].ModuleInfo,_=0,n=0;for(const e of o)n+=1,void 0!==e.ParentModule&&null!=e.ParentModule||(2==$v("P25_START_ONE_MOD")&&(_=1),e.ShelfInfo.length>0&&$.each(e.ShelfInfo,(function(e,o){void 0!==o&&"NOTCH"!==o.ObjType&&"BASE"!==o.ObjType&&("T:D"==$v("P25_IGNORE")&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType||"T"==$v("P25_IGNORE")&&"TEXTBOX"!==o.ObjType||"D"==$v("P25_IGNORE")&&"DIVIDER"!==o.ObjType||""==$v("P25_IGNORE"))&&(_+=1)}))),1;if(items_arr=[],""!==$v("P25_LEADING_TEXT"))var t=$v("P25_LEADING_TEXT")+" ";else t="";if(""!==$v("P25_TRAILING_TEXT"))var i=" "+$v("P25_TRAILING_TEXT");else i="";(3==$v("P25_INCLUDE_MOD_NAME")?t+_+$v("P25_SEPARATOR")+n+i:t+_+i).length>15?alert(get_message("FIXEL_ID_LEN_ERR")):"L"==$v("P25_LOC_FIXT")?await location_numbering($v("P25_MODULE_DIR"),$v("P25_DIRECTION"),$v("P25_ORDER_TYPE"),$v("P25_START_ONE_FIXEL"),$v("P25_START_ONE_MOD_LOC"),e,$v("P25_PALLET_DIRECTION")):await fixture_numbering($v("P25_MODULE_DIR"),$v("P25_DIRECTION"),$v("P25_IGNORE"),$v("P25_ORDER_TYPE"),$v("P25_START_ONE_MOD"),$v("P25_INCLUDE_MOD_NAME"),$v("P25_SEPARATOR"),$v("P25_LEADING_TEXT"),$v("P25_TRAILING_TEXT"),e)}if("Y"!=g_all_pog_flag)break;e++}logDebug("function : renumber","E")}catch(e){error_handling(e)}}function updateHighlightArr(e,o="N"){try{logDebug("function : updateHighlightArr","S"),apex.server.process("GET_HIGHLIGHT_DETAILS",{x01:e},{dataType:"json",success:function(_){if("ERROR"==$.trim(_).split(",")[0])raise_error(_);else{g_highlightArr=g_highlightArr.filter((o=>o.CONDITION_NAME!==e));const n={CONDITION_NAME:e,BACKGROUND_COLOR:_.color,FORMULA:_.formula,PRIORITY:_.priority,CHECK:o};g_highlightArr.push(n)}}}),logDebug("function : updateHighlightArr","E")}catch(e){error_handling(e)}}async function clearHighlight(e){if("Y"==g_all_pog_flag)var o=0;else o=g_pog_index;var _=g_pog_index;for(const e of g_pog_json){if(o!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex){g_renderer=g_scene_objects[o].renderer,g_scene=g_scene_objects[o].scene,g_camera=g_scene_objects[o].scene.children[0];await ShowColorBackup(o);render(o)}if("Y"!=g_all_pog_flag)break;o++}g_renderer=g_scene_objects[_].renderer,g_scene=g_scene_objects[_].scene,g_camera=g_scene_objects[_].scene.children[0],g_world=g_scene_objects[_].scene.children[2]}function setHighlightColorInItem(pPogIndex,pItem){try{var ItemSales=get_sales_info(pPogIndex,pItem.ItemID),l_color="#FFFFFF";for(const condition of g_highlightArr){var new_condition=condition.FORMULA,fields=new_condition.match(/\$\$(.*?)\$\$/g).map((e=>e.slice(2,-2)));for(fieldName of fields){var jsonValue="";"COS"==fieldName?(jsonValue=eval("((pItem.BHoriz * pItem.BVert * pItem.BaseD * parseInt(pItem.MerchStyle == 1 ? pItem.UnitperTray : pItem.MerchStyle == 2 ? pItem.UnitperCase : 1))  + pItem.CapFacing * pItem.CapDepth * pItem.CapHorz * parseInt(pItem.CapMerch == 1 ? pItem.UnitperTray : 1) ) / parseInt(pItem.SizeDesc.split('*')[1])"),isNaN(jsonValue)||!isFinite(jsonValue)?jsonValue=0:null!==jsonValue&&""!==jsonValue||(jsonValue="''")):"SalesUnit"==fieldName?(jsonValue=eval("parseFloat(ItemSales.SalesUnitPerWeek)"),isNaN(jsonValue)||!isFinite(jsonValue)?jsonValue=0:null!==jsonValue&&""!==jsonValue||(jsonValue="''")):"TotalShrinkageAmtPer"==fieldName?(jsonValue=eval("parseFloat((((ItemSales.ShrinkageAmt + ItemSales.NonShrinkageAmt) / ItemSales.SalesAmt) * 100).toFixed(1))"),isNaN(jsonValue)||!isFinite(jsonValue)?jsonValue=0:null!==jsonValue&&""!==jsonValue||(jsonValue="''")):"SalesPerWeek"==fieldName?(jsonValue=eval("parseFloat(ItemSales.SalesPerWeek.toFixed(1))"),isNaN(jsonValue)||!isFinite(jsonValue)?jsonValue=0:null!==jsonValue&&""!==jsonValue||(jsonValue="''")):"DOS"==fieldName?(jsonValue=eval("parseFloat(pItem.BHoriz * pItem.BVert * pItem.BaseD * parseInt(pItem.MerchStyle == 1 ? pItem.UnitperTray : pItem.MerchStyle == 2 ? pItem.UnitperCase : 1)) / (ItemSales.SalesUnitPerWeek / 7)"),isNaN(jsonValue)||!isFinite(jsonValue)?jsonValue=0:null!==jsonValue&&""!==jsonValue||(jsonValue="''")):jsonValue="DFacing"==fieldName?eval("pItem.BaseD"):eval("pItem."+fieldName),"Brand_Category"==fieldName||"ItemStatus"==fieldName||"Gobecobrand"==fieldName||"Internet"==fieldName?jsonValue=null!==jsonValue?"'"+jsonValue+"'":"''":isNaN(jsonValue)||!isFinite(jsonValue)?jsonValue=0:null!==jsonValue&&""!==jsonValue||(jsonValue="''");var regex=new RegExp("\\b"+fieldName+"\\b","g");new_condition=new_condition.replaceAll(regex,jsonValue)}new_condition=new_condition.replaceAll("$$","");var selectedObject=g_scene_objects[pPogIndex].scene.children[2].getObjectById(pItem.ObjID);if(eval(new_condition)){l_color=condition.BACKGROUND_COLOR;var fillColor=parseInt(l_color.replace("#","0x"),16);return selectedObject.material.color.setHex(fillColor),pItem.Color=l_color,l_color}l_color="#FFFFFF";var fillColor=parseInt(l_color.replace("#","0x"),16);selectedObject.material.color.setHex(fillColor),pItem.Color=l_color}return l_color}catch(e){error_handling(e)}}async function highlightProducts(e){try{if(logDebug("function : highlightProducts","S"),g_highlightArr.length>0){g_highlightArr.keySort({PRIORITY:"asc"});var o=g_show_live_image;if("Y"==g_all_pog_flag)var _=0;else _=e;var n=e;for(const e of g_pog_json){if(_!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex){if(g_renderer=g_scene_objects[_].renderer,g_scene=g_scene_objects[_].scene,g_camera=g_scene_objects[_].scene.children[0],g_world=g_scene_objects[_].scene.children[2],"Y"==o){$(".live_image").removeClass("live_image_active"),g_show_live_image="N",g_scene_objects[g_pog_index].Indicators.LiveImage="N";await recreate_image_items("N",$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_NOTCH_HEAD"),_,"N","",g_hide_show_dos_label)}await ShowColorBackup(_);for(modules of g_pog_json[_].ModuleInfo){if(void 0===modules.ParentModule||null==modules.ParentModule){if(modules.ShelfInfo.length>0){for(shelfs of modules.ShelfInfo){if(shelfs.ItemInfo.length>0&&"BASE"!==shelfs.ObjType&&"NOTCH"!==shelfs.ObjType&&"DIVIDER"!==shelfs.ObjType&&"TEXTBOX"!==shelfs.ObjType){for(const e of shelfs.ItemInfo){if("DIVIDER"!==e.Item)setHighlightColorInItem(_,e);0}}0}}if("undefined"!==modules.Carpark&&modules.Carpark.length>0){for(items of modules.Carpark[0].ItemInfo){setHighlightColorInItem(_,items);0}}}0}render(_)}if("Y"!=g_all_pog_flag)break;_++}g_renderer=g_scene_objects[n].renderer,g_scene=g_scene_objects[n].scene,g_camera=g_scene_objects[n].scene.children[0],g_world=g_scene_objects[n].scene.children[2]}closeInlineDialog("condition_highlight"),logDebug("function : highlightProducts","E")}catch(e){error_handling(e)}}function open_pog_report(e){try{logDebug("function : open_pog_report; reportName : "+e,"S"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&""!==$v("P25_OPEN_DRAFT")&&download_pog_report(e,g_pog_index,g_all_pog_flag),logDebug("function : open_pog_report","E")}catch(e){error_handling(e)}}function selectRowsBetweenIndexes(e){try{logDebug("function : open_pog_report","S"),e.sort((function(e,o){return e-o}));for(var o=e[0];o<=e[1];o++)g_trs[o+2].className="droppableItem ui-draggable ui-draggable-handle selected";return logDebug("function : open_pog_report","E"),"yes"}catch(e){error_handling(e)}}function create_action(e,o){try{if(logDebug("function : create_action","S"),null!==apex.region("draggable_table")&&"Y"==g_product_list_drag){set_curr_canvas(o);var _=g_canvas.getBoundingClientRect();g_productselect="N",""==$v("P25_MODULE_DISP")&&(g_module_index=0),"N"==g_dblclick_opened&&"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&void 0!==g_pog_json[g_pog_index].ModuleInfo&&g_pog_json[g_pog_index].ModuleInfo.length>0&&create_item_list(e,o.clientX-_.left,o.clientY-_.top,g_camera,g_canvas,g_pog_index)}logDebug("function : create_action","E")}catch(e){error_handling(e)}}async function onload_create_pog(){logDebug("function : onload_create_pog; ","S"),sessionStorage.setItem("P25_EXISTING_DRAFT_VER",sessionStorage.getItem("P25_EXISTING_DRAFT_VER")),sessionStorage.setItem("P25_DRAFT_LIST",sessionStorage.getItem("P25_DRAFT_LIST")),sessionStorage.setItem("P25_POG_DESCRIPTION",sessionStorage.getItem("P25_POG_DESCRIPTION"));var e=LZString.decompress(sessionStorage.getItem("POGJSON"));if(g_ItemImages=null!==sessionStorage.getItem("g_ItemImages")?JSON.parse(sessionStorage.getItem("g_ItemImages")):[],g_scene_objects_backup=null!==sessionStorage.getItem("scene_objects_backup")?JSON.parse(LZString.decompress(sessionStorage.getItem("scene_objects_backup"))):[],g_pogjson_backup=null!==sessionStorage.getItem("pogjson_backup")?JSON.parse(LZString.decompress(sessionStorage.getItem("pogjson_backup"))):[],generateCanvasListHolder(g_pogjson_backup),""!==e&&null!==e)try{g_pog_json=JSON.parse(e)}catch(e){console.log(e)}sessionStorage.removeItem("POGJSON"),sessionStorage.removeItem("g_ItemImages"),apex.server.process("GET_JSON_FROM_COLL",{pageItems:["P1_ID_COLUMN"]},{dataType:"html",loadingIndicatorPosition:"page"}).done((function(e){if(""!==$.trim(e)||"undefined"!=typeof g_pog_json&&g_pog_json.length>0){g_show_fixel_label=sessionStorage.getItem("g_show_fixel_label"),g_show_item_label=""==sessionStorage.getItem("g_show_item_label")||null==sessionStorage.getItem("g_show_item_label")?"Y":sessionStorage.getItem("g_show_item_label"),g_show_notch_label=sessionStorage.getItem("g_show_notch_label"),g_show_live_image=sessionStorage.getItem("g_show_live_image"),g_show_max_merch=sessionStorage.getItem("g_show_max_merch"),g_show_item_desc=""==sessionStorage.getItem("g_show_item_desc")||null==sessionStorage.getItem("g_show_item_desc")?"N":sessionStorage.getItem("g_show_item_desc"),g_show_fixel_space=""==sessionStorage.getItem("g_show_fixel_space")||null==sessionStorage.getItem("g_show_fixel_space")?"N":sessionStorage.getItem("g_show_fixel_space"),g_max_facing_enabled=sessionStorage.getItem("g_max_facing_enabled"),g_show_item_color=""==sessionStorage.getItem("g_show_item_color")||null==sessionStorage.getItem("g_show_item_color")?"N":sessionStorage.getItem("g_show_item_color"),g_show_days_of_supply=sessionStorage.getItem("g_show_days_of_supply"),g_ComViewIndex=parseInt(sessionStorage.getItem("g_ComViewIndex")),g_ComBaseIndex=parseInt(sessionStorage.getItem("g_ComBaseIndex")),g_compare_view=sessionStorage.getItem("g_compare_view"),g_compare_pog_flag=sessionStorage.getItem("g_compare_pog_flag"),g_pog_index=null!==sessionStorage.getItem("g_pog_index")?parseInt(sessionStorage.getItem("g_pog_index")):0,g_edit_pallet_mod_ind=null!==sessionStorage.getItem("g_edit_pallet_mod_ind")?parseInt(sessionStorage.getItem("g_edit_pallet_mod_ind")):-1,g_edit_pallet_shelf_ind=null!==sessionStorage.getItem("g_edit_pallet_shelf_ind")?parseInt(sessionStorage.getItem("g_edit_pallet_shelf_ind")):-1,g_overhung_shelf_active=null!==sessionStorage.getItem("g_overhung_shelf_active")?sessionStorage.getItem("g_overhung_shelf_active"):"N",g_itemSubLabelInd=null!==sessionStorage.getItem("g_itemSubLabelInd")?sessionStorage.getItem("g_itemSubLabelInd"):"N",g_itemSubLabel=null!==sessionStorage.getItem("g_itemSubLabel")?sessionStorage.getItem("g_itemSubLabel"):"",g_combinedShelfs=null!==sessionStorage.getItem("g_combinedShelfs")?JSON.parse(sessionStorage.getItem("g_combinedShelfs")):[],sessionGetCombineDetails(),"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&(g_json=g_pog_json),g_pog_json_data=JSON.parse(JSON.stringify(g_json)),g_module_obj_array=[],$(".live_image").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".open_pdf").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),async function(){if("Y"==$v("P25_ERROR_FLAG")){raise_error("&IMP_FAILURE_ERROR_MSG."),pog_edited_ind="Y";await save_pog_to_json(g_pog_json);apex.navigation.redirect("f?p="+$v("pFlowId")+":"+$v("pFlowStepId")+":"+$v("pInstance")+":APPLICATION_PROCESS=DOWNLOAD_ERROR_TMPL"),g_ComViewIndex>-1&&"Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&g_pog_json_data.splice(g_ComViewIndex,1),g_pog_json=[],addLoadingIndicator();await create_all_pog_onload(g_pog_json_data);removeLoadingIndicator(regionloadWait),g_ComViewIndex>-1&&"Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&await edit_pallet("Y",g_edit_pallet_mod_ind,g_edit_pallet_shelf_ind,g_ComBaseIndex,"Y"),g_pog_json_data=[],removeParam(""),$s("P25_ERROR_FLAG","")}else if(""!==$v("P25_UPLD_ID")){removeParam(""),apex.server.process("GET_ITEM_JSON",{pageItems:["P1_ID_COLUMN"]},{dataType:"html"}).done((function(e){if(""!==$.trim(e))try{async function o(){appendMultiCanvasRowCol(g_pog_json.length,$v("P25_POGCR_TILE_VIEW")),g_multi_pog_json=[],g_canvas_objects=[];for(var e=0;e<=g_pog_json.length-1;e++){init(e),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects),set_indicator_objects(e);var o=g_canvas_objects[e].getAttribute("id");$("#"+o+"-btns").append('<span id="block_title" style="float:left">'+g_pog_json[e].POGCode+"</span>"),void 0!==g_scene_objects[e].Indicators&&(g_show_fixel_label=g_scene_objects[e].Indicators.FixelLabel,g_show_item_label=g_scene_objects[e].Indicators.ItemLabel,g_show_notch_label=g_scene_objects[e].Indicators.NotchLabel,g_show_max_merch=g_scene_objects[e].Indicators.MaxMerch,g_show_item_color=g_scene_objects[e].Indicators.ItemColor,g_show_item_desc=g_scene_objects[e].Indicators.ItemDesc,g_show_live_image=g_scene_objects[e].Indicators.LiveImage,g_show_days_of_supply=g_scene_objects[e].Indicators.DaysOfSupply,g_overhung_shelf_active=g_scene_objects[e].Indicators.OverhungShelf,g_itemSubLabelInd=g_scene_objects[e].Indicators.ItemSubLabelInd,g_itemSubLabel=g_scene_objects[e].Indicators.ItemSubLabel),g_all_pog_flag="N"}ItemJSON.length>0&&("FAIL"==await item_upld_create(ItemJSON,g_pog_index)&&apex.navigation.redirect("f?p="+$v("pFlowId")+":"+$v("pFlowStepId")+":"+$v("pInstance")+":APPLICATION_PROCESS=DOWNLOAD_ERROR_TMPL"));pog_edited_ind="Y",g_ComViewIndex>-1&&"Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&g_pog_json.splice(g_ComViewIndex,1);await save_pog_to_json(g_pog_json);var _=JSON.parse(JSON.stringify(g_pog_json));_.length>1&&($("#pog_list_btn").css("display","block"),$("#chng_view_btn").css("display","block"),$(".add_pog").css("display","block"),$(".open_par").css("display","block")),g_pog_json=[];for(e=0;e<=_.length-1;e++){void 0!==g_scene_objects[e].Indicators&&(g_show_fixel_label=g_scene_objects[e].Indicators.FixelLabel,g_show_item_label=g_scene_objects[e].Indicators.ItemLabel,g_show_notch_label=g_scene_objects[e].Indicators.NotchLabel,g_show_max_merch=g_scene_objects[e].Indicators.MaxMerch,g_show_item_color=g_scene_objects[e].Indicators.ItemColor,g_show_item_desc=g_scene_objects[e].Indicators.ItemDesc,g_show_live_image=g_scene_objects[e].Indicators.LiveImage,g_show_days_of_supply=g_scene_objects[e].Indicators.DaysOfSupply,g_overhung_shelf_active=g_scene_objects[e].Indicators.OverhungShelf,g_itemSubLabelInd=g_scene_objects[e].Indicators.ItemSubLabelInd,g_itemSubLabel=g_scene_objects[e].Indicators.ItemSubLabel),g_pog_index=e,g_world=g_scene_objects[e].scene.children[2],g_camera=g_scene_objects[e].scene.children[0],g_scene=g_scene_objects[e].scene,set_indicator_objects(e);await create_module_from_json(_,"T","F",$v("P25_PRODUCT_BTN_CLICK"),"N","N","N","Y","Y","","N",g_scene_objects[e].scene.children[0],g_scene_objects[e].scene,g_pog_index,e);render(e)}await render_all_pog();g_pog_json=g_multi_pog_json;for(e=0;e<=g_pog_json.length-1;e++)if(e>0)await enableDisableFlags(e);g_ComViewIndex>-1&&"Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&await edit_pallet("Y",g_edit_pallet_mod_ind,g_edit_pallet_shelf_ind,g_ComBaseIndex,"Y"),$(".open_product").css("display","block"),$s("P25_UPLD_ID","")}ItemJSON=JSON.parse($.trim(e)),g_pog_index=null!==sessionStorage.getItem("export_index")?parseInt(sessionStorage.getItem("export_index")):0,o(),apex.message.showPageSuccess(get_message("SUCCESS_MSG"))}catch{raise_error($.trim(e))}else{raise_error(get_message("POGCR_NO_ITEM_ERR"));var _=[];if(void 0!==g_pog_json[g_pog_index]&&g_pog_json.length>0?(_=g_pog_json,"N"):_=g_pog_json_data,g_pog_json=[],void 0!==_[g_pog_index]&&_.length>0){async function o(){g_ComViewIndex>-1&&"Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&_.splice(g_ComViewIndex,1),addLoadingIndicator();await create_all_pog_onload(_);removeLoadingIndicator(regionloadWait),g_ComViewIndex>-1&&"Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&await edit_pallet("Y",g_edit_pallet_mod_ind,g_edit_pallet_shelf_ind,g_ComBaseIndex,"Y")}o()}g_pog_json_data=[]}null!==apex.region("draggable_table")&&apex.region("draggable_table").refresh()}))}else if("Y"==sessionStorage.getItem("POGExists")&&"N"==$v("P25_NEW_SESSION")){void 0!==g_pog_json[g_pog_index]&&g_pog_json.length>0?(POG_JSON=JSON.parse(JSON.stringify(g_pog_json)),create_json="N"):POG_JSON=JSON.parse(JSON.stringify(g_pog_json_data)),g_ComViewIndex>-1&&"Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&(POG_JSON.splice(g_ComViewIndex,1),g_pog_json.splice(g_ComViewIndex,1)),g_pog_json=[],addLoadingIndicator();await create_all_pog_onload(POG_JSON);removeLoadingIndicator(regionloadWait),g_ComViewIndex>-1&&"Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&await edit_pallet("Y",g_edit_pallet_mod_ind,g_edit_pallet_shelf_ind,g_ComBaseIndex,"Y"),g_pog_json.length>1&&animate_all_pog()}generateMultiPogDropdown(),"Y"==g_show_live_image&&animate_all_pog()}(),g_dblclick_opened="N"}else"Y"==$v("P25_OPEN_NEW_TAB")&&raise_error($v("P25_NEW_TAB_POG_CODE")+" - POG Details Not Found");logDebug("function : onload_create_pog; ","E")}))}async function create_all_pog_onload(e){g_pog_index=0,g_multi_pog_json=[],g_canvas_objects=[],e.length>1&&($("#pog_list_btn").css("display","block"),$("#chng_view_btn").css("display","block"),$(".add_pog").css("display","block"),$(".open_par").css("display","block")),g_multi_pog_json=[],appendMultiCanvasRowCol(e.length,$v("P25_POGCR_TILE_VIEW")),switchCanvasView($v("P25_POGCR_TILE_VIEW"),"Y");for(var o=0;o<=e.length-1;o++){g_pog_index=o,init(o),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_json=[e[o]],g_scene_objects.push(objects),set_indicator_objects(o);await create_module_from_json(e,sessionStorage.getItem("new_pog_ind"),"F",$v("P25_PRODUCT_BTN_CLICK"),sessionStorage.getItem("pog_opened"),"N","N","Y","Y","","N",g_scene_objects[o].scene.children[0],g_scene_objects[o].scene,g_pog_index,o);var _=g_canvas_objects[o].getAttribute("id");$("#"+_+"-btns").append('<span id="block_title" style="float:left">'+g_pog_json[o].POGCode+"</span>")}await render_all_pog();setPogActive(g_pog_index),g_pog_json=g_multi_pog_json}async function update_json_object_id(e,o,_,n){if(console.log("update json",e,o,_),void 0!==n&&n.length>0&&void 0!==n[e]){for(const o of _[e].scene.children[2].children){var t=add_wireframe(o,2);o.WFrameID=t}if(void 0!==n[e].BaseObjID){var i=0,a=-1;for(const _ of o[e]){if(n[e].BaseObjID==_){a=i;break}i++}n[e].BaseObjID=_[e].scene.children[2].children[a].id}var s=n[e].ModuleInfo,g=0;for(const t of s){if(null==t.ParentModule||"undefined"==t.ParentModule){if(void 0!==t.MObjID){i=0,a=-1;for(const _ of o[e]){if(t.MObjID==_){a=i;break}i++}t.MObjID=_[e].scene.children[2].children[a].id,_[e].scene.children[2].children[a].Module=t.Module}var l=0;for(const s of t.ShelfInfo){if(void 0!==s){if("NOTCH"!==s.ObjType&&"BASE"!==s.ObjType){if(void 0!==s.SObjID){i=0,a=-1;for(const _ of o[e]){if(s.SObjID==_){a=i;break}i++}s.SObjID=_[e].scene.children[2].children[a].id,_[e].scene.children[2].children[a].FixelID=s.Shelf,_[e].scene.children[2].children[a].Module=t.Module,_[e].scene.children[2].children[a].W=s.W,_[e].scene.children[2].children[a].H=s.H,_[e].scene.children[2].children[a].D=s.D,_[e].scene.children[2].children[a].Color=s.Color,_[e].scene.children[2].children[a].Rotation=s.Rotation,_[e].scene.children[2].children[a].ItemSlope=s.Slope,_[e].scene.children[2].children[a].Rotation=0!==s.Rotation||0!==s.Slope?"Y":"N",_[e].scene.children[2].children[a].ImageExists="N","SHELF"==s.ObjType&&(_[e].scene.children[2].children[a].AvlSpace=wpdSetFixed(nvl(s.AvlSpace)))}n[e].ModuleInfo[g].ShelfInfo[l].SIndex=l,n[e].ModuleInfo[g].ShelfInfo[l].MIndex=g}if(s.ItemInfo.length>0){var r=0;for(const t of s.ItemInfo){if(void 0!==t.ObjID){i=0,a=-1;for(const _ of o[e]){if(t.ObjID==_){a=i;break}i++}t.ObjID=_[e].scene.children[2].children[a].id,_[e].scene.children[2].children[a].ItemID=t.Item,_[e].scene.children[2].children[a].Description=t.Desc,_[e].scene.children[2].children[a].HorizFacing=t.BHoriz,_[e].scene.children[2].children[a].VertFacing=t.BVert,_[e].scene.children[2].children[a].DFacing=t.BaseD,_[e].scene.children[2].children[a].DimUpdate=t.DimUpdate,_[e].scene.children[2].children[a].SellingPrice=t.SellingPrice,_[e].scene.children[2].children[a].ShelfPrice=t.ShelfPrice,_[e].scene.children[2].children[a].PromoPrice=t.PromoPrice,_[e].scene.children[2].children[a].DiscountRate=t.DiscountRate,_[e].scene.children[2].children[a].PriceChangeDate=t.PriceChangeDate,_[e].scene.children[2].children[a].WeeksOfInventory=t.WeeksOfInventory,_[e].scene.children[2].children[a].Qty=t.Qty,_[e].scene.children[2].children[a].WhStock=t.WhStock,_[e].scene.children[2].children[a].StoreStock=t.StoreStock,_[e].scene.children[2].children[a].StockIntransit=t.StockIntransit,_[e].scene.children[2].children[a].SalesUnit=t.SalesUnit,_[e].scene.children[2].children[a].NetSales=t.NetSales,_[e].scene.children[2].children[a].CogsAdj=t.CogsAdj,_[e].scene.children[2].children[a].GrossProfit=t.GrossProfit,_[e].scene.children[2].children[a].WeeksCount=t.WeeksCount,_[e].scene.children[2].children[a].MovingItem=t.MovingItem,_[e].scene.children[2].children[a].RegMovement=t.RegMovement,_[e].scene.children[2].children[a].AvgSales=t.AvgSales,_[e].scene.children[2].children[a].ItemStatus=t.ItemStatus,_[e].scene.children[2].children[a].CDTLvl1=t.CDTLvl1,_[e].scene.children[2].children[a].CDTLvl2=t.CDTLvl2,_[e].scene.children[2].children[a].CDTLvl3=t.CDTLvl3,_[e].scene.children[2].children[a].StoreCnt=t.StoreCnt,_[e].scene.children[2].children[a].WeeksOfInventory=t.WeeksOfInventory,_[e].scene.children[2].children[a].Profit=t.Profit,_[e].scene.children[2].children[a].TotalMargin=t.TotalMargin,_[e].scene.children[2].children[a].W=t.W,_[e].scene.children[2].children[a].H=t.H,_[e].scene.children[2].children[a].D=t.D,_[e].scene.children[2].children[a].Color=t.Color,_[e].scene.children[2].children[a].Barcode=t.Barcode,_[e].scene.children[2].children[a].Desc=t.Desc,_[e].scene.children[2].children[a].Brand=t.Brand,_[e].scene.children[2].children[a].Group=t.Group,_[e].scene.children[2].children[a].Dept=t.Dept,_[e].scene.children[2].children[a].Class=t.Class,_[e].scene.children[2].children[a].SubClass=t.SubClass,_[e].scene.children[2].children[a].StdUOM=t.StdUOM,_[e].scene.children[2].children[a].SizeDesc=t.SizeDesc,_[e].scene.children[2].children[a].Supplier=t.Supplier,_[e].scene.children[2].children[a].LocID=t.LocID,_[e].scene.children[2].children[a].Supplier=t.Supplier,_[e].scene.children[2].children[a].ItemDim=(100*t.OW).toFixed(2)+" : "+(100*t.OH).toFixed(2)+" : "+(100*t.OD).toFixed(2),_[e].scene.children[2].children[a].OrientationDesc=t.OrientationDesc,_[e].scene.children[2].children[a].StoreCnt=t.StoreCnt,_[e].scene.children[2].children[a].RotationDegree=t.Rotation,_[e].scene.children[2].children[a].OW=t.OW,_[e].scene.children[2].children[a].OH=t.OH,_[e].scene.children[2].children[a].OD=t.OD,_[e].scene.children[2].children[a].DescSecond=t.DescSecond,_[e].scene.children[2].children[a].Shelf=s.Shelf,_[e].scene.children[2].children[a].Rotation=0,_[e].scene.children[2].children[a].ItemSlope=0,_[e].scene.children[2].children[a].Rotation=0!==t.Rotation||0!==t.Slope?"Y":"N",_[e].scene.children[2].children[a].ImageExists="N",_[e].scene.children[2].children[a].ItemCondition=t.ItemCondition,_[e].scene.children[2].children[a].AUR=t.AUR,_[e].scene.children[2].children[a].ItemRanking=t.ItemRanking,_[e].scene.children[2].children[a].WeeklySales=t.WeeklySales,_[e].scene.children[2].children[a].WeeklyNetMargin=t.WeeklyNetMargin,_[e].scene.children[2].children[a].WeeklyQty=t.WeeklyQty,_[e].scene.children[2].children[a].NetMarginPercent=t.NetMarginPercent,_[e].scene.children[2].children[a].CumulativeNM=t.CumulativeNM,_[e].scene.children[2].children[a].TOP80B2=t.TOP80B2,_[e].scene.children[2].children[a].ItemBrandC=t.ItemBrandC,_[e].scene.children[2].children[a].ItemPOGDept=t.ItemPOGDept,_[e].scene.children[2].children[a].ItemRemark=t.ItemRemark,_[e].scene.children[2].children[a].RTVStatus=t.RTVStatus,_[e].scene.children[2].children[a].Pusher=t.Pusher,_[e].scene.children[2].children[a].Divider=t.Divider,_[e].scene.children[2].children[a].BackSupport=t.BackSupport,_[e].scene.children[2].children[a].CWPerc=t.CWPerc,_[e].scene.children[2].children[a].CHPerc=t.CHPerc,_[e].scene.children[2].children[a].CDPerc=t.CDPerc,_[e].scene.children[2].children[a].OOSPerc=t.OOSPerc,_[e].scene.children[2].children[a].InitialItemDesc=t.InitialItemDesc,_[e].scene.children[2].children[a].InitialBrand=t.InitialBrand,_[e].scene.children[2].children[a].InitialBarcode=t.InitialBarcode}n[e].ModuleInfo[g].ShelfInfo[l].ItemInfo[r].MIndex=g,n[e].ModuleInfo[g].ShelfInfo[l].ItemInfo[r].SIndex=l,n[e].ModuleInfo[g].ShelfInfo[l].ItemInfo[r].IIndex=r,r++}}}l++}}g++}}}function create_pdf_func(){try{logDebug("function : create_pdf_func","S"),addLoadingIndicator();var e={SeqNo:"",POGCode:g_pog_json[g_pog_index].POGCode,POGVersion:p_pogInfoArr[0].Version,POGModule:"",Selection_Type:"Y"==workflow_draft?"D":"E",Print_Type:"P",SequenceId:p_pogInfoArr[0].seqId,TemplateId:$v("P25_PDF_TEMPLATE").split("-")[0],TemplateDetails:$v("P25_PDF_TEMPLATE")};create_pdf(e,"N","N",g_camera,"E",$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_NOTCH_HEAD"),"Y",g_pog_index,"Y",g_all_pog_flag,$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),"","",g_hide_show_dos_label,"",$v("P25_POGCR_ENHANCE_PDF_IMG"),$v("P25_POGCR_PDF_IMG_ENHANCE_RATIO"),$v("P25_POGCR_PDF_CANVAS_SIZE"),$v("P25_VDATE"),$v("P25_POG_POG_DEFAULT_COLOR"),$v("P25_POG_MODULE_DEFAULT_COLOR"),$v("P25_POGCR_DFT_SPREAD_PRODUCT"),$v("P25_PEGB_DFT_HORIZ_SPACING"),$v("P25_PEGBOARD_DFT_VERT_SPACING"),$v("P25_BASKET_DFT_WALL_THICKNESS"),$v("P25_CHEST_DFT_WALL_THICKNESS"),$v("P25_POGCR_PEGB_MAX_ARRANGE"),$v("P25_POGCR_DEFAULT_WRAP_TEXT"),$v("P25_POGCR_TEXT_DEFAULT_SIZE"),$v("P25_POG_TEXTBOX_DEFAULT_COLOR"),$v("P25_POG_SHELF_DEFAULT_COLOR"),$v("P25_DIV_COLOR"),$v("P25_SLOT_DIVIDER"),$v("P25_SLOT_ORIENTATION"),$v("P25_DIVIDER_FIXED"),$v("P25_POG_ITEM_DEFAULT_COLOR"),$v("P25_POGCR_DFT_BASKET_FILL"),$v("P25_POGCR_DFT_BASKET_SPREAD"),$v("P25_POGCR_BAY_LIVE_IMAGE"),$v("P25_POGCR_BAY_WITHOUT_LIVE_IMAGE"),"N"),logDebug("function : create_pdf_func","E")}catch(e){error_handling(e)}}function update_selected(e,o){try{logDebug("function : update_selected; p_pog_code : "+e+"; action : "+o,"S"),apex.server.process("UPDATE_EXIST_POG_COLL",{f01:e,x01:o},{dataType:"text",success:function(e){if(""!==$.trim(e)){var o=$.trim(e).split("-");"error"==o[0]&&alert(o[1])}else logDebug("function : update_selected","E")}})}catch(e){error_handling(e)}}function ig_checking(e,o,_){try{logDebug("function : ig_checking; pChecked : "+e+"; pParamClass : "+o+"; pCalledFrom : "+_,"S");var n=apex.region("existing_pog_details").widget().interactiveGrid("getViews","grid").model,t=[];n.forEach((function(_){var i=n.getValue(_,"POG_CODE");t.push(i);var a='#existing_pog_details [data-param="'+i+'"].'+o;$(a).hasClass("fa-square-o")&&"Y"==e?($(a).removeClass("fa-square-o"),$(a).addClass("fa-check-square-o")):$(a).hasClass("fa-check-square-o")&&"N"==e&&($(a).removeClass("fa-check-square-o"),$(a).addClass("fa-square-o"))})),update_selected(t,"N"==e?"UNCHECK":"CHECK"),$("#existing_pog_details_ig_grid_vc_status").html(apex.lang.formatMessage("APEX.GV.SELECTION_COUNT",$("#existing_pog_details_ig_grid_vc .a-GV-bdy table tbody").find("tr span.fa-check-square-o").length)),logDebug("function : ig_checking","E")}catch(e){error_handling(e)}}async function conditional_highlight(){return logDebug("function : update_pog_json","S"),new Promise((function(e,o){if(updPog=[],g_pog_json.length>1){var _=0;for(const e of g_pog_json)updPog.push(g_pog_json[_]),_++}else updPog.push(g_pog_json[g_pog_index]);apex.server.process("UPDATE_HIGHLIGHT_JSON",{p_clob_01:JSON.stringify(updPog)},{dataType:"html"}).done((function(o){openInlineDialog("condition_highlight",55,67),apex.region("condition_rgn").refresh(),logDebug("function : update_pog_json","E"),e($.trim(o))}))}))}async function conditional_module_swap(){try{logDebug("function : conditional_module_swap","S");await save_pog_to_json(g_pog_json[g_pog_index]);apex.server.process("DELETE_SWAP_MODULE_COLL",{x01:""},{dataType:"text",success:function(e){apex.region("swap_grid").widget().interactiveGrid("getActions").set("edit",!1),apex.region("swap_grid").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("swap_grid").refresh(),$s("P25_SWAP_MODULES",""),openInlineDialog("module_Swap",45,50)}}),logDebug("function : conditional_module_swap","E")}catch(e){error_handling(e)}}function refreshItemGroupingArr(e){try{logDebug("function : refreshItemGroupingArr ; itemInfo"+e,"S");var o=g_color_arr.filter((function(o){return o.DESCRIPTION!==e.Brand&&o.DESCRIPTION!==e.Supplier&&o.DESCRIPTION!==e.SubClass&&o.DESCRIPTION!==e.Class&&o.DESCRIPTION!==e.Group&&o.DESCRIPTION!==e.Dept}));removeLoadingIndicator(regionloadWait);var _=$v("P25_SELECT_COLOR_TYPE");return new Promise((function(e,n){apex.server.process("CREATE_ITEMS_COLOR_COLL",{x01:_,p_clob_01:JSON.stringify(o)},{dataType:"text",success:function(e){""!=$.trim(e)&&logDebug("function : refreshItemGroupingArr","E")},loadingIndicatorPosition:"none"})}))}catch(e){error_handling(e)}}function open_pdf_online(){try{logDebug("function : open_pdf_online","S"),g_pdf_online_clck="Y",g_dblclick_opened="Y",$("#P25_SAVE_WITH_PDF_CONTAINER").hide(),$("#P25_POG_PDF_REMINDER_MSG_CONTAINER").hide(),$("#P25_PDF_TEMPLATE_CONTAINER").show(),$("#SAVE_POG").hide(),$("#SAVE_PDF").show(),$s("P25_SAVE_WITH_PDF","Y");let o=$v("P25_PDF_TEMPLATE"),_=o.split("-")[10];o&&"Y"==_?($s("P25_DEFAULT_LIVE_VERSION","Y"),$s("P25_PREV_POG_CODE",g_pog_json[g_pog_index].POGCode),$("#P25_DEFAULT_LIVE_VERSION_CONTAINER").show()):($s("P25_DEFAULT_LIVE_VERSION","Y"),$("#P25_DEFAULT_LIVE_VERSION_CONTAINER").hide()),$("#ui-id-14").text("Generate PDF");var e=check_cookie_name("PDF_TEMPLATE",$v("P25_BU_ID"));""!==e&&$s("P25_PDF_TEMPLATE",e),openInlineDialog("open_pdf_modal",25,25),logDebug("function : open_pdf_online","E")}catch(e){error_handling(e)}}async function generate_draft_pdf(){try{logDebug("function : generate_draft_pdf","S");await save_pog_to_json([g_pog_json[g_pog_index]]);logDebug("function : generate_draft_pdf after save","S"),apex.server.process("TRUNC_MOD_IMG_COLL",{x01:""},{dataType:"text",success:function(e){!async function(){var e={SeqNo:"",POGCode:g_pog_json[g_pog_index].POGCode,POGVersion:g_pog_json[g_pog_index].Version,POGModule:"",Selection_Type:draftPogInd,Print_Type:"P",SequenceId:"",TemplateId:$v("P25_PDF_TEMPLATE").split("-")[0],TemplateDetails:$v("P25_PDF_TEMPLATE")};await create_pdf(e,"N","N",g_camera,"D",$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_NOTCH_HEAD"),"Y",g_pog_index,"Y",g_all_pog_flag,$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),"","",g_hide_show_dos_label,"Y",$v("P25_POGCR_ENHANCE_PDF_IMG"),$v("P25_POGCR_PDF_IMG_ENHANCE_RATIO"),$v("P25_POGCR_PDF_CANVAS_SIZE"),$v("P25_VDATE"),$v("P25_POG_POG_DEFAULT_COLOR"),$v("P25_POG_MODULE_DEFAULT_COLOR"),$v("P25_POGCR_DFT_SPREAD_PRODUCT"),$v("P25_PEGB_DFT_HORIZ_SPACING"),$v("P25_PEGBOARD_DFT_VERT_SPACING"),$v("P25_BASKET_DFT_WALL_THICKNESS"),$v("P25_CHEST_DFT_WALL_THICKNESS"),$v("P25_POGCR_PEGB_MAX_ARRANGE"),$v("P25_POGCR_DEFAULT_WRAP_TEXT"),$v("P25_POGCR_TEXT_DEFAULT_SIZE"),$v("P25_POG_TEXTBOX_DEFAULT_COLOR"),$v("P25_POG_SHELF_DEFAULT_COLOR"),$v("P25_DIV_COLOR"),$v("P25_SLOT_DIVIDER"),$v("P25_SLOT_ORIENTATION"),$v("P25_DIVIDER_FIXED"),$v("P25_POG_ITEM_DEFAULT_COLOR"),$v("P25_POGCR_DFT_BASKET_FILL"),$v("P25_POGCR_DFT_BASKET_SPREAD"),$v("P25_POGCR_BAY_LIVE_IMAGE"),$v("P25_POGCR_BAY_WITHOUT_LIVE_IMAGE"),"N"),g_pdf_online_clck="N",logDebug("function : generate_draft_pdf","E")}()},loadingIndicatorPosition:"none"})}catch(e){error_handling(e)}}function openCustomDialog(e,o,_){try{if(logDebug("function : openCustomDialog; p_ind : "+e+"; p_url : "+o+"; p_item :"+_+"E"),g_intersected){for(var n=0;n<g_intersected.length;n++)void 0!==g_intersected[n]&&(void 0!==g_intersected[n].BorderColour&&(g_select_color=g_intersected[n].BorderColour),g_intersected[n].WireframeObj.material.color.setHex(g_intersected[n].BorderColour),"Y"==g_intersected[n].ImageExists&&"Y"==g_show_live_image&&(g_intersected[n].WireframeObj.material.transparent=!0,g_intersected[n].WireframeObj.material.opacity=.0025));clearInterval(g_myVar),g_select_color=0,render(g_pog_index)}$s(_,e),apex.navigation.redirect(o),logDebug("function : openCustomDialog; ","E")}catch(e){error_handling(e)}}async function showDaysOfSupply(){logDebug("function : showDaysOfSupply; ","S");var e=g_pog_index;if("undefined"!=typeof g_pog_json&&g_pog_json.length>0){if("Y"==g_all_pog_flag)var o=0;else o=g_pog_index;"N"==g_show_days_of_supply?(g_show_days_of_supply="Y",$(".supply_days").addClass("item_label_active")):(g_show_days_of_supply="N",$(".supply_days").removeClass("item_label_active"));for(const e of g_pog_json){if((o!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex)&&(g_renderer=g_scene_objects[o].renderer,g_scene=g_scene_objects[o].scene,g_camera=g_scene_objects[o].scene.children[0],g_world=g_scene_objects[o].scene.children[2],"Y"==g_show_item_desc&&"Y"==g_show_days_of_supply&&(g_show_item_desc="N",$(".item_desc").removeClass("item_label_active"),await showHideItemDescription("N",$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),o)),await showHideDaysOfSupplyLabel(g_show_days_of_supply,"N",o,"Y","Y",$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label),render(o),set_indicator_objects(o)),"Y"!=g_all_pog_flag)break;o++}g_renderer=g_scene_objects[e].renderer,g_scene=g_scene_objects[e].scene,g_camera=g_scene_objects[e].scene.children[0],g_world=g_scene_objects[e].scene.children[2],g_prev_undo_action="supply_days"}logDebug("function : open_item_label; ","E")}async function enableDisableFlags(e,o="N"){try{if("Y"==g_show_notch_label?($(".notch_label").addClass("notch_label_active"),show_notch_labels("Y",$v("P25_NOTCH_HEAD"),"Y",e)):"Y"==o&&"N"==g_show_notch_label&&show_notch_labels("N",$v("P25_NOTCH_HEAD"),"N",e),"Y"==g_show_fixel_label&&($(".fixel_label").addClass("fixel_label_active"),show_fixel_labels("Y",e)),"Y"==g_show_item_label?($(".item_label").addClass("item_label_active"),show_item_labels("Y",$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),e)):"Y"==o&&"N"==g_show_item_label&&show_item_labels("N",$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),e),"Y"==g_itemSubLabelInd&&($(".item_sublabel").addClass("item_sublabel_active"),$("#item_sublbl_sub ."+g_itemSubLabel).addClass("item_sublabel_active"),showItemSubLabel(g_itemSubLabel,g_itemSubLabelInd,$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),e)),"Y"==g_show_max_merch){await add_merch("Y",e)}else if("Y"==o&&"N"==g_show_max_merch){await add_merch("N",e)}if("Y"==g_show_item_color)await ShowColorBackup(e),await item_grouping(e,$v("P25_SELECT_COLOR_TYPE")),await set_items_color(e,$v("P25_SELECT_COLOR_TYPE"));if("Y"==g_show_days_of_supply)await showHideDaysOfSupplyLabel("Y","N",e,"Y","Y",$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label);else await showHideDaysOfSupplyLabel("N","N",e,"Y","N",$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label);"Y"==g_show_fixel_space||"Y"==o&&"N"==g_show_fixel_space?showFixelAvailableSpace("N","N",e):showFixelAvailableSpace("N","Y",e),reset_indicators()}catch(e){error_handling(e)}}async function calculateFixelAndSupplyDays(e="N",o){try{if(logDebug("function : calculateFixelAndSupplyDays","S"),"Y"==g_show_fixel_space&&(o!==g_ComViewIndex||o==g_ComViewIndex&&"PREV_VERSION"==g_compare_view)?showFixelAvailableSpace("N","N",o):o!==g_ComViewIndex&&showFixelAvailableSpace("N","Y",o),console.log("g_show_days_of_supply",g_show_days_of_supply,o,g_ComViewIndex),"Y"==g_show_days_of_supply&&(o!==g_ComViewIndex||o==g_ComViewIndex&&"PREV_VERSION"==g_compare_view))await showHideDaysOfSupplyLabel("Y",e,o,"Y","Y",$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label);"Y"==g_itemSubLabelInd&&showItemSubLabel(g_itemSubLabel,g_itemSubLabelInd,$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),o),reset_indicators(),logDebug("function : calculateFixelAndSupplyDays","E")}catch(e){error_handling(e)}}function menuActions(e,o){try{switch(logDebug("function : menuActions","S"),"Y"===g_is_pog_maximize&&["LIVE_IMAGE","RESET_ZOOM","AREA_ZOOM","AREA_ZOOM_AREA"].includes(e)&&(g_pog_index=0),backupPog("F",-1,-1,g_pog_index),e){case"RENUMBERING":open_renumbering();break;case"FIXEL_LABEL":open_fixel_label();break;case"ITEM_LABEL":open_item_label();break;case"NOTCH_LABEL":open_notch_label(g_pog_index);break;case"FIXEL_MERCH":fixel_merch();break;case"CONDITIONAL_HIGHLIGHT":conditional_highlight(g_pog_index);break;case"SHOW_ITEM_COLOR":showItemColor(o,g_pog_index);break;case"FIXEL_AVAILABLE_SPACE":showFixelAvailableSpace("Y","N",g_pog_index);break;case"SHOW_ITEM_DESCRIPTION":showItemDescription(g_pog_index);break;case"SHOW_DAYS_OF_SUPPLY":showDaysOfSupply(g_pog_index);break;case"LIVE_IMAGE":live_image();break;case"Recal_Compare":recal_compare();break;case"REFRESH_SALES":sales_refresh();break;case"REFRESH_ITEMS":refresh_items();break;case"OPEN_3D":open_3d_popup();break;case"CLEAR_POG":clear_pog_info();break;case"CLEAR_ITEM":clear_item_init(o);break;case"OPEN_FIXEL":open_fixel();break;case"OPEN_PDF_ONLINE":open_pdf_online();break;case"MODULE_SWAP":conditional_module_swap();break;case"MAXIMIZE_FACINGS":enable_maximize_facings(o,g_pog_index);break;case"PEG_HOLES":peg_holes(g_pog_index);break;case"PEG_TAGS":show_pegTages();break;case"AUTO_POSITION":auto_position();break;case"AUTO_POSITION_ALL":auto_position_all_init("Y");break;case"RESET_ZOOM":reset_zoom();break;case"AREA_ZOOM":area_zoom();break;case"AREA_ZOOM_AREA":select_zoom_init();break;case"COMPARE_POG":compare_pog();break;case"PREV_VERSION":prev_ver(o);break;case"CREATE_SIDE_VIEW":create_side_view(o);break;case"EDIT_PALLET":edit_pallet_init();break;case"CLOSE_COMPARE":close_compare();break;case"UPDATE_ITEM_INFO":open_update_item_info();break;case"AUTO_POSITION_PEG":auto_position_pegboard();break;case"DELIST_ITEM":item_delist();break;case"ACTIVATE_OVERHUNG_SHELF":activateOverhungShelf(g_pog_index);break;case"DEPTH_FACING_REMARKS":open_depth_facing_rmks();break;case"SHOW_ITEM_SUBLBL":openItemSubLabel(o);break;case"AUTO_DEPTH_FACING":auto_depth_facing();break;case"REFRESH_AUTO_DIVIDER":refresh_auto_divider(g_pog_index);break;case"Add_POG":open_aditional_pog();break;case"AUTO_POSITION_NO_SUBSHLF":auto_position_all_init("N")}logDebug("function : menuActions","E")}catch(e){error_handling(e)}}async function refresh_auto_divider(e){logDebug("function : refresh_auto_divider","S");try{if("Y"==g_all_pog_flag)var o=0;else o=e;if(g_pog_json.length>0){addLoadingIndicator();for(const r of g_pog_json){if(o!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex){g_renderer=g_scene_objects[o].renderer,g_scene=g_scene_objects[o].scene,g_camera=g_scene_objects[o].scene.children[0],g_world=g_scene_objects[o].scene.children[2];var _=0;for(const r of g_pog_json[o].ModuleInfo){if(null==r.ParentModule){var n=0;for(const d of r.ShelfInfo){if("BASE"!==d.ObjType&&"NOTCH"!==d.ObjType&&"DIVIDER"!==d.ObjType&&d.DivHeight>0&&d.DivWidth>0){var t=JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[_].ShelfInfo[n].ItemInfo));await create_shelf_dividers(o,_,n);var i=[],a=[],s=[],g=[],l=g_pog_json[o].ModuleInfo[_].ShelfInfo[n].ItemInfo;$.each(l,(function(e,t){void 0!==t.BottomObjID&&""!=t.BottomObjID||(i.push(wpdSetFixed(t.W)),a.push(wpdSetFixed(t.H)),s.push(wpdSetFixed(t.D)),g.push(e)),g_pog_json[o].ModuleInfo[_].ShelfInfo[n].ItemInfo[e].Exists="E"})),validate_items(i,a,s,g,d.ObjType,_,n,-1,"N",0,0,0,-1,"N","Y","Y","N","N",[],"Y","Y","Y",o)?reorder_items(_,n,o)&&(console.log("inside recreate"),await recreate_all_items(_,n,d.ObjType,"N",-1,-1,d.ItemInfo.length,"Y","N",-1,-1,o,"",o,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")):(remove_shelf_dividers(e,_,d.Shelf),g_pog_json[o].ModuleInfo[_].ShelfInfo[n].ItemInfo=t,reorder_items(_,n,o)&&await recreate_all_items(_,n,d.ObjType,"N",-1,-1,t.length,"Y","N",-1,-1,o,"",o,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y"))}n++}}_++}render(o)}if("Y"!=g_all_pog_flag)break;o++}apex.message.showPageSuccess(g_pog_refresh_msg),removeLoadingIndicator(regionloadWait)}logDebug("function : refresh_auto_divider","E")}catch(e){error_handling(e)}}function auto_depth_facing(){logDebug("function : peg_holes","S");var e=get_canvas_json("LABEL");if(void 0!==e&&e.length>0){"N"==g_auto_cal_depth_fac?(g_auto_cal_depth_fac="Y",$(".auto_depth").addClass("auto_depth_active")):(g_auto_cal_depth_fac="N",$(".auto_depth").removeClass("auto_depth_active"))}logDebug("function : peg_holes","E")}function calcMaxFacings(e,o,_,n,t,i,a){var s=t;if(0!==nvl(s)){var g,l,r,d,c,f,I,p,h=$v("P25_POGCR_AUTO_MAX_VFACING"),u=get_shelf_max_merch(e,e[a].ModuleInfo[o],n,o,_,parseFloat($v("P25_POGCR_DFT_MAX_MERCH"))),m=t.RH/t.BVert,O=Math.floor(100*u/(100*m)),S=1,P="HANGINGBAR"==n.ObjType?0:findNearByShelfMaxDepth(o,_,i,i,-1,e);p="HANGINGBAR"==n.ObjType?0==e[a].ModuleInfo[o].ShelfInfo[_].MaxMerch||""==e[a].ModuleInfo[o].ShelfInfo[_].MaxMerch?g_hangbar_dft_maxmerch:e[a].ModuleInfo[o].ShelfInfo[_].MaxMerch:e[a].ModuleInfo[o].ShelfInfo[_].D;var E=s.RD/s.BaseD;"Y"==s.MDepthCrushed&&s.CrushD>0&&(E-=E*s.CrushD/100),S=Math.floor(100*(p-P)/(100*E));var v=nvl(s.MPogDepthFacings)>0?s.MPogDepthFacings:s.MDepthFacings;if(c=E*((S=v<S&&v>-1?v:S)>0?S:1),f=S>0?S:1,I=s.D,"SHELF"==n.ObjType){var D=nvl(s.MPogVertFacings)>0?s.MPogVertFacings:s.MVertFacings,C=D>-1?D:h;O>C&&(O=C),g=m*(O>0?O:1),l=O>0?O:1;var[T,r]=get_item_xy(n,s,s.W,g,e);d=g}}return[g,l,d,r,c,f,I]}async function duplicateShelf(e,o){logDebug("function : duplicateShelf","S");var _={},n=$v("P25_POG_SHELF_DEFAULT_COLOR"),t=new THREE.Color(n),i=0,a=-1,s=-1,g=-1;try{$.each(g_pog_json[o].ModuleInfo,(function(e,o){if(null==o.ParentModule||void 0===o.ParentModule)return g_module_index=e,!1}));var l=g_intersects[0].point.x,r=g_intersects[0].point.y,d=g_intersects[0].point.z,c=new THREE.Vector3(l,r,d);g_scene_objects[o].scene.children[2].worldToLocal(c),x=Math.min(19,Math.max(-19,c.x)),y=Math.min(19,Math.max(-19,c.y)),_.Shelf="C"+g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo.length,_.ObjType="SHELF",_.Desc="",_.MaxMerch=0,_.GrillH=0,_.LoOverHang=0,_.ROverhang=0,_.SpacerThick=0,_.HorizGap=0,_.SpreadItem="L",_.Combine="N",_.AllowAutoCrush="N",_.H=.02,_.W=g_pog_json[o].ModuleInfo[g_module_index].W,_.D=g_pog_json[o].ModuleInfo[g_module_index].D,_.Rotation=0,_.Slope=0,_.Color=$v("P25_POG_SHELF_DEFAULT_COLOR"),_.LiveImage="",_.HorizSlotStart=0,_.HorizSlotSpacing=0,_.HorizStart=0,_.HorizSpacing=0,_.UOverHang=0,_.LOverhang=0,_.VertiStart=0,_.VertiSpacing=0,_.X=x,_.Y=y,_.Z=0,_.InputText="",_.WrapText="",_.ReduceToFit="",_.TextDirection="",_.BsktFill="",_.BsktSpreadProduct="",_.SnapTo="N",_.BsktWallH=0,_.BsktBaseH=0,_.BsktWallThickness=0,_.DSlotStart=0,_.DSlotSpacing=0,_.DGap=0,_.FrontOverHang=0,_.BackOverHang=0,_.SlotDivider="",_.AutoPlacing=$v("P25_POGCR_PEGB_MAX_ARRANGE"),_.AutoFillPeg="N",_.SlotOrientation="",_.DividerFixed="N",_.LObjID=-1,_.NotchLabelObjID=-1,_.FStyle="",_.FSize="",_.FBold="",_.TextImg="",_.TextImgName="",_.TextImgMime="",_.creationType="A",_.Overhung="N",_.AvlSpace=_.W+_.LOverhang+_.ROverhang;s=-1;var f=[],I=[];g_pog_json[o].ModuleInfo[g_module_index].LastCount=g_pog_json[o].ModuleInfo[g_module_index].LastCount+1,0==g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo.length?i=_.H/2+g_pog_json[o].BaseH:($.each(g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo,(function(e,o){"BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&(f.push(o.ShelfY),I.push(e))})),f.length>0?(i=Math.max.apply(Math,f),a=f.findIndex((function(e){return e==i})),i=i>0?i+g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[I[a]].H/2+g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[I[a]].MaxMerch+_.H/2:_.H/2+g_pog_json[o].BaseH):i=_.H/2+g_pog_json[o].BaseH),i>g_pog_json[o].H&&(i=g_pog_json[o].H+.02),_.X=x,_.Y=y,_.Z=g_pog_json[o].BackDepth/2+_.D/2,_.ItemInfo=[],g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo.push(_);var[p,h]=await add_shelf(_.Shelf,_.ObjType,_.W,_.H,_.D,t,x,y,.003,"N",g_module_index,_.Rotation,_.Slope,s,"Y","N","Y",-1,$v("P25_POG_CP_SHELF_DFLT_COLOR"),$v("P25_NOTCH_HEAD"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),o);updateObjID(_.OldObjID,p,"S");return g=h,"Y"==g_show_max_merch&&add_merch("Y",g_pog_index),apex.item("P25_SHELF_EDIT_IND").setValue("N"),g_dblclick_opened="N",duplicate_fixel_flag="N",await recreate_compare_views(g_compare_view,"N"),g_pog_json[o].ModuleInfo[g_module_index].ModuleEditFlag="Y",g_dragItem={},render(o),logDebug("function : duplicateShelf","E"),[g,p]}catch(e){error_handling(e)}}function remove_param_on_load(){try{logDebug("function : remove_param_on_load ; ","S"),"Y"==$v("P25_NEW_SESSION")&&(g_pog_json=[],$s("P25_NEW_SESSION","N"),sessionStorage.removeItem("POGJSON"),sessionStorage.removeItem("P25_EXISTING_DRAFT_VER"),sessionStorage.removeItem("P25_DRAFT_LIST"),sessionStorage.removeItem("P25_POG_DESCRIPTION")),sessionStorage.setItem("POGExists","N"),removeParam("P25_NEW_SESSION"),logDebug("function : remove_param_on_load ; ","E")}catch(e){error_handling(e)}}async function create_modal_open(e){try{if(logDebug("function : create_modal_open ; p_param"+e,"S"),g_json=[g_pog_json[g_pog_index]],"POG"==e)sessionStorage.setItem("POGExists","Y"),create_pog(g_pog_index);else if("MOD"==e)create_pog_module(g_camera,g_pog_index);else if("FIXEL"==e)"Y"==g_multiselect&&"Y"==g_mselect_drag?manage_multi_edit("F",g_pog_index):(g_delete_details=[],g_multiselect="N",g_mselect_drag="N",await create_shelf(g_pog_index),render(g_pog_index));else if("DIV"==e)create_divider(g_pog_index);else if("ITEM"==e){if("Y"==g_carpark_item_flag)edit_carpark_items(g_item_index,g_pog_index);else if("Y"==g_multiselect&&"Y"==g_mselect_drag||"Y"==g_ctrl_select)manage_multi_edit("P",g_pog_index),render(g_pog_index);else{g_delete_details=[],g_multiselect="N",g_mselect_drag="N",g_allowItemSort="N";await edit_items(g_item_index,g_camera,g_pog_index);render(g_pog_index)}dim_edit_done="N",g_allowItemSort="Y"}logDebug("function : create_modal_open ; p_param"+e,"E")}catch(e){error_handling(e)}}async function delete_pog_call(e){try{logDebug("function : delete_pog_call ; ","S"),"FIXEL"==e?(await deleteObject(g_pog_index,g_delete_details,"N","N",-1,"U"),$s("P25_SHELF_EDIT_IND","N")):("POG"==e?(apex.server.process("DELETE_DRAFT",{x01:g_pog_json[p_pog_index].POGCode},{dataType:"text",success:function(e){""!=$.trim(e)?raise_error(e):(init(),g_pog_json.splice(0),closeInlineDialog("add_pog"),g_dblclick_opened="N",$("#create_pog_btn").css("display","block"),$(".create_module").css("visibility","hidden"),$(".create_shelf").css("visibility","hidden"),$(".create_pegboard").css("visibility","hidden"),$(".create_text").css("visibility","hidden"),$(".create_hangingbar").css("visibility","hidden"),$(".create_basket").css("visibility","hidden"),$(".create_chest").css("visibility","hidden"),$(".create_rod").css("visibility","hidden"),$(".create_pallet").css("visibility","hidden"),$(".create_divider").css("visibility","hidden"),$(".fixel_label").css("display","none"),$(".item_label").css("display","none"),$(".open_fixel").css("display","none"),$(".clear_item").css("display","none"),$(".clear_pog_att").css("display","none"),$(".clear_pog_info").css("display","none"),$s("P25_POG_EDIT_IND","N"),$s("P25_POG_DELETE_IND","Y"),apex.event.trigger("#P25_DRAFT_LIST","apexrefresh"),logDebug("function : delete_pog_call ; ","E"))},loadingIndicatorPosition:"page"}),$s("P25_POG_CODE",""),$s("P25_POG_NAME",""),$s("P25_POG_TYPE",""),$s("P25_POG_HEIGHT",0),$s("P25_POG_SEGMENT_WIDTH",0),$s("P25_POG_WIDTH",0),$s("P25_POG_DEPTH",0),$s("P25_BACK_DEPTH",1),$s("P25_TRAFFIC_FLOW","LR"),$s("P25_POG_BASE_HEIGHT",0),$s("P25_POG_BASE_WIDTH",0),$s("P25_POG_BASE_DEPTH",0),$s("P25_POG_NOTCH_WIDTH",0),$s("P25_POG_NOTCH_START",0),$s("P25_POG_NOTCH_SPACING",0),$s("P25_POG_COLOR","#A69FA6"),$s("P25_HORZ_START",0),$s("P25_HORZ_SPACING",0),$s("P25_POG_VERT_START",0),$s("P25_POG_VERT_SPACING",0),$s("P25_ALLOW_OVERLAP","N"),$s("P25_SPECIAL_TYPE",""),$s("P25_SPECIAL_TYPE_DESC",""),$s("P25_DISPLAY_METERAGE",""),$s("P25_RPT_METERAGE",""),$s("P25_EFF_START_DATE",""),$s("P25_BRAND_GROUP_ID",""),$s("P25_REMARKS",""),$s("P25_STORE_SEGMENT",""),$s("P25_DESC_7",""),$s("P25_POG_DIVISION",""),$s("P25_FIXTURE_GENERATION","")):"MOD"==e?(await deleteObject(g_pog_index,"","N","Y",g_module_index,"U"),$s("P25_MODULE_EDIT_IND","N")):"DIV"==e?confirm(get_message("SHCT_DELETE_CONFIRM_MSG"),get_message("SHCT_YES"),get_message("SHCT_NO"),(async function(){await deleteObject(g_pog_index,g_delete_details,"N","N",-1,"U"),closeInlineDialog("add_divider"),$s("P25_ITEM_EDIT_IND","N")})):"ITEM"==e?(await deleteObject(g_pog_index,g_delete_details,"N","N",-1,"U"),g_multiselect="N",g_mselect_drag="N",g_ctrl_select="N",$s("P25_ITEM_EDIT_IND","N"),g_scene_objects[g_pog_index].scene.children[2].remove(g_targetForDragging),dim_edit_done="N"):"TEXT"==e&&confirm(get_message("SHCT_DELETE_CONFIRM_MSG"),get_message("SHCT_YES"),get_message("SHCT_NO"),(async function(){await deleteObject(g_pog_index,g_delete_details,"N","N",-1,"U"),closeInlineDialog("add_textbox"),$s("P25_SHELF_EDIT_IND","N")})),g_dblclick_opened="N",apex.message.showPageSuccess(g_delete_success_msg),render(g_pog_index)),logDebug("function : delete_pog_call ; ","E")}catch(e){error_handling(e)}}function refresh_prod_list_close(){try{logDebug("function : refresh_prod_list_close ; ","S"),"A"==$v("P25_USED_ITEM")&&""==$v("P25_ITEM")&&""==$v("P25_SUPP_NAME")&&""==$v("P25_SUPPLIER_CODE")&&""==$v("P25_MAIN_BRAND")&&""==$v("P25_ITEM_DESCRIPTION")&&""==$v("P25_DESCRIPTION_SEC")&&""==$v("P25_GROUP")&&""==$v("P25_DEPARTMENT")&&""==$v("P25_ITEM_BRAND")&&""==$v("P25_GROUP")&&""==$v("P25_CLASS")&&""==$v("P25_SUB_CLASS")?alert(get_message("SEARCH_ATLEAST_CRITERIA")):"Y"==$v("P25_PRODUCT_FILTER")?(null!==apex.region("draggable_table")&&(apex.region("draggable_table").widget().interactiveGrid("getActions").set("edit",!1),apex.region("draggable_table").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("draggable_table").refresh()),$s("P25_PRODUCT_FILTER","N")):(POG_json=JSON.stringify(g_pog_json),apex.server.process("ADD_JSON_TO_COLL",{x01:"I",p_clob_01:POG_json},{dataType:"text",success:function(e){""!=$.trim(e)?raise_error(e):(null!==apex.region("draggable_table")&&(apex.region("draggable_table").widget().interactiveGrid("getActions").set("edit",!1),apex.region("draggable_table").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("draggable_table").refresh()),closeInlineDialog("search_product"),g_dblclick_opened="N",logDebug("function : refresh_prod_list_close ; ","E"))},loadingIndicatorPosition:"page"})),logDebug("function : refresh_prod_list_close ; ","E")}catch(e){error_handling(e)}}async function open_existing(e,o,_="N"){try{logDebug("function : open_existing ; ","S"),addLoadingIndicator(),$("#canvas-list-holder").html(""),g_open_pog_flag="Y";var n=[],t=[],a=[];g_scene_objects=[],g_scene_objects_backup=[],g_canvas_objects=[],g_pogjson_backup=[],g_pogjson_data_backup=[],g_seqArr=[],g_all_pog_flag="N",g_ComBaseIndex=-1,g_ComViewIndex=-1,g_compare_pog_flag="N",g_compare_view="NONE",g_colorBackup="N",switchCanvasView($v("P25_POGCR_TILE_VIEW")),appendMultiCanvasRowCol(1,$v("P25_POGCR_TILE_VIEW")),g_pog_json=[],g_pog_json_data=[],sessionStorage.removeItem("g_combinedShelfs"),sessionStorage.removeItem("combinedShlfDets"),g_combinedShelfs=[];for(const o of e)n.push(o.POGCode),t.push(o.POGVersion),a.push(o.IsRealPOG);var s="";if("N"==g_show_live_image&&(g_show_live_image=$v("P25_POGCR_DFLT_LIVE_IMAGES"),g_imagesShown="N"),"Y"==g_compare_pog_flag&&"POG"==g_compare_view&&"N"==g_show_live_image&&(g_show_live_image=$v("P25_POGCR_DFLT_LIVE_IMAGES"),g_imagesShownComp="N"),g_combinedShelfs=[],1==n.length)if($(".save_template").css("display","block"),s+=n[0]+":",$s("P25_SELECTED_RECORDS",s),g_pog_index=0,g_multi_pog_json=[],appendMultiCanvasRowCol(1),g_canvas_objects=[],await setDefaultState("N"),$("#pog_list_btn").css("display","none"),$("#chng_view_btn").css("display","none"),$(".add_pog").css("display","block"),$(".open_par").css("display","block"),"N"==a[0])removeLoadingIndicator(regionloadWait),confirm(get_message("VIRTUAL_POG_OPEN_ALERT"),get_global_ind_values("AI_CONFIRM_OK_TEXT"),get_global_ind_values("AI_CONFIRM_CANCEL_TEXT"),(function(){$s("P25_OPEN_POG","Y"),$s("P25_OPEN_POG_CODE",n[0]),$s("P25_OPEN_POG_VERSION",t[0]),async function(){g_seqArrDtl={},g_seqArrDtl.seqId="",g_seqArrDtl.index=0,g_seqArrDtl.pogCode=n[0],g_seqArrDtl.pogVersion=t[0],g_seqArrDtl.pogType="E",g_seqArr.push(g_seqArrDtl),addLoadingIndicator(),await get_existing_pog(n[0],t[0],0,"N","N"),"Y"==$v("P25_AUTO_REFRESH_SALES_FOR_POG")&&"Y"!=g_pog_json[0].NewPOG&&(await refresh_sales_data(13,"",$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label,g_show_days_of_supply,"N","N","N",n[0],"N",n[0],"N",g_pog_index,"Y"),$s("P25_REFRESH_SALE_CALL","Y")),"Y"==$v("P25_POGCR_ITEM_DIM_AUTO_REFRESH")&&await itemDimUpdate(g_pog_index),removeLoadingIndicator(regionloadWait),render(0),animate_all_pog()}()}));else{$s("P25_OPEN_POG","Y"),$s("P25_OPEN_POG_CODE",n[0]),$s("P25_OPEN_POG_VERSION",t[0]),async function(){g_pog_index=0,g_seqArrDtl={},g_seqArrDtl.seqId="",g_seqArrDtl.index=0,g_seqArrDtl.pogCode=n[0],g_seqArrDtl.pogVersion=t[0],g_seqArrDtl.pogType="E",g_seqArr.push(g_seqArrDtl),await get_existing_pog(n[0],t[0],0,"N","N"),"Y"==$v("P25_AUTO_REFRESH_SALES_FOR_POG")&&"Y"!=g_pog_json[0].NewPOG&&(await refresh_sales_data(13,"",$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label,g_show_days_of_supply,"N","N","N",n[0],n[0],"N",g_pog_index,"Y"),$s("P25_REFRESH_SALE_CALL","Y")),"Y"==$v("P25_POGCR_ITEM_DIM_AUTO_REFRESH")&&await itemDimUpdate(g_pog_index),removeLoadingIndicator(regionloadWait),render(0),animate_all_pog()}()}else if($("#pog_list_btn").css("display","block"),$("#chng_view_btn").css("display","block"),$(".add_pog").css("display","block"),$(".open_par").css("display","block"),"M"==o)n.length>0&&apex.server.process("CHECK_MOD_COUNT",{x01:"P",x02:"",f01:n,f02:t},{dataType:"text",success:async function(e){if(""!=$.trim(e))alert(get_message("POGCR_MAX_MOD_ERR",$v("P25_POGCR_MAX_MOD_OPEN")));else{for(const e of a);sessionStorage.setItem("pog_code_list",JSON.stringify(n)),$s("P25_OPEN_POG","Y"),$s("P25_OPEN_POG_CODE",n[0]),$s("P25_OPEN_POG_VERSION",t[0]),i=0;for(const e of n)s+=n[i]+":",i++;$s("P25_SELECTED_RECORDS",s),g_pog_index=0,g_multi_pog_json=[],appendMultiCanvasRowCol(n.length,$v("P25_POGCR_TILE_VIEW")),switchCanvasView($v("P25_POGCR_TILE_VIEW"),"Y"),await setDefaultState("N"),g_canvas_objects=[];var o=0;for(const e of n){g_pog_index=o,g_seqArrDtl={},g_seqArrDtl.seqId="",g_seqArrDtl.index=o,g_seqArrDtl.pogCode=e,g_seqArrDtl.pogVersion=t[o],g_seqArrDtl.pogType="E",g_seqArr.push(g_seqArrDtl);await get_existing_pog(e,t[o],o,"Y",_);"Y"==$v("P25_AUTO_REFRESH_SALES_FOR_POG")&&"Y"!=g_pog_json[o].NewPOG&&(await refresh_sales_data(13,"",$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label,g_show_days_of_supply,"N","N","N",n[o],n[o],"N",g_pog_index,"Y"),$s("P25_REFRESH_SALE_CALL","Y")),"Y"==$v("P25_POGCR_ITEM_DIM_AUTO_REFRESH")&&await itemDimUpdate(g_pog_index),g_pog_index=o,render(o);var g=g_canvas_objects[o].getAttribute("id");$("#"+g+"-btns").append('<span id="block_title" style="float:left">'+e+"</span>"),o==n.length-1&&removeLoadingIndicator(regionloadWait),o++}if(g_pog_json=g_multi_pog_json,generateMultiPogDropdown(),reset_canvas_region(),"Y"==_){addLoadingIndicator();await get_all_images(0,g_get_orient_images,"Y",$v("P25_POGCR_IMG_MAX_WIDTH"),$v("P25_POGCR_IMG_MAX_HEIGHT"),$v("P25_IMAGE_COMPRESS_RATIO"));removeLoadingIndicator(regionloadWait)}if(g_ItemImages.length>0&&"Y"==g_show_live_image&&"Y"==_){var l=0;$(".live_image").addClass("live_image_active");for(const e of g_pog_json){try{g_renderer=g_scene_objects[l].renderer,g_scene=g_scene_objects[l].scene,g_camera=g_scene_objects[l].scene.children[0],g_world=g_scene_objects[l].scene.children[2],addLoadingIndicator();await recreate_image_items("Y",$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_NOTCH_HEAD"),l,g_show_days_of_supply,$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label);removeLoadingIndicator(regionloadWait)}catch(e){error_handling(e)}l++}g_imagesShown="Y",animate_all_pog()}o=0;for(const e of g_pog_json){await enableDisableFlags(o);o++}await save_update_json_items(g_multi_pog_json);if(g_pog_index=0,g_scene_objects.length>0&&void 0!==g_scene_objects[g_pog_index]){void 0!==g_scene_objects[g_pog_index].Indicators&&(g_show_fixel_label=g_scene_objects[g_pog_index].Indicators.FixelLabel,g_show_item_label=g_scene_objects[g_pog_index].Indicators.ItemLabel,g_show_notch_label=g_scene_objects[g_pog_index].Indicators.NotchLabel,g_show_max_merch=g_scene_objects[g_pog_index].Indicators.MaxMerch,g_show_item_color=g_scene_objects[g_pog_index].Indicators.ItemColor,g_show_item_desc=g_scene_objects[g_pog_index].Indicators.ItemDesc,g_show_live_image=g_scene_objects[g_pog_index].Indicators.LiveImage,g_show_days_of_supply=g_scene_objects[g_pog_index].Indicators.DaysOfSupply,g_overhung_shelf_active=g_scene_objects[g_pog_index].Indicators.OverhungShelf,g_itemSubLabelInd=g_scene_objects[g_pog_index].Indicators.ItemSubLabelInd,g_itemSubLabel=g_scene_objects[g_pog_index].Indicators.ItemSubLabel);g=g_canvas_objects[g_pog_index].getAttribute("id");$("[data-pog]").removeClass("multiPogList_active"),$(".canvas_highlight").removeClass("canvas_highlight"),$("#"+g+"-btns").addClass("canvas_highlight"),$("[data-indx="+g_pog_index+"]").addClass("multiPogList_active"),g_all_pog_flag="N"}}},loadingIndicatorPosition:"page"});else if(n.length>15)alert(get_message("POGCR_MAX_TAB_MESS","15"));else{for(const e of a);sessionStorage.setItem("pog_code_list",JSON.stringify(n)),i=0;var g=[];for(const e of n)s+=n[i]+":",i+=1;$s("P25_SELECTED_RECORDS",s),i=0;for(const e of n){if(0==i)g.push(e);else await open_in_new_tab(e,t[i],"","","",$v("P25_SELECTED_RECORDS"));i+=1}g.length>0&&(g_pog_index=0,g_multi_pog_json=[],appendMultiCanvasRowCol(1),$s("P25_OPEN_POG","Y"),$s("P25_OPEN_POG_CODE",g[0]),$s("P25_OPEN_POG_VERSION",t[0]),addLoadingIndicator(),await get_existing_pog(g[0],t[0],0,_),"Y"==$v("P25_AUTO_REFRESH_SALES_FOR_POG")&&"Y"!=g_pog_json[0].NewPOG&&(await refresh_sales_data(13,"",$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label,g_show_days_of_supply,"N","N","N",n[0],n[0],"N",g_pog_index,"Y"),$s("P25_REFRESH_SALE_CALL","Y")),"Y"==$v("P25_POGCR_ITEM_DIM_AUTO_REFRESH")&&await itemDimUpdate(g_pog_index),removeLoadingIndicator(regionloadWait))}logDebug("function : open_existing ; ","E")}catch(e){error_handling(e)}}async function open_draft_pog(e="N",o,_){if(null!==o)var n=JSON.parse(o),t=_;g_pog_json=[],sessionStorage.removeItem("g_combinedShelfs"),sessionStorage.removeItem("combinedShlfDets"),g_combinedShelfs=[],g_initial_camera=null,$s("P25_EXISTING_DRAFT_VER",""),$s("P25_DRAFT_VERSION",""),draftPogInd="D","N"==g_show_live_image&&(g_show_live_image=$v("P25_POGCR_DFLT_LIVE_IMAGES"),g_show_live_image=$v("P25_POGCR_DFLT_LIVE_IMAGES"),g_imagesShown="N"),"Y"==g_compare_pog_flag&&"POG"==g_compare_view&&"N"==g_show_live_image&&(g_show_live_image=$v("P25_POGCR_DFLT_LIVE_IMAGES"),g_imagesShownComp="N");var a=[];g_scene_objects=[],g_canvas_objects=[],appendMultiCanvasRowCol(1,$v("P25_POGCR_TILE_VIEW")),g_pog_json=[],g_scene_objects_backup=[],g_pogjson_backup=[],g_pogjson_data_backup=[],$("#canvas-list-holder").html("");for(const e of n)a.push(parseInt(e.SequenceID));if(1==n.length){$(".save_template").css("display","block"),$("#pog_list_btn").css("display","none"),$("#chng_view_btn").css("display","none"),$(".add_pog").css("display","block"),$(".open_par").css("display","block");var s=n[0].SequenceID,g=n[0].DescriptionDetails,l=n[0].Description;$s("P25_DRAFT_LIST",s),$s("P25_POG_DESCRIPTION",l);var r=n[0].DraftVersion;$s("P25_EXISTING_DRAFT_VER",r),sessionStorage.setItem("P25_EXISTING_DRAFT_VER",r),addLoadingIndicator(),await get_json_data([$v("P25_DRAFT_LIST")],"N",l),"Y"==$v("P25_AUTO_REFRESH_SALES_FOR_POG")&&"Y"!=g_pog_json[0].NewPOG&&(await refresh_sales_data(13,"",$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label,g_show_days_of_supply,"N","N","N",g,g,"N",g_pog_index,"Y"),$s("P25_REFRESH_SALE_CALL","Y")),"Y"==$v("P25_POGCR_ITEM_DIM_AUTO_REFRESH")&&await itemDimUpdate(g_pog_index),removeLoadingIndicator(regionloadWait),upload_file_flag="N"}else{$("#pog_list_btn").css("display","block"),$("#chng_view_btn").css("display","block"),$(".add_pog").css("display","block"),$(".open_par").css("display","block");var d=n.map((function(e){return Object.values(e)[0]})).join(":");if("M"==t)a.length>1&&apex.server.process("CHECK_MOD_COUNT",{x01:"D",x02:d},{dataType:"text",success:async function(o){if(""!=$.trim(o))alert(get_message("POGCR_MAX_MOD_ERR",$v("P25_POGCR_MAX_MOD_OPEN")));else{var _=n[0].SequenceID,t=n[0].DescriptionDetails;$s("P25_DRAFT_LIST",_),$s("P25_POG_DESCRIPTION",l);var i=n[0].DraftVersion;$s("P25_EXISTING_DRAFT_VER",i),sessionStorage.setItem("P25_EXISTING_DRAFT_VER",i),addLoadingIndicator(),await get_json_data(a,e,l),"Y"==$v("P25_AUTO_REFRESH_SALES_FOR_POG")&&"Y"!=g_pog_json[0].NewPOG&&(await refresh_sales_data(13,"",$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label,g_show_days_of_supply,"N","N","N",t,t,"N",g_pog_index,"Y"),$s("P25_REFRESH_SALE_CALL","Y")),"Y"==$v("P25_POGCR_ITEM_DIM_AUTO_REFRESH")&&await itemDimUpdate(g_pog_index),removeLoadingIndicator(regionloadWait),upload_file_flag="N"}},loadingIndicatorPosition:"page"});else if(n.length>15)alert(get_message("POGCR_MAX_TAB_MESS","15"));else{i=0;a=[];for(const e of n){if(0==i)a.push(e);else{s=e.SequenceID,g=e.DescriptionDetails,r=e.DraftVersion;$s("P25_DRAFT_LIST",s),$s("P25_POG_DESCRIPTION",l),$s("P25_EXISTING_DRAFT_VER",r);await open_in_new_tab("","",s,g,r)}i+=1}if(a.length>0){s=a[0].SequenceID,g=a[0].DescriptionDetails,r=a[0].DraftVersion;$s("P25_DRAFT_LIST",s),$s("P25_POG_DESCRIPTION",l),$s("P25_EXISTING_DRAFT_VER",r),sessionStorage.setItem("P25_EXISTING_DRAFT_VER",r),addLoadingIndicator(),await get_json_data([$v("P25_DRAFT_LIST")],e,l),"Y"==$v("P25_AUTO_REFRESH_SALES_FOR_POG")&&"Y"!=g_pog_json[0].NewPOG&&(await refresh_sales_data(13,"",$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label,g_show_days_of_supply,"N","N","N",g,g,"N",g_pog_index,"Y"),$s("P25_REFRESH_SALE_CALL","Y")),"Y"==$v("P25_POGCR_ITEM_DIM_AUTO_REFRESH")&&await itemDimUpdate(g_pog_index),removeLoadingIndicator(regionloadWait),upload_file_flag="N"}}}g_initial_camera||(g_initial_camera=g_camera.clone())}function render_scene(e){g_scene_objects[0].camera.aspect=1,g_scene_objects[0].camera.updateProjectionMatrix(),g_renderer.setScissorTest(!0),g_renderer.setScissor(0,0,600,600),g_renderer.setViewport(0,0,600,600),g_renderer.render(g_scene_objects[0].scene,g_scene_objects[0].camera),g_scene_objects[2].camera.aspect=1,g_scene_objects[2].camera.updateProjectionMatrix(),g_renderer.setScissor(500,0,600,600),g_renderer.setViewport(500,0,600,600),g_renderer.render(g_scene_objects[2].scene,g_scene_objects[2].camera),requestAnimationFrame(render)}function get_existing_data(e,o){return new Promise((function(_,n){apex.server.process("GET_EXISTING_POG",{x01:e,x02:o},{dataType:"html"}).done((function(e){var o="Y",n=$.trim(e);try{var t=JSON.parse($.trim(e))}catch{o="N"}"N"==o?(raise_error(n),_("")):""!==n&&_(t)}))}))}function init_first(){try{g_canvas_region=document.getElementById("drawing_region"),g_selection=document.getElementById("selection"),renderer=new THREE.WebGLRenderer({canvas:g_canvas,alpha:!0})}catch(e){return void(document.getElementById("canvas-holder").innerHTML="<p><b>Sorry, an error occurred:<br>"+e+"</b></p>")}g_raycaster=new THREE.Raycaster,g_renderer.setClearColor(16777215),g_multiselect="N",g_ctrl_select="N";var e=document.getElementById("t_Header"),o=document.getElementById("t_Body_title"),_=document.getElementById("top_bar"),n=document.getElementById("t_Body_nav"),t=document.getElementById("side_bar"),i=window.devicePixelRatio;g_start_pixel_ratio=i;var a=e.offsetHeight*i,s=o.offsetHeight*i,g=_.offsetHeight*i,l=n.offsetWidth*i,r=t.offsetWidth*i;document.getElementById("draggable_table");i>2.5?(g_windowHeight=window.innerHeight-(a+s+padding+g/2),windowWidth=window.innerWidth-(l+r+padding)):(g_windowHeight=window.innerHeight,windowWidth=window.innerWidth),g_selection.style.visibility="hidden",setUpMouseHander("maincanvas",doMouseDown,doMouseMove,doMouseUp,doMouseDoubleclick,renderer),g_cut_support_obj_arr=[],loc_details={},g_cut_action_done="N",g_copy_action_done="N",g_delete_action_done="N",g_multi_delete_done="N",g_dup_action_done="N",g_multi_copy_done="N",g_curr_canvas=1,$(".peg_holes").addClass("peg_hole_acive"),window.addEventListener("resize",onWindowResize,!1),"Y"!=$v("P25_DELETE_IND")&&"Y"!=$v("P25_EDIT_IND")||g_renderer.domElement.addEventListener("contextmenu",onContextMenu,!1),g_renderer.domElement.addEventListener("mousewheel",onDocumentMouseWheel,!1),window.addEventListener("click",(function(e){"button-plus"!==$(e.target).attr("class")&&"button-minus"!==$(e.target).attr("class")&&"quantity-field"!==$(e.target).attr("class")&&(document.getElementById("context-menu").classList.remove("active"),g_context_opened="N"),void 0!==$(e.path)&&("t-Header-logo-link"==$(e.path[1]).attr("class")?logo_clicked="Y":logo_clicked="N"),void 0!==$(e.target).attr("id")?$(e.target).attr("id").startsWith("CUSTOM_COLOR")||$("#co-color-list").slideUp("fast",(function(){$("#co-color-list").css("display","none"),openChooseColor=!1})):"t-Icon fa fa-eyedropper"==$(e.target).attr("class")?console.log(" else if ",$(e.target).attr("class")):$("#co-color-list").slideUp("fast",(function(){$("#co-color-list").css("display","none"),openChooseColor=!1}))})),onWindowResize("F")}function open_comp_pog(){try{logDebug("function : open_comp_pog ; ","S"),1==$v("P25_COMPARE_WITH")&&""==$v("P25_COMP_OPEN_POG_CODE")||2==$v("P25_COMPARE_WITH")&&""==$v("P25_COMP_DRAFT_LIST")?alert(g_atleast_one_pog):(null!==$v("P25_COMP_OPEN_POG_CODE")?$s("P25_OPEN_POG","Y"):$s("P25_OPEN_DRAFT","Y"),curr_canvas=2,g_compare_pog_flag="Y","Y"==g_compare_pog_flag&&"POG"==g_compare_view&&"N"==g_show_live_image&&(g_show_live_image=$v("P25_POGCR_DFLT_LIVE_IMAGES"),g_show_live_image="N"),get_compare_pog($v("P25_COMPARE_WITH"),$v("P25_COMP_OPEN_POG_CODE"),$v("P25_COMP_OPEN_POG_VERSION"),$v("P25_COMP_DRAFT_LIST")),closeInlineDialog("open_comp_pog")),logDebug("function : open_comp_pog ; ","E")}catch(e){error_handling(e)}}async function load_pog(){try{logDebug("function : load_pog ; ","S"),"E";var e=g_pog_index,o=(g_pog_json[g_pog_index].POGCode,g_pog_json[g_pog_index].Version);$s("P25_OPEN_POG_VERSION",g_pog_json[g_pog_index].Version),apex.server.process("GET_EXISTING_POG",{x01:g_pog_json[g_pog_index].POGCode,x02:g_pog_json[g_pog_index].Version},{dataType:"html"}).done((function(_){var n=$.trim(_);if(n.match(/ERROR.*/))raise_error(n),removeLoadingIndicator(regionloadWait);else if(""!==n){g_json=JSON.parse($.trim(_)),g_pog_json_data=g_json,g_module_obj_array=[],$(".live_image").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto");var t=JSON.parse(JSON.stringify(g_pog_json));t[g_pog_index]=g_json[0],async function(){init(g_pog_index),g_scene_objects[g_pog_index].scene=g_scene,g_scene_objects[g_pog_index].renderer=g_renderer,g_camera=g_scene_objects[g_pog_index].scene.children[0],g_world=g_scene_objects[g_pog_index].scene.children[2],console.log("pog json",g_pog_json_data,g_scene_objects,g_scene,g_renderer),t[g_pog_index].SalesInfo=JSON.parse(JSON.stringify(g_pog_json[g_pog_index].SalesInfo)),await create_module_from_json(t,"N","F","N","E","N","Y","Y","Y",o,"Y",g_scene_objects[g_pog_index].scene.children[0],g_scene_objects[g_pog_index].scene,g_pog_index,g_pog_index,"N","N",[]),g_pog_index=e,console.log("pog json after loop ",g_pog_json,g_pog_index,g_scene_objects[g_pog_index].scene.children[2])}(),g_pog_json_data=[],g_dblclick_opened="N",""!==$v("P25_PDF_TEMPLATE")&&(document.cookie="PDF_TEMPLATE="+$v("P25_BU_ID")+"$$$"+$v("P25_PDF_TEMPLATE")+"; max-age=31536000;")}})),logDebug("function : load_pog ; ","E")}catch(e){error_handling(e)}}async function save_edit_location(e){try{logDebug("function : save_edit_location ; ","S");var o=0,_=0,n=0,t=0,i=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType,a=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ManualZupdate;if(o=parseFloat($v("P25_X_LOCATION"))/100+g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].W/2,_=parseFloat($v("P25_Y_LOCATION"))/100+g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].H/2,""===g_item_index||"undefined"==typeof g_item_index||-1==g_item_index)if(n="TEXTBOX"!==i?parseFloat($v("P25_Z_LOCATION"))/100+g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].D/2:parseFloat($v("P25_Z_LOCATION"))/100,"N"==$v("P25_LOCATION_CNG")&&(t=parseFloat($v("P25_FIXEL_NOTCH"))),g_edit_textboxZ==n&&"Y"!==a)update_edit_location(o,_,n,g_module_index,g_shelf_index,t,"Y",g_camera,e,"N");else update_edit_location(o,_,n,g_module_index,g_shelf_index,t,"Y",g_camera,e,"Y");else{var s=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index],g=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Item,l=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].X,r=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Y,d="Y";if("DIVIDER"==g){o=$v("P25_X_LOCATION")/100+g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].W/2,_=$v("P25_Y_LOCATION")/100+g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].H/2+g_pog_json[e].BaseH;var c=s.X-s.W/2,f=s.X+s.W/2,I=s.Y+s.H/2,p=(s.Y,s.H,_+g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].H/2),h=_-g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].H/2;if(o<l&&(d=o<c?"N":"Y"),o>l&&"Y"==d&&(d=o>f?"N":"Y"),r<_&&"Y"==d){var u=[],m=[],O=[],S=g_pog_json[e].ModuleInfo;for(const e of S){var P=0;for(const o of e.ShelfInfo){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType){var E=o.X-o.W/2,v=o.X+o.W/2;s.Y<o.Y&&(v>c&&E<=c||E<f&&E>=c)&&(u.push(o.Y-o.H/2-(s.Y+s.H/2)),m.push(P))}P++}0}var D=Math.min.apply(Math,u),C=u.findIndex((function(e){return e==D}));if(0!=u.length)if("HANGINGBAR"==g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[m[C]].ObjType||"ROD"==g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[m[C]].ObjType){var T=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[m[C]].ItemInfo,b=0;for(const e of T)O.push(wpdSetFixe(e.Y-e.H/2)),m.push(b),b++;var j=Math.min.apply(Math,O);C=O.findIndex((function(e){return e==j}));d=j>p?"Y":"N"}else{d=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[m[C]].Y-g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[m[C]].H/2>p?"Y":"N"}else d="Y"}r>_&&"Y"==d&&(d=h<I?"N":"Y");var N;if(N=await getconfirm_shelfmove(e),"Y"==d&&"Y"==N){g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Combine="N",g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].X=o,g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Y=_,g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].YDistance=_-I,g_world.getObjectById(g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].ObjID).position.set(o,_);var x=await recreate_all_items(g_module_index,g_shelf_index,s.ObjType,"N",-1,-1,s.ItemInfo.length,"N","N",-1,-1,g_start_canvas,"N",e,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y");render(e)}else alert(get_message("POGCR_VALIDATE_DIVIDER"));closeInlineDialog("edit_location_modal")}else{s=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index],g=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index];var M=JSON.parse(JSON.stringify(g));l=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].X,r=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Y,d="Y";o=$v("P25_X_LOCATION")/100+g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].W/2,_=$v("P25_Y_LOCATION")/100+g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].H/2;var R=s.HorizGap,L=s.AutoPlacing;s.AutoPlacing="N",g.Edited="Y",g.Y=_,g.Exists="N",g.X=o,g.DropY=o,g.FromProductList="N";x=find_pegboard_gap(g.W,g.H,o,_,R,g_module_index,g_shelf_index,g_item_index,g_item_index,"Y",e,"Y",g_auto_x_space,g_auto_y_space);if(s.AutoPlacing=L,"N"!==x)s.ItemInfo[g_item_index].X=o,s.ItemInfo[g_item_index].Y=_,s.ItemInfo[g_item_index].YDistance=_-(s.Y+s.H/2),g_world.getObjectById(s.ItemInfo[g_item_index].ObjID).position.set(o,_),render(e),"CHEST"==s.ObjType&&"Y"==g_chest_as_pegboard&&(s.ChestEdit="Y");else g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index]=M,alert(get_message("POGC_CHEST_SPACE_VALID",s.Shelf));closeInlineDialog("edit_location_modal")}}g_dblclick_opened="N",logDebug("function : save_edit_location ; ","E")}catch(e){error_handling(e)}}async function save_fixel_detail(){try{logDebug("function : save_fixel_detail ; ","S"),apex.region("fixel_details").widget().interactiveGrid("getActions").set("edit",!1);var e=apex.region("fixel_details").widget().interactiveGrid("getViews","grid").model,o=[];e.forEach((function(_){o.push({moduleIndex:e.getValue(_,"MODULE_NAME"),shelfId:e.getValue(_,"SHELF_ID").toUpperCase()})}));var _={};o.forEach((function(e){const o=`${e.moduleIndex}-${e.shelfId}`;_[o]=(_[o]||0)+1})),o.filter((function(e){const o=`${e.moduleIndex}-${e.shelfId}`;return _[o]>1})).length>0?alert(get_message("COMPONENT_UNIQUE_ID")):(g_scene=g_scene_objects[g_pog_index].scene,g_camera=g_scene_objects[g_pog_index].scene.children[0],g_renderer=g_scene_objects[g_pog_index].renderer,g_world=g_scene_objects[g_pog_index].scene.children[2],await fixel_update(e,g_camera,g_pog_index),await set_shelf_item_index(g_pog_index),POG_json=JSON.stringify([g_pog_json[g_pog_index]]),apex.server.process("ADD_JSON_TO_COLL",{x01:"I",p_clob_01:POG_json},{dataType:"text",success:function(e){if(""!=$.trim(e))raise_error(e);else if(apex.region("fixel_details").widget().interactiveGrid("getActions").set("edit",!1),apex.region("fixel_details").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("fixel_details").refresh(),"Y"==g_show_max_merch){!async function(){await add_merch("Y",g_pog_index)}()}},loadingIndicatorPosition:"page"})),logDebug("function : save_fixel_detail ; ","E")}catch(e){error_handling(e)}}function open_image_upld_popup(){try{logDebug("function : open_image_upld_popup ; ","S");var e=$v("P25_TEXT_WIDTH"),o=$v("P25_TEXT_HEIGHT");if("Y"==g_multiselect&&(0==nvl(e)||0==nvl(o)))for(const _ of g_delete_details)if("TEXTBOX"==_.ObjType){0==nvl(e)&&(e=100*_.W),0==nvl(o)&&(o=100*_.H);break}if(""!=$v("P25_TEXT_HEIGHT")&&""!=$v("P25_TEXT_WIDTH")&&0!=$v("P25_TEXT_HEIGHT")&&0!=$v("P25_TEXT_WIDTH")||"Y"==g_multiselect)if($("#IMAGE_AREA canvas").remove(),openInlineDialog("IMG_UPLOAD",40,45),g_temp_image_arr.length>0){$("#REMOVE_IMAGE").css("display","inline");var _=new Image;_.src="data:image/png;base64,"+g_temp_image_arr[0].Image,_.onload=function(){const n=document.createElement("canvas");get_curr_canvas(),get_canvas_camera("LABEL");const[t,i]=get_visible_size(.012,parseFloat(e)/100,parseFloat(o)/100,g_canvas_objects[g_pog_index],g_scene_objects[g_pog_index].scene.children[0]);n.width=t,n.height=i;n.getContext("2d").drawImage(_,0,0,t,i),$("#P25_IMG_FILENAME").removeClass("apex_disabled"),$s("P25_IMG_FILENAME",g_temp_image_arr[0].FileName),$("#P25_IMG_FILENAME").addClass("apex_disabled"),$("#IMAGE_AREA canvas").remove(),document.getElementById("IMAGE_AREA").append(n)}}else $("#REMOVE_IMAGE").css("display","none");else alert(get_message("POGCR_TEXT_IMG_VALIDATE"));logDebug("function : open_image_upld_popup ; ","E")}catch(e){error_handling(e)}}function set_selected_val(){try{logDebug("function : set_selected_val ; ","S");var e,o,_,n=apex.region("ig_pog_list").widget().interactiveGrid("getViews").grid,t=n.getSelectedRecords();$.each(t,(function(t,i){e=n.model.getValue(i,"SEQUENCE_ID"),o=n.model.getValue(i,"DESCRIPTION"),_=n.model.getValue(i,"DRAFT_VERSION"),$s("P25_DRAFT_LIST",e),$s("P25_POG_DESCRIPTION",o),$s("P25_EXISTING_DRAFT_VER",_)})),logDebug("function : set_selected_val ; ","E")}catch(e){error_handling(e)}}async function errored_item_cancel(e){try{logDebug("function : errored_item_cancel ; ","S"),g_dblclick_opened="N",g_mselect_drag="N";var o=0;for(const n of g_pog_json[e].ModuleInfo){if(null==n.ParentModule||"undefined"==n.ParentModule){var _=0;for(const t of n.ShelfInfo)void 0!==t&&"NOTCH"!==t.ObjType&&"BASE"!==t.ObjType&&"DIVIDER"!==t.ObjType&&"TEXTBOX"!==t.ObjType&&(g_pog_json[e].ModuleInfo[o].ShelfInfo[_].AllowAutoCrush="N"),_+=1}o+=1}await create_module_from_json(g_pog_json,sessionStorage.getItem("new_pog_ind"),"F","N",sessionStorage.getItem("pog_opened"),"Y","N","Y","N","","Y",g_scene_objects[e].scene.children[0],g_scene_objects[e].scene,g_pog_index,g_pog_index,"N"),"Y"==g_show_live_image&&animate_pog(e),logDebug("function : errored_item_cancel ; ","E")}catch(e){error_handling(e)}}function page_change_set_drag_prod_list(){try{logDebug("function : page_change_set_drag_prod_list ; ","S"),$("#draggable_table .a-GV-w-scroll tbody tr").attr("draggable","true"),$("#draggable_table .a-GV-w-scroll tbody tr").addClass("DraggableThings"),$(".DraggableThings").draggable({containment:"window",opacity:.7,zIndex:1e4,appendTo:"body",cursor:"all-scroll",start:function(e,o){offsetX=e.clientX-o.offset.left+$(".t-Region-body").scrollLeft(),offsetY=e.clientY-o.offset.top+$(document).scrollTop()},drag:function(e,o){o.position.left+=e.clientX-o.offset.left-Math.floor(o.helper.outerWidth()/2),o.position.top+=offsetY-Math.floor(o.helper.outerHeight()/2)},helper:function(){"D"==g_open_productlist&&(g_open_productlist="Y"),0===(e=$(".DraggableThings .a-GV-w-scroll tr.selected").find("td:first")).length&&(e=$(this).addClass("selected"),$(this).addClass("selected"));for(var e=$("#draggable_table .a-GV-w-scroll tr.selected").find("td:first"),o=$('<div id="draggingContainer"></div>'),_=$("#draggable_table thead th").filter((function(){return"product"===$(this).text().trim().toLowerCase()})).index(),n=e.closest("tr").find("td:eq("+_+")"),t=apex.region("draggable_table").widget().interactiveGrid("getViews","grid").model,i=0;i<n.length;i++){myNewRecord=t.getRecord(n[i].innerHTML);var a=parseFloat(t.getValue(myNewRecord,"ITEM_WIDTH"))/100,s=parseFloat(t.getValue(myNewRecord,"ITEM_HEIGHT"))/100,g=parseFloat(t.getValue(myNewRecord,"ITEM_DEPTH"))/100,l=t.getValue(myNewRecord,"ORIENTATION"),[a,s,g]=get_new_orientation_dim(l,a,s,g);const[e,_]=get_visible_size(.012,a,s,g_canvas,g_camera);var r=$('<div id="draggingContainer'+i+'"></div>');r.css("border","1px solid #101010").css("width",e+"px").css("height",_+"px").css("background-color","transparent"),r.text(n[i].innerHTML),o.append(r),g_product_list_drag="Y"}return o}}),$(".DraggableThings").click((function(){var e=$(this),o=[];if(window.event.shiftKey)selectRowsBetweenIndexes([g_lastSelectedRow.index(),e.index()]);else window.event.ctrlKey?(g_lastSelectedRow=e,$(this).hasClass("selected")?$(this).removeClass("selected"):$(this).addClass("selected")):(g_lastSelectedRow=e,$("#draggable_table .a-GV-w-scroll tr.selected").removeClass("selected"),$(this).addClass("selected"));void 0!==(o=$("#draggable_table .a-GV-w-scroll tr.selected"))&&(set_item_blink(o),g_productselect="Y"),setTimeout((function(){$("#draggable_table_ig_grid_vc_status").html(apex.lang.formatMessage("APEX.GV.SELECTION_COUNT",$(".DraggableThings.selected").length))}),200)})),apex.region("draggable_table").widget().interactiveGrid("getActions").set("edit",!0),null!==apex.region("draggable_table")&&500!==apex.region("draggable_table").call("getActions").get("change-rows-per-page")&&apex.region("draggable_table").call("getActions").set("change-rows-per-page",500),logDebug("function : page_change_set_drag_prod_list ; ","E")}catch(e){error_handling(e)}}function highlight_fixel(e){try{if(logDebug("function : highlight_fixel ; ","S"),null!==e.data&&void 0!==e.data.selectedRecords&&null!==e.data.selectedRecords){var o=e.data.model;if(g_intersected){for(var _=0;_<g_intersected.length;_++)void 0!==g_intersected[_]&&g_intersected[_].WireframeObj.material.color.setHex(0);clearInterval(g_myVar),render(g_pog_index)}for(g_intersected=[],_=0;_<e.data.selectedRecords.length;_++){var n=g_scene_objects[g_pog_index].scene.children[2].getObjectById(parseInt(o.getValue(e.data.selectedRecords[_],"SHELF_OBJID")));g_intersected.push(n)}render_animate_selected()}logDebug("function : highlight_fixel ; ","E")}catch(e){error_handling(e)}}async function set_auto_facings_all(e,o,_,n,t,i,a,s){logDebug("function : set_auto_facings_all; moduleIndex : "+e+"; ShelfIndex : "+o+"; itemIndex : "+_+"; facingType : "+t+"; facingsOf : "+i+"; itemType : "+a,"S"),max_facings_allowed=$v("P25_POGCR_AUTO_MAX_VFACING");$v("P25_POGCR_DFLT_VERT_FACING");if("SHELF"==g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ObjType&&"S"==i&&("D"!=t&&"B"!=t||$.each(n,(function(_,n){if(""!==n.TopObjID&&void 0!==n.TopObjID&&""!==n.BottomObjID&&void 0!==n.BottomObjID);else{var t=1,i=n.RD/n.BaseD;t=Math.floor(100*g_pog_json[s].ModuleInfo[e].ShelfInfo[o].D/(100*i));var a=nvl(n.MPogDepthFacings)>0?n.MPogDepthFacings:n.MDepthFacings;t=a<t&&a>-1?a:t,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].D=i*(t>0?t:1),g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].BaseD=t>0?t:1,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].RD=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].D}})),"H"==t||"B"==t)){var g=g_pog_json[s].ModuleInfo[e],l=g_pog_json[s].ModuleInfo[e].ShelfInfo[o],r=get_shelf_max_merch(g,l,e,o,s,parseFloat($v("P25_POGCR_DFT_MAX_MERCH")));$.each(n,(function(_,n){if(""!==n.TopObjID&&void 0!==n.TopObjID&&""!==n.BottomObjID&&void 0!==n.BottomObjID);else{var t=n.RH/n.BVert,i=Math.floor(100*r/(100*t)),a=nvl(n.MPogVertFacings)>0?n.MPogVertFacings:n.MVertFacings,g=a<max_facings_allowed&&a>-1?a:max_facings_allowed;i>g&&(i=g),g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].H=t*(i>0?i:1),g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].BVert=i>0?i:1,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].Y=l.Y+l.H/2+g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].H/2,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].RH=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].H}}))}logDebug("function : set_auto_facings_all","E")}async function open_update_item_info(){"Y"==g_all_pog_flag&&g_pog_json.length>1&&($s("P25_OPEN_POG_CODE",""),$s("P25_OPEN_POG_VERSION","")),l_version=g_pog_json[g_pog_index].DraftVersion,$s("P25_DRAFT_VERSION",l_version),-1!==(","+$v("P25_POGCR_ITEM_INFO_COLS")+",").indexOf(",ITEM_COLOR,")&&await updateItemColorCollection(),openInlineDialog("upd_reg_mov",65,60),apex.region("item_pog_info").widget().interactiveGrid("getActions").set("edit",!1),apex.region("item_pog_info").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("item_pog_info").refresh()}async function updateItemColorCollection(){var e=[],o=0;for(pog of g_pog_json){var _=pog.ModuleInfo,n=0;for(const l of _){if(void 0===l.ParentModule||null==l.ParentModule){var t=l.ShelfInfo,i=0;for(const _ of t){if("BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType&&"TEXTBOX"!==_.ObjType&&_.ItemInfo.length>0){var a=_.ItemInfo,s=0;for(const _ of a){const t=g_pog_json[o].ModuleInfo[n].ShelfInfo[i].ItemInfo[s].Item;if("DIVIDER"!==_.Item&&!e.some((e=>e.Item===t))){var g={};g.Item=t,g.Color=g_pog_json[o].ModuleInfo[n].ShelfInfo[i].ItemInfo[s].Color,g.POGCode=g_pog_json[o].POGCode,e.push(g)}s++}}i++}}n++}o++}apex.server.process("UPDATE_ITEM_COLOR_COLL",{p_clob_01:JSON.stringify(e)},{dataType:"text",success:async function(e){console.log("pData",e)},loadingIndicatorPosition:"page"})}function itemInfoUpdate(e,o,_,t,i,a,s,g,l,r,d,c,f,I,p,h,u,m,O,S,P="N"){logDebug("function : itemInfoUpdate; pModel : "+e+"; pShowDaysOfSupply : "+o+"; pItemInfoCols : "+_+"; item_seq : "+t+"; item_regmov : "+i+"; item_days_of_supply : "+a+"; item_wk_count : "+s+"; item_cogs_adj : "+g+"; item_gp : "+l+"; item_avg_sales : "+r+"; pItemImported : "+d+"; p_pog_index : "+f,"S");try{var E,v=_.indexOf(",REG_MOV,"),D=_.indexOf(",WK_COUNT,"),C=_.indexOf(",COGS_ADJ,"),T=_.indexOf(",GROSS_PROFIT,"),b=_.indexOf(",AVG_SALES,"),j=_.indexOf(",ITEM_COLOR,"),N=_.indexOf(",BACK_SUPPORT,"),x=_.indexOf(",ITEM_CONDITION,"),M=_.indexOf(",DIVIDER,"),R=_.indexOf(",PUSHER,"),L=[],A=!1;let t=[];if(-1!==v||-1!==D||-1!==C||-1!==T||-1!==b||-1!==j||-1!==N||-1!==x||-1!==M||-1!==R)return new Promise((async function(_,y){if(g_pog_edited_ind="Y",e.forEach((async function(o){var _=$v("P25_OPEN_POG_CODE"),y=e.getValue(o,"POG_VERSION"),$=e.getValue(o,"ITEM"),w=parseFloat(e.getValue(o,"REG_MOV")),Y=parseFloat(e.getValue(o,"WEEKS_COUNT")),G=parseFloat(e.getValue(o,"COGS_ADJ")),H=parseFloat(e.getValue(o,"GROSS_PROFIT")),F=parseFloat(e.getValue(o,"AVG_SALES")),B=e.getValue(o,"CHNG_REGMOV"),V=e.getValue(o,"CHNG_WEEKS_COUNT"),k=e.getValue(o,"CHNG_COGS_ADJ"),W=e.getValue(o,"CHNG_GROSS_PROFIT"),U=e.getValue(o,"CHNG_AVG_SALES"),X=e.getValue(o,"ITEM_COLOR"),z=e.getValue(o,"CHNG_ITEMCOLOR"),J=void 0===e.getValue(o,"BACK_SUPPORT")?null:e.getValue(o,"BACK_SUPPORT"),K=void 0===e.getValue(o,"ITEM_CONDITION")?null:e.getValue(o,"ITEM_CONDITION");if(-1!==M)var q=e.getValue(o,"DIVIDER").v;else q=null;var Z=void 0===e.getValue(o,"PUSHER")?null:e.getValue(o,"PUSHER"),Q=void 0===e.getValue(o,"DELISTED")?null:e.getValue(o,"DELISTED");if(w=isNaN(w)?0:nvl(w),Y=isNaN(Y)?0:nvl(Y),G=isNaN(G)?0:nvl(G),H=isNaN(H)?0:nvl(H),F=isNaN(F)?0:nvl(F),X=0==nvl(X)?$v("P25_POG_ITEM_DEFAULT_COLOR"):X,"Yes"==Q&&"N"==P&&t.push({ItemID:$,Item:$,Desc:e.getValue(o,"DESCRIPTION"),RegMovement:w,Color:X,BackSupport:J||"",Divider:q||"",ItemCondition:e.getValue(o,"ITEM_CONDITION")||"",Pusher:Z||""}),"Y"==d&&(B="Y",V="Y",k="Y",W="Y",U="Y",z="Y"),"Y"==g_all_pog_flag)var ee=0;else ee=f;for(const e of g_pog_json){if(ee!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex){g_renderer=g_scene_objects[ee].renderer,g_scene=g_scene_objects[ee].scene,g_camera=g_scene_objects[ee].scene.children[0],g_world=g_scene_objects[ee].scene.children[2];var oe=0;for(const e of g_pog_json[ee].ModuleInfo){if(null==e.ParentModule){var _e=0;for(const o of e.ShelfInfo){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType){var ne=0;for(const e of o.ItemInfo){if(e.ItemID==$&&"Yes"!=Q&&("Y"==B||"Y"==V||"Y"==k||"Y"==W||"Y"==U||"Y"==z||-1!==N||-1!==x||-1!==M||-1!==R)){if(E=g_scene_objects[ee].scene.children[2].getObjectById(e.ObjID),L.length>0&&L.includes($)?A=!0:(L.push($),A=!1),A||(c.push($),I.push(_),p.push(y)),-1!==D&&(g_pog_json[ee].ModuleInfo[oe].ShelfInfo[_e].ItemInfo[ne].WeeksCount=Y,"Y"==V&&(g_pog_json[ee].ModuleInfo[oe].ShelfInfo[_e].ItemInfo[ne].WeeksCountInd="Y",void 0!==E&&(E.WeeksCount=Y)),A||s.push(Y)),-1!==C&&(g_pog_json[ee].ModuleInfo[oe].ShelfInfo[_e].ItemInfo[ne].CogsAdj=G,"Y"==k&&(g_pog_json[ee].ModuleInfo[oe].ShelfInfo[_e].ItemInfo[ne].CogsAdjInd="Y",void 0!==E&&(E.CogsAdj=G)),A||g.push(G)),-1!==T&&(g_pog_json[ee].ModuleInfo[oe].ShelfInfo[_e].ItemInfo[ne].GrossProfit=H,"Y"==W&&(g_pog_json[ee].ModuleInfo[oe].ShelfInfo[_e].ItemInfo[ne].GrossProfitInd="Y",void 0!==E&&(E.GrossProfit=H)),A||l.push(H)),-1!==b&&(g_pog_json[ee].ModuleInfo[oe].ShelfInfo[_e].ItemInfo[ne].AvgSales=F,"Y"==U&&(g_pog_json[ee].ModuleInfo[oe].ShelfInfo[_e].ItemInfo[ne].AvgSalesInd="Y",void 0!==E&&(E.AvgSales=F)),A||r.push(F)),-1!==j){var te=0==nvl(X)?g_pog_json[ee].ModuleInfo[oe].ShelfInfo[_e].ItemInfo[ne].Color:X;if(g_pog_json[ee].ModuleInfo[oe].ShelfInfo[_e].ItemInfo[ne].Color=te,g_pog_json[ee].ModuleInfo[oe].ShelfInfo[_e].ItemInfo[ne].ShowColorBackup=te,"Y"==z&&("Y"!==g_show_live_image||0==nvl(E.material.map))&&void 0!==E){var ie=parseInt(te.replace("#","0x"),16);E.material.color.setHex(ie);var ae=E.children;for(n=0;n<ae.length;n++)"horiz_facing"==ae[n].uuid&&ae[n].material.color.setHex(ie)}A||h.push(te)}if(-1!==N&&(g_pog_json[ee].ModuleInfo[oe].ShelfInfo[_e].ItemInfo[ne].BackSupport=J,void 0!==E&&(E.BackSupport=J),A||u.push(J)),-1!==x&&(g_pog_json[ee].ModuleInfo[oe].ShelfInfo[_e].ItemInfo[ne].ItemCondition=K,void 0!==E&&(E.ItemCondition=K),A||m.push(K)),-1!==M&&(g_pog_json[ee].ModuleInfo[oe].ShelfInfo[_e].ItemInfo[ne].Divider=q,void 0!==E&&(E.Divider=q),A||O.push(q)),-1!==R&&(g_pog_json[ee].ModuleInfo[oe].ShelfInfo[_e].ItemInfo[ne].Pusher=Z,void 0!==E&&(E.Pusher=Z),A||S.push(Z)),-1!==v&&(g_pog_json[ee].ModuleInfo[oe].ShelfInfo[_e].ItemInfo[ne].RegMovement=w,"Y"==B&&(g_pog_json[ee].ModuleInfo[oe].ShelfInfo[_e].ItemInfo[ne].RegMovementInd="Y",g_pog_json[ee].ModuleInfo[oe].ShelfInfo[_e].ItemInfo[ne].DaysOfSupplyInd="Y",void 0!==E&&(E.RegMovement=w)),!A)){i.push(w);await updateDaysOfSupply(e,ne,_e,oe,"N","N",ee,"Y");a.push(g_pog_json[ee].ModuleInfo[oe].ShelfInfo[_e].ItemInfo[ne].DaysOfSupply)}A=!1}ne++}}_e++}}oe++}render(ee)}if("Y"!=g_all_pog_flag)break;ee++}})),"Y"==g_all_pog_flag)var $=0;else $=f;for(const e of g_pog_json){if(($!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex)&&"Y"==g_show_days_of_supply&&"Y"==o&&(await showHideDaysOfSupplyLabel(g_show_days_of_supply,"N",$,"Y","Y",$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label),"POG"==g_compare_view&&"Y"==g_compare_pog_flag&&await showHideDaysOfSupplyLabel(g_show_days_of_supply,"N",g_ComViewIndex,"Y","Y",$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label)),"Y"!=g_all_pog_flag)break;$++}if(t.length>0&&"N"==P){let e=g_pog_json[f];e.MassDelistedItem=[],t.forEach((function(o){e.MassDelistedItem.push(o)})),apex.server.process("SAVE_MASS_DELISTED_ITEMS",{x01:JSON.stringify(e.MassDelistedItem)},{dataType:"text"})}_("SUCCESS"),logDebug("function : itemInfoUpdate","E")}))}catch(e){error_handling(e)}}async function saveItemInfo(e,o="Y",_="N"){try{logDebug("function : saveItemInfo ; ","S");var n=","+$v("P25_POGCR_ITEM_INFO_COLS")+",";apex.region("item_pog_info").widget().interactiveGrid("getActions").set("edit",!1);var t=apex.region("item_pog_info").widget().interactiveGrid("getViews","grid").model,i=[],a=[],s=[],g=[],l=[],r=[],d=[],c=[],f=[],I=[],p=[],h=[];item_back_support=[],item_condition=[],item_divider=[],item_pusher=[],"Y"!==g_all_pog_flag?t.forEach((function(e){i.push(t.getValue(e,"ITEM").toUpperCase())})):t.forEach((function(e){i.push(t.getValue(e,"ITEM").toUpperCase()+":"+t.getValue(e,"POG_CODE").toUpperCase()+":"+t.getValue(e,"POG_VERSION").toUpperCase())}));var u=i.map((e=>({count:1,name:e}))).reduce(((e,o)=>(e[o.name]=(e[o.name]||0)+o.count,e)),{});if(Object.keys(u).filter((e=>u[e]>1)).length>0)alert(get_message("COMPONENT_UNIQUE_ID"));else{await itemInfoUpdate(t,o,n,a,s,g,l,r,d,c,_,f,e,I,p,h,item_back_support,item_condition,item_divider,item_pusher,_);"N"==_&&apex.server.process("UPDATE_POG_ITEM_INFO",{x01:g_pog_json[e],f01:a,f02:s,f03:g,f04:l,f05:r,f06:d,f07:c,f08:f,f09:I,f10:p,f13:h,f14:item_back_support,f15:item_condition,f16:item_divider,f17:item_pusher},{dataType:"text",success:function(e){""!=$.trim(e)?raise_error(e):(apex.region("item_pog_info").widget().interactiveGrid("getActions").set("edit",!1),apex.region("item_pog_info").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("item_pog_info").refresh(),apex.region("draggable_table").refresh(),closeInlineDialog("upd_reg_mov"))},loadingIndicatorPosition:"page"})}logDebug("function : saveItemInfo ; ","E")}catch(e){error_handling(e)}}async function updatePOGItemInfoColl(e,o,_){return new Promise((function(n,t){try{logDebug("function : updatePOGItemInfoColl ; pItem : "+e+"; pDaysOfSupply : "+o,"S"),e.length>0&&apex.server.process("UPDATE_POG_ITEM_COLL",{f01:e,f02:o,x01:g_pog_json[_].POGCode},{dataType:"text",success:function(e){""!=$.trim(e)?raise_error(e):n("SUCCESS")},loadingIndicatorPosition:"page"}),logDebug("function : updatePOGItemInfoColl ; ","E")}catch(e){logDebug("function : updatePOGItemInfoColl ; ","E"),error_handling(e)}}))}async function auto_position_pegboard(){await auto_position_pegboard_init(g_pog_index)}async function auto_position_pegboard_init(e){if("Y"==g_all_pog_flag)var o=0;else o=e;for(const e of g_pog_json){var _=0;for(const e of g_pog_json[o].ModuleInfo){if(null==e.ParentModule){var n=0;for(const m of e.ShelfInfo){0;var t=m.Y+m.H/2,i=m.Y-m.H/2,a=(m.X,m.W,m.X+m.W/2);if("PEGBOARD"==m.ObjType){var s=0,g="Y";for(const e of m.ItemInfo)if(e.Y+e.H/2>t||e.Y+e.H/2<i||e.X-e.W/2>a){g="Y";break}if("Y"==g){s=0,JSON.parse(JSON.stringify(m.ItemInfo));var l=g_pog_json[o].ModuleInfo[_].ShelfInfo[n].ItemInfo;g_pog_json[o].ModuleInfo[_].ShelfInfo[n].AutoPlacing="N";for(const e of l)e.LocID=""!==e.LocID?parseInt(e.LocID):"";var r={LocID:"asc"};if(l.keySort(r),l.length>1){s=0;for(const e of l){var d=get_closest_peg(e.H,_,n,t-e.H/2,o)-e.H/2;e.FromProductList="Y",e.Y=d,e.Exists="N",e.Edited="N",s++}var c=0;s=0;l=g_pog_json[o].ModuleInfo[_].ShelfInfo[n].ItemInfo;for(const e of l)0==s&&(c=e.Y+e.H/2),c<e.Y+e.H/2&&(c=e.Y+e.H/2),s++;s=0;r={LocID:"asc"};(l=g_pog_json[o].ModuleInfo[_].ShelfInfo[n].ItemInfo).keySort(r);for(const e of l)e.Y=c-e.H/2;var f=0;l=m.ItemInfo,s=0;for(const e of l)f+=e.W,s++;var I=m.X-m.W/2-f/2;s=0;for(const e of l)e.X=I+e.W/2+m.HorizSpacing,I+=e.W+m.HorizSpacing,s++;if(reorder_items(_,n,o)){s=0;var p=m.HorizGap,h=p,u=m.SpreadItem;r={LocID:"asc"};(l=g_pog_json[o].ModuleInfo[_].ShelfInfo[n].ItemInfo).keySort(r);for(const e of l)new_x=get_item_xaxis(e.W,e.H,e.D,e.CType,-1,h,u,p,_,n,s,"Y",l.length,"N",o),g_pog_json[o].ModuleInfo[_].ShelfInfo[n].ItemInfo[s].X=new_x,s++}for(const e of m.ItemInfo)g_world.remove(g_world.getObjectById(e.ObjID)),e.LocID=""!==e.LocID?parseInt(e.LocID):"";if(reorder_items(_,n,o)){await recreate_all_items(_,n,m.ObjType,"N",-1,-1,l.length,"Y","N",-1,-1,1,"",o,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y");for(const e of g_pog_json[o].ModuleInfo[_].ShelfInfo[n].ItemInfo)e.FromProductList="N",e.Exists="E",e.Edited="N",s++}}}}n++}}_++}if(render(o),"Y"!=g_all_pog_flag)break;o++}"Y"==g_show_live_image&&animate_all_pog()}async function auto_fill_setup(e){console.log("pog json length",g_pog_json[e],g_pog_json.length),"N"==g_all_pog_flag||"Y"==g_all_pog_flag&&1==g_pog_json.length?($(".autofill_btn").addClass("item_label_active"),$s("P25_OPEN_POG_CODE",`${g_pog_json[e].POGCode}`),$s("P25_OPEN_POG_VERSION",`${g_pog_json[e].Version}`),"N"==g_auto_fill_active&&void 0!==typeof g_pog_json[e]&&g_pog_json.length>0?(""!=$v("P25_OPEN_POG_CODE")?($("#SAVE_AF_BTN").hide(),$("#APPLY_AF_BTN").show()):($("#SAVE_AF_BTN").show(),$("#APPLY_AF_BTN").hide()),apex.server.process("GET_AUTOFILL",{x01:$v("P25_POG_TEMPLATE"),x02:$v("P25_OPEN_POG_CODE"),x03:"Y"==$v("P25_OPEN_DRAFT")?"":$v("P25_OPEN_POG_VERSION")},{dataType:"json",success:function(o){if("ERROR"==$.trim(o).split(",")[0])raise_error(o);else{var _=!1;for(const o of g_pog_json[e].ModuleInfo){if(_)break;if(void 0===o.ParentModule||null==o.ParentModule){o.Y,o.H,o.Y,o.H;for(const e of o.ShelfInfo){if(_)break;if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType)for(const o of e.ItemInfo)if("DIVIDER"!==o.Item){_=!0;break}0}o.Carpark.length>0&&o.Carpark[0].ItemInfo.length>0&&(_=!0)}i++}if(_)confirm(get_message("POGCR_AUTOFILL_ITEM_DEL"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){!async function(){g_auto_fill_active="Y",$s("P25_BLOCK_SELECTION","P"),g_undo_final_obj_arr=[],g_redo_final_obj_arr=[],g_prev_undo_action="";var _=0;for(const o of g_pog_json[e].ModuleInfo){if((void 0===o.ParentModule||null==o.ParentModule)&&o.Carpark.length>0){for(const _ of o.Carpark[0].ItemInfo){g_deletedItems.push(_.ItemID);var n=g_scene_objects[e].scene.children[2].getObjectById(_.ObjID);g_scene_objects[e].scene.children[2].remove(n)}n=g_scene_objects[e].scene.children[2].getObjectById(o.Carpark[0].SObjID);g_scene_objects[e].scene.children[2].remove(n),g_pog_json[e].ModuleInfo[_].Carpark=[]}_++}if(reset_zoom(),await clear_item("N","N",g_pog_index),g_ItemImages=[],g_undo_final_obj_arr=[],g_redo_final_obj_arr=[],g_auto_fill_reg_open="Y",void 0!==o.AFVersion||void 0!==g_autofill_detail.AFVersion)if(void 0===g_autofill_detail.AFVersion&&(g_autofill_detail.AFPOGCode=o.AFPOGCode,g_autofill_detail.AFPOGVersion=o.AFPOGVersion,g_autofill_detail.AFVersion=o.AFVersion,g_autofill_detail.BlkSelType=o.AFType,g_autofill_detail.AutofillRule=o.AFRule,g_autofill_detail.BlkInfo=JSON.parse(o.AFJSON).BlkInfo),$s("P25_BLOCK_SELECTION",g_autofill_detail.BlkSelType),$s("P25_AF_VERSION",g_autofill_detail.AFVersion),$s("P25_POG_RULE",g_autofill_detail.AutofillRule),"M"==$v("P25_BLOCK_SELECTION")){g_mod_block_list=g_autofill_detail.BlkInfo,async function(){for(const o of g_mod_block_list){g_autofillModInfo=o.BlkModInfo,g_autofillShelfInfo=o.BlkShelfInfo;var e=await colorAutofillBlock(o.DragMouseStart,o.DragMouseEnd,o.mod_index,o.BlkColor,o.BlkName,"U",o,g_pog_index);o.BlockDim=e}g_autofill_detail.BlkInfo=g_mod_block_list,await save_blk_dtl_coll("Y","",g_mod_block_list),g_mod_block_list=g_autofill_detail.BlkInfo,apex.event.trigger("#P25_POG_RULE","apexrefresh"),apex.theme.openRegion("auto_fill_reg")}()}else apex.event.trigger("#P25_POG_RULE","apexrefresh"),apex.theme.openRegion("auto_fill_reg");else apex.event.trigger("#P25_POG_RULE","apexrefresh"),apex.theme.openRegion("auto_fill_reg")}()}));else if(g_auto_fill_active="Y",$s("P25_BLOCK_SELECTION","P"),g_ItemImages=[],g_undo_final_obj_arr=[],g_redo_final_obj_arr=[],g_auto_fill_reg_open="Y",void 0!==o.AFVersion||void 0!==g_autofill_detail.AFVersion)if(void 0===g_autofill_detail.AFVersion&&(g_autofill_detail.AFPOGCode=o.AFPOGCode,g_autofill_detail.AFPOGVersion=o.AFPOGVersion,g_autofill_detail.AFVersion=o.AFVersion,g_autofill_detail.BlkSelType=o.AFType,g_autofill_detail.AutofillRule=o.AFRule,g_autofill_detail.BlkInfo=JSON.parse(o.AFJSON).BlkInfo),$s("P25_BLOCK_SELECTION",g_autofill_detail.BlkSelType),$s("P25_AF_VERSION",g_autofill_detail.AFVersion),$s("P25_POG_RULE",g_autofill_detail.AutofillRule),"M"==$v("P25_BLOCK_SELECTION")){g_mod_block_list=g_autofill_detail.BlkInfo,async function(){for(const o of g_mod_block_list){g_autofillModInfo=o.BlkModInfo,g_autofillShelfInfo=o.BlkShelfInfo;var e=await colorAutofillBlock(o.DragMouseStart,o.DragMouseEnd,o.mod_index,o.BlkColor,o.BlkName,"U",o,g_pog_index);o.BlockDim=e}g_autofill_detail.BlkInfo=g_mod_block_list,await save_blk_dtl_coll("Y","",g_mod_block_list),g_mod_block_list=g_autofill_detail.BlkInfo,apex.event.trigger("#P25_POG_RULE","apexrefresh"),apex.theme.openRegion("auto_fill_reg")}()}else apex.event.trigger("#P25_POG_RULE","apexrefresh"),apex.theme.openRegion("auto_fill_reg");else apex.event.trigger("#P25_POG_RULE","apexrefresh"),apex.theme.openRegion("auto_fill_reg")}}})):(clear_auto_fill_coll(),g_auto_fill_active="N",g_auto_fill_reg_open="N",apex.theme.closeRegion("auto_fill_reg"))):alert(get_message("POGCR_AUTOFILL_VALID"))}var ItemInputElem=document.getElementById("P25_AUTOFILL_PROD_UPLD"),fileIndex=0;function upload_items_file(e){document.getElementById("P25_ITEM_INFO_UPLD");var o,_=ItemInputElem.files[e],n=new FileReader;n.onload=(o=_,function(e){if(o)if((_.name+".").includes("xlsx.")){var n=binaryArray2base64(e.target.result),t=[];t=clob2Array(n,3e4,t),apex.server.process("UPLOAD_ITEMS",{x01:_.name,x02:_.type,f01:t},{dataType:"html",success:function(e){if(""!==e){var o=e.split("-");"ERRORED"==o[0]&&alert(get_message("POGCR_INVALID_ITEMS")+" - "+o[1]),console.log("pData",e),apex.region("autofill_products").refresh(),console.log(" End timing",getDateTime()),$("#P25_AUTOFILL_PROD_UPLD").val("")}}})}else alert(get_message("POGCR_INVALID_FILE"))}),n.readAsArrayBuffer(_)}function clear_blinking(){if(g_intersected){for(var e=0;e<g_intersected.length;e++)g_select_color=g_intersected[e].BorderColour,g_intersected[e].WireframeObj.material.color.setHex(g_intersected[e].BorderColour),"Y"==g_intersected[e].ImageExists&&"Y"==g_show_live_image&&(g_intersected[e].WireframeObj.material.transparent=!0,g_intersected[e].WireframeObj.material.opacity=.0025);clearInterval(g_myVar),g_select_color=0,render(g_pog_index),g_intersected=[],g_select_zoom_arr=[]}}async function update_module_block_list(e,o,_="N"){var n={},t=[],i=[],a=[],s=[],g={},l=$v("P25_BLK_NAME")+"_AFP";if("Y"==_){var r=[];for(const e of g_mod_block_list){(S={}).BlkColor=e.BlkColor,S.BlkName=e.BlkName,S.BlkRule=e.BlkRule,S.BlkFilters=e.BlockFilters.join(" AND "),S.OldBlkName=e.BlkName,e.BlkFilters=S.BlkFilters,r.push(S)}closeInlineDialog("block_details");await save_blk_dtl_coll(e,o,r)}else{s=o==l&&"U"==e?[]:[l],n.BlkName=l,n.BlkColor=$v("P25_BLK_COLOR"),n.BlkRule=$v("P25_BLK_RULE");var d=[],c=[],f=[];if("U"!==e){n.DragMouseStart=g_DragMouseStart,n.DragMouseEnd=g_DragMouseEnd;var I=-1;for(const e of g_delete_details)"TEXTBOX"!==e.ObjType&&(d.push(e),I!==e.MIndex&&c.push(e.MIndex),e.BlkName=n.BlkName,I=e.MIndex);if(c.sort(),g_mod_block_list.length>0)for(const e of d){valid=!0;for(const o of g_mod_block_list){if(!valid)break;for(const _ of o.g_delete_details)if(e.MIndex==_.MIndex&&e.SIndex==_.SIndex){valid=!1;break}}valid&&f.push(e)}else f=d;console.log("final_shelf_arr",f)}else{for(const e of g_mod_block_list)if(e.BlkName==o){f=e.g_delete_details,c=e.mod_index,n.DragMouseStart=e.DragMouseStart,n.DragMouseEnd=e.DragMouseEnd;break}for(const e of f)e.BlkName=n.BlkName;g_DragMouseStart=n.DragMouseStart,g_DragMouseEnd=n.DragMouseEnd}n.g_delete_details=f;var p=apex.region("block_filters").widget().interactiveGrid("getViews","grid").model;p.forEach((function(e){var o="object"==typeof p.getValue(e,"FILTER")?p.getValue(e,"FILTER").v:p.getValue(e,"FILTER"),_=p.getValue(e,"VALUE");if(a.push(o+"#"+_),""!==o){var n=o.split("-");i.push(n[0]),t.push(n[0]+" = "+("C"==n[1]?'"':"")+_+("C"==n[1]?'"':""))}console.log("filters",o,n,t,_)})),console.log("filters_arr",t,i);for(const e of g_mod_block_list)s.push(e.BlkName);var h=findDuplicates(s),u=findDuplicates(i);if(h.length>0)alert(get_message("POGCR_BLK_DUP"));else if(u.length>0)alert(get_message("POGCR_DUP_REC_FOUND"));else if(!i.includes("SUBCLASS")||i.includes("CLASS")&&i.includes("DEPT"))if(i.includes("CLASS")&&!i.includes("DEPT"))alert(get_message("POGCR_DEPT_MANDATE"));else{if(n.BlockFilters=t,n.FilterVal=a,n.mod_index=c,"U"==e){for(const e of g_mod_block_list)if(console.log("obj.BlkName",e.BlkName,o,e.BlkColor.toUpperCase(),$v("P25_BLK_COLOR").toUpperCase),e.BlkName==o)for(const _ of e.BlockDim.ColorObj.children)if(console.log("child.uuid ",_.uuid,o),_.uuid==o){e.BlockDim.ColorObj.remove(_),console.log("inside");break}var m=0;for(const e of g_mod_block_list)e.BlkName==o&&(console.log("inside",e.BlkName,o),g=JSON.parse(JSON.stringify(e)),g_mod_block_list.splice(m,1)),m++}apex.region("block_filters").widget().interactiveGrid("getActions").set("edit",!1),apex.region("block_filters").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("block_filters").refresh(),clear_blinking();var O=await add_module_autofill_color(g_DragMouseStart,g_DragMouseEnd,c,$v("P25_BLK_COLOR"),l,e,g,g_pog_index);if(console.log("ret_dtl",O),n.BlockDim=O,g_mod_block_list.push(n),closeInlineDialog("block_details"),"U"==e){var S={};r=[];for(const e of g_mod_block_list){if(e.BlkName!==l&&e.BlkName!==o)(S={}).BlkColor=e.BlkColor,S.BlkName=e.BlkName,S.BlkRule=e.BlkRule,S.BlkFilters=e.BlockFilters.join(" AND "),S.OldBlkName=e.BlkName,e.BlkFilters=S.BlkFilters,r.push(S);else if(e.BlkName==o||e.BlkName==l){(S={}).BlkColor=$v("P25_BLK_COLOR"),S.BlkName=l,S.BlkRule=$v("P25_BLK_RULE"),S.BlkFilters=t.join(" AND "),S.OldBlkName=o,e.BlkFilters=S.BlkFilters,r.push(S)}}await save_blk_dtl_coll(e,o,r)}else if("Y"==e){r=[];for(const e of g_mod_block_list){(S={}).BlkColor=e.BlkColor,S.BlkName=e.BlkName,S.BlkRule=e.BlkRule,S.BlkFilters=e.BlockFilters.join(" AND "),e.BlkFilters=S.BlkFilters,r.push(S)}await save_blk_dtl_coll(e,o,r)}}else alert(get_message("POGCR_DEPT_CLASS_MANDATE"))}}function get_below_shelf(e,o,_,n){var t=-1,i=0,a=[],s=[];i=0;for(const o of e)"BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType&&_<=o.Y+o.H/2&&(a.push(o.Y+o.H/2-_),s.push(i)),i++;if(a.length>0){var g=Math.min.apply(Math,a),l=a.findIndex((function(e){return e==g}));t=g_pog_json[n].ModuleInfo[o].ShelfInfo[s[l]].Y-g_pog_json[n].ModuleInfo[o].ShelfInfo[s[l]].H/2}else t=_;return t}function get_above_shelf(e,o,_,n,t){var i=-1,a=0,s=[],g=[];a=0;for(const o of e)"BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType&&_<=o.Y-o.H/2&&(s.push(o.Y-o.H/2-_),g.push(a)),a++;if(s.length>0){var l=Math.min.apply(Math,s),r=s.findIndex((function(e){return e==l}));i=g_pog_json[t].ModuleInfo[o].ShelfInfo[g[r]].Y-g_pog_json[t].ModuleInfo[o].ShelfInfo[g[r]].H/2}else i=n;return i}async function add_module_autofill_color(e,o,_,n,t,i,a,s,g){console.log("add fill",e,o,_,n,t,i,a);var l=parseInt($v("P25_POGCR_BLK_TXT_SIZE")),r=(Math.min(e.x,o.x),Math.max(e.x,o.x),Math.min(e.y,o.y)),d=Math.max(e.y,o.y),c=(g_pog_json[s].ModuleInfo[_[0]].X,g_pog_json[s].ModuleInfo[_[0]].W,g_pog_json[s].ModuleInfo[_[0]].X,g_pog_json[s].ModuleInfo[_[0]].W,g_pog_json[s].ModuleInfo[_[0]].Y+g_pog_json[s].ModuleInfo[_[0]].H/2),f=g_pog_json[s].ModuleInfo[_[0]].Y-g_pog_json[s].ModuleInfo[_[0]].H/2,I=g_pog_json[s].ModuleInfo[_[0]].ShelfInfo,p=-1,h=-1;if(d=d>c?c:d,r=r<f?f:r,"U"!==i){if(g_mod_block_list.length>0){var u=!1,m=!1;for(const e of g_mod_block_list)if(_[0]==e.mod_index[0]&&e.BlockDim.FinalTop>r&&r>e.BlockDim.FinalBtm){p=e.BlockDim.FinalTop,u=!0;break}for(const e of g_mod_block_list)if(console.log("top ",d,e.BlockDim.FinalBtm,r,e.BlockDim.FinalTop),_[0]==e.mod_index[0]&&(d>e.BlockDim.FinalBtm&&d<=e.BlockDim.FinalTop||d>e.BlockDim.FinalBtm&&e.BlockDim.FinalBtm>=r&&e.BlockDim.FinalTop<=d)){h=e.BlockDim.FinalBtm,m=!0,console.log("exists");break}u&&"Y"!=g||(p=get_below_shelf(I,_[0],r,s)),m&&"Y"!=g||(h=get_above_shelf(I,_[0],d,c,s))}else p=get_below_shelf(I,_[0],r,s),h=get_above_shelf(I,_[0],d,c,s);var O=h-p,S=g_pog_json[s].ModuleInfo[_[0]].W;g_pog_json[s].ModuleInfo[_[0]].X;if(g_pog_json[s].ModuleInfo[_[0]].Y<p){var P=p-g_pog_json[s].ModuleInfo[_[0]].Y;calc_y=P+O/2}else{P=g_pog_json[s].ModuleInfo[_[0]].Y-p;calc_y=0-P+O/2}}else calc_y=a.BlockDim.CalcY,S=a.BlockDim.BlkWidth,O=a.BlockDim.BlkHeight,h=a.BlockDim.FinalTop,p=a.BlockDim.FinalBtm;var E=parseInt(n.replace("#","0x"),16);new THREE.Color(E);t=t.slice(0,-4),console.log("val",e,o,_[0],n,t),console.log("calc_height",S,O,calc_y,h,c,p,f);var v=dcText(t,l,0,E,S,O,"N","N","Arial","",l,0,-1,4),D=g_world.getObjectById(g_pog_json[s].ModuleInfo[_[0]].MObjID);D.add(v),v.uuid=t+"_AFP",v.material.opacity=.5,v.position.x=0,v.position.y=calc_y,v.position.z=.009,render(s),g_delete_details=[],g_mselect_drag="N";var C={CalcX:0};if(C.CalcY=calc_y,C.CalcZ=.009,C.BlkWidth=S,C.BlkHeight=O,C.ColorObj=D,C.FinalTop=h,C.FinalBtm=p,"Y"==g){for(shelfs of(g_DragMouseStart.x=e.x,g_DragMouseStart.y=e.y,g_DragMouseEnd.x=o.x,g_DragMouseEnd.y=o.y,await get_multiselect_obj(s),a.g_delete_details=[],g_delete_details))a.g_delete_details.push(shelfs);g_delete_details=[]}return C}function delete_blk_details(e){confirm(get_message("SHCT_DELETE_CONFIRM_MSG"),get_global_ind_values("AI_CONFIRM_OK_TEXT"),get_global_ind_values("AI_CONFIRM_CANCEL_TEXT"),(function(){!async function(){var o=0;for(const _ of g_mod_block_list){if(_.BlkName==e){for(const o of _.BlockDim.ColorObj.children)if(o.uuid==e){_.BlockDim.ColorObj.remove(o);break}g_mod_block_list.splice(o,1);break}o++}render(g_pog_index),await save_blk_dtl_coll("D",e,[]),closeInlineDialog("block_details"),g_autofill_edit="N",apex.event.trigger("#P25_POG_RULE","apexrefresh"),apex.theme.openRegion("auto_fill_reg"),g_auto_fill_reg_open="Y"}()}))}function save_blk_dtl_coll(e,o,_){return new Promise((function(n,t){apex.server.process("SAVE_BLOCK_LIST",{x01:e,x02:o,p_clob_01:JSON.stringify(_)},{dataType:"text",success:async function(o){console.log("pData",o),apex.region("mod_block_details").refresh(),"Y"!=e&&"U"!=e||(apex.theme.openRegion("auto_fill_reg"),g_auto_fill_reg_open="Y",g_autofill_edit="N"),n("success")},loadingIndicatorPosition:"page"})}))}function open_blk_details(e,o){console.log(e),$s("P25_EDIT_BLK",e),g_autofill_edit="Y"==o?"Y":"N";var _=apex.region("block_filters").widget().interactiveGrid("getViews","grid").model;for(const s of g_mod_block_list)if(s.BlkName==e){$s("P25_BLK_NAME",s.BlkName.slice(0,-4)),$s("P25_BLK_COLOR",s.BlkColor),$s("P25_BLK_RULE",s.BlkRule);var n,t=apex.region("block_filters"),i=t.call("getCurrentView");if("N"==o){if(s.FilterVal.length>0){var a=0;for(const e of s.FilterVal)"grid"===i.internalIdentifier&&(n=t.widget().find(".a-GV-row").last(),i.view$.grid("setSelection",n),t.call("getActions").invoke("selection-add-row")),a++}a=0;_.forEach((function(e){if(console.log(s.FilterVal[a],e),void 0!==s.FilterVal[a]){var o=s.FilterVal[a].split("#");_.setValue(e,"FILTER",`${o[0]}`),_.setValue(e,"VALUE",`${o[1]}`)}a++}))}else _.clearChanges(),apex.region("block_filters").refresh();$("#ADD_BLK").css("display","none"),$("#SAVE_BLK").css("display","none"),$("#UPDATE_BLK").css("display","inline"),g_auto_fill_reg_open="N",openInlineDialog("block_details",40,65);break}}function clear_auto_fill_coll(){g_auto_fill_active="N",g_auto_fill_reg_open="N",g_autofill_edit="N",apex.server.process("DELETE_AUTOFILL_COLL",{x01:""},{dataType:"text",success:async function(e){for(const e of g_mod_block_list)for(const o of e.BlockDim.ColorObj.children)if(o.uuid==e.BlkName){e.BlockDim.ColorObj.remove(o);break}render(g_pog_index),apex.region("autofill_products").refresh(),null!==apex.region("mod_block_details")&&apex.region("mod_block_details").refresh(),console.log("pData",e),$s("P25_MULTI_PRODUCT",""),$(".dropdown").removeClass("disable_dropdown"),$(".live_image").removeClass("disable_dropdown"),$(".3d_popup").removeClass("disable_dropdown"),$(".open_product").removeClass("disable_dropdown"),$(".left_icon").removeClass("disable_dropdown"),$(".autofill_btn").removeClass("item_label_active")},loadingIndicatorPosition:"page"})}function send_autofill_item_coll(e){return logDebug("function : send_to_db; items_list : "+e,"S"),new Promise((function(o,_){console.log("items_list 1",e),apex.server.process("AUTOFILL_ITEM_COLL",{p_clob_01:e},{dataType:"html"}).done((function(e){logDebug("function : send_to_db","E"),console.log("successful autofill items"),o("success")}))}))}const randomColor=()=>"#"+Math.floor(16777215*Math.random()).toString(16).padStart(6,"0").toUpperCase();function get_shelf_list(e,o,_){var n=0,t=[],i=[],a=[],s=[],g=$v("P25_POGCR_FIXEL_TYPES").split(","),l=[],r=[];for(const e of g_pog_json[_].ModuleInfo){if(void 0===e.ParentModule||null==e.ParentModule){var d=0,c=e.Y+e.H/2,f=e.Y-e.H/2;for(const o of e.ShelfInfo)g.some((e=>o.Shelf.includes(e)))&&"TEXTBOX"==o.ObjType&&o.Y<c&&o.Y>f&&(l.push(o),o.SIndex=d,o.MIndex=n),"BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType&&(a.push(o),o.SIndex=d,o.MIndex=n,o.NoItem="N"),d++}n++}if(l.length>0)for(const e of l){var I=-121,p=(n=0,-1);for(const o of a)e.Y>o.Y&&o.Y>I&&e.X>o.X-o.W/2&&e.X<o.X+o.W/2&&(console.log("i",n),I=o.Y,p=n),n++;void 0!==p&&(a[p].NoItem="Y")}if("P"==o)t=a;else{for(const e of g_mod_block_list)i=i.concat(e.g_delete_details);for(const e of i)e.NoItem="N";for(const e of a)for(const o of i)e.MIndex==o.MIndex&&e.SIndex==o.SIndex&&t.push(e);s=a.filter((e=>!t.some((o=>o.MIndex+"-"+o.SIndex==e.MIndex+"-"+e.SIndex))))}for(const e of t){var h=get_shelf_max_merch(g_pog_json[_].ModuleInfo[e.MIndex],g_pog_json[_].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex],e.MIndex,e.SIndex,_,parseFloat($v("P25_POGCR_DFT_MAX_MERCH")));if(e.MaxMerch=h,"PEGBOARD"==e.ObjType){var u=e.peg_vert_values,m=e.peg_horiz_values,O=[],S=[];u.length>0&&($.each(u,(function(o,_){S.push(e.Y+u[o])})),e.peg_vert_details=S),m.length>0&&($.each(m,(function(o,_){O.push(e.X+m[o])})),e.peg_horiz_details=O)}}for(const e of s){h=get_shelf_max_merch(g_pog_json[_].ModuleInfo[e.MIndex],g_pog_json[_].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex],e.MIndex,e.SIndex,_,parseFloat($v("P25_POGCR_DFT_MAX_MERCH")));e.MaxMerch=h}if(console.log("rule_dtl",e,t),"P"==e[4])if("LRTB"==e[1]||"TBLR"==e[1])var P={Y:"desc"};else P={Y:"asc"};else if("LRTB"==e[1]||"TBLR"==e[1])P={MIndex:"asc",X:"asc",Y:"desc"};else P={MIndex:"asc",X:"asc",Y:"asc"};return t.keySort(P),details={},details.ShelfDetails=t,details.ModBalance=s,r.push(details),r}async function load_autofill_items(e,o){var _=o.split(",");apex.theme.closeRegion("auto_fill_reg"),addLoadingIndicator();var n=get_shelf_list(_,$v("P25_BLOCK_SELECTION"),e);apex.server.process("GET_AUTOFILL_ITEMS",{x01:_[0],x02:$v("P25_BLOCK_SELECTION"),p_clob_01:JSON.stringify(n)},{dataType:"html"}).done((async function(o){var n=$.trim(o);if(console.log("return_data",n),n.match(/ERROR.*/))raise_error(n),removeLoadingIndicator(regionloadWait);else if(""!==n){try{var t=JSON.parse(n),i=[];if(console.log("return_arr",t),"M"==$v("P25_BLOCK_SELECTION")){for(const e of t)i=i.concat(JSON.parse(e));console.log("items_list",i)}else i=t;await add_autofill_item_to_shelf(i,_,$v("P25_BLOCK_SELECTION"),e);g_json=[g_pog_json[e]],init(e),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects[e]=objects,set_indicator_objects(e),modifyWindowAfterMinMax(g_scene_objects);var a=JSON.parse(JSON.stringify(g_pog_json));g_world=g_scene_objects[e].scene.children[2],g_camera=g_scene_objects[e].scene.children[0];await save_update_json_items(g_pog_json),await create_module_from_json(a,"Y","F",$v("P25_PRODUCT_BTN_CLICK"),"N","Y","N","Y","Y","","N",g_scene_objects[e].scene.children[0],g_scene_objects[e].scene,e,e,"N",[]);g_pog_index=e,g_pog_json[e].AFBlk=g_mod_block_list,clear_auto_fill_coll(),g_auto_fill_reg_open="N",g_auto_fill_active="N",g_autofill_edit="N";await calculateFixelAndSupplyDays("N",e);render(e),removeLoadingIndicator(regionloadWait)}catch(e){console.log("err",e),raise_error(e)}console.log("items_list",i)}else raise_error("Something went wrong"),removeLoadingIndicator(regionloadWait)}))}async function update_shelf_max_items(e,o,_,n,t){for(var i,a=0,s=0,g=0,l={},r=g_mod_block_list,d=[],c=0;i=r[c++];){var f;(f=i.BlkName)in l||(l[f]=1,d.push(f))}if(d.length>0)for(const o of d){for(const _ of e)"N"==_.RemovedItem&&_.BlkName==o&&(a+=_.W,g++);var I=0;for(const _ of t)if("ROD"!==_.ObjType&&"PEGBOARD"!==_.ObjType&&"N"==_.NoItem&&(I+=_.CalcWidth),"PEGBOARD"==_.ObjType&&_.BlkName==o){c=0;var p=0,h=1;for(const t of e){if("N"==t.RemovedItem&&t.BlkName==o){var u=set_item_details(t,_.MIndex,_.SIndex,-1,"","");g_pog_json[n].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[u].FromProductList="Y";var m=g_pog_json[n].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex];if(0==u){var O=m.X-m.W/2-m.LOverhang+m.HorizSpacing;g_pog_json[n].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[u].X=O+t.W/2}else g_pog_json[n].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[u].X=m.ItemInfo[u-1].X+m.ItemInfo[u-1].W/2+t.W/2+m.HorizSpacing;var[S,P]=get_item_xy(m,t,t.W,t.H,g_pog_json);if(g_pog_json[n].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[u].Y=P,"N"==await find_pegboard_gap(t.W,t.H,t.X,t.Y,_.VertiSpacing,_.MIndex,_.SIndex,u,u,"Y",n,"Y",g_auto_x_space,g_auto_y_space))break;p+=t.W,h+=1}c++}_.ItemInfo=[],g_pog_json[n].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo=[],_.TotalItemW=p,_.TotItems=h,I+=p}else"ROD"==_.ObjType&&_.BlkName==o&&(s+=_.D);var E=0,v=(h=0,-1),D=0;if(s>0)for(const _ of e){if("N"==_.RemovedItem&&_.BlkName==o){if(s<E){h-=1,D-=v;break}E+=_.D,D+=_.W,h+=c,v=_.W}c++}var C=0;for(const e of t)"N"==e.NoItem&&e.BlkName==o&&(C++,e.CalcSize=-1,"ROD"!==e.ObjType&&0);if(console.log("tot_shelf",C,I,a,g),I>a-D&&g>C){var T=g%C;console.log("reminder",T);for(const e of t)e.BlkName==o&&(e.CalcSize=-1,T>0?(e.ItemsCnt=Math.floor(g/C)+1,T--):e.ItemsCnt=Math.floor(g/C))}else if(g<=C)for(const e of t)e.BlkName==o&&(e.CalcSize=0);else if(I<a)for(const e of t)"ROD"!==e.ObjType&&e.BlkName==o&&(e.CalcSize=-1)}else{a=0,s=0,g=0;for(const o of e)"N"==o.RemovedItem&&("P"==_&&(null==o.BlkName||void 0===o.BlkName)||"M"==_&&null!==o.BlkName)&&(a+=o.W,g++);I=0;for(const o of t)if("ROD"!==o.ObjType&&"PEGBOARD"!==o.ObjType&&"N"==o.NoItem&&(I+=o.W),"PEGBOARD"==o.ObjType){c=0,p=0,h=1;for(const t of e){if("N"==t.RemovedItem&&("P"==_&&(null==t.BlkName||void 0===t.BlkName)||"M"==_&&null!==t.BlkName)){u=set_item_details(t,o.MIndex,o.SIndex,-1,"","");g_pog_json[n].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex].ItemInfo[u].FromProductList="Y";m=g_pog_json[n].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex];if(0==u){O=m.X-m.W/2-m.LOverhang+m.HorizSpacing;g_pog_json[n].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex].ItemInfo[u].X=O+t.W/2}else g_pog_json[n].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex].ItemInfo[u].X=m.ItemInfo[u-1].X+m.ItemInfo[u-1].W/2+t.W/2+m.HorizSpacing;var[S,P]=get_item_xy(m,t,t.W,t.H,g_pog_json);if(g_pog_json[n].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex].ItemInfo[u].Y=P,"N"==await find_pegboard_gap(t.W,t.H,t.X,t.Y,o.VertiSpacing,o.MIndex,o.SIndex,u,u,"Y",n,"Y",g_auto_x_space,g_auto_y_space))break;p+=t.W,h+=1}c++}o.ItemInfo=[],g_pog_json[n].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex].ItemInfo=[],o.TotalItemW=p,o.TotItems=h,I+=p}else"ROD"==o.ObjType&&(s+=o.D);E=0,h=0,v=-1,D=0;if(s>0)for(const o of e){if("N"==o.RemovedItem&&("P"==_&&(null==o.BlkName||void 0===o.BlkName)||"M"==_&&null!==o.BlkName)){if(s<E){h-=1,D-=v;break}E+=o.D,D+=o.W,h+=c,v=o.W}c++}C=0;for(const e of t)"N"==e.NoItem&&(C++,e.CalcSize=-1,"ROD"!==e.ObjType&&0);if(console.log("tot_shelf",C,I,a,g),I>a-D&&g>C){T=g%C;for(const e of t)e.CalcSize=-1,T>0?(e.ItemsCnt=Math.floor(g/C)+1,T--):e.ItemsCnt=Math.floor(g/C)}else if(g<=C)for(const e of t)e.CalcSize=0;else if(I<a){T=g%C;for(const e of t)"ROD"!==e.ObjType&&(e.CalcSize=-1),T>0?(e.ItemsCnt=Math.floor(g/C)+1,T--):e.ItemsCnt=Math.floor(g/C)}}return console.log("reminder",e,t),[e,t]}async function add_shelf_items(e,o,_,n,t){console.log("add_shelf_items",e,o,_,n,t);var i="",a=-1,s=-1,g=0,l=0;if("P"==o[4]){if("LRTB"==o[1])var r={Y:"desc"};else if("LRBT"==o[1])r={Y:"asc"};else if("BTLR"==o[1])r={MIndex:"asc",Y:"asc"};else if("TBLR"==o[1])r={MIndex:"asc",Y:"desc"}}else if("LRTB"==o[1])r={MIndex:"asc",Y:"desc"};else if("LRBT"==o[1])r={MIndex:"asc",Y:"asc"};else if("BTLR"==o[1])r={MIndex:"asc",Y:"asc"};else if("TBLR"==o[1])r={MIndex:"asc",Y:"desc"};t.keySort(r);var[e,t]=await update_shelf_max_items(e,o,_,n,t);if(console.log("reminder 1",e,t),"LRTB"==o[1]||"LRBT"==o[1]){l=0;var d=0;for(const o of t)if("N"==o.NoItem){l=o.MIndex,d=o.SIndex;var c=[],f=(g=0,g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo);for(const e of f)"DIVIDER"==e.Item&&(e.Added="N",e.BottomObjID="",e.TopObjID=""),g++;g=0;for(const e of f)"DIVIDER"==e.Item&&(e.Added="N",e.BottomObjID="",e.TopObjID="",c.push(JSON.parse(JSON.stringify(e))),g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo.splice(g,1)),g++;if(i!==o&&""!==i){update_item_distance(a,s,n);reorder_items(a,s,n)}i=o;g=0;for(const t of e){if("N"==t.RemovedItem&&("P"==_&&(null==t.BlkName||void 0===t.BlkName)||"M"==_&&t.BlkName==o.BlkName&&null!==t.BlkName)){var I=o.ObjType;f=g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo,I=o.ObjType;if(o.CalcSize>0&&"ROD"!==I){var p=0,h=0;for(const e of f)p+=e.W;if((h=o.CalcSize-p)<=0)break}else if(0==o.CalcSize){if(1==f.length)break}else if("PALLET"==I||"CHEST"==I){p=0,h=0;for(const e of f)p+=e.W;if((h=o.CalcWidth-p)<=0)break}var[u,m,O,S,P,E]=get_new_orientation_dim(t.Orientation,t.W,t.H,t.D);t.W=u,t.H=m,t.D=O;var v=set_item_details(t,l,d,-1,"",""),D=g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v],C=g_pog_json[n].ModuleInfo[l].ShelfInfo[d].HorizGap,T=g_pog_json[n].ModuleInfo[l].ShelfInfo[d].SpreadItem,b=C,j=g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo.length,N=-1;if("PEGBOARD"==I){g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v].Exists="N",g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v].FromProductList="Y";var x=g_pog_json[n].ModuleInfo[l].ShelfInfo[d];if(0==v){var M=x.X-x.W/2-x.LOverhang+x.HorizSpacing;g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v].X=M+D.W/2}else g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v].X=x.ItemInfo[v-1].X+x.ItemInfo[v-1].W/2+D.W/2+x.HorizSpacing;var[R,N]=get_item_xy(x,D,D.W,D.H,n);g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v].Y=N}else{x=g_pog_json[n].ModuleInfo[l].ShelfInfo[d];var[R,N]=get_item_xy(x,D,D.W,D.H,n);g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v].Y=N,"PALLET"==I&&(g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v].Z=0);var L=get_item_xaxis(D.W,D.H,D.D,I,-1,b,T,C,l,d,v,"Y",j,"N",n);g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v].X=L;for(const e of c)if(L>=e.X&&"N"==e.Added){e.Added="Y",g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo.splice(v,0,e),v+=1;L=get_item_xaxis(D.W,D.H,D.D,I,-1,b,T,C,l,d,v,"Y",j,"N",n);g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v].X=L;break}}var A=0;""!==D.ItemNesting&&("W"==D.ItemNesting?A=D.OrgNW:"H"==D.ItemNesting?A=D.OrgNH:"D"==D.ItemNesting&&(A=D.OrgND));const i=o.W,a=o.CalcWidth;var y=i;for(const e of g_mod_block_list)if("M"==_&&e.BlkName==t.BlkName&&e.BlkName==o.BlkName){y=e.BlockDim.BlkWidth;break}var[$,w,Y]=get_select_dim(D);const[s,g,r,B,V,k]=set_dim_validate_item(l,d,v,$,w,Y,D.ItemNesting,A,D.BHoriz,D.BVert,D.BaseD,D.Orientation,D.OrgCWPerc,D.OrgCHPerc,D.OrgCDPerc,"N","Y","N",n);o.W=i;var G="N";f=g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo;if(void 0!==o.ItemsCnt&&o.ItemsCnt>0&&"ROD"!==I){p=0,h=0;for(const e of f)p+=e.W;h=o.CalcWidth-p,(o.CalcWidth>0&&h<=0||o.ItemsCnt<f.length)&&(G="Y")}if(console.log("item_arr",D.Item,G),"ERROR"===s||"N"!=G){t.W=t.OrgUW,t.H=t.OrgUH,t.D=t.OrgUD,t.RW=t.W,t.RH=t.H,t.RD=t.D,t.OW=t.OrgUW,t.OH=t.OrgUH,t.OD=t.OrgUD,g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo.splice(v,1),t.RemovedItem="N";p=0,h=0;var H=0;if("ROD"!==I){for(const e of g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo)p+=e.W;for(const o of e)"N"==o.RemovedItem&&(H=Math.min(H,o.W))}else{for(const e of g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo)p+=e.D+o.DGap;for(const o of e)"N"==o.RemovedItem&&(H=Math.min(H,o.D))}if(h=o.CalcSize>0&&"ROD"!==I?o.CalcSize-p:"ROD"!==I?o.CalcWidth-p:o.D-p,o.CalcWidth=a,h<H||h<=0)break;continue}update_item_org_dim(l,d,v,s,g,r,B,V,k,n);x=g_pog_json[n].ModuleInfo[l].ShelfInfo[d];var F=g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v],[R,N]=get_item_xy(x,F,F.W,F.H,n);void 0!==F.BottomObjID&&""!=F.BottomObjID||void 0!==F.TopObjID&&""!=F.TopObjID||(g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v].Y=N),t.RemovedItem="Y"}g++}a=l,s=d}}else{var B=-1;for(const e of t)"N"==e.NoItem&&B++;g=0;var V=-1;for(const o of e)if("N"==o.RemovedItem){l=0,d=0;var k=0;for(const r of t){if(k>V&&"N"==r.NoItem&&"N"==o.RemovedItem&&("P"==_&&(null==o.BlkName||null==typeof o.BlkName=="undefined")||"M"==_&&o.BlkName==r.BlkName&&null!==o.BlkName)){l=r.MIndex,d=r.SIndex;c=[],g=0,f=g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo;for(const e of f)"DIVIDER"==e.Item&&(e.Added="N",e.BottomObjID="",e.TopObjID="",c.push(JSON.parse(JSON.stringify(e))),g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo.splice(g,1)),g++;i!==r&&""!==i&&update_item_distance(a,s,n),V=B==k?-1:k,i=r;I=r.ObjType,f=g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo,I=r.ObjType;if(r.CalcSize>0&&"ROD"!==I){p=0,h=0;for(const e of f)p+=e.W;if((h=r.CalcSize-p)<=0)break}else if(0==r.CalcSize){if(1==f.length)break}else if("PALLET"==I||"CHEST"==I){p=0,h=0;for(const e of f)p+=e.W;if((h=r.CalcWidth-p)<=0)break}var[u,m,O,S,P,E]=get_new_orientation_dim(o.Orientation,o.W,o.H,o.D);o.W=u,o.H=m,o.D=O;v=set_item_details(o,l,d,-1,"",""),D=g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v],C=g_pog_json[n].ModuleInfo[l].ShelfInfo[d].HorizGap,T=g_pog_json[n].ModuleInfo[l].ShelfInfo[d].SpreadItem,b=C,j=g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo.length,N=-1;if("PEGBOARD"==I){g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v].Exists="N",g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v].FromProductList="Y";x=g_pog_json[n].ModuleInfo[l].ShelfInfo[d];if(0==v){M=x.X-x.W/2-x.LOverhang+x.HorizSpacing;g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v].X=M+D.W/2}else g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v].X=x.ItemInfo[v-1].X+x.ItemInfo[v-1].W/2+D.W/2+x.HorizSpacing;var[R,N]=get_item_xy(x,D,D.W,D.H,n);g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v].Y=N}else{x=g_pog_json[n].ModuleInfo[l].ShelfInfo[d];var[R,N]=get_item_xy(x,D,D.W,D.H,n);g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v].Y=N,"PALLET"==I&&(g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v].Z=0);L=get_item_xaxis(D.W,D.H,D.D,I,-1,b,T,C,l,d,v,"Y",j,"N",n);g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v].X=L;for(const e of c)if(L>=e.X&&"N"==e.Added){e.Added="Y",g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo.splice(v,0,e),v+=1;L=get_item_xaxis(D.W,D.H,D.D,I,-1,b,T,C,l,d,v,"Y",j,"N",n);g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v].X=L;break}}A=0;""!==D.ItemNesting&&("W"==D.ItemNesting?A=D.OrgNW:"H"==D.ItemNesting?A=D.OrgNH:"D"==D.ItemNesting&&(A=D.OrgND));const t=r.W,W=r.CalcWidth;y=t;for(const e of g_mod_block_list)if("M"==_&&e.BlkName==o.BlkName&&e.BlkName==r.BlkName){y=e.BlockDim.BlkWidth;break}r.CalcWidth=y,r.W=y;var[$,w,Y]=get_select_dim(D);const[U,X,z,J,K,q]=set_dim_validate_item(l,d,v,$,w,Y,D.ItemNesting,A,D.BHoriz,D.BVert,D.BaseD,D.Orientation,D.OrgCWPerc,D.OrgCHPerc,D.OrgCDPerc,"N","Y","N",n);r.W=t;G="N",f=g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo;if(void 0!==r.ItemsCnt&&r.ItemsCnt>0&&"ROD"!==I){p=0,h=0;for(const e of f)p+=e.W;h=r.CalcWidth-p,(r.CalcWidth>0&&h<=0||r.ItemsCnt<f.length)&&(G="Y")}if(console.log("item_arr",D.Item,G),"ERROR"===U||"N"!=G){o.W=o.OrgUW,o.H=o.OrgUH,o.D=o.OrgUD,o.RW=o.W,o.RH=o.H,o.RD=o.D,o.OW=o.OrgUW,o.OH=o.OrgUH,o.OD=o.OrgUD,console.log("in error",o.Item,o.OrgUW,o.OrgUH,o.W),g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo.splice(v,1),o.RemovedItem="N";p=0,h=0,H=0;if("ROD"!==I){for(const e of g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo)p+=e.W;for(const o of e)"N"==o.RemovedItem&&(H=Math.min(H,o.W))}else{for(const e of g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo)p+=e.D+r.DGap;for(const o of e)"N"==o.RemovedItem&&(H=Math.min(H,o.D))}if(h=r.CalcSize>0&&"ROD"!==I?r.CalcSize-p:"ROD"!==I?r.CalcWidth-p:r.D-p,k++,r.CalcWidth=W,h<H||h<=0)break;continue}update_item_org_dim(l,d,v,U,X,z,J,K,q,n);x=g_pog_json[n].ModuleInfo[l].ShelfInfo[d],F=g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v];var[R,N]=get_item_xy(x,F,F.W,F.H,n);console.log("l_items_details",F.W,F.Item),void 0!==F.BottomObjID&&""!=F.BottomObjID||void 0!==F.TopObjID&&""!=F.TopObjID||(g_pog_json[n].ModuleInfo[l].ShelfInfo[d].ItemInfo[v].Y=N),o.RemovedItem="Y"}a=l,s=d,k++}}l=0,d=0;for(const e of t){l=e.MIndex,d=e.SIndex,update_item_distance(l,d,n);reorder_items(l,d,n)}}}async function add_autofill_item_to_shelf(e,o,_,n){var t=g_overhung_shelf_active;"Y"==g_overhung_shelf_active&&(g_overhung_shelf_active="N");var i=.4,a=0,s=[],g=[],l=[],r=$v("P25_POGCR_FIXEL_TYPES").split(","),d=[];for(const e of g_pog_json[n].ModuleInfo){if(void 0===e.ParentModule||null==e.ParentModule){var c=0,f=e.Y+e.H/2,I=e.Y-e.H/2;for(const o of e.ShelfInfo)r.some((e=>o.Shelf.includes(e)))&&"TEXTBOX"==o.ObjType&&o.Y<f&&o.Y>I&&(d.push(o),o.SIndex=c,o.MIndex=a,o.CalcWidth=o.W),"BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType&&(g.push(o),o.SIndex=c,o.MIndex=a,o.NoItem="N",o.CalcWidth=o.W),c++}a++}if(d.length>0)for(const e of d){var p=-121,h=(a=0,-1);for(const o of g)e.Y>o.Y&&o.Y>p&&e.X>o.X-o.W/2&&e.X<o.X+o.W/2&&(p=o.Y,h=a),a++;-1!==h&&(g[h].W<=e.W?g[h].NoItem="Y":(g[h].CalcWidth=g[h].W-e.W,g[h].NoItem="N"),console.log("index 1",g[h].NoItem,g[h].Shelf))}if("P"==_)s=g;else{for(const e of g_mod_block_list)s=s.concat(e.g_delete_details);for(const e of s)e.NoItem="N";for(const e of s)for(const o of g)"Y"==o.NoItem&&o.MIndex==e.MIndex&&o.SIndex==e.SIndex&&(e.NoItem="Y"),o.MIndex==e.MIndex&&o.SIndex==e.SIndex&&(e.CalcWidth=o.CalcWidth);l=g.filter((e=>!s.some((o=>o.MIndex+"-"+o.SIndex==e.MIndex+"-"+e.SIndex))))}var u=[];for(const e of s)"N"==e.NoItem&&u.push(e);s=u;u=[];for(const e of l)"N"==e.NoItem&&u.push(e);l=u,await add_shelf_items(e,o,_,n,s);let m=e.some((e=>"N"==e.RemovedItem));"M"==_&&m&&l.length>0&&await add_shelf_items(e,o,"P",n,l);s.every((e=>"Y"==e.NoItem||e.CalcWidth<=0))&&l.every((e=>"Y"==e.NoItem||e.CalcWidth<=0));var O="N";for(const o of e)if("N"==o.RemovedItem){O="Y";break}if("Y"==O){var S=get_min_max_xy(n).split("###"),P=-1;a=0;for(const e of g_pog_json[n].ModuleInfo){if(void 0===e.ParentModule||null==e.ParentModule){P=a;break}a++}var E=[],v=0;for(const o of e)if("N"==o.RemovedItem){if((v+=o.W)>g_pog_json[n].W)break;E.push(o)}i=0;for(const e of E)i=Math.max(i,e.D),e.MIndex=P;carpark_shelf(P+1,g_pog_json[n].W,.04,i+.1,g_pog_json[n].W/2,parseFloat(S[1])+.03,P);c=0;for(const e of E){if(e.MIndex=void 0===e.MIndex?0:e.MIndex,P==e.MIndex){var D=get_item_object(e,P,0,-1,"","");g_pog_json[n].ModuleInfo[P].Carpark[0].ItemInfo.push(D);var C=g_pog_json[n].ModuleInfo[P].Carpark[0].ItemInfo.length-1,T=newy=-1;newy=g_pog_json[n].ModuleInfo[P].Carpark[0].Y+g_pog_json[n].ModuleInfo[P].Carpark[0].H/2+e.H/2,T=0==C?g_pog_json[n].ModuleInfo[P].Carpark[0].X-g_pog_json[n].ModuleInfo[P].Carpark[0].W/2+e.W/2:g_pog_json[n].ModuleInfo[P].Carpark[0].ItemInfo[g_pog_json[n].ModuleInfo[P].Carpark[0].ItemInfo.length-2].X+g_pog_json[n].ModuleInfo[P].Carpark[0].ItemInfo[g_pog_json[n].ModuleInfo[P].Carpark[0].ItemInfo.length-2].W/2+e.W/2,g_pog_json[n].ModuleInfo[P].Carpark[0].ItemInfo[C].X=T,g_pog_json[n].ModuleInfo[P].Carpark[0].ItemInfo[C].Y=newy,g_pog_json[n].ModuleInfo[P].Carpark[0].ItemInfo[C].Z=.05}c+=1}}await update_horiz_facings(g,n),a=0;for(const e of g_pog_json[n].ModuleInfo)void 0!==e.ParentModule&&null!=e.ParentModule||$.each(e.ShelfInfo,(function(o,_){if("BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType&&"TEXTBOX"!==_.ObjType&&(update_item_distance(a,o,n),reorder_items(a,o,n)&&"PEGBOARD"!==_.ObjType)){var t="N";if($.each(_.ItemInfo,(function(e,o){"DIVIDER"!==o.Item&&(t="Y")})),"R"!==_.SpreadItem)$.each(_.ItemInfo,(function(e,i){if("DIVIDER"!==i.Item&&"N"==t||"Y"==t){"PALLET"==_.ObjType&&(i.Exists="N",i.Dragged="N",g_edited_item_index=-1);var s=get_item_xaxis(i.W,i.H,i.D,_.ObjType,-1,_.HorizGap,_.SpreadItem,_.HorizGap,a,o,e,"Y",_.ItemInfo.length,"N",n),[g,l]=get_item_xy(_,i,i.W,i.H,n);g_pog_json[n].ModuleInfo[a].ShelfInfo[o].ItemInfo[e].X=s,g_pog_json[n].ModuleInfo[a].ShelfInfo[o].ItemInfo[e].Y=l}}));else for(var i=_.ItemInfo,s=i.length-1;s>=0;s--)if("DIVIDER"!==i[s].Item&&"N"==t||"Y"==t){"PALLET"==_.ObjType&&(i[s].Exists="N",i[s].Dragged="N",g_edited_item_index=-1);var g=get_item_xaxis(i[s].W,i[s].H,i[s].D,_.ObjType,-1,_.HorizGap,_.SpreadItem,_.HorizGap,a,o,s,"Y",_.ItemInfo.length,"N",n),[l,r]=get_item_xy(_,i[s],i[s].W,i[s].H,n);g_pog_json[n].ModuleInfo[a].ShelfInfo[o].ItemInfo[s].Y=r,g_pog_json[n].ModuleInfo[a].ShelfInfo[o].ItemInfo[s].X=g}"PEGBOARD"!==_.ObjType&&"HANGINGBAR"!==_.ObjType&&"ROD"!==_.ObjType&&$.each(_.ItemInfo,(function(t,i){if("DIVIDER"!==i.Item){var s=get_shelf_max_merch(e,_,a,o,n,parseFloat($v("P25_POGCR_DFT_MAX_MERCH"))),g=0;if(g="Y"==i.NewItem?i.H:i.RH/i.BVert,!(void 0!==i.TopObjID&&""!=i.TopObjID||void 0!==i.BottomObjID&&""!=i.BottomObjID)){if("Y"==g_max_facing_enabled){var l=Math.floor(100*s/(100*g));l>(c=(d=nvl(i.MPogVertFacings)>0?i.MPogVertFacings:i.MVertFacings)>-1?d:$v("P25_POGCR_AUTO_MAX_VFACING"))&&(l=parseInt(c)),i.H=i.RH/i.BVert*(l>0?l:1),i.BVert=l>0?l:1,i.Y=_.Y+_.H/2+i.H/2,i.RH=i.H}else if("Y"==$v("P25_POGCR_AUTO_VERT_FACING")&&"N"==g_max_facing_enabled){var r=parseInt($v("P25_POGCR_DFLT_VERT_FACING"));if(r>0){var d,c=(d=nvl(i.MPogVertFacings)>0?i.MPogVertFacings:i.MVertFacings)<r&&d>-1?parseInt(d):r,f=i.RH/i.BVert*c;f<=s&&(i.H=f,i.BVert=c,i.Y=_.Y+_.H/2+i.H/2,i.RH=i.H)}}var I=Math.floor(100*_.D/(100*i.D)),p=nvl(i.MPogDepthFacings)>0?i.MPogDepthFacings:i.MDepthFacings;I=p<I&&p>-1?p:I,i.D=i.RD/i.BaseD*(I>0?I:1),i.BaseD=I>0?I:1,i.RD=i.D}}}))}})),a++;var b="Y"==o[7]?"1":"",j="Y"==o[8]?"2":"";location_numbering(o[5],o[9],o[6],b,j,n),g_overhung_shelf_active=t}async function update_horiz_facings(e,o){var _,n=-1,t=-1;for(const b of e){if("PEGBOARD"==_){var i=g_pog_json[o].ModuleInfo[n].ShelfInfo[t].ItemInfo,a=g_pog_json[o].ModuleInfo[n].ShelfInfo[t].HorizGap,s=g_pog_json[o].ModuleInfo[n].ShelfInfo[t].SpreadItem,g=a,l=i.length,r=0;for(const e of g_pog_json[o].ModuleInfo[n].ShelfInfo[t].ItemInfo){var d=get_item_xaxis(e.W,e.H,e.D,c,-1,g,s,a,n,t,r,"Y",l,"N",o);g_pog_json[o].ModuleInfo[n].ShelfInfo[t].ItemInfo[r].X=d,r++}}if("ROD"!==b.ObjType){var c=b.ObjType,f=b.MIndex,I=b.SIndex;if((i=g_pog_json[o].ModuleInfo[f].ShelfInfo[I].ItemInfo).length>0){var p=0;for(const e of g_pog_json[o].ModuleInfo[f].ShelfInfo[I].ItemInfo)p+=e.W;if(availableSpace=b.CalcWidth-p,availableSpace>0){for(const e of g_pog_json[o].ModuleInfo[f].ShelfInfo[I].ItemInfo)if(e.CalcMinH=1,e.CalcMaxH=0,e.OldHFacing=e.BHoriz,void 0!==e.FacingFormula&&null!==e.FacingFormula){var h=e.FacingFormula.split(",");if(h.length>0){var u=[];for(const e of h){var O=e.split("#"),S={};S.MinFacing=parseInt(O[0]),S.MaxFacing=parseInt(O[1]),S.SortOrder=parseInt(O[2]),S.Condition=O[3],u.push(S)}u.keySort({SortOrder:"asc"});var P=e.MHorizFacings<u[0].MaxFacing&&-1!==e.MHorizFacings?e.MHorizFacings:u[0].MaxFacing;e.CalcMinH=u[0].MinFacing,e.CalcMaxH=P}}var E=0;for(const e of g_pog_json[o].ModuleInfo[f].ShelfInfo[I].ItemInfo)E=Math.max(e.CalcMaxH,E);if(E>0){var v=!0;for(m=1;m<E&&v;m++)if("PEGBOARD"!==c){for(const e of g_pog_json[o].ModuleInfo[f].ShelfInfo[I].ItemInfo)if(e.CalcMaxH>0&&e.BHoriz<e.CalcMaxH){var D=0;for(const e of g_pog_json[o].ModuleInfo[f].ShelfInfo[I].ItemInfo)D+=e.W;if(availableSpace=b.W-(D+e.OW),!(availableSpace>0)){v=!1;break}e.BHoriz=e.OldHFacing+m,e.W=e.PW*e.BHoriz,e.RW=e.W;D=0;for(const e of g_pog_json[o].ModuleInfo[f].ShelfInfo[I].ItemInfo)D+=e.W;if(availableSpace=b.W-D,!(availableSpace>0)){v=!1;break}}}else for(const e of g_pog_json[o].ModuleInfo[f].ShelfInfo[I].ItemInfo){if(!v)break;if(e.CalcMaxH>0&&e.BHoriz<e.CalcMaxH){var C=e.W,T=e.BHoriz;e.BHoriz=e.OldHFacing+m,e.W=e.PW*e.BHoriz,e.RW=e.W;r=0;for(const _ of g_pog_json[o].ModuleInfo[f].ShelfInfo[I].ItemInfo){if("N"==await find_pegboard_gap(_.W,_.H,_.X,_.Y,b.VertiSpacing,b.MIndex,b.SIndex,r,r,"Y",o,"Y",g_auto_x_space,g_auto_y_space)){e.BHoriz=T,e.W=C,e.RW=e.W,v=!1;break}r++}}}}}}}_=c,n=f,t=I}}function save_update_json_items(e){return logDebug("function : save_pog_to_json","S"),new Promise((function(o,_){apex.server.process("SAVE_UPDATE_JSON_ITEMS",{x01:e[g_pog_index],p_clob_01:JSON.stringify(e)},{dataType:"text",success:function(e){""!=$.trim(e)?raise_error(e):(logDebug("function : save_pog_to_json","E"),o("SUCESS"))}})}))}async function saveImportItems(){var e,o,_=[],t=[];console.log("saveImportItems"),apex.server.process("GET_ITEM_JSON_FROM_COLL",{dataType:"html"}).done((async function(i){if(""!==$.trim(i)&&(o=i),await async function(){var i=0;for(const O of o){var a=parseInt(o[i].Item),s=parseFloat(o[i].RegMovment),g=parseFloat(o[i].WeeksCount),l=parseFloat(o[i].CogsAdj),r=parseFloat(o[i].GrossProfit),d=parseFloat(o[i].AvgSales),c=o[i].Color;s=isNaN(s)?0:nvl(s),g=isNaN(g)?0:nvl(g),l=isNaN(l)?0:nvl(l),r=isNaN(r)?0:nvl(r),d=isNaN(d)?0:nvl(d);var f=0;for(const o of g_pog_json){var I=0;for(const i of o.ModuleInfo){if(null==i.ParentModule){var p=0;for(const o of i.ShelfInfo){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType){var h=0;for(const i of o.ItemInfo){if(i.ItemID==a){var u=0==nvl(c)?g_pog_json[f].ModuleInfo[I].ShelfInfo[p].ItemInfo[h].Color:c;g_pog_json[f].ModuleInfo[I].ShelfInfo[p].ItemInfo[h].RegMovement=s,g_pog_json[f].ModuleInfo[I].ShelfInfo[p].ItemInfo[h].WeeksCount=g,g_pog_json[f].ModuleInfo[I].ShelfInfo[p].ItemInfo[h].CogsAdj=l,g_pog_json[f].ModuleInfo[I].ShelfInfo[p].ItemInfo[h].GrossProfit=r,g_pog_json[f].ModuleInfo[I].ShelfInfo[p].ItemInfo[h].AvgSales=d,g_pog_json[f].ModuleInfo[I].ShelfInfo[p].ItemInfo[h].CogsAdjInd="Y",g_pog_json[f].ModuleInfo[I].ShelfInfo[p].ItemInfo[h].AvgSalesInd="Y",g_pog_json[f].ModuleInfo[I].ShelfInfo[p].ItemInfo[h].GrossProfitInd="Y",g_pog_json[f].ModuleInfo[I].ShelfInfo[p].ItemInfo[h].WeeksCountInd="Y",g_pog_json[f].ModuleInfo[I].ShelfInfo[p].ItemInfo[h].RegMovementInd="Y",g_pog_json[f].ModuleInfo[I].ShelfInfo[p].ItemInfo[h].DaysOfSupplyInd="Y",g_pog_json[f].ModuleInfo[I].ShelfInfo[p].ItemInfo[h].Color=u;await updateDaysOfSupply(i,h,p,I,"N","N",f,"Y");if(t.push(i.ItemID),_.push(g_pog_json[f].ModuleInfo[I].ShelfInfo[p].ItemInfo[h].DaysOfSupply),void 0!==(e=g_scene_objects[f].scene.children[2].getObjectById(i.ObjID))&&(e.RegMovement=s,e.WeeksCount=g,e.CogsAdj=l,e.GrossProfit=r,e.AvgSales=d,"Y"!==g_show_live_image||0==nvl(e.material.map))){e.material.color.setHex(parseInt(u.replace("#","0x"),16));var m=e.children;for(n=0;n<m.length;n++)"horiz_facing"==m[n].uuid&&m[n].material.color.setHex(parseInt(u.replace("#","0x"),16))}}h++}}p++}}I++}render(f),f++}i++}}(),apex.server.process("UPDATE_POG_ITEM_COLL",{f01:t,f02:_},{dataType:"text",success:function(e){""!=$.trim(e)&&raise_error(e)}}),"Y"==g_all_pog_flag)var a=0;else a=g_pog_index;for(const e of g_pog_json){if((a!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex)&&"Y"==g_show_days_of_supply&&(await showHideDaysOfSupplyLabel(g_show_days_of_supply,"N",a,"Y","Y",$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label),"POG"==g_compare_view&&"Y"==g_compare_pog_flag&&await showHideDaysOfSupplyLabel(g_show_days_of_supply,"N",g_ComViewIndex,"Y","Y",$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label)),"Y"!=g_all_pog_flag)break;a++}}))}function generateMultiPogDropdown(){var e,o;$("[data-pog=true]").remove();for(var _=0;_<g_pog_json.length;_++)(_!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex)&&(o="<a onclick=setPogActive("+_+") class='float_left top_icon print_rep' data-indx='"+_+"' data-pog=true>"+g_pog_json[_].POGCode+(null!=(e=g_pog_json[_].Version)?" - "+e:"")+"</a>",$("#multiPogDropdown").append(o),$("[data-pog]").removeClass("multiPogList_active"),$("[data-indx="+g_pog_index+"]").addClass("multiPogList_active"))}function setPogActive(e){$("[data-pog]").removeClass("multiPogList_active"),$(".canvas-buttons").removeClass("canvas_highlight"),$("[data-indx="+e+"]").addClass("multiPogList_active");var o=$('#canvas-holder [data-indx="'+e+'"]').attr("id");$("#"+o+"-btns").addClass("canvas_highlight"),"ALL_POG"!==e?(g_all_pog_flag="N",g_pog_index=e,$s("P25_OPEN_POG_CODE",g_pog_json[e].POGCode),$s("P25_OPEN_POG_VERSION",g_pog_json[e].Version)):($s("P25_SELECTED_CANVAS","ALL_POG"),g_all_pog_flag="Y",g_pog_index=0,$s("P25_OPEN_POG_CODE",""),$s("P25_OPEN_POG_VERSION",""))}function validate_divider(e,o,_,n){var t=n.X-n.W/2,i=n.X+n.W/2,a=n.Y+n.H/2,s=(n.Y,n.H,_+n.ItemInfo[g_item_index].H/2),g=_-n.ItemInfo[g_item_index].H/2,l="N";if("L"==e)l=o<t?"N":"Y";else if("R"==e)l=o>i?"N":"Y";else if("U"==e){var r=[],d=[],c=[],f=g_pog_json[0].ModuleInfo;for(const e of f){var I=0;for(const o of e.ShelfInfo){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType){var p=o.X-o.W/2,h=o.X+o.W/2;n.Y<o.Y&&(h>t&&p<=t||p<i&&p>=t)&&(r.push(o.Y-o.H/2-(n.Y+n.H/2)),d.push(I))}I++}0}var u=Math.min.apply(Math,r),m=r.findIndex((function(e){return e==u}));if(0!=r.length)if("HANGINGBAR"==g_pog_json[0].ModuleInfo[g_module_index].ShelfInfo[d[m]].ObjType||"ROD"==g_pog_json[0].ModuleInfo[g_module_index].ShelfInfo[d[m]].ObjType){var O=g_pog_json[0].ModuleInfo[g_module_index].ShelfInfo[d[m]].ItemInfo,S=0;for(const e of O)c.push(wpdSetFixed(e.Y-e.H/2)),d.push(S),S++;var P=Math.min.apply(Math,c);m=c.findIndex((function(e){return e==P}));l=P>s?"Y":"N"}else{l=g_pog_json[0].ModuleInfo[g_module_index].ShelfInfo[d[m]].Y-g_pog_json[0].ModuleInfo[g_module_index].ShelfInfo[d[m]].H/2>s?"Y":"N"}else l="Y"}else"D"==e&&(l=g<a?"N":"Y");return l}async function item_delist(){"Y"==g_all_pog_flag&&g_pog_json.length>1&&($s("P25_OPEN_POG_CODE",""),$s("P25_OPEN_POG_VERSION","")),$("#RESET").click();g_pog_json.length>0&&($s("P25_USED_ITEM","D"),g_open_productlist="D","Restore"==$(".a-Splitter-thumb").attr("aria-label")&&$(".a-Splitter-thumb").click(),apex.region("draggable_table").refresh())}async function save_delist_item(e){var o=[],_=apex.region("Item_list").widget().interactiveGrid("getViews").grid.model,n=apex.region("Item_list").widget().interactiveGrid("getViews").grid.getSelectedRecords();$.each(n,(function(e,t){var i={};i.ItemName=_.getValue(n[e],"ITEM"),""!==_.getValue(n[e],"SHELF").v?i.ShelfName=_.getValue(n[e],"SHELF").v:i.ShelfName=$v("P25_SELECT_FIXEL"),o.push(i)}));for(const _ of o)await create_delist_item_shelf(_.ItemName,_.ShelfName,e)}async function get_delist_item(e,o,_,n,t,i,a,s,g){if(void 0===g_pog_json[e].DeleteItems&&(g_pog_json[e].DeleteItems=[]),"N"==o){if("Y"==a){var l=g_pog_json[e].ModuleInfo[n],r=g_pog_json[e].ModuleInfo[n].ShelfInfo;if((null==l.ParentModule||void 0===l.ParentModule&&j==n)&&l.ShelfInfo.length>0){for(const o of r){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType){for(const _ of o.ItemInfo)g_delete_item_json.push(_),g_pog_json[e].DeleteItems.push(_)}0}}}else if("Y"==i){r=g_pog_json[e].ModuleInfo[n].ShelfInfo[_];for(const o of r.ItemInfo)g_pog_json[e].DeleteItems.push(o),g_delete_item_json.push(o)}else{var d=g_pog_json[e].ModuleInfo[n].ShelfInfo[_].ItemInfo[t];g_pog_json[e].DeleteItems.push(d),g_delete_item_json.push(d)}}else{for(const e of g)"ITEM"==e.Object&&(g_delete_item_json.push(g_pog_json[e.p_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex]),g_pog_json[e.p_pog_index].DeleteItems.push(g_pog_json[e.p_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex]))}const c=g_delete_item_json.filter(((e,o)=>g_delete_item_json.findIndex((o=>o.ItemID===e.ItemID))===o));g_delete_item_json=c}async function create_delist_item_shelf(e,o,_){var n=g_pog_json[_].ModuleInfo;if(e.length>0){g_cut_copy_arr=[],g_cut_support_obj_arr=[],g_cut_loc_arr=[],loc_details={},g_cut_action_done="N",g_copy_action_done="Y",g_dup_action_done="N",g_delete_action_done="N",g_multi_delete_done="N";var t,i="N",a=0;for(const o of g_delete_item_json){if(o.Item==e){void 0===o.ShelfInfo?(i="N",g_cut_copy_arr.push(o)):(i="Y",g_delete_details.push(o)),t=a;break}a++}"Y"==i?(g_multi_copy_done="Y",g_mselect_drag="N",g_multiselect="N",g_delete_details.StartCanvas=_,g_delete_details.g_present_canvas=_,g_delete_details.multi_delete_shelf_ind=""):(loc_details.MIndex=-1,loc_details.SIndex=-1,loc_details.IIndex=-1,loc_details.ModuleEdit="N",loc_details.ShelfEdit="N",loc_details.ItemEdit="Y",g_cut_loc_arr.push(loc_details),g_cut_copy_arr[0].loc_details=g_cut_loc_arr,g_cut_copy_arr[0].OldObjID=g_cut_copy_arr[0].ObjID,g_cut_copy_arr[0].ObjID="");a=0;for(const e of n){if(null==e.ParentModule||void 0===e.ParentModule){var s=0;for(const _ of e.ShelfInfo)"BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType&&"TEXTBOX"!==_.ObjType&&_.Shelf==o&&(g_module_index=a,g_shelf_index=s),s++}a++}if("Y"==await context_paste("COPY",g_camera,"N","Y",_)){await deleted_items_log(e,"A",_);g_delete_item_json.splice(t,1)}}}async function reset_canvas_region(){"N"==g_show_plano_rate||"Y"==g_open_productlist?($("#par_region").hide(),$("#draggable_table").show(),$("#wpdSplitter_splitter_second").css("overflow","hidden"),"Collapse"==$(".a-Splitter-thumb").attr("aria-label")&&null!==apex.region("draggable_table").widget()&&(apex.region("draggable_table").widget().interactiveGrid("getActions").set("edit",!1),apex.region("draggable_table").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("draggable_table").widget().interactiveGrid("getViews").grid.curInst._refreshGrid())):($("#draggable_table").hide(),$("#par_region").show(),$("#wpdSplitter_splitter_second").css("scrollbar-width","thin").css("overflow","auto")),"Collapse"!==$(".a-Splitter-thumb").attr("aria-label")&&(g_show_plano_rate="N",g_open_productlist="Y"),switchCanvasView($v("P25_POGCR_TILE_VIEW"),"Y")}function find_top_notch(e,o,_,n,t,i){var a=g_pog_json[i].ModuleInfo[e],s=g_pog_json[i].ModuleInfo[e].ShelfInfo[o];if(s.W==a.W){if(s.X>a.X-a.Y/2&&s.X<a.X+a.Y/2&&a.NotchSpacing>0&&"Y"==t){var g=get_notch_no(a,i,s.Y+s.H/2);s.NotchNo=g;var l=g_scene_objects[i].scene.children[2].getObjectById(s.SObjID);if(void 0!==l&&(l.NotchNo=g),-1==g){var r=g_pog_json[i].BaseH+a.NotchStart/2;if(_-s.H/2<g_pog_json[i].BaseH)var d=g_pog_json[i].BaseH+s.H/2;else if(_+s.H/2>r)d=g_pog_json[i].BaseH+a.NotchStart-s.H/2;else d=g_pog_json[i].BaseH+s.H/2;s.NotchNo=0}else if(g>0){if(1==g&&a.NotchStart>0&&_+s.H/2<g_pog_json[i].BaseH+a.NotchStart&&_+s.H/2>g_pog_json[i].BaseH)r=g_pog_json[i].BaseH+a.NotchStart/2;else r=g_pog_json[i].BaseH+a.NotchStart+a.NotchSpacing*g-a.NotchSpacing/2;if(_+s.H/2<g_pog_json[i].BaseH+a.NotchStart/2)d=g_pog_json[i].BaseH+s.H/2;else if(_+s.H/2<r)if("PEGBOARD"==s.ObjType)d=g_pog_json[i].BaseH+a.NotchStart+a.NotchSpacing*(g-1)-s.H/2;else d=g_pog_json[i].BaseH+a.NotchStart+a.NotchSpacing*(g-1)+s.H/2;else if(1==g&&a.NotchStart>0&&_+s.H/2<g_pog_json[i].BaseH+a.NotchStart&&_+s.H/2>g_pog_json[i].BaseH)d=g_pog_json[i].BaseH+a.NotchStart-s.H/2;else d=g_pog_json[i].BaseH+a.NotchStart+a.NotchSpacing*g-s.H/2}else if(0==g){r=g_pog_json[i].BaseH+a.NotchStart/2;if(a.NotchStart>0&&_+s.H/2>r){d=g_pog_json[i].BaseH+a.NotchStart-s.H/2;s.NotchNo=1}else{d=g_pog_json[i].BaseH+s.H/2;s.NotchNo=0}}if(-1==g||g>0||0==g)var c=a.X-a.W/2+s.W/2}}else d=-1,c=-1;return[d,c]}async function set_remarks(){var e,o;apex.server.process("GET_ITEM_JSON_FROM_COLL",{dataType:"html"}).done((async function(_){""!==$.trim(_)&&(e=_),await async function(){var _=0;for(const g of e){var n=e[_].Remarks,t=0;for(const e of g_pog_json){var i=0;for(const _ of e.ModuleInfo){if(null==_.ParentModule){var a=0;for(const e of _.ShelfInfo){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){var s=0;for(const _ of e.ItemInfo)_.ItemID==g.Item&&(g_pog_json[t].ModuleInfo[i].ShelfInfo[a].ItemInfo[s].Remarks=n,void 0!==(o=g_scene_objects[t].scene.children[2].getObjectById(_.ObjID))&&(o.Remarks=n)),s++}a++}}i++}t++}_++}}()}))}function maximizeItemFacings(e,o,_,n,t,i,a,s,g="N"){var l=g_pog_json[s].ModuleInfo[o],r=g_pog_json[s].ModuleInfo[o].ShelfInfo[_],d=g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n],c=findNearByShelfMaxDepth(o,_,n,n,-1,s),f=get_cap_max_merch(o,_,l,r,s,g_dft_max_merch),I=1,p=1,h=1,u=r.SpreadItem,m=r.HorizGap,O=d.NVal,S=void 0!==d.ItemNesting&&""!==d.ItemNesting?d.ItemNesting:"",P=d.HorizGap,E=0,v=0,D=void 0===d.CapHeight||""==d.CapHeight?-1:d.CapHeight,C=d.CapStyle,T=d.CapMaxH,b=0;if(("SHELF"==r.ObjType||"HANGINGBAR"==r.ObjType&&"Y"==g_auto_hangbar_facings||"PEGBOARD"==r.ObjType&&"Y"==r.AutoFillPeg||"CHEST"==r.ObjType)&&(""===d.TopObjID||void 0===d.TopObjID||""===d.BottomObjID||void 0===d.BottomObjID)&&"DIVIDER"!==d.Item){if("Y"==g_auto_cal_depth_fac&&("D"==e||"B"==e)){var j,N;N=0!==O&&""!==S&&"D"==d.ItemNesting?wpdSetFixed(d.RD-(d.BaseD-1)*O):wpdSetFixed(d.RD/d.BaseD);var x=nvl(d.MPogDepthFacings)>0?d.MPogDepthFacings:d.MDepthFacings;if("Y"==d.MDepthCrushed&&d.CrushD>0&&(N-=N*(d.CrushD/100)),c<(j="HANGINGBAR"==r.ObjType?0==r.MaxMerch||""==r.MaxMerch?g_hangbar_dft_maxmerch:r.MaxMerch:"PEGBOARD"==r.ObjType?0==r.MaxMerch||""==r.MaxMerch?g_pegboard_dft_item_depth:r.MaxMerch:"CHEST"==r.ObjType?r.BsktWallH:r.D))var M=j-c-N;if("F"!==u&&0==m&&0==P&&0!==O&&""!==S&&"D"==d.ItemNesting?(I=x<(I=Math.floor(100*M/(100*O))+1)&&x>-1?x:I,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].D=N+(I>0?I:1)*O):(I=x<(I=Math.floor(wpdSetFixed((j-(c<j?c:0))/N)))&&x>-1?x:I,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].D=wpdSetFixed(N*(I>0?I:1))),g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].RD=wpdSetFixed(d.RD/d.BaseD*(I>0?I:1)),"CHEST"==r.ObjType){var R=x<Math.trunc(r.BsktWallH/N)&&x>-1?x:Math.trunc(r.BsktWallH/N);g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].BaseD=R}else g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].BaseD=I>0?I:1;if("1"==C||"2"==C||"3"==C){var L=""==(U=g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n]).CapOrientaion?"4":U.CapOrientaion,[A,y,$]=get_cap_dim(U),[w,Y,G,H,F,B]=get_new_orientation_dim(L,A,y,$);"N"!=U.CapDepthChanged&&void 0!==U.CapDepthChanged||(g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].CapDepth=Math.trunc(d.RD/G))}}if(!("Y"!=g_max_facing_enabled&&"Y"!=g||"SHELF"!=r.ObjType||"H"!=e&&"B"!=e)){var V,k=nvl(d.MPogVertFacings)>0?d.MPogVertFacings:d.MVertFacings;if(h=k>-1?k:parseInt(t),"A"==a&&(h=k>-1&&k<parseInt(i)?k:parseInt(i)),g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].OldItemHeight=wpdSetFixed(g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].H),"F"!==u&&0==m&&0==P&&0!==O&&""!==S&&"H"==d.ItemNesting){var W=f-(V=wpdSetFixed(d.RH-(d.BVert-1)*O));(p=Math.floor(100*W/(100*O)))>h&&(p=h),g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].H=wpdSetFixed(V+(p>0?p:1)*O),g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].BVert=p>0?p+1:1,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].Y=wpdSetFixed(r.Y+r.H/2+g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].H/2),g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].RH=wpdSetFixed(V+(p>0?p:1)*O)}else{if(V=wpdSetFixed(d.RH/d.BVert),(p=Math.floor(100*f/(100*V)))>h&&(p=h),E=wpdSetFixed(f-V*(p>0?p:1)),v=wpdSetFixed(r.D-c-d.RD/d.BaseD),g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].H=wpdSetFixed(V*(p>0?p:1)),"0"!==C){if(E<0||v<0)g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].CapCount=0,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].CapFacing=0,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].CapHorz=0,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].CapDepth=0,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].CapHeight=0,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].CapTotalCount=0,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].H=wpdSetFixed(V*(p>0?p:1));else if(E>=D&&"1"==C?(g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].CapCount=1,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].CapFacing=1,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].H=wpdSetFixed(V*(p>0?p:1)+D)):E>=D&&"2"==C?(b=(b=Math.floor(100*E/(100*D)))>T&&T>0?T:b,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].CapCount=b>0?b:0,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].CapFacing=b>0?b:0,b>0&&(g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].H=wpdSetFixed(V*(p>0?p:1)+b*D))):"3"==C?(p=1,E=wpdSetFixed(f-g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].RH),b=(b=Math.floor(100*E/(100*D)))>T&&T>0?T:b,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].CapCount=b>0?b:0,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].CapFacing=b>0?b:0,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].H=wpdSetFixed(V*(p>0?p:1)+b*D)):(g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].CapCount=0,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].CapFacing=0,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].CapHorz=0,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].CapDepth=0,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].CapHeight=0,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].CapTotalCount=0),"1"==C||"2"==C||"3"==C){L=""==(U=g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n]).CapOrientaion?"4":U.CapOrientaion;var U,[A,y,$]=get_cap_dim(U),[w,Y,G,H,F,B]=get_new_orientation_dim(L,A,y,$);"N"!=U.CapDepthChanged&&void 0!==U.CapDepthChanged||(g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].CapDepth=Math.trunc(d.RD/G))}}else g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].H=wpdSetFixed(V*(p>0?p:1));g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].BVert=p>0?p:1,g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].Y=wpdSetFixed(r.Y+r.H/2+g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].H/2),g_pog_json[s].ModuleInfo[o].ShelfInfo[_].ItemInfo[n].RH=wpdSetFixed(V*(p>0?p:1))}}}}async function saveitem_depthremarks(e){var o,_=[],n=apex.region("item_depth_rem").widget().interactiveGrid("getViews","grid").model;""!=e?_=e.split("$,$"):n.forEach((function(e){"Y"!=n.getValue(e,"DEPTHCHNAGE")&&"Y"!=n.getValue(e,"REMARKSCHANGE")||_.push(n.getValue(e,"ITEM").toUpperCase()+"$##$"+n.getValue(e,"FIXEL").toUpperCase()+"$##$"+n.getValue(e,"ITEM_DEPTH")+"$##$"+n.getValue(e,"ITEM_REMARKS")+"$##$"+n.getValue(e,"ITEM_X"))}));var t=[],i=[],a=[],s=[],g="Y";for(var l of _){var r=l.split("$##$");if("Y"==g_all_pog_flag)var d=0;else d=g_pog_index;for(const e of g_pog_json){var c=0;for(const _ of e.ModuleInfo){if(null==_.ParentModule){var f=0;for(const e of _.ShelfInfo){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){var I=0;for(const _ of e.ItemInfo){var p=_.X.toFixed(2);if(_.ItemID==r[0]&&e.Shelf==r[1]&&parseFloat(p)==parseFloat(r[4].trim()))await update_item_facings(c,f,I,_.BHoriz,_.BVert,parseInt(r[2]),"depthfacing",!1,"N",d)?(g_pog_json[d].ModuleInfo[c].ShelfInfo[f].ItemInfo[I].BaseD=parseInt(r[2]),g_pog_json[d].ModuleInfo[c].ShelfInfo[f].ItemInfo[I].Remarks=r[3],g_pog_json[d].ModuleInfo[c].ShelfInfo[f].ItemInfo[I].DFacing=parseInt(r[2]),void 0!==(o=g_scene_objects[d].scene.children[2].getObjectById(_.ObjID))&&(o.Remarks=parseInt(r[3]),o.BaseD=r[2],o.DFacing=r[2])):g="N";I++}}f++}}c++}if("Y"!=g_all_pog_flag)break;d++}0}const h=[],u=new Map;for(var m of(_.forEach((e=>{const o=e.split("$##$");if(o.length>=4){const _=o[0],n=parseInt(o[2]),t=o[3];u.has(_)?n>u.get(_).value&&u.set(_,{value:n,remarks:t,string:e}):u.set(_,{value:n,remarks:t,string:e})}})),u.forEach((e=>{h.push(e.string)})),h)){var O=m.split("$##$");t.push(O[0]),i.push(O[1]),a.push(O[2]),s.push(O[3])}"Y"==g?async function(){var e=JSON.stringify([g_pog_json]);apex.server.process("UPDATE_DEPTHF_REMARKS",{f01:t,f03:a,f04:s,p_clob_01:e},{dataType:"text",success:function(e){""!=$.trim(e)?raise_error(e):(apex.region("item_depth_rem").widget().interactiveGrid("getActions").set("edit",!1),apex.region("item_depth_rem").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("item_depth_rem").refresh())},loadingIndicatorPosition:"none"})}():alert(get_message("INCREMENT_ERROR","Depth"))}function open_depth_facing_rmks(){try{if(logDebug("function : open_fixel","S"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0||"undefined"!=typeof g_pog_json_comp&&g_pog_json_comp.length>0){var e=JSON.stringify([g_pog_json[g_pog_index]]);apex.server.process("ADD_JSON_TO_COLL",{x01:"I",p_clob_01:e},{dataType:"text",success:function(e){""!=$.trim(e)?raise_error(e):(apex.region("item_depth_rem").widget().interactiveGrid("getActions").set("edit",!1),apex.region("item_depth_rem").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("item_depth_rem").refresh(),"Y"==g_all_pog_flag&&g_pog_json.length>1&&($s("P25_OPEN_POG_CODE",""),$s("P25_OPEN_POG_VERSION","")),openInlineDialog("item_depth_rem_dtl",75,70))},loadingIndicatorPosition:"page"})}}catch(e){error_handling(e)}}function update_depthfacing(){var e=[],o=[],_=[],n=[];if("Y"==g_all_pog_flag);else g_pog_index;for(const t of g_pog_json){for(const i of t.ModuleInfo){if(null==i.ParentModule){for(const t of i.ShelfInfo){if("BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&"TEXTBOX"!==t.ObjType){for(const i of t.ItemInfo)"Y"==i.DfacingUpd&&(e.push(i.Item),o.push(t.Shelf),_.push(i.BaseD),n.push(i.Remarks),i.DfacingUpd="N")}0}}0}if("Y"!=g_all_pog_flag)break;0}e.length>0&&"D"!==g_open_productlist&&deleted_items_log(e,"A",g_pog_index)}async function uploadImage(e){try{var o=document.getElementById("P25_UPLOAD_IMG"),_=$v("P25_OPEN_POG_CODE");if(0!==o.files.length){var n=o.files[0],t=new FileReader;validate_image_type(n.name)&&(t.onload=(i=n,function(e){if(i){var t=binaryArray2base64(e.target.result);console.log(t,"base64");var a=i.type;console.log(a),a;var s=[];s=clob2Array(t,3e4,s),apex.server.process("UPLOAD_IMAGE",{x01:n.name,x02:n.type,x03:_,f01:s},{dataType:"json",success:function(e){console.log("data",e),"success"==e.result?(o.value="",logDebug("function : uploadFile","E")):alert(get_message("INTERNAL_ERROR"))},loadingIndicatorPosition:"page"})}}),t.readAsArrayBuffer(n))}}catch(e){error_handling(e)}var i}function validate_image_type(e){try{return!!/(\.jpeg|\.jpg|\.png)$/i.exec(e)||(alert(get_message("INVALID_FILE_TYPE",e)),!1)}catch(e){error_handling(e)}}async function set_status(){apex.server.process("SET_STATUS_BAR",{pageItems:"#P25_POGCR_ITEM_DESC_LIST,#P25_POGCR_FIXEL_DESC_LIST,#P25_POGCR_MODULE_DESC_LIST,#P25_POGCR_POG_DESC_LIST"},{dataType:"html"}).done((async function(e){if(""!==$.trim(e)){g_status_bar=JSON.parse(e);if(g_status_bar.keySort({label_type:"asc",Seq:"asc"}),g_hide_show_dos_label=g_status_bar.filter((e=>"D"===e.label_type)).map((e=>e.Param+":"+e.label)).join(","),"Y"==g_all_pog_flag)var o=0;else o=g_pog_index;for(const e of g_pog_json){if((o!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex)&&"Y"==g_show_days_of_supply&&(await showHideDaysOfSupplyLabel(g_show_days_of_supply,"N",o,"Y","Y",$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label),"POG"==g_compare_view&&"Y"==g_compare_pog_flag&&await showHideDaysOfSupplyLabel(g_show_days_of_supply,"N",g_ComViewIndex,"Y","Y",$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),$v("P25_POGCR_ITEM_DETAIL_LIST"))),"Y"!=g_all_pog_flag)break;o++}}}))}async function getconfirm_shelfmove(e){var o="N";if("Y"==$v("P25_POGCR_COMBINATION_SHELF")&&g_delete_details.length>0)for(const t of g_delete_details)if("SHELF"==g_pog_json[e].ModuleInfo[t.MIndex].ShelfInfo[t.SIndex].ObjType||"HANGINGBAR"==g_pog_json[e].ModuleInfo[t.MIndex].ShelfInfo[t.SIndex].ObjType){var[_,n]=getCombinationShelf(e,g_pog_json[e].ModuleInfo[t.MIndex].ShelfInfo[t.SIndex].Shelf);if(-1!==_&&-1!==n){o="Y";break}}return"Y"==o?new Promise(((e,o)=>{confirm(get_message("POGCR_SHELF_MOVE_COMBINATION"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){e("Y")}),(function(){e("N")}))})):"Y"}async function check_caprpark_inpog(){return new Promise((e=>{if("Y"==g_all_pog_flag)var o=0;else o=g_pog_index;var _="";for(const s of g_pog_json){for(const e of g_pog_json[o].ModuleInfo){for(const s of e.ShelfInfo){if("DIVIDER"!==s.ObjType&&"TEXTBOX"!==s.ObjType&&"NOTCH"!==s.ObjType&&"CHEST"!==s.ObjType&&"BASE"!==s.ObjType){var[n,t,i,a]=get_curr_module(s.X,s.Y,"N",e,s,s,o);"N"==t&&(_=_+(""!==_?", ":"")+s.Shelf)}0}0}if("Y"!=g_all_pog_flag)return void e(_);o++}e(_)}))}function create_divider_iteminfo(e,o,_){var n={};return n.ItemID=_.Shelf,n.Item="DIVIDER",n.W=_.DivWidth,n.H=_.DivHeight,n.D=_.D,n.Color=_.DivFillCol,n.DimT="",n.Desc=_.Desc,n.CType="SHELF",n.Shelf=_.Shelf,n.Barcode="",n.LocID="",n.PegID="",n.PegSpread="",n.PegPerFacing="",n.Fixed="N",n.CapStyle="",n.CapFacing="",n.CapMerch="",n.CapOrientaion="",n.CapHeight="",n.Rotation=_.Rotation,n.BHoriz=1,n.BVert=1,n.BaseD=1,n.CrushHoriz=0,n.CrushVert=0,n.CrushD=0,n.Orientation="0",n.MerchStyle="0",n.Supplier="",n.Brand="",n.BrandType="",n.Group="",n.Dept="",n.ObjID="",n.Class="",n.SubClass="",n.StdUOM="",n.SizeDesc="",n.Price="",n.Cost="",n.RegMovement="",n.RegMovementInd="",n.DaysOfSupplyInd="",n.MoveBasis="",n.AvgSales="",n.AvgSalesInd="",n.ItemStatus="",n.CDTLvl1="",n.CDTLvl2="",n.CDTLvl3="",n.OldItemHeight=_.DivHeight,n.CHPerc=0,n.CWPerc=0,n.CDPerc=0,n.ItemNesting=0,n.NVal=0,n.ItemContain=0,n.CnVal=0,n.IsContainer="N",n.BsktFactor=0,n.OverHang=0,n.HorizGap=0,n.VertGap=0,n.UW=0,n.UH=0,n.UD=0,n.CW=0,n.CH=0,n.CD=0,n.TW=0,n.TH=0,n.TD=0,n.DW=0,n.DH=0,n.DD=0,n.CnW=0,n.CnH=0,n.CnD=0,n.NW=0,n.NH=0,n.ND=0,n.OrgUW=0,n.OrgUH=0,n.OrgUD=0,n.OrgCW=0,n.OrgCH=0,n.OrgCD=0,n.OrgTW=0,n.OrgTH=0,n.OrgTD=0,n.OrgDW=0,n.OrgDH=0,n.OrgDD=0,n.OrgCHPerc=0,n.OrgCWPerc=0,n.OrgCDPerc=0,n.OrgCnW=0,n.OrgCnH=0,n.OrgCnD=0,n.OrgNW=0,n.OrgNH=0,n.OrgND=0,n.SIndex=g_pog_json[e].ModuleInfo[o].ShelfInfo.length+1,n.Dragged="N",n.Quantity=1,n.X="",n.Y="",n.Z=.001,n.SlotDivider="N",n.ImgExists="N",n.CapCount=0,n.Exists="E",n.OW=_.DivWidth,n.OH=_.DivHeight,n.OD=_.D,n.DivStX=_.DivStX,n.Distance="",n.YDistance="",n.SpreadItem=0,n.MHorizCrushed="N",n.MVertCrushed="N",n.MDepthCrushed="N",n.MCapTopFacing="N",n.RW=_.DivWidth,n.RH=_.DivHeight,n.RD=_.D,n.LObjID=-1,n.SubLblObjID=-1,n.DimUpdate="N",n.TopObjID="",n.BottomObjID="",n.SecondTier="",n.CompItemObjID="",n.SellingPrice="",n.ShelfPrice="",n.PromoPrice="",n.DiscountRate="",n.PriceChangeDate="",n.WeeksOfInventory="",n.Qty="",n.WhStock="",n.StoreStock="",n.StockIntransit="",n.SalesUnit="",n.NetSales="",n.CogsAdj="",n.CogsAdjInd="",n.GrossProfit="",n.GrossProfitInd="",n.WeeksCount="",n.WeeksCountInd="",n.MovingItem="",n.Profit="",n.TotalMargin="",n.MHorizFacings=-1,n.MVertFacings=-1,n.MDepthFacings=-1,n.OrientationDesc="Front 0",n.StoreCnt="",n.CapMaxH="",n.MaxHCapStyle="",n.NewYN="",n.Delist="N",n.DescSecond="",n.NewPegId="",n.OverhungItem="N",n.AutoDiv="Y",n.ItemCondition="",n.AUR="",n.ItemRanking="",n.WeeklySales="",n.WeeklyNetMargin="",n.WeeklyQty="",n.NetMarginPercent="",n.CumulativeNM="",n.TOP80B2="",n.ItemBrandC="",n.ItemPOGDept="",n.ItemRemark="",n.RTVStatus="",n.Pusher="",n.Divider="",n.BackSupport="",n.OOSPerc="",n.InitialItemDesc="",n.InitialBrand="",n.InitialBarcode="",n}function create_div_shelfinfo(e,o,_){var n={};return n.Shelf=_.Shelf,n.ObjType="DIVIDER",n.Desc="",n.MaxMerch=0,n.GrillH=0,n.LOverhang=0,n.ROverhang=0,n.SpacerThick=0,n.HorizGap=0,n.SpreadItem="L",n.Combine="N",n.AllowAutoCrush="N",n.H=_.DivHeight,n.W=_.DivWidth,n.D=_.D,n.Rotation=0,n.Slope=0,n.Color=_.DivFillCol,n.LiveImage="",n.HorizSlotStart=0,n.HorizSlotSpacing=0,n.HorizStart=0,n.HorizSpacing=0,n.UOverHang=0,n.LoOverHang=0,n.VertiStart=0,n.VertiSpacing=0,n.X=g_pog_json[e].ModuleInfo[o].X-g_pog_json[e].ModuleInfo[o].W/2+parseFloat($v("P25_DIV_WIDTH"))/100/2,n.Y=g_pog_json[e].ModuleInfo[o].Y+g_pog_json[e].ModuleInfo[o].H/2+parseFloat($v("P25_DIV_HEIGHT"))/100/2,n.Z=_.Z,n.InputText="",n.WrapText="",n.ReduceToFit="",n.TextDirection="",n.BsktFill="",n.BsktSpreadProduct="",n.SnapTo="",n.BsktWallH=0,n.BsktBaseH=0,n.BsktWallThickness=0,n.DSlotStart=0,n.DSlotSpacing=0,n.DGap=0,n.FrontOverHang=0,n.BackOverHang=0,n.SlotDivider="",n.AutoPlacing="",n.AutoFillPeg="N",n.SlotOrientation="",n.DividerFixed="N",n.LObjID=-1,n.NotchLabelObjID=-1,n.FStyle="",n.FSize="",n.FBold="",n.TextImg="",n.TextImgName="",n.TextImgMime="",n.ItemInfo=[],n.Overhung="N",n.DivHeight=_.DivHeight,n.DivWidth=_.DivWidth,n.DivPst=_.DivPst,n.DivPed=_.DivPed,n.DivPbtwFace=_.DivPbtwFace,n.DivStX=_.DivStX,n.DivSpaceX=_.DivSpaceX,n.DivFillCol=_.DivFillCol,n.DivCount=_.DivCount,n.DivCheck=_.DivCheck,n.NoDivIDShow=_.NoDivIDShow,n}async function create_shelf_dividers(e,o,_){var n=0,t=g_pog_json[e].ModuleInfo[o].ShelfInfo[_],i=t.HorizGap,a=i,s=(t.SpreadItem,t.ItemInfo),g=(n=0,0);if("Y"==t.DivPbtwFace&&t.DivHeight>0&&t.DivWidth>0){for(var l=[],r=[],d=0;d<s.length;d++){if("DIVIDER"===(P=s[d]).Item){l.push(d),r.push(P.ObjID);var c=g_world.getObjectById(P.ObjID);g_world.remove(c)}}for(n=l.length-1;n>=0;n--){var f=l[n];g_pog_json[e].ModuleInfo[o].ShelfInfo[_].ItemInfo.splice(f,1)}d=0;for(var I of r){var p=0;for(var h of g_pog_json[e].ModuleInfo[o].ShelfInfo)"DIVIDER"===h.ObjType&&I==h.ShelfDivObjID&&g_pog_json[e].ModuleInfo[o].ShelfInfo.splice(p,1),p++;0}var u=t.ItemInfo.length,m="";for(P of g_pog_json[e].ModuleInfo[o].ShelfInfo)console.log(P.Shelf,P.ObjType,n),-1!==P.Shelf.indexOf("/")&&(console.log("after if",P.Shelf.substring(P.Shelf.indexOf("/")+1)),""==m?m=parseInt(P.Shelf.substring(P.Shelf.indexOf("/")+1)):(m=Math.max(m,parseInt(P.Shelf.substring(P.Shelf.indexOf("/")+1))),console.log("inside ",Math.max(m,parseInt(P.Shelf.substring(P.Shelf.indexOf("/")+1)))))),n++;if(m=""==m?1:m+1,"Y"==t.DivPst){var O=create_divider_iteminfo(e,o,t);Math.floor(999999*Math.random());O.ItemID=o+1+"/"+m,O.Fixed="N",g_pog_json[e].ModuleInfo[o].ShelfInfo[_].ItemInfo.splice(g,0,O),(S=create_div_shelfinfo(e,o,t)).Shelf=o+1+"/"+m,S.DivShelf=t.Shelf,m+=1,g_pog_json[e].ModuleInfo[o].ShelfInfo.push(S),g=1}if("Y"==t.DivPbtwFace)for(n=0;n<u-1;n++){d=0;for(P of s){if("DIVIDER"!==P.Item&&d>g&&d<t.ItemInfo.length-1||d==t.ItemInfo.length-1){g="Y"==t.DivPst&&1==g||0==g?d:d+1,(O=create_divider_iteminfo(e,o,t)).ItemID=o+1+"/"+m,O.Fixed="N",g_pog_json[e].ModuleInfo[o].ShelfInfo[_].ItemInfo.splice(g,0,O),(S=create_div_shelfinfo(e,o,t)).Shelf=o+1+"/"+m,S.DivShelf=t.Shelf,m+=1,g_pog_json[e].ModuleInfo[o].ShelfInfo.push(S);break}d++}}if("Y"==t.DivPed){var S;O=create_divider_iteminfo(e,o,t),Math.floor(999999*Math.random());O.ItemID=o+1+"/"+m,O.Fixed="N",g_pog_json[e].ModuleInfo[o].ShelfInfo[_].ItemInfo.splice(t.ItemInfo.length+1,0,O),(S=create_div_shelfinfo(e,o,t)).Shelf=o+1+"/"+m,S.DivShelf=t.Shelf,m+=1,g_pog_json[e].ModuleInfo[o].ShelfInfo.push(S)}}else if("N"==t.DivPbtwFace){for(l=[],r=[],d=0;d<s.length;d++){var P;if("DIVIDER"===(P=s[d]).Item){l.push(d),r.push(P.ObjID);c=g_world.getObjectById(P.ObjID);g_world.remove(c)}}for(n=l.length-1;n>=0;n--){f=l[n];g_pog_json[e].ModuleInfo[o].ShelfInfo[_].ItemInfo.splice(f,1)}d=0;for(var I of r){p=0;for(var h of g_pog_json[e].ModuleInfo[o].ShelfInfo)"DIVIDER"===h.ObjType&&I==h.ShelfDivObjID&&g_pog_json[e].ModuleInfo[o].ShelfInfo.splice(p,1),p++;0}}var E=0,v=0;for(const e of s)E+=e.W,v+=1;if(t.ItemInfo.length>0)if(E>t.W)var D=0;else D=(t.W-E)/(v-1);else D=(t.W-E)/v;for(const e of s)e.SpreadItem=D;n=0;for(const g of s){var C=get_item_xaxis(g.W,g.H,g.D,g.CType,-1,a,"E",i,o,_,n,"Y",s.length,"N",e);g.X=C;var[T,b]=get_item_xy(t,g,g.W,g.H,e);g.Y=b,n++}if(await update_item_distance(o,_,e),reorder_items(o,_,e)){n=0;for(const t of s){C=get_item_xaxis(t.W,t.H,t.D,t.CType,-1,a,"E",i,o,_,n,"Y",s.length,"N",e);for(shelf_info of(t.X=C,g_pog_json[e].ModuleInfo[o].ShelfInfo))shelf_info.Shelf==t.ItemID&&"DIVIDER"==t.Item&&(shelf_info.X=C,shelf_info.Y=t.Y);n++}}}function remove_shelf_dividers(e,o,_){for(var n=g_pog_json[e].ModuleInfo[o].ShelfInfo.length-1;n>=0;n--)g_pog_json[e].ModuleInfo[o].ShelfInfo[n].DivShelf==_&&g_pog_json[e].ModuleInfo[o].ShelfInfo.splice(n,1)}function bulk_edit_color(){if(logDebug("function : bulk_edit_color","S"),g_delete_details.length>0||"Y"==g_item_edit_flag){const e=g_delete_details.filter((e=>"ITEM"===e.Object)),o=g_delete_details.filter((e=>"SHELF"===e.Object));o.length>0?setIconForInconsistentTag(o,"Color","P25_COMMON_COLOR","S"):e.length>0&&setIconForInconsistentTag(e,"Color","P25_COMMON_COLOR","I"),openInlineDialog("EDIT_COLOR",30,25),g_dblclick_opened="Y"}logDebug("function : bulk_edit_color","E")}function highlight_validation(e="N"){return""==$v("P25_CONDITION_NAME")?($s("P25_VALIDATION_CHECK","N"),alert(get_message("POGCR_HIGHLIGHT_CONDITION_NAME")),!1):"N"!=e||(""!==$v("P25_HG_LOV_VALUES")||"Brand_Category"!=$v("P25_FIELD")&&"ItemStatus"!=$v("P25_FIELD")&&"Gobecobrand"!=$v("P25_FIELD")&&"Internet"!=$v("P25_FIELD"))&&(""!==$v("P25_VALUE")||"Brand_Category"===$v("P25_FIELD")&&"ItemStatus"===$v("P25_FIELD")&&"Gobecobrand"===$v("P25_FIELD")&&"Internet"===$v("P25_FIELD"))||"!==''"===$v("P25_OPERATOR")||"==''"===$v("P25_OPERATOR")?""==$v("P25_FORMULA")&&"Y"==e?($s("P25_VALIDATION_CHECK","N"),alert(get_message("POGCR_HIGHLIGHT_FORMULA_CHECK")),!1):($s("P25_VALIDATION_CHECK","Y"),!0):($s("P25_VALIDATION_CHECK","N"),alert(get_message("POGCR_HIGHLIGHT_VALUE_CHECK")),!1)}async function add_highlight_prefrence(){return logDebug("function : add_highlight_prefrence"),new Promise((function(e,o){apex.server.process("SET_HIGHLIGHTS",{x08:$v("P25_HIGHLIGHT_NAME")},{dataType:"text",success:function(o){if(""!=$.trim(o))alert(o);else{for(apex.region("condition_rgn").refresh(),apex.event.trigger("#P25_HIGHLIGHT_PREFERENCE","apexrefresh"),closeInlineDialog("higlight_name"),n=0;n<g_highlightArr.length;n++)"N"===g_highlightArr[n].CHECK&&(g_highlightArr[n].CHECK="Y");e("success"),logDebug("function : add_highlight_prefrence","E")}}})}))}function delete_prefrence(){confirm(get_message("DELETE_CONFIRM_MSG"),get_global_ind_values("AI_CONFIRM_OK_TEXT"),get_global_ind_values("AI_CONFIRM_CANCEL_TEXT"),(function(){apex.server.process("DELETE_PREFRENCE",{x01:$v("P25_HIGHLIGHT_PREFERENCE")},{dataType:"text",success:function(e){""!=$.trim(e)?raise_error(e):(apex.event.trigger("#P25_HIGHLIGHT_PREFERENCE","apexrefresh"),apex.region("condition_rgn").refresh(),logDebug("function : delete_pog_list","E"))},loadingIndicatorPosition:"page"})}))}async function open_in_new_clone_tab(e,o,_){try{return console.log("open",e),new Promise((function(n,t){if("D"==_){var a=[],s=[],g=[];g_canvas_objects=[],g_scene_objects=[],g_pog_json_data=[];var l=[];if(null!==sessionStorage.getItem("draft_pog_list"))var r=JSON.parse(sessionStorage.getItem("draft_pog_list"));for(const e of r)a.push(e.SequenceID),g.push(e.DescriptionDetails),s.push(e.DraftVersion);i=0;for(const e of a)0==i?l.push(e):window.open("f?p="+$v("pFlowId")+":25:"+$v("pInstance")+":APEX_CLONE_SESSION:NO::P25_OPEN_NEW_TAB,P25_PRODUCT_BTN_CLICK,P25_DRAFT_LIST,P25_POG_DESCRIPTION,P25_EXISTING_DRAFT_VER,P25_POG_IND:Y,N,"+a[i]+","+g[i]+","+s[i]+",D"),i+=1;if(l.length>0){g_pog_index=0,g_multi_pog_json=[],appendMultiCanvasRowCol(1);var d=[],c={};c.SequenceID=a[0],c.DescriptionDetails=g[0],c.DraftVersion=s[0],d.push(c),open_draft_pog(o,JSON.stringify(d),"M")}}else{var f=[],I=[],p=[];g_canvas_objects=[],g_scene_objects=[],g_pog_json_data=[];l=[];for(const o of e)f.push(o.POGCode),I.push(o.POGVersion),p.push(o.IsRealPOG);i=0;for(const e of f)0==i?l.push(e):window.open("f?p="+$v("pFlowId")+":25:"+$v("pInstance")+":APEX_CLONE_SESSION:NO::P25_OPEN_NEW_TAB,P25_PRODUCT_BTN_CLICK,P25_NEW_TAB_POG_CODE,P25_NEW_TAB_POG_VERSION,P25_POG_IND:Y,N,"+f[i]+","+I[i]+",E"),i+=1;l.length>0&&(g_pog_index=0,g_multi_pog_json=[],addLoadingIndicator(),appendMultiCanvasRowCol(1),$s("P25_OPEN_POG","Y"),$s("P25_OPEN_POG_CODE",l[0]),$s("P25_OPEN_POG_VERSION",I[0]),get_existing_pog(l[0],I[0],0,o),removeLoadingIndicator(regionloadWait))}}))}catch(e){error_handling(e)}}async function refresh_items(){logDebug("function : refresh_items;");try{if(g_pog_json.length>0){if(addLoadingIndicator(),"Y"==g_all_pog_flag)var e=0;else e=g_pog_index;var o=[];for(const h of g_pog_json){var _=0,n=await update_pog_json(e);g_pog_json[e]=JSON.parse(n)[0],g_overhung_shelf_active="Y";for(const n of g_pog_json[e].ModuleInfo){if(void 0===n.ParentModule||null==n.ParentModule){var t=0,i="N";for(const I of n.ShelfInfo){if("BASE"!==I.ObjType&&"NOTCH"!==I.ObjType&&"DIVIDER"!==I.ObjType&&"TEXTBOX"!==I.ObjType&&I.ItemInfo.length>0){I.RefreshItem="N",await update_item_distance(_,t,e,"N");var a=0;for(const n of I.ItemInfo){if("DIVIDER"!==n.Item){n.NetSales=void 0!==n.NetSales&&""!==n.NetSales?parseFloat(n.NetSales):0,n.NVal=void 0!==n.NVal&&""!==n.NVal&&null!==n.NVal?n.NVal:0;var s=await update_item_max_facings(_,t,a,e),g="N";("1"!=n.CapStyle&&"2"!=n.CapStyle&&"3"!=n.CapStyle||"SHELF"!=I.ObjType)&&"W"!=n.ItemNesting&&"H"!=n.ItemNesting&&"D"!=n.ItemNesting||(g="Y");var[l,r,d,c]=await check_crush_perc(n);if("Y"==l&&("Y"==c&&("H"==r?n.CrushVert=d:"W"==r?n.CrushHoriz=d:"D"==r&&(n.CrushD=d)),s="N"),check_dim_difference(_,t,a,e)||"N"==s||"Y"==g){var f;if(n.CWPerc=n.OrgCWPerc,n.CHPerc=n.OrgCHPerc,n.CDPerc=n.OrgCDPerc,n.Exists="N","N"==n.MHorizCrushed&&(n.CrushHoriz=0),"N"==n.MVertCrushed&&(n.CrushVert=0),"N"==n.MDepthCrushed&&(n.CrushD=0),dim_update_pass=await item_dimension_update(_,t,a,e),i="Y","N"==dim_update_pass)(f={ErrorCode:"DIM"}).Item=n.Item,f.PIndex=e,f.MIndex=_,f.SIndex=t,f.IIndex=a,o.push(f);if("N"==s)i="Y",(f={ErrorCode:"FACING"}).Item=n.Item,f.PIndex=e,f.MIndex=_,f.SIndex=t,f.IIndex=a,o.push(f)}}a++}"Y"==i&&(I.RefreshItem="Y")}t++}}_++}var I=g_overhung_shelf_active=g_scene_objects[e].Indicators.OverhungShelf,p=g_all_pog_flag;if(g_overhung_shelf_active="N",g_all_pog_flag="N",await identifyOverhungItems(e,"N","N"),g_overhung_shelf_active=I,g_all_pog_flag=p,console.log("g_errored_items",g_errored_items),g_errored_items.length>0){await correct_pog_errors("A","N",e,"Y");for(const o of g_errored_items)g_pog_json[e].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex].RefreshItem="Y"}_=0;for(const o of g_pog_json[e].ModuleInfo){if(void 0===o.ParentModule||null==o.ParentModule){t=0,i="N",t=0;for(const n of o.ShelfInfo){if("BASE"!==n.ObjType&&"NOTCH"!==n.ObjType&&"DIVIDER"!==n.ObjType&&"TEXTBOX"!==n.ObjType&&"Y"==n.RefreshItem&&reorder_items(_,t,e))await recreate_all_items(_,t,n.ObjType,"Y",-1,-1,n.ItemInfo.length,"Y","N",-1,-1,e,"N",e,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y");t++}}_++}await calculateFixelAndSupplyDays("N",e);if(g_errored_items=[],render(e),"Y"!=g_all_pog_flag)break;e++}removeLoadingIndicator(regionloadWait),apex.message.showPageSuccess(g_pog_refresh_msg)}}catch(e){error_handling(e)}}async function item_dimension_update(e,o,_,n){logDebug("function : item_dimension_update; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+_,"S");try{var t=g_pog_json[n].ModuleInfo[e].ShelfInfo[o].ItemInfo[_],i="Y",a=0;""!==t.ItemNesting&&("W"==t.ItemNesting?a=t.OrgNW:"H"==t.ItemNesting?a=t.OrgNH:"D"==t.ItemNesting&&(a=t.OrgND));var[s,g,l]=get_select_dim(t);if(t.WChanged="N",t.HChanged="N",t.DChanged="N",s>0)var[r,d,c,f,I,p]=set_dim_validate_item(e,o,_,s,g,l,t.ItemNesting,a,t.BHoriz,t.BVert,t.BaseD,t.Orientation,t.OrgCWPerc,t.OrgCHPerc,t.OrgCDPerc,"N","Y","N",n,"Y");else i="N";"ERROR"!==r?t.DimUpdate="Y":(i="N",t.W=s*t.BHoriz+t.HorizGap/100*(t.BHoriz-1),t.H=g*t.BVert+t.VertGap/100*(t.BVert-1),t.D=l*t.BaseD,t.RW=t.W,t.RH=t.H,t.RD=t.D,r=f=t.W,d=I=t.H,c=p=t.D),t.OW=s,t.OH=g,t.OD=l,update_item_org_dim(e,o,_,r,d,c,f,I,p,n),await maximizeItemDepthFacings("D",e,o,_,n);var[h,u]=get_item_xy(g_pog_json[n].ModuleInfo[e].ShelfInfo[o],t,r,d,n);return t.Y=u,logDebug("function : item_dimension_update","E"),i}catch(e){error_handling(e)}}async function check_crush_perc(e){var[o,_,n,t,i,a]=get_new_orientation_dim(e.Orientation,e.W,e.H,e.D),s="N",g="",l="",r="N";return"H"==t&&e.CHPerc<e.CrushVert&&e.CrushVert>0?(s="Y",l="H",g=e.CHPerc,r="Y"==e.MVertCrushed?"Y":"N"):"W"==t&&e.CWPerc<e.CrushVert&&e.CrushVert>0?(s="Y",l="H",g=e.CWPerc,r="Y"==e.MHorizCrushed?"Y":"N"):"D"==t&&e.CDPerc<e.CrushVert&&e.CrushVert>0&&(s="Y",l="H",g=e.CDPerc,r="Y"==e.MDepthCrushed?"Y":"N"),"W"==i&&e.CWPerc<e.CrushHoriz&&e.CrushHoriz>0?(s="Y",l="W",g=e.CWPerc,r="Y"==e.MHorizCrushed?"Y":"N"):"H"==i&&e.CHPerc<e.CrushHoriz&&e.CrushHoriz>0?(s="Y",l="W",g=e.CHPerc,r="Y"==e.MVertCrushed?"Y":"N"):"D"==i&&e.CDPerc<e.CrushHoriz&&e.CrushHoriz>0&&(s="Y",l="W",g=e.CDPerc,r="Y"==e.MDepthCrushed?"Y":"N"),"D"==a&&e.CDPerc<e.CrushD&&e.CrushD>0?(s="Y",l="D",g=e.CDPerc,r="Y"==e.MDepthCrushed?"Y":"N"):"H"==a&&e.CHPerc<e.CrushD&&e.CrushD>0?(s="Y",l="D",g=e.CHPerc,r="Y"==e.MVertCrushed?"Y":"N"):"W"==a&&e.CWPerc<e.CrushD&&e.CrushD>0&&(s="Y",l="D",g=e.CWPerc,r="Y"==e.MHorizCrushed?"Y":"N"),[s,l,g,r]}async function update_item_max_facings(e,o,_,n){logDebug("function : update_item_max_facings; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+_,"S");try{var t=g_pog_json[n].ModuleInfo[e].ShelfInfo[o].ItemInfo[_],i="Y",a=nvl(t.MPogHorizFacings)>0?t.MPogHorizFacings:t.MHorizFacings,s=nvl(t.MPogVertFacings)>0?t.MPogVertFacings:t.MVertFacings,g=nvl(t.MPogDepthFacings)>0?t.MPogDepthFacings:t.MDepthFacings;return a<t.BHoriz&&a>-1&&(t.BHoriz=a,i="N"),s<t.BVert&&s>-1&&(t.BVert=s,i="N"),g<t.BaseD&&g>-1&&(t.BaseD=g,i="N"),g>t.BaseD&&(maximizeItemDepthFacings("D",e,o,_,n),i="N"),logDebug("function : update_item_max_facings","E"),i}catch(e){error_handling(e)}}function add_highlight_condition(){try{highlight_validation("Y")&&(1==parseInt($v("P25_DUPLICATE_COUNT"))?alert(get_message("POGC_DUPLICATE_CONDITION")):""!==$v("P25_HIGHLIGHT_PREFERENCE")?confirm(get_message("POGCR_ADD_SEL_HGLT_PREF"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){apex.server.process("MODIFY_HIGHLIGHT_PREFERENCE",{x01:$v("P25_HIGHLIGHT_PREFERENCE"),x02:$v("P25_CONDITION_NAME"),x03:$v("P25_FIELD"),x04:$v("P25_VALUE"),x05:$v("P25_BACKGROUND_COLOR"),x06:$v("P25_OPERATOR"),x07:$v("P25_CONDITION"),x08:"Y",x09:"A",x10:$v("P25_VALIDATION_CHECK")},{dataType:"text",success:function(e){var o=e.split(",");$s("P25_HIG_SE_ID",o[1].trim()),updateHighlightArr($v("P25_CONDITION_NAME"),"Y"),apex.region("condition_rgn").refresh()}})}),(function(){apex.server.process("MODIFY_HIGHLIGHT_PREFERENCE",{x01:$v("P25_HIGHLIGHT_PREFERENCE"),x02:$v("P25_CONDITION_NAME"),x03:$v("P25_FIELD"),x04:$v("P25_VALUE"),x05:$v("P25_BACKGROUND_COLOR"),x06:$v("P25_OPERATOR"),x07:$v("P25_CONDITION"),x08:"N",x09:"A",x10:$v("P25_VALIDATION_CHECK")},{dataType:"text",success:function(e){var o=e.split(",");$s("P25_HIG_SE_ID",o[1].trim()),updateHighlightArr($v("P25_CONDITION_NAME"),"N"),apex.region("condition_rgn").refresh()}})})):apex.server.process("MODIFY_HIGHLIGHT_PREFERENCE",{x01:"",x02:$v("P25_CONDITION_NAME"),x03:$v("P25_FIELD"),x04:$v("P25_VALUE"),x05:$v("P25_BACKGROUND_COLOR"),x06:$v("P25_OPERATOR"),x07:$v("P25_CONDITION"),x08:"N",x09:"A",x10:$v("P25_VALIDATION_CHECK")},{dataType:"text",success:function(e){var o=e.split(",");$s("P25_HIG_SE_ID",o[1].trim()),updateHighlightArr($v("P25_CONDITION_NAME"),"N"),apex.region("condition_rgn").refresh()}}))}catch(e){error_handling(e)}}function addConditionToHighPref(){try{$s("P25_STATUS","Y");var e=!1;for(n=0;n<g_highlightArr.length;n++)if("N"==g_highlightArr[n].CHECK){e=!0;break}e&&""!==$v("P25_HIGHLIGHT_PREFERENCE")?confirm(get_message("POGCR_ADD_SELECT_HIGHLIGHT_PREFERENCE"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){apex.server.process("MODIFY_HIGHLIGHT_PREFERENCE",{x01:$v("P25_HIGHLIGHT_PREFERENCE"),x02:"Y",x09:"S"},{dataType:"text",success:function(e){""!=$.trim(e)?(alert(get_message("POGC_DUPLICATE_CONDITION")),$s("P25_HIGHLIGHT_PREFERENCE","")):(apex.region("condition_rgn").refresh(),""==$v("P25_HIGHLIGHT_PREFERENCE")&&($s("P25_CONDITION_NAME",""),$s("P25_VALUE",""),$s("P25_BACKGROUND_COLOR",""),$s("P25_PRIORITY",""),$s("P25_FORMULA",""),$s("P25_FORMULA_CODE","")))}})}),(function(){apex.server.process("MODIFY_HIGHLIGHT_PREFERENCE",{x01:$v("P25_HIGHLIGHT_PREFERENCE"),x02:"N",x09:"S"},{dataType:"text",success:function(e){""!=$.trim(e)?alert(get_message("POGC_DUPLICATE_CONDITION")):(apex.region("condition_rgn").refresh(),""==$v("P25_HIGHLIGHT_PREFERENCE")&&($s("P25_STATUS","N"),$s("P25_CONDITION_NAME",""),$s("P25_VALUE",""),$s("P25_BACKGROUND_COLOR",""),$s("P25_PRIORITY",""),$s("P25_FORMULA",""),$s("P25_FORMULA_CODE","")))}})})):apex.server.process("MODIFY_HIGHLIGHT_PREFERENCE",{x01:$v("P25_HIGHLIGHT_PREFERENCE"),x02:"N",x09:"S"},{dataType:"text",success:function(e){""!=$.trim(e)?alert(get_message("POGC_DUPLICATE_CONDITION")):(apex.region("condition_rgn").refresh(),""==$v("P25_HIGHLIGHT_PREFERENCE")&&($s("P25_STATUS","N"),$s("P25_CONDITION_NAME",""),$s("P25_VALUE",""),$s("P25_BACKGROUND_COLOR",""),$s("P25_PRIORITY",""),$s("P25_FORMULA",""),$s("P25_FORMULA_CODE","")))}}),g_highlightArr=[]}catch(e){error_handling(e)}}function delete_preference_select(){try{""!=$v("P25_HIGHLIGHT_PREFERENCE")?confirm(get_message("POGCR_DEL_SEL_HGLT_PREF"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){apex.server.process("MODIFY_HIGHLIGHT_PREFERENCE",{x01:parseInt($v("P25_SEQ_ID")),x02:$v("P25_HIGHLIGHT_PREFERENCE"),x03:$v("P25_CONDITION_NAME"),x08:"F",x09:"D"},{dataType:"text",success:function(e){""!=$.trim(e)?raise_error(e):(g_highlightArr=g_highlightArr.filter((function(e){return e.CONDITION_NAME!==$v("P25_CONDITION_NAME")})),apex.region("condition_rgn").refresh())}})}),(function(){apex.server.process("MODIFY_HIGHLIGHT_PREFERENCE",{x01:parseInt($v("P25_SEQ_ID")),x02:$v("P25_HIGHLIGHT_PREFERENCE"),x03:$v("P25_CONDITION_NAME"),x08:"",x09:"D"},{dataType:"text",success:function(e){""!=$.trim(e)?raise_error(e):(g_highlightArr=g_highlightArr.filter((function(e){return e.CONDITION_NAME!==$v("P25_CONDITION_NAME")})),apex.region("condition_rgn").refresh())}})})):(g_highlightArr=g_highlightArr.filter((function(e){return e.CONDITION_NAME!==$v("P25_CONDITION_NAME")})),apex.server.process("MODIFY_HIGHLIGHT_PREFERENCE",{x01:parseInt($v("P25_SEQ_ID")),x02:$v("P25_HIGHLIGHT_PREFERENCE"),x03:$v("P25_CONDITION_NAME"),x09:"D"},{dataType:"text",success:function(e){""!=$.trim(e)?raise_error(e):(g_highlightArr=g_highlightArr.filter((function(e){return e.CONDITION_NAME!==$v("P25_CONDITION_NAME")})),apex.region("condition_rgn").refresh())}}))}catch(e){error_handling(e)}}function update_highlight_preference(){try{highlight_validation("Y")&&("Y"===$v("P25_STATUS")?confirm(get_message("POGCR_UPD_SEL_HGLT_PREF"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){apex.server.process("MODIFY_HIGHLIGHT_PREFERENCE",{x01:$v("P25_HIGHLIGHT_PREFERENCE"),x02:$v("P25_CONDITION_NAME"),x03:$v("P25_PRIORITY"),x04:$v("P25_VALUE"),x05:$v("P25_BACKGROUND_COLOR"),x06:$v("P25_OPERATOR"),x07:$v("P25_CONDITION"),x08:"H",x09:"G",x10:parseInt($v("P25_SEQ_ID"))},{dataType:"text",success:function(e){$s("P25_HIDDEN_OPERATOR",""),updateHighlightArr($v("P25_CONDITION_NAME"),"N"),"N"!=$v("P25_VALIDATION_CHECK")&&apex.region("condition_rgn").refresh()}})}),(function(){apex.server.process("MODIFY_HIGHLIGHT_PREFERENCE",{x01:$v("P25_HIGHLIGHT_PREFERENCE"),x02:$v("P25_CONDITION_NAME"),x03:$v("P25_PRIORITY"),x04:$v("P25_VALUE"),x05:$v("P25_BACKGROUND_COLOR"),x06:$v("P25_OPERATOR"),x07:$v("P25_CONDITION"),x08:"",x09:"G",x10:parseInt($v("P25_SEQ_ID"))},{dataType:"text",success:function(e){$s("P25_HIDDEN_OPERATOR",""),updateHighlightArr($v("P25_CONDITION_NAME"),"N"),"N"!=$v("P25_VALIDATION_CHECK")&&apex.region("condition_rgn").refresh()}})})):apex.server.process("MODIFY_HIGHLIGHT_PREFERENCE",{x01:$v("P25_HIGHLIGHT_PREFERENCE"),x02:$v("P25_CONDITION_NAME"),x03:$v("P25_PRIORITY"),x04:$v("P25_VALUE"),x05:$v("P25_BACKGROUND_COLOR"),x06:$v("P25_OPERATOR"),x07:$v("P25_CONDITION"),x08:"",x09:"G",x10:parseInt($v("P25_SEQ_ID"))},{dataType:"text",success:function(e){$s("P25_HIDDEN_OPERATOR",""),updateHighlightArr($v("P25_CONDITION_NAME"),"N"),"N"!=$v("P25_VALIDATION_CHECK")&&apex.region("condition_rgn").refresh()}}))}catch(e){error_handling(e)}}async function get_swap_rec(e){var o=apex.region("swap_grid").widget().interactiveGrid("getViews","grid").model,_=o.getSelectedRecords(),n=[],t=[],i=[],a=$v("P25_POGCR_SPECIAL_SWAP_MOD");_.length>0&&("C"==e?"Y"!==check_dup_seq_swap()&&(o.forEach((function(e){if(""!=e[o.getFieldKey("SEQ_NO")]){var _={};_.MainMod=e[o.getFieldKey("MODULE_NAME")],_.ChngSeq=e[o.getFieldKey("SEQ_NO")],n.push(e[o.getFieldKey("SEQ_NO")]),t.push(e[o.getFieldKey("MODULE_NAME")]),i.push(_)}})),g_pog_json[g_pog_index].GenrateCombineS.length>0?confirm(get_message("POGCR_CHNG_SEQ_COMBINE_MSG"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){addLoadingIndicator(),changeModuleSeq(i,g_pog_index),removeLoadingIndicator(regionloadWait)})):(addLoadingIndicator(),changeModuleSeq(i,g_pog_index),removeLoadingIndicator(regionloadWait)),closeInlineDialog("module_Swap")):(o.forEach((function(e){if(""!=e[o.getFieldKey("SWAP_MODULE")].v){var _={};_.MainMod=e[o.getFieldKey("MODULE_NAME")],_.SwapMod=e[o.getFieldKey("SWAP_MODULE")].v,n.push(e[o.getFieldKey("SWAP_MODULE")].v),t.push(e[o.getFieldKey("MODULE_NAME")]),i.push(_)}})),await Show_swap_module(t,n,i,a,g_pog_index)))}function check_dup_seq_swap(){var e=apex.region("swap_grid").widget().interactiveGrid("getViews","grid").model,o=(e.getSelectedRecords(),new Set),_="N";return e.forEach((function(n,t,i){var a=n[e.getFieldKey("SEQ_NO")],s=n[e.getFieldKey("MODULE_NAME")];""==a||o.has(a)?(add_error(e,"swap_grid",s,s,"SEQ_NO","SEQ_NO",get_message("POGCR_DUPLICATE_SEQ_NO"),[]),_="Y"):(e.setValidity("valid",s,"SEQ_NO"),o.add(a))})),_}function checkValueConsistency(e,o,_,n){try{if(0===e.length)return!1;if("S"===n){const n=e.filter((e=>"SHELF"===e.Object)),t=nvl(n[0][o]),i=isNaN(t)?t.toUpperCase():t;for(const e of n)if("DIVIDER"!==e.Item&&"SHELF"===e.Object){const n=nvl(e[o]),t=isNaN(n)?n.toUpperCase():n;if(i!==t||(t!==_||0===nvl(_))&&0!==nvl(_))return!1}}else if("I"===n){const n=e.filter((e=>"ITEM"===e.Object));var t;n.length>1?t=nvl(n[0].ItemObj[0][o]):(t=nvl(n[0][o]),t=nvl(g_pog_json[g_pog_index].ModuleInfo[n[0].MIndex].ShelfInfo[n[0].SIndex].ItemInfo[n[0].IIndex][o]));const a=isNaN(t)?t.toUpperCase():t;for(const e of n)if("DIVIDER"!==e.Item&&"ITEM"===e.Object){var i;i=n.length>1?nvl(e.ItemObj[0][o]):nvl(g_pog_json[g_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex][o]);const t=isNaN(i)?i.toUpperCase():i;if(a!==t||(t!==_||0===nvl(_))&&0!==nvl(_))return!1}}return!0}catch(e){return error_handling(e),!1}}function setIconForInconsistentTag(e,o,_,n,t=""){try{if(checkValueConsistency(e,o,t,n)){let i=t;if("S"===n){const _=e.filter((e=>"SHELF"===e.Object));_.length>0&&(i=_[0][o])}else if("I"===n){const _=e.filter((e=>"ITEM"===e.Object));i=_.length>1?_[0].ItemObj[0][o]:g_pog_json[g_pog_index].ModuleInfo[_[0].MIndex].ShelfInfo[_[0].SIndex].ItemInfo[_[0].IIndex][o]}$("#"+_+"_CONTAINER .inc_tag_icon").remove(),$("#"+_).removeClass("apex-item-has-icon"),$("#"+_+"_CONTAINER").removeClass("apex-item-wrapper--has-icon"),void 0!==i?("P25_TEXT_WIDTH"!=_&&"P25_TEXT_HEIGHT"!=_||(i=(100*i).toFixed(2)),$s(_,i)):$s(_,t)}else"P25_BOLD"!=_&&"P25_TEXT"!=_&&($("#"+_+"_CONTAINER").addClass("apex-item-wrapper--has-icon"),$("#"+_).addClass("apex-item-has-icon")),$("#"+_).after('<span class="inc_tag_icon apex-item-icon fa fa-exclamation-triangle-o" aria-hidden="true"></span>'),$s(_,t)}catch(e){error_handling(e)}}async function changeModuleSeq(e,o){try{var _=[];if(e.length>0){e.sort((function(e,o){return parseInt(e.ChngSeq)-parseInt(o.ChngSeq)})),e.forEach(((e,o)=>{e.ChngSeq=(o+1).toString()}));var n=JSON.parse(JSON.stringify(g_pog_json[o])),t=0;for(var i of e){for(var a of n.ModuleInfo)a.Module!=i.MainMod&&a.ParentModule!=i.MainMod||(a.Oldseq=parseInt(a.SeqNo),a.SeqNo=parseInt(i.ChngSeq)),s++;t++}if(g_pog_json[o].GenrateCombineS.length>0){t=0;for(var a of n.ModuleInfo){if(void 0===a.ParentModule||null==a.ParentModule){var s=0;for(var g of a.ShelfInfo)"SHELF"!=g.ObjType&&"HANGINGBAR"!=g.ObjType||"N"===g.Combine||(g.Combine="N",g_pog_json[o].ModuleInfo[t].ShelfInfo[s].Combine="N",await generateCombinedShelfs(o,t,s,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y","","Y")),s++}t++}}n.GenrateCombineS=[],n.ModuleInfo.sort((function(e,o){return parseInt(e.SeqNo)-parseInt(o.SeqNo)}));var l=0;for(var a of n.ModuleInfo){if(void 0===a.ParentModule||null==a.ParentModule){var r=wpdSetFixed(a.Y+a.H/2),d=wpdSetFixed(a.Y-a.H/2),c=0;for(var g of a.ShelfInfo){if("BASE"!==g.ObjType&&"NOTCH"!==g.ObjType&&"DIVIDER"!==g.ObjType){var f=wpdSetFixed(g.Y+g.H/2),I=wpdSetFixed(g.Y-g.H/2),p=wpdSetFixed(g.X-g.W/2),h=wpdSetFixed(g.X+g.W/2);if("TEXTBOX"==g.ObjType)var u=wpdSetFixed(a.X-a.W/2-g_textbox_threshold_value),m=wpdSetFixed(a.X+a.W/2+g_textbox_threshold_value);else if("CHEST"==g.ObjType)u=wpdSetFixed(a.X-a.W/2),m=wpdSetFixed(a.X+a.W/2);(f>r||I<d)&&(h>m||p<u)&&(g.MIndex=l,g.SIndex=c,g.SeqChange="Y",a.ShelfInfo.splice(c,1),_.push(g))}c++}}l++}}var O=0;for(var i of _){var S=0,P=wpdSetFixed(i.X-i.W/2),E=!1;for(var a of n.ModuleInfo){var v=O,D=v+a.W;if(void 0===a.ParentModule||null===a.ParentModule){if(i.X>v&&i.X<D&&"CHEST"!==i.ObjType){for(var C of(n.ModuleInfo[S].ShelfInfo.push(i),E=!0,n.ModuleInfo))if((void 0!==C.ParentModule||null!==C.ParentModule)&&C.ShelfInfo[0].SObjID==i.SObjID){C.ParentModule=a.Module;break}break}if(P>=v&&D>P&&"CHEST"==i.ObjType){n.ModuleInfo[S].ShelfInfo.push(i),E=!0;break}}O=D,S++}if(!E)n.ModuleInfo.filter((e=>1==e.SeqNo&&void 0===e.ParentModule||null==e.ParentModule))[0].ShelfInfo.push(i);0}var T=0;for(var a of n.ModuleInfo){if(void 0===a.ParentModule||null===a.ParentModule){c=0;var b=[];for(var j of a.ShelfInfo){var N=new RegExp("["+a.Oldseq+"]/"),x=j.Shelf.replace(N,a.SeqNo+"/");"DIVIDER"==j.ObjType&&(j.OldDividerid=j.Shelf),j.Shelf=x;t=0;for(var M of j.ItemInfo)"DIVIDER"==M.Item&&(M.MIndex=T,M.SIndex=c,M.IIndex=t,b.push(M)),t++;c++}if(b.length>0)for(var R of b)for(var g of a.ShelfInfo)"DIVIDER"==g.ObjType&&R.ItemID==g.OldDividerid&&(n.ModuleInfo[R.MIndex].ShelfInfo[R.SIndex].ItemInfo[R.IIndex].ItemID=g.Shelf)}T++}g_pog_json[o]=JSON.parse(JSON.stringify(n)),g_json=[g_pog_json[o]];await context_create_module("",g_camera,"Y",o,"Y"),await enableDisableFlags(o);await update_pog_json(o)}catch(e){error_handling(e)}}function open_aditional_pog(){try{g_open_from="A",apex.item("P25_POG_OPEN_LIST").setValue(g_pog_json.map((e=>e.POGCode)).join("$$$"));var e="";apex.server.process("GET_POG_URL",{pageItems:"#P25_POG_OPEN_LIST",x01:g_type_pog},{dataType:"text",success:function(o){""!=$.trim(o)&&(e=o,"D"==g_type_pog?openCustomDialog("OPEN_DRAFT",e,"P25_DRAFT_TRIGGER_ELEMENT"):openCustomDialog("OPEN_EXITPOG",e,"P25_EXISTPOG_TRIGGER_ELEMENT"))}})}catch(e){error_handling(e)}}async function add_addition_pog(e,o,_=!1,n="Y"){try{return new Promise((t=>{_||addLoadingIndicator(),g_open_pog_flag="Y";var a=[],s=[],g=[],l="";if(e.length>15)alert(get_message("POGCR_MAX_TAB_MESS","15"));else if(_||($("#pog_list_btn").css("display","block"),$("#chng_view_btn").css("display","block"),switchCanvasView($v("P25_POGCR_TILE_VIEW")),appendMultiCanvasRowCol(1,$v("P25_POGCR_TILE_VIEW"))),"E"==g_type_pog){for(const e of g_pog_json)l+=e.POGCode+":";for(const o of e)a.push(o.POGCode),s.push(o.POGVersion),g.push(o.IsRealPOG);a.length>0&&apex.server.process("CHECK_MOD_COUNT",{x01:"P",x02:"",f01:a,f02:s},{dataType:"text",success:async function(r){if(""!=$.trim(r))alert(get_message("POGCR_MAX_MOD_ERR",$v("P25_POGCR_MAX_MOD_OPEN")));else if(_){var d="maincanvas2";g_canvas=document.getElementById(d),g_canvas_objects.push(g_canvas),createWorld(),g_tanFOV=Math.tan(Math.PI/180*g_camera.fov/2);var c=$("#"+d).parent()[0].offsetHeight,f=$("#"+d).parent()[0].offsetWidth;$("#"+d).css("height",c+"px !important").css("width",f+"px !important"),g_canvas.width=f,g_canvas.height=c,g_camera.aspect=f/c,g_camera.fov=360/Math.PI*Math.atan(g_tanFOV),g_camera.updateProjectionMatrix(),g_renderer.setSize(f,c),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects),set_indicator_objects(g_scene_objects.length-1),g_pog_index=g_pog_json.length;await getJson("N",e[0].POGCode,e[0].POGVersion,"Y","Y",g_camera,g_scene,2,o,n);render(g_pog_index),g_pog_json=g_multi_pog_json,t("SUCCESS")}else{for(const e of g);sessionStorage.setItem("pog_code_list",JSON.stringify(a)),$s("P25_OPEN_POG","Y"),i=0;for(const e of a)l+=a[i]+":",i++;$s("P25_SELECTED_RECORDS",l),appendMultiCanvasRowCol(g_pog_json.length+a.length,$v("P25_POGCR_TILE_VIEW")),switchCanvasView($v("P25_POGCR_TILE_VIEW"),"Y"),modifyWindowAfterMinMax(g_scene_objects),add_pog_code_header();var I=0;for(const e of a){g_pog_index=g_pog_json.length,g_seqArrDtl={},g_seqArrDtl.seqId="",g_seqArrDtl.index=g_pog_index,g_seqArrDtl.pogCode=e,g_seqArrDtl.pogVersion=s[I],g_seqArrDtl.pogType="E",g_seqArr.push(g_seqArrDtl);await get_existing_pog(e,s[I],g_pog_index,"Y",o);render(g_pog_index);var p=g_canvas_objects[g_pog_index].getAttribute("id");$("#"+p+"-btns").append('<span id="block_title" style="float:left">'+e+"</span>"),I==a.length-1&&removeLoadingIndicator(regionloadWait),I++}if(g_pog_json=g_multi_pog_json,generateMultiPogDropdown(),reset_canvas_region(),"Y"==o){addLoadingIndicator();await get_all_images(0,g_get_orient_images,"Y",$v("P25_POGCR_IMG_MAX_WIDTH"),$v("P25_POGCR_IMG_MAX_HEIGHT"),$v("P25_IMAGE_COMPRESS_RATIO"));removeLoadingIndicator(regionloadWait)}if(g_ItemImages.length>0&&"Y"==g_show_live_image&&"Y"==o){var h=0;$(".live_image").addClass("live_image_active");for(const e of g_pog_json){try{g_renderer=g_scene_objects[h].renderer,g_scene=g_scene_objects[h].scene,g_camera=g_scene_objects[h].scene.children[0],g_world=g_scene_objects[h].scene.children[2],addLoadingIndicator();await recreate_image_items("Y",$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_NOTCH_HEAD"),h,g_show_days_of_supply,$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label);removeLoadingIndicator(regionloadWait)}catch(e){error_handling(e)}h++}g_imagesShown="Y",animate_all_pog()}I=0;for(const e of g_pog_json){await enableDisableFlags(I);I++}await save_update_json_items(g_multi_pog_json)}},loadingIndicatorPosition:"page"})}else{var r=[],d=e;for(const e of d)r.push(parseInt(e.SequenceID));var c=d.map((function(e){return Object.values(e)[0]})).join(":");apex.server.process("CHECK_MOD_COUNT",{x01:"D",x02:c},{dataType:"text",success:async function(_){if(""!=$.trim(_))alert(get_message("POGCR_MAX_MOD_ERR",$v("P25_POGCR_MAX_MOD_OPEN")));else{if(r.length>1){var n=d[0].SequenceID,t=d[0].DescriptionDetails;$s("P25_DRAFT_LIST",n),$s("P25_POG_DESCRIPTION",t);var i=d[0].DraftVersion;$s("P25_EXISTING_DRAFT_VER",i),sessionStorage.setItem("P25_EXISTING_DRAFT_VER",i)}appendMultiCanvasRowCol(g_pog_json.length+e.length,$v("P25_POGCR_TILE_VIEW")),switchCanvasView($v("P25_POGCR_TILE_VIEW"),"Y"),modifyWindowAfterMinMax(g_scene_objects),add_pog_code_header();for(var a=0;a<=d.length-1;a++){g_pog_index=g_pog_json.length,init(g_pog_index),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects),g_seqArrDtl={},g_seqArrDtl.seqId=d[a],g_seqArrDtl.index=g_pog_index,g_seqArrDtl.pogCode="",g_seqArrDtl.pogVersion="",g_seqArrDtl.pogType="D",g_seqArr.push(g_seqArrDtl),set_indicator_objects(g_scene_objects.length-1);await getJson("Y","",d[a].SequenceID,"Y","Y",g_camera,g_scene,g_pog_index,o);render(g_pog_index);var s=g_canvas_objects[g_pog_index].getAttribute("id");$("#"+s+"-btns").append('<span id="block_title" style="float:left">'+g_pog_json[g_pog_index].POGCode+"</span>"),a==d.length-1&&removeLoadingIndicator(regionloadWait)}if(generateMultiPogDropdown(),reset_canvas_region(),"Y"==o){addLoadingIndicator();await get_all_images(0,g_get_orient_images,"Y",$v("P25_POGCR_IMG_MAX_WIDTH"),$v("P25_POGCR_IMG_MAX_HEIGHT"),$v("P25_IMAGE_COMPRESS_RATIO"));removeLoadingIndicator(regionloadWait)}if(g_ItemImages.length>0&&"Y"==g_show_live_image&&"Y"==o){var g=0;$(".live_image").addClass("live_image_active");for(const e of g_pog_json){try{g_renderer=g_scene_objects[g].renderer,g_scene=g_scene_objects[g].scene,g_camera=g_scene_objects[g].scene.children[0],g_world=g_scene_objects[g].scene.children[2],addLoadingIndicator();await recreate_image_items("Y",$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_NOTCH_HEAD"),g,g_show_days_of_supply,$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label);removeLoadingIndicator(regionloadWait)}catch(e){error_handling(e)}g++}g_imagesShown="Y",animate_all_pog()}var l=0;for(const e of g_pog_json){await enableDisableFlags(l);l++}await save_update_json_items(g_multi_pog_json)}},loadingIndicatorPosition:"page"})}}))}catch(e){error_handling(e)}}function openPdfTempInfoManagement(){try{openInlineDialog("pdf_temp_info_management",60,82)}catch(e){error_handling(e)}}async function callPlanoRate(){try{apex.message.clearErrors();const a=apex.item("P25_SALE_INDE").getValue(),s=apex.item("P25_QUANTITY_INDE").getValue(),g=apex.item("P25_MARGIN_INDEX").getValue(),l=$v("P25_PAR_POG_VERSION");var e=g_pog_json[g_pog_index].POGCode,o=g_pog_json[g_pog_index].Version;const r=$v("P25_DATES_FROM_WEEK").slice(10,16),d=$v("P25_DATES_FROM_WEEK").slice(0,6),c=$v("P25_ASSMT_REF"),f=$v("P25_SALES_INDEX")/100,I=$v("P25_QUANTITY_INDEX")/100,p=$v("P25_MARGIN_INDEX")/100;var _="C"!==c?$v("P25_PAR_SEGMENT"):$v("P25_PAR_COMPANY_STORE_SEGMENT");if("C"!==c&&""==$v("P25_PAR_SEGMENT")){var n=get_message("SEGMENT_NOT_NULL");apex.message.showErrors([{type:"error",location:"inline",pageItem:"P25_PAR_SEGMENT",message:n}])}else if("N"==a&&"N"==s&&"N"==g||"Y"==a&&"N"==s&&"N"==g||"N"==a&&"Y"==s&&"N"==g||"N"==a&&"N"==s&&"Y"==g)alert(get_message("ATLEST_TWO_INDEX_SELECT"));else if(parseFloat($v("P25_SALES_INDEX"))+parseFloat($v("P25_QUANTITY_INDEX"))+parseFloat($v("P25_MARGIN_INDEX"))!==100)alert(get_message("SAR_WEIGHT_SUM_GRT_1"));else{addLoadingIndicator();const n=Date.now();render(g_pog_index),reset_zoom();var t="";const a=$v("P25_PAR_POG_FLAGS").split(";"),s={};if(s.g_show_notch_label_old=0==nvl(g_show_notch_label)?"N":g_show_notch_label,s.g_show_fixel_space_old=0==nvl(g_show_fixel_space)?"N":g_show_fixel_space,s.g_show_item_label_old=0==nvl(g_show_item_label)?"N":g_show_item_label,s.g_show_max_merch_old=0==nvl(g_show_max_merch)?"N":g_show_max_merch,s.g_show_days_of_supply_old=0==nvl(g_show_days_of_supply)?"N":g_show_days_of_supply,s.g_show_live_image_old=0==nvl(g_show_live_image)?"N":g_show_live_image,a.forEach((e=>{const[o,_]=e.split(":");s[o]=_})),g_show_item_label=s.I,g_show_live_image=s.L,g_show_notch_label=s.N,g_show_fixel_space=s.A,g_show_days_of_supply=s.D,g_show_max_merch=s.M,await enableDisableFlags(g_pog_index,"Y"),g_show_live_image!==s.g_show_live_image_old){await recreate_image_items(g_show_live_image,$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_NOTCH_HEAD"),g_pog_index,g_show_days_of_supply,$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label);"Y"==g_show_live_image&&animate_all_pog()}await timeout(200);var i=e+"_"+o+"_"+n+".jpeg";main_canvas=await get_full_canvas(g_pog_index,3);const g=main_canvas.toDataURL("image/jpeg"),c=new Image;c.src=g,c.onload=function(){const o=document.createElement("canvas");o.width=c.width*$v("P25_PAR_IMAGE_SCALE"),o.height=c.height*$v("P25_PAR_IMAGE_SCALE");o.getContext("2d").drawImage(c,0,0,o.width,o.height);var[n,a]=cropCanvasToContent(o);var g=n.toDataURL("image/jpeg",$v("PAR_IMAGE_COMPRESS_RATIO")).match(/,(.*)$/)[1];apex.server.process("UPLOAD_IMAGE_TO_AZURE",{x01:i,p_clob_01:g},{dataType:"text"}).done((async function(o){if(0!==nvl(l)){const o=Date.now();t=e+"_"+l+"_"+o+".jpeg",await generatePOGImage(e,l,t)}await async function(){apex.server.process("CALL_PLANO_RATE",{x01:e,x02:l,x03:d,x04:r,x05:_,x06:f,x07:I,x08:p,x09:i,x10:t,p_clob_01:JSON.stringify(g_pog_json[0])},{dataType:"json"}).done((function(e){const o=e.ASTH_STATUS,_=e.COMP_STATUS,n=e.PROD_STATUS;apex.region("asp_curr_chart").refresh(),apex.region("asp_prev_chart").refresh(),apex.region("csp_curr_chart").refresh(),apex.region("csp_prev_chart").refresh(),apex.region("pas_curr_chart").refresh(),apex.item("P25_ASP_COMPARISON").setValue(e.ASTH_RESULT),apex.item("P25_CSP_COMPARISON").setValue(e.COMP_RESULT),"ERROR"==o?raise_error(e.ASTH_MSG):"ERROR"==_?raise_error(e.COMP_MSG):"ERROR"==n?raise_error(e.PROD_MSG):(removeLoadingIndicator(regionloadWait),apex.message.showPageSuccess(get_message("PAR_SUCCESS")))}))}(),g_show_notch_label=s.g_show_notch_label_old,g_show_fixel_space=s.g_show_fixel_space_old,g_show_item_label=s.g_show_item_label_old,g_show_max_merch=s.g_show_max_merch_old,g_show_days_of_supply=s.g_show_days_of_supply_old,g_show_live_image=s.g_show_live_image_old;await enableDisableFlags(g_pog_index,"Y");if(s.L!==s.g_show_live_image_old)await recreate_image_items(g_show_live_image,$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_NOTCH_HEAD"),g_pog_index,g_show_days_of_supply,$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label)}))}}}catch(e){error_handling(e)}}async function generatePOGImage(e,o,_){try{open_product("OPEN_PAR");var n=$v("P25_POGCR_ALL_IMAGE_LOAD"),t={},i=[];t.POGCode=e,t.POGVersion=o,i.push(t),g_type_pog="E",sessionStorage.setItem("g_type_pog",g_type_pog);var a=$("#canvas-holder .container").height(),s=$("#canvas-holder .container").width();$("[data-row=1]").append('<div id="tempCanvas" style="height:'+parseFloat(a.toFixed(2))+"px;width:"+parseFloat(s.toFixed(2))+'px"><canvas class="canvasregion" data-canvas=true id="maincanvas2" ></canvas></div>'),await add_addition_pog(i,n,!0,"N"),animate_all_pog(),await timeout(200),await async function(){main_canvas=await get_full_canvas(g_pog_index,3);const e=main_canvas.toDataURL("image/jpeg"),o=new Image;o.src=e,await new Promise((e=>o.onload=e));const n=document.createElement("canvas");n.width=o.width*$v("P25_PAR_IMAGE_SCALE"),n.height=o.height*$v("P25_PAR_IMAGE_SCALE"),n.getContext("2d").drawImage(o,0,0,n.width,n.height);var[t,i]=cropCanvasToContent(n),a=t.toDataURL("image/jpeg",$v("PAR_IMAGE_COMPRESS_RATIO")).match(/,(.*)$/)[1];apex.server.process("UPLOAD_IMAGE_TO_AZURE",{x01:_,p_clob_01:a},{dataType:"text"}),$("#tempCanvas").remove();var s=g_pog_json.length-1;g_scene_objects.splice(s,1),g_pog_json.splice(s,1),g_pog_index=0,set_select_canvas(g_pog_index),open_product("OPEN_PAR")}()}catch(e){error_handling(e)}}function saveItemInfoBatch(){try{if(deferredObj=$.Deferred(),addLoadingIndicator(),apex.region("item_pog_info").widget().interactiveGrid("getActions").set("edit",!1),apex.region("item_pog_info").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("item_pog_info").refresh(),apex.region("draggable_table").refresh(),apex.message.showPageSuccess(get_message("IMPORT_SUCCESS_TEXT")),apex.region("item_pog_info").widget().interactiveGrid("getViews","grid").view$.grid("firstPage"),apex.region("item_pog_info").widget().interactiveGrid("getViews").grid){apex.region("item_pog_info").widget().interactiveGrid("getViews").grid.model._haveAllData||apex.region("item_pog_info").widget().interactiveGrid("getViews").grid.model.fetchAll((function(){}));let e=setInterval((()=>function(e){if(apex.region("item_pog_info").widget().interactiveGrid("getViews").grid.model._haveAllData)return clearInterval(e),removeLoadingIndicator(regionloadWait),deferredObj.resolve(),saveItemInfo(g_pog_index,"Y","Y"),deferredObj.promise()}(e)),10)}setTimeout((function(){saveItemInfo(g_pog_index,"Y","Y")}),500)}catch(e){error_handling(e)}}function uploadPogItemInfoFile(e){try{var o=document.getElementById("P25_ITEM_INFO_UPLD"),_=o.files[e],n=new FileReader;n.onload=(t=_,function(e){if(t){var n=binaryArray2base64(e.target.result),i=[];i=clob2Array(n,3e4,i),apex.server.process("UPLOAD_ITEMS_COLOR",{x01:_.name,x02:_.type,f01:i},{dataType:"json",success:function(e){"success"==e.result?(e.MassDelistedItem&&updateMassDelistedTag(e.MassDelistedItem,"Y"),g_itemInfoFileIndex++,g_itemInfoFileIndex<o.files.length?uploadPogItemInfoFile(g_itemInfoFileIndex):(g_itemInfoFileIndex=0,o.value="","Y"==e.error_flag?(closeInlineDialog("upd_reg_mov"),apex.navigation.redirect("f?p="+$v("pFlowId")+":"+$v("pFlowStepId")+":"+$v("pInstance")+":APPLICATION_PROCESS=EXPORT_ITEM_REGMOV_ON_ERROR:&DEBUG."),raise_error(get_message("IMPORT_RECORD_FAILURE"))):saveItemInfoBatch())):(apex.message.clearErrors(),apex.message.showErrors([{type:"error",location:["page"],message:e.error,unsafe:!1}]))},loadingIndicatorPosition:"page"})}}),n.readAsArrayBuffer(_)}catch(e){error_handling(e)}var t}function importUpdateItemInfo(e){try{var o=document.getElementById("P25_UPDATE_ITEM_INFO"),_=o.files[e],n=new FileReader;n.onload=(t=_,function(e){if(t){var n=binaryArray2base64(e.target.result),i=[];i=clob2Array(n,3e4,i),apex.server.process("IMPORT_UPDATE_ITEM_INFO",{x01:_.name,x02:_.type,f01:i},{dataType:"json",success:function(e){"success"==e.result?(g_itemInfoFileIndex++,g_itemInfoFileIndex<o.files.length?importUpdateItemInfo(g_itemInfoFileIndex):(g_itemInfoFileIndex=0,o.value="","Y"==e.error_flag?(closeInlineDialog("upd_reg_mov"),apex.navigation.redirect("f?p="+$v("pFlowId")+":"+$v("pFlowStepId")+":"+$v("pInstance")+":APPLICATION_PROCESS=EXPORT_UPDATE_ITEM_INFO_ON_ERROR"),raise_error(get_message("IMPORT_RECORD_FAILURE"))):saveitem_depthremarks(e.item_dtl))):(apex.message.clearErrors(),apex.message.showErrors([{type:"error",location:["page"],message:e.error,unsafe:!1}]))},loadingIndicatorPosition:"page"})}}),n.readAsArrayBuffer(_)}catch(e){error_handling(e)}var t}async function mirror_pog(e=0){logDebug("function : mirror_pog","S");try{if(closeInlineDialog("module_Swap"),apex.message.clearErrors(),void 0===g_pog_json[e])return void apex.message.showErrors([{type:"error",location:"page",message:get_message("NO_POG_FOUND")}]);const a=g_pog_json[e];for(const e of a.ModuleInfo)for(const o of e.ShelfInfo){if("PEGBOARD"==o.ObjType)return void apex.message.showErrors([{type:"error",location:"page",message:get_message("PEGBD_CHST_MIRROR_NOT_ALLOW")}]);if("CHEST"==o.ObjType&&"undefined"!=typeof g_chest_as_pegboard&&"Y"==g_chest_as_pegboard)return void apex.message.showErrors([{type:"error",location:"page",message:get_message("PEGBD_CHST_MIRROR_NOT_ALLOW")}])}addLoadingIndicator();let s,g=JSON.parse(JSON.stringify(a)),l=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(const e of a.ModuleInfo)void 0!==e.X&&(l=Math.min(l,e.X-e.W/2),r=Math.max(r,e.X+e.W/2));s=l==Number.POSITIVE_INFINITY?0:(l+r)/2;for(var o=(void 0!==g.POGCode&&null!==g.POGCode&&""!==g.POGCode?g.POGCode:"POG_"+(new Date).getTime())+"_MIRROR",_=o,n=1;g_pog_json.some((function(e){return void 0!==e.POGCode&&e.POGCode==_}));)_=o+"_"+n,n++;g.POGCode=_;let d=g?.ModuleInfo?.map((e=>e?.Module))||[];if(g.ModuleInfo.reverse(),Array.isArray(g.ModuleInfo)){let e=1;g.ModuleInfo.forEach((o=>{o.X=2*s-o.X,o.Module=d[e-1],o.SeqNo=e,e++}))}let c=[];for(let e=0;e<g.ModuleInfo.length;e++){const o=g.ModuleInfo[e];for(let _=0;_<o.ShelfInfo.length;_++){const n=o.ShelfInfo[_],t="CHEST"==n.ObjType;if(t||void 0!==n.X&&(n.X=2*s-n.X),"R"==n.SpreadItem?n.SpreadItem="L":"L"==n.SpreadItem&&(n.SpreadItem="R"),"R"==n.Combine?n.Combine="L":"L"==n.Combine&&(n.Combine="R"),0!==n?.Slope&&c.push({SPREAD:n.SpreadItem,MIndex:e,SIndex:_}),Array.isArray(n.ItemInfo)&&n.ItemInfo.length>0){n.ItemInfo.reverse();for(let o=0;o<n.ItemInfo.length;o++){const _=n.ItemInfo[o];if(t)continue;delete _.Distance,delete _.XDistanceArr,delete _.ManualX,delete _.ManualGap,_.IIndex=o,_.MIndex=e;let i=2*s-_.X;_.X=i}}}}g_pog_json.push(g),g_json=[g],appendMultiCanvasRowCol(g_pog_json.length,$v("P25_POGCR_TILE_VIEW")),init(1);var t={};t.scene=g_scene,t.renderer=g_renderer,g_scene_objects.push(t),set_indicator_objects(1),modifyWindowAfterMinMax(g_scene_objects),add_pog_code_header();var i=JSON.parse(JSON.stringify(g_pog_json));g_world=g_scene_objects[1].scene.children[2],g_camera=g_scene_objects[1].scene.children[0],await create_module_from_json(i,"Y","F","N","N","N","N","Y","Y","","N",g_scene_objects[1].scene.children[0],g_scene_objects[1].scene,1,1),c?.length>0&&c?.forEach((e=>{update_spread_product_final(e.SPREAD,e.MIndex,e.SIndex,1)})),await location_numbering($v("P25_MODULE_DIR"),$v("P25_DIRECTION"),$v("P25_ORDER_TYPE"),$v("P25_START_ONE_FIXEL"),$v("P25_START_ONE_MOD_LOC"),1,$v("P25_PALLET_DIRECTION")),await fixture_numbering($v("P25_MODULE_DIR"),$v("P25_DIRECTION"),$v("P25_IGNORE"),$v("P25_ORDER_TYPE"),$v("P25_START_ONE_MOD"),$v("P25_INCLUDE_MOD_NAME"),$v("P25_SEPARATOR"),$v("P25_LEADING_TEXT"),$v("P25_TRAILING_TEXT"),1),render(1),g_ComViewIndex=-1,apex.message.showPageSuccess(get_message("MIRROR_SUCCESS")),logDebug("function : mirror_pog","E")}catch(e){error_handling(e),logDebug("function : mirror_pog; error : "+e.message,"E")}finally{"undefined"!=typeof regionloadWait&&"function"==typeof regionloadWait.remove&&removeLoadingIndicator(regionloadWait)}}function updateMassDelistedTag(e,o="Y"){if(!g_pog_json||void 0===g_pog_index)return void console.error("g_pog_json not initialized");let _=[];try{_=JSON.parse(e)}catch(e){return void console.error("Invalid JSON returned from server")}g_pog_json[g_pog_index].hasOwnProperty("MassDelistedItem")||(g_pog_json[g_pog_index].MassDelistedItem=[]),g_pog_json[g_pog_index].MassDelistedItem.length=0,Array.isArray(_)&&_.length>0&&_.forEach((function(e){g_pog_json[g_pog_index].MassDelistedItem.push(e)})),apex.server.process("SAVE_MASS_DELISTED_ITEMS",{x01:JSON.stringify(g_pog_json[g_pog_index].MassDelistedItem)},{dataType:"text"})}