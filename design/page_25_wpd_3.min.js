var l_new_pog_ind="N";function setDetailsArray(e,o,_,n,t,g,a,l,s,i,d,r,f,I,c,p,u,m,h,S,x,O,M,j,D){var b={};return b.ObjID=e,b.MIndex=o,b.SIndex=_,b.ObjWidth=n,b.ObjHeight=t,b.XAxis=g,b.YAxis=a,b.ZAxis=l,b.IIndex=s,b.ObjType=i,b.IsDivider=d,b.Object=r,b.MObjID=f,b.SObjID=I,b.ItemID=c,b.Item=p,b.Exists=u,b.Rotation=m,b.Slope=h,b.Distance=S,b.TopObjID=x,b.BottomObjID=O,b.StartCanvas=M,b.g_present_canvas=j,b.p_pog_index=D,"SHELF"==r&&(b.AllowAutoCrush=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].AllowAutoCrush,b.Rotation=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].Rotation,b.Slope=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].Slope,b.Color=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].Color,b.Combine=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].Combine,b.LOverhang=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].LOverhang,b.ROverhang=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].ROverhang,b.DivHeight=void 0===g_pog_json[D].ModuleInfo[o].ShelfInfo[_].DivHeight?0:g_pog_json[D].ModuleInfo[o].ShelfInfo[_].DivHeight,b.DivWidth=void 0===g_pog_json[D].ModuleInfo[o].ShelfInfo[_].DivWidth?0:g_pog_json[D].ModuleInfo[o].ShelfInfo[_].DivWidth,b.DivPst=void 0===g_pog_json[D].ModuleInfo[o].ShelfInfo[_].DivPst?"N":g_pog_json[D].ModuleInfo[o].ShelfInfo[_].DivPst,b.DivPed=void 0===g_pog_json[D].ModuleInfo[o].ShelfInfo[_].DivPed?"N":g_pog_json[D].ModuleInfo[o].ShelfInfo[_].DivPed,b.DivPbtwFace=void 0===g_pog_json[D].ModuleInfo[o].ShelfInfo[_].DivPbtwFace?"N":g_pog_json[D].ModuleInfo[o].ShelfInfo[_].DivPbtwFace,b.NoDivIDShow=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].NoDivIDShow,b.DivFillCol=void 0===g_pog_json[D].ModuleInfo[o].ShelfInfo[_].DivFillCol?"#3D393D":g_pog_json[D].ModuleInfo[o].ShelfInfo[_].DivFillCol,b.SpreadItem=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].SpreadItem,b.W=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].W,b.H=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].H,b.D=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].D,b.MaxMerch=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].MaxMerch),"TEXTBOX"==i&&(b.FBold=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].FBold,b.FSize=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].FSize,b.FStyle=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].FStyle,b.InputText=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].InputText,b.TextImg=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].TextImg,b.TextImgMime=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].TextImgMime,b.TextImgName=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].TextImgName,b.ReduceToFit=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].ReduceToFit,b.TextDirection=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].TextDirection,b.WrapText=g_pog_json[D].ModuleInfo[o].ShelfInfo[_].WrapText),b}async function get_multiselect_obj(e){logDebug("function : get_multiselect_obj","S");try{g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[];var o="CARPARK_ITEM";if(g_dup_mod_list=await find_select_module(e),"undefined"!=typeof g_pog_json&&g_pog_json.length>0){var _=g_pog_json[e].ModuleInfo,n=0;for(const O of _){if(null==O.ParentModule||"undefined"==O.ParentModule){var t=0;for(const o of O.ShelfInfo){if(void 0!==o&&"NOTCH"!==o.ObjType&&"BASE"!==o.ObjType&&"DIVIDER"!==o.ObjType){if(0!==o.Rotation||0!==o.Slope)var g=o.X-o.ShelfRotateWidth/2,a=o.X+o.ShelfRotateWidth/2,l=o.Y-o.ShelfRotateHeight/2,s=o.Y+o.ShelfRotateHeight/2;else g=o.X-o.W/2,a=o.X+o.W/2,l=o.Y-o.H/2,s=o.Y+o.H/2;if(g_DragMouseStart.x<=g_DragMouseEnd.x&&g_DragMouseStart.y>=g_DragMouseEnd.y){if(g>=g_DragMouseStart.x&&a>=g_DragMouseStart.x&&l<=g_DragMouseStart.y&&s<=g_DragMouseStart.y&&g<=g_DragMouseEnd.x&&a<=g_DragMouseEnd.x&&l>=g_DragMouseEnd.y&&s>=g_DragMouseEnd.y){var i=setDetailsArray(o.SObjID,n,t,o.W,o.H,o.X,o.Y,o.Z,-1,o.ObjType,"N","SHELF",O.MObjID,-1,"","","N",o.Rotation,o.Slope,0,"","",g_start_canvas,g_present_canvas,e);g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(i)}}else if(g_DragMouseStart.x>=g_DragMouseEnd.x&&g_DragMouseStart.y>=g_DragMouseEnd.y){if(g>=g_DragMouseEnd.x&&a>=g_DragMouseEnd.x&&l>=g_DragMouseEnd.y&&s>=g_DragMouseEnd.y&&g<=g_DragMouseStart.x&&a<=g_DragMouseStart.x&&l<=g_DragMouseStart.y&&s<=g_DragMouseStart.y){i=setDetailsArray(o.SObjID,n,t,o.W,o.H,o.X,o.Y,o.Z,-1,o.ObjType,"N","SHELF",O.MObjID,-1,"","","N",o.Rotation,o.Slope,0,"","",g_start_canvas,g_present_canvas,e);g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(i)}}else if(g_DragMouseStart.x<=g_DragMouseEnd.x&&g_DragMouseStart.y<=g_DragMouseEnd.y){if(g>=g_DragMouseStart.x&&a>=g_DragMouseStart.x&&l>=g_DragMouseStart.y&&s>=g_DragMouseStart.y&&g<=g_DragMouseEnd.x&&a<=g_DragMouseEnd.x&&l<=g_DragMouseEnd.y&&s<=g_DragMouseEnd.y){i=setDetailsArray(o.SObjID,n,t,o.W,o.H,o.X,o.Y,o.Z,-1,o.ObjType,"N","SHELF",O.MObjID,-1,"","","N",o.Rotation,o.Slope,0,"","",g_start_canvas,g_present_canvas,e);g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(i)}}else if(g_DragMouseStart.x>=g_DragMouseEnd.x&&g_DragMouseStart.y<=g_DragMouseEnd.y&&g<=g_DragMouseStart.x&&a<=g_DragMouseStart.x&&l>=g_DragMouseStart.y&&s>=g_DragMouseStart.y&&g>=g_DragMouseEnd.x&&a>=g_DragMouseEnd.x&&l<=g_DragMouseEnd.y&&s<=g_DragMouseEnd.y){i=setDetailsArray(o.SObjID,n,t,o.W,o.H,o.X,o.Y,o.Z,-1,o.ObjType,"N","SHELF",O.MObjID,-1,"","","N",o.Rotation,o.Slope,0,"","",g_start_canvas,g_present_canvas,e);g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(i)}var d=0,r=o.ItemInfo,f={X:"asc"};r.keySort(f);for(const _ of r){var I=_.X-_.W/2,c=_.X+_.W/2,p=_.Y-_.H/2,u=_.Y+_.H/2;if(g_DragMouseStart.x<=g_DragMouseEnd.x&&g_DragMouseStart.y>=g_DragMouseEnd.y){if(I>=g_DragMouseStart.x&&c>=g_DragMouseStart.x&&p<=g_DragMouseStart.y&&u<=g_DragMouseStart.y&&I<=g_DragMouseEnd.x&&c<=g_DragMouseEnd.x&&p>=g_DragMouseEnd.y&&u>=g_DragMouseEnd.y){var m="N",h="ITEM";if("DIVIDER"==_.Item&&(m="Y",h="SHELF"),(i=setDetailsArray(_.ObjID,n,t,_.W,_.H,_.X,_.Y,_.Z,d,o.ObjType,m,h,O.MObjID,o.SObjID,_.ItemID,_.Item,"N",0,0,_.Distance,_.TopObjID,_.BottomObjID,g_start_canvas,g_present_canvas,e)).W=_.W,i.RW=_.RW,i.H=_.H,i.X=_.X,i.Y=_.Y,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(i),void 0!==t&&void 0!==n&&g_delete_details.length>0){var S=g_pog_json[e].ModuleInfo[n].ShelfInfo[t];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(S)}}}else if(g_DragMouseStart.x>=g_DragMouseEnd.x&&g_DragMouseStart.y>=g_DragMouseEnd.y){if(I>=g_DragMouseEnd.x&&c>=g_DragMouseEnd.x&&p>=g_DragMouseEnd.y&&u>=g_DragMouseEnd.y&&I<=g_DragMouseStart.x&&c<=g_DragMouseStart.x&&p<=g_DragMouseStart.y&&u<=g_DragMouseStart.y){m="N",h="ITEM";if("DIVIDER"==_.Item&&(m="Y",h="SHELF"),(i=setDetailsArray(_.ObjID,n,t,_.W,_.H,_.X,_.Y,_.Z,d,o.ObjType,m,h,O.MObjID,o.SObjID,_.ItemID,_.Item,"N",0,0,_.Distance,_.TopObjID,_.BottomObjID,g_start_canvas,g_present_canvas,e)).W=_.W,i.RW=_.RW,i.H=_.H,i.X=_.X,i.Y=_.Y,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(i),void 0!==t&&void 0!==n&&g_delete_details.length>0){S=g_pog_json[e].ModuleInfo[n].ShelfInfo[t];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(S)}}}else if(g_DragMouseStart.x<=g_DragMouseEnd.x&&g_DragMouseStart.y<=g_DragMouseEnd.y){if(I>=g_DragMouseStart.x&&c>=g_DragMouseStart.x&&p>=g_DragMouseStart.y&&u>=g_DragMouseStart.y&&I<=g_DragMouseEnd.x&&c<=g_DragMouseEnd.x&&p<=g_DragMouseEnd.y&&u<=g_DragMouseEnd.y){m="N",h="ITEM";if("DIVIDER"==_.Item&&(m="Y",h="SHELF"),(i=setDetailsArray(_.ObjID,n,t,_.W,_.H,_.X,_.Y,_.Z,d,o.ObjType,m,h,O.MObjID,o.SObjID,_.ItemID,_.Item,"N",0,0,_.Distance,_.TopObjID,_.BottomObjID,g_start_canvas,g_present_canvas,e)).W=_.W,i.RW=_.RW,i.H=_.H,i.X=_.X,i.Y=_.Y,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(i),void 0!==t&&void 0!==n&&g_delete_details.length>0){S=g_pog_json[e].ModuleInfo[n].ShelfInfo[t];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(S)}}}else if(g_DragMouseStart.x>=g_DragMouseEnd.x&&g_DragMouseStart.y<=g_DragMouseEnd.y&&I<=g_DragMouseStart.x&&c<=g_DragMouseStart.x&&p>=g_DragMouseStart.y&&u>=g_DragMouseStart.y&&I>=g_DragMouseEnd.x&&c>=g_DragMouseEnd.x&&p<=g_DragMouseEnd.y&&u<=g_DragMouseEnd.y){m="N",h="ITEM";if("DIVIDER"==_.Item&&(m="Y",h="SHELF"),(i=setDetailsArray(_.ObjID,n,t,_.W,_.H,_.X,_.Y,_.Z,d,o.ObjType,m,h,O.MObjID,o.SObjID,_.ItemID,_.Item,"N",0,0,_.Distance,_.TopObjID,_.BottomObjID,g_start_canvas,g_present_canvas,e)).W=_.W,i.RW=_.RW,i.H=_.H,i.X=_.X,i.Y=_.Y,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(i),void 0!==t&&void 0!==n&&g_delete_details.length>0){S=g_pog_json[e].ModuleInfo[n].ShelfInfo[t];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(S)}}d++}}t++}var x=O.Carpark;if(void 0!==x&&x.length>0){d=0,r=O.Carpark[0].ItemInfo,f={X:"asc"};r.keySort(f);m="N";for(const _ of r){I=_.X-_.W/2,c=_.X+_.W/2,p=_.Y-_.H/2,u=_.Y+_.H/2;if(g_DragMouseStart.x<=g_DragMouseEnd.x&&g_DragMouseStart.y>=g_DragMouseEnd.y){if(I>=g_DragMouseStart.x&&c>=g_DragMouseStart.x&&p<=g_DragMouseStart.y&&u<=g_DragMouseStart.y&&I<=g_DragMouseEnd.x&&c<=g_DragMouseEnd.x&&p>=g_DragMouseEnd.y&&u>=g_DragMouseEnd.y)(i=setDetailsArray(_.ObjID,n,0,_.W,_.H,_.X,_.Y,_.Z,d,x.ObjType,m,o,O.MObjID,x.SObjID,_.ItemID,_.Item,"N",0,0,_.Distance,_.TopObjID,_.BottomObjID,g_start_canvas,g_present_canvas,e)).W=_.W,i.RW=_.RW,i.H=_.H,i.X=_.X,i.Y=_.Y,i.IsCarpark="Y",g_delete_details.multi_delete_shelf_ind="",g_delete_details.multi_carpark_ind="Y",g_delete_details.push(i)}else if(g_DragMouseStart.x>=g_DragMouseEnd.x&&g_DragMouseStart.y>=g_DragMouseEnd.y){if(I>=g_DragMouseEnd.x&&c>=g_DragMouseEnd.x&&p>=g_DragMouseEnd.y&&u>=g_DragMouseEnd.y&&I<=g_DragMouseStart.x&&c<=g_DragMouseStart.x&&p<=g_DragMouseStart.y&&u<=g_DragMouseStart.y)(i=setDetailsArray(_.ObjID,n,0,_.W,_.H,_.X,_.Y,_.Z,d,x.ObjType,m,o,O.MObjID,x.SObjID,_.ItemID,_.Item,"N",0,0,_.Distance,_.TopObjID,_.BottomObjID,g_start_canvas,g_present_canvas,e)).W=_.W,i.RW=_.RW,i.H=_.H,i.X=_.X,i.Y=_.Y,i.IsCarpark="Y",g_delete_details.multi_delete_shelf_ind="",g_delete_details.multi_carpark_ind="Y",g_delete_details.push(i)}else if(g_DragMouseStart.x<=g_DragMouseEnd.x&&g_DragMouseStart.y<=g_DragMouseEnd.y){if(I>=g_DragMouseStart.x&&c>=g_DragMouseStart.x&&p>=g_DragMouseStart.y&&u>=g_DragMouseStart.y&&I<=g_DragMouseEnd.x&&c<=g_DragMouseEnd.x&&p<=g_DragMouseEnd.y&&u<=g_DragMouseEnd.y)(i=setDetailsArray(_.ObjID,n,0,_.W,_.H,_.X,_.Y,_.Z,d,x.ObjType,m,o,O.MObjID,x.SObjID,_.ItemID,_.Item,"N",0,0,_.Distance,_.TopObjID,_.BottomObjID,g_start_canvas,g_present_canvas,e)).W=_.W,i.RW=_.RW,i.H=_.H,i.X=_.X,i.Y=_.Y,i.IsCarpark="Y",g_delete_details.multi_delete_shelf_ind="",g_delete_details.multi_carpark_ind="Y",g_delete_details.push(i)}else if(g_DragMouseStart.x>=g_DragMouseEnd.x&&g_DragMouseStart.y<=g_DragMouseEnd.y){if(I<=g_DragMouseStart.x&&c<=g_DragMouseStart.x&&p>=g_DragMouseStart.y&&u>=g_DragMouseStart.y&&I>=g_DragMouseEnd.x&&c>=g_DragMouseEnd.x&&p<=g_DragMouseEnd.y&&u<=g_DragMouseEnd.y)(i=setDetailsArray(_.ObjID,n,0,_.W,_.H,_.X,_.Y,_.Z,d,x.ObjType,m,o,O.MObjID,x.SObjID,_.ItemID,_.Item,"N",0,0,_.Distance,_.TopObjID,_.BottomObjID,g_start_canvas,g_present_canvas,e)).W=_.W,i.RW=_.RW,i.H=_.H,i.X=_.X,i.Y=_.Y,i.IsCarpark="Y",g_delete_details.multi_delete_shelf_ind="",g_delete_details.multi_carpark_ind="Y",g_delete_details.push(i)}d++}}}n++}g_delete_details.StartCanvas=g_start_canvas,g_delete_details.g_present_canvas=g_present_canvas}"Y"==g_delete_details.multi_carpark_ind&&g_delete_details.some((e=>e.Object!==o))&&confirm(get_message("CARPARK_MULTI_SEL_CONF"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){for(var _=g_delete_details.length-1;_>=0;--_)g_delete_details[_].Object!==o&&g_delete_details.splice(_,1);set_multi_blink(g_pog_json,e)}),(function(){g_delete_details=[],set_multi_blink(g_pog_json,e)})),logDebug("function : get_multiselect_obj","E")}catch(e){error_handling(e)}}function copy_selected_obj(e,o){if(logDebug("function : copy_selected_obj; action : "+e,"S"),g_undo_all_obj_arr=[],"Y"==g_module_edit_flag){if(g_cut_copy_arr.push(JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[g_module_index]))),g_cut_copy_arr[0].MObjID="","COPY"==e){var _=g_pog_json[o].ModuleInfo,n="",t="";if($.each(_,(function(e,o){null!=o.ParentModule&&void 0!==o.ParentModule||(n=o.Module)})),"A"==$v("P25_POG_MODULE_NAME_TYPE"))t=nextLetter(n);else t=g_pog_json[o].ModuleInfo.length+1;g_cut_copy_arr[0].Module=t,g_cut_copy_arr[0].SeqNo=g_pog_json[o].ModuleInfo.length+1}loc_details.MIndex=g_module_index,loc_details.SIndex=-1,loc_details.IIndex=-1,loc_details.ShelfObjType="",loc_details.Item="",loc_details.ModuleEdit="Y",loc_details.ShelfEdit="N",loc_details.ItemEdit="N",loc_details.gPogIndex=o,g_cut_loc_arr.push(loc_details),g_cut_copy_arr[0].loc_details=g_cut_loc_arr}else if("Y"==g_shelf_edit_flag){g_cut_copy_arr.push(JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index]))),g_cut_copy_arr[0].SObjID="",loc_details.MIndex=g_module_index,loc_details.SIndex=g_shelf_index,loc_details.IIndex=-1,loc_details.ShelfObjType=g_shelf_object_type,loc_details.Item="",loc_details.ModuleEdit="N",loc_details.ShelfEdit="Y",loc_details.ItemEdit="N",loc_details.gPogIndex=o,g_cut_loc_arr.push(loc_details);var g=-1;_=g_pog_json[o].ModuleInfo;if("TEXTBOX"==g_shelf_object_type){var a=0;for(const e of _){if(e.ObjID==g_objectHit_id)return void(g=a);a++}-1!==g&&g_cut_support_obj_arr.push(g_pog_json[o].ModuleInfo[g])}}else if("Y"==g_item_edit_flag){var l="Y"==g_carpark_item_flag?g_pog_json[o].ModuleInfo[g_module_index].Carpark[g_shelf_index].ItemInfo[g_item_index].Item:g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Item;if("Y"==g_carpark_item_flag?(g_cut_copy_arr.push(JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index]))),loc_details.ShelfObjType=g_pog_json[o].ModuleInfo[g_module_index].Carpark[g_shelf_index].ItemInfo[g_item_index].CType,loc_details.Item=g_pog_json[o].ModuleInfo[g_module_index].Carpark[g_shelf_index].ItemInfo[g_item_index].Item,loc_details.SObjID=g_pog_json[o].ModuleInfo[g_module_index].Carpark[g_shelf_index].SObjID):(g_cut_copy_arr.push(JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index]))),loc_details.ShelfObjType=g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].CType,loc_details.Item=g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Item,loc_details.SObjID=g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].SObjID),g_cut_copy_arr[0].OldObjID=g_cut_copy_arr[0].ObjID,g_cut_copy_arr[0].ObjID="",loc_details.MIndex=g_module_index,loc_details.SIndex=g_shelf_index,loc_details.IIndex=g_item_index,loc_details.ModuleEdit="N",loc_details.ShelfEdit="N",loc_details.ItemEdit="Y",loc_details.gPogIndex=o,g_cut_loc_arr.push(loc_details),g_cut_copy_arr[0].loc_details=g_cut_loc_arr,"DIVIDER"==l){shelf_arr=g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo;var s=-1,i="Y"==g_carpark_item_flag?g_pog_json[o].ModuleInfo[g_module_index].Carpark[g_shelf_index].ItemInfo[g_item_index].ItemID:g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].ItemID;a=0;for(const e of shelf_arr)e.Shelf==i&&(s=a),a++;-1!==s&&g_cut_support_obj_arr.push(JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[g_module_index].ShelfInfo[s])))}}return logDebug("function : copy_selected_obj","E"),"SUCCESS"}async function context_cut(e){try{if(logDebug("function : context_cut","S"),g_cut_copy_arr=[],g_cut_support_obj_arr=[],g_cut_loc_arr=[],loc_details={},g_cut_action_done="Y",g_copy_action_done="N",g_dup_action_done="N",g_delete_action_done="N",g_multi_delete_done="N",g_multi_copy_done="N","Y"==g_item_edit_flag){var o=[];if("Y"==g_carpark_item_flag){var _=g_pog_json[e].ModuleInfo[g_module_index].Carpark[0].SObjID;o.push(JSON.parse(JSON.stringify(g_pog_json[e].ModuleInfo[g_module_index].Carpark[0])));JSON.parse(JSON.stringify(g_pog_json[e].ModuleInfo[g_module_index].Carpark[0].ItemInfo));o.IsCarpark="Y"}else{_=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].SObjID;o.push(JSON.parse(JSON.stringify(g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index])));JSON.parse(JSON.stringify(g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo))}o.moduleIndex=g_module_index,o.module=g_pog_json[e].ModuleInfo[g_module_index].Module,o.shelfIndex=g_shelf_index,o.actionType="ITEM_DELETE",o.startCanvas=g_start_canvas,o.objectID=_,o.moduleObjectID=g_pog_json[e].ModuleInfo[g_module_index].MObjID,g_allUndoObjectsInfo.push(o),logFinalUndoObjectsInfo("ITEM_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","N"),g_allUndoObjectsInfo=[]}else if("Y"==g_shelf_edit_flag){o=[],_=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].SObjID;o.moduleIndex=g_module_index,o.module=g_pog_json[e].ModuleInfo[g_module_index].Module,o.shelfIndex=g_shelf_index,o.actionType="SHELF_DELETE",o.startCanvas=g_start_canvas,o.objectID=_,o.moduleObjectID=g_pog_json[e].ModuleInfo[g_module_index].MObjID,o.push(JSON.parse(JSON.stringify(g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index])));JSON.parse(JSON.stringify(g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo));g_allUndoObjectsInfo.push(o),logFinalUndoObjectsInfo("SHELF_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","N"),g_allUndoObjectsInfo=[]}else if("Y"==g_module_edit_flag){!async function(){await update_undo_details("","",g_module_index,"","","","ITEM",g_pog_json[e].ModuleInfo[g_module_index].MObjID,"","","N","","","","","CUT_MODULE","","","","","","U","","","","",e)}()}copy_selected_obj("CUT",e);context_delete("CUT",g_module_index,g_shelf_index,g_item_index,g_item_edit_flag,g_module_edit_flag,g_shelf_edit_flag,g_objectHit_id,"",g_delete_details,g_camera,e,"N");var n=0;if($.each(g_pog_json[e].ModuleInfo,(function(e,o){null!=o.ParentModule&&void 0!==o.ParentModule||(n+=o.W)})),g_pog_json[e].W=n,g_pog_json[e].BaseH>0){var t=parseInt(g_pog_json[e].Color.replace("#","0x"),16),g=new THREE.Color(t);g_pog_json[e].BaseW=n,g_pog_json[e].BaseX=n/2;await add_base("BASE1",n,g_pog_json[e].BaseH,g_pog_json[e].BaseD,g,n/2,g_pog_json[e].BaseY,"Y",e)}if("Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view){const e=g_scene_objects[1]?.scene?.children?.[2];if(e){const o=e.getObjectByProperty("uuid","BASE1");o&&(e.remove(o),o.geometry?.dispose(),Array.isArray(o.material)?o.material.forEach((e=>e.dispose())):o.material?.dispose()),render(1)}}if("Y"==g_module_edit_flag){var a=get_min_max_xy(e).split("###");set_camera_z(g_camera,parseFloat(a[2]),parseFloat(a[3]),parseFloat(a[0]),parseFloat(a[1]),g_offset_z,parseFloat(a[4]),parseFloat(a[5]),!0,g_pog_index),render(e)}logDebug("function : context_cut","E")}catch(e){error_handling(e)}}function context_copy(e,o){try{if(logDebug("function : context_copy; multiselect_ind : "+e,"S"),g_cut_copy_arr=[],g_cut_support_obj_arr=[],g_cut_loc_arr=[],loc_details={},g_cut_action_done="N",g_copy_action_done="Y",g_dup_action_done="N",g_delete_action_done="N",g_multi_delete_done="N","S"==e)copy_selected_obj("COPY",o);else g_multi_copy_done="Y",g_mselect_drag="N",g_multiselect="N",g_delete_details.StartCanvas=o;logDebug("function : context_copy","E")}catch(e){error_handling(e)}}async function context_paste(e,o,_,n="Y",t,g=-1){logDebug("function : context_paste; action : "+e,"S"),g_multi_copy_done="Y"==g_multiItemCopy?"Y":g_multi_copy_done;var a="Y",l="N",s=(g_duplicating,-1),i="N",d="Y",r=[],f=-1;try{if("CUT"==e||"COPY"==e||"UNDO"==e){if("N"==g_multi_delete_done&&"N"==g_multi_copy_done){if("Y"==g_cut_loc_arr[0].ModuleEdit){if("UNDO"!==e){var I=0,c=0;for(const e of g_pog_json[t].ModuleInfo)null!=e.ParentModule&&void 0!==e.ParentModule||(I=c),c++;if("A"==$v("P25_POG_MODULE_NAME_TYPE"))var p=nextLetter(g_pog_json[t].ModuleInfo[I].Module);else p=(I+1).toString();if("COPY"==e){g_cut_copy_arr[0].Module=p,Oe=g_cut_copy_arr[0].ShelfInfo;const e={};$.each(Oe,(function(o,_){var n=_.Shelf,t=p+(o+1);if(g_cut_copy_arr[0].ShelfInfo[o].Shelf=t,"DIVIDER"===_.ObjType){var g=_.ItemID||n;e[g]=t,_.ItemID=t}})),$.each(Oe,(function(o,_){var n=[].concat(_.Items||[],_.ItemInfo||[]);$.each(n,(function(o,_){"DIVIDER"!==_.Item&&"DIVIDER"!==_.ObjType||!e[_.ItemID]||(_.ItemID=e[_.ItemID])}))}))}if("N"==n)for(const e of g_cut_copy_arr[0].ShelfInfo)e.ItemInfo=[];g_pog_json[t].ModuleInfo.push(g_cut_copy_arr[0]),g_pog_json[t].ModuleInfo[g_pog_json[t].ModuleInfo.length-1].SubDept=g_pog_json[t].SubDept;var u=0,m=0;for(const e of g_pog_json[t].ModuleInfo)u=Math.max(u,e.H),null!=e.ParentModule&&void 0!==e.ParentModule||(m+=e.W);g_pog_json[t].PrevH=g_pog_json[t].H,g_pog_json[t].PrevW=g_pog_json[t].W,g_pog_json[t].H=u+g_pog_json[t].BaseH,g_pog_json[t].W=m}else g_module_index=g_cut_loc_arr[0].MIndex,g_pog_json[t].ModuleInfo.splice(g_cut_loc_arr[0].MIndex,0,g_cut_copy_arr[0]);var h=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo;if($.each(h,(async function(e){var o=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[e].ItemInfo;for(const e of o)g_deletedItems.push(e.ItemID)})),t!=g&&"Y"==g_multi_cnvs_drag_conf&&(r=[...new Set(g_deletedItems)],d=await doItemMoveConf(r,g_pog_json,t,-1,g_pog_json[t].ModuleInfo.length-1)),"N"!=d){await deleted_items_log(g_deletedItems,"A",t);var S=await context_create_module(g_cut_copy_arr,o,n,t,"N"),x=await update_undo_details("","",g_pog_json[t].ModuleInfo.length-1,"","","","ITEM",g_pog_json[t].ModuleInfo[g_module_index].MObjID,"","","N","","","","","MODULE_CREATE","","","","","","U","","","","",t)}else g_pog_json[t].ModuleInfo.pop();g_cut_copy_arr=[],g_cut_support_obj_arr=[],g_cut_loc_arr=[],loc_details={},g_cut_action_done="N",g_copy_action_done="N",g_dup_action_done="Y"==g_duplicating?"Y":"N",g_delete_action_done="N",g_multi_delete_done="N",g_multi_copy_done="N"}else if("Y"==g_cut_loc_arr[0].ShelfEdit){"TEXTBOX"==g_cut_loc_arr[0].ShelfObjType&&g_cut_support_obj_arr.length>0&&g_pog_json[t].ModuleInfo.push(g_cut_support_obj_arr[0]);var O=0;if("UNDO"!==e){var M="N";if("SHELF"==g_cut_loc_arr[0].ShelfObjType||"HANGINGBAR"==g_cut_loc_arr[0].ShelfObjType){if(-1!=g_shelf_index?(g_cut_copy_arr=[],g_cut_copy_arr.push(JSON.parse(JSON.stringify(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index]))),M="Y"):(g_cut_copy_arr[0].Shelf=g_pog_json[t].ModuleInfo[g_module_index].Module+(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.length+1),g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.push(g_cut_copy_arr[0]),g_shelf_index=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.length-1,f=g_shelf_index,M="N"),-1==(O=get_yaxis_on_paste(g_cut_copy_arr[0],g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo,g_module_index,g_shelf_index,t)))return g_cut_copy_arr=[],g_cut_support_obj_arr=[],g_cut_loc_arr=[],loc_details={},g_cut_action_done="N",g_copy_action_done="N",g_dup_action_done="N",g_delete_action_done="N",g_multi_delete_done="N",void(g_multi_copy_done="N");"Y"==M&&(g_cut_copy_arr[0].Shelf=g_pog_json[t].ModuleInfo[g_module_index].Module+(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.length+1),g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.push(g_cut_copy_arr[0]),f=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.length-1)}else g_cut_copy_arr[0].Shelf=g_pog_json[t].ModuleInfo[g_module_index].Module+(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.length+1),g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.push(g_cut_copy_arr[0]),g_shelf_index=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.length-1,f=g_shelf_index}else g_module_index=g_cut_loc_arr[0].MIndex,g_shelf_index=g_cut_loc_arr[0].SIndex,g_pog_json[t].ModuleInfo[g_cut_loc_arr[0].MIndex].ShelfInfo.splice(g_cut_loc_arr[0].SIndex,0,g_cut_copy_arr[0]),f=g_shelf_index;var j=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo;for(const e of g_delete_details)-1!==e.IIndex&&g_deletedItems.push(e.ItemID);await deleted_items_log(g_deletedItems,"A",t);var D="N";(g_cut_loc_arr[0].MIndex==g_module_index&&g_cut_loc_arr[0].gPogIndex==t&&"CUT"==e||"UNDO"==e)&&(D="Y"),"COPY"==e&&(g_cut_copy_arr[0].ItemInfo=[]);var[x,b,v]=await context_create_shelfs(g_cut_copy_arr[0],-1,-1,g_module_index,f,"N",D,o,"Y","","Y",t,O),E=[],C=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[f].SObjID;E.moduleIndex=g_module_index,E.module=g_pog_json[t].ModuleInfo[g_module_index].Module,E.shelfIndex=f,E.actionType="DUPLICATE_SHELF",E.startCanvas=t,E.g_present_canvas=g_cut_loc_arr[0].gPogIndex,E.objectID=C,E.moduleObjectID=g_pog_json[t].ModuleInfo[g_module_index].MObjID,E.push(JSON.parse(JSON.stringify(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[f])));JSON.parse(JSON.stringify(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[f].ItemInfo));g_allUndoObjectsInfo.push(E),logFinalUndoObjectsInfo("SHELF_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","N"),g_allUndoObjectsInfo=[],g_cut_copy_arr=[],g_cut_support_obj_arr=[],loc_details={},g_cut_action_done="N","SHELF"==g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType||"HANGINGBAR"==g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType?g_copy_action_done="Y":(g_copy_action_done="N",g_cut_loc_arr=[]),g_dup_action_done="N",g_delete_action_done="N",g_multi_delete_done="N",g_multi_copy_done="N"}else if("Y"==g_cut_loc_arr[0].ItemEdit&&g_module_index>-1&&g_shelf_index>-1&&""!==g_module_index&&""!==g_shelf_index&&g_cut_copy_arr.length>0||"Y"==g_cut_loc_arr[0].ItemEdit&&"UNDO"==e&&("Y"==g_cut_action_done||"Y"==g_delete_action_done)){var P=g_intersects[0].point.x,N=g_intersects[0].point.y,T=g_intersects[0].point.z,y=new THREE.Vector3(P,N,T);g_scene_objects[t].scene.children[2].worldToLocal(y);var Y=Math.min(19,Math.max(-19,y.x)),R=Math.min(19,Math.max(-19,y.y));if("Y"==g_duplicating&&"DIVIDER"!==g_cut_copy_arr[0].Item){var L=g_pog_json[g].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index];g_shelf_edit_flag="N";var[H,F,w,A]=get_curr_module(Y,R,g_shelf_edit_flag,g_module_index,g_shelf_index,L,t),[F,H,G,B,V,W,X]=get_div_shelf_index(Y,R,H,F,t,"",!1);if(-1!==W){L=g_pog_json[t].ModuleInfo[H].ShelfInfo[W];g_shelf_edit_flag="N",[currCombinationIndex,currShelfCombIndx]=getCombinationShelf(t,L.Shelf);var U=L.SpreadItem;-1!==currCombinationIndex&&-1!==currShelfCombIndx&&("R"==(U=g_combinedShelfs[currCombinationIndex].SpreadItem)?(W=g_combinedShelfs[currCombinationIndex][0].SIndex,H=g_combinedShelfs[currCombinationIndex][0].MIndex):(W=g_combinedShelfs[currCombinationIndex][g_combinedShelfs[currCombinationIndex].length-1].SIndex,H=g_combinedShelfs[currCombinationIndex][g_combinedShelfs[currCombinationIndex].length-1].MIndex))}if(g_shelf_index=W,g_module_index=H,-1==W){var[k,z]=await duplicateShelf(o,t);console.log("new shelf index returned",k,z),console.log("res ",S),g_shelf_index=k,l="Y",g_module_index=H,Ce="SHELF",a=validate_shelf_min_distance(g_module_index,g_shelf_index,R,"","N",g_module_index,Y,"Y",g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index],t),s=z}if("N"==a){var J=g_scene_objects[t].scene.children[2].getObjectById(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].SObjID);g_scene_objects[t].scene.children[2].remove(J),g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.splice(g_shelf_index,1)}else g_shelf_index=g_shelf_index,Ce="SHELF",g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType=Ce,g_cut_copy_arr[0].X=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X-g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].W/2,g_cut_copy_arr[0].Y=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y-g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].H/2}else if("Y"==g_duplicating&&"DIVIDER"==g_cut_copy_arr[0].Item)Ce=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType,g_cut_copy_arr[0].X=Y,g_cut_copy_arr[0].Y=R;else{if(-1!==g_shelf_index){L=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index];g_shelf_edit_flag="N",[currCombinationIndex,currShelfCombIndx]=getCombinationShelf(t,L.Shelf);U=L.SpreadItem;-1!==currCombinationIndex&&-1!==currShelfCombIndx&&("R"==(U=g_combinedShelfs[currCombinationIndex].SpreadItem)?(g_shelf_index=g_combinedShelfs[currCombinationIndex][0].SIndex,g_module_index=g_combinedShelfs[currCombinationIndex][0].MIndex):(g_shelf_index=g_combinedShelfs[currCombinationIndex][g_combinedShelfs[currCombinationIndex].length-1].SIndex,g_module_index=g_combinedShelfs[currCombinationIndex][g_combinedShelfs[currCombinationIndex].length-1].MIndex))}Ce=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType}if("Y"==a){if("UNDO"!==e){var Z=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index];[currCombinationIndex,currShelfCombIndx]=getCombinationShelf(t,Z.Shelf);U=Z.SpreadItem;-1!==currCombinationIndex&&-1!==currShelfCombIndx&&(U=g_combinedShelfs[currCombinationIndex].SpreadItem),(E=[]).moduleIndex=g_module_index,E.shelfIndex=g_shelf_index,E.actionType="ITEM_DELETE",E.startCanvas=t,E.g_present_canvas=g_start_canvas,E.objectID=Z.SObjID,E.module=g_pog_json[t].ModuleInfo[g_module_index].Module,E.moduleObjectID=g_pog_json[t].ModuleInfo[g_module_index].MObjID,E.push(JSON.parse(JSON.stringify(Z))),g_allUndoObjectsInfo.push(E),g_cut_copy_arr[0].Dragged="N",g_cut_copy_arr[0].Exists="Y",g_cut_copy_arr[0].DfacingUpd="Y","M"==U&&(g_cut_copy_arr[0].X=Y,g_cut_copy_arr[0].Y=R),"PALLET"!==g_cut_loc_arr[0].ShelfObjType&&"PALLET"==g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType&&(g_cut_copy_arr[0].Z=0+g_cut_copy_arr[0].D/2);var q=Math.floor(999999*Math.random());"DIVIDER"==g_cut_loc_arr[0].Item&&(g_cut_copy_arr[0].ItemID=g_pog_json[t].ModuleInfo[g_module_index].Module+(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.length+1),g_cut_copy_arr[0].ObjID=q),g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.push(g_cut_copy_arr[0]),g_item_index=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.length-1,"DIVIDER"==g_cut_loc_arr[0].Item&&(g_cut_support_obj_arr[0].ShelfDivObjID=q,g_cut_support_obj_arr[0].Shelf=g_pog_json[t].ModuleInfo[g_module_index].Module+(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.length+1),g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.push(g_cut_support_obj_arr[0]))}else{if(g_module_index=g_cut_loc_arr[0].MIndex,g_item_index=g_cut_loc_arr[0].IIndex,shelf_arr=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo,"DIVIDER"==g_cut_loc_arr[0].Item){var K=-1;$.each(shelf_arr,(function(e,o){o.SObjID==g_cut_loc_arr[0].SObjID&&(K=e)})),g_shelf_index=K}else g_shelf_index=g_cut_loc_arr[0].SIndex;void 0!==g_cut_copy_arr[0].BottomObjID&&""!==g_cut_copy_arr[0].BottomObjID?(ne=g_pog_json[t].ModuleInfo[g_cut_loc_arr[0].MIndex].ShelfInfo[g_shelf_index].ItemInfo,$.each(ne,(function(e,o){if(g_cut_copy_arr[0].BottomObjID==o.OldObjID)return g_cut_copy_arr[0].BottomObjID=o.ObjID,g_cut_copy_arr[0].X=o.X,g_pog_json[t].ModuleInfo[g_cut_loc_arr[0].MIndex].ShelfInfo[g_shelf_index].ItemInfo[e].TopObjID=g_cut_copy_arr[0].ObjID,!1}))):void 0!==g_cut_copy_arr[0].TopObjID&&""!==g_cut_copy_arr[0].TopObjID&&(ne=g_pog_json[t].ModuleInfo[g_cut_loc_arr[0].MIndex].ShelfInfo[g_shelf_index].ItemInfo,$.each(ne,(function(e,o){if(g_cut_copy_arr[0].TopObjID==o.OldObjID)return g_cut_copy_arr[0].TopObjID=o.ObjID,g_pog_json[t].ModuleInfo[g_cut_loc_arr[0].MIndex].ShelfInfo[g_shelf_index].ItemInfo[e].BottomObjID=g_cut_copy_arr[0].ObjID,g_pog_json[t].ModuleInfo[g_cut_loc_arr[0].MIndex].ShelfInfo[g_shelf_index].ItemInfo[e].X=g_cut_copy_arr[0].X,g_pog_json[t].ModuleInfo[g_cut_loc_arr[0].MIndex].ShelfInfo[g_shelf_index].ItemInfo[e].Y=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y+g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].H/2+g_cut_copy_arr[0].H+g_pog_json[t].ModuleInfo[g_cut_loc_arr[0].MIndex].ShelfInfo[g_shelf_index].ItemInfo[e].H/2,!1}))),g_pog_json[t].ModuleInfo[g_cut_loc_arr[0].MIndex].ShelfInfo[g_shelf_index].ItemInfo.splice(g_cut_loc_arr[0].IIndex,0,g_cut_copy_arr[0]),g_deletedItems.push(g_cut_loc_arr[0].Item);deleted_items_log(g_deletedItems,"A",t);"DIVIDER"==g_cut_loc_arr[0].Item&&g_pog_json[t].ModuleInfo[g_cut_loc_arr[0].MIndex].ShelfInfo.push(g_cut_support_obj_arr[0])}"Y"!=g_copy_action_done&&"Y"!=g_cut_action_done&&"Y"!=g_multi_copy_done||(g_cut_copy_arr[0].TopObjID="",g_cut_copy_arr[0].BottomObjID="");var Q=[],ee=[],oe=[],_e=[],ne=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo,te=0;B=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y;if(console.log("shelf item y",Ce,ne.length),ne.length>0){if("SHELF"==Ce||"CHEST"==Ce&&"N"==g_chest_as_pegboard||"BASKET"==Ce||"PALLET"==Ce?te=B+g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].H/2+g_cut_copy_arr[0].H/2:"PEGBOARD"==Ce?te=B+g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].H/2-g_cut_copy_arr[0].H/2-.01-g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].VertiStart:"CHEST"==Ce&&"Y"==g_chest_as_pegboard?te=B+g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].H/2-g_cut_copy_arr[0].H/2-g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].VertiStart:"HANGINGBAR"==Ce?te=B-g_cut_copy_arr[0].H/2:"ROD"==Ce&&(te=B-g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].H/2-g_cut_copy_arr[0].H/2),void 0!==g_cut_copy_arr[0].BottomObjID&&""!==g_cut_copy_arr[0].BottomObjID||void 0!==g_cut_copy_arr[0].TopObjID&&""!==g_cut_copy_arr[0].TopObjID){ne=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index];update_top_bottom_xy(g_module_index,g_shelf_index,g_item_index,ne,t)}else"DIVIDER"==g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Item&&"Y"==g_duplicating?console.log("duplicate divider"):g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Y=te;var ge=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].CrushHoriz,ae=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].CrushHoriz,le=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].CrushD,se=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Fixed;Q.push(wpdSetFixed(g_cut_copy_arr[0].W)),ee.push(wpdSetFixed(g_cut_copy_arr[0].H)),oe.push(wpdSetFixed(g_cut_copy_arr[0].D)),_e.push(g_item_index);var ie="N";g_cut_loc_arr[0].MIndex==g_module_index&&g_cut_loc_arr[0].SIndex==g_shelf_index&&(ie="Y");x="N";var de=Ne=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].HorizGap,re=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.length,fe=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].AllowAutoCrush;if(reorder_items(g_module_index,g_shelf_index,t)){c=0;for(const e of g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo){if(e.ObjID==g_cut_copy_arr[0].ObjID){g_item_index=c;break}c++}("PEGBOARD"==Ce||"CHEST"==Ce&&"Y"==g_chest_as_pegboard)&&(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].FromProductList="Y",g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Edited="N");var Ie=get_item_xaxis(g_cut_copy_arr[0].W,g_cut_copy_arr[0].H,g_cut_copy_arr[0].D,Ce,-1,de,U,Ne,g_module_index,g_shelf_index,g_item_index,"Y",re,"N",t,"Y","Y");"CHEST"==Ce&&"Y"==g_chest_as_pegboard?console.log("do nothing"):"PEGBOARD"!==Ce&&(x=item_height_validation(g_cut_copy_arr[0].H,g_module_index,g_shelf_index,g_item_index,"Y",-1,fe,ae,se,"Y",g_cut_copy_arr[0].D,"N",t)),"N"==x&&(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].X=Ie);let o="N"==(Z=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index]).Combine?-1:Z.Y+Z.H/2;if("SHELF"!=Z.ObjType&&"HANGINGBAR"!=Z.ObjType||"N"===Z.Combine||([currCombinationIndex,currShelfCombIndx]=getCombinationShelf(t,Z.Shelf)),-1!==currCombinationIndex&&-1!==currShelfCombIndx){var ce=Z.ItemInfo[g_item_index];if(void 0!==ce){ce.ObjID||(ce.ObjID=Math.floor(999999*Math.random()));var pe=[{MIndex:g_module_index,SIndex:g_shelf_index,IIndex:g_item_index,Iobjid:ce.ObjID}];await setCombinedShelfItems(t,currCombinationIndex,currShelfCombIndx,me||o,"Y","N",-1,0,pe,"Y"),pe.length>0&&(g_module_index=pe[0].MIndex,g_shelf_index=pe[0].SIndex,g_item_index=pe[0].IIndex,_e=[g_item_index])}}var ue=[];if("N"==x&&validate_items(Q,ee,oe,_e,Ce,g_module_index,g_shelf_index,g_item_index,ie,ge,ae,le,-1,"N","N","Y","N","N",ue,"Y","Y","Y",t)){var me="",he=-1;""!==g_mousedown_locx&&"undefined"!=typeof g_mousedown_locx&&(me=g_mousedown_locx),he="PEGBOARD"==g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType||"CHEST"==g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjTyp&&"Y"==g_chest_as_pegboard?0:"UNDO"!==e?g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.length-1:g_item_index;let o=await reset_auto_crush(g_module_index,g_shelf_index,-1,t,g_module_index,g_shelf_index,t);console.log(o);S=await set_auto_facings(g_module_index,g_shelf_index,he,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[he],"B","I","D",t);if(x=await recreate_all_items(g_module_index,g_shelf_index,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType,"Y",me,he,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.length,"N","N",-1,-1,g_start_canvas,"",t,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y"),g_cut_copy_arr=[],g_cut_support_obj_arr=[],g_cut_loc_arr=[],loc_details={},g_cut_action_done="N",g_copy_action_done="N",g_dup_action_done="N",g_delete_action_done="N",g_multi_delete_done="N",g_multi_copy_done="N",update_item_distance(g_module_index,g_shelf_index,t),logFinalUndoObjectsInfo("SHELF_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","Y",g_carpark_item_flag),g_allUndoObjectsInfo=[],i="Y",0==g_pog_json[t].ModuleInfo[g_module_index].Carpark[0]?.ItemInfo?.length){var Se=g_scene_objects[t].scene.children[2].getObjectById(g_pog_json[t].ModuleInfo[g_module_index].Carpark[0].SObjID);g_scene_objects[t].scene.children[2].remove(Se),g_pog_json[t].ModuleInfo[g_module_index].Carpark.splice(0,1)}}else{var xe=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.length-1;console.log("l_dup_item","N",l,g_shelf_index,s,a,g_module_index),0==xe&&-1==s?g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.splice(xe,xe+1):xe>0&&-1==s&&g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.splice(xe,1),i="N"}}}}render(t)}}else if("Y"==g_multi_copy_done){var[Oe,Me]=get_multi_item_shelf(g_delete_details,g_delete_details.StartCanvas);if(void 0!==Oe&&void 0!==Me)if(Oe.length>0)for(const e of Oe){var[H,F,w,A]=get_curr_module(Y,R,g_shelf_edit_flag,g_module_index,g_shelf_index,e.ShelfInfo[0],t);g_module_index=H,"TEXTBOX"==e.ObjType&&g_pog_json[t].ModuleInfo.push(e.support_obj[0]),e.ShelfInfo[0].Shelf=g_pog_json[t].ModuleInfo[g_module_index].Module+(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.length+1),g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.push(e.ShelfInfo[0]),g_shelf_index=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.length-1;j=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo;for(const e of j)e.ObjID="";D="N";var[x,b,v]=await context_create_shelfs(e.ShelfInfo[0],-1,-1,g_module_index,g_shelf_index,"N",D,o,"Y","",n,t,-1);C=b;(E=[]).moduleIndex=g_module_index,E.shelfIndex=g_shelf_index,E.actionType="DUPLICATE_SHELF",E.startCanvas=t,E.g_present_canvas=g_start_canvas,E.objectID=C,E.moduleObjectID=g_pog_json[t].ModuleInfo[g_module_index].MObjID,E.module=g_pog_json[t].ModuleInfo[g_module_index].Module,E.push(JSON.parse(JSON.stringify(e.ShelfInfo[0]))),g_allUndoObjectsInfo.push(E),logFinalUndoObjectsInfo("SHELF_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","N")}else if(Me.length>0){if(0!==g_intersects.length)P=g_intersects[0].point.x,N=g_intersects[0].point.y,T=g_intersects[0].point.z;else P=g_pog_json[Me[0].p_pog_index].ModuleInfo[Me[0].MIndex].ShelfInfo[Me[0].SIndex].X,N=g_pog_json[Me[0].p_pog_index].ModuleInfo[Me[0].MIndex].ShelfInfo[Me[0].SIndex].Y,T=g_pog_json[Me[0].p_pog_index].ModuleInfo[Me[0].MIndex].ShelfInfo[Me[0].SIndex].Z;y=new THREE.Vector3(P,N,T);g_scene_objects[t].scene.children[2].worldToLocal(y);Y=Math.min(19,Math.max(-19,y.x)),R=Math.min(19,Math.max(-19,y.y));await update_array_xy_distance(Me,Y,R);L=g_pog_json[Me[0].StartCanvas].ModuleInfo[Me[0].MIndex].ShelfInfo[Me[0].SIndex];g_shelf_edit_flag="N";var[H,F,w,A]=await get_curr_module(Y,R,g_shelf_edit_flag,g_module_index,g_shelf_index,L,t),[F,H,G,B,V,W,X]=await get_div_shelf_index(Y,R,H,F,t,"",!1);if(-1!==W){L=g_pog_json[t].ModuleInfo[H].ShelfInfo[W];g_shelf_edit_flag="N",[currCombinationIndex,currShelfCombIndx]=getCombinationShelf(t,L.Shelf),U=L.SpreadItem,-1!==currCombinationIndex&&-1!==currShelfCombIndx&&("R"==(U=g_combinedShelfs[currCombinationIndex].SpreadItem)?(W=g_combinedShelfs[currCombinationIndex][0].SIndex,H=g_combinedShelfs[currCombinationIndex][0].MIndex):(W=g_combinedShelfs[currCombinationIndex][g_combinedShelfs[currCombinationIndex].length-1].SIndex,H=g_combinedShelfs[currCombinationIndex][g_combinedShelfs[currCombinationIndex].length-1].MIndex))}var je=0;for(const e of Me){if(0==je&&"PEGBOARD"==G)var De=Y+e.XDistance+.01;else if("CHEST"==G&&"Y"==g_chest_as_pegboard)De=Y+e.XDistance;else De=Y+e.XDistance;if("PEGBOARD"==G&&"PEGBOARD"==e.ObjType||"CHEST"==G&&"CHEST"==e.ObjType&&"Y"==g_chest_as_pegboard)var be=R-e.YDistance;else be=R+e.YDistance;e.ItemObj[0].X=De,e.ItemObj[0].Y=be,e.ItemObj[0].DropY=be,je++}if(g_shelf_index=W,g_module_index=H,-1==W){c=0;var[k,z]=await duplicateShelf(o,t);Ce="SHELF",g_shelf_index=k,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType=Ce}else Ce=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType;valid="Y";je=0;var ve=-1,Ee=[];for(const e of Me){if(0==je||g_shelf_index!==ve){ve=g_shelf_index;Z=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index];(E=[]).moduleIndex=g_module_index,E.shelfIndex=g_shelf_index,E.actionType="ITEM_DELETE",E.startCanvas=t,E.g_present_canvas=g_start_canvas,E.objectID=Z.SObjID,E.module=g_pog_json[t].ModuleInfo[g_module_index].Module,E.moduleObjectID=g_pog_json[t].ModuleInfo[g_module_index].MObjID,E.push(JSON.parse(JSON.stringify(Z))),g_allUndoObjectsInfo.push(E)}if(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.push(e.ItemObj[0]),g_item_index=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.length-1,Ee.push({MIndex:g_module_index,SIndex:g_shelf_index,IIndex:g_item_index,ItemID:e.ItemID}),g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].IsCopied="Y","DIVIDER"==e.ItemObj[0].Item){q=Math.floor(999999*Math.random());e.ItemObj[0].ItemID=g_pog_json[t].ModuleInfo[g_module_index].Module+(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.length+1),e.ItemObj[0].ObjID=q,e.support_obj[0].ShelfDivObjID=q,e.support_obj[0].Shelf=g_pog_json[t].ModuleInfo[g_module_index].Module+(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.length+1),g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.push(e.support_obj[0])}"Y"!=g_copy_action_done&&"Y"!=g_cut_action_done&&"Y"!=g_multi_copy_done||(e.ItemObj[0].TopObjID="",e.ItemObj[0].BottomObjID=""),e.ItemObj[0].DfacingUpd="Y",e.ItemObj[0].ObjID="";Q=[],ee=[],oe=[],_e=[];var Ce=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType,B=(ne=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo,te=0,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y);if(ne.length>0){if("SHELF"==Ce||"CHEST"==Ce&&"N"==g_chest_as_pegboard||"BASKET"==Ce||"PALLET"==Ce?te=B+g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].H/2+e.ItemObj[0].H/2:"PEGBOARD"==Ce||"CHEST"==Ce&&"Y"==g_chest_as_pegboard?(te="CHEST"==Ce&&"Y"==g_chest_as_pegboard?B+g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].H/2-e.ItemObj[0].H/2-g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].VertiStart:B+g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].H/2-e.ItemObj[0].H/2-.01-g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].VertiStart,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].FromProductList="N",g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Exists="N"):"HANGINGBAR"==Ce?te=B-e.ItemObj[0].H/2:"ROD"==Ce&&(te=B-g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].H/2-e.ItemObj[0].H/2),void 0!==e.ItemObj[0].BottomObjID&&""!==e.ItemObj[0].BottomObjID||void 0!==e.ItemObj[0].TopObjID&&""!==e.ItemObj[0].TopObjID){ne=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemObj[g_item_index];update_top_bottom_xy(g_module_index,g_shelf_index,g_item_index,ne,t)}else g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Y=te;("PEGBOARD"==Ce||"CHEST"==Ce&&"Y"==g_chest_as_pegboard)&&(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].FromProductList="Y",g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Edited="N");var Pe=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index],Ne=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].HorizGap;if("PEGBOARD"!==Ce&&("CHEST"!=Ce||"Y"!=g_chest_as_pegboard)){Ie=get_item_xaxis(Pe.W,Pe.H,Pe.D,Ce,-1,Ne,U,Ne,g_module_index,g_shelf_index,g_item_index,"PALLET"==Ce?"N":"Y",g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.length,"N",t);g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].X=Ie}ge=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].CrushHoriz,ae=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].CrushHoriz,le=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].CrushD,se=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Fixed;var Te=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].H,ye=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].D;Q.push(wpdSetFixed(e.ItemObj[0].W)),ee.push(wpdSetFixed(e.ItemObj[0].H)),oe.push(wpdSetFixed(e.ItemObj[0].D)),_e.push(g_item_index);ie="N",x="N",de=Ne=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].HorizGap,U=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].SpreadItem,re=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.length,fe=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].AllowAutoCrush;"CHEST"==Ce&&"Y"==g_chest_as_pegboard?console.log("do nothing"):"PEGBOARD"!==Ce&&(x=await item_height_validation(Te,g_module_index,g_shelf_index,g_item_index,"Y",-1,fe,ae,se,"Y",ye,"N",t));S=await set_auto_facings(g_module_index,g_shelf_index,g_item_index,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index],"B","I","D",t);var Ye=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index];let o="N"==Ye.Combine?-1:Ye.Y+Ye.H/2;var Re=-1,Le=-1;if("SHELF"!=Ye.ObjType&&"HANGINGBAR"!=Ye.ObjType||"N"===Ye.Combine||([Re,Le]=getCombinationShelf(t,Ye.Shelf)),-1!==Re&&-1!==Le){var He=Ye.ItemInfo[g_item_index];if(void 0!==He){He.ObjID||(He.ObjID=Math.floor(999999*Math.random()));var Fe=[{MIndex:g_module_index,SIndex:g_shelf_index,IIndex:g_item_index,Iobjid:He.ObjID}];await setCombinedShelfItems(t,Re,Le,o,"Y","N",-1,0,Fe,"Y"),Fe.length>0&&(g_module_index=Fe[0].MIndex,g_shelf_index=Fe[0].SIndex,g_item_index=Fe[0].IIndex,_e=[g_item_index])}}if(reorder_items(g_module_index,g_shelf_index,t)){c=0;for(const o of g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo){if(o.ObjID==e.ItemObj[0].ObjID){g_item_index=c;break}c++}ue=[];if("N"!=x||!validate_items(Q,ee,oe,_e,Ce,g_module_index,g_shelf_index,g_item_index,ie,ge,ae,le,-1,"N","N","Y","N","N",ue,"Y","Y","Y",t)){valid="N";break}}}je++}if(t!=g&&"Y"==g_multi_cnvs_drag_conf&&"N"!=valid){for(const e of Me)r.push(e.ItemID);r=[...new Set(r)],d=await doItemMoveConf(r,g_pog_json,t,Ee)}if("Y"==valid&&"N"!=d){c=0;reset_auto_crush(g_module_index,g_shelf_index,-1,t,g_module_index,g_shelf_index,t),x=await recreate_all_items(g_module_index,g_shelf_index,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType,"Y","",g_item_index,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.length,"N","N",-1,-1,g_start_canvas,"",t,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y"),logFinalUndoObjectsInfo("SHELF_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","Y",g_carpark_item_flag),g_allUndoObjectsInfo=[]}else for(const e of Me){xe=-1,c=0;for(const o of g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo){if(o.ObjID==e.ObjID){xe=c;break}c++}if(xe>-1)0==xe?g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.splice(xe,xe+1):g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.splice(xe,1);else for(const e of Ee)g_pog_json[t].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo.splice(e.IIndex,1)}}g_multi_copy_done="N",g_cut_copy_arr=[],g_cut_support_obj_arr=[],g_cut_loc_arr=[],loc_details={},g_cut_action_done="N",g_copy_action_done="N",g_dup_action_done="N",g_delete_action_done="N",g_multi_delete_done="N",g_multi_copy_done="N",g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[]}else{if("Y"==g_multi_delete_shelf_ind){for(const e of g_delete_details){c=0;for(const o of g_pog_json[t].ModuleInfo)o.MObjID==e.MObjID&&(g_module_index=c),c++;if("SHELF"==e.Object){for(const o of g_cut_copy_arr)(e.ObjID==o.SObjID&&"N"==e.IsDivider||e.ObjID==o.ObjID&&"Y"==e.IsDivider)&&(Oe=o);if("Y"==e.IsDivider)for(const o of g_cut_support_obj_arr)"DIVIDER"==o.ObjType&&o.ShelfDivObjID==e.ObjID&&g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.push(o);else if("TEXTBOX"==e.ObjType)for(const o of g_cut_support_obj_arr)null!==o.ParentModule&&""!==o.ParentModule&&o.ObjID==e.ObjID&&g_pog_json[t].ModuleInfo.push(o)}}for(const e of g_delete_details)if("SHELF"==e.Object&&"N"==e.IsDivider){var Oe;$.each(g_pog_json[t].ModuleInfo,(function(o,_){_.MObjID==e.MObjID&&(g_module_index=o)})),g_shelf_index=e.SIndex;for(const o of g_cut_copy_arr)e.ObjID==o.SObjID&&(Oe=o);g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.push(Oe);g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index];for(const e of g_delete_details)""!==e.ItemID&&g_deletedItems.push(e.ItemID);await deleted_items_log(g_deletedItems,"A",t);var[x,b,v]=await context_create_shelfs(Oe,-1,-1,g_module_index,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.length-1,"N","Y",o,"Y","","Y",t),we=get_min_max_xy(t).split("###");set_camera_z(new_camera,parseFloat(we[2]),parseFloat(we[3]),parseFloat(we[0]),parseFloat(we[1]),g_offset_z,parseFloat(we[4]),parseFloat(we[5]),!0,g_pog_index)}}else{var Ae=-1,$e=-1;Ce="";g_delete_details.keySort({ModuleIndex:"asc",ShefIndex:"asc",ItemIndex:"asc"});var Ge,Be={},Ve=(Pe=g_delete_details,[]);for(c=0;Ge=Pe[c++];)if("ITEM"==Ge.Object){var We=Ge.SIndex;We in Be||(Be[We]=1,Ve.push(We))}for(const e of g_delete_details)if("ITEM"==e.Object){var Me;g_deletedItems.push(e.ItemID),$.each(g_pog_json[t].ModuleInfo,(function(o,_){_.MObjID==e.MObjID&&(g_module_index=o)})),$.each(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo,(function(o,_){_.SObjID==e.SObjID&&(g_shelf_index=o)}));for(const o of g_cut_copy_arr)e.ObjID==o.ObjID&&(Me=o);if(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.splice(e.IIndex,0,Me),(Ae!==e.SIndex&&-1!==Ae||$e!==e.MIndex&&-1!==$e)&&reorder_items($e,Ae,t)){if("SHELF"==Ce)reset_top_bottom_objects($e,Ae,"N",t);x=recreate_all_items($e,Ae,Ce,"Y",-1,-1,g_pog_json[t].ModuleInfo[$e].ShelfInfo[Ae].ItemInfo.length,"N","N",-1,-1,g_start_canvas,"",t,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")}Ae=e.SIndex,$e=e.MIndex,Ce=e.ObjType}S=await deleted_items_log(g_deletedItems,"A",t);if(1==Ve.length&&reorder_items($e,Ae,g_pog_json)){if("SHELF"==Ce||"PALLET"==Ce)reset_top_bottom_objects($e,Ae,"N",t);x=recreate_all_items($e,Ae,Ce,"Y",-1,-1,g_pog_json[t].ModuleInfo[$e].ShelfInfo[Ae].ItemInfo.length,"N","N",-1,-1,g_start_canvas,"",t,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")}}g_cut_copy_arr=[],g_cut_support_obj_arr=[],g_cut_loc_arr=[],loc_details={},g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_action_done="N",g_copy_action_done="N",g_dup_action_done="N",g_delete_action_done="N",g_multi_delete_done="N",g_multi_copy_done="N"}S=await calculateFixelAndSupplyDays("N",t);return render(t),logDebug("function : context_paste","E"),i}}catch(e){error_handling(e)}}async function context_create_module(e,o,_="Y",n,t){logDebug("function : context_create_module","S");try{if(init(n),g_scene_objects[n].scene=g_scene,g_scene_objects[n].renderer=g_renderer,set_indicator_objects(n),g_pog_json[n].ModuleInfo.length>0){var g=g_pog_json[n].ModuleInfo.length-1,a=parseInt(g_pog_json[n].ModuleInfo[g].Color.replace("#","0x"),16),l=new THREE.Color(a),s=0,i=0,d=0;if($.each(g_pog_json[n].ModuleInfo,(function(e,o){null!=o.ParentModule&&void 0!==o.ParentModule||(d+=o.W)})),g_pog_json[n].BaseH>0){a=parseInt(g_pog_json[n].Color.replace("#","0x"),16),l=new THREE.Color(a);g_pog_json[n].BaseW=d,g_pog_json[n].BaseX=d/2;await add_base("BASE1",d,g_pog_json[n].BaseH,g_pog_json[n].BaseD,l,d/2,g_pog_json[n].BaseY,"Y",n)}var r=get_min_max_xy(n).split("###");set_camera_z(g_scene_objects[n].scene.children[0],parseFloat(r[2]),parseFloat(r[3]),parseFloat(r[0]),parseFloat(r[1]),g_offset_z,parseFloat(r[4]),parseFloat(r[5]),!0,n),g_pog_json[n].W=d;for(const e of g_pog_json[n].ModuleInfo){if(null==e.ParentModule||void 0===e.ParentModule){if("Y"==t)a=parseInt(e.Color.replace("#","0x"),16),l=new THREE.Color(a);var f=e.X-e.W/2;0==i?s=e.W/2:s+=e.W/2;var I=s-e.W/2;await create_final_module(e.Module,e.W,e.H,e.D,l,e.Y,"N",e.VertStart,e.VertSpacing,e.HorzStart,e.HorzSpacing,s,i,g_peg_holes_active,n);s+=e.W/2;var c=0;if(e.ShelfInfo.length>0)for(const o of e.ShelfInfo){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType)var[p,u,m]=await context_create_shelfs(o,f,I,i,c,"Y","N",g_scene_objects[n].scene.children[0],"Y","",_,n);c+=1}}i+=1}r=get_min_max_xy(n).split("###");set_camera_z(g_scene_objects[n].scene.children[0],parseFloat(r[2]),parseFloat(r[3]),parseFloat(r[0]),parseFloat(r[1]),g_offset_z,parseFloat(r[4]),parseFloat(r[5]),!0,g_pog_index)}render(n),logDebug("function : context_create_module","E")}catch(e){error_handling(e)}}async function context_create_shelfs(e,o,_,n,t,g,a,l,s,i,d="Y",r,f=0){logDebug("function : context_create_shelfs; old_mod_start : "+o+"; new_mod_start : "+_+"; mod_index : "+n+"; p_shelf_index : "+t+"; mod_edit_ind : "+g+"; same_location : "+a+"; setItemXY : "+s+"; create_canvas : "+i,"S");try{i=void 0===i?-1:i;var I=parseInt(e.Color.replace("#","0x"),16),c=new THREE.Color(I),p=(g_pog_json[r].ModuleInfo[n].ShelfInfo[t].ObjType,0),u=0,m=0;wpdSetFixed(g_pog_json[r].ModuleInfo[n].X-g_pog_json[r].ModuleInfo[n].W/2),wpdSetFixed(g_pog_json[r].ModuleInfo[n].X+g_pog_json[r].ModuleInfo[n].W/2),wpdSetFixed(e.X-e.W/2),wpdSetFixed(e.X+e.W/2);if("Y"==g&&"Y"!==e.SeqChange)u=_+(e.X-o),m=e.Y;else if("N"==a&&"Y"!==e.SeqChange){var h=g_intersects[0].point.x,S=g_intersects[0].point.y,x=g_intersects[0].point.z,O=new THREE.Vector3(h,S,x);g_scene_objects[r].scene.children[2].worldToLocal(O);var M=Math.min(19,Math.max(-19,O.x)),j=Math.min(19,Math.max(-19,O.y));u=-1==f?M:e.X,m=-1==f?j:0!==f?wpdSetFixed(f):g_pog_json[r].ModuleInfo[n].H+g_pog_json[r].BaseH+e.H/2}else u=e.X,m=e.Y;var D="N";for(const o of e.ItemInfo)"Y"==o.Fixed&&(D="Y");for(const o of e.ItemInfo)"M"!=e.SpreadItem&&"Y"!=D&&"PEGBOARD"!=e.ObjType||(o.MDistance=o.X-wpdSetFixed(e.X-e.W/2),H++);if(g_pog_json[r].ModuleInfo[n].ShelfInfo[t].X=u,g_pog_json[r].ModuleInfo[n].ShelfInfo[t].Y=m,"PEGBOARD"==e.ObjType)var b=E=add_pegboard(e.Shelf,e.W,e.H,e.D,c,u,e.Y,.004,"N",e.VertiStart,e.VertiSpacing,e.HorizStart,e.HorizSpacing,n,t,e.Rotation,e.Slope,"N",$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),r);else if("TEXTBOX"==e.ObjType){if("#"==e.Color.charAt(1)&&"TEXTBOX"==e.ObjType)var v=null;else v=I;if("Y"==g_show_live_image&&""!==e.TextImg&&void 0!==e.TextImg&&null!==e.TextImg)b=E=await add_text_box_with_image(e.Shelf,"TEXTBOX",e.W,e.H,e.D,c,u,e.Y,e.Z,"N",n,e.InputText,v,e.WrapText,e.ReduceToFit,e.Color,t,e.Rotation,e.Slope,"N",e.FStyle,e.FSize,e.FBold,$v("P25_NOTCH_HEAD"),r);else b=E=add_text_box(e.Shelf,"TEXTBOX",e.W,e.H,e.D,c,u,e.Y,e.Z,"N",n,e.InputText,v,e.WrapText,e.ReduceToFit,e.Color,t,e.Rotation,e.Slope,"N",e.FStyle,e.FSize,e.FBold,3,r,g_pogcr_enhance_textbox_fontsize,e.TextDirection)}else if("ROD"==e.ObjType){var E;b=E=add_rod(e.Shelf,"SHELF",e.W,e.H,e.D,c,u,e.Y,.004,"N",n,t,r)}else if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&(void 0===g_pog_json[r].ModuleInfo[n].ParentModule||null==g_pog_json[r].ModuleInfo[n].ParentModule)){"BASKET"==e.ObjType||"CHEST"==e.ObjType?"Y"==g_chest_as_pegboard&&"CHEST"==e.ObjType?(p=e.D,e.H=e.D):(p=e.BsktBaseH,e.H=e.BsktBaseH):p=e.H;var[E,C]=await add_shelf(e.Shelf,"SHELF",e.W,p,e.D,c,u,e.Y,.004,"N",n,e.Rotation,e.Slope,t,"N","N","Y",i,$v("P25_POG_CP_SHELF_DFLT_COLOR"),$v("P25_NOTCH_HEAD"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),r);b=E}if(g_pog_json[r].ModuleInfo[n].ShelfInfo[t].SObjID=E,"TEXTBOX"==e.ObjType){var P=-1;$.each(g_pog_json[r].ModuleInfo,(function(o,_){null!==_.ParentModule&&_.Module==e.Shelf&&(P=o)})),-1!==P&&(g_pog_json[r].ModuleInfo[P].ObjID=E,g_pog_json[r].ModuleInfo[P].ShelfInfo[0].X=g_pog_json[r].ModuleInfo[n].ShelfInfo[t].X)}if("N"==g){var N=[],T=[],y=(g_pog_json[r].ModuleInfo[n].ShelfInfo[t].W,g_pog_json[r].ModuleInfo[n].ShelfInfo[t].H,g_pog_json[r].ModuleInfo[n].ShelfInfo[t].D,g_pog_json[r].ModuleInfo[n].ShelfInfo[t].BsktSpreadProduct,g_pog_json[r].ModuleInfo[n].ShelfInfo[t].ItemInfo);e=g_pog_json[r].ModuleInfo[n].ShelfInfo[t];if(y.length>0){var Y=0;N=[],T=[];$.each(y,(function(o,_){if(""==_.BottomObjID||void 0===_.BottomObjID){g_finalY=_.Y;var[g,a]=get_item_xy(e,_,_.W,_.H,r);"Y"==s&&(g_pog_json[r].ModuleInfo[n].ShelfInfo[t].ItemInfo[o].X=g,g_pog_json[r].ModuleInfo[n].ShelfInfo[t].ItemInfo[o].Y=a)}N.push(wpdSetFixed(_.W)),Y=o,T.push(Y),g_pog_json[r].ModuleInfo[n].ShelfInfo[t].ItemInfo[o].Exists="E"}));var[R,L]=getCombinationShelf(r,g_pog_json[r].ModuleInfo[n].ShelfInfo[t].Shelf);-1!==R&&-1!==L&&await setCombinedShelfItems(r,R,L,-1,"N","N",-1,-1,[]),reset_auto_crush(n,t,H,r,n,t,r),await crushItem(r,n,t,Y,"W","Y",-1,-1),console.log("before recreate context"),reorder_items(n,t,r)&&(E=await recreate_all_items(n,t,e.ObjType,"Y",-1,-1,e.ItemInfo.length,"N","N",-1,-1,i,"",r,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")),g_pog_json[r].ModuleInfo[n].EditFlag="Y"}}else if(("N"==d&&g_pog_json[r].ModuleInfo.length-1!=n||"Y"==d)&&e.ItemInfo.length>0){"CHEST"!==(e=g_pog_json[r].ModuleInfo[n].ShelfInfo[t]).ObjType&&await reset_auto_crush(n,t,-1,r,n,t,r);var H=0;for(const o of e.ItemInfo)"M"!=e.SpreadItem&&"Y"!=D&&"PEGBOARD"!=e.ObjType||(o.X=wpdSetFixed(e.X-e.W/2)+o.MDistance,H++);reorder_items(n,t,r)&&(E=await recreate_all_items(n,t,e.ObjType,"Y",-1,-1,e.ItemInfo.length,"N","N",-1,-1,i,"",r,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y"))}return logDebug("function : context_create_shelfs","E"),[E,b,C]}catch(e){error_handling(e)}}async function context_create_items(e,o,_,n,t,g,a,l,s,i){logDebug("function : context_create_items; mod_index : "+o+"; p_shelf_index : "+_+"; i_item_index : "+n+"; shelf_start : "+t+"; mod_edit_ind : "+g+"; shelfY : "+a,"S");try{var d=0,r=0,f=g_pog_json[i].ModuleInfo[o].ShelfInfo[_],I=(f.ObjType,f.BsktSpreadProduct,f.X,f.W,f.H,f),c=g_pog_json[i].ModuleInfo[o].ShelfInfo[_].ItemInfo[n];if("Y"==s){var[d,r]=get_item_xy(I,e,e.W,e.H,i);if(""==e.BottomObjID||void 0===e.BottomObjID)c.X=d,c.Y=r;else{var p=get_shelf_item_ind(o,_,e.BottomObjID,i);c.X=g_pog_json[i].ModuleInfo[o].ShelfInfo[_].ItemInfo[p].X,c.Y=g_pog_json[i].ModuleInfo[o].ShelfInfo[_].ItemInfo[p].Y+g_pog_json[i].ModuleInfo[o].ShelfInfo[_].ItemInfo[p].H/2+e.H/2,d=c.X,r=c.Y}}else d=e.X,r=e.Y;if("Y"==g_show_live_image)var u=g_orientation_json[e.Orientation].split("###"),m=await add_items_with_image(e.ItemID,e.W,e.H,e.D,e.Color,d,r,e.Z,o,_,n,e.BHoriz,e.BVert,e.Item,parseInt(u[0]),parseInt(u[1]),"N","N",$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),i);else if("DIVIDER"==e.Item)m=add_items(e.ItemID,e.W,e.H,e.D,e.Color,d,r,e.Z,o,_,n,e.Rotation,i);else m=await add_items_prom(e.ItemID,e.W,e.H,e.D,e.Color,d,r,e.Z,o,_,n,"N","N",$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),i);for(const n of g_pog_json[i].ModuleInfo[o].ShelfInfo[_].ItemInfo)n.BottomObjID==e.ObjID&&(n.BottomObjID=m),n.TopObjID==e.ObjID&&(n.TopObjID=m);c.ObjID=m;c.DimUpdate,g_scene_objects[i].scene.children[2].getObjectById(m);g_pog_json[i].ModuleInfo[o].EditFlag="Y",logDebug("function : context_create_items","E")}catch(e){error_handling(e)}}function context_edit(e="N"){logDebug("function : context_edit","S");try{"Y"==g_carpark_item_flag?g_object_hit_ind="I":"Y"==g_module_edit_flag?g_object_hit_ind="M":"Y"==g_shelf_edit_flag?g_object_hit_ind="S":"Y"==g_item_edit_flag?(g_object_hit_ind="I",g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Exists="E"):g_object_hit_ind="B",g_dblclick_objid=g_objectHit_id,g_dblclick_opened="Y",open_edit_modal_popup(g_object_hit_ind,g_module_index,g_shelf_index,"N",g_pog_index,e),logDebug("function : context_edit","E")}catch(e){error_handling(e)}}function context_duplicate(){logDebug("function : context_duplicate","S");try{"Y"==g_shelf_edit_flag?(g_object_hit_ind="S","SHELF"==g_shelf_object_type?$("#DELETE_SHELF").css("display","none"):$("#DELETE_TEXT").css("display","none")):"Y"==g_item_edit_flag&&"DIVIDER"==g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Item&&(g_object_hit_ind="I",$("#DELETE_DIVIDER").css("display","none"),g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Exists="E"),g_dblclick_objid=g_objectHit_id,$s("P25_MODULE_DISP",g_module_index),g_duplicate_fixel_flag="Y",open_edit_modal_popup(g_object_hit_ind,g_module_index,g_shelf_index,"Y",g_pog_index),logDebug("function : context_duplicate","E")}catch(e){error_handling(e)}}async function context_func(e,o){if(logDebug("function : context_func; action : "+e,"S"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0)if("copy_pogc_image"!=e&&"zoom_selected_pogc"!=e&&"N"==g_module_edit_flag&&"N"==g_shelf_edit_flag&&"N"==g_item_edit_flag&&"edit"!==e&&"Y"!==g_multiselect&&"muledit"!==e)alert(get_message("NO_OBJECT_ERROR"));else if(g_pog_edited_ind="Y","duplicate"==e)context_duplicate();else if("delete"==e)context_delete("DELETE",g_module_index,g_shelf_index,g_item_index,g_item_edit_flag,g_module_edit_flag,g_shelf_edit_flag,g_objectHit_id,"",g_delete_details,g_camera,g_pog_index,"N");else if("edit"==e)context_edit("N");else if("muledit"==e)context_edit("M");else if("cut"==e)context_cut(g_pog_index);else if("copy"==e&&"N"==g_multiselect)context_copy("S",g_pog_index);else if("copy"==e&&"Y"==g_multiselect)context_copy("M",g_pog_index);else if("paste"!=e||"Y"!=g_cut_action_done&&"Y"!=g_copy_action_done&&"Y"!=g_multi_copy_done)"copy_pogc_image"==e?downloadPOGImage():"zoom_selected_pogc"==e&&(-1==g_module_index?reset_zoom():select_zoom_init());else{var _="";_="Y"==g_cut_action_done?"CUT":"COPY",await context_paste(_,g_camera,"N","Y",g_pog_index),"RESET_PASTE"==o&&(g_copy_action_done="N")}g_taskItemInContext="",g_context_opened="N",logDebug("function : context_func","E")}function open_edit_location_init(e){logDebug("function : open_edit_location_init","S"),open_edit_location(g_pog_index,e),logDebug("function : open_edit_location_init","E")}function open_edit_location(e,o){if(logDebug("function : open_edit_location","S"),g_dblclick_opened="Y",$s("P25_TYPE",o),"I"==o)$("#P25_FIXEL_NOTCH_CONTAINER").css("display","none"),$("#P25_Z_LOCATION_CONTAINER").css("display","none"),$s("P25_X_LOCATION",(100*g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].X-100*g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].W/2).toFixed(2)),$s("P25_Y_LOCATION",(100*g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Y-100*g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].H/2).toFixed(2));else{$("#P25_FIXEL_NOTCH").css("display","block"),$("#P25_Z_LOCATION").css("display","block");var _=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X-g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].W/2;if($s("P25_FIXEL_NOTCH",g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].NotchNo),_>=0&&g_pog_json[e].ModuleInfo[g_module_index].NotchW>0?$("#P25_FIXEL_NOTCH").removeClass("apex_disabled"):$("#P25_FIXEL_NOTCH").addClass("apex_disabled"),""===g_item_index||-1===g_item_index||"undefined"==typeof g_item_index){$s("P25_X_LOCATION",(100*g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X-100*g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].W/2).toFixed(2));var n=100*g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y-100*g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].H/2;$s("P25_Y_LOCATION",n.toFixed(2)),"TEXTBOX"!==g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType?$s("P25_Z_LOCATION",(100*g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Z-100*g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].D/2).toFixed(2)):($s("P25_Z_LOCATION",(100*g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Z).toFixed(2)),g_edit_textboxZ=(100*g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Z).toFixed(2)/100),apex.item("P25_X_LOCATION").setFocus()}else{$s("P25_X_LOCATION",(100*g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].X-100*g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].W/2).toFixed(2));n=100*g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Y-100*g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].H/2;$s("P25_Y_LOCATION",n.toFixed(2)),$s("P25_Z_LOCATION",(100*g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Z).toFixed(2)),g_edit_textboxZ=(100*g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Z).toFixed(2)/100,apex.item("P25_X_LOCATION").setFocus()}}openInlineDialog("edit_location_modal",40,40),$s("P25_LOCATION_CNG","N"),logDebug("function : open_edit_location","E")}async function update_edit_location(e,o,_,n,t,g,a,l,s,i="Y"){logDebug("function : update_edit_location; newX : "+e+"; newY : "+o+"; newZ : "+_+"; p_module_index : "+n+"; p_shelf_index : "+t+"; fixel_notch : "+g+"; edit_flag : "+a,"S");try{var d;g_pog_edited_ind="Y";var r=g_scene_objects[s].scene.children[2].getObjectById(g_pog_json[s].ModuleInfo[n].ShelfInfo[t].SObjID),f=g_pog_json[s].ModuleInfo[n].ShelfInfo[t].AllowAutoCrush,I=g_pog_json[s].ModuleInfo[n].ShelfInfo[t].ObjType,c=-1,p=g_pog_json[s].ModuleInfo[n].ShelfInfo[t].ItemInfo;undoObjectsInfo=[],undoObjectsInfo.push(JSON.parse(JSON.stringify(g_pog_json[s].ModuleInfo[n].ShelfInfo[t])));var u=g_pog_json[s].ModuleInfo[n].ShelfInfo[t].SObjID;undoObjectsInfo.moduleIndex=n,undoObjectsInfo.shelfIndex=t,undoObjectsInfo.actionType="SHELF_DRAG",undoObjectsInfo.startCanvas=g_start_canvas,undoObjectsInfo.objectID=u,undoObjectsInfo.Z=r.position.z,undoObjectsInfo.g_deletedItems=[];var m=wpdSetFixed(g_pog_json[s].ModuleInfo[n].ShelfInfo[t].Z)!==wpdSetFixed(_)?"N":"Y";g_pog_json[s].ModuleInfo[n].ShelfInfo[t].EditNotch="N";var h=e-g_pog_json[s].ModuleInfo[n].ShelfInfo[t].W/2,S=e+g_pog_json[s].ModuleInfo[n].ShelfInfo[t].W/2;$.each(g_pog_json[s].ModuleInfo,(function(o,_){if((null==_.ParentModule||"undefined"==_.ParentModule)&&e>_.X-_.W/2&&e<_.X+_.W/2)return c=o,!1})),-1==c&&($.each(g_pog_json[s].ModuleInfo,(function(e,o){if((null==o.ParentModule||"undefined"==o.ParentModule)&&(o.X+o.W/2>h&&o.X-o.W/2<=h||o.X-o.W/2<=S&&o.X-o.W/2>=h))return c=e,!1})),-1==c&&$.each(g_pog_json[s].ModuleInfo,(function(e,o){if(null==o.ParentModule||"undefined"==o.ParentModule)return c=e,!1}))),g>0&&(-1==c&&(c=n),e=g_pog_json[s].ModuleInfo[c].X-g_pog_json[s].ModuleInfo[c].W/2+g_pog_json[s].ModuleInfo[n].ShelfInfo[t].W/2,o=g_pog_json[s].BaseH+g_pog_json[s].ModuleInfo[c].NotchStart+g_pog_json[s].ModuleInfo[c].NotchSpacing*(g-1)-g_pog_json[s].ModuleInfo[n].ShelfInfo[t].H/2,wpdSetFixed(o+g_pog_json[s].ModuleInfo[c].ShelfInfo[t].H/2)<=wpdSetFixed(g_pog_json[s].BaseH+g_pog_json[s].ModuleInfo[c].NotchStart/2)&&(o=wpdSetFixed(g_pog_json[s].BaseH+g_pog_json[s].ModuleInfo[c].ShelfInfo[t].H/2)),_=g_pog_json[s].ModuleInfo[c].ShelfInfo[t].Z,g_pog_json[s].ModuleInfo[c].ShelfInfo[t].EditNotch="Y",g_pog_json[s].ModuleInfo[c].ShelfInfo[t].EditNotchY=wpdSetFixed(o-g_pog_json[s].ModuleInfo[n].ShelfInfo[t].H/2-g_pog_json[s].BaseH-g_pog_json[s].ModuleInfo[c].NotchSpacing/2)),undoObjectsInfo.module=g_pog_json[s].ModuleInfo[c].Module,undoObjectsInfo.moduleObjectID=g_pog_json[s].ModuleInfo[c].MObjID,g_allUndoObjectsInfo.push(undoObjectsInfo),logFinalUndoObjectsInfo("SHELF_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","N"),g_allUndoObjectsInfo=[];g_pog_json[s].ModuleInfo[n].ShelfInfo[t].ItemInfo,await set_auto_facings(n,t,-1,p,"B","S","D",s);if("TEXTBOX"!==I)var x=g_pog_json[s].ModuleInfo[n].ShelfInfo[t],O=validate_shelf_min_distance(c,t,o,p,f,n,e,"Y",x,s);else O="Y";if("Y"==O||"R"==O){g_pog_json[s].ModuleInfo[n].ShelfInfo[t].X,g_pog_json[s].ModuleInfo[n].ShelfInfo[t].Y,g_pog_json[s].ModuleInfo[n].ShelfInfo[t].Z;g_pog_json[s].ModuleInfo[n].ShelfInfo[t].X=wpdSetFixed(e),g_pog_json[s].ModuleInfo[n].ShelfInfo[t].Y=wpdSetFixed(o),g_pog_json[s].ModuleInfo[n].ShelfInfo[t].Z=wpdSetFixed(_),"TEXTBOX"==I?"N"==m?(d=_>.0021?.0021:0==_?6e-4:_,"N"!=i&&(g_pog_json[s].ModuleInfo[n].ShelfInfo[t].ManualZupdate="Y"),d=textboxPriorityPlacing(r,s,_)):d=r.position.z:d="PEGBOARD"==I?.003:"DIVIDER"==I?.001:0==nvl(d)?.005:d;g_pog_json[s].ModuleInfo[c].NotchSpacing>0&&g_pog_json[s].ModuleInfo[c].NotchSpacing;r.position.set(e,o,d),g_scene.updateMatrixWorld(),await set_all_items(n,t,e,o,"Y","N","Y",s,s);var M=g_pog_json[s].ModuleInfo[n].ShelfInfo[t].Rotation;if("N"==g_manual_zoom_ind){var j=get_min_max_xy(s).split("###");set_camera_z(l,parseFloat(j[2]),parseFloat(j[3]),parseFloat(j[0]),parseFloat(j[1]),g_offset_z,parseFloat(j[4]),parseFloat(j[5]),!0,g_pog_index)}0!==M&&(r.quaternion.copy(l.quaternion),r.lookAt(g_pog_json[s].CameraX,g_pog_json[s].CameraY,g_pog_json[s].CameraZ),r.rotateY(M*Math.PI/180),"TEXTBOX"==g_pog_json[s].ModuleInfo[n].ShelfInfo[t].ObjType?0==M?r.rotateX(slope/2*Math.PI/180):r.rotateX(slope*Math.PI/180):r.rotateX(g_slope*Math.PI/180),r.updateMatrix());var[D,b]=await set_shelf_after_drag(O,"Y",n,c,t,e,o,"Y",m,"","",s,s);if("TEXTBOX"!==I)var[v,E]=find_top_notch(n,t,o,e,g_drag_shelf_notch,s);if(g_undo_details=[],g_undo_obj_arr=[],g_undo_supp_obj_arr=[],"PALLET"!==I&&await generateCombinedShelfs(s,D,b,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y","","Y"),"Y"==g_show_max_merch&&"Y"==a){!async function(){await add_merch("N",s),await add_merch("Y",s)}()}if("Y"==g_show_notch_label)update_single_notch_label("Y",D,b,$v("P25_NOTCH_HEAD"),"",s,"N");"Y"==g_fixel_label&&update_single_fixel_label(g_pog_json[s].ModuleInfo[D].ShelfInfo[b],s,D,b),async function(){await recreate_compare_views(g_compare_view,"N")}(),p.length>0&&(g_pog_json[s].ModuleInfo[D].EditFlag="Y")}else{g_pog_json[s].ModuleInfo[n].ShelfInfo[t].EditNotch="N",g_pog_json[s].ModuleInfo[n].ShelfInfo[t].EditNotchY="";x=g_pog_json[s].ModuleInfo[n].ShelfInfo[t];await set_all_items(n,t,x.X,x.Y,"Y","E","Y",s,s)}return render(s),"Y"==g_show_live_image&&animate_all_pog(),g_context_opened="N","Y"==a&&closeInlineDialog("edit_location_modal"),g_dblclick_opened="N",logDebug("function : update_edit_location","E"),"SUCESS"}catch(e){error_handling(e)}}function delete_items(e,o){return logDebug("function : delete_items; delete_obj : "+e,"S"),new Promise((function(_,n){var t=g_pog_json[o].ModuleInfo;"N"==e&&(g_pog_json[o].POGCode="",g_pog_json[o].Name=""),$.each(t,(function(_,n){void 0!==n.ParentModule&&null!=n.ParentModule||$.each(n.ShelfInfo,(function(n,t){var g={},a="N";"Y"==e?$.each(t.ItemInfo,(function(e,_){if("DIVIDER"!==_.Item){g_deletedItems.push(_.ItemID);var n=g_scene_objects[o].scene.children[2].getObjectById(_.ObjID);g_scene_objects[o].scene.children[2].remove(n),void 0!==g_pog_json[o].DeleteItems&&g_pog_json[o].DeleteItems.push(_)}else g=_,a="Y"})):$.each(t.ItemInfo,(function(e,o){"DIVIDER"==o.Item&&(g=o,a="Y")})),g_pog_json[o].ModuleInfo[_].ShelfInfo[n].ItemInfo=[],"Y"==a&&g_pog_json[o].ModuleInfo[_].ShelfInfo[n].ItemInfo.push(g)}))}));deleted_items_log(g_deletedItems,"D",o);_("SUCCESS"),logDebug("function : delete_items","E")}))}async function clear_pog_info(){if(logDebug("function : clear_pog_info","S"),g_pog_edited_ind="Y",$(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),$(".clear_pog_info").addClass("active"),g_prev_undo_action="CLEAR_POG_INFO","Y"==g_all_pog_flag)var e=0;else e=g_pog_index;for(pogInfo of g_pog_json){if(e!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex){await clear_item("Y","Y",e);clear_pog_att("Y","Y",e)}if("Y"!=g_all_pog_flag)break;e++}apex.message.showPageSuccess(g_pog_refresh_msg),logDebug("function : clear_pog_info","E")}async function clear_item_init(e){if(logDebug("function : clear_item_init; info_called : "+e,"S"),"Y"==g_all_pog_flag)var o=0;else o=g_pog_index;for(pogInfo of g_pog_json){if(o!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex)await clear_item(e,"N",o);if("Y"!=g_all_pog_flag)break;o++}logDebug("function : clear_item_init","E")}async function clear_item(e,o,_){logDebug("function : clear_item; info_called : "+e+"; p_clearInfoType : "+o,"S");try{g_pog_edited_ind="Y","N"==e&&($(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),$(".clear_item").addClass("active"));var n="N"==e?"CLEAR_ITEM":"CLEAR_POG_INFO",t=g_pog_json[_].ModuleInfo;g_undo_obj_arr=[],g_undo_details=[],g_undo_supp_obj_arr=[];var g=[],a=[];if("CLEAR_POG_INFO"==n){var l={};l.OldPOGCode=g_pog_json[_].POGCode,l.OldPOGName=g_pog_json[_].Name,l.OldPOGDivision=g_pog_json[_].Division,l.OldPOGDept=g_pog_json[_].Dept,l.OldPOGSubDept=g_pog_json[_].SubDept,l.OldEffStartDate=g_pog_json[_].EffStartDate}return $.each(t,(function(e,o){void 0!==o.ParentModule&&null!=o.ParentModule||(g_pog_json[_].ModuleInfo[e].EditFlag="Y",$.each(o.ShelfInfo,(function(o,n){if(n.ItemInfo.length>0){$.each(n.ItemInfo,(function(e,o){a.push(o.ItemID)}));var t=g_pog_json[_].ModuleInfo[e].ShelfInfo[o].SObjID;g.moduleIndex=e,g.module=g_pog_json[_].ModuleInfo[e].Module,g.shelfIndex=o,g.pogInfo=l,g.actionType="ITEM_DELETE",g.startCanvas=g_start_canvas,g.objectID=t,g.g_deletedItems=a,g.moduleObjectID=g_pog_json[_].ModuleInfo[e].MObjID,g.push(JSON.parse(JSON.stringify(g_pog_json[_].ModuleInfo[e].ShelfInfo[o]))),g_allUndoObjectsInfo.push(g),g=[]}})))})),await delete_items("Y",_),logFinalUndoObjectsInfo("ITEM_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","N"),g_allUndoObjectsInfo=[],showFixelAvailableSpace("N","N",_),render(_),await recreate_compare_views(g_compare_view,"N"),apex.message.showPageSuccess(g_pog_refresh_msg),logDebug("function : clear_item","E"),"SUCCESS"}catch(e){error_handling(e)}}function clear_pog_att_init(e){if(logDebug("function : clear_pog_att_init; info_called : "+e,"S"),"Y"==g_all_pog_flag)var o=0;else o=g_pog_index;for(pogInfo of g_pog_json){if((o!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex)&&clear_pog_att(e,"Y",o),"Y"!=g_all_pog_flag)break;o++}logDebug("function : clear_pog_att_init","E")}function clear_pog_att(e,o,_){logDebug("function : clear_pog_att; info_called : "+e+"; p_clearInfoType : "+o,"S");var n={};try{g_pog_edited_ind="Y","N"==e&&($(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),$(".clear_pog_att").addClass("active"),g_prev_undo_action="CLEAR_POG_ATT"),$s("P25_POG_DIVISION","");try{var t=g_pog_json[_].ModuleInfo;$.each(t,(function(e,o){void 0!==o.ParentModule&&null!=o.ParentModule||(g_pog_json[_].ModuleInfo[e].OldPOGModuleSubDept=g_pog_json[_].ModuleInfo[e].SubDept,g_pog_json[_].ModuleInfo[e].SubDept="")}))}catch(e){error_handling(e)}n.OldPOGCode=g_pog_json[_].POGCode,n.OldPOGName=g_pog_json[_].Name,n.OldPOGDivision=g_pog_json[_].Division,n.OldPOGDept=g_pog_json[_].Dept,n.OldPOGSubDept=g_pog_json[_].SubDept,n.OldEffStartDate=g_pog_json[_].EffStartDate,g_pog_json[_].POGCode="",g_pog_json[_].Name="",g_pog_json[_].Division="",g_pog_json[_].Dept="",g_pog_json[_].SubDept="",g_pog_json[_].EffStartDate="","CLEAR_POG_ATT"==g_prev_undo_action&&(g_undo_details.push(n),g_delete_details.multi_delete_shelf_ind="N",g_undo_all_obj_arr=[],g_undo_all_obj_arr.push(g_undo_details),g_undo_all_obj_arr.push(g_cut_copy_arr),g_undo_all_obj_arr.previousAction=g_prev_undo_action,g_undo_all_obj_arr.clearInfoType=o,g_cut_support_obj_arr.length>0?g_redo_all_obj_arr.hasSupportArr="Y":g_redo_all_obj_arr.hasSupportArr="N",g_undo_all_obj_arr.g_MultiObjects="N",g_undo_all_obj_arr.multi_delete_shelf_ind="N",g_undo_final_obj_arr.push(g_undo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]),apex.message.showPageSuccess(g_pog_refresh_msg),logDebug("function : clear_pog_att","E")}catch(e){error_handling(e)}}function validate_pog_detail(e,o){logDebug("function : validate_pog_detail; template_check : "+e,"S");var _="N",n=g_pog_json[o].ModuleInfo;return $.each(n,(function(e,o){if((void 0===o.ParentModule||null==o.ParentModule)&&""==o.SubDept)return _="Y",!1})),logDebug("function : validate_pog_detail","E"),""==g_pog_json[o].POGCode&&"N"==e||"Y"==_||""==g_pog_json[o].Division||""==g_pog_json[o].Dept||""==g_pog_json[o].SubDept?"Y":"N"}async function check_module_change(e,o,_,n){return logDebug("function : check_module_change; p_module_index : "+e+"; pog_code : "+o+"; pog_version : "+_,"S"),new Promise((function(e,t){var g=JSON.stringify(g_pog_json[n]);apex.server.process("CHECK_MODULE_CHANGE",{x01:o,x02:_,p_clob_01:g},{dataType:"text",success:function(o){""!=$.trim(o)&&(logDebug("function : create_change_textbox","E"),e($.trim(o)))}})}))}async function create_change_textbox(e,o,_,n,t){logDebug("function : create_change_textbox; module_change : "+e+"; module_name : "+o+"; shelfy : "+_+"; p_module_index : "+n,"S");var g={};return g.Shelf=$v("P25_POGCR_MODULE_CHANGE_ID")+o.toUpperCase(),g.ObjType="TEXTBOX",g.Desc="",g.MaxMerch=0,g.GrillH=0,g.LOverhang=0,g.ROverhang=0,g.SpacerThick=0,g.HorizGap=0,g.SpreadItem="L",g.Combine="N",g.AllowAutoCrush="N",g.H=.1,g.W=g_pog_json[t].ModuleInfo[n].W,g.D=.01,g.Rotation=0,g.Slope=0,g.Color="#FFFFFF",g.LiveImage="",g.HorizSlotStart=0,g.HorizSlotSpacing=0,g.HorizStart=0,g.HorizSpacing=0,g.UOverHang=0,g.LoOverHang=0,g.VertiStart=0,g.VertiSpacing=0,g.X=g_pog_json[t].ModuleInfo[n].X,g.Y=_,g.Z=g_pog_json[t].BackDepth/2+.005+g_pog_json[t].BaseD,g.InputText="Y"==e?get_message("POGCR_MOD_CHANGE_Y"):get_message("POGCR_MOD_CHANGE_N"),g.WrapText="Y",g.ReduceToFit="Y",g.TextDirection="H",g.BsktFill="",g.BsktSpreadProduct="",g.SnapTo="",g.BsktWallH=0,g.BsktBaseH=0,g.BsktWallThickness=0,g.DSlotStart=0,g.DSlotSpacing=0,g.DGap=0,g.FrontOverHang=0,g.BackOverHang=0,g.SlotDivider="",g.AllowOverLap="N",g.AutoPlacing="N",g.SlotOrientation="",g.DividerFixed="N",g.LObjID=-1,g.NotchLabelObjID=-1,g.FStyle="Arial",g.FSize=$v("P25_POGCR_TEXT_DEFAULT_SIZE"),g.FBold="",g.TextImg="",g.TextImgName="",g.TextImgMime="",g.ItemInfo=[],g_pog_json[t].ModuleInfo[n].ShelfInfo.push(g),logDebug("function : create_change_textbox","E"),"SUCCESS"}async function update_textbox_change(e,o){if(logDebug("function : update_textbox_change","S"),""!==e[o].Version&&void 0!==e[o].Version&&null!==e[o].Version&&"Y"==$v("P25_POGCR_MODULE_CHANGE_NEED")){var _=get_min_max_xy(o).split("###"),n=e[o].ModuleInfo,t=0,g=[],a=await check_module_change(t,e[o].POGCode,e[o].Version,o);console.log("change_list",a);try{g=JSON.parse(a)}catch{console.log("errored",a)}for(const a of n){if(void 0===a.ParentModule||null==a.ParentModule){for(const e of g)if(e.Module==a.Module){c=e.Value;break}var l=a.ShelfInfo,s=0,i="N";console.log("returnval",c);for(const e of l){if("TEXTBOX"==e.ObjType&&e.Shelf.startsWith($v("P25_POGCR_MODULE_CHANGE_ID"))){i="Y","Y"==c?e.InputText=get_message("POGCR_MOD_CHANGE_Y"):"N"==c&&(e.InputText=get_message("POGCR_MOD_CHANGE_N"));var d=parseInt(e.Color.replace("#","0x"),16),r=new THREE.Color(d),f=d;g_shelf_index=s,e.ManualZupdate="Y",g_dblclick_objid=e.SObjID;var I=await add_text_box(e.Shelf,"TEXTBOX",e.W,e.H,e.D,r,e.X,e.Y,e.Z,"Y",t,e.InputText,f,e.WrapText,e.ReduceToFit,e.Color,s,e.Rotation,e.Slope,"N",e.FStyle,e.FSize,e.FBold,2,o,g_pogcr_enhance_textbox_fontsize,e.TextDirection);e.SObjID=I;break}s+=1}if("N"==i){var c=await create_change_textbox(c,a.Module,parseFloat(_[5])-.05,t,o),p=e[o].ModuleInfo[t].ShelfInfo[e[o].ModuleInfo[t].ShelfInfo.length-1];d=parseInt(p.Color.replace("#","0x"),16),r=new THREE.Color(d),f=d,I=add_text_box(p.Shelf,"TEXTBOX",p.W,p.H,p.D,r,p.X,p.Y,p.Z,"N",t,p.InputText,f,p.WrapText,p.ReduceToFit,p.Color,e[o].ModuleInfo[t].ShelfInfo.length-1,p.Rotation,p.Slope,"N",p.FStyle,p.FSize,p.FBold,2,o,g_pogcr_enhance_textbox_fontsize);p.SObjID=I}}t+=1}render(o),logDebug("function : update_textbox_change","E")}}async function update_pog_json(e){return logDebug("function : update_pog_json","S"),new Promise((function(o,_){updPog=[],updPog.push(g_pog_json[e]),apex.server.process("UPDATE_JSON",{x01:g_pog_json[e].POGCode,x02:g_pog_json[e].Version,p_clob_01:JSON.stringify(updPog)},{dataType:"html"}).done((function(e){logDebug("function : update_pog_json","E"),o($.trim(e))}))}))}async function check_workflow_setup(e){return logDebug("function : check_workflow_setup; p_pog_code : "+e,"S"),new Promise((function(o,_){apex.server.process("WORKFLOW_CHECK",{x01:e},{dataType:"html"}).done((function(e){o($.trim(e))})),logDebug("function : check_workflow_setup","E")}))}async function save_pog_final(e){logDebug("function : save_pog_final","S");try{"N"==g_show_live_image&&await clearHighlight();var o,_,n,t=[],g={},a=[],l="N",s="N",i="N";if(g_ispog_savingerror="N",g_pog_saving_error_msg="","N"==g_all_pog_flag)var d=g_pog_index;else d=0;for(const e of g_pog_json)if(d!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex){if(l="N",_="",t[0]=g_pog_json[d],g_scene_objects[d].scene.children[0],o=g_scene_objects[d].scene.children[2],void 0!==t&&t.length>0)if($s("P25_OPEN_DRAFT","N"),$s("P25_PRODUCT_BTN_CLICK","N"),"Y"==validate_pog_detail("N",d))g_ispog_savingerror="Y",l="Y",_=_=_+"</br> POG Code: "+t[0].POGCode+" "+get_message("ENTER_MADATORY_POG_DETAIL"),g_pog_saving_error_msg="POG Code: "+t[0].POGCode+" "+get_message("ENTER_MADATORY_POG_DETAIL");else{var r=t[0].ModuleInfo,f=0,I="Y";for(const e of r){if(void 0===e.ParentModule||null==e.ParentModule){t[0].ModuleInfo[f].Carpark=[];var c=e.ShelfInfo,p=0;for(const e of c){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.ItemInfo.length>0){var u=e.ItemInfo,m=0;for(const e of u)t[0].ModuleInfo[f].ShelfInfo[p].ItemInfo[m].DimUpdate="N",m+=1}p+=1}}f+=1}I="Y",r=t[0].ModuleInfo,f=0;var h=[];logDebug("function : item_validation ","S");for(const e of r){if(void 0===e.ParentModule||null==e.ParentModule){for(const _ of e.Carpark){var S=o.getObjectById(_.SObjID);o.remove(S);for(const e of _.ItemInfo){S=o.getObjectById(e.ObjID);o.remove(S)}}t[0].ModuleInfo[f].Carpark=[];c=e.ShelfInfo,p=0;g_pog_json[d]=t[0];for(const e of c){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.ItemInfo.length>0){u=e.ItemInfo,m=0;for(const e of u){if("Y"!==t[0].ModuleInfo[f].ShelfInfo[p].ItemInfo[m].DimUpdate&&"E"!==t[0].ModuleInfo[f].ShelfInfo[p].ItemInfo[m].DimUpdate){if(check_dim_difference(f,p,m,d)){e.PIndex=d,g_errored_items.push(e);var x={};x.MIndex=f,x.SIndex=p,x.IIndex=m,x.Item=e.Item,h.push(x)}}else"E"==t[0].ModuleInfo[f].ShelfInfo[p].ItemInfo[m].DimUpdate&&(I="N");m+=1}}p+=1}}f+=1}h.keySort({MIndex:"asc",SIndex:"asc",IIndex:"asc"});var O=-1,M=-1;p=0,p=0;for(const e of h){var j=t[0].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex];if("Y"!==j.DimUpdate&&"E"!==j.DimUpdate&&"PEGBOARD"!==e.ObjType)"N"==await org_dim_update_shelf(e.MIndex,e.SIndex,e.IIndex,j,e.Item,"N",d)?(I="N",h[p].RecreateShelf="N"):h[p].RecreateShelf="Y";p++}for(const e of h){if("Y"==e.RecreateShelf&&(O!==e.MIndex&&M!==e.SIndex||O==e.MIndex&&M!==e.SIndex)&&reorder_items(e.MIndex,e.SIndex,d))await recreate_all_items(e.MIndex,e.SIndex,t[0].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ObjType,"Y",-1,-1,t[0].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo.length,"Y","N",-1,-1,g_start_canvas,"N",d,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y");O=e.MIndex,M=e.SIndex}render(d);var D=0;for(const e of t[0].ModuleInfo){if((void 0===e.ParentModule||null==e.ParentModule)&&null!==e.ShelfInfo){p=0;for(const o of e.ShelfInfo){if("BASE"==o.ObjType&&t[0].ModuleInfo[D].ShelfInfo.splice(p,1),"undefined"!=typeof g_combinedShelfs&&g_combinedShelfs.length>0&&g_combinedShelfs.length>0){m=0;for(combination of g_combinedShelfs){for(shelf_info of combination)shelf_info.Shelf==o.Shelf&&d==shelf_info.PIndex&&(shelf_info.SIndex=p);m++}}p+=1}}D+=1}if("Y"==$v("P25_POGCR_VALIDATE_OVERHUNG")&&([s,i]=await identifyOverhungItems(d,"Y","N")),"Y"==i||"Y"==s)g_ispog_savingerror="Y",I="N",l="Y",_=_=_+"</br> POG Code: "+t[0].POGCode+" "+get_message("POGCR_OVERHUNG_SHELF_DENY"),g_pog_saving_error_msg=g_pog_saving_error_msg+"</br> POG Code: "+t[0].POGCode+" "+get_message("POGCR_OVERHUNG_SHELF_DENY");else if("Y"==I){if("Y"==$v("P25_POGCR_ENBL_AUTO_NUM_ITEM")){var b="",v="",E="";"1"==$v("P25_POGCR_DEFAULT_START_FIXEL")?(b=1,v="",E=1):"Y"==$v("P25_UNQ_POG_MODULE_ITEM_LOC")?(b=2,v=2,E=0):(b=1,v="",E=0);await location_numbering("LR",$v("P25_POGCR_DEFAULT_DIRECTION"),b,E,v,d,$v("P25_PALLET_DIRECTION"));t[0]=g_pog_json[d],console.log("after renumbering")}if("Y"==$v("P25_POGCR_AUTO_FIXEL_RENUM")){var C=$v("P25_POGCR_FIXEL_RENUM_PARAM").split(","),P=C[2],N=C[0],T="",y=(v="",""),Y="",R=(b="",C[1]);"POG"!==P?(b="2",T=C[2].substring(0,2),v="Y"==C[2].substring(2,3)?"2":"",Y=C[2].substring(3,4),y="Y"==C[2].substring(4,5)?"3":""):(T="LR",b="1",v="2"),await fixture_numbering(T,N,R,b,v,y,Y,"","",d),t[0]=g_pog_json[d]}await get_chest_split_details(g_pogcr_pdf_chest_split,d);var L=get_combine_arr();t[0].GenrateCombineS=L,$.each(r,(function(e,o){if(console.log("inside saving loop"),null==o.ParentModule||"undefined"==o.ParentModule){var _,n={};_=$v("P25_POGCR_BASE_FIXEL_PREFIX")+o.Module,n.Shelf=_,n.ObjType="BASE",n.Desc="",n.MaxMerch=0,n.GrillH=0,n.LOverhang=0,n.ROverhang=0,n.SpacerThick=0,n.HorizGap=0,n.SpreadItem="L",n.Combine="N",n.AllowAutoCrush="N",n.H=o.H,n.W=o.W-2*o.NotchW,n.D=t[0].BackDepth,n.Rotation=o.Rotation,n.Slope=0,n.Color=o.Color,n.LiveImage="",n.HorizSlotStart=0,n.HorizSlotSpacing=0,n.HorizStart=o.HorzStart,n.HorizSpacing=o.HorzSpacing,n.UOverHang=0,n.LoOverHang=0,n.VertiStart=o.VertStart,n.VertiSpacing=o.VertSpacing,n.X=o.X,n.Y=o.Y,n.Z=o.Z,n.InputText="",n.WrapText="",n.ReduceToFit="",n.TextDirection="",n.BsktFill="",n.BsktSpreadProduct="",n.SnapTo="",n.BsktWallH=0,n.BsktBaseH=0,n.BsktWallThickness=0,n.DSlotStart=0,n.DSlotSpacing=0,n.DGap=0,n.FrontOverHang=0,n.BackOverHang=0,n.SlotDivider="",n.AllowOverLap="N",n.AutoPlacing="N",n.SlotOrientation="",n.DividerFixed="N",n.ItemInfo=[],t[0].ModuleInfo[e].ShelfInfo.push(n)}}));var H=await get_min_max_xy(d),F=H.split("###");t[0].Cal_Width=parseFloat(100*F[0]),t[0].Cal_height=parseFloat(100*F[1]),console.log("details",H),POG_json=JSON.stringify(t[0])}else g_ispog_savingerror="Y",l="Y",_=_=_+"</br> POG Code: "+t[0].POGCode+" "+get_message("DIM_MISMATCH_ITEMS"),g_pog_saving_error_msg=g_pog_saving_error_msg+"</br> POG Code: "+t[0].POGCode+" "+get_message("DIM_MISMATCH_ITEMS")}var w=await check_workflow_setup(t[0].POGCode);"Y"==w&&(n=n+", "+t[0].POGCode),g={};var A;if(t[0].DeleteItems=[],A=JSON.stringify(t),g.POGCode=t[0].POGCode,g.division=t[0].Division,g.dept=t[0].Dept,g.subDept=t[0].SubDept,g.description=t[0].Desc7,g.pogjson=A,g.version=t[0].Version,g.saveType="Y",g.Cal_Width=t[0].Cal_Width,g.Cal_height=t[0].Cal_height,g.errorStatus=l,g.errorMessage=_,g.workflow_check=w,g.draftInd="N",a.push(g),"N"==g_all_pog_flag)break;d++}"Y"==e?await save_wpog(a):await saveMultiplePog(a,w,n),void 0===g_autofill_detail.AFVersion||"Y"==g_wf_pog_approval_enabled&&"N"==g_pogcr_pog_approval_for_new_pog||apex.server.process("SAVE_AUTOFILL",{x01:g_autofill_detail.AFPOGCode,x02:g_autofill_detail.AFVersion,x03:g_autofill_detail.AutofillRule,x04:g_autofill_detail.BlkSelType,x05:""==g_autofill_detail.AFPOGVersion||void 0===g_autofill_detail.AFPOGVersion?g_autofill_detail.AFVersion:g_autofill_detail.AFPOGVersion,p_clob_01:JSON.stringify(filterAutoFillJsontag(g_autofill_detail))},{dataType:"text",success:function(e){"ERROR"==$.trim(e).split(",")[0]&&raise_error(e)}})}catch(e){error_handling(e)}}async function saveMultiplePog(e,o,_){var n="N";console.log("save pog process",e,o,_);for(const o of e)if("Y"==o.errorStatus){n="Y";break}if("N"==n)apex.server.process("SAVE_FINAL_POG",{p_clob_01:JSON.stringify(e)},{dataType:"text",success:function(o){console.log("pData",o);var _=JSON.parse(o);for(pog of _.POGs){var n=0;for(p of e){if((n!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex)&&("N"!=pog.ErrorMessage&&p.POGCode==pog.POGCode&&(e[n].errorMessage=pog.ErrorMessage,e[n].errorStatus="Y"),p.POGCode==pog.POGCode)){e[n].workflowId=pog.workflowId,e[n].Version=pog.POGVersion;var t=JSON.parse(e[n].pogjson);t[0].Version=pog.POGVersion,e[n].pogjson=JSON.stringify(t)}n++}"N"!==pog.ErrorMessage?(g_pog_saving_error_msg=g_pog_saving_error_msg+"</br>"+pog.ErrorMessage,g_ispog_savingerror="Y"):g_ispog_savingerror="N";var g=0;for(p of g_pog_json)p.POGCode==pog.POGCode&&(g_pog_json[g].Version=pog.POGVersion),g++;0}!async function(){if("N"==g_ispog_savingerror){var o=[],n=0;if("Y"==g_all_pog_flag)var t=0;else t=g_pog_index;for(const _ of e){if(t!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex){var g=JSON.parse(_.pogjson);o=g[0].ModuleInfo;for(const e of o)e.ShelfInfo.length>0&&$.each(e.ShelfInfo,(function(e,o){void 0!==o&&"BASE"==o.ObjType&&(0==e?g[0].ModuleInfo[n].ShelfInfo.splice(e,e+1):g[0].ModuleInfo[n].ShelfInfo.splice(e,1))})),n=n++;g_world=g_scene_objects[t].scene.children[2];var a;await update_textbox_change(g_pog_json,t);g_pog_json[t].MassUpdate="N",a=JSON.stringify([g_pog_json[t]]),_.pogjson=a}if("Y"!=g_all_pog_flag)break;t++}}apex.server.process("SAVE_DRAFT",{p_clob_01:JSON.stringify(e)},{dataType:"text",success:function(o){const n=$.trim(o);if(n.startsWith("ERROR"))raise_error(n);else{for(pog of(_=JSON.parse(o)).POGs){var t=0;for(p of e)"N"!=pog.ErrorMessage&&p.POGCode==pog.POGCode&&(e[t].errorMessage=pog.ErrorMessage,e[t].errorStatus="Y"),p.POGCode==pog.POGCode&&(e[t].seqId=pog.seqId),t++;"N"!=pog.ErrorMessage&&(g_pog_saving_error_msg=g_pog_saving_error_msg+"</br>"+pog.ErrorMessage,g_ispog_savingerror="Y")}if(g_pog_edited_ind="N",console.log("save",$v("P25_SAVE_WITH_PDF")),"Y"==$v("P25_SAVE_WITH_PDF")){!async function(){if(g_combinedShelfs=[],"Y"==g_all_pog_flag){var o=0;for(p of e){if((o!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex)&&"N"==p.errorStatus){var _=void 0!==p.workflowId&&p.workflowId>0&&""!==p.seqId?"Y":"N",n=g_scene_objects[o].scene.children[0];g_world=g_scene_objects[o].scene.children[2];var t={SeqNo:"",POGCode:p.POGCode,POGVersion:p.Version,POGModule:"",Selection_Type:"Y"==_?"D":"E",Print_Type:"P",SequenceId:p.seqId,TemplateId:$v("P25_PDF_TEMPLATE").split("-")[0],TemplateDetails:$v("P25_PDF_TEMPLATE")};await create_pdf(t,$v("P25_SAVE_WITH_PDF"),"Y",n,"Y"==_?"D":"E",$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_NOTCH_HEAD"),"Y",o,"Y",g_all_pog_flag,$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),_,p.seqId,g_hide_show_dos_label,"",$v("P25_POGCR_ENHANCE_PDF_IMG"),$v("P25_POGCR_PDF_IMG_ENHANCE_RATIO"),$v("P25_POGCR_PDF_CANVAS_SIZE"),$v("P25_VDATE"),$v("P25_POG_POG_DEFAULT_COLOR"),$v("P25_POG_MODULE_DEFAULT_COLOR"),$v("P25_POGCR_DFT_SPREAD_PRODUCT"),$v("P25_PEGB_DFT_HORIZ_SPACING"),$v("P25_PEGBOARD_DFT_VERT_SPACING"),$v("P25_BASKET_DFT_WALL_THICKNESS"),$v("P25_CHEST_DFT_WALL_THICKNESS"),$v("P25_POGCR_PEGB_MAX_ARRANGE"),$v("P25_POGCR_DEFAULT_WRAP_TEXT"),$v("P25_POGCR_TEXT_DEFAULT_SIZE"),$v("P25_POG_TEXTBOX_DEFAULT_COLOR"),$v("P25_POG_SHELF_DEFAULT_COLOR"),$v("P25_DIV_COLOR"),$v("P25_SLOT_DIVIDER"),$v("P25_SLOT_ORIENTATION"),$v("P25_DIVIDER_FIXED"),$v("P25_POG_ITEM_DEFAULT_COLOR"),$v("P25_POGCR_DFT_BASKET_FILL"),$v("P25_POGCR_DFT_BASKET_SPREAD"),$v("P25_POGCR_BAY_LIVE_IMAGE"),$v("P25_POGCR_BAY_WITHOUT_LIVE_IMAGE"),"N")}o++}"undefined"!=typeof regionloadWait&&"function"==typeof regionloadWait.remove&&removeLoadingIndicator(regionloadWait)}else{if("N"==e[0].errorStatus){_=void 0!==e[0].workflowId&&e[0].workflowId>0&&""!==e[0].seqId?"Y":"N",n=g_scene_objects[g_pog_index].scene.children[0],t={SeqNo:"",POGCode:e[0].POGCode,POGVersion:e[0].Version,POGModule:"",Selection_Type:"Y"==_?"D":"E",Print_Type:"P",SequenceId:e[0].seqId,TemplateId:$v("P25_PDF_TEMPLATE").split("-")[0],TemplateDetails:$v("P25_PDF_TEMPLATE")};await create_pdf(t,$v("P25_SAVE_WITH_PDF"),"Y",n,"Y"==_?"D":"E",$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_NOTCH_HEAD"),"Y",g_pog_index,"Y",g_all_pog_flag,$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),_,e[0].seqId,g_hide_show_dos_label,"",$v("P25_POGCR_ENHANCE_PDF_IMG"),$v("P25_POGCR_PDF_IMG_ENHANCE_RATIO"),$v("P25_POGCR_PDF_CANVAS_SIZE"),$v("P25_VDATE"),$v("P25_POG_POG_DEFAULT_COLOR"),$v("P25_POG_MODULE_DEFAULT_COLOR"),$v("P25_POGCR_DFT_SPREAD_PRODUCT"),$v("P25_PEGB_DFT_HORIZ_SPACING"),$v("P25_PEGBOARD_DFT_VERT_SPACING"),$v("P25_BASKET_DFT_WALL_THICKNESS"),$v("P25_CHEST_DFT_WALL_THICKNESS"),$v("P25_POGCR_PEGB_MAX_ARRANGE"),$v("P25_POGCR_DEFAULT_WRAP_TEXT"),$v("P25_POGCR_TEXT_DEFAULT_SIZE"),$v("P25_POG_TEXTBOX_DEFAULT_COLOR"),$v("P25_POG_SHELF_DEFAULT_COLOR"),$v("P25_DIV_COLOR"),$v("P25_SLOT_DIVIDER"),$v("P25_SLOT_ORIENTATION"),$v("P25_DIVIDER_FIXED"),$v("P25_POG_ITEM_DEFAULT_COLOR"),$v("P25_POGCR_DFT_BASKET_FILL"),$v("P25_POGCR_DFT_BASKET_SPREAD"),$v("P25_POGCR_BAY_LIVE_IMAGE"),$v("P25_POGCR_BAY_WITHOUT_LIVE_IMAGE"),"N")}"undefined"!=typeof regionloadWait&&"function"==typeof regionloadWait.remove&&removeLoadingIndicator(regionloadWait)}show_errors_final_pog(e)}(),logDebug("function : save_pog_final","E")}else show_errors_final_pog(e);if("Y"==g_all_pog_flag)var g=0;else g=g_pog_index;for(const e of g_pog_json){var a=0;for(const e of g_pog_json[g].ModuleInfo)e.ShelfInfo.length>0&&$.each(e.ShelfInfo,(function(e,o){void 0!==o&&"BASE"==o.ObjType&&g_pog_json[g].ModuleInfo[a].ShelfInfo.splice(e,1)})),a++;if("Y"!=g_all_pog_flag)break;g++}}}})}()}});else{var t="Failed POG: ";for(p of e)""!=p.errorMessage&&(hasFailedRec="Y",t=t+"</br>"+p.errorMessage);raise_error(t)}}function set_grid_background_color(){logDebug("function : set_grid_background_color","S");try{var e=apex.region("draggable_table").widget().interactiveGrid("getViews","grid").model;e.forEach((function(o){var _=e.getValue(o,"EXISTING"),n=e.getValue(o,"ITEM"),t=$("#draggable_table [data-id="+n+"]").length;if(t>1)for(var g=0;g<t;g++){var a=$("#draggable_table [data-id="+n+"]")[g],l=$("> .existing",a)[0].innerHTML;"Y"==l?$(a).children("td").css("color","green"):"R"==l&&$(a).children("td").css("color","red")}else"Y"==_?$("#draggable_table [data-id="+n+"] td").css("color","green"):"R"==_&&$("#draggable_table [data-id="+n+"] td").css("color","red")})),logDebug("function : set_grid_background_color","E")}catch(e){error_handling(e)}}async function save_final_template(e,o){logDebug("function : save_final_template","S");try{var _;if("undefined"!=typeof g_pog_json&&g_pog_json.length>0)if("Y"==validate_pog_detail("Y",e)&&"Y"!=g_is_pog_template_open)alert(get_message("ENTER_MADATORY_POG_DETAIL"));else{var n=[];n.push(JSON.parse(JSON.stringify(g_pog_json[e])));await save_delete_items(n,"N",e);_="Y"!=g_is_pog_template_open?$v("P25_TEMPLATE_NAME")+" "+o:$v("P25_TEMPLATE_NAME"),apex.server.process("TEMPLATE_DUP_CHECK",{x01:_},{dataType:"text",success:function(e){if("Y"==$.trim(e))confirm(get_message("POG_TEMPLATE_ALREADY_EXISTS"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){var e=JSON.stringify(n);$(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),$(".save_draft").addClass("active"),apex.server.process("SAVE_TEMPLATE",{x01:_,x02:"U",p_clob_01:e},{dataType:"text",success:function(e){"ERROR"==$.trim(e).split(",")[0]?raise_error(e):void 0!==g_autofill_detail.AFVersion?(g_autofill_detail.AFPOGCode=$v("P25_TEMPLATE_NAME")+" "+o,g_autofill_detail.AFPOGVersion="",apex.server.process("SAVE_AUTOFILL",{x01:g_autofill_detail.AFPOGCode,x02:g_autofill_detail.AFVersion,x03:g_autofill_detail.AutofillRule,x04:g_autofill_detail.BlkSelType,x05:g_autofill_detail.AFPOGVersion,p_clob_01:JSON.stringify(filterAutoFillJsontag(g_autofill_detail))},{dataType:"text",success:function(e){"ERROR"==$.trim(e).split(",")[0]?raise_error(e):(g_pog_edited_ind="N",apex.message.showPageSuccess(get_message("TEMPLATE_SAVED")),closeInlineDialog("save_as_template"),logDebug("function : save_final_template","E"))}})):(g_pog_edited_ind="N",apex.message.showPageSuccess(get_message("TEMPLATE_SAVED")),closeInlineDialog("save_as_template"),logDebug("function : save_final_template","E"))},loadingIndicatorPosition:"page"})}));else{var t=JSON.stringify(n);$(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),$(".save_draft").addClass("active"),apex.server.process("SAVE_TEMPLATE",{x01:_,x02:"C",p_clob_01:t},{dataType:"text",success:function(e){"ERROR"==$.trim(e).split(",")[0]?raise_error(e):void 0!==g_autofill_detail.AFVersion?(g_autofill_detail.AFPOGCode=$v("P25_TEMPLATE_NAME")+" "+o,g_autofill_detail.AFPOGVersion="",apex.server.process("SAVE_AUTOFILL",{x01:g_autofill_detail.AFPOGCode,x02:g_autofill_detail.AFVersion,x03:g_autofill_detail.AutofillRule,x04:g_autofill_detail.BlkSelType,x05:g_autofill_detail.AFPOGVersion,p_clob_01:JSON.stringify(filterAutoFillJsontag(g_autofill_detail))},{dataType:"text",success:function(e){"ERROR"==$.trim(e).split(",")[0]?raise_error(e):(g_pog_edited_ind="N",apex.message.showPageSuccess(get_message("TEMPLATE_SAVED")),closeInlineDialog("save_as_template"),logDebug("function : save_final_template","E"))}})):(g_pog_edited_ind="N",apex.message.showPageSuccess(get_message("TEMPLATE_SAVED")),closeInlineDialog("save_as_template"),logDebug("function : save_final_template","E"))},loadingIndicatorPosition:"page"})}},loadingIndicatorPosition:"page"})}}catch(e){error_handling(e)}}function save_delete_items(e,o,_){return logDebug("function : delete_items; delete_obj : "+o,"S"),new Promise((function(n,t){var g=g_pog_json[_].ModuleInfo;"N"==o&&(e[0].POGCode="",e[0].Name="",e[0].Version=""),$.each(g,(function(n,t){void 0!==t.ParentModule&&null!=t.ParentModule||$.each(t.ShelfInfo,(function(t,g){var a={},l="N";"Y"==o?$.each(g.ItemInfo,(function(e,o){if("DIVIDER"!==o.Item){g_deletedItems.push(o.ItemID);var n=g_scene_objects[_].scene.children[2].getObjectById(o.ObjID);g_scene_objects[_].scene.children[2].remove(n)}else a=o,l="Y"})):$.each(g.ItemInfo,(function(e,o){"DIVIDER"==o.Item&&(a=o,l="Y")})),e[0].ModuleInfo[n].ShelfInfo[t].ItemInfo=[],"Y"==l&&e[0].ModuleInfo[n].ShelfInfo[t].ItemInfo.push(a)}))}));deleted_items_log(g_deletedItems,"D",_);n("SUCCESS"),logDebug("function : delete_items","E")}))}function fixel_update(e,o,_){logDebug("function : fixel_update","S");try{return new Promise((function(n,t){g_pog_edited_ind="Y";var g=-1,a=-1,l=-1;e.forEach((async function(n){var t=parseInt(e.getValue(n,"MODULE_INDEX")),s=parseInt(e.getValue(n,"SHELF_INDEX"));g_shelf_index=s,g_module_index=t;var i="N",d=g_pog_json[_].ModuleInfo[t].ShelfInfo[s].ObjType;const r=100*g_pog_json[_].ModuleInfo[t].ShelfInfo[s].Z-100*g_pog_json[_].ModuleInfo[t].ShelfInfo[s].D/2;var f,I=parseFloat(e.getValue(n,"SHELF_WIDTH"))/100,c=parseFloat(e.getValue(n,"SHELF_HEIGHT"))/100,p=parseFloat(e.getValue(n,"SHELF_DEPTH"))/100,u=parseFloat(e.getValue(n,"SHELF_X"))/100+parseFloat(e.getValue(n,"SHELF_WIDTH"))/2/100,m=parseFloat(e.getValue(n,"SHELF_Y"))/100+parseFloat(e.getValue(n,"SHELF_HEIGHT"))/2/100;f="Textbox"==e.getValue(n,"OBJECT_TYPE")?parseFloat(e.getValue(n,"SHELF_Z"))/100:void 0===g_pog_json[_].ModuleInfo[t].ShelfInfo[s].Z||""==g_pog_json[_].ModuleInfo[t].ShelfInfo[s].Z?g_pog_json[_].BackDepth/2+parseFloat(e.getValue(n,"SHELF_DEPTH"))/2/100:r/100+parseFloat(e.getValue(n,"SHELF_DEPTH")/2)/100;var h=g_pog_json[_].ModuleInfo[t].ShelfInfo[s].ItemInfo;$.each(h,(function(e,o){o.OldX=o.X,o.OldY=o.Y,o.OldZ=o.Z}));var S,x=parseInt(g_pog_json[_].ModuleInfo[t].ShelfInfo[s].Color.replace("#","0x"),16),O=new THREE.Color(x),M=[],j=[],D=[],b=[];if($.each(h,(function(e,o){M.push(wpdSetFixed(o.W)),j.push(wpdSetFixed(o.H)),D.push(wpdSetFixed(o.D)),b.push(e),g_pog_json[_].ModuleInfo[t].ShelfInfo[s].ItemInfo[e].Exists="E"})),"Y"==e.getValue(n,"DEPTH_UPDATE_FLAG")){g_pog_json[_].ModuleInfo[parseInt(e.getValue(n,"MODULE_INDEX"))].ShelfInfo[parseInt(e.getValue(n,"SHELF_INDEX"))].D=parseFloat(e.getValue(n,"SHELF_DEPTH"))/100,g_pog_json[_].ModuleInfo[parseInt(e.getValue(n,"MODULE_INDEX"))].ShelfInfo[parseInt(e.getValue(n,"SHELF_INDEX"))].Z=f;var v=[];validate_items(M,j,D,b,d,t,s,-1,"N",0,0,0,-1,"N","Y","Y","N","N",v,"Y","Y","Y",_)?i="Y":(e.setValue(n,"SHELF_DEPTH",e.getValue(n,"SHELF_DEPTH_OLD")),console.log("SHELF_DEPTH_OLD"+e.getValue(n,"SHELF_DEPTH_OLD")/100),h.length>0&&(g_pog_json[_].ModuleInfo[t].EditFlag="Y"))}if("Y"==e.getValue(n,"LOC_Z_UPDATE_FLAG")){var E;if(E="Textbox"==e.getValue(n,"OBJECT_TYPE")?parseFloat(e.getValue(n,"SHELF_Z"))/100:parseFloat(e.getValue(n,"SHELF_Z"))/100+parseFloat(e.getValue(n,"SHELF_DEPTH"))/2/100,g_pog_json[_].ModuleInfo[parseInt(e.getValue(n,"MODULE_INDEX"))].ShelfInfo[parseInt(e.getValue(n,"SHELF_INDEX"))].Z=E,"Textbox"==e.getValue(n,"OBJECT_TYPE")){g_pog_json[_].ModuleInfo[parseInt(e.getValue(n,"MODULE_INDEX"))].ShelfInfo[parseInt(e.getValue(n,"SHELF_INDEX"))].ManualZupdate="N";var C=g_world.getObjectById(g_pog_json[_].ModuleInfo[parseInt(e.getValue(n,"MODULE_INDEX"))].ShelfInfo[parseInt(e.getValue(n,"SHELF_INDEX"))].SObjID);C.ShelfInfo=g_pog_json[_].ModuleInfo[parseInt(e.getValue(n,"MODULE_INDEX"))].ShelfInfo[parseInt(e.getValue(n,"SHELF_INDEX"))],textboxPriorityPlacing(C,_,E)}if(h.length>0&&(g_pog_json[_].ModuleInfo[t].EditFlag="Y"),i="Y","Textbox"!==e.getValue(n,"OBJECT_TYPE"))(H=g_scene_objects[_].scene.children[2].getObjectById(parseInt(e.getValue(n,"SHELF_OBJID")))).Z=e.getValue(n,"SHELF_Z")}if("Y"==e.getValue(n,"FIXEL_UPDATE_FLAG")){var P=g_pog_json[_].ModuleInfo[parseInt(e.getValue(n,"MODULE_INDEX"))].ShelfInfo[parseInt(e.getValue(n,"SHELF_INDEX"))].Shelf;if(P!==e.getValue(n,"SHELF_ID")&&([currCombinationIndex,currShelfCombIndx]=getCombinationShelf(_,P),-1!==currShelfCombIndx&&updateObjID(g_pog_json[_].ModuleInfo[t].ShelfInfo[s].ObjID,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].ObjID,"S",P,e.getValue(n,"SHELF_ID"))),"Divider"==e.getValue(n,"OBJECT_TYPE")&&"DIVIDER"==g_pog_json[_].ModuleInfo[parseInt(e.getValue(n,"MODULE_INDEX"))].ShelfInfo[parseInt(e.getValue(n,"SHELF_INDEX"))].ObjType){var N=g_pog_json[_].ModuleInfo[parseInt(e.getValue(n,"MODULE_INDEX"))].ShelfInfo;for(var T of N){for(var y of T.ItemInfo){if("DIVIDER"==y.Item&&y.ObjID==g_pog_json[_].ModuleInfo[parseInt(e.getValue(n,"MODULE_INDEX"))].ShelfInfo[parseInt(e.getValue(n,"SHELF_INDEX"))].ShelfDivObjID){y.ItemID=e.getValue(n,"SHELF_ID"),y.Desc=e.getValue(n,"SHELF_DESC");break}0}0}}if(g_pog_json[_].ModuleInfo[parseInt(e.getValue(n,"MODULE_INDEX"))].ShelfInfo[parseInt(e.getValue(n,"SHELF_INDEX"))].Shelf=e.getValue(n,"SHELF_ID"),g_pog_json[_].ModuleInfo[parseInt(e.getValue(n,"MODULE_INDEX"))].ShelfInfo[parseInt(e.getValue(n,"SHELF_INDEX"))].Desc=e.getValue(n,"SHELF_DESC"),"Divider"!==e.getValue(n,"OBJECT_TYPE"))(H=g_scene_objects[_].scene.children[2].getObjectById(g_pog_json[_].ModuleInfo[parseInt(e.getValue(n,"MODULE_INDEX"))].ShelfInfo[parseInt(e.getValue(n,"SHELF_INDEX"))].SObjID)).FixelID=e.getValue(n,"SHELF_ID"),H.Desc=e.getValue(n,"SHELF_DESC");else $.each(g_pog_json[_].ModuleInfo[parseInt(e.getValue(n,"MODULE_INDEX"))].ShelfInfo,(function(o,t){$.each(t.ItemInfo,(function(t,s){if(s.ObjID==parseInt(e.getValue(n,"SHELF_OBJID"))){g=parseInt(e.getValue(n,"MODULE_INDEX")),a=o,l=t;var i=g_scene_objects[_].scene.children[2].getObjectById(g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l].ObjID);return i.FixelID=e.getValue(n,"SHELF_ID"),i.Desc=e.getValue(n,"SHELF_DESC"),!1}}))}));i="Y",show_fixel_labels("Y",_)}if("Divider"!=e.getValue(n,"OBJECT_TYPE")||"Y"!=e.getValue(n,"LOC_UPDATE_FLAG")&&"Y"!=e.getValue(n,"DIM_UPDATE_FLAG")||$.each(g_pog_json[_].ModuleInfo[parseInt(e.getValue(n,"MODULE_INDEX"))].ShelfInfo,(function(o,_){$.each(_.ItemInfo,(function(_,t){if(t.ObjID==parseInt(e.getValue(n,"SHELF_OBJID")))return g=parseInt(e.getValue(n,"MODULE_INDEX")),a=o,l=_,!1}))})),"Y"==e.getValue(n,"DIM_UPDATE_FLAG"))if(g_dblclick_objid=parseInt(e.getValue(n,"SHELF_OBJID")),g_pog_json[_].ModuleInfo[t].ShelfInfo[s].W=I,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].H=c,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].D=p,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].X=u,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].Y=m,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].Z=f,S="TEXTBOX"==d?.0021:"PEGBOARD"==d?.003:"DIVIDER"==d?.001:5e-4,"DIVIDER"!==d){v=[];if(validate_items(M,j,D,b,d,t,s,-1,"N",0,0,0,-1,"N","Y","Y","N","N",v,"Y","Y","Y",_)){await async function(){var o=g_pog_json[_].ModuleInfo[t].ShelfInfo[s].ItemInfo,g=g_pog_json[_].ModuleInfo[t].ShelfInfo[s];if($.each(o,(function(e,o){var[n,t]=get_item_xy(g,o,o.W,o.H,_);o.X=n,o.Y=t})),"PEGBOARD"==d)var a=add_pegboard(e.getValue(n,"SHELF_ID"),I,c,p,O,u,m,S,"Y",g_pog_json[_].ModuleInfo[t].ShelfInfo[s].VertiStart,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].VertiSpacing,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].HorizStart,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].HorizSpacing,t,s,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].Rotation,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].Slope,"Y",$v("P25_POG_CP_SHELF_DFLT_COLOR"),$v("P25_NOTCH_HEAD"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),_);else if("ROD"==d)a=add_rod(e.getValue(n,"SHELF_ID"),d,I,c,p,O,u,m,S,"Y",t,s,_);else if("TEXTBOX"==d){"Y"==$v("P25_POG_FIXEL_SHOW_TEXT_BOX_DESC")&&(g_pog_json[_].ModuleInfo[t].ShelfInfo[s].InputText=e.getValue(n,"TEXTFIELD")),ShelfInfo=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index];var l=g_pog_json[_].ModuleInfo;if($.each(l,(function(e,o){if(o.ObjID==g_dblclick_objid)return ModuleInfo=g_pog_json[_].ModuleInfo[e],void(child_module_index=e)})),"Y"==g_show_live_image&&""!==g_pog_json[_].ModuleInfo[t].ShelfInfo[s].TextImg&&void 0!==g_pog_json[_].ModuleInfo[t].ShelfInfo[s].TextImg&&null!==typeof g_pog_json[_].ModuleInfo[t].ShelfInfo[s].TextImg)a=await add_text_box_with_image(e.getValue(n,"SHELF_ID"),"SHELF",I,c,p,O,u,m,S,"Y",t,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].InputText,x,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].WrapText,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].ReduceToFit,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].Color,s,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].Rotation,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].Slope,"Y",g_pog_json[_].ModuleInfo[t].ShelfInfo[s].FStyle,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].FSize,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].FBold,$v("P25_NOTCH_HEAD"),_);else a=add_text_box(e.getValue(n,"SHELF_ID"),"SHELF",I,c,p,O,u,m,S,"Y",t,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].InputText,x,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].WrapText,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].ReduceToFit,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].Color,s,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].Rotation,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].Slope,"Y",g_pog_json[_].ModuleInfo[t].ShelfInfo[s].FStyle,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].FSize,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].FBold,2,_,g_pogcr_enhance_textbox_fontsize,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].TextDirection);g_pog_json[_].ModuleInfo[child_module_index].ObjID=a,g_pog_json[_].ModuleInfo[parseInt(e.getValue(n,"MODULE_INDEX"))].ShelfInfo[parseInt(e.getValue(n,"SHELF_INDEX"))].ManualZupdate="N";var r=g_world.getObjectById(a);r.ShelfInfo=g_pog_json[_].ModuleInfo[parseInt(e.getValue(n,"MODULE_INDEX"))].ShelfInfo[parseInt(e.getValue(n,"SHELF_INDEX"))],textboxPriorityPlacing(r,_,f)}else var[a,h]=await add_shelf(e.getValue(n,"SHELF_ID"),d,I,c,p,O,u,m,S,"Y",t,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].Rotation,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].Slope,s,"Y","N","Y",-1,$v("P25_POG_CP_SHELF_DFLT_COLOR"),$v("P25_NOTCH_HEAD"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),_);g_pog_json[_].ModuleInfo[t].ShelfInfo[s].SObjID=a,o.length>0&&(g_pog_json[_].ModuleInfo[t].EditFlag="Y"),i="Y"}()}else{e.setValue(n,"SHELF_WIDTH",e.getValue(n,"SHELF_WIDTH_OLD")),e.setValue(n,"SHELF_HEIGHT",e.getValue(n,"SHELF_HEIGHT_OLD")),e.setValue(n,"SHELF_DEPTH",e.getValue(n,"SHELF_DEPTH_OLD"));var Y,R=parseFloat(e.getValue(n,"SHELF_X_OLD"))/100+parseFloat(e.getValue(n,"SHELF_WIDTH_OLD"))/2/100,L=parseFloat(e.getValue(n,"SHELF_Y_OLD"))/100+parseFloat(e.getValue(n,"SHELF_HEIGHT_OLD"))/2/100;Y="Textbox"==e.getValue(n,"OBJECT_TYPE")?parseFloat(e.getValue(n,"SHELF_Z_OLD"))/100:parseFloat(e.getValue(n,"SHELF_Z_OLD"))/100+parseFloat(e.getValue(n,"SHELF_DEPTH_OLD"))/2/100,e.setValue(n,"SHELF_X",e.getValue(n,"SHELF_X_OLD")),e.setValue(n,"SHELF_Y",e.getValue(n,"SHELF_Y_OLD")),e.setValue(n,"SHELF_Z",e.getValue(n,"SHELF_Z_OLD")),g_pog_json[_].ModuleInfo[t].ShelfInfo[s].W=e.getValue(n,"SHELF_WIDTH_OLD")/100,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].H=e.getValue(n,"SHELF_HEIGHT_OLD")/100,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].D=e.getValue(n,"SHELF_DEPTH_OLD")/100,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].X=R,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].Y=L,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].Z=Y,async function(){await set_all_items(t,s,R,L,"Y","E","Y",_,_)}()}}else{g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l].W=I,g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l].H=c,g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l].D=p,g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l].RW=I,g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l].RH=c,g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l].RD=p,g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l].OW=I,g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l].OH=c,g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l].OD=p,g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l].Y=g_pog_json[_].ModuleInfo[g].ShelfInfo[a].Y+g_pog_json[_].ModuleInfo[g].ShelfInfo[a].H/2+c/2;var H=g_scene_objects[_].scene.children[2].getObjectById(g_dblclick_objid);g_scene_objects[_].scene.children[2].remove(H),render(_);var F=add_items(e.getValue(n,"SHELF_ID"),I,c,p,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].Color,g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l].X,g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l].Y,S,g,a,l,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].Rotation,"Y",_);g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l].ObjID=F,g_pog_json[_].ModuleInfo[t].ShelfInfo[s].ShelfDivObjID=F}if("Y"==e.getValue(n,"LOC_UPDATE_FLAG")&&("N"==e.getValue(n,"DIM_UPDATE_FLAG")&&"Divider"!==e.getValue(n,"OBJECT_TYPE")||"Divider"==e.getValue(n,"OBJECT_TYPE"))){var w=parseFloat(e.getValue(n,"SHELF_X"))/100+parseFloat(e.getValue(n,"SHELF_WIDTH"))/2/100,A=parseFloat(e.getValue(n,"SHELF_Y"))/100+parseFloat(e.getValue(n,"SHELF_HEIGHT"))/2/100;if("Textbox"==e.getValue(n,"OBJECT_TYPE"))var G=parseFloat(e.getValue(n,"SHELF_Z"))/100;else G=parseFloat(e.getValue(n,"SHELF_Z"))/100+parseFloat(e.getValue(n,"SHELF_DEPTH"))/2/100;var B=parseInt(e.getValue(n,"MODULE_INDEX")),V=parseInt(e.getValue(n,"SHELF_INDEX"));if("Divider"==e.getValue(n,"OBJECT_TYPE"))if(e.getValue(n,"SHELF_Y")!==e.getValue(n,"SHELF_Y_OLD")){var W,X,U=g_pog_json[_].ModuleInfo;t=-1,s=-1;if($.each(U,(function(o,_){null!=_.ParentModule&&"undefined"!=_.ParentModule||$.each(_.ShelfInfo,(function(_,g){void 0!==g&&"NOTCH"!==g.ObjType&&"BASE"!==g.ObjType&&"TEXTBOX"!==g.ObjType&&"DIVIDER"!==g.ObjType&&wpdSetFixed(A)==wpdSetFixed(wpdSetFixed(g.Y)+g.H/2+parseFloat(e.getValue(n,"SHELF_HEIGHT"))/100/2)&&(t=o,s=_,W=g.ObjType,X=g.SpreadItem)}))})),-1!==s){var k="N",z=g_pog_json[_].ModuleInfo[t].ShelfInfo[s].ItemInfo;if($.each(z,(function(e,o){var _=o.Itemx-o.W/2,n=o.X+o.W/2;if(w>_&&w<n)return k="Y",!1})),w>g_pog_json[_].ModuleInfo[t].ShelfInfo[s].X-g_pog_json[_].ModuleInfo[t].ShelfInfo[s].W/2&&w<g_pog_json[_].ModuleInfo[t].ShelfInfo[s].X+g_pog_json[_].ModuleInfo[t].ShelfInfo[s].W/2)if("N"==k){H=g_scene_objects[_].scene.children[2].getObjectById(parseInt(e.getValue(n,"SHELF_OBJID")));g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l].X=w,g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l].Y=A,g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l].Z=G,g_pog_json[_].ModuleInfo[B].ShelfInfo[V].X=w,g_pog_json[_].ModuleInfo[B].ShelfInfo[V].Y=A,g_pog_json[_].ModuleInfo[B].ShelfInfo[V].Z=G;var J=g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l];0==l?g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo.splice(l,l+1):g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo.splice(l,1),t!==g&&(ShelfInfo=g_pog_json[_].ModuleInfo[B].ShelfInfo[V],0==a?g_pog_json[_].ModuleInfo[g].ShelfInfo.splice(a,a+1):g_pog_json[_].ModuleInfo[g].ShelfInfo.splice(a,1),g_pog_json[_].ModuleInfo[t].push(ShelfInfo));var Z=g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l],[q,K,Q]=get_nearest_item(t,s,w,l,"Y",-1,g_pog_json[_].ModuleInfo[B].ShelfInfo[V].W,g_pog_json[_].ModuleInfo[B].ShelfInfo[V].D,g_pog_json[_].ModuleInfo[B].ShelfInfo[V].Fixed,g_pog_json[_].ModuleInfo[B].ShelfInfo[V].CapStyle,g_pog_json[_].ModuleInfo[B].ShelfInfo[V].H,"B",t,s,Z,_);set_item_after_drag(W,X,t,s,q,J,_);H.position.set(w,A,.001+g_pog_json[_].ModuleInfo[t].ShelfInfo[s].D/1e3),i="Y"}else alert(get_message("COLLIDE_X_AXIS"));else alert(get_message("X_AXIS_ERROR"))}else alert(get_message("Y_AXIS_ERROR"))}else if(w>g_pog_json[_].ModuleInfo[g].ShelfInfo[a].X-g_pog_json[_].ModuleInfo[g].ShelfInfo[a].W/2&&w<g_pog_json[_].ModuleInfo[g].ShelfInfo[a].X+g_pog_json[_].ModuleInfo[g].ShelfInfo[a].H/2){k="N",z=g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo;if($.each(z,(function(e,o){var _=o.Itemx-o.W/2,n=o.X+o.W/2;if(w>_&&w<n&&e!==l)return k="Y",!1})),"N"==k)g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l].X=w,g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l].Y=A,g_pog_json[_].ModuleInfo[g].ShelfInfo[a].ItemInfo[l].Z=G,(H=g_scene_objects[_].scene.children[2].getObjectById(parseInt(e.getValue(n,"SHELF_OBJID")))).position.set(w,A,.001+g_pog_json[_].ModuleInfo[g].ShelfInfo[a].D/1e3);else alert(get_message("COLLIDE_X_AXIS"))}else alert(get_message("X_AXIS_ERROR"));else{h=g_pog_json[_].ModuleInfo[t].ShelfInfo[s].ItemInfo;$.each(h,(function(e,o){o.X=o.OldX,o.Y=o.OldY,o.Z=o.OldZ})),console.log(" newx ",g_pog_json[_].ModuleInfo[t].ShelfInfo[s].Shelf,w,A,G,parseInt(e.getValue(n,"MODULE_INDEX")),parseInt(e.getValue(n,"SHELF_INDEX")));update_edit_location(w,A,G,parseInt(e.getValue(n,"MODULE_INDEX")),parseInt(e.getValue(n,"SHELF_INDEX")),0,"N",o,_,"N")}}"Y"==i&&"CHEST"==g_pog_json[_].ModuleInfo[t].ShelfInfo[s].ObjType&&"Y"==g_chest_as_pegboard&&(g_pog_json[_].ModuleInfo[t].ShelfInfo[s].ChestEdit="Y"),async function(){"SHELF"==e.getValue(n,"OBJECT_TYPE")&&await generateCombinedShelfs(_,t,s,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y","","Y")}()})),async function(){await recreate_compare_views(g_compare_view,"N")}(),"Y"==g_show_notch_label&&show_notch_labels("Y",$v("P25_NOTCH_HEAD"),"N",_),n("SUCCESS"),logDebug("function : fixel_update","E")}))}catch(e){error_handling(e)}}function nav_back(){logDebug("function : nav_back","S"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&"Y"==g_pog_edited_ind?(confirm(get_message("POGCR_CHANGE_REVERT_WARN"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){sessionStorage.removeItem("POGJSON"),sessionStorage.setItem("POGExists","N"),back_clicked="Y",apex.navigation.redirect("f?p="+$v("pFlowId")+":161:"+$v("pInstance")+":::")})),logDebug("function : nav_back","E")):(sessionStorage.removeItem("POGJSON"),sessionStorage.setItem("POGExists","N"),back_clicked="Y",apex.navigation.redirect("f?p="+$v("pFlowId")+":161:"+$v("pInstance")+":::"))}function set_item_xy(e,o,_,n){return logDebug("function : set_item_xy; shelf_info : "+e+"; p_module_index : "+o+"; p_shelf_index : "+_,"S"),new Promise((function(t,g){if("R"!==e.SpreadItem)$.each(e.ItemInfo,(function(t,g){g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[t].OldItemX=g.X,g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[t].OldItemY=g.Y;var a=get_item_xaxis(g.W,g.H,g.D,e.ObjType,-1,e.HorizGap,e.SpreadItem,e.HorizGap,o,_,t,"Y",e.ItemInfo.length,"N",n),[l,s]=get_item_xy(e,g,g.W,g.H,n);g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[t].Y=s,g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[t].X=a}));else for(var a=e.ItemInfo,l=a.length-1;l>=0;l--){var s=get_item_xaxis(a[l].W,a[l].H,a[l].D,e.ObjType,-1,e.HorizGap,e.SpreadItem,e.HorizGap,o,_,l,"Y",e.ItemInfo.length,"N",n),[i,d]=get_item_xy(e,a[l],a[l].W,a[l].H,n);g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[l].OldItemX=a[l].X,g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[l].OldItemY=a[l].Y,g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[l].Y=d,g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[l].X=s}t("SUCCESS"),logDebug("function : set_item_xy","E")}))}function update_spread_product(e){logDebug("function : update_spread_product; spread_type : "+e,"S");get_canvas_json("LABEL"),get_canvas_world("LABEL");update_spread_product_final(e,g_module_index,g_shelf_index,g_pog_index),logDebug("function : update_spread_product","E")}async function update_spread_product_final(e,o,_,n){logDebug("function : update_spread_product_final; spread_type : "+e+"; p_module_index : "+o+"; p_shelf_index : "+_,"S"),89==g_keyCode||90==g_keyCode||(g_redo_all_obj_arr=[],g_redo_final_obj_arr=[],undoType="U",g_undoRedoAction="REDO"),g_undoRedoAction;try{if(g_pog_edited_ind="Y","N"==g_multiselect){g_undo_details=[],g_undo_obj_arr=[],g_undo_supp_obj_arr=[];var t=[],g=[],a=[],l=[],s=g_pog_json[n].ModuleInfo[o].ShelfInfo[_].SObjID,i=wpdSetFixed(g_pog_json[n].ModuleInfo[o].ShelfInfo[_].Y+g_pog_json[n].ModuleInfo[o].ShelfInfo[_].H/2),d=0;if(t.moduleIndex=o,t.module=g_pog_json[n].ModuleInfo[o].Module,t.shelfIndex=_,t.actionType="ITEM_DELETE",t.startCanvas=g_start_canvas,t.objectID=s,t.g_deletedItems=g,t.moduleObjectID=g_pog_json[n].ModuleInfo[o].MObjID,t.push(JSON.parse(JSON.stringify(g_pog_json[n].ModuleInfo[o].ShelfInfo[_]))),g_allUndoObjectsInfo.push(t),logFinalUndoObjectsInfo("ITEM_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","N"),g_allUndoObjectsInfo=[],"SHELF"==g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ObjType||"HANGINGBAR"==g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ObjType){var r=g_pog_json[n].ModuleInfo[o].ShelfInfo[_].SpreadItem,f=-1;g_pog_json[n].ModuleInfo[o].ShelfInfo[_].SpreadItem=e,[currCombinationIndex,currShelfCombIndx]=getCombinationShelf(n,g_pog_json[n].ModuleInfo[o].ShelfInfo[_].Shelf),0==currShelfCombIndx&&(f=g_combinedShelfs[currCombinationIndex].SpreadItem,g_combinedShelfs[currCombinationIndex].SpreadItem=e);var I=g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo;if($.each(I,(function(e,t){("F"==r||t.CrushHoriz>0)&&(g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[e].W=t.RW),a.push(wpdSetFixed(t.W)),d=e,l.push(d)})),$.each(I,(function(e,o){wpdSetFixed(o.Y-o.H/2)==i&&a.push(wpdSetFixed(o.W))})),"HANGINGBAR"==g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ObjType){if(await crushItem(n,o,_,d,"W","Y",-1,-1),reorder_items(o,_,n)){var c=g_pog_json[n].ModuleInfo[o].ShelfInfo[_];await set_item_xy(c,o,_,n),I=g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo;"Y"==(p=validate_shelf_min_distance(o,_,c.Y,I,c.AllowAutoCrush,o,c.X,"Y",c,n))||"R"==p?recreate_all_items(o,_,g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ObjType,"Y",-1,-1,g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo.length,"Y","N",-1,-1,g_start_canvas,"",n,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y"):(g_pog_json[n].ModuleInfo[o].ShelfInfo[_].SpreadItem=r,$.each(c.ItemInfo,(function(e,t){g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[e].X=t.OldItemX,g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[e].Y=t.OldItemY})),f>-1&&(g_combinedShelfs[currCombinationIndex].SpreadItem=f))}}else if(await crushItem(n,o,_,d,"W","Y",-1,-1),reorder_items(o,_,n))recreate_all_items(o,_,g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ObjType,"Y",-1,-1,g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo.length,"Y","N",-1,-1,g_start_canvas,"",n,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y");I.length>0&&(g_pog_json[n].ModuleInfo[o].EditFlag="Y")}}else{g_undo_details=[],g_undo_obj_arr=[],g_undo_supp_obj_arr=[];for(const a of g_delete_details)if("SHELF"==a.Object&&("SHELF"==a.ObjType||"HANGINGBAR"==a.ObjType)&&"DIVIDER"!=a.Item){t=[],g=[],s=g_pog_json[n].ModuleInfo[a.MIndex].ShelfInfo[a.SIndex].SObjID;t.moduleIndex=o,t.module=g_pog_json[n].ModuleInfo[a.MIndex].Module,t.shelfIndex=_,t.actionType="ITEM_DELETE",t.startCanvas=g_start_canvas,t.objectID=s,t.g_deletedItems=g,t.moduleObjectID=g_pog_json[n].ModuleInfo[a.MIndex].MObjID,t.push(JSON.parse(JSON.stringify(g_pog_json[n].ModuleInfo[a.MIndex].ShelfInfo[a.SIndex]))),g_allUndoObjectsInfo.push(t),logFinalUndoObjectsInfo("ITEM_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","N"),g_allUndoObjectsInfo=[],I=g_pog_json[n].ModuleInfo[a.MIndex].ShelfInfo[a.SIndex].ItemInfo;r=g_pog_json[n].ModuleInfo[a.MIndex].ShelfInfo[a.SIndex].SpreadItem;$.each(I,(function(e,o){g_pog_json[n].ModuleInfo[a.MIndex].ShelfInfo[a.SIndex].ItemInfo[e].W=o.RW})),g_pog_json[n].ModuleInfo[a.MIndex].ShelfInfo[a.SIndex].SpreadItem=e;f=-1;if(g_pog_json[n].ModuleInfo[a.MIndex].ShelfInfo[a.SIndex].SpreadItem=e,[currCombinationIndex,currShelfCombIndx]=getCombinationShelf(n,g_pog_json[n].ModuleInfo[a.MIndex].ShelfInfo[a.SIndex].Shelf),-1!==currCombinationIndex&&-1!==currShelfCombIndx&&void 0!==g_combinedShelfs[currCombinationIndex]&&(f=g_combinedShelfs[currCombinationIndex].SpreadItem,g_combinedShelfs[currCombinationIndex].SpreadItem=e,g_combinedShelfs[currCombinationIndex][currShelfCombIndx].SpreadItem=e),"HANGINGBAR"==g_pog_json[n].ModuleInfo[a.MIndex].ShelfInfo[a.SIndex].ObjType){if(reorder_items(a.MIndex,a.SIndex,n)){var p;c=g_pog_json[n].ModuleInfo[a.MIndex].ShelfInfo[a.SIndex],await set_item_xy(c,a.MIndex,a.SIndex,n),I=g_pog_json[n].ModuleInfo[a.MIndex].ShelfInfo[a.SIndex].ItemInfo;if("Y"!=(p=validate_shelf_min_distance(a.MIndex,a.SIndex,c.Y,I,c.AllowAutoCrush,a.MIndex,c.X,"Y",c,n))&&"R"!=p){g_pog_json[n].ModuleInfo[a.MIndex].ShelfInfo[a.SIndex].SpreadItem=r,$.each(c.ItemInfo,(function(e,o){g_pog_json[n].ModuleInfo[a.MIndex].ShelfInfo[a.SIndex].ItemInfo[e].X=o.OldItemX,g_pog_json[n].ModuleInfo[a.MIndex].ShelfInfo[a.SIndex].ItemInfo[e].Y=o.OldItemY})),f>-1&&(g_combinedShelfs[currCombinationIndex].SpreadItem=f);break}await recreate_all_items(a.MIndex,a.SIndex,g_pog_json[n].ModuleInfo[a.MIndex].ShelfInfo[a.SIndex].ObjType,"Y",-1,-1,g_pog_json[n].ModuleInfo[a.MIndex].ShelfInfo[a.SIndex].ItemInfo.length,"Y","N",-1,-1,g_start_canvas,"",n,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")}}else{if(reorder_items(a.MIndex,a.SIndex,n))await recreate_all_items(a.MIndex,a.SIndex,g_pog_json[n].ModuleInfo[a.MIndex].ShelfInfo[a.SIndex].ObjType,"Y",-1,-1,g_pog_json[n].ModuleInfo[a.MIndex].ShelfInfo[a.SIndex].ItemInfo.length,"Y","N",-1,-1,g_start_canvas,"",n,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y");I.length>0&&(g_pog_json[n].ModuleInfo[a.MIndex].EditFlag="Y")}}g_mselect_drag="N",g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_multiselect="N"}render(n),"Y"==g_show_live_image&&animate_all_pog(),async function(){await recreate_compare_views(g_compare_view,"N")}(),logDebug("function : update_spread_product_final","E")}catch(e){error_handling(e)}}function open_edit_facings(){logDebug("function : open_edit_facings","S"),g_module_index=g_incre_mod_index,g_shelf_index=g_incre_shelf_index,g_item_index=g_incre_item_index,$s("P25_HORIZ_FACING",g_pog_json[p_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].BHoriz),$s("P25_VERT_FACING",g_pog_json[p_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].BVert),$s("P25_DEPTH_FACING",g_pog_json[p_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].BaseD),openInlineDialog("edit_facings",25,20),g_dblclick_opened="Y",logDebug("function : open_edit_facings","E")}async function update_item_facings(e,o,_,n,t,g,a,l,s,i,d="Y",r="N"){logDebug("function : update_item_facings; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+_+"; horiz_facing : "+n+"; vert_facing : "+t+"; depth_facing : "+g+"; fieldName : "+a+"; close_modal : "+l+"; recreate : "+s,"S"),89==g_keyCode||90==g_keyCode||(g_redo_all_obj_arr=[],g_redo_final_obj_arr=[],undoType="U",g_undoRedoAction="REDO"),g_undoRedoAction;try{g_pog_edited_ind="Y";var f=(b=g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ItemInfo[_]).OldItemBaseHoriz,I=b.OldItemBaseVert,c=b.OldItemBaseDepth,p=b,u=g_pog_json[i].ModuleInfo[e].ShelfInfo[o];g_pog_json[i].ModuleInfo[e].ShelfInfo[o].SObjID;void 0!==b.Remarks&&b.Remarks;var[m,h,S]=get_select_dim(p);"F"==g_pog_json[i].ModuleInfo[e].ShelfInfo[o].SpreadItem&&(items_arr=g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ItemInfo,$.each(items_arr,(function(e,o){o.W=o.RW}))),p.Exists="N";f=b.BHoriz,I=b.BVert,c=b.BaseD;b.BHoriz=n,b.BVert=t,b.BaseD=g;const[v,E,C,P,N,T]=set_dim_validate_item(e,o,_,m,h,S,p.ItemNesting,p.NVal,n,t,g,p.Orientation,p.OrgCWPerc,p.OrgCHPerc,p.OrgCDPerc,"N","Y","Y",i,d,r);if("ERROR"!==v){if("depthfacing"==a&&void 0!==p.BottomObjID&&""!==p.BottomObjID){var x=get_shelf_item_ind(e,o,p.BottomObjID,i);if(C>g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ItemInfo[x].D)return alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",g_pog_json[i].ModuleInfo[e].ShelfInfo[o].Shelf)),!1}else if("depthfacing"==a&&void 0!==p.TopObjID&&""!==p.TopObjID){var O=get_shelf_item_ind(e,o,p.TopObjID,i);if(C<g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ItemInfo[O].D)return alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",g_pog_json[i].ModuleInfo[e].ShelfInfo[o].Shelf)),!1}var[M,j]=get_item_xy(u,p,v,E,i);if(b.Y=j,b.Exists="E",b.W=v,b.H=E,b.D=C,b.RW=P,b.RH=N,b.RD=T,b.DfacingUpd="Y",b.OldItemBaseHoriz=n,b.OldItemBaseVert=t,b.OldItemBaseDepth=g,update_top_bottom_xy(e,o,_,p=b,i),"depthfacing"!==a&&"Y"==s){if(reorder_items(e,o,i))await recreate_all_items(e,o,g_shelf_object_type,"Y",-1,-1,g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ItemInfo.length,"N","N",-1,-1,g_start_canvas,"",i,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")}else if("depthfacing"==a){var D=g_scene_objects[i].scene.children[2].getObjectById(p.ObjID);void 0!==D&&(D.DFacing=g)}g_scene_objects[i].scene.children[2].getObjectById(p.ObjID);return l&&(g_dblclick_opened="N",closeInlineDialog("edit_facings")),await recreate_compare_views(g_compare_view,"N"),logDebug("function : update_item_facings","E"),!0}var b;return(b=g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ItemInfo[_]).BHoriz=f,b.BVert=I,b.BaseD=c,logDebug("function : update_item_facings","E"),!1}catch(e){error_handling(e)}}function update_top_bottom_xy(e,o,_,n,t){logDebug("function : update_top_bottom_xy; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+_,"S"),(void 0!==n.BottomObjID&&""!==n.BottomObjID||void 0!==n.TopObjID&&""!==n.TopObjID)&&(items_arr=g_pog_json[t].ModuleInfo[e].ShelfInfo[o].ItemInfo,$.each(items_arr,(function(_,g){var a=-1;if(wpdSetFixed(n.X)==wpdSetFixed(g.X)&&g.Y>a&&void 0!==g.TopObjID&&""!==g.TopObjID){var l=get_shelf_item_ind(e,o,g.TopObjID,t);g_pog_json[t].ModuleInfo[e].ShelfInfo[o].ItemInfo[l].Y=wpdSetFixed(g.Y+g.H/2+g_pog_json[t].ModuleInfo[e].ShelfInfo[o].ItemInfo[l].H/2),g_pog_json[t].ModuleInfo[e].ShelfInfo[o].ItemInfo[l].X=wpdSetFixed(g.X),a=wpdSetFixed(g.Y)}}))),logDebug("function : update_top_bottom_xy","E")}async function incrementValue(e,o,_){logDebug("function : incrementValue; facingType : "+o+"; facingNo : "+_,"S"),console.log(" start",e,o,_);var n=-1;if(void 0===o){e.preventDefault();var t=$(e.target).data("field");console.log("flname ",t,$(e.target).data("field"));n=-1;var g=$(e.target).closest("div");console.log("parent",g,$(e.target)),void 0===t?(t="horizfacing",n=parseInt(g.find("input[name="+t+"]").val(),10)):n=parseInt(g.find("input[name="+t+"]").val(),10)+1}else t=o,n=_,g_incre_mod_index=g_module_index,g_incre_shelf_index=g_shelf_index,g_incre_item_index=g_item_index,console.log("else ",t,n,g_incre_mod_index,g_incre_shelf_index,g_incre_item_index);var a=0,l=0,s=0;g_prev_undo_action="FACING_CHANGE",g_undo_obj_arr=[],g_undo_details=[];var i=[],d="N",r=[],f=-1,I=-1,c=0,p=-1;if(g_delete_details.length>0)for(const e of g_delete_details){if(p!==e.MIndex&&e.SIndex==I&&"ITEM"==e.Object&&(I=-1),f!==e.MIndex&&e.SIndex!==I&&"ITEM"==e.Object){var u=g_pog_json[g_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].SObjID;(m=[]).moduleIndex=e.MIndex,m.module=g_pog_json[g_pog_index].ModuleInfo[e.MIndex].Module,m.shelfIndex=e.SIndex,m.actionType="ITEM_DELETE",m.startCanvas=g_start_canvas,m.objectID=u,m.g_deletedItems=r,m.moduleObjectID=g_pog_json[g_pog_index].ModuleInfo[e.MIndex].MObjID,m.push(JSON.parse(JSON.stringify(g_pog_json[g_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex])));JSON.parse(JSON.stringify(g_pog_json[g_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo));g_allUndoObjectsInfo.push(m),f=e.MIndex,I=e.SIndex,p=e.MIndex,f==e.MIndex&&(f=-1)}c++}else{var m;u=g_pog_json[g_pog_index].ModuleInfo[g_incre_mod_index].ShelfInfo[g_incre_shelf_index].SObjID;(m=[]).moduleIndex=g_incre_mod_index,m.module=g_pog_json[g_pog_index].ModuleInfo[g_incre_mod_index].Module,m.shelfIndex=g_incre_shelf_index,m.actionType="ITEM_DELETE",m.startCanvas=g_start_canvas,m.objectID=u,m.g_deletedItems=r,m.moduleObjectID=g_pog_json[g_pog_index].ModuleInfo[g_incre_mod_index].MObjID,m.push(JSON.parse(JSON.stringify(g_pog_json[g_pog_index].ModuleInfo[g_incre_mod_index].ShelfInfo[g_incre_shelf_index])));JSON.parse(JSON.stringify(g_pog_json[g_pog_index].ModuleInfo[g_incre_mod_index].ShelfInfo[g_incre_shelf_index].ItemInfo));g_allUndoObjectsInfo.push(m)}if(0==g_delete_details.length||"undefined"==typeof g_delete_details){var h=g_pog_json[g_pog_index].ModuleInfo[g_incre_mod_index].ShelfInfo[g_incre_shelf_index].ItemInfo[g_incre_item_index];if(console.log("g_incre_shelf_index",g_incre_mod_index,g_incre_shelf_index,g_incre_item_index),console.log("item_inx_dtl",h,t),isNaN(n))void 0===o&&g.find("input[name="+t+"]").val(1);else if("horizfacing"==t?(a=n,l=h.BVert,s=h.BaseD):"vertfacing"==t?(a=h.BHoriz,l=3!==h.CapStyle?n:1,s=h.BaseD):(a=h.BHoriz,l=h.BVert,s=n),3==h.CapStyle&&"vertfacing"==t);else{void 0===o&&g.find("input[name="+t+"]").val(n);var S=h,x=nvl(S.MPogHorizFacings)>0?S.MPogHorizFacings:S.MHorizFacings,O=nvl(S.MPogVertFacings)>0?S.MPogVertFacings:S.MVertFacings,M=nvl(S.MPogDepthFacings)>0?S.MPogDepthFacings:S.MDepthFacings;if("horizfacing"==t&&a>x&&x>-1||"vertfacing"==t&&l>O&&O>-1||"depthfacing"==t&&s>M&&M>-1)alert(get_message("POGCR_MAX_FACING_REACH"));else if(console.log("horiz_facing",a,l,s),await update_item_facings(g_incre_mod_index,g_incre_shelf_index,g_incre_item_index,a,l,s,t,!1,"Y",g_pog_index,"N")&&("depthfacing"==t&&update_cap_depth(S,g_incre_mod_index,g_incre_shelf_index,g_incre_item_index,g_pog_index),"horizfacing"==t||"depthfacing"==t))await calculateFixelAndSupplyDays("N",g_pog_index)}var j=g_scene_objects[g_pog_index].scene.children[2].getObjectById(h.ObjID),D=(F=g_pog_json[g_pog_index].ModuleInfo[g_incre_mod_index].ShelfInfo[g_incre_shelf_index].ItemInfo[g_incre_item_index]).CapFacing*F.CapDepth*F.CapHorz;j.Cpct=F.BHoriz*F.BVert*F.BaseD+(isNaN(D)?0:D),F.Cpct=F.BHoriz*F.BVert*F.BaseD+(isNaN(D)?0:D),g_intersected.push(j)}else{g_mselect_drag="N",g_multiselect="N";var b,v={},E=(S=g_delete_details,[]),C=[];for(c=0;b=S[c++];)if("ITEM"==b.Object){var P;if(!((P=b.SIndex+"-"+b.MIndex)in v)){v[P]=1,E.push(P);var N={};N.SIndex=b.SIndex,N.MIndex=b.MIndex,N.ObjType=b.ObjType,C.push(N)}}var T,y,Y="N";g_combineItemModf=[];for(const e of g_delete_details)if("ITEM"==e.Object){var R=g_pog_json[g_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex],L=(a=l=s=1,"");if(T=g_pog_json[g_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ObjType,y=g_pog_json[g_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].Shelf,void 0===o?"horizfacing"==t?(L="Horizontal",a=R.BHoriz+1,l=R.BVert,s=R.BaseD):"vertfacing"==t?(L="Vertical",a=R.BHoriz,l=3!==R.CapStyle?R.BVert+1:1,s=R.BaseD):(L="Depth",a=R.BHoriz,l=R.BVert,s=R.BaseD+1):"horizfacing"==o?(L="Horizontal",a=_,l=R.BVert,s=R.BaseD):"vertfacing"==o?(L="Vertical",l=_,a=R.BHoriz,s=R.BaseD):"depthfacing"==o&&(L="Depth",s=_,l=R.BVert,a=R.BHoriz),3==R.CapStyle&&"vertfacing"==t);else{void 0!==g&&g.find("input[name="+t+"]").val(n);S=R,x=nvl(S.MPogHorizFacings)>0?S.MPogHorizFacings:S.MHorizFacings,O=nvl(S.MPogVertFacings)>0?S.MPogVertFacings:S.MVertFacings,M=nvl(S.MPogDepthFacings)>0?S.MPogDepthFacings:S.MDepthFacings;if("horizfacing"==t&&a>x&&x>-1||"vertfacing"==t&&l>O&&O>-1||"depthfacing"==t&&s>M&&M>-1){if(i.push(S.Item),d="Y",1==g_delete_details.length){d="N",alert(get_message("POGCR_MAX_FACING_REACH"));break}}else{var H={};H.NewMIndex=e.MIndex,H.NewSIndex=e.SIndex,H.OldMIndex=e.MIndex,H.OldSIndex=e.SIndex,H.OldIIndex=e.IIndex,H.OldObjID=R.ObjID,g_combineItemModf.push(H),await update_item_facings(e.MIndex,e.SIndex,e.IIndex,a,l,s,t,!1,"N",g_pog_index,"N")?(update_cap_depth(S,e.MIndex,e.SIndex,e.IIndex,g_pog_index),console.log("success incrment")):Y="Y"}}var F=g_pog_json[g_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex];j=g_scene_objects[g_pog_index].scene.children[2].getObjectById(F.ObjID),D=F.CapFacing*F.CapDepth*F.CapHorz;j.Cpct=F.BHoriz*F.BVert*F.BaseD+(isNaN(D)?0:D),F.Cpct=F.BHoriz*F.BVert*F.BaseD+(isNaN(D)?0:D)}if("Y"==d&&alert(get_message("POGCR_MAX_FACING_REACH")+" "+i),"Y"==Y)"W"==g_error_category?L="Horizontal":"H"==g_error_category?L="Vertical":"D"==g_error_category&&(L="Depth"),"CHEST"==T&&"Y"==g_chest_as_pegboard?alert(get_message("POGC_CHEST_SPACE_VALID",y)):alert(get_message("INCREMENT_ERROR",L)),document.getElementById("context-menu").classList.remove("active");else for(const e of C)if(reorder_items(e.MIndex,e.SIndex,g_pog_index)){if("SHELF"==e.ObjType||"PALLET"==e.ObjType)reset_top_bottom_objects(e.MIndex,e.SIndex,"N",g_pog_index);return_val=await recreate_all_items(e.MIndex,e.SIndex,e.ObjType,"Y",-1,-1,g_pog_json[g_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo.length,"N","N",-1,-1,g_start_canvas,"",g_pog_index,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")}if("N"==Y){for(const e of g_delete_details)if(g_intersected=[],"ITEM"==e.Object){var w=-1;if(g_combineItemModf.length>0)for(var A=0;A<g_combineItemModf.length;A++)if(g_combineItemModf[A].OldMIndex==e.MIndex&&g_combineItemModf[A].OldSIndex==e.SIndex){w=A;break}var G=g_pog_json[g_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex],B=g_pog_json[g_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo;if("PEGBOARD"!==G.ObjType&&("CHEST"!=G.ObjType||"Y"!=g_chest_as_pegboard)){B.keySort({X:"asc",Y:"asc"})}if(-1!==w){var V=0;for(b of B)b.ObjID==g_combineItemModf[w].NewObjID&&V,V++}var W=g_pog_json[g_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex];j=g_scene_objects[g_pog_index].scene.children[2].getObjectById(W.ObjID),D=W.CapFacing*W.CapDepth*W.CapHorz;j.Cpct=W.BHoriz*W.BVert*W.BaseD+(isNaN(D)?0:D),W.Cpct=W.BHoriz*W.BVert*W.BaseD+(isNaN(D)?0:D),g_intersected.push(j)}g_allUndoObjectsInfo.length>0&&(logFinalUndoObjectsInfo("ITEM_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","N"),g_allUndoObjectsInfo=[])}g_combineItemModf=[]}render_animate_selected(),logDebug("function : incrementValue","E")}async function decrementValue(e){logDebug("function : decrementValue","S"),e.preventDefault();var o=$(e.target).data("field"),_=$(e.target).closest("div"),n=parseInt(_.find("input[name="+o+"]").val(),10),t=0,g=0,a=0;g_prev_undo_action="FACING_CHANGE",g_undo_obj_arr=[],g_undo_details=[];var l=[],s="N";if(0==g_delete_details.length||"undefined"==typeof g_delete_details){if(!isNaN(n)&&n>1){var i=g_pog_json[g_pog_index].ModuleInfo[g_incre_mod_index].ShelfInfo[g_incre_shelf_index].ItemInfo[g_incre_item_index];_.find("input[name="+o+"]").val(n-1);var d="";if("horizfacing"==o){d="Horizontal";t=n-1,g=i.BVert,a=i.BaseD}else if("vertfacing"==o){d="Vertical";t=i.BHoriz,g=n-1,a=i.BaseD}else{d="Depth";t=i.BHoriz,g=i.BVert,a=n-1}if(3==i.CapStyle&&"vertfacing"==o);else{var r=i,f=nvl(r.MPogHorizFacings)>0?r.MPogHorizFacings:r.MHorizFacings,I=nvl(r.MPogVertFacings)>0?r.MPogVertFacings:r.MVertFacings,c=nvl(r.MPogDepthFacings)>0?r.MPogDepthFacings:r.MDepthFacings;if("horizfacing"==o&&t>f&&f>-1||"vertfacing"==o&&g>I&&I>-1||"depthfacing"==o&&a>c&&c>-1)alert(get_message("POGCR_MAX_FACING_REACH"));else if(await update_item_facings(g_incre_mod_index,g_incre_shelf_index,g_incre_item_index,t,g,a,o,!1,"Y",g_pog_index,"N","Y")){if("depthfacing"==o&&update_cap_depth(r,g_incre_mod_index,g_incre_shelf_index,g_incre_item_index,g_pog_index),"horizfacing"==o||"depthfacing"==o)await calculateFixelAndSupplyDays("N",g_pog_index)}else"W"==g_error_category?d="Horizontal":"H"==g_error_category?d="Vertical":"D"==g_error_category&&(d="Depth"),"CHEST"==g_pog_json[g_pog_index].ModuleInfo[g_incre_mod_index].ShelfInfo[g_incre_shelf_index].ObjType&&"Y"==g_chest_as_pegboard?alert(get_message("POGC_CHEST_SPACE_VALID",g_pog_json[g_pog_index].ModuleInfo[g_incre_mod_index].ShelfInfo[g_incre_shelf_index].Shelf)):alert(get_message("INCREMENT_ERROR",d))}}else _.find("input[name="+o+"]").val(1);var p=g_scene_objects[g_pog_index].scene.children[2].getObjectById(i.ObjID),u=g_pog_json[g_pog_index].ModuleInfo[g_incre_mod_index].ShelfInfo[g_incre_shelf_index].ItemInfo[g_incre_item_index],m=u.CapFacing*u.CapDepth*u.CapHorz;p.Cpct=u.BHoriz*u.BVert*u.BaseD+(isNaN(m)?0:m),g_intersected.push(p)}else{g_mselect_drag="N",g_multiselect="N";for(var h,S={},x=(r=g_delete_details,[]),O=[],M=0;h=r[M++];)if("ITEM"==h.Object){var j;if(!((j=h.SIndex+"-"+h.MIndex)in S)){S[j]=1,x.push(j);var D={};D.SIndex=h.SIndex,D.MIndex=h.MIndex,D.ObjType=h.ObjType,O.push(D)}}var b,v,E="N";g_combineItemModf=[];for(const e of g_delete_details)if("ITEM"==e.Object){i=g_pog_json[g_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex],t=g=a=1,d="";if(b=g_pog_json[g_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ObjType,v=g_pog_json[g_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].Shelf,"horizfacing"==o?(d="Horizontal",t=i.BHoriz>1?i.BHoriz-1:1,g=i.BVert,a=i.BaseD):"vertfacing"==o?(d="Vertical",t=i.BHoriz,g=3!==i.CapStyle&&i.BVert>1?i.BVert-1:1,a=i.BaseD):(d="Depth",t=i.BHoriz,g=i.BVert,a=i.BaseD>1?i.BaseD-1:1),3==i.CapStyle&&"vertfacing"==o);else{void 0!==_&&1!=n&&_.find("input[name="+o+"]").val(n-1);r=i,f=nvl(r.MPogHorizFacings)>0?r.MPogHorizFacings:r.MHorizFacings,I=nvl(r.MPogVertFacings)>0?r.MPogVertFacings:r.MVertFacings,c=nvl(r.MPogDepthFacings)>0?r.MPogDepthFacings:r.MDepthFacings;if("horizfacing"==o&&t>f&&f>-1||"vertfacing"==o&&g>I&&I>-1||"depthfacing"==o&&a>c&&c>-1){if(l.push(r.Item),s="Y",1==g_delete_details.length){s="N",alert(get_message("POGCR_MAX_FACING_REACH"));break}}else{var C={};C.NewMIndex=e.MIndex,C.NewSIndex=e.SIndex,C.OldMIndex=e.MIndex,C.OldSIndex=e.SIndex,C.OldIIndex=e.IIndex,C.OldObjID=i.ObjID,g_combineItemModf.push(C),await update_item_facings(e.MIndex,e.SIndex,e.IIndex,t,g,a,o,!1,"N",g_pog_index,"N","Y")?(update_cap_depth(r,e.MIndex,e.SIndex,e.IIndex,g_pog_index),console.log("success incrment")):E="Y"}}}if("Y"==s&&alert(get_message("POGCR_MAX_FACING_REACH")),"Y"==E)"W"==g_error_category?d="Horizontal":"H"==g_error_category?d="Vertical":"D"==g_error_category&&(d="Depth"),"CHEST"==b&&"Y"==g_chest_as_pegboard?alert(get_message("POGC_CHEST_SPACE_VALID",v)):alert(get_message("INCREMENT_ERROR",d)),document.getElementById("context-menu").classList.remove("active");else for(const e of O)if(reorder_items(e.MIndex,e.SIndex,g_pog_index)){if("SHELF"==e.ObjType||"PALLET"==e.ObjType)reset_top_bottom_objects(e.MIndex,e.SIndex,"N",g_pog_index);return_val=await recreate_all_items(e.MIndex,e.SIndex,e.ObjType,"Y",-1,-1,g_pog_json[g_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo.length,"N","N",-1,-1,g_start_canvas,"",g_pog_index,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")}if("N"==E)for(const e of g_delete_details)if(g_intersected=[],"ITEM"==e.Object){var P=-1,N=-1;if(g_combineItemModf.length>0)for(var T=0;T<g_combineItemModf.length;T++)if(g_combineItemModf[T].OldMIndex==e.MIndex&&g_combineItemModf[T].OldSIndex==e.SIndex){N=T;break}var y=g_pog_json[g_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex],Y=g_pog_json[g_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo;if("PEGBOARD"!==y.ObjType&&("CHEST"!=y.ObjType||"Y"!=g_chest_as_pegboard)){Y.keySort({X:"asc",Y:"asc"})}if(-1!==N){var R=0;for(h of Y)h.ObjID==g_combineItemModf[N].NewObjID&&(P=R),R++}var L=g_pog_json[g_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[P];p=g_scene_objects[g_pog_index].scene.children[2].getObjectById(L.ObjID),m=L.CapFacing*L.CapDepth*L.CapHorz;p.Cpct=L.BHoriz*L.BVert*L.BaseD+(isNaN(m)?0:m),g_intersected.push(p)}g_combineItemModf=[]}render_animate_selected(),logDebug("function : decrementValue","E")}function update_cap_depth(e,o,_,n,t){if((e=g_pog_json[t].ModuleInfo[o].ShelfInfo[_].ItemInfo[n]).CapStyle>0){var g=""==e.CapOrientaion?"4":e.CapOrientaion,[a,l,s]=get_cap_dim(e),i=e.CapDepthChanged,[d,r,f,I,c,p]=get_new_orientation_dim(g,a,l,s);if("N"==i||void 0===i){var u=Math.trunc(e.RD/f);e.CapDepth=u}}}function set_dim_validate_item(e,o,_,n,t,g,a,l,s,i,d,r,f,I,c,p,u,m,h,S="Y",x="N"){logDebug("function : set_dim_validate_item; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+_+"; item_width : "+n+"; item_height : "+t+"; item_depth : "+g+"; nesting : "+a+"; nesting_value : "+l+"; horiz_facing : "+s+"; vert_facing : "+i+"; depth_facing : "+d+"; orientation : "+r+"; crush_width_perc : "+f+"; crush_height_perc : "+I+"; crush_depth_perc : "+c+"; raise_alert : "+p+"; validate : "+u+"; facing_edit : "+m,"S");try{console.log(" validate update",e,o,_,n,t,g,a,l,s,i,d,r,f,I,c,p,u,m,h);var O,M,j,D=[],b=[],v=[],E=[],C=0,P=0,N=0,T=g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo[_];O=T.RW,M=T.RH,j=T.RD,old_x=T.X,old_y=T.Y;var y=T.W,Y=T.H,R=T.D,L=(T.CapDepthChanged,g_pog_json[h].ModuleInfo[e].ShelfInfo[o].SpreadItem),H=g_pog_json[h].ModuleInfo[e].ShelfInfo[o].HorizGap,F=T.HorizGap,w=T.VertGap,A=g_pog_json[h].ModuleInfo[e].ShelfInfo[o],G=g_pog_json[h].ModuleInfo[e];if("1"==r||"3"==r||"13"==r||"15"==r){var B=t;t=V=n,n=B}else if("4"==r||"6"==r||"16"==r||"18"==r){B=t;t=g,g=B}else if("5"==r||"7"==r||"17"==r||"19"==r){B=t;t=V=n,n=g,g=B}else if("8"==r||"10"==r||"20"==r||"22"==r){var V=n;n=g,g=V}else if("9"==r||"11"==r||"21"==r||"23"==r){V=n;n=B=t,t=g,g=V}if("F"!==L&&0==H&&0==F&&0!==l){if(l<0&&(l*=-1),"H"==a)t+=(i-1)*l,n*=s,g*=d;else if("W"==a){n+=(s-1)*l,t*=i,g*=d}else"D"==a&&(g+=(d-1)*l,n*=s,t*=i);C=n+F/100*(s-1),P=t+w/100*(i-1),N=g}else{var W=T.HorizGap,X=T.VertGap,U=T.CrushVert,k=T.CrushHoriz,z=T.CrushD;C=n*s+W/100*(s-1),P=t*i+X/100*(i-1),N=g*d,g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].W=C,g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].H=P,g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].D=N,g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].RW=C,g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].RH=P,g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].RD=N;var J=get_cap_max_merch(e,o,G,A,h,g_dft_max_merch);if(("1"==(K=T).CapStyle||"2"==K.CapStyle||"3"==K.CapStyle)&&J>t)set_item_capping(h,e,o,_,"N","Y"),t=g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].H,n=g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].W,g=g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].D;else if((T=g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo[_]).CapFacing=0,T.CapMerch="",T.CapOrientaion="",T.CapHeight=0,n=n*s+W/100*(s-1),t=t*i+w/100*(i-1),g*=d,T.H=t,T.W=n,T.D=g,T.RH=t,T.RW=n,T.RD=g,D.push(wpdSetFixed(g)),E.push(_),"CHEST"!=A.ObjType||"Y"!=g_chest_as_pegboard||"Y"!=T.MVertCrushed&&"Y"!=T.MHorizCrushed&&"Y"!=T.MDepthCrushed?"Y"==A.AllowAutoCrush?("Y"==T.MVertCrushed&&(crushItem(h,e,o,_,"H","Y",D,E),t=g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].H),"Y"==T.MHorizCrushed&&(crushItem(h,e,o,_,"W","Y",D,E),n=g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].W),"Y"==T.MDepthCrushed&&(crushItem(h,e,o,_,"D","Y",D,E),g=g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].D)):"N"==A.AllowAutoCrush&&(T.CrushHoriz=0,T.CrushVert=0,T.CrushD=0,T.MHorizCrushed="N",T.MVertCrushed="N",T.MDepthCrushed="N"):(crushItem(h,e,o,_,"A","Y",D,E),t=g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].H,n=g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].W,g=g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].D),void 0===T.BottomObjID||""==T.BottomObjID){var[Z,q]=get_item_xy(A,K,n,t,h);T.Y=q}}if(console.log("after setting",t,n,g),"Y"==u){if(T.RW=C,T.RH=P,T.RD=N,"PEGBOARD"==g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ObjType||"CHEST"==g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ObjType&&"Y"==g_chest_as_pegboard){A=g_pog_json[h].ModuleInfo[e].ShelfInfo[o];var K=T,[Z,q]=get_item_xy(A,K,n,t,h);T.X=Z,T.Y=q}var Q="N",ee=(g_pog_json[h].ModuleInfo[e].ShelfInfo[o].HorizGap,g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo.length,g_pog_json[h].ModuleInfo[e].ShelfInfo[o].AllowAutoCrush),oe=T.CrushVert,_e=T.Fixed,ne=g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ObjType,te=T.ObjID;if(g_combinedShelfs.length>0){var[ge,ae]=getCombinationShelf(h,g_pog_json[h].ModuleInfo[e].ShelfInfo[o].Shelf);-1!==ge&&(ee=g_combinedShelfs[ge][0].AllowAutoCrush)}""!==te&&void 0!==te&&$.each(g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo,(function(e,o){if(o.ObjID==te)return _=e,!1}));var le=T.D;if(T.D=g,(void 0===T.BottomObjID||""==T.BottomObjID)&&"DIVIDER"!==T.Item&&"Y"==S){set_auto_facings(e,o,_,T,"B","I","D",h);"Y"==g_max_facing_enabled&&"SHELF"==shelf_info.ObjType&&(t=g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].H,P=g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].RH),g=g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].D,N=g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].RD}T.W=n,T.H=t,T.D=g;T.DimT;D=[],b=[],E=[],(v=[]).push(wpdSetFixed(n)),b.push(wpdSetFixed(t)),D.push(wpdSetFixed(g)),E.push(_),"BASKET"==g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ObjType&&"DIVIDER"==T.Item?console.log("no validaation"):"PEGBOARD"!==g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ObjType&&"CHEST"!==g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ObjType&&(Q=item_height_validation(t,e,o,_,"Y",T.X,ee,oe,_e,p,g,m,h,"N",x));return"N"==Q&&validate_items(v,b,D,E,ne,e,o,_,"Y",k,U,z,T.X,_e,"N",p,"N",m,[],"Y","Y","Y",h,"N","N",x)?(void 0!==(K=T).HChanged&&"Y"==K.HChanged&&(t=T.H,P=T.RH),void 0!==K.WChanged&&"Y"==K.WChanged&&(n=T.W,C=T.RW),void 0!==K.DChanged&&"Y"==K.DChanged&&(g=T.D,N=T.RD),logDebug("function : set_dim_validate_item","E"),[n,t,g,C,P,N]):(T.D=le,T.RW=O,T.RH=M,T.RD=j,T.W=y,T.H=Y,T.D=R,T.X=old_x,T.Y=old_y,("PEGBOARD"==g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ObjType||"CHEST"==g_pog_json[h].ModuleInfo[e].ShelfInfo[o].ObjType&&"Y"==g_chest_as_pegboard)&&(T.X=old_x),logDebug("function : set_dim_validate_item","E"),["ERROR","ERROR","ERROR","ERROR","ERROR","ERROR"])}return logDebug("function : set_dim_validate_item","E"),[n,t,g,C,P,N]}catch(e){error_handling(e)}}function get_cap_dim(e){var o=0,_=0,n=0,t=""==e.CapMerch?"0":e.CapMerch;return"0"==t?wpdSetFixed(e.UW)!==wpdSetFixed(e.OrgUW)||wpdSetFixed(e.UH)!==wpdSetFixed(e.OrgUH)||wpdSetFixed(e.UD)!==wpdSetFixed(e.OrgUD)?(o=e.OrgUW,_=e.OrgUH,n=e.OrgUD):(o=e.UW,_=e.UH,n=e.UD):"2"==t?wpdSetFixed(e.CW)!==wpdSetFixed(e.OrgCW)||wpdSetFixed(e.CH)!==wpdSetFixed(e.OrgCH)||wpdSetFixed(e.CD)!==wpdSetFixed(e.OrgCD)?(o=e.OrgCW,_=e.OrgCH,n=e.OrgCD):(o=e.CW,_=e.CH,n=e.CD):"1"==t?wpdSetFixed(e.TW)!==wpdSetFixed(e.OrgTW)||wpdSetFixed(e.TH)!==wpdSetFixed(e.OrgTH)||wpdSetFixed(e.TD)!==wpdSetFixed(e.OrgTD)?(o=e.OrgTW,_=e.OrgTH,n=e.OrgTD):(o=e.TW,_=e.TH,n=e.TD):"3"==t&&(wpdSetFixed(e.DW)!==wpdSetFixed(e.OrgDW)||wpdSetFixed(e.DH)!==wpdSetFixed(e.OrgDH)||wpdSetFixed(e.DD)!==wpdSetFixed(e.OrgDD)?(o=e.OrgDW,_=e.OrgDH,n=e.OrgDD):(o=e.DW,_=e.DH,n=e.DD)),[o,_,n]}function auto_position(){logDebug("function : auto_position","S"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&("N"==g_auto_position_ind?(g_auto_position_ind="Y",$(".auto_position").addClass("auto_position_active")):(g_auto_position_ind="N",$(".auto_position").removeClass("auto_position_active"))),logDebug("function : auto_position","E")}function update_position_loc(e,o,_,n,t,g,a,l,s){logDebug("function : update_position_loc; p_shelf_index : "+_+"; p_module_index : "+t,"S");try{var i=-1,d=e.Y,r=!1,f=-1,I=$v("P25_POGCR_SUBSHELF_W_PERC"),c=$v("P25_ALIGN_BOTH_XY_POSITION");if(("HANGINGBAR"==e.ObjType||"SHELF"==e.ObjType)&&"N"==s&&100*wpdSetFixed(e.W/o.ModWidth)<100-parseFloat(I))return["N",e.X,d];if(i=e.X<=o.ModX?o.ModX-o.ModWidth/2+e.W/2:o.ModX+o.ModWidth/2-e.W/2,"HANGINGBAR"!=e.ObjType&&"SHELF"!=e.ObjType||"Y"!=c||([d,r,f]=autoPositionShelfVertically(a,t,_,i,e.Y,e.ObjType,I,s)),"TEXTBOX"!==e.ObjType)var p=validate_shelf_min_distance(n,_,d,e.ItemInfo,e.AllowAutoCrush,t,i,"N",e,a,"Y");else p="Y";if("Y"==p||"R"==p){g_pog_json[a].ModuleInfo[t].ShelfInfo[_].X=i,g_pog_json[a].ModuleInfo[t].ShelfInfo[_].Y=d,r&&(g_pog_json[a].ModuleInfo[t].ShelfInfo[_].NotchNo=f);var u=l.getObjectById(e.SObjID);u.position.set(i,d,wpdSetFixed(u.position.z));var m=g_pog_json[a].ModuleInfo[t].ShelfInfo[_].Rotation,h=g_pog_json[a].ModuleInfo[t].ShelfInfo[_].Slope;if(0!==m&&(u.quaternion.copy(g.quaternion),u.lookAt(g_pog_json[a].CameraX,g_pog_json[a].CameraY,g_pog_json[a].CameraZ),u.rotateY(m*Math.PI/180)),0!==h&&("TEXTBOX"==g_pog_json[a].ModuleInfo[t].ShelfInfo[_].ObjType&&0==m?u.rotateX(h/2*Math.PI/180):u.rotateX(h*Math.PI/180)),u.updateMatrix(),g_scene.updateMatrixWorld(),async function(){await set_all_items(t,_,i,d,"Y","N","Y",a,a,"Y")}(),"HANGINGBAR"==e.ObjType||"SHELF"==e.ObjType){if("Y"==g_show_notch_label)update_single_notch_label("Y",t,_,$v("P25_NOTCH_HEAD"),"",a,"N");"Y"==g_fixel_label&&update_single_fixel_label(g_pog_json[a].ModuleInfo[t].ShelfInfo[_],a,t,_)}}return logDebug("function : update_position_loc","E"),[p,i,d]}catch(e){error_handling(e)}}function auto_position_all_init(e){logDebug("function : auto_position_all_init","S"),auto_position_all(g_camera,g_pog_index,g_pog_index,$v("P25_POGCR_AUTO_POSITION_TEXT"),e),logDebug("function : auto_position_all_init","E")}async function undo_actions_not_delete(e,o,_){logDebug("function : undo_actions_not_delete; action : "+e,"S");try{if(addLoadingIndicator(),console.log("undo actions",e,o,_),g_undo_details=[],g_cut_copy_arr=[],g_cut_support_obj_arr=[],g_undoRedoAction=e,g_prev_undo_action="REDO"==e?last_redo_action():await last_action(),console.log("g_prev_undo_action",g_prev_undo_action),"undefined"!=typeof g_prev_undo_action){if("CREATE_ITEM"==g_prev_undo_action){if(g_delete_details.length>0)await deleteObject(g_pog_index,g_delete_details,"N","N",-1,"U");else await delete_item(g_undo_details[0].ObjID,g_undo_details[0].MIndex,g_undo_details[0].SIndex,g_undo_details[0].IIndex,g_prev_undo_action,"N",_);"undefined"!=typeof g_clearInfoType&&"Y"==g_clearInfoType&&(g_prev_undo_action="REDO"==e?last_redo_action():await last_action())}if("CLEAR_POG_INFO"==g_prev_undo_action&&undo_clear_pog_info(_),"CLEAR_POG_ATT"==g_prev_undo_action){var n={};we="REDO"==g_undoRedoAction?"U":"R",n.OldPOGCode=g_pog_json[_].POGCode,n.OldPOGName=g_pog_json[_].Name,n.OldPOGDivision=g_pog_json[_].Division,n.OldPOGDept=g_pog_json[_].Dept,n.OldPOGSubDept=g_pog_json[_].SubDept,n.OldEffStartDate=g_pog_json[_].EffStartDate,g_pog_json[_].POGCode=g_undo_details[0].OldPOGCode,g_pog_json[_].Name=g_undo_details[0].OldPOGName,g_pog_json[_].Division=g_undo_details[0].OldPOGDivision,g_pog_json[_].Dept=g_undo_details[0].OldPOGDept,g_pog_json[_].SubDept=g_undo_details[0].OldPOGSubDept,g_pog_json[_].EffStartDate=g_undo_details[0].OldEffStartDate,$s("P25_POG_DIVISION","");var t=g_pog_json[_].ModuleInfo;$.each(t,(function(e,o){void 0!==o.ParentModule&&null!=o.ParentModule||(g_pog_json[_].ModuleInfo[e].SubDept=g_pog_json[_].ModuleInfo[e].OldPOGModuleSubDept,g_pog_json[_].ModuleInfo[e].OldPOGModuleSubDept="")})),g_undo_details=[],g_undo_details.push(n),"U"==we?(g_delete_details.multi_delete_shelf_ind="N",g_undo_all_obj_arr=[],g_undo_all_obj_arr.push(g_undo_details),g_undo_all_obj_arr.push(g_cut_copy_arr),g_undo_all_obj_arr.previousAction=g_prev_undo_action,g_undo_all_obj_arr.clearInfoType=g_clearInfoType,g_cut_support_obj_arr.length>0?g_undo_all_obj_arr.hasSupportArr="Y":g_undo_all_obj_arr.hasSupportArr="N",g_undo_all_obj_arr.g_MultiObjects="N",g_undo_all_obj_arr.multi_delete_shelf_ind="N",g_undo_final_obj_arr.push(g_undo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]):(g_delete_details.multi_delete_shelf_ind="N",g_redo_all_obj_arr=[],g_redo_all_obj_arr.push(g_undo_details),g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.previousAction=g_prev_undo_action,g_redo_all_obj_arr.clearInfoType=g_clearInfoType,g_cut_support_obj_arr.length>0?g_redo_all_obj_arr.hasSupportArr="Y":g_redo_all_obj_arr.hasSupportArr="N",g_redo_all_obj_arr.g_MultiObjects="N",g_redo_all_obj_arr.multi_delete_shelf_ind="N",g_redo_final_obj_arr.push(g_redo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]),"undefined"!=typeof g_clearInfoType&&"Y"==g_clearInfoType&&("CLEAR_POG_INFO"!=g_prev_undo_action&&"CLEAR_POG_ATT"!=g_prev_undo_action||(g_prev_undo_action="REDO"==e?last_redo_action():await last_action()))}if("CLEAR_ITEM"==g_prev_undo_action){var g=0;[].push(g_undo_details);for(const Be of g_delete_details){if("ITEM"==Be.Object){var a;$.each(g_pog_json[_].ModuleInfo,(function(e,o){o.MObjID==Be.MObjID&&(g_module_index=e)})),$.each(g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo,(function(e,o){o.SObjID==Be.SObjID&&(g_shelf_index=e)}));for(const Ve of g_cut_copy_arr)Be.ObjID==Ve.ObjID&&(a=Ve);g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.push(a);var l=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X-g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].W/2,s=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y;reset_top_bottom_objects(g_module_index,g_shelf_index,"Y",_),await context_create_items(a,g_module_index,g_shelf_index,g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.length-1,l,"N",s,o,"Y",_);g_cut_copy_arr.push(JSON.parse(JSON.stringify(g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[Be.IIndex])));var i=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[Be.IIndex].ObjID;async function d(){await fill_undo_detail_arr(i,g_module_index,g_shelf_index,Be.IIndex,g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType,Be.Item,g_pog_json[_].ModuleInfo[g_module_index].MObjID,g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].SObjID,Be.Item,"","","","SHELF")}d(),g_deletedItems.push(Be.ItemID)}g++}await deleted_items_log(g_deletedItems,"A",_);g_delete_details.multi_delete_shelf_ind="N",g_redo_all_obj_arr=[],g_redo_all_obj_arr.push(g_undo_details),g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.previousAction="CREATE_ITEM",g_redo_all_obj_arr.g_MultiObjects=g>1?"Y":"N",g_redo_all_obj_arr.multi_delete_shelf_ind="N",g_redo_final_obj_arr.push(g_redo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[],g_redo_all_obj_arr=[],g_cut_support_obj_arr=[],g_undoRedoAction=e,render(_)}else if("FACING_CHANGE"==g_prev_undo_action){if(""!==g_pog_json[_].ModuleInfo[g_incre_mod_index].ShelfInfo[g_incre_shelf_index].ItemInfo[g_incre_item_index].OldItemBaseHoriz&&void 0!==g_pog_json[_].ModuleInfo[g_incre_mod_index].ShelfInfo[g_incre_shelf_index].ItemInfo[g_incre_item_index].OldItemBaseHoriz){var r=g_pog_json[_].ModuleInfo[g_incre_mod_index].ShelfInfo[g_incre_shelf_index].ItemInfo[g_incre_item_index].OldItemBaseHoriz,f=g_pog_json[_].ModuleInfo[g_incre_mod_index].ShelfInfo[g_incre_shelf_index].ItemInfo[g_incre_item_index].OldItemBaseVert,I=g_pog_json[_].ModuleInfo[g_incre_mod_index].ShelfInfo[g_incre_shelf_index].ItemInfo[g_incre_item_index].OldItemBaseDepth;g_pog_json[_].ModuleInfo[g_incre_mod_index].ShelfInfo[g_incre_shelf_index].ItemInfo[g_incre_item_index].OldItemBaseHoriz="",g_pog_json[_].ModuleInfo[g_incre_mod_index].ShelfInfo[g_incre_shelf_index].ItemInfo[g_incre_item_index].OldItemBaseVert="",g_pog_json[_].ModuleInfo[g_incre_mod_index].ShelfInfo[g_incre_shelf_index].ItemInfo[g_incre_item_index].OldItemBaseDepth="";await update_item_facings(g_incre_mod_index,g_incre_shelf_index,g_incre_item_index,r,f,I,"VertiFacing",!1,"Y",g_world,"Y")}}else if("DRAG_ITEM"==g_prev_undo_action){if("Y"==g_compare_pog_flag&&g_ComViewIndex==g_curr_canvas&&g_delete_details.length>0){if(void 0!==g_delete_details[0].g_drag_items_arr&&"EDIT_PALLET"==g_compare_view){for(const We of g_delete_details[0].g_drag_items_arr){var c=0,p=-1;for(const Xe of g_pog_json[g_ComViewIndex].ModuleInfo[0].ShelfInfo[0].ItemInfo){if(Xe.ObjID==We.ObjID){p=c;break}c++}g_pog_json[g_ComViewIndex].ModuleInfo[0].ShelfInfo[0].ItemInfo[p].old_position_x=g_pog_json[g_ComViewIndex].ModuleInfo[0].ShelfInfo[0].ItemInfo[p].X,g_pog_json[g_ComViewIndex].ModuleInfo[0].ShelfInfo[0].ItemInfo[p].old_position_y=g_pog_json[g_ComViewIndex].ModuleInfo[0].ShelfInfo[0].ItemInfo[p].Y,g_pog_json[g_ComViewIndex].ModuleInfo[0].ShelfInfo[0].ItemInfo[p].old_position_z=g_pog_json[g_ComViewIndex].ModuleInfo[0].ShelfInfo[0].ItemInfo[p].Z,g_pog_json[g_ComViewIndex].ModuleInfo[0].ShelfInfo[0].ItemInfo[p].X=We.old_position_x,g_pog_json[g_ComViewIndex].ModuleInfo[0].ShelfInfo[0].ItemInfo[p].Y=We.old_position_y,g_pog_json[g_ComViewIndex].ModuleInfo[0].ShelfInfo[0].ItemInfo[p].Z=We.old_position_z;var u=We.old_position_x,m=We.old_position_y,h=We.Z;(b=g_scene_objects[g_ComViewIndex].scene.children[2].getObjectById(g_pog_json[g_ComViewIndex].ModuleInfo[0].ShelfInfo[0].ItemInfo[p].ObjID)).position.set(We.old_position_x,We.old_position_y,We.Z),b.old_position_x=u,b.old_position_y=m,b.old_position_z=h}render(g_ComViewIndex);for(const Ue of g_delete_details[0].g_drag_items_arr){var S;c=0,p=-1;for(const ke of g_pog_json[g_ComViewIndex].ModuleInfo[0].ShelfInfo[0].ItemInfo){if(ke.ObjID==Ue.ObjID){S=ke,p=c;break}c++}g_temp_cut_arr.push(JSON.parse(JSON.stringify(S)));var[x,O,M]=get_item_index(S.ObjID,"C",g_ComBaseIndex);g_curr_canvas=1;var j=g_pog_json[g_ComBaseIndex].ModuleInfo[x].ShelfInfo[O].ItemInfo[M].X,D=g_pog_json[g_ComBaseIndex].ModuleInfo[x].ShelfInfo[O].ItemInfo[M].Z;g_pog_json[g_ComBaseIndex].ModuleInfo[x].ShelfInfo[O],g_pog_json[g_ComBaseIndex].ModuleInfo[x].ShelfInfo[O].ItemInfo[M],u=g_pog_json[g_ComBaseIndex].ModuleInfo[x].ShelfInfo[O].ItemInfo[M].BaseItemOldX,h=g_pog_json[g_ComBaseIndex].ModuleInfo[x].ShelfInfo[O].ItemInfo[M].BaseItemOldZ;g_pog_json[g_ComBaseIndex].ModuleInfo[x].ShelfInfo[O].ItemInfo[M].BaseItemOldX=j,g_pog_json[g_ComBaseIndex].ModuleInfo[x].ShelfInfo[O].ItemInfo[M].X=u;var b=g_scene_objects[g_ComBaseIndex].scene.children[2].getObjectById(g_pog_json[g_ComBaseIndex].ModuleInfo[x].ShelfInfo[O].ItemInfo[M].ObjID);g_pog_json[g_ComBaseIndex].ModuleInfo[x].ShelfInfo[O].ItemInfo[M].BaseItemOldZ=D,g_pog_json[g_ComBaseIndex].ModuleInfo[x].ShelfInfo[O].ItemInfo[M].Z=h,b.position.x=u,b.position.z=h,g_delete_details[0].BaseItemOldX=j,g_delete_details[0].BaseItemOldZ=D}render(g_ComBaseIndex)}else{(b=g_scene_objects[g_ComViewIndex].scene.children[2].getObjectById(g_cut_copy_arr[0].ObjID)).position.x=g_cut_copy_arr[0].X,b.position.y=g_cut_copy_arr[0].Y,g_temp_cut_arr=[],g_temp_cut_arr.push(JSON.parse(JSON.stringify(g_pog_json[_].ModuleInfo[g_delete_details[0].MIndex].ShelfInfo[g_delete_details[0].SIndex].ItemInfo[g_delete_details[0].IIndex]))),g_pog_json[g_ComViewIndex].ModuleInfo[g_delete_details[0].MIndex].ShelfInfo[g_delete_details[0].SIndex].ItemInfo[g_delete_details[0].IIndex].X=g_cut_copy_arr[0].X,g_pog_json[g_ComViewIndex].ModuleInfo[g_delete_details[0].MIndex].ShelfInfo[g_delete_details[0].SIndex].ItemInfo[g_delete_details[0].IIndex].Y=g_cut_copy_arr[0].Y,render(g_ComViewIndex);j=g_pog_json[_].ModuleInfo[g_delete_details[0].mod_ind].ShelfInfo[g_delete_details[0].shelf_ind].ItemInfo[g_delete_details[0].item_ind].X;g_pog_json[_].ModuleInfo[g_delete_details[0].mod_ind].ShelfInfo[g_delete_details[0].shelf_ind].ItemInfo[g_delete_details[0].item_ind].X=g_delete_details[0].BaseItemOldX;D=(b=g_scene_objects[_].scene.children[2].getObjectById(g_delete_details[0].BaseItemObjID)).position.z;b.position.x=g_delete_details[0].BaseItemOldX,b.position.z=g_delete_details[0].BaseItemOldZ,g_delete_details[0].BaseItemOldX=j,g_delete_details[0].BaseItemOldZ=D,render(_)}g_delete_details.multi_delete_shelf_ind="N","UNDO"==e?(g_redo_all_obj_arr=[],g_delete_details[0].g_drag_items_arr=g_temp_cut_arr,g_redo_all_obj_arr.push(g_delete_details),g_redo_all_obj_arr.previousAction=g_prev_undo_action,g_redo_all_obj_arr.hasSupportArr="N",g_redo_all_obj_arr.g_MultiObjects="Y",g_redo_all_obj_arr.g_curr_canvas=g_ComViewIndex,g_redo_all_obj_arr.multi_delete_shelf_ind="N",g_redo_final_obj_arr.push(g_redo_all_obj_arr)):(g_undo_all_obj_arr=[],g_delete_details[0].g_drag_items_arr=g_temp_cut_arr,g_undo_all_obj_arr.push(g_delete_details),g_undo_all_obj_arr.previousAction=g_prev_undo_action,g_undo_all_obj_arr.hasSupportArr="N",g_undo_all_obj_arr.g_MultiObjects="Y",g_undo_all_obj_arr.g_curr_canvas=g_ComViewIndex,g_undo_all_obj_arr.multi_delete_shelf_ind="N",g_undo_final_obj_arr.push(g_undo_all_obj_arr)),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[],g_temp_cut_arr=[],g_redo_all_obj_arr=[],g_undo_all_obj_arr=[],g_cut_support_obj_arr=[],g_undoRedoAction=e}}else if("MAX_ALL_FACINGS"==g_prev_undo_action){if(g_undo_details=[],cut_copy_arr1=[],we="REDO"==g_undoRedoAction?"U":"R",g_delete_details.length>0){var v=JSON.parse(JSON.stringify(g_pog_json[_].ModuleInfo));g_temp_cut_arr=[],$.each(g_pog_json[_].ModuleInfo,(function(e,o){if(void 0===o.ParentModule||null==o.ParentModule){var n=o.ShelfInfo;$.each(n,(function(o,n){if("SHELF"==n.ObjType&&($.each(n.ItemInfo,(function(n,t){void 0!==g_delete_details[0][e]?(g_pog_json[_].ModuleInfo[e].ShelfInfo[o].ItemInfo[n].D=g_delete_details[0][e].ShelfInfo[o].ItemInfo[n].D,g_pog_json[_].ModuleInfo[e].ShelfInfo[o].ItemInfo[n].BaseD=g_delete_details[0][e].ShelfInfo[o].ItemInfo[n].BaseD,g_pog_json[_].ModuleInfo[e].ShelfInfo[o].ItemInfo[n].RD=g_delete_details[0][e].ShelfInfo[o].ItemInfo[n].D,g_pog_json[_].ModuleInfo[e].ShelfInfo[o].ItemInfo[n].H=g_delete_details[0][e].ShelfInfo[o].ItemInfo[n].H,g_pog_json[_].ModuleInfo[e].ShelfInfo[o].ItemInfo[n].BVert=g_delete_details[0][e].ShelfInfo[o].ItemInfo[n].BVert,g_pog_json[_].ModuleInfo[e].ShelfInfo[o].ItemInfo[n].Y=g_delete_details[0][e].ShelfInfo[o].ItemInfo[n].Y,g_pog_json[_].ModuleInfo[e].ShelfInfo[o].ItemInfo[n].RH=g_delete_details[0][e].ShelfInfo[o].ItemInfo[n].RH):(g_pog_json[_].ModuleInfo[e].ShelfInfo[o].ItemInfo[n].D=g_delete_details[e].ShelfInfo[o].ItemInfo[n].D,g_pog_json[_].ModuleInfo[e].ShelfInfo[o].ItemInfo[n].BaseD=g_delete_details[e].ShelfInfo[o].ItemInfo[n].BaseD,g_pog_json[_].ModuleInfo[e].ShelfInfo[o].ItemInfo[n].RD=g_delete_details[e].ShelfInfo[o].ItemInfo[n].D,g_pog_json[_].ModuleInfo[e].ShelfInfo[o].ItemInfo[n].H=g_delete_details[e].ShelfInfo[o].ItemInfo[n].H,g_pog_json[_].ModuleInfo[e].ShelfInfo[o].ItemInfo[n].BVert=g_delete_details[e].ShelfInfo[o].ItemInfo[n].BVert,g_pog_json[_].ModuleInfo[e].ShelfInfo[o].ItemInfo[n].Y=g_delete_details[e].ShelfInfo[o].ItemInfo[n].Y,g_pog_json[_].ModuleInfo[e].ShelfInfo[o].ItemInfo[n].RH=g_delete_details[e].ShelfInfo[o].ItemInfo[n].RH)})),reset_auto_crush(e,o,-1,_,e,o,_),reorder_items(e,o,_))){(async function(){recreate_all_items(e,o,"SHELF","N",-1,-1,n.ItemInfo.length,"N","N",1,-1,g_start_canvas,"",_,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")})()}}))}})),"U"==we?(g_delete_details.multi_delete_shelf_ind="N",g_undo_all_obj_arr=[],g_redo_all_obj_arr=[],g_undo_all_obj_arr.push(v),g_undo_all_obj_arr.push(g_undo_details),g_undo_all_obj_arr.previousAction="MAX_ALL_FACINGS",g_undo_all_obj_arr.g_MultiObjects="Y",g_undo_all_obj_arr.multi_delete_shelf_ind="N",g_undo_final_obj_arr.push(g_undo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],cut_copy_arr1=[],g_undo_details=[],g_mselect_drag="N",g_multiselect="N",g_undo_all_obj_arr=[],g_temp_cut_arr=[],v=[]):(g_delete_details.multi_delete_shelf_ind="N",g_undo_all_obj_arr=[],g_redo_all_obj_arr=[],g_redo_all_obj_arr.push(v),g_redo_all_obj_arr.push(g_undo_details),g_redo_all_obj_arr.previousAction="MAX_ALL_FACINGS",g_redo_all_obj_arr.g_MultiObjects="Y",g_redo_all_obj_arr.multi_delete_shelf_ind="N",g_redo_final_obj_arr.push(g_redo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],cut_copy_arr1=[],g_undo_details=[],g_mselect_drag="N",g_multiselect="N",g_redo_all_obj_arr=[],g_temp_cut_arr=[],v=[])}}else if("FIXTURE_NUMBERING"==g_prev_undo_action){loc_details={},g_undo_all_obj_arr=[],g_redo_all_obj_arr=[],g_cut_copy_arr=[],89==g_keyCode||90==g_keyCode||(g_redo_all_obj_arr=[],g_redo_final_obj_arr=[],E="U",g_undoRedoAction="REDO"),we="REDO"==g_undoRedoAction?"U":"R",loc_details.MODULE_DIR=$v("P25_MODULE_DIR"),loc_details.DIRECTION=$v("P25_DIRECTION"),loc_details.ORDER_TYPE=$v("P25_ORDER_TYPE"),loc_details.START_ONE_MOD=$v("P25_START_ONE_MOD"),loc_details.INCLUDE_MOD_NAME=$v("P25_INCLUDE_MOD_NAME"),loc_details.SEPARATOR=$v("P25_SEPARATOR"),loc_details.LEADING_TEXT=$v("P25_LEADING_TEXT"),loc_details.TRAILING_TEXT=$v("P25_TRAILING_TEXT"),loc_details.START_ONE_FIXEL=$v("P25_START_ONE_FIXEL"),loc_details.START_ONE_MOD_LOC=$v("P25_START_ONE_MOD_LOC"),$s("P25_MODULE_DIR",g_undo_details[0].MODULE_DIR),$s("P25_DIRECTION",g_undo_details[0].DIRECTION),$s("P25_ORDER_TYPE",g_undo_details[0].ORDER_TYPE),$s("P25_START_ONE_MOD",g_undo_details[0].START_ONE_MOD),$s("P25_START_ONE_FIXEL",g_undo_details[0].START_ONE_FIXEL),$s("P25_START_ONE_MOD_LOC",g_undo_details[0].START_ONE_MOD_LOC),$s("P25_INCLUDE_MOD_NAME",g_undo_details[0].INCLUDE_MOD_NAME),$s("P25_SEPARATOR",g_undo_details[0].SEPARATOR),$s("P25_LEADING_TEXT",g_undo_details[0].LEADING_TEXT),$s("P25_TRAILING_TEXT",g_undo_details[0].TRAILING_TEXT),"Y"==g_show_fixel_label&&show_fixel_labels("Y",_),fixture_numbering(g_undo_details[0].MODULE_DIR,g_undo_details[0].DIRECTION,g_undo_details[0].IGNORE,g_undo_details[0].ORDER_TYPE,g_undo_details[0].START_ONE_MOD,g_undo_details[0].INCLUDE_MOD_NAME,g_undo_details[0].SEPARATOR,g_undo_details[0].LEADING_TEXT,g_undo_details[0].TRAILING_TEXT,_),g_cut_copy_arr.push(loc_details),loc_details={},"U"==we?(g_delete_details.multi_delete_shelf_ind="N",g_undo_all_obj_arr=[],g_undo_all_obj_arr.push(g_cut_copy_arr),g_undo_all_obj_arr.push(g_cut_copy_arr),g_undo_all_obj_arr.previousAction="FIXTURE_NUMBERING",g_undo_all_obj_arr.hasSupportArr="N",g_undo_all_obj_arr.g_MultiObjects="N",g_undo_all_obj_arr.multi_delete_shelf_ind="N",g_undo_final_obj_arr.push(g_undo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]):(g_delete_details.multi_delete_shelf_ind="N",g_redo_all_obj_arr=[],g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.previousAction="FIXTURE_NUMBERING",g_redo_all_obj_arr.hasSupportArr="N",g_redo_all_obj_arr.g_MultiObjects="N",g_redo_all_obj_arr.multi_delete_shelf_ind="N",g_redo_final_obj_arr.push(g_redo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[])}else if("LOCATION_NUMBERING"==g_prev_undo_action){loc_details={},g_undo_all_obj_arr=[],g_redo_all_obj_arr=[],89==g_keyCode||90==g_keyCode||(g_redo_all_obj_arr=[],g_redo_final_obj_arr=[],E="U",g_undoRedoAction="REDO"),we="REDO"==g_undoRedoAction?"U":"R",loc_details.MODULE_DIR=$v("P25_MODULE_DIR"),loc_details.DIRECTION=$v("P25_DIRECTION"),loc_details.ORDER_TYPE=$v("P25_ORDER_TYPE"),loc_details.START_ONE_FIXEL=$v("P25_START_ONE_FIXEL"),loc_details.START_ONE_MOD_LOC=$v("P25_START_ONE_MOD_LOC"),$s("P25_MODULE_DIR",g_undo_details[0].MODULE_DIR),$s("P25_DIRECTION",g_undo_details[0].DIRECTION),$s("P25_ORDER_TYPE",g_undo_details[0].ORDER_TYPE),$s("P25_START_ONE_FIXEL",g_undo_details[0].START_ONE_FIXEL),$s("P25_START_ONE_MOD_LOC",g_undo_details[0].START_ONE_MOD_LOC),location_numbering(g_undo_details[0].MODULE_DIR,g_undo_details[0].DIRECTION,g_undo_details[0].order_type,g_undo_details[0].start_one_fixel,g_undo_details[0].start_one_mod,_),g_cut_copy_arr.push(loc_details),loc_details={},"U"==we?(g_delete_details.multi_delete_shelf_ind="N",g_undo_all_obj_arr=[],g_undo_all_obj_arr.push(g_cut_copy_arr),g_undo_all_obj_arr.push(g_cut_copy_arr),g_undo_all_obj_arr.previousAction="LOCATION_NUMBERING",g_undo_all_obj_arr.hasSupportArr="N",g_undo_all_obj_arr.g_MultiObjects="N",g_undo_all_obj_arr.multi_delete_shelf_ind="N",g_undo_final_obj_arr.push(g_undo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]):(g_delete_details.multi_delete_shelf_ind="N",g_redo_all_obj_arr=[],g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.previousAction="LOCATION_NUMBERING",g_redo_all_obj_arr.hasSupportArr="N",g_redo_all_obj_arr.g_MultiObjects="N",g_redo_all_obj_arr.multi_delete_shelf_ind="N",g_redo_final_obj_arr.push(g_redo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]),"Y"==g_show_item_label&&show_item_labels("Y",$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),_),"Y"==g_itemSubLabelInd&&($(".item_sublabel").addClass("item_sublabel_active"),$("#item_sublbl_sub ."+g_itemSubLabel).addClass("item_sublabel_active"),showItemSubLabel(g_itemSubLabel,g_itemSubLabelInd,$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),_))}else if("MODULE_DELETE"==g_prev_undo_action){if("UNDO"==g_undoRedoAction)var E="R";else E="U";g_module_index=g_undo_details[0].MIndex,g_pog_json[g_undo_details[0].p_pog_index].ModuleInfo.splice(g_undo_details[0].MIndex,0,g_cut_copy_arr[0]),g_pog_json[g_undo_details[0].p_pog_index].ModuleInfo[g_undo_details[0].MIndex].SubDept=g_pog_json[g_undo_details[0].p_pog_index].SubDept;var C=g_pog_json[g_undo_details[0].p_pog_index].H,P=g_pog_json[g_undo_details[0].p_pog_index].W;g_pog_json[g_undo_details[0].p_pog_index].H=g_pog_json[g_undo_details[0].p_pog_index].PrevH,g_pog_json[g_undo_details[0].p_pog_index].W=g_pog_json[g_undo_details[0].p_pog_index].PrevW,g_pog_json[g_undo_details[0].p_pog_index].PrevH=C,g_pog_json[g_undo_details[0].p_pog_index].PrevW=P;var N=g_pog_json[g_undo_details[0].p_pog_index].ModuleInfo[g_undo_details[0].MIndex].ShelfInfo,T=g_undo_details[0].p_pog_index;c=0;for(const ze of N){var y=g_pog_json[g_undo_details[0].p_pog_index].ModuleInfo[g_undo_details[0].MIndex].ShelfInfo[c].ItemInfo;$.each(y,(function(e,o){g_deletedItems.push(o.ItemID)})),c++}await context_create_module(g_cut_copy_arr,o,"Y",T,"N"),await deleted_items_log(g_deletedItems,"A",T),await update_undo_details("","",g_undo_details[0].MIndex,"","","","ITEM","","","N","","","","","","MODULE_CREATE","","","","","",E,"","","","",g_undo_details[0].p_pog_index)}else if("MODULE_CREATE"==g_prev_undo_action){if("UNDO"==g_undoRedoAction)E="R";else E="U";JSON.parse(JSON.stringify(g_pog_json));g_module_index=g_undo_details[0].MIndex;T=g_undo_details[0].p_pog_index;await deleteObject(g_undo_details[0].p_pog_index,"","N","Y",g_module_index,E);C=g_pog_json[T].H,P=g_pog_json[T].W;g_pog_json[T].H=g_pog_json[T].PrevH,g_pog_json[T].W=g_pog_json[T].PrevW,g_pog_json[T].PrevH=C,g_pog_json[T].PrevW=P}else if("SHELF_DELETE"==g_prev_undo_action||"ITEM_DELETE"==g_prev_undo_action||"SHELF_DRAG"==g_prev_undo_action){console.log("g_prev_undo_action",g_prev_undo_action);var Y=[],R=[];infoLogged="N","undefined"==typeof g_undoRedoAction&&(g_undoRedoAction="REDO"),we="REDO"==g_undoRedoAction?"U":"R";c=0;for(sf of g_delete_details){var L=sf.moduleIndex,H=sf.shelfIndex,F=sf.actionType,w=sf.objectID,A=sf.moduleObjectID,G=sf.g_deletedItems,B=sf.itemColorFlag,V=sf.pogInfo,W=void 0===sf.IsCarpark?"N":sf.IsCarpark,X=void 0===sf.CombineInd?"N":sf.CombineInd,U=void 0===sf.CombShelfIndex?-1:sf.CombShelfIndex;if(-1!==U&&void 0!==sf[U])var k=sf[U];else k=sf[0];var z=[],J=void 0===sf.startCanvas?1:sf.startCanvas,Z=void 0===sf.g_present_canvas?sf.startCanvas:sf.g_present_canvas,q=[],K=[];if(console.log("g_delete_details",g_delete_details,J,Z,F),q.push(g_pog_json[J]),K.push(g_pog_json[Z]),Ae=g_scene_objects[J].scene.children[2],$e=g_scene_objects[Z].scene.children[2],void 0===(z=sf.supportArr)&&(z=[]),void 0!==V&&"N"==infoLogged){var Q={};Q.OldPOGCode=q[0].POGCode,Q.OldPOGName=q[0].Name,Q.OldPOGDivision=q[0].Division,Q.OldPOGDept=q[0].Dept,Q.OldPOGSubDept=q[0].SubDept,Q.OldEffStartDate=q[0].EffStartDate,q[0].POGCode=V.OldPOGCode,q[0].Name=V.OldPOGName,q[0].Division=V.OldPOGDivision,q[0].Dept=V.OldPOGDept,q[0].SubDept=V.OldPOGSubDept,q[0].EffStartDate=V.OldEffStartDate,infoLogged="Y"}if("SHELF_DRAG"==F){if(J!==Z){var ee=k.X,oe=(s=k.Y,-1),_e=-1,ne=0;for(const Je of K[0].ModuleInfo){if(null==Je.ParentModule||"undefined"==Je.ParentModule){Je.MObjID==A&&(oe=ne);var te=0;for(const Ze of Je.ShelfInfo){if(Ze.SObjID==w){_e=te,oe=ne;break}te+=1}}ne++}(R=[]).moduleIndex=oe,R.shelfIndex=_e,R.actionType=F,R.module=q[0].ModuleInfo[L].Module,R.moduleObjectID=q[0].ModuleInfo[L].MObjID;var ge=K[0].ModuleInfo[oe].ShelfInfo[_e],ae=K[0].ModuleInfo[oe].ShelfInfo[_e];R.startCanvas=Z,R.g_present_canvas=J,K[0].ModuleInfo[oe].ShelfInfo.splice(_e,1),q[0].ModuleInfo[L].ShelfInfo.splice(H,0,k);var le=-1,se=-1;$.each(k.ItemInfo,(function(e,o){le=o.X,se=o.Y}));var ie=-1,de=0;$.each(q[0].ModuleInfo[L].ShelfInfo,(function(e,o){if(o.SObjID==w)return ie=de,!1;de++}));var re=-1;async function fe(){g_world=Ae;var e=$e.getObjectById(w);[_,i]=await create_drag_objects(L,ie,-1,k,k.ItemInfo,g_show_live_image,"SHELF",e,J,J),$e.remove(e),re=i,(e=_).updateMatrix();g_drag_items_arr=[];q[0].ModuleInfo[L].ShelfInfo[H].ItemInfo;$.each(ge.ItemInfo,(function(e,o){var _=$e.getObjectById(o.ObjID);void 0!==_&&("PEGBOARD"!==g_shelf_object_type?_.Distance=o.Distance:(_.PegBoardX=o.PegBoardX,_.PegBoardY=o.PegBoardY),_.ItemInfo=o,_.IIndex=e,_.StartCanvas=J,_.MIndex=L,_.SIndex=H,_.X=o.X,_.Y=o.Y,g_drag_items_arr.push(_))}));var o=[];if(g_drag_items_arr.length>0){for(const e of g_drag_items_arr){$e.remove(e);var[_,n]=await create_drag_objects(e.MIndex,e.SIndex,e.IIndex,e.ShelfInfo,e.ItemInfo,g_show_live_image,"ITEM",e,J,J);_.position.x=e.X,_.position.y=e.Y,_.updateMatrix(),o.push(_)}o.length>0&&(g_drag_items_arr=[],g_drag_items_arr=o);await set_inter_canvas_items(k.X,k.Y,e,o,e.W,e.H,g_shelf_object_type,g_shelf_basket_spread,e.Rotation,e.ItemSlope,ie,L,J)}ae.SObjID=re,R.objectID=re;var t=0,g=q[0].ModuleInfo[L].ShelfInfo[H].ItemInfo;for(const e of ae.ItemInfo){for(const o of g)e.ObjID==o.OldObjID&&(ae.ItemInfo[t].ObjID=o.ObjID);t++}if(R.push(JSON.parse(JSON.stringify(ae))),Y.push(R),q[0].ModuleInfo[L].ShelfInfo[H].NotchLabelObjID=ge.NotchLabelObjID,q[0].ModuleInfo[L].ShelfInfo[H].availableSpaceObjID=ge.availableSpaceObjID,"Y"==g_show_notch_label||"Y"==g_show_notch_label_comp)update_single_notch_label("Y",L,ie,$v("P25_NOTCH_HEAD"),"",J,"N")}await fe();g_drag_items_arr=[]}else{ee=k.X,s=k.Y;var Ie=void 0!==sf.Z?sf.Z:$e.getObjectById(w).position.z;oe=-1,_e=-1,ne=0;for(const qe of q[0].ModuleInfo){if(null==qe.ParentModule||"undefined"==qe.ParentModule){qe.MObjID==A&&(oe=ne);te=0;for(const Ke of qe.ShelfInfo){if(Ke.SObjID==w){_e=te,oe=ne;break}te+=1}}ne++}(R=[]).moduleIndex=oe,R.shelfIndex=_e,R.actionType=F,R.module=q[0].ModuleInfo[oe].Module,R.objectID=w,R.startCanvas=Z,R.g_present_canvas=J,R.moduleObjectID=q[0].ModuleInfo[L].MObjID;ge=JSON.parse(JSON.stringify(q[0].ModuleInfo[oe].ShelfInfo[_e]));var ce=Ae.getObjectById(w),pe=(JSON.parse(JSON.stringify(q[0].ModuleInfo[oe].ShelfInfo[_e].ItemInfo)),JSON.parse(JSON.stringify(k.ItemInfo)));ce.position.x=ee,ce.position.y=s,ce.Module=q[0].ModuleInfo[L].Module,"TEXTBOX"==q[0].ModuleInfo[oe].ShelfInfo[_e].ObjType&&void 0!==Ie&&(R.Z=ce.position.z,ce.position.z=Ie,ce.Z=100*k.Z),k.SObjID=w,q[0].ModuleInfo[oe].ShelfInfo.splice(_e,1),k.Combine="N",q[0].ModuleInfo[L].ShelfInfo.splice(H,0,k);var ue="N";for(const Qe of k.ItemInfo)for(const eo of ge.ItemInfo)Qe.Item==eo.Item&&Qe.BVert!==eo.BVert&&(ue="Y");if("Y"==ue){$.each(k.ItemInfo,(function(e,o){le=o.X,se=o.Y,q[0].ModuleInfo[L].ShelfInfo[H].ItemInfo[e].ObjID=ge.ItemInfo[e].ObjID,q[0].ModuleInfo[L].ShelfInfo[H].ItemInfo[e].X=le,q[0].ModuleInfo[L].ShelfInfo[H].ItemInfo[e].Y=se;var _=Ae.getObjectById(ge.ItemInfo[e].ObjID);void 0!==_&&Ae.remove(_)}));recreate_all_items(L,H,k.ObjType,"Y",-1,-1,k.ItemInfo.length,"N","N",-1,-1,J,"",J,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")}else{le=-1,se=-1;$.each(k.ItemInfo,(function(e,o){le=o.X,se=o.Y,k.ItemInfo[e].ObjID=ge.ItemInfo[e].ObjID,k.ItemInfo[e].X=le,k.ItemInfo[e].Y=se;var _=Ae.getObjectById(ge.ItemInfo[e].ObjID);void 0!==_&&(_.position.y=se,_.position.x=le)}))}if(R.push(JSON.parse(JSON.stringify(ge))),Y.push(R),k.NotchLabelObjID=ge.NotchLabelObjID,"Y"==g_show_notch_label)update_single_notch_label("Y",L,H,$v("P25_NOTCH_HEAD"),"",Z,"N")}e="SHELF_DRAG"}else if("DUPLICATE_SHELF"==F)if("REDO"==e){q[0].ModuleInfo[L].ShelfInfo.push(k);_e=-1;var me=0,he=JSON.parse(JSON.stringify(q[0].ModuleInfo[L].ShelfInfo));for(Se of he){if(Se.SObjID==w){_e=me;break}me++}var Se=JSON.parse(JSON.stringify(q[0].ModuleInfo[L].ShelfInfo[_e]));z.length>0&&q[0].ModuleInfo.push(z[0]);var[xe,ie,Oe]=await context_create_shelfs(Se,-1,-1,L,_e,"N","Y",o,"N","","Y",J);await updateObjID(w,ie),R=[];z.length>0&&(R.supportArr=z),R.moduleIndex=L,R.shelfIndex=_e,R.actionType=F,R.objectID=ie,R.startCanvas=J,R.module=q[0].ModuleInfo[L].Module,R.moduleObjectID=q[0].ModuleInfo[L].MObjID,R.push(JSON.parse(JSON.stringify(q[0].ModuleInfo[L].ShelfInfo[_e]))),Y.push(R),e="SHELF_DELETE"}else{R=[];var[Me,je,De,be]=get_curr_module(k.X,k.Y,"Y",L,H,k,J),[je,Me,ve,s,Ee,Ce,Pe]=get_div_shelf_index(k.X,k.Y,Me,"Y",J,"",!1);_e=-1,de=0;$.each(q[0].ModuleInfo[L].ShelfInfo,(function(e,o){if(o.SObjID==w)return _e=de,!1;de++}));pe=JSON.parse(JSON.stringify(q[0].ModuleInfo[L].ShelfInfo[_e].ItemInfo));$.each(pe,(function(e,o){var _=Ae.getObjectById(o.ObjID);Ae.remove(_)}));var Ne=Ae.getObjectById(w);Ae.remove(Ne),R.push(JSON.parse(JSON.stringify(q[0].ModuleInfo[L].ShelfInfo[_e]))),q[0].ModuleInfo[L].ShelfInfo.splice(_e,1),R.moduleIndex=L,R.module=q[0].ModuleInfo[L].Module,R.moduleObjectID=q[0].ModuleInfo[L].MObjID,R.startCanvas=J,R.shelfIndex=_e,R.actionType=F,R.objectID=w,z.length>0&&(R.supportArr=z),Y.push(R),e="SHELF_DELETE"}else if("SHELF_DELETE"==F){Ne=Ae.getObjectById(w);Ae.remove(Ne),q[0].ModuleInfo[L].ShelfInfo.splice(H,0,k);_e=-1,me=0,he=JSON.parse(JSON.stringify(q[0].ModuleInfo[L].ShelfInfo));for(Se of he){if(Se.SObjID==w){_e=me;break}me++}Se=JSON.parse(JSON.stringify(q[0].ModuleInfo[L].ShelfInfo[_e]));z.length>0&&q[0].ModuleInfo.push(z[0]);var[xe,ie,Oe]=await context_create_shelfs(Se,-1,-1,L,_e,"N","Y",o,"N","","Y",J);await updateObjID(w,ie),R=[];z.length>0&&(R.supportArr=z),R.moduleIndex=L,R.shelfIndex=_e,R.actionType=F,R.objectID=ie,R.startCanvas=J,R.module=q[0].ModuleInfo[L].Module,R.moduleObjectID=q[0].ModuleInfo[L].MObjID,R.push(JSON.parse(JSON.stringify(q[0].ModuleInfo[L].ShelfInfo[_e]))),Y.push(R),e="SHELF_DELETE_REDO"}else if("ITEM_DELETE"==F){_e=-1,oe=-1,ne=0;$.each(q[0].ModuleInfo,(function(e,o){if((void 0===o.ParentModule||null==o.ParentModule)&&o.MObjID==A)return oe=ne,!1;ne++}));de=0;$.each(q[0].ModuleInfo[oe].ShelfInfo,(function(e,o){if(o.SObjID==w)return _e=de,!1;de++}));R=[],ge=[];if("Y"==W){if(_e=0,0==q[0].ModuleInfo[oe].Carpark.length){var Te=(n=get_min_max_xy(J)).split("###");for(const oo of k.ItemInfo)max_depth=Math.max(max_depth,oo.D);carpark_shelf(oe+1,q[0].ModuleInfo[oe].W,.04,max_depth+.1,q[0].ModuleInfo[oe].X,parseFloat(Te[1])+.03,oe)}ge=JSON.parse(JSON.stringify(q[0].ModuleInfo[oe].Carpark[_e])),R.push(JSON.parse(JSON.stringify(ge))),pe=JSON.parse(JSON.stringify(q[0].ModuleInfo[oe].Carpark[_e].ItemInfo))}else ge=JSON.parse(JSON.stringify(q[0].ModuleInfo[oe].ShelfInfo[_e])),pe=JSON.parse(JSON.stringify(q[0].ModuleInfo[oe].ShelfInfo[_e].ItemInfo));R.moduleIndex=oe,R.shelfIndex=_e,R.actionType=F,R.IsCarpark=W,R.pogInfo=Q,R.startCanvas=J,R.module=q[0].ModuleInfo[oe].Module,R.moduleObjectID=q[0].ModuleInfo[oe].MObjID,z.length>0&&(R.supportArr=z),$.each(pe,(function(e,o){var _=Ae.getObjectById(o.ObjID);Ae.remove(_)}));Ne=Ae.getObjectById(w);Ae.remove(Ne),z.length>0&&q[0].ModuleInfo[oe].ShelfInfo.push(z[0]);if("Y"==W){q[0].ModuleInfo[oe].Carpark.splice(_e,1,k);ie=await create_shelf_edit_pog(oe,q[0].ModuleInfo[oe].Carpark,width,"Y","Y","D","Y","Y","Y",_,_)}else{if(g_world=g_scene_objects[J].scene.children[2],"Y"==X){var[ye,Ye]=getCombinationShelf(_,k.Shelf);if(-1!==ye&&(R.CombineInd="Y",R.CombShelfIndex=Ye,currCombination=g_combinedShelfs[ye],currCombination.length>1)){var Re=0;for(obj of currCombination){ne=0;var Le=-1,He=-1;$.each(q[0].ModuleInfo,(function(e,o){if((void 0===o.ParentModule||null==o.ParentModule)&&o.MObjID==g_pog_json[obj.PIndex].ModuleInfo[obj.MIndex].MObjID)return Le=ne,!1;ne++}));de=0;$.each(q[0].ModuleInfo[Le].ShelfInfo,(function(e,o){if(o.SObjID==g_pog_json[obj.PIndex].ModuleInfo[obj.MIndex].ShelfInfo[obj.SIndex].SObjID)return He=de,!1;de++}));var Fe=q[0].ModuleInfo[Le].ShelfInfo[He].ItemInfo;$.each(Fe,(function(e,o){var _=Ae.getObjectById(o.ObjID);Ae.remove(_)})),R.push(JSON.parse(JSON.stringify(q[0].ModuleInfo[Le].ShelfInfo[He]))),q[0].ModuleInfo[Le].ShelfInfo.splice(He,1,sf[Re]),Re++}}}else q[0].ModuleInfo[oe].ShelfInfo.splice(_e,1,k);var[xe,ie,Oe]=await context_create_shelfs(k,-1,-1,oe,_e,"N","Y",o,"Y",J,"Y",J)}ge.ItemInfo=pe;await updateObjID(w,ie,"S");if("EDIT_PALLET"==g_compare_view&&w==g_edit_pallet_shelfid&&(g_edit_pallet_shelfid=ie),R.objectID=ie,"N"==X)R.push(JSON.parse(JSON.stringify(ge)));else for(obj of R)obj.MIndex==oe&&obj.SIndex==_e&&(obj.SObjID=ie);Y.push(R),e="ITEM_DELETE",render(J);await calculateFixelAndSupplyDays("N",J)}}if($(".item_label").hasClass("item_label_active")&&(g_show_item_label="Y"),"SHELF_DRAG"!==F&&"SHELF_DELETE"!==F)await calculateFixelAndSupplyDays("N",J);if(void 0!==G&&(void 0===B||"G"==B?(B="R",await deleted_items_log(G,"A",J)):(B="G",await deleted_items_log(G,"D",J)),R.g_deletedItems=G),R.itemColorFlag=B,logFinalUndoObjectsInfo(e,we,Y,"","Y","N","N","N","N","N"),Y=[],Q={},infoLogged="N","Y"==g_compare_pog_flag&&"POG"!==g_compare_view&&1==g_curr_canvas)await recreate_compare_views(g_compare_view,"N");render(g_pog_index),animate_all_pog()}else if("SHELF_DELETE_REDO"==g_prev_undo_action||"ITEM_DELETE_REDO"==g_prev_undo_action){var we;Y=[];"undefined"==typeof g_undoRedoAction&&(g_undoRedoAction="REDO"),we="REDO"==g_undoRedoAction?"U":"R";c=0;for(sf of g_delete_details){L=sf.moduleIndex,H=sf.shelfIndex,k=sf[0],F=sf.actionType,w=sf.objectID,G=sf.g_deletedItems,B=sf.itemColorFlag,V=sf.pogInfo,z=[],J=void 0===sf.startCanvas?1:sf.startCanvas,Z=void 0===sf.g_present_canvas?sf.startCanvas:sf.g_present_canvas,q=g_pog_json,K=g_pog_json;var Ae=g_scene_objects[J].scene.children[2],$e=g_scene_objects[Z].scene.children[2];if(void 0===(z=sf.supportArr)&&(z=[]),void 0!==G)if(void 0===B||"G"==B){B="R";deleted_items_log(G,"A",_)}else{B="G";deleted_items_log(G,"D",_)}if("SHELF_DELETE0"==F){q[_].ModuleInfo[L].ShelfInfo[H].SObjID,q[_].ModuleInfo[L].ShelfInfo[H].ObjType,pe=q[_].ModuleInfo[L].ShelfInfo[H].ItemInfo;var[Me,je,De,be]=get_curr_module(k.X,k.Y,"Y",L,H,k,_),[je,Me,ve,s,Ee,Ce,Pe]=get_div_shelf_index(k.X,k.Y,Me,"Y",_,"",!1);(R=[]).moduleIndex=L,R.shelfIndex=H,R.actionType=F,R.objectID=w,R.module=q[_].ModuleInfo[L].Module,R.moduleObjectID=q[_].ModuleInfo[L].MObjID,R.startCanvas=J,R.push(JSON.parse(JSON.stringify(q[_].ModuleInfo[L].ShelfInfo[H]))),Y.push(R),q[_].ModuleInfo[Me].ShelfInfo.splice(H,0,k)}else if("SHELF_DRAG"==F){ee=k.X,s=k.Y,ce=Ae.getObjectById(k.SObjID),pe=k.ItemInfo;var Ge=k.NotchLabelObjID;k.availableSpaceObjID;ce.position.x=ee,ce.position.y=s;var[Me,je,De,be]=get_curr_module(k.X,k.Y,"Y",L,H,k,_),[je,Me,ve,s,Ee,Ce,Pe]=get_div_shelf_index(k.X,k.Y,Me,"Y",_,"",!1);te=0;for(const _o of q[_].ModuleInfo[L].ShelfInfo){if(k.SObjID==_o.SObjID){H=te;break}te+=1}if(q[_].ModuleInfo[Me].ShelfInfo.splice(H,1),q[_].ModuleInfo[Me].ShelfInfo.splice(Ce,0,k),$.each(pe,(function(e,o){var n=Ae.getObjectById(o.ObjID);n.position.y=o.Y,n.position.x=o.X,q[_].ModuleInfo[Me].ShelfInfo[Ce].ItemInfo[e].X=o.X,q[_].ModuleInfo[Me].ShelfInfo[Ce].ItemInfo[e].Y=o.Y})),q[_].ModuleInfo[Me].ShelfInfo[Ce].NotchLabelObjID=Ge,"Y"==g_show_notch_label)update_single_notch_label("Y",Me,Ce,$v("P25_NOTCH_HEAD"),"",_,"N")}else if("SHELF_DELETE"==F){R=[];var[Me,je,De,be]=get_curr_module(k.X,k.Y,"Y",L,H,k,_),[je,Me,ve,s,Ee,Ce,Pe]=get_div_shelf_index(k.X,k.Y,Me,"Y",_,"",!1);_e=-1,de=0;$.each(q[_].ModuleInfo[L].ShelfInfo,(function(e,o){if(o.SObjID==w)return _e=de,!1;de++}));pe=JSON.parse(JSON.stringify(q[_].ModuleInfo[L].ShelfInfo[_e].ItemInfo));$.each(pe,(function(e,o){var _=Ae.getObjectById(o.ObjID);Ae.remove(_)}));Ne=Ae.getObjectById(w);Ae.remove(Ne),R.push(JSON.parse(JSON.stringify(q[_].ModuleInfo[L].ShelfInfo[_e]))),q[_].ModuleInfo[L].ShelfInfo.splice(_e,1),render(Z),R.moduleIndex=L,R.module=q[_].ModuleInfo[L].Module,R.moduleObjectID=q[_].ModuleInfo[L].MObjID,R.startCanvas=J,R.shelfIndex=_e,R.actionType=F,R.objectID=w,z.length>0&&(R.supportArr=z),Y.push(R)}}if($(".item_label").hasClass("item_label_active")&&(g_show_item_label="Y"),"Y"==g_compare_pog_flag&&"POG"!==g_compare_view&&1==g_curr_canvas)await recreate_compare_views(g_compare_view,"N");R.g_deletedItems=G,R.itemColorFlag=B,logFinalUndoObjectsInfo("SHELF_DELETE","U",Y,"","Y","N","N","N","N","N"),Y=[];await calculateFixelAndSupplyDays("N",_)}else"CREATE_SHELF"==g_prev_undo_action&&context_delete("DELETE",g_undo_details[0].MIndex,g_undo_details[0].SIndex,"","","","Y",g_undo_details[0].SObjID,"",g_undo_details,o,_,"N");if("ITEM_LABEL"==g_prev_undo_action&&(g_show_item_label=g_undo_details[0].show_item_labels,show_item_labels(g_show_item_label,$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),_),"Y"==g_show_item_label?(g_show_item_label="N",$(".item_label").addClass("item_label_active")):(g_show_item_label="N",$(".item_label").removeClass("item_label_active"))),"ITEM_SALE_LABEL"==g_prev_undo_action&&(g_itemSubLabelInd=g_undo_details[0].item_sale_label_ind,g_itemSubLabel=g_undo_details[0].item_sale_label_type,showItemSubLabel(g_itemSubLabel,g_itemSubLabelInd,$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),_),"Y"==g_itemSubLabelInd?($(".item_sublabel").addClass("item_sublabel_active"),$("#item_sublbl_sub ."+g_itemSubLabel).addClass("item_sublabel_active")):($(".item_sublabel").removeClass("item_sublabel_active"),$("#item_sublbl_sub .items").removeClass("item_sublabel_active"))),"FIXEL_LABEL"==g_prev_undo_action&&(g_show_fixel_label=g_undo_details[0].show_fixel_labels,show_fixel_labels(g_show_fixel_label,_),"Y"==g_show_fixel_label?(g_show_fixel_label="N",$(".fixel_label").addClass("fixel_label_active")):(g_show_fixel_label="Y",$(".fixel_label").removeClass("fixel_label_active"))),"NOTCH_LABEL"==g_prev_undo_action&&(g_show_notch_label=g_undo_details[0].show_notch_labels,show_notch_labels(g_show_notch_label,$v("P25_NOTCH_HEAD"),"Y",_),"Y"==g_show_notch_label?$(".notch_label").addClass("notch_label_active"):$(".notch_label").removeClass("notch_label_active")),"MAX_MERCH"==g_prev_undo_action&&(g_show_max_merch=g_undo_details[0].g_show_max_merch,add_merch(g_show_max_merch,_),"Y"==g_show_max_merch?(g_show_max_merch="N",$(".fixel_merch").addClass("max_merch_active")):(g_show_max_merch="N",$(".fixel_merch").removeClass("max_merch_active"))),g_prev_undo_action="",g_undo_details=[],g_undo_obj_arr=[],g_cut_copy_arr=[],g_cut_support_obj_arr=[],g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_keyCode=0,render(_),"Y"==g_compare_pog_flag&&"POG"!==g_compare_view&&g_ComViewIndex!==g_curr_canvas)await recreate_compare_views(g_compare_view,"N")}return logDebug("function : undo_actions_not_delete","E"),removeLoadingIndicator(regionloadWait),"SUCCESS"}catch(no){error_handling(no),removeLoadingIndicator(regionloadWait)}}function set_ig_item_color(e,o){logDebug("function : set_ig_item_color","S");var _="N",n=g_pog_json[o].ModuleInfo;$.each(n,(function(o,n){if("Y"==_)return!1;null!=n.ParentModule&&"undefined"!=n.ParentModule||$.each(n.ShelfInfo,(function(o,n){if("Y"==_)return!1;void 0!==n&&"NOTCH"!==n.ObjType&&"BASE"!==n.ObjType&&"DIVIDER"!==n.ObjType&&"TEXTBOX"!==n.ObjType&&$.each(n.ItemInfo,(function(o,n){if(n.Item==e.Item)return _="Y",!1}))}))})),logDebug("function : set_ig_item_color","E")}async function update_undo_details(e,o,_,n,t,g,a,l,s,i,d,r,f,I,c,p,u,m,h,S,x,O,M,j,D,b,v){logDebug("function : update_undo_details; ItemCode : "+e+"; ObjID : "+o+"; ModuleIndex : "+_+"; ShelfIndex : "+n+"; ItemIndex : "+t+"; ObjType : "+g+"; ModuleObjID : "+l+"; ShelfObjID : "+s+"; ItemID : "+i+"; ItemExists : "+d+"; XAxis : "+f+"; YAxis : "+I+"; ZAxis : "+c+"; undo_action : "+p+"; NewModIndex : "+h+"; NewShelfIndex : "+S+"; NewItemIndex : "+x+"; actionType : "+O+"; horiz_facing : "+M+"; vert_facing : "+j+"; depth_facing : "+D+"; fieldName : "+b,"S"),89==g_keyCode||90==g_keyCode||(g_redo_all_obj_arr=[],g_redo_final_obj_arr=[],O="U",g_undoRedoAction="REDO");try{backupPog("F",-1,-1,v);var E={},C="N";return g_undo_details=[],g_cut_copy_arr=[],g_cut_support_obj_arr=[],g_redo_all_obj_arr=[],g_undo_all_obj_arr=[],undo_action_pre=p,"ITEM_DELETE"==undo_action_pre&&""==u||("SHELF_DELETE"==undo_action_pre||"CREATE_SHELF"==undo_action_pre?g_cut_copy_arr.push(JSON.parse(JSON.stringify(g_pog_json[v].ModuleInfo[_].ShelfInfo[n]))):"MODULE_DELETE"!=undo_action_pre&&"MODULE_CREATE"!=undo_action_pre||g_cut_copy_arr.push(JSON.parse(JSON.stringify(g_pog_json[v].ModuleInfo[_])))),"DIVIDER"==e&&(C="Y"),E.ObjID=o,E.MIndex=_,E.SIndex=n,E.IIndex=t,E.ObjType=g,E.IsDivider=C,E.Object=a,E.MObjID=l,E.SObjID=s,E.ItemID=i,E.Exists=d,E.OldSpreadProduct=r,E.XAxis=f,E.YAxis=I,E.ZAxis=c,E.NewModIndex=h,E.NewShelfIndex=S,E.NewItemIndex=x,E.Item=e,E.ShelfObjType=g_shelf_object_type,E.horiz_facing=M,E.vert_facing=j,E.depth_facing=D,E.fieldName=b,E.p_pog_index=v,"U"==O?(g_undo_details.push(E),g_undo_all_obj_arr.push(g_undo_details),g_undo_all_obj_arr.push(g_cut_copy_arr),""!==u&&(g_cut_copy_arr.push(JSON.parse(JSON.stringify(u))),g_undo_all_obj_arr.push(g_undo_obj_arr)),""!==m&&(g_undo_supp_obj_arr.push(m),g_undo_all_obj_arr.push(g_undo_supp_obj_arr)),g_undo_all_obj_arr.hasSupportArr=""!==m?"Y":"N",g_undo_all_obj_arr.previousAction=undo_action_pre,g_undo_all_obj_arr.g_MultiObjects="N",g_undo_final_obj_arr.push(g_undo_all_obj_arr),g_undo_all_obj_arr=[],g_undo_details=[],g_cut_copy_arr=[]):"R"==O&&(g_undo_all_obj_arr.hasSupportArr=""!==m?"Y":"N",g_undo_details.push(E),g_redo_all_obj_arr.push(g_undo_details),g_redo_all_obj_arr.push(g_cut_copy_arr),""!==u&&(g_cut_copy_arr.push(JSON.parse(JSON.stringify(u))),g_redo_all_obj_arr.push(g_undo_obj_arr)),""!==m&&(g_redo_supp_obj_arr.push(m),g_redo_all_obj_arr.push(g_redo_supp_obj_arr)),g_redo_all_obj_arr.previousAction=p,g_redo_all_obj_arr.g_MultiObjects="N",g_redo_final_obj_arr.push(g_redo_all_obj_arr),g_redo_all_obj_arr=[],g_undo_details=[],g_cut_copy_arr=[]),logDebug("function : update_undo_details","E"),"SUCCESS"}catch(e){error_handling(e)}}async function export_temp(){logDebug("function : export_temp","S");try{if("undefined"!=typeof g_pog_json&&g_pog_json.length>0&&void 0!==g_pog_json[g_pog_index]){await set_shelf_item_index(g_pog_index),await save_pog_to_json([g_pog_json[g_pog_index]]),sessionStorage.setItem("export_index",g_pog_index);var e="f?p="+$v("pFlowId")+":"+$v("pFlowStepId")+":"+$v("pInstance")+":APPLICATION_PROCESS=EXPORT_TEMP:NO::AI_RANDOM_STRING,AI_POG_CODE,AI_POG_VERSION:"+(new Date).getTime()+","+g_pog_json[g_pog_index].POGCode+","+g_pog_json[g_pog_index].Version;const o=document.createElement("a");o.href=e,o.download=get_message("POGCR_HEAD_TEMP_NAME")+".xlsx",document.body.appendChild(o),o.click(),document.body.removeChild(o)}logDebug("function : export_temp","E")}catch(e){error_handling(e),removeLoadingIndicator(regionloadWait)}}function import_temp(){logDebug("function : import_temp","S"),async function(){try{var e=sessionStorage.getItem("export_index");null==e&&g_pog_json.length>1?alert(get_message("POGCR_IMP_ALERT")):null!==e&&g_pog_json.length>1?(await set_shelf_item_index(e),await save_pog_to_json([g_pog_json[e]])):(await set_shelf_item_index(g_pog_index),await save_pog_to_json(g_pog_json))}catch(e){error_handling(e)}}(),$("[name =P25_IMPORT_TEMPLATE]").click(),logDebug("function : import_temp","E")}function set_item_details(e,o,_,n,t,g){logDebug("function : set_item_details; p_module_index : "+o+"; p_shelf_index : "+_+"; i_item_index : "+n+"; item_x : "+t+"; item_y : "+g,"S");var a={};if(a.ItemID=e.Item,a.Item=e.Item,a.CType=g_pog_json[g_pog_index].ModuleInfo[o].ShelfInfo[_].ObjType,a.W=e.W,a.H=e.H,a.D=e.D,a.Color=$v("P25_POG_ITEM_DEFAULT_COLOR"),a.DimT="U",a.Desc=e.Desc,a.Barcode=e.Barcode,a.LocID="",a.PegID="",a.PegSpread="",a.PegPerFacing="",a.Fixed="N",a.CapStyle="0",a.CapMaxH=0,a.MaxHCapStyle="3",a.Rotation=0,a.BHoriz=1,a.BVert=1,a.BaseD=1,a.CrushHoriz=0,a.CrushVert=0,a.CrushD=0,a.Orientation=e.Orientation,a.MerchStyle="0",a.Supplier=e.Supplier,"undefined"!==e.Supplier&&""!==e.Supplier){var l=e.Supplier.split("-");a.SupplierName=l[1]}else a.SupplierName="";a.Brand=e.Brand,a.Group=e.Group,a.Dept=e.Dept;var s=e.Dept.split("-"),i=e.Class.split("-"),d=e.SubClass.split("-");a.Class=e.Class,a.ClassName=s[0]+"/"+i[0]+"/"+d[0],a.SubClass=e.SubClass,a.StdUOM=e.StdUOM,a.SizeDesc=e.SizeDesc,a.Price=e.Price,a.Cost=e.Cost,a.RegMovement=e.RegMovement,a.MoveBasis=e.MoveBasis,a.Exists="N",a.CHPerc=e.OrgCHPerc,a.CWPerc=e.OrgCWPerc,a.CDPerc=e.OrgCDPerc,a.CnW=e.OrgCnW,a.CnH=e.OrgCnH,a.CnD=e.OrgCnD,a.NW=e.OrgNW,a.NH=e.OrgNH,a.ND=e.OrgND,a.OldCnW=e.OrgCnW,a.OldCnH=e.OrgCnH,a.OldCnD=e.OrgCnD,a.OldNW=e.OrgNW,a.OldNH=e.OrgNH,a.OldND=e.OrgND,a.TopObjID=e.TopObjID,a.BottomObjID=e.BottomObjID,a.SecondTier=e.SecondTier,a.SellingPrice=e.SellingPrice,a.SalesUnit=e.SalesUnit,a.NetSales=e.NetSales,a.CogsAdj=e.CogsAdj,a.WeeksCount=e.WeeksCount,a.MovingItem=e.MovingItem,a.GrossProfit=e.GrossProfit,a.Profit=e.Profit,a.TotalMargin=e.TotalMargin,a.MHorizFacings=parseInt(e.MHorizFacings),a.MVertFacings=parseInt(e.MVertFacings),a.MDepthFacings=parseInt(e.MDepthFacings),a.NewYN=e.NewYN,a.Delist=e.Delist,a.DescSecond=e.DescSecond,a.Status=e.Status,a.DaysOfSupply=e.DaysOfSupply,a.OrientationDesc=e.OrientationDesc,a.StoreCnt=e.StoreCnt,a.OverhungItem=e.OverhungItem,a.OrgUW=e.OrgUW,a.OrgUH=e.OrgUH,a.OrgUD=e.OrgUD,a.OrgCW=e.OrgCW,a.OrgCH=e.OrgCH,a.OrgCD=e.OrgCD,a.OrgTW=e.OrgTW,a.OrgTH=e.OrgTH,a.OrgTD=e.OrgTD,a.OrgDW=e.OrgDW,a.OrgDH=e.OrgDH,a.OrgDD=e.OrgDD,a.OrgCHPerc=e.OrgCHPerc,a.OrgCWPerc=e.OrgCWPerc,a.OrgCDPerc=e.OrgCDPerc,a.OrgCnW=e.OrgCnW,a.OrgCnH=e.OrgCnH,a.OrgCnD=e.OrgCnD,a.OrgNW=e.OrgNW,a.OrgNH=e.OrgNH,a.OrgND=e.OrgND,a.ItemNesting="",a.NVal=0,a.ItemContain="",a.CnVal=0,a.IsContainer="N",a.BsktFactor=0,a.OverHang=0,a.HorizGap=0,a.VertGap=0,a.UW=e.OrgUW,a.UH=e.OrgUH,a.UD=e.OrgUD,a.CW=e.OrgCW,a.CH=e.OrgCH,a.CD=e.OrgCD,a.TW=e.OrgTW,a.TH=e.OrgTH,a.TD=e.OrgTD,a.DW=e.OrgDW,a.DH=e.OrgDH,a.DD=e.OrgDD,a.SIndex=_,a.Dragged="N",a.Quantity=1,a.Y=g,a.X=t,a.SlotDivider="",a.ObjID="",a.ImgExists=e.ImgExists,a.CapCount=0,a.OW=e.OrgUW,a.OH=e.OrgUH,a.OD=e.OrgUD,a.SpreadItem=e.SpreadItem,a.MHorizCrushed="N",a.MVertCrushed="N",a.MDepthCrushed="N",a.RW=e.W,a.RH=e.H,a.RD=e.D,a.PW=e.W,a.PH=e.H,a.PD=e.D,a.LObjID=-1,a.SubLblObjID=-1,a.DimUpdate="N",a.NewItem=e.NewItem,a.FacingFormula=e.FacingFormula;var r=e.SizeDesc.split("*");return a.ImgExists=e.ImgExists,a.Exists="E",a.DimUpdate="N",a.ItemImage=e.ItemImage,a.Edited="Y",a.OldObjID=e.ObjID,a.NewPegId="",a.DFacing=e.BaseD,a.UnitperCase=e.UnitperCase,a.UnitperTray=e.UnitperTray,a.DfacingUpd="N",a.TotalUnitsCalc=e.BHoriz*e.BVert*e.BaseD,a.PkSiz=r[0],a.Cpct=e.BHoriz*e.BVert*e.BaseD,a.ItmDescChi=e.ItmDescChi,a.ItmDescEng=e.Brand+" "+e.Desc+" "+e.SizeDesc,a.Brand_Category=void 0!==e.Brand_Category?e.Brand_Category:"",a.Uda_item_status=void 0!==e.Uda_item_status?e.Uda_item_status:"",a.Gobecobrand=void 0!==e.Gobecobrand?e.Gobecobrand:"",a.Internet=void 0!==e.Internet?e.Internet:"",a.Categ=void 0!==e.Categ?e.Categ:"",a.COO=void 0!==e.COO?e.COO:"",a.ItmeSize=void 0!==e.ItmeSize?e.ItmeSize:"",a.SplrLbl=void 0!==e.SplrLbl?e.SplrLbl:"",a.EDLP=void 0!==e.EDLP?e.EDLP:"",a.LoGrp=void 0!==e.LoGrp?e.LoGrp:"",a.SqzPer=(void 0!==e.CrushHoriz?e.CrushHoriz:0)+":"+(void 0!==e.CrushVert?e.CrushVert:0)+":"+(void 0!==e.CrushD?e.CrushD:0),a.InternationalRng=void 0!==e.InternationalRng?e.InternationalRng:"",a.ActualDPP=void 0!==e.ActualDPP?e.ActualDPP:"",a.DPPLoc=e.DPPLoc,a.StoreSOH=void 0!==e.StoreSOH?e.StoreSOH:"",a.StoreNo=void 0!==e.StoreNo?e.StoreNo:"",a.WeeksOfInventory=void 0!==e.WeeksOfInventory?e.WeeksOfInventory:"",a.NewItem=void 0!==e.NewItem?e.NewItem:"",a.CapDepthChanged=e.CapDepthChanged,a.LiveNewItem=void 0!==e.LiveNewItem?e.LiveNewItem:"",a.MassCrushH=void 0!==e.MassCrushH&&null!==e.MassCrushH?e.MassCrushH:"",a.MassCrushV=void 0!==e.MassCrushV&&null!==e.MassCrushV?e.MassCrushV:"",a.MassCrushD=void 0!==e.MassCrushD&&null!==e.MassCrushD?e.MassCrushD:"",a.UDA751=void 0!==e.UDA751?e.UDA751:"",a.UDA755=void 0!==e.UDA755?e.UDA755:"",a.MPogDepthFacings=void 0!==e.MPogDepthFacings?e.MPogDepthFacings:"",a.MPogHorizFacings=void 0!==e.MPogHorizFacings?e.MPogHorizFacings:"",a.MPogVertFacings=void 0!==e.MPogVertFacings?e.MPogVertFacings:"",a.ItemCondition=e.ItemCondition,a.AUR=e.AUR,a.ItemRanking=e.ItemRanking,a.WeeklySales=e.WeeklySales,a.WeeklyNetMargin=e.WeeklyNetMargin,a.WeeklyQty=e.WeeklyQty,a.NetMarginPercent=e.NetMarginPercent,a.CumulativeNM=e.CumulativeNM,a.TOP80B2=e.TOP80B2,a.ItemBrandC=e.ItemBrandC,a.ItemPOGDept=e.ItemPOGDept,a.ItemRemark=e.ItemRemark,a.RTVStatus=e.RTVStatus,a.Pusher=e.Pusher,a.Divider=e.Divider,a.BackSupport=e.BackSupport,a.ShelfPrice=e.ShelfPrice,a.PromoPrice=e.PromoPrice,a.DiscountRate=e.DiscountRate,a.PriceChangeDate=e.PriceChangeDate,a.WeeksOfInventory=e.WeeksOfInventory,a.QTY=e.QTY,a.WhStock=e.WhStock,a.StoreStock=e.StoreStock,a.StockIntransit=e.StockIntransit,a.OOSPerc=e.OOSPerc,a.InitialItemDesc=e.InitialItemDesc,a.InitialBrand=e.InitialBrand,a.InitialBarcode=e.InitialBarcode,g_pog_json[g_pog_index].ModuleInfo[o].ShelfInfo[_].ItemInfo.push(a),logDebug("function : set_item_details","E"),g_pog_json[g_pog_index].ModuleInfo[o].ShelfInfo[_].ItemInfo.length-1}function get_item_object(e,o,_,n,t,g){logDebug("function : set_item_details; p_module_index : "+o+"; p_shelf_index : "+_+"; i_item_index : "+n+"; item_x : "+t+"; item_y : "+g,"S");var a={};if(a.ItemID=e.Item,a.Item=e.Item,a.CType=g_pog_json[0].ModuleInfo[o].ShelfInfo[_].ObjType,a.W=e.W,a.H=e.H,a.D=e.D,a.Color=$v("P25_POG_ITEM_DEFAULT_COLOR"),a.DimT="U",a.Desc=e.Desc,a.Barcode=e.Barcode,a.LocID="",a.PegID="",a.PegSpread="",a.PegPerFacing="",a.Fixed="N",a.CapStyle="0",a.CapMaxH=0,a.MaxHCapStyle="3",a.Rotation=0,a.BHoriz=1,a.BVert=1,a.BaseD=1,a.CrushHoriz=0,a.CrushVert=0,a.CrushD=0,a.Orientation=e.Orientation,a.MerchStyle="0",a.Supplier=e.Supplier,"undefined"!==e.Supplier&&""!==e.Supplier){var l=e.Supplier.split("-");a.SupplierName=l[1]}else a.SupplierName="";a.Brand=e.Brand,a.Group=e.Group,a.Dept=e.Dept;var s=e.Dept.split("-"),i=e.Class.split("-"),d=e.SubClass.split("-");a.Class=e.Class,a.ClassName=s[0]+"/"+i[0]+"/"+d[0],a.SubClass=e.SubClass,a.StdUOM=e.StdUOM,a.SizeDesc=e.SizeDesc,a.Price=e.Price,a.Cost=e.Cost,a.RegMovement=e.RegMovement,a.MoveBasis=e.MoveBasis,a.Exists="N",a.CHPerc=e.OrgCHPerc,a.CWPerc=e.OrgCWPerc,a.CDPerc=e.OrgCDPerc,a.CnW=e.OrgCnW,a.CnH=e.OrgCnH,a.CnD=e.OrgCnD,a.NW=e.OrgNW,a.NH=e.OrgNH,a.ND=e.OrgND,a.OldCnW=e.OrgCnW,a.OldCnH=e.OrgCnH,a.OldCnD=e.OrgCnD,a.OldNW=e.OrgNW,a.OldNH=e.OrgNH,a.OldND=e.OrgND,a.TopObjID=e.TopObjID,a.BottomObjID=e.BottomObjID,a.SecondTier=e.SecondTier,a.SellingPrice=e.SellingPrice,a.SalesUnit=e.SalesUnit,a.NetSales=e.NetSales,a.CogsAdj=e.CogsAdj,a.WeeksCount=e.WeeksCount,a.MovingItem=e.MovingItem,a.GrossProfit=e.GrossProfit,a.Profit=e.Profit,a.TotalMargin=e.TotalMargin,a.MHorizFacings=parseInt(e.MHorizFacings),a.MVertFacings=parseInt(e.MVertFacings),a.MDepthFacings=parseInt(e.MDepthFacings),a.NewYN=e.NewYN,a.Delist=e.Delist,a.DescSecond=e.DescSecond,a.Status=e.Status,a.DaysOfSupply=e.DaysOfSupply,a.OrientationDesc=e.OrientationDesc,a.StoreCnt=e.StoreCnt,a.OverhungItem=e.OverhungItem,a.OrgUW=e.OrgUW,a.OrgUH=e.OrgUH,a.OrgUD=e.OrgUD,a.OrgCW=e.OrgCW,a.OrgCH=e.OrgCH,a.OrgCD=e.OrgCD,a.OrgTW=e.OrgTW,a.OrgTH=e.OrgTH,a.OrgTD=e.OrgTD,a.OrgDW=e.OrgDW,a.OrgDH=e.OrgDH,a.OrgDD=e.OrgDD,a.OrgCHPerc=e.OrgCHPerc,a.OrgCWPerc=e.OrgCWPerc,a.OrgCDPerc=e.OrgCDPerc,a.OrgCnW=e.OrgCnW,a.OrgCnH=e.OrgCnH,a.OrgCnD=e.OrgCnD,a.OrgNW=e.OrgNW,a.OrgNH=e.OrgNH,a.OrgND=e.OrgND,a.ItemNesting="",a.NVal=0,a.ItemContain="",a.CnVal=0,a.IsContainer="N",a.BsktFactor=0,a.OverHang=0,a.HorizGap=0,a.VertGap=0,a.UW=e.OrgUW,a.UH=e.OrgUH,a.UD=e.OrgUD,a.CW=e.OrgCW,a.CH=e.OrgCH,a.CD=e.OrgCD,a.TW=e.OrgTW,a.TH=e.OrgTH,a.TD=e.OrgTD,a.DW=e.OrgDW,a.DH=e.OrgDH,a.DD=e.OrgDD,a.SIndex=_,a.Dragged="N",a.Quantity=1,a.Y=g,a.X=t,a.SlotDivider="",a.ObjID="",a.ImgExists=e.ImgExists,a.CapCount=0,a.OW=e.OrgUW,a.OH=e.OrgUH,a.OD=e.OrgUD,a.SpreadItem=0,a.MHorizCrushed="N",a.MVertCrushed="N",a.MDepthCrushed="N",a.RW=e.W,a.RH=e.H,a.RD=e.D,a.PW=e.W,a.PH=e.H,a.PD=e.D,a.LObjID=-1,a.SubLblObjID=-1,a.DimUpdate="N",a.NewItem=e.NewItem,a.FacingFormula=e.FacingFormula;var r=e.SizeDesc.split("*");return a.ImgExists=e.ImgExists,a.Exists="E",a.DimUpdate="N",a.ItemImage=e.ItemImage,a.Edited="Y",a.OldObjID=e.ObjID,a.NewPegId="",a.DFacing=e.BaseD,a.UnitperCase=e.UnitperCase,a.UnitperTray=e.UnitperTray,a.DfacingUpd="N",a.TotalUnitsCalc=e.BHoriz*e.BVert*e.BaseD,a.PkSiz=r[0],a.Cpct=e.BHoriz*e.BVert*e.BaseD,a.ItmDescChi=e.ItmDescChi,a.ItmDescEng=e.Brand+" "+e.Desc+" "+e.SizeDesc,a.Brand_Category=void 0!==e.Brand_Category?e.Brand_Category:"",a.Uda_item_status=void 0!==e.Uda_item_status?e.Uda_item_status:"",a.Gobecobrand=void 0!==e.Gobecobrand?e.Gobecobrand:"",a.Internet=void 0!==e.Internet?e.Internet:"",a.Categ=void 0!==e.Categ?e.Categ:"",a.COO=void 0!==e.COO?e.COO:"",a.ItmeSize=void 0!==e.ItmeSize?e.ItmeSize:"",a.SplrLbl=void 0!==e.SplrLbl?e.SplrLbl:"",a.EDLP=void 0!==e.EDLP?e.EDLP:"",a.LoGrp=void 0!==e.LoGrp?e.LoGrp:"",a.SqzPer=(void 0!==e.CrushHoriz?e.CrushHoriz:0)+":"+(void 0!==e.CrushVert?e.CrushVert:0)+":"+(void 0!==e.CrushD?e.CrushD:0),a.InternationalRng=void 0!==e.InternationalRng?e.InternationalRng:"",a.ActualDPP=void 0!==e.ActualDPP?e.ActualDPP:"",a.DPPLoc=e.DPPLoc,a.StoreSOH=void 0!==e.StoreSOH?e.StoreSOH:"",a.StoreNo=void 0!==e.StoreNo?e.StoreNo:"",a.WeeksOfInventory=void 0!==e.WeeksOfInventory?e.WeeksOfInventory:"",a.NewItem=void 0!==e.NewItem?e.NewItem:"",a.LiveNewItem=void 0!==e.LiveNewItem?e.LiveNewItem:"",a.CapDepthChanged=e.CapDepthChanged,a.MassCrushH=void 0!==e.MassCrushH&&null!==e.MassCrushH?e.MassCrushH:"",a.MassCrushV=void 0!==e.MassCrushV&&null!==e.MassCrushV?e.MassCrushV:"",a.MassCrushD=void 0!==e.MassCrushD&&null!==e.MassCrushD?e.MassCrushD:"",a.UDA751=void 0!==e.UDA751?e.UDA751:"",a.UDA755=void 0!==e.UDA755?e.UDA755:"",a.MPogDepthFacings=void 0!==e.MPogDepthFacings?e.MPogDepthFacings:"",a.MPogHorizFacings=void 0!==e.MPogHorizFacings?e.MPogHorizFacings:"",a.MPogVertFacings=void 0!==e.MPogVertFacings?e.MPogVertFacings:"",a.ItemCondition=e.ItemCondition,a.AUR=e.AUR,a.ItemRanking=e.ItemRanking,a.WeeklySales=e.WeeklySales,a.WeeklyNetMargin=e.WeeklyNetMargin,a.WeeklyQty=e.WeeklyQty,a.NetMarginPercent=e.NetMarginPercent,a.CumulativeNM=e.CumulativeNM,a.TOP80B2=e.TOP80B2,a.ItemBrandC=e.ItemBrandC,a.ItemPOGDept=e.ItemPOGDept,a.ItemRemark=e.ItemRemark,a.RTVStatus=e.RTVStatus,a.Pusher=e.Pusher,a.Divider=e.Divider,a.BackSupport=e.BackSupport,a.ShelfPrice=e.ShelfPrice,a.PromoPrice=e.PromoPrice,a.DiscountRate=e.DiscountRate,a.PriceChangeDate=e.PriceChangeDate,a.WeeksOfInventory=e.WeeksOfInventory,a.QTY=e.QTY,a.WhStock=e.WhStock,a.StoreStock=e.StoreStock,a.StockIntransit=e.StockIntransit,a.OOSPerc=e.OOSPerc,a.InitialItemDesc=e.InitialItemDesc,a.InitialBrand=e.InitialBrand,a.InitialBarcode=e.InitialBarcode,logDebug("function : set_item_details","E"),a}function carpark_shelf(e,o,_,n,t,g,a){logDebug("function : carpark_shelf; module_name : "+e+"; width : "+o+"; height : "+_+"; depth : "+n+"; shelfx : "+t+"; shelfy : "+g+"; p_module_index : "+a,"S");var l={};return l.Shelf="CARPARK_"+e,l.ObjType="SHELF",l.Desc="",l.MaxMerch=0,l.GrillH=0,l.LOverhang=0,l.ROverhang=0,l.SpacerThick=0,l.HorizGap=0,l.SpreadItem="L",l.Combine="N",l.AllowAutoCrush="N",l.H=_,l.W=o,l.D=n,l.Rotation=0,l.Slope=0,l.Color=$v("P25_POG_SHELF_DEFAULT_COLOR"),l.LiveImage="",l.HorizSlotStart=0,l.HorizSlotSpacing=0,l.HorizStart=0,l.HorizSpacing=0,l.UOverHang=0,l.LoOverHang=0,l.VertiStart=0,l.VertiSpacing=0,l.X=t,l.Y=g,l.Z=0,l.InputText="",l.WrapText="",l.ReduceToFit="",l.TextDirection="",l.BsktFill="",l.BsktSpreadProduct="",l.SnapTo="",l.BsktWallH=0,l.BsktBaseH=0,l.BsktWallThickness=0,l.DSlotStart=0,l.DSlotSpacing=0,l.DGap=0,l.FrontOverHang=0,l.BackOverHang=0,l.SlotDivider="",l.AutoPlacing=$v("P25_POGCR_PEGB_MAX_ARRANGE"),l.AutoFillPeg="N",l.SlotOrientation="",l.DividerFixed="N",l.LObjID=-1,l.NotchLabelObjID=-1,l.FStyle="",l.FSize="",l.FBold="",l.TextImg="",l.TextImgName="",l.TextImgMime="",l.ItemInfo=[],l.Overhung="N",g_pog_json[g_pog_index].ModuleInfo[a].Carpark.push(l),logDebug("function : carpark_shelf","E"),"SUCCESS"}async function comparePOG(e,o,_,n,t,g="N"){logDebug("function : comparePOG","S"),await get_compare_pog(e,o,_,n,t,g),logDebug("function : comparePOG","E")}async function item_upld_create(e,o){logDebug("function : item_upld_create","S");try{return new Promise((function(_,n){if(e.length>0){var t=0,g=[],a=[],l=[];$(".live_image").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".open_pdf").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".open_pdf_online").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto");var s=[];$.each(g_pog_json[o].ModuleInfo,(function(_,n){void 0!==n.ParentModule&&null!=n.ParentModule||$.each(n.ShelfInfo,(function(t,g){"BASE"!==g.ObjType&&"NOTCH"!==g.ObjType&&"DIVIDER"!==g.ObjType&&"TEXTBOX"!==g.ObjType&&$.each(g.ItemInfo,(function(l,i){var d="Y";"DIVIDER"==i.Item&&(g_pog_json[o].ModuleInfo[_].ShelfInfo[t].ItemInfo[l].MIndex=_,g_pog_json[o].ModuleInfo[_].ShelfInfo[t].ItemInfo[l].SIndex=t,g_pog_json[o].ModuleInfo[_].ShelfInfo[t].ItemInfo[l].IIndex=l,g_pog_json[o].ModuleInfo[_].ShelfInfo[t].ItemInfo[l].RemovedItem="N",g_pog_json[o].ModuleInfo[_].ShelfInfo[t].ItemInfo[l].Module=n.Module,g_pog_json[o].ModuleInfo[_].ShelfInfo[t].ItemInfo[l].Shelf=g.Shelf,i.Added="N",a.push(i));for(const o of e)s.push(i.Item),o.Item==i.Item&&(d="N");if("Y"==d){!async function(){g_deletedItems.push(i.Item),void 0!==g_pog_json[o].DeleteItems&&g_pog_json[o].DeleteItems.push(i)}()}}))}))}));deleted_items_log(g_deletedItems,"D",o);t=0;for(const _ of e){if(void 0!==g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[_.IIndex])if(g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[_.IIndex].Item==_.Item)if("N"==_.RemovedItem){if(g.push(JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[_.IIndex]))),g[g.length-1].Module=JSON.parse(JSON.stringify(_.Module)),g[g.length-1].Shelf=JSON.parse(JSON.stringify(_.Shelf)),e[t].NewItem="N",e[t].ObjID=g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[_.IIndex].ObjID,e[t].RemovedItem="N",g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[_.IIndex].BHoriz>1){var i=g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[_.IIndex].BHoriz-1,d=0,r=-1;for(const o of e)o.Item==_.Item&&d>t&&i>0&&_.MIndex==o.MIndex&&_.SIndex==o.SIndex&&(i-=1,e[d].RemovedItem="Y",e[d].IIndex=_.IIndex,r=d),d+=1;d=0;var f=_.IIndex;I=-1;for(const o of e){if(d>r&&_.MIndex==o.MIndex&&_.SIndex==o.SIndex){var I=_.IIndex==f?_.IIndex+1:I+1;f=I,e[d].IIndex=I}d+=1}}}else e[t].NewItem="N";else e[t].NewItem="Y",e[t].RemovedItem="N";else e[t].NewItem="Y",e[t].RemovedItem="N";t+=1}t=0;for(const o of e){if("Y"==o.NewItem){var[c,p]=get_item_exists_orientation(o.Item,0);o.Orientation=c,o.OrientationDesc=p}t++}$.each(g_pog_json[o].ModuleInfo,(function(e,_){if(void 0===_.ParentModule||null==_.ParentModule){for(const e of _.Carpark){var n=g_scene_objects[o].scene.children[2].getObjectById(e.SObjID);g_scene_objects[o].scene.children[2].remove(n);for(const _ of e.ItemInfo){n=g_scene_objects[o].scene.children[2].getObjectById(_.ObjID);g_scene_objects[o].scene.children[2].remove(n)}}g_pog_json[o].ModuleInfo[e].Carpark=[],$.each(_.ShelfInfo,(function(_,n){"BASE"!==n.ObjType&&"NOTCH"!==n.ObjType&&"DIVIDER"!==n.ObjType&&"TEXTBOX"!==n.ObjType&&(g_pog_json[o].ModuleInfo[e].ShelfInfo[_].ItemInfo=[])}))}}));var u=0,m=0,h=[],S=0;$.each(g_pog_json[o].ModuleInfo,(function(_,n){void 0!==n.ParentModule&&null!=n.ParentModule||$.each(n.ShelfInfo,(function(n,t){if(u=0,m=0,S=0,"DIVIDER"!==t.ObjType){for(const _ of e)void 0!==g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex]&&(h.push(_),_.BHoriz>1&&"F"==L?u+=_.W+R*(_.BHoriz-1):u+=_.W,"E"==L?m+=1:void 0!==_.BHoriz&&""!==_.BHoriz?m+=_.BHoriz:m+=0);for(const e of a)_==e.MIndex&&n==e.SIndex&&(h.push(e),e.BHoriz>1&&"F"==L?u+=e.W+R*(e.BHoriz-1):u+=e.W,"E"==L?m+=1:void 0!==e.BHoriz&&""!==e.BHoriz?m+=e.BHoriz:m+=0);S=m>0?(t.W-u)/(m-1)<0?0:(t.W-u)/(m-1):t.W-u<0?0:t.W-u,$.each(h,(function(e,o){o.SpreadItem=S}))}}))}));t=0;var x="",O=-1,M=-1,j=.02,D=.4;for(const _ of e){if("N"==_.RemovedItem){if(x!==_.Shelf&&""!==x){update_item_distance(O,M,o);reorder_items(O,M,o)}x=_.Shelf;var b=_.ObjType;if((A={}).X=_.X,A.Y=_.Y,A.W=g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].W,A.H=g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].H,A.ObjType=b,A.peg_vert_values=g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].peg_vert_values,"N"==_.NewItem){for(const e of g)if(_.ObjID==e.ObjID){g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo.push(e);var v=g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo.length-1;break}}else{var[E,C,P,N,T,y]=get_new_orientation_dim(_.Orientation,_.W,_.H,_.D);_.W=E,_.H=C,_.D=P;v=set_item_details(_,_.MIndex,_.SIndex,-1,"","")}var Y=g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[v],R=g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].HorizGap,L=g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].SpreadItem,H=R,F=g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo.length,w=-1;if("PEGBOARD"==b&&"Y"==_.NewItem&&(g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[v].Y=g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].Y+g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].H/2-g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].VertiStart-_.H/2,g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[v].FromProductList="Y",g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[v].Edited="N"),"PEGBOARD"==b&&"Y"==_.NewItem){var A=g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex];if(0==v){var G=A.X-A.W/2-A.LOverhang+A.HorizSpacing;g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[v].X=G+Y.W/2}else g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[v].X=A.ItemInfo[v-1].X+A.ItemInfo[v-1].W/2+Y.W/2+A.HorizSpacing;var[B,w]=get_item_xy(A,Y,Y.W,Y.H,o);g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[v].Y=w}else{A=g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex];var[B,w]=get_item_xy(A,Y,Y.W,Y.H,o);"Y"!=_.NewItem&&(void 0!==Y.BottomObjID&&""!=Y.BottomObjID||void 0!==Y.TopObjID&&""!=Y.TopObjID)||(g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[v].Y=w);var V=(z=get_item_xaxis(Y.W,Y.H,Y.D,b,-1,H,L,R,_.MIndex,_.SIndex,v,"Y",F,"N",o))-Y.W/2,W=z+Y.W/2;if(g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[v].X=z,v>0)var X=g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[v-1].X+g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[v-1].W/2;console.log("before div",g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].Shelf,g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[v].Item,"prev_end",X,"new start ",z-_.W/2);for(const e of a){var U=e.X-e.W/2,k=e.X+e.W/2;if(v>0)V=(z=get_item_xaxis(Y.W,Y.H,Y.D,b,-1,H,L,R,_.MIndex,_.SIndex,v,"Y",F,"N",o))-Y.W/2,W=z+Y.W/2;if(U<W&&k>V&&_.MIndex==e.MIndex&&_.SIndex==e.SIndex&&"N"==e.Added){e.Added="Y",g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo.splice(v,0,e),v+=1;var z=get_item_xaxis(Y.W,Y.H,Y.D,b,-1,H,L,R,_.MIndex,_.SIndex,v,"Y",F,"N",o);if(g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[v].X=z,v>0)X=g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[v-1].X+g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[v-1].W/2}}}var J=0;""!==Y.ItemNesting&&("W"==Y.ItemNesting?J=Y.OrgNW:"H"==Y.ItemNesting?J=Y.OrgNH:"D"==Y.ItemNesting&&(J=Y.OrgND));var[Z,q,K]=get_select_dim(Y);const[n,s,i,d,r,f]=set_dim_validate_item(_.MIndex,_.SIndex,v,Z,q,K,Y.ItemNesting,J,Y.BHoriz,Y.BVert,Y.BaseD,Y.Orientation,Y.OrgCWPerc,Y.OrgCHPerc,Y.OrgCDPerc,"N","Y","N",o);if("ERROR"!==n){update_item_org_dim(_.MIndex,_.SIndex,v,n,s,i,d,r,f,o);A=g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex];var Q=g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[v],[B,w]=get_item_xy(A,Q,Q.W,Q.H,o);void 0!==Q.BottomObjID&&""!=Q.BottomObjID||void 0!==Q.TopObjID&&""!=Q.TopObjID||(g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[v].Y=w),e[t].Valid="Y"}else{var ee=g_pog_json[o].ModuleInfo[_.MIndex].W,oe=0,_e="Y";if(g_carpark_items.length>0){for(const e of g_carpark_items)e.MIndex==_.MIndex&&(oe+=e.W);_e=oe+g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[v].W<=ee?"Y":"N"}if("Y"==_e)(Y=JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[v]))).MIndex=_.MIndex,Y.SIndex=_.SIndex,g_carpark_items.push(Y),(ne={}).Module=_.Module,ne.Shelf=_.Shelf,ne.Item=_.Item,ne.Carpark="Y",ne.UpldID=$v("P25_UPLD_ID"),l.push(ne);else(ne={}).Module=_.Module,ne.Shelf=_.Shelf,ne.Item=_.Item,ne.Carpark="N",ne.UpldID=$v("P25_UPLD_ID"),l.push(ne);0==v?g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo.splice(v,v+1):g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo.splice(v,1),e[t].Valid="N"}_.Module,O=_.MIndex,M=_.SIndex}t+=1}for(const e of a)"N"==e.Added&&(e.Added="Y",g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo.push(e));if(g_carpark_items.length>0){var ne,te=(ne=get_min_max_xy(o)).split("###"),ge=[],ae=-1;for(const e of g_carpark_items)j=Math.max(j,e.H),D=Math.max(D,e.D),ae!==parseInt($.trim(e.MIndex))&&ge.push(e.MIndex),ae=parseInt($.trim(e.MIndex));t=0;for(const e of ge){carpark_shelf(e+1,g_pog_json[o].ModuleInfo[e].W,.04,D+.1,g_pog_json[o].ModuleInfo[e].X,parseFloat(te[1])+.03,e,o);d=0;for(const _ of g_carpark_items){if(_.MIndex=void 0===_.MIndex?0:_.MIndex,e==_.MIndex){g_pog_json[o].ModuleInfo[e].Carpark[0].ItemInfo.push(_);var le=g_pog_json[o].ModuleInfo[e].Carpark[0].ItemInfo.length-1,se=newy=-1;newy=g_pog_json[o].ModuleInfo[e].Carpark[0].Y+g_pog_json[o].ModuleInfo[e].Carpark[0].H/2+_.H/2,se=0==le?g_pog_json[o].ModuleInfo[e].Carpark[0].X-g_pog_json[o].ModuleInfo[e].Carpark[0].W/2+_.W/2:g_pog_json[o].ModuleInfo[e].Carpark[0].ItemInfo[g_pog_json[o].ModuleInfo[e].Carpark[0].ItemInfo.length-2].X+g_pog_json[o].ModuleInfo[e].Carpark[0].ItemInfo[g_pog_json[o].ModuleInfo[e].Carpark[0].ItemInfo.length-2].W/2+_.W/2,g_pog_json[o].ModuleInfo[e].Carpark[0].ItemInfo[le].X=se,g_pog_json[o].ModuleInfo[e].Carpark[0].ItemInfo[le].Y=newy,g_pog_json[o].ModuleInfo[e].Carpark[0].ItemInfo[le].Z=.05}d+=1}t+=1}}$.each(g_pog_json[o].ModuleInfo,(function(e,_){void 0!==_.ParentModule&&null!=_.ParentModule||$.each(_.ShelfInfo,(function(n,t){if("BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&"TEXTBOX"!==t.ObjType&&(update_item_distance(e,n,o),reorder_items(e,n,o)&&"PEGBOARD"!==t.ObjType)){var g=t.ItemInfo;if(g.keySort({X:"asc"}),"R"!==t.SpreadItem)$.each(g,(function(_,g){var a=get_item_xaxis(g.W,g.H,g.D,t.ObjType,-1,t.HorizGap,t.SpreadItem,t.HorizGap,e,n,_,"Y",t.ItemInfo.length,"N",o),[l,s]=get_item_xy(t,g,g.W,g.H,o);g_pog_json[o].ModuleInfo[e].ShelfInfo[n].ItemInfo[_].X=a,_>0&&console.log(g_pog_json[o].ModuleInfo[e].ShelfInfo[n].Shelf,g_pog_json[o].ModuleInfo[e].ShelfInfo[n].ItemInfo[_].Item,"start ",a-g.W/2,"prev end",g_pog_json[o].ModuleInfo[e].ShelfInfo[n].ItemInfo[_-1].X+g_pog_json[o].ModuleInfo[e].ShelfInfo[n].ItemInfo[_-1].W/2),void 0!==g.BottomObjID&&""!=g.BottomObjID||(g_pog_json[o].ModuleInfo[e].ShelfInfo[n].ItemInfo[_].Y=s)}));else for(var a=g.length-1;a>=0;a--){var l=get_item_xaxis(g[a].W,g[a].H,g[a].D,t.ObjType,-1,t.HorizGap,t.SpreadItem,t.HorizGap,e,n,a,"Y",t.ItemInfo.length,"N",o),[s,i]=get_item_xy(t,g[a],g[a].W,g[a].H,o);void 0!==g.BottomObjID&&""!=g.BottomObjID||(g_pog_json[o].ModuleInfo[e].ShelfInfo[n].ItemInfo[a].Y=i),g_pog_json[o].ModuleInfo[e].ShelfInfo[n].ItemInfo[a].X=l}"PEGBOARD"!==t.ObjType&&"HANGINGBAR"!==t.ObjType&&"ROD"!==t.ObjType&&$.each(t.ItemInfo,(function(g,a){var l=get_shelf_max_merch(_,t,e,n,o,parseFloat($v("P25_POGCR_DFT_MAX_MERCH"))),s=0;if(s="Y"==a.NewItem?a.H:a.RH/a.BVert,!(void 0!==a.TopObjID&&""!=a.TopObjID||void 0!==a.BottomObjID&&""!=a.BottomObjID)){if("Y"==g_max_facing_enabled){var i=Math.floor(100*l/(100*s));i>(f=(r=nvl(a.MPogVertFacings)>0?a.MPogVertFacings:a.MVertFacings)>-1?r:$v("P25_POGCR_AUTO_MAX_VFACING"))&&(i=parseInt(f)),a.H=a.RH/a.BVert*(i>0?i:1),a.BVert=i>0?i:1,a.Y=t.Y+t.H/2+a.H/2,a.RH=a.H}else if("Y"==$v("P25_POGCR_AUTO_VERT_FACING")&&"N"==g_max_facing_enabled){var d=parseInt($v("P25_POGCR_DFLT_VERT_FACING"));if(d>0){var r,f=(r=nvl(a.MPogVertFacings)>0?a.MPogVertFacings:a.MVertFacings)<d&&r>-1?parseInt(r):d,I=a.RH/a.BVert*f;I<=l&&(a.H=I,a.BVert=f,a.Y=t.Y+t.H/2+a.H/2,a.RH=a.H)}}var c=Math.floor(100*t.D/(100*a.D)),p=nvl(a.MPogDepthFacings)>0?a.MPogDepthFacings:a.MDepthFacings;c=p<c&&p>-1?p:c,a.D=a.RD/a.BaseD*(c>0?c:1),c=Math.floor(100*t.D/(100*a.D)),a.BaseD=c>0?c:1,a.RD=a.D}}))}}))}));for(const e of a){t=0;for(const _ of g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo)e.ObjID==_.ObjID&&g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo.splice(t,1),t++}$(".open_pdf").css("color","black").css("cursor","pointer"),$(".open_pdf_online").css("color","black").css("cursor","pointer");var ie="",de="",re="";"Y"==$v("P25_UNQ_POG_MODULE_ITEM_LOC")?(ie=2,de=2):(ie=1,de="",re=1),location_numbering("LR","LRTB",ie,re,de,o),apex.server.process("UPDATE_UPLD_WARNING",{x01:$v("P25_UPLD_ID"),p_clob_01:JSON.stringify(l)},{dataType:"text",success:function(e){if(""!=$.trim(e))raise_error(e),logDebug("function : item_upld_create","E"),_("ERRORED");else{var n=get_min_max_xy(o).split("###");set_camera_z(g_scene_objects[o].scene.children[0],parseFloat(n[2]),parseFloat(n[3]),parseFloat(n[0]),parseFloat(n[1]),g_offset_z,parseFloat(n[4]),parseFloat(n[5]),!0,o),l.length>0||g_carpark_items.length>0?(_("FAIL"),apex.message.showPageSuccess(get_message("POGCR_ITEM_IMP_WARN"))):(logDebug("function : item_upld_create","E"),_("PASS"))}},loadingIndicatorPosition:"page"})}}))}catch(e){error_handling(e)}}function add_img_indexeddb(e){const o=indexedDB.open("myDatabase",2);o.onupgradeneeded=function(e){g_db=e.target.result;g_db.createObjectStore("myDatabaseStore",{keyPath:"Item"})},o.onsuccess=function(o){console.log("running onsuccess"),g_db=o.target.result,function(o){var _={Item:"ImageDetail"};_.ImgData=e;const n=o.transaction("myDatabaseStore","readwrite").objectStore("myDatabaseStore");console.log("before add to store  ",getDateTime()),n.delete("ImageDetail"),n.add(_)}(g_db)},o.onerror=function(e){console.dir(e)}}function get_img_indexeddb(){const e=g_db.transaction("myDatabaseStore");if(void 0!==e){const o=e.objectStore("myDatabaseStore").get("ImageDetail");g_ItemImages=o.result.ImgData}}function save_validate_items_coll(e){return logDebug("function : save_validate_items_coll","S"),new Promise((function(o,_){apex.server.process("ADD_VALIDATE_POG_JSON",{x01:"I",p_clob_01:JSON.stringify(e)},{dataType:"text",success:function(e){""!=$.trim(e)?raise_error(e):(logDebug("function : save_validate_items_coll","E"),o("SUCESS"))},loadingIndicatorPosition:"page"})}))}async function open_in_new_tab(e,o,_,n,t,g){logDebug("function : open_in_new_tab; pog_code : "+e+"; pog_version : "+o+"; draft_seq_id : "+_+"; draft_desc : "+n+"; draft_version : "+t+"; pog_list : "+g,"S");try{return console.log("open",g),new Promise((function(a,l){if(""!==e){apex.server.process("GET_EXISTING_POG",{x01:e,x02:o},{dataType:"html"}).done((function(o){var _=$.trim(o);if(_.match(/ERROR.*/))sessionStorage.removeItem("POGJSON"),window.open("f?p="+$v("pFlowId")+":25:"+$v("pInstance")+":APEX_CLONE_SESSION:NO::P25_OPEN_NEW_TAB,P25_PRODUCT_BTN_CLICK,P25_NEW_TAB_POG_CODE:Y,N,"+e),logDebug("function : open_in_new_tab","E"),a("SUCESS");else if(""!==_){g_pog_json=JSON.parse($.trim(o)),$(".live_image").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".open_pdf").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".open_pdf_online").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),sessionStorage.setItem("POGJSON",LZString.compress($.trim(o))),sessionStorage.setItem("POGExists","Y"),sessionStorage.setItem("new_pog_ind","N"),sessionStorage.setItem("pog_opened","E"),sessionStorage.setItem("pog_list",g);var n=$v("P25_POGCR_SHOW_DFLT_ITEM_LOC"),t=$v("P25_POGCR_DFT_ITEM_DESC"),l=$v("P25_POGCR_DFLT_LIVE_IMAGES"),s=$v("P25_POGCR_DFT_NOTCH_LABEL"),i=$v("P25_POGCR_DFT_FIXEL_LABEL"),d=$v("P25_POGCR_DFT_DAYS_OF_SUPPLY"),r=$v("P25_POGCR_DFT_OVERHUNG_LABEL");g_show_fixel_label=i,g_show_item_label=n,g_show_notch_label=s,g_show_max_merch="N",g_show_item_color="N",g_show_item_desc=t,g_show_live_image=l,g_show_days_of_supply=d,g_overhung_shelf_active=r,sessionStorage.setItem("g_show_fixel_label",g_show_fixel_label),sessionStorage.setItem("g_show_item_label",g_show_item_label),sessionStorage.setItem("g_show_notch_label",g_show_notch_label),sessionStorage.setItem("g_show_live_image",g_show_live_image),sessionStorage.setItem("g_show_max_merch",g_show_max_merch),sessionStorage.setItem("g_show_item_desc",g_show_item_desc),sessionStorage.setItem("g_show_fixel_space",g_show_fixel_space),sessionStorage.setItem("g_max_facing_enabled",g_max_facing_enabled),sessionStorage.setItem("g_show_item_color",g_show_item_color),sessionStorage.setItem("g_overhung_shelf_active",g_overhung_shelf_active),sessionStorage.setItem("g_ComViewIndex",g_ComViewIndex),sessionStorage.setItem("g_ComBaseIndex",g_ComBaseIndex),sessionStorage.setItem("g_compare_view",g_compare_view),sessionStorage.setItem("g_compare_pog_flag",g_compare_pog_flag),sessionStorage.setItem("gPogIndex",g_pog_index),sessionStorage.setItem("g_combinedShelfs",JSON.stringify(g_combinedShelfs)),sessionSetCombineDetails(),console.log("open 1",g),window.open("f?p="+$v("pFlowId")+":25:"+$v("pInstance")+":APEX_CLONE_SESSION:NO::P25_OPEN_NEW_TAB,P25_PRODUCT_BTN_CLICK,P25_NEW_TAB_POG_CODE:Y,N,"+e),logDebug("function : open_in_new_tab","E"),a("SUCESS")}}))}else{!async function(){var e=await get_draft_ind(_),o="Y",g="N";"Y"==e&&(g="E",o="N"),apex.server.process("GET_POG_JSON",{x01:_,x02:""},{dataType:"html"}).done((function(l){var s=$.trim(l);if(s.match(/ERROR.*/))window.open("f?p="+$v("pFlowId")+":25:"+$v("pInstance")+":APEX_CLONE_SESSION:NO::P25_OPEN_NEW_TAB,P25_PRODUCT_BTN_CLICK,P25_DRAFT_LIST,P25_POG_DESCRIPTION,P25_EXISTING_DRAFT_VER:Y,N,"+_+","+n+","+t),sessionStorage.removeItem("POGJSON"),a("SUCESS");else if(""!==s)if($(".live_image").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".open_pdf").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".open_pdf_online").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),g_pog_json=JSON.parse($.trim(l)),g_pog_json[0].DesignType="Y"==e?"F":"D","Y"==e){!async function(){await save_pog_to_json(g_pog_json),sessionStorage.setItem("POGJSON",LZString.compress($.trim(l))),sessionStorage.setItem("POGExists","Y"),sessionStorage.setItem("new_pog_ind",o),sessionStorage.setItem("pog_opened",g),sessionStorage.setItem("P25_EXISTING_DRAFT_VER",t),sessionStorage.setItem("g_show_fixel_label",g_show_fixel_label),sessionStorage.setItem("g_show_item_label",g_show_item_label),sessionStorage.setItem("g_show_notch_label",g_show_notch_label),sessionStorage.setItem("g_show_live_image",g_show_live_image),sessionStorage.setItem("g_show_max_merch",g_show_max_merch),sessionStorage.setItem("g_show_item_desc",g_show_item_desc),sessionStorage.setItem("g_show_fixel_space",g_show_fixel_space),sessionStorage.setItem("g_max_facing_enabled",g_max_facing_enabled),sessionStorage.setItem("g_show_item_color",g_show_item_color),sessionStorage.setItem("g_ComViewIndex",g_ComViewIndex),sessionStorage.setItem("g_ComBaseIndex",g_ComBaseIndex),sessionStorage.setItem("g_compare_view",g_compare_view),sessionStorage.setItem("g_compare_pog_flag",g_compare_pog_flag),window.open("f?p="+$v("pFlowId")+":25:"+$v("pInstance")+":APEX_CLONE_SESSION:NO::P25_OPEN_NEW_TAB,P25_PRODUCT_BTN_CLICK,P25_DRAFT_LIST,P25_POG_DESCRIPTION,P25_EXISTING_DRAFT_VER:Y,N,"+_+","+n+","+t),sessionStorage.removeItem("POGJSON"),logDebug("function : open_in_new_tab","E"),a("SUCESS")}()}else sessionStorage.setItem("POGJSON",LZString.compress($.trim(l))),$(".live_image").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".open_pdf").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".open_pdf_online").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),sessionStorage.setItem("POGExists","Y"),sessionStorage.setItem("new_pog_ind",o),sessionStorage.setItem("pog_opened",g),sessionStorage.setItem("P25_EXISTING_DRAFT_VER",t),sessionStorage.setItem("g_show_fixel_label",g_show_fixel_label),sessionStorage.setItem("g_show_item_label",g_show_item_label),sessionStorage.setItem("g_show_notch_label",g_show_notch_label),sessionStorage.setItem("g_show_live_image",g_show_live_image),sessionStorage.setItem("g_show_max_merch",g_show_max_merch),sessionStorage.setItem("g_show_item_desc",g_show_item_desc),sessionStorage.setItem("g_show_fixel_space",g_show_fixel_space),sessionStorage.setItem("g_max_facing_enabled",g_max_facing_enabled),sessionStorage.setItem("g_show_item_color",g_show_item_color),sessionStorage.setItem("g_ComViewIndex",g_ComViewIndex),sessionStorage.setItem("g_ComBaseIndex",g_ComBaseIndex),sessionStorage.setItem("g_compare_view",g_compare_view),sessionStorage.setItem("g_compare_pog_flag",g_compare_pog_flag),window.open("f?p="+$v("pFlowId")+":25:"+$v("pInstance")+":APEX_CLONE_SESSION:NO::P25_OPEN_NEW_TAB,P25_PRODUCT_BTN_CLICK,P25_DRAFT_LIST,P25_POG_DESCRIPTION,P25_EXISTING_DRAFT_VER:Y,N,"+_+","+n+","+t),sessionStorage.removeItem("POGJSON"),logDebug("function : open_in_new_tab","E"),a("SUCESS")}))}()}}))}catch(e){error_handling(e)}}function save_chunk_image(e,o,_){return logDebug("function : save_chunk_image; coll_name : "+_+"; random_val : "+e,"S"),new Promise((function(n,t){apex.server.process("SAVE_GET_IMAGE",{x01:"PUT",x02:e,x03:_,p_clob_01:o},{dataType:"html"}).done((function(e){""!=$.trim(e)?(logDebug("function : save_chunk_image","E"),n("ERROR")):(logDebug("function : save_chunk_image","E"),n("SUCESS"))})).fail((function(e,o,_){n("ERROR")}))}))}async function save_image_to_coll(e,o){logDebug("function : save_image_to_coll; coll_name : "+o,"S");var _=JSON.stringify(e);if(_.length>1e7){var n=chunkString(_,1e7),t=(Math.random()+1).toString(36);for(const e of n)await save_chunk_image(t,e,o);return logDebug("function : save_image_to_coll","E"),"SUCCESS"}t=(Math.random()+1).toString(36);apex.server.process("SAVE_GET_IMAGE",{x01:"PUT",x02:t,x03:o,p_clob_01:_},{dataType:"html"}).done((function(e){return""!=$.trim(e)?(logDebug("function : save_image_to_coll","E"),"ERROR"):(logDebug("function : save_image_to_coll","E"),"SUCESS")})).fail((function(e,o,_){return logDebug("function : save_image_to_coll","E"),"ERROR"}))}async function save_draft(e,o,_){logDebug("function : save_draft; pSaveType : "+e+"; description : "+o+"; draftVersion : "+_,"S");try{if("N"==g_show_live_image&&await clearHighlight(),pog_info={},pog_list=[],"Y"==g_all_pog_flag)var n=0;else n=g_pog_index;var t="N",g="",a="N";for(const i of g_pog_json){if(n!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex){var l=[];l.push(g_pog_json[n]);var s=(await get_min_max_xy(n)).split("###");if(l[0].Cal_Width=parseFloat(100*s[0]),l[0].Cal_height=parseFloat(100*s[1]),"Y"===$v("P25_POG_EFF_START_DATE_UPDATE")){let e=moment($v("P25_VDATE"),"YYYYMMDD");if(!moment(l[0].EffStartDate,"YYYYMMDD").isAfter(e)){let o=e.add(1,"day").format("YYYYMMDD");l[0].EffStartDate=o}}if(void 0!==l&&l.length>0)if(""==l[0].POGCode)t="Y",a="Y",g=l[0].POGCode+" - "+get_message("POG_CODE_NOT_NEEDED");else if("Y"==validate_pog_detail("N",n))t="Y",a="Y",g=g+"\n"+l[0].POGCode+" - "+get_message("ENTER_MADATORY_POG_DETAIL");else{[].push(g_pog_json[n]),$(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),$(".save_draft").addClass("active"),pog_info={},pog_info.POGCode=l[0].POGCode,pog_info.Version=l[0].Version,pog_info.status="Y","Y"==g_all_pog_flag?(pog_info.description=void 0===o||""==o?l[0].description:o,pog_info.saveType=e,pog_info.draftVersion=_):(pog_info.description=void 0===o||""==o?l[0].description:o,pog_info.draftVersion=_,pog_info.saveType=e),pog_info.pogjson=JSON.stringify(l),pog_info.Cal_Width=l[0].Cal_Width,pog_info.Cal_height=l[0].Cal_height,pog_info.draftSeq=l[0].draftSeq,pog_info.errorStatus=a,pog_info.errorMessage="",pog_info.draftInd="Y",pog_info.division=l[0].Division,pog_info.dept=l[0].Dept,pog_info.subDept=l[0].SubDept,pog_list.push(pog_info)}}if("Y"!=g_all_pog_flag)break;n++}console.log("pog_list",pog_list),apex.server.process("SAVE_DRAFT",{p_clob_01:JSON.stringify(pog_list)},{dataType:"text",success:function(e){"ERROR"==$.trim(e).split(",")[0]?raise_error(e):(sessionStorage.setItem("new_pog_ind","Y"),g_pog_edited_ind="N","Y"==t?raise_error(g):void 0!==g_autofill_detail.AFVersion?(g_autofill_detail.AFPOGVersion="",apex.server.process("SAVE_AUTOFILL",{x01:g_autofill_detail.AFPOGCode,x02:g_autofill_detail.AFVersion,x03:g_autofill_detail.AutofillRule,x04:g_autofill_detail.BlkSelType,x05:g_autofill_detail.AFPOGVersion,p_clob_01:JSON.stringify(filterAutoFillJsontag(g_autofill_detail))},{dataType:"text",success:function(e){"ERROR"==$.trim(e).split(",")[0]?raise_error(e):(apex.message.clearErrors(),apex.message.showPageSuccess(g_pog_draft_save_msg))}})):(apex.message.clearErrors(),apex.message.showPageSuccess(g_pog_draft_save_msg)),logDebug("function : save_draft","E"))},loadingIndicatorPosition:"page"})}catch(e){error_handling(e)}}function get_draft_ind(e){return logDebug("function : get_draft_ind; seq_id : "+e,"S"),console.log("get_draft_ind",e),new Promise((function(o,_){apex.server.process("GET_DRAFT_IND",{x01:e},{dataType:"text",success:function(e){console.log("get_draft_ind pData",e),""!=$.trim(e)&&(logDebug("function : get_draft_ind","E"),o($.trim(e)))}})}))}async function save_wpog(e){logDebug("function : save_wpog");try{return new Promise((function(o,_){apex.server.process("SAVE_WPOG",{p_clob_01:JSON.stringify(e)},{dataType:"text",success:function(e){""==$.trim(e)?(apex.message.showPageSuccess(g_pog_success_msg),o("SUCESS")):raise_error(e)},loadingIndicatorPosition:"page"})}))}catch(e){error_handling(e)}}async function getJson(e,o,_,n,t,g,a,l,s="N",i="Y",d){logDebug("function : getJson; new_pog_ind : "+e+"; pog_version : "+_+"; recreate : "+n+"; create_json : "+t,"S");try{return new Promise((function(d,r){var f,I="N",c="N";"Y"==e?(f="GET_POG_JSON",I="N",$s("P25_OPEN_POG_CODE","")):"T"==e?(f="OPEN_TEMPLATE",I="N",$s("P25_OPEN_POG_CODE","")):(f="GET_EXISTING_POG",I="E");var p=-1;p="Y"==e?_:o,apex.server.process(f,{x01:p,x02:_},{dataType:"html"}).done((function(o){var r="Y",f=$.trim(o);try{g_json=JSON.parse($.trim(o))}catch{r="N"}if("N"==r)raise_error(f);else if(""!==f){if(g_json=JSON.parse($.trim(o)),"Y"==t?g_pog_json_data.push(JSON.parse(JSON.stringify(g_json[0]))):g_pog_json_data=g_pog_json,"undefined"!=typeof g_pog_json_data){!async function(){if("Y"==e){c=await get_draft_ind(p);let o=await loadDraftVersion(p);g_pog_json_data[g_pog_index].draftVersion=o,"Y"==e&&"Y"==c&&(I="E",e="N")}if(sessionStorage.setItem("new_pog_ind",e),sessionStorage.setItem("pog_opened",I),sessionStorage.setItem("POGExists","Y"),"Y"==i&&await setDefaultState(e),await create_module_from_json(g_pog_json_data,e,"F","N",I,"N","N",n,t,_,"Y",g,a,g_pog_index,l,s),"N"==e&&"Y"==c&&sessionStorage.setItem("new_pog_ind","Y"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&backupPog("F",-1,-1,g_pog_index),"Y"==g_compare_pog_flag&&"POG"!==g_compare_view)await recreate_compare_views(g_compare_view,"N");logDebug("function : getJson","E"),d("SUCCESS")}()}clearUndoRedoInfo(),g_dblclick_opened="N"}}))}))}catch(e){error_handling(e)}}async function get_json_data(e,o="N",_){logDebug("function : get_json_data; pog_code : "+e,"S"),g_ComBaseIndex=-1,g_ComViewIndex=-1,g_compare_pog_flag="N",g_compare_view="NONE",g_colorBackup="N",l_new_pog_ind="N";var n=[];g_pog_json_data=[];try{if("Y"==$v("P25_POGCR_VALIDATE_POG")&&1==e.length){init(0),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects),set_indicator_objects(g_scene_objects.length-1),g_pog_index=0;await getJson("Y","",e[0],"N","Y",g_camera,g_scene,0,o,_);g_dblclick_opened="N";await create_module_from_json(g_pog_json,sessionStorage.getItem("new_pog_ind"),"F","N",sessionStorage.getItem("pog_opened"),"Y","N","Y","N","","Y",g_camera,g_scene,g_pog_index,g_pog_index);animate_all_pog(),generateMultiPogDropdown(),$(".t-Body-actionsToggle").hasClass("is-active")&&(apex.region("draggable_table").widget().interactiveGrid("getActions").set("edit",!1),apex.region("draggable_table").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("draggable_table").refresh())}else{g_scene_objects=[],g_canvas_objects=[],appendMultiCanvasRowCol(e.length,$v("P25_POGCR_TILE_VIEW")),switchCanvasView($v("P25_POGCR_TILE_VIEW")),g_multi_pog_json=[],await setDefaultState("Y");for(var t=0;t<=e.length-1;t++){init(t),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects),g_seqArrDtl={},g_seqArrDtl.seqId=e[t],g_seqArrDtl.index=t,g_seqArrDtl.pogCode="",g_seqArrDtl.pogVersion="",g_seqArrDtl.pogType="D",g_seqArr.push(g_seqArrDtl),g_pog_index=t,set_indicator_objects(g_scene_objects.length-1);await getJson("Y","",e[t],"Y","Y",g_camera,g_scene,t,o,"Y",_);render(t);var g=g_canvas_objects[t].getAttribute("id");$("#"+g+"-btns").append('<span id="block_title" style="float:left">'+g_pog_json[t].POGCode+"</span>")}g_pog_json=g_multi_pog_json,generateMultiPogDropdown();await animate_all_pog();if($(".t-Body-actionsToggle").hasClass("is-active")&&(apex.region("draggable_table").widget().interactiveGrid("getActions").set("edit",!1),apex.region("draggable_table").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("draggable_table").refresh()),"Y"==o)await get_all_images(0,g_get_orient_images,"Y",$v("P25_POGCR_IMG_MAX_WIDTH"),$v("P25_POGCR_IMG_MAX_HEIGHT"),$v("P25_IMAGE_COMPRESS_RATIO"));if(g_ItemImages.length>0&&"Y"==g_show_live_image&&"Y"==o){var a=0;$(".live_image").addClass("live_image_active");for(const e of g_pog_json){try{g_renderer=g_scene_objects[a].renderer,g_scene=g_scene_objects[a].scene,g_camera=g_scene_objects[a].scene.children[0],g_world=g_scene_objects[a].scene.children[2];await recreate_image_items("Y",$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_NOTCH_HEAD"),a,g_show_days_of_supply,$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label)}catch(e){error_handling(e)}a++}g_imagesShown="Y",animate_all_pog()}var l=0;for(const e of g_pog_json)l>0&&await enableDisableFlags(l),l++;if(await save_update_json_items(g_multi_pog_json),g_pog_index=0,g_scene_objects.length>0&&void 0!==g_scene_objects[g_pog_index]){void 0!==g_scene_objects[g_pog_index].Indicators&&(g_show_fixel_label=g_scene_objects[g_pog_index].Indicators.FixelLabel,g_show_item_label=g_scene_objects[g_pog_index].Indicators.ItemLabel,g_show_notch_label=g_scene_objects[g_pog_index].Indicators.NotchLabel,g_show_max_merch=g_scene_objects[g_pog_index].Indicators.MaxMerch,g_show_item_color=g_scene_objects[g_pog_index].Indicators.ItemColor,g_show_item_desc=g_scene_objects[g_pog_index].Indicators.ItemDesc,g_show_live_image=g_scene_objects[g_pog_index].Indicators.LiveImage,g_show_days_of_supply=g_scene_objects[g_pog_index].Indicators.DaysOfSupply,g_overhung_shelf_active=g_scene_objects[g_pog_index].Indicators.OverhungShelf,g_itemSubLabelInd=g_scene_objects[g_pog_index].Indicators.ItemSubLabelInd,g_itemSubLabel=g_scene_objects[g_pog_index].Indicators.ItemSubLabel);g=g_canvas_objects[g_pog_index].getAttribute("id");$("[data-pog]").removeClass("multiPogList_active"),$(".canvas_highlight").removeClass("canvas_highlight"),$("#"+g+"-btns").addClass("canvas_highlight"),$("[data-indx="+g_pog_index+"]").addClass("multiPogList_active"),g_all_pog_flag="N"}}var s=0;for(const e of g_pog_json){if(n=[],void 0!==g_pog_json[s].DeleteItems&&g_pog_json[s].DeleteItems.length>0){t=0;for(var i of g_pog_json[s].DeleteItems)n.push(i.Item),t++}void 0!==n&&(g_open_productlist="D",await deleted_items_log(n,"D",s)),s++}logDebug("function : get_json_data","E")}catch(e){error_handling(e)}}function set_indicator_objects(e){var o={};o.FixelLabel=g_show_fixel_label,o.ItemLabel=g_show_item_label,o.NotchLabel=g_show_notch_label,o.MaxMerch=g_show_max_merch,o.ItemColor=g_show_item_color,o.ItemDesc=g_show_item_desc,o.LiveImage=g_show_live_image,o.DaysOfSupply=g_show_days_of_supply,o.OverhungShelf=g_overhung_shelf_active,o.ItemSubLabelInd=g_itemSubLabelInd,o.ItemSubLabel=g_itemSubLabel,g_scene_objects[e].Indicators=o}async function get_existing_pog(e,o,_,n,t="N"){logDebug("function : get_existing_pog; pog_code : "+e+"; pog_version : "+o,"S"),$(".item_label").removeClass("item_label_active"),$(".item_desc").removeClass("item_label_active"),$(".fixel_label").removeClass("fixel_label_active"),$(".notch_label").removeClass("notch_label_active"),$(".fixel_merch").removeClass("max_merch_active"),$(".item_color").removeClass("item_color_active"),$(".overhung_shelf").removeClass("overhung_shelf_active"),$(".item_sublabel").removeClass("item_sublabel_active"),$("#item_sublbl_sub .items").removeClass("item_sublabel_active"),sessionStorage.removeItem("g_color_arr"),sessionStorage.removeItem("g_highlightArr"),g_color_arr=[],g_initial_camera=null,g_highlightArr=[],l_new_pog_ind="N";try{if("Y"==$v("P25_POGCR_VALIDATE_POG")&&"N"==n){init(_),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects),set_indicator_objects(g_scene_objects.length-1);await getJson("N",e,o,"N","Y",g_camera,g_scene,_,t);if("Y"==await validate_pog(_)){removeLoadingIndicator(regionloadWait);await save_validate_items_coll(g_errored_items);apex.region("ig_errored_item").refresh(),apex.event.trigger("#P25_ERROR_METHOD","apexrefresh"),g_dblclick_opened="Y",openInlineDialog("errored_items",60,65)}else{g_dblclick_opened="N";await create_module_from_json(g_pog_json,sessionStorage.getItem("new_pog_ind"),"F","N",sessionStorage.getItem("pog_opened"),"N","N","Y","N","","Y",g_camera,g_scene,g_pog_index,g_pog_index,t)}}else{init(_),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects),set_indicator_objects(g_scene_objects.length-1);await getJson("N",e,o,"Y","Y",g_camera,g_scene,_,t)}g_initial_camera||(g_initial_camera=g_camera.clone()),logDebug("function : get_existing_pog","E")}catch(e){error_handling(e)}}async function error_correction(e){if(logDebug("function : error_correction","S"),g_errored_items.length>0){var o=0;for(const e of g_errored_items)"N"==e.Corrected&&o++;if("FAIL"!=$v("P25_ERROR_METHOD")&&"A"!=$v("P25_ERROR_METHOD")||"Y"!=$v("P25_DELETE_ITEMS")){closeInlineDialog("errored_items");await correct_pog_errors($v("P25_ERROR_METHOD"),$v("P25_DELETE_ITEMS"),e,"N");o=0;for(const e of g_errored_items)"N"==e.Corrected&&o++;if(o>0){await save_validate_items_coll(g_errored_items);apex.region("ig_errored_item").refresh(),apex.event.trigger("#P25_ERROR_METHOD","apexrefresh"),g_dblclick_opened="Y",openInlineDialog("errored_items",60,65)}else{g_dblclick_opened="N",addLoadingIndicator();await reorder_errored_shelfs(g_errored_items,e),await create_module_from_json(g_pog_json,sessionStorage.getItem("new_pog_ind"),"F","N",sessionStorage.getItem("pog_opened"),"Y","N","Y","N","","Y",g_scene_objects[e].scene.children[0],g_scene_objects[e].scene,g_pog_index,g_pog_index,"N")}}else{var _="",n="N";for(const e of g_errored_items)"FAIL"==e.CorrectionMethod&&"N"==e.Corrected&&(_=","+e.Item,n="Y");if(_=_.substr(1),"Y"==n)confirm(get_message("POGCR_ERROR_ITEMS_LIST",_),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){closeInlineDialog("errored_items"),async function(){await correct_pog_errors($v("P25_ERROR_METHOD"),$v("P25_DELETE_ITEMS"),e,"N"),o=0;for(const e of g_errored_items)"N"==e.Corrected&&o++;if(o>0){await save_validate_items_coll(g_errored_items);apex.region("ig_errored_item").refresh(),apex.event.trigger("#P25_ERROR_METHOD","apexrefresh"),g_dblclick_opened="Y",openInlineDialog("errored_items",60,65)}else{g_dblclick_opened="N",addLoadingIndicator();await reorder_errored_shelfs(g_errored_items,e),await create_module_from_json(g_pog_json,sessionStorage.getItem("new_pog_ind"),"F","N",sessionStorage.getItem("pog_opened"),"Y","N","Y","N","","Y",g_scene_objects[e].scene.children[0],g_scene_objects[e].scene,g_pog_index,g_pog_index,"N")}}()}));else{closeInlineDialog("errored_items");await correct_pog_errors($v("P25_ERROR_METHOD"),$v("P25_DELETE_ITEMS"),e,"N");o=0;for(const e of g_errored_items)"N"==e.Corrected&&o++;if(o>0){await save_validate_items_coll(g_errored_items);apex.region("ig_errored_item").refresh(),apex.event.trigger("#P25_ERROR_METHOD","apexrefresh"),g_dblclick_opened="Y",openInlineDialog("errored_items",60,65)}else{g_dblclick_opened="N",addLoadingIndicator();await reorder_errored_shelfs(g_errored_items,e),await create_module_from_json(g_pog_json,sessionStorage.getItem("new_pog_ind"),"F","N",sessionStorage.getItem("pog_opened"),"Y","N","Y","N","","Y",g_scene_objects[e].scene.children[0],g_scene_objects[e].scene,g_pog_index,g_pog_index,"N")}}}}else if(void 0!==typeof g_pog_json[e]&&g_pog_json[e].length>0){g_dblclick_opened="N",addLoadingIndicator();await create_module_from_json(g_pog_json,sessionStorage.getItem("new_pog_ind"),"F","N",sessionStorage.getItem("pog_opened"),"Y","N","Y","N","","Y",g_scene_objects[e].scene.children[0],g_scene_objects[e].scene,g_pog_index,g_pog_index,"N")}"Y"==g_show_live_image&&animate_pog(e),logDebug("function : error_correction","E")}async function reorder_errored_shelfs(e,o){logDebug("function : reorder_errored_shelfs","S");var _=e.filter((function(e){var o=e.SIndex+"|"+e.MIndex;if(!this[o])return this[o]=!0,!0}),Object.create(null));for(shelfs of _)if(reorder_items(shelfs.MIndex,shelfs.SIndex,o)){if(shelfs.NewShelfRecreated="Y","PEGBOARD"==shelfs.ObjType)var n=shelfs.ShelfInfo.VertiSpacing;else n=shelfs.ShelfInfo.HorizGap;$.each(g_pog_json[o].ModuleInfo[shelfs.MIndex].ShelfInfo[shelfs.SIndex].ItemInfo,(function(e,_){var t=get_item_xaxis(_.W,_.H,_.D,shelfs.ShelfInfo.ObjType,_.X,n,shelfs.ShelfInfo.SpreadItem,n,shelfs.MIndex,shelfs.SIndex,e,"Y",shelfs.ShelfInfo.ItemInfo.length,"N",o);_.X=t}))}var t=e.filter((function(e){var o=e.NewShelfInd+"|"+e.MIndex;if(!this[o])return this[o]=!0,!0}),Object.create(null));for(shelfs of t)if(""!==shelfs.NewShelfInd&&reorder_items(shelfs.MIndex,shelfs.NewShelfInd,o)){if("PEGBOARD"==shelfs.ObjType)n=shelfs.ShelfInfo.VertiSpacing;else n=shelfs.ShelfInfo.HorizGap;$.each(g_pog_json[o].ModuleInfo[shelfs.MIndex].ShelfInfo[shelfs.NewShelfInd].ItemInfo,(function(e,_){var t=get_item_xaxis(_.W,_.H,_.D,shelfs.ShelfInfo.ObjType,_.X,n,shelfs.ShelfInfo.SpreadItem,n,shelfs.MIndex,shelfs.NewShelfInd,e,"Y",shelfs.ShelfInfo.ItemInfo.length,"N",o);_.X=t}))}logDebug("function : reorder_errored_shelfs","E")}async function correct_pog_errors(e,o,_,n="N"){if(logDebug("function : correct_pog_errors; method : "+e+"; delete_item : "+o,"S"),g_errored_items.length>0)for(const p of g_errored_items)if("N"==p.Corrected){var t=g_pog_json[_].ModuleInfo[p.MIndex].ShelfInfo[p.SIndex],g=0,a=-1;for(const e of t.ItemInfo){if(p.IIndex==e.IIndex){a=g;break}g+=1}if(-1!==a){var l=g_pog_json[_].ModuleInfo[p.MIndex].ShelfInfo[p.SIndex].ItemInfo[a];if("C"==p.CorrectionMethod&&("C"==e||"A"==e)){await check_crush_facing_correct(p.MIndex,p.SIndex,a,"Y",l.X,l,t,"N","C",p.ErrorCategory,_);p.Corrected="Y"}if("F"==p.CorrectionMethod&&("F"==e||"A"==e)){await check_crush_facing_correct(p.MIndex,p.SIndex,a,"Y",l.X,l,t,"N","F",p.ErrorCategory,_);p.Corrected="Y"}if("NF"==p.CorrectionMethod&&("NF"==e||"A"==e)&&"N"==n){var s="H"==p.ErrorCategory?p.ItemInfo.H:"W"==p.ErrorCategory?p.ItemInfo.W:"D"==p.ErrorCategory?p.ItemInfo.D:-1,i=(a=-1,0);for(item_details of g_pog_json[_].ModuleInfo[p.MIndex].ShelfInfo[p.SIndex].ItemInfo){if(item_details.IIndex==p.IIndex){a=i;break}i++}l=g_pog_json[_].ModuleInfo[p.MIndex].ShelfInfo[p.SIndex].ItemInfo[a];var[d,r]=await check_fixel_avail_space(p.MIndex,p.SIndex,a,p.ErrorCategory,s,"N",p.NewShelfInd,l,_);p.Corrected="Y"}if("FAIL"==p.CorrectionMethod&&("FAIL"==e||"A"==e)&&"N"==n){a=-1,i=0;for(item_details of g_pog_json[_].ModuleInfo[p.MIndex].ShelfInfo[p.SIndex].ItemInfo){if(item_details.IIndex==p.ItemInfo.IIndex){a=i;break}i++}if(g_pog_json[_].ModuleInfo[p.MIndex].ShelfInfo[p.SIndex].ItemInfo.splice(a,1),"Y"==o){g_deletedItems.push(p.Item);await deleted_items_log(g_deletedItems,"D",_)}else{if(0==g_pog_json[_].ModuleInfo[p.MIndex].Carpark.length){for(const e of g_errored_items)"FAIL"==e.CorrectionMethod&&e.MIndex==p.MIndex&&e.W;var f=get_min_max_xy(_).split("###");carpark_shelf(p.MIndex+1,g_pog_json[_].W,.04,p.D+.1,g_pog_json[_].W/2,parseFloat(f[1])+.03,p.MIndex,_)}g_pog_json[_].ModuleInfo[p.MIndex].Carpark[0].ItemInfo.push(p.ItemInfo);var I=g_pog_json[_].ModuleInfo[p.MIndex].Carpark[0].ItemInfo.length-1,c=newy=-1;newy=g_pog_json[_].ModuleInfo[p.MIndex].Carpark[0].Y+g_pog_json[_].ModuleInfo[p.MIndex].Carpark[0].H/2+p.H/2,c=0==I?g_pog_json[_].ModuleInfo[p.MIndex].Carpark[0].X-g_pog_json[_].ModuleInfo[p.MIndex].Carpark[0].W/2+p.W/2:g_pog_json[_].ModuleInfo[p.MIndex].Carpark[0].ItemInfo[g_pog_json[_].ModuleInfo[p.MIndex].Carpark[0].ItemInfo.length-2].X+g_pog_json[_].ModuleInfo[p.MIndex].Carpark[0].ItemInfo[g_pog_json[_].ModuleInfo[p.MIndex].Carpark[0].ItemInfo.length-2].W/2+p.W/2,g_pog_json[_].ModuleInfo[p.MIndex].Carpark[0].ItemInfo[I].X=c,g_pog_json[_].ModuleInfo[p.MIndex].Carpark[0].ItemInfo[I].Y=newy,g_pog_json[_].ModuleInfo[p.MIndex].Carpark[0].ItemInfo[I].Z=.05}p.Corrected="Y"}}}logDebug("function : correct_pog_errors","E")}async function get_template(e){logDebug("function : get_template; p_template_name : "+e,"S");try{g_scene_objects=[],g_canvas_objects=[],appendMultiCanvasRowCol(1),g_pog_index=0,addLoadingIndicator(),g_multi_pog_json=[],g_pog_json_data=[],g_pog_json=[],init(0),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects);await getJson("T","","","Y","Y",g_camera,g_scene,0);set_indicator_objects(0),removeLoadingIndicator(regionloadWait),logDebug("function : get_template","E")}catch(e){error_handling(e)}}function get_item_exists_orientation(e,o){var _,n,t=g_pog_json[o].ModuleInfo;for(var g of t){for(var a of g.ShelfInfo){for(var l of a.ItemInfo)e==l.Item&&(_=l.Orientation,n=l.OrientationDesc);0}0}return[_,n]}async function set_pegid(e){var o,_,n=0,t=[];for(var g of g_pog_json[e].ModuleInfo){var a=0;for(var l of g.ShelfInfo){if("PEGBOARD"==l.ObjType){o=l.ItemInfo;for(const e of o)""!==e.NewPegId&&(e.NewPegId="");for(z=1;z<=10;z++){var s=0;t=[];var i=[],d=l.Y+l.H/2;for(var r of o)void 0!==r.NewPegId&&""!=r.NewPegId||(_=wpdSetFixed(r.Y+r.H/2),t.push(wpdSetFixed(d-_)),i.push(s)),s++;var f=Math.min.apply(Math,t),I=t.findIndex((function(e){return e==f}));if(-1!==I){var c,p=g_pog_json[e].ModuleInfo[n].ShelfInfo[a].ItemInfo[i[I]],u=(c=p.Y+p.H/2)-g_minvalue,m=c+g_minvalue;s=0;for(var r of o){if(void 0===r.NewPegId||""==r.NewPegId){var h=r.Y+r.H/2;h<=m&&h>=u&&(r.NewPegId=z)}s++}}}}a++}n++}}function update_auto_position_peg(){"Y"==g_pegbrd_auto_placing?($(".auto_align_peg").removeClass("item_label_active"),g_pegbrd_auto_placing="N"):($(".auto_align_peg").addClass("item_label_active"),g_pegbrd_auto_placing="Y")}async function setDefaultState(e){g_module_obj_array=[],$(".live_image").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".open_pdf").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".open_pdf_online").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".peg_holes").addClass("peg_hole_acive"),g_peg_holes_active="Y",$(".live_image").removeClass("live_image_active"),g_show_peg_tags="N",$(".peg_tag").removeClass("show_peg_tags"),$(".fixel_merch").removeClass("max_merch_active"),g_draftPogInd="Y"==e?"D":"E";var o=$v("P25_POGCR_SHOW_DFLT_ITEM_LOC");"Y"==o?$(".item_label").addClass("item_label_active"):$(".item_label").removeClass("item_label_active");var _=$v("P25_POGCR_DFT_ITEM_DESC");"Y"==_?$(".item_desc").addClass("item_label_active"):$(".item_desc").removeClass("item_label_active");var n=$v("P25_POGCR_DFLT_LIVE_IMAGES");"Y"==n&&"N"==_?$(".live_image").addClass("live_image_active"):$(".live_image").removeClass("live_image_active");var t=$v("P25_POGCR_DFT_NOTCH_LABEL");"Y"==t?$(".notch_label").addClass("notch_label_active"):$(".notch_label").removeClass("notch_label_active");var g=$v("P25_POGCR_DFT_FIXEL_LABEL");"Y"==g?$(".fixel_label").addClass("fixel_label_active"):$(".fixel_label").removeClass("fixel_label_active");var a=$v("P25_POGCR_DFT_DAYS_OF_SUPPLY");"Y"==a?$(".supply_days").addClass("item_label_active"):$(".supply_days").removeClass("item_label_active");var l=$v("P25_POGCR_DFLT_FIXEL_AVLSPACE_LBL");"Y"==l?$(".fixel_space").addClass("item_label_active"):$(".fixel_space").removeClass("item_label_active");var s=$v("P25_POGCR_AUTO_DEPTH_CAL");"Y"==s?$(".auto_depth").addClass("auto_depth_active"):$(".auto_depth").removeClass("auto_depth_active"),g_auto_cal_depth_fac=s;var i=$v("P25_POGCR_DFT_OVERHUNG_LABEL");"Y"==i?$(".overhung_shelf").addClass("overhung_shelf_active"):$(".overhung_shelf").removeClass("overhung_shelf_active"),$(".open_product").css("display","block"),sessionStorage.setItem("g_show_item_desc",_),g_show_fixel_label=g,g_show_item_label=o,g_show_notch_label=t,g_show_item_color="N",g_show_item_desc=_,g_show_live_image=n,g_show_days_of_supply=a,g_show_fixel_space=l,g_overhung_shelf_active=i,g_itemSubLabelInd="N",g_itemSubLabel="","Y"==$.trim(get_global_ind_values("AI_EDIT_IND"))&&($(".create_module").css("visibility","visible"),$(".create_shelf").css("visibility","visible"),$(".create_pegboard").css("visibility","visible"),$(".create_text").css("visibility","visible"),$(".create_hangingbar").css("visibility","visible"),$(".create_basket").css("visibility","visible"),$(".create_chest").css("visibility","visible"),$(".create_rod").css("visibility","visible"),$(".create_pallet").css("visibility","visible"),$(".create_divider").css("visibility","visible"),$(".fixel_label").css("display","block"),$(".item_label").css("display","block"),$(".open_fixel").css("display","block"),$(".clear_item").css("display","block"),$(".clear_pog_info").css("display","block"),$(".clear_pog_att").css("display","block"),"N"==e?$(".open_pdf").css("display","block"):$(".open_pdf").css("display","none"),$s("P25_OPEN_DRAFT","Y"),$(".auto_position").removeClass("auto_position_active"),null!==apex.region("draggable_table")&&(apex.region("draggable_table").widget().interactiveGrid("getActions").set("edit",!1),apex.region("draggable_table").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("draggable_table").refresh()))}async function appendMultiCanvasRowCol(e,o=$v("P25_POGCR_TILE_VIEW"),_="N",n){console.log("dynamic rows cols"),"H"==o?($(".viewH").addClass("view_active"),$(".viewV").removeClass("view_active")):($(".viewV").addClass("view_active"),$(".viewH").removeClass("view_active"));var t,g=$("#canvas-holder .container").height(),a=$("#canvas-holder .container").width(),l=1,s=1,i="Y",d=0,r=e,f=0,I=[];$("[data-col]").each((function(){var e=$(this)[0];I.push(e)})),e<=3?(i="N",t=e,s=e):4==e?(i="N",t=2,s=2,l=2):5==e||6==e||9==e?(s=3,l=Math.ceil(e/s)):7==e||8==e||10==e||11==e||12==e||16==e?(s=4,l=Math.ceil(e/s)):13==e||14==e||15==e||17==e||18==e||19==e||20==e?(s=5,l=Math.ceil(e/s)):(s=5,l=5),$("#canvas-holder .container").html(""),"H"==o?$("#canvas-holder .container").addClass("h-view").removeClass("v-view"):$("#canvas-holder .container").addClass("v-view").removeClass("h-view");for(var c=1;c<=l;c++){if($("#canvas-holder .container").append('<div class="row" data-row="'+c+'"></div>'),"Y"==i)r%(l-c+1)>0?t=s:(t=r/(l-c+1),i="N"),r-=t;for(var p=1;p<=t;p++){var u=0==d?"":d+1,m="maincanvas"+u;if("Y"==_)if(n==d-1)$("[data-row="+c+"]").append('<div class="canvas-content" id="'+m+'-container" data-col="'+p+'" style="height:'+parseFloat((g/l).toFixed(2))+"px;width:"+parseFloat((a/t).toFixed(2))+'px"><div class="canvas-buttons" id="'+m+'-btns" ><span class="fa fa-close canvas-close" onClick="closePog('+d+')"></span><span class="fa fa-window-maximize canvas-max" onClick="maximizePog('+d+')"></span><span class="fa fa-minus canvas-min" onClick="minimizePog('+d+')"></span></div><canvas class="canvasregion" data-canvas=true id="'+m+'" ></canvas></div>'),f=1;else{var h=I[d-f];$(h).attr("id",m+"-container"),$("[data-row="+c+"]").append(h);var S=$(h).attr("id");$("[data-row="+c+"] #"+S).css("height",parseFloat((g/l).toFixed(2))).css("width",parseFloat((a/t).toFixed(2))).attr("data-col",p),$("[data-row="+c+"] #"+S+" .canvas-buttons").attr("id",m+"-btns"),$("[data-row="+c+"] #"+S+" .canvasregion").attr("id",m)}else{var x="";e>1&&(x='<div class="canvas-buttons" id="maincanvas'+u+'-btns" ><span class="fa fa-close canvas-close" onClick="closePog('+d+')"></span><span class="fa fa-window-maximize canvas-max" onClick="maximizePog('+d+')"></span><span class="fa fa-minus canvas-min" onClick="minimizePog('+d+')"></span></div>'),$("[data-row="+c+"]").append('<div class="canvas-content" id="maincanvas'+u+'-container" data-col="'+p+'" style="height:'+parseFloat((g/l).toFixed(2))+"px;width:"+parseFloat((a/t).toFixed(2))+'px">'+x+'<canvas class="canvasregion" data-canvas=true id="maincanvas'+u+'" ></canvas></div>')}d++}}if("Y"==_){var O=0;for(c=1;c<=g_pog_json.length;c++)if(2!==c){const e=g_renderer,o=(g_scene_objects[c-1-O].scene,g_scene_objects[c-1-O].scene.children.find((e=>"PerspectiveCamera"===e.type)));m="maincanvas"+(1==c?"":c);var M=$("#"+m).parent().height(),j=$("#"+m).parent().width(),D=M-$("#"+m+"-btns")[0].offsetHeight,b=Math.tan(Math.PI/180*o.fov/2);o.aspect=j/D,o.fov=360/Math.PI*Math.atan(b),o.updateProjectionMatrix(),e.setSize(j,D),render(c)}else 2==c&&(O=1)}makeResizableRow()}async function switchCanvasView(e,o="N"){var _,n,t,g="Y",a=g_pog_index;if(t=$("[data-row]").length,$("[data-col]").length,"Collapse"==$(".a-Splitter-thumb").attr("title")&&(o="Y"),n=$("#drawing_region").width()-$("#side_bar").width(),_=$("#canvas-holder .container").height(),$s("P25_POGCR_TILE_VIEW",e),"H"==e&&($("#canvas-holder .container").hasClass("v-view")&&"N"==o||"Y"==o)){$("#canvas-holder .container").css("display","flex").addClass("h-view").removeClass("v-view"),$(".viewH").addClass("view_active"),$(".viewV").removeClass("view_active");for(var l=1;l<=t;l++){var s=$("[data-row="+l+"] [data-col]").length;$("[data-row="+l+"] .canvas-content").css("height",parseFloat((_/s).toFixed(2))).css("width",parseFloat((n/t).toFixed(2)))}}else if("V"==e&&($("#canvas-holder .container").hasClass("h-view")&&"N"==o||"Y"==o)){$("#canvas-holder .container").css("display","grid").addClass("v-view").removeClass("h-view"),$(".viewV").addClass("view_active"),$(".viewH").removeClass("view_active");for(l=1;l<=t;l++){s=$("[data-row="+l+"] [data-col]").length;$("[data-row="+l+"] .canvas-content").css("height",parseFloat((_/t).toFixed(2))).css("width",parseFloat((n/s).toFixed(2)))}}else g="N";if("Y"==g&&g_pog_json.length>0){g_canvas_objects=[];for(l=1;l<=g_pog_json.length;l++){const e=g_renderer,o=g_scene_objects[l-1].scene,_=g_scene_objects[l-1].scene.children.find((e=>"PerspectiveCamera"===e.type));var i="maincanvas"+(1==l?"":l);g_canvas=document.getElementById(i);var d=$("#"+i).parent().height(),r=$("#"+i).parent().width(),f=$("#"+i+"-btns")[0],I=r,c=d-(g_scene_objects.length>1?f.offsetHeight:0);$("#"+i).css("height",c+"px !important").css("width",I+"px !important"),$("#"+i).height(c),$("#"+i).width(I),g_canvas.width=I,g_canvas.height=c,g_canvas_objects.push($("#"+i)[0]);var p=Math.tan(Math.PI/180*_.fov/2);_.aspect=I/c,_.fov=360/Math.PI*Math.atan(p),_.updateProjectionMatrix(),e.setSize(I,c);var u=get_min_max_xy(l-1).split("###");set_camera_z(_,parseFloat(u[2]),parseFloat(u[3]),parseFloat(u[0]),parseFloat(u[1]),g_offset_z,parseFloat(u[4]),parseFloat(u[5]),!0,l-1),g_pog_index=l-1,g_scene=o,g_camera=_,render(l-1)}}g_pog_index=a}async function show_errors_final_pog(e){var o,_="Failed POG",n="</br> Successfully Saved POG",t="N",g="N";for(p of e)""!=p.errorMessage&&(g="Y",_=_+"</br>"+p.errorMessage);for(p of e)""==p.errorMessage&&(t="Y",n=n+"</br>"+p.POGCode+" "+get_message("POGCR_SAVE_MSG"));if(apex.message.clearErrors(),o="Y"==t&&"N"==g?n:"N"==t&&"Y"==g?_:_+"</br>"+n,"Y"==g)try{raise_error(o)}catch{removeLoadingIndicator(regionloadWait)}else apex.message.clearErrors(),!(e.length=1)||void 0===e[0].workflowId&&""===e[0].workflowId||0===e[0].workflowId?apex.message.showPageSuccess(g_pog_success_msg):apex.message.showPageSuccess("POG sent to workflow approval");try{"undefined"==typeof regionloadWait||"function"!=typeof regionloadWait.remove||""!=$v("P25_SAVE_WITH_PDF")&&"N"!=$v("P25_SAVE_WITH_PDF")||removeLoadingIndicator(regionloadWait)}catch{console.log("no loading")}}function maximizePog(e,o){var _,n,t;if(g_is_pog_maximize=0!==o?"Y":"N",0==o)_=g_scene_objects_backup[e],n=g_pogjson_backup[e],t=g_pogjson_data_backup[e],g_scene_objects.push(_),g_pog_json.push(g_pogjson_backup[e]),g_pog_json_data.push(g_pogjson_data_backup[e]),g_scene_objects_backup.splice(e,1),g_pogjson_backup.splice(e,1),g_pogjson_data_backup.splice(e,1);else{if(_=g_scene_objects.splice(e,1),n=g_pog_json.splice(e,1),t=g_pog_json_data.splice(e,1),"undefined"!=typeof g_scene_objects_backup&&g_scene_objects_backup.length>0)for(var g=0;g<g_scene_objects.length;g++)g_scene_objects_backup.push(g_scene_objects[g]),g_pogjson_backup.push(g_pog_json[g]),g_pogjson_data_backup.push(g_pog_json_data[g]);else g_scene_objects_backup=g_scene_objects,g_pogjson_backup=g_pog_json,g_pogjson_data_backup=g_pog_json_data;g_scene_objects=_,g_pog_json=n,g_multi_pog_json=n,g_pog_json_data=t}appendMultiCanvasRowCol(g_scene_objects.length,$v("P25_POGCR_TILE_VIEW")),modifyWindowAfterMinMax(g_scene_objects),generateCanvasListHolder(g_pogjson_backup),reset_compare_index(e),add_pog_code_header(),generateMultiPogDropdown(),set_select_canvas(e)}function add_pog_code_header(){$("#canvas-holder #block_title").remove();for(var e=0;e<g_scene_objects.length;e++){var o=g_canvas_objects[e].getAttribute("id");$("#"+o+"-btns").append('<span id="block_title" style="float:left">'+g_pog_json[e].POGCode+"</span>")}}function reset_compare_index(e){var o=0;for(const e of g_pog_json)e.POGCode==g_comp_view_code&&(g_ComViewIndex=o),e.POGCode==g_comp_base_code&&(g_ComBaseIndex=o),o++;o=0;for(const e of g_pogjson_backup)e.POGCode==g_comp_view_code&&(g_ComViewIndex=o),e.POGCode==g_comp_base_code&&(g_ComBaseIndex=o),o++}function minimizePog(e){var o,_,n;g_is_pog_maximize="N",o=g_scene_objects.splice(e,1),_=g_pog_json.splice(e,1),n=g_pog_json_data.splice(e,1),g_scene_objects_backup.push(o[0]),g_pogjson_backup.push(_[0]),g_pogjson_data_backup.push(n[0]),g_pog_index=g_pog_json.length-1,e=g_pog_index,appendMultiCanvasRowCol(g_scene_objects.length,$v("P25_POGCR_TILE_VIEW")),modifyWindowAfterMinMax(g_scene_objects),generateCanvasListHolder(g_pogjson_backup),reset_compare_index(e),add_pog_code_header(),generateMultiPogDropdown(),set_select_canvas(g_pog_index)}function closePog(e,o){0==o?(g_scene_objects_backup.splice(e,1),g_pogjson_backup.splice(e,1),g_pogjson_data_backup.splice(e,1),generateCanvasListHolder(g_pogjson_backup)):confirm(get_message("POGCR_CLOSE_POG_WARN"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){g_scene_objects.splice(e,1),g_pog_json.splice(e,1),g_pog_json_data.splice(e,1),appendMultiCanvasRowCol(g_scene_objects.length,$v("P25_POGCR_TILE_VIEW")),modifyWindowAfterMinMax(g_scene_objects),e==g_ComViewIndex&&"Y"==g_compare_pog_flag?(g_compare_view="NONE",g_compare_pog_flag="N",g_edit_pallet_mod_ind=-1,g_edit_pallet_shelf_ind=-1,g_ComViewIndex=-1,g_ComBaseIndex=-1,g_comp_view_code="",g_comp_base_code=""):reset_compare_index(e),add_pog_code_header(),generateMultiPogDropdown(),g_pog_json.length>0&&(g_pog_index=0,set_select_canvas(g_pog_index),ShowColorBackup(g_pog_index))}))}async function modifyWindowAfterMinMax(e){g_scene_objects=[],console.log("modify"),g_canvas_objects=[];for(var o=g_pog_index,_=0;_<e.length;_++){init(_);var n="maincanvas";_>0&&(n="maincanvas"+(_+1)),g_camera=e[_].scene.getObjectByProperty("type","PerspectiveCamera"),g_scene=e[_].scene,g_pog_index=_,console.log("scene",g_scene.uuid);var t=$("#"+n).parent()[0].offsetHeight,g=$("#"+n).parent()[0].offsetWidth,a=$("#"+n+"-btns")[0],l=g,s=t-(void 0!==a?a.offsetHeight:0);$("#"+n).css("height",s+"px !important").css("width",l+"px !important"),$("#"+n).height(s),$("#"+n).width(l),g_camera.aspect=l/s,g_camera.fov=360/Math.PI*Math.atan(g_tanFOV),g_camera.updateProjectionMatrix();var i=get_min_max_xy(_).split("###");set_camera_z(g_camera,parseFloat(i[2]),parseFloat(i[3]),parseFloat(i[0]),parseFloat(i[1]),g_offset_z,parseFloat(i[4]),parseFloat(i[5]),!0,_),objects={},objects.scene=g_scene,objects.renderer=g_renderer,console.log("objects",objects),g_scene_objects.push(objects),set_indicator_objects(_),render(_)}g_pog_index=o}function generateCanvasListHolder(e){if($("#canvas-list-holder").html(""),e.length>0){for($("#canvas-list-holder").css({display:"flex",width:"auto"}),$("#canvas-list-holder").append('<div class="canvas-holder-div"><span class="canvas-holder-code expand-tab" onclick="expandAllPog()">'+g_expand_all_pog+"</span></div>"),i=0;i<e.length;i++)console.log("generage",i),$("#canvas-list-holder").append('<div class="canvas-holder-div"><span class="canvas-holder-code">'+e[i].POGCode+'</span><span class="fa fa-window-arrow-up canvas-expand" onClick=expandPog('+i+')></span><span class="fa fa-window-maximize canvas-max" onclick="maximizePog('+i+', 0)"></span><span class="fa fa-close canvas-close" onclick="closePog('+i+', 0)"></span></div>');$("#canvas-list-holder").width()>=window.innerWidth&&$("#canvas-list-holder").css("width","100%")}else $("#canvas-list-holder").css({display:"none",width:"auto"})}function expandAllPog(){var e=0;for(g_scene of(g_is_pog_maximize="N",g_scene_objects_backup))g_scene_objects.push(g_scene),g_pog_json.push(g_pogjson_backup[e]),g_pog_json_data.push(g_pogjson_data_backup[e]),e++;g_scene_objects_backup=[],g_pogjson_backup=[],g_pogjson_data_backup=[],g_pog_index=g_pog_json.length-1;e=0;for(const o of g_pog_json)o.POGCode==g_comp_view_code&&(g_ComViewIndex=e),o.POGCode==g_comp_base_code&&(g_ComBaseIndex=e),e++;appendMultiCanvasRowCol(g_scene_objects.length,$v("P25_POGCR_TILE_VIEW")),modifyWindowAfterMinMax(g_scene_objects),generateCanvasListHolder(g_pogjson_backup),add_pog_code_header(),generateMultiPogDropdown(),set_select_canvas(g_pog_index)}function expandPog(e){var o,_,n;if(o=g_scene_objects_backup.splice(e,1),_=g_pogjson_backup.splice(e,1),n=g_pogjson_data_backup.splice(e,1),"undefined"!=typeof g_scene_objects_backup&&g_scene_objects_backup.length>0)for(var t=0;t<g_scene_objects.length;t++)g_scene_objects_backup.push(g_scene_objects[t]),g_pogjson_backup.push(g_pog_json[t]),g_pogjson_data_backup.push(g_pog_json_data[t]);else g_scene_objects_backup=g_scene_objects,g_pogjson_backup=g_pog_json,g_pogjson_data_backup=g_pog_json_data;g_scene_objects=o,g_pog_json=_,g_pog_json_data=n,reset_compare_index(e),appendMultiCanvasRowCol(g_scene_objects.length,$v("P25_POGCR_TILE_VIEW")),modifyWindowAfterMinMax(g_scene_objects),generateCanvasListHolder(g_pogjson_backup),add_pog_code_header(),generateMultiPogDropdown(),set_select_canvas(e)}function get_draft_Desc(e,o,_){return new Promise((function(n,t){apex.server.process("GET_DRAFT_DESCRIPTION",{x01:e,x02:o,x03:_},{dataType:"text",success:function(e){""!=$.trim(e)&&($s("P25_POG_DESCRIPTION",$.trim(e)),n($.trim(e)))}})}))}function makeResizableDiv(e){const o=$("#t_Body_nav").width(),_=$("#top_bar").height(),n=$("#t_Header").height(),t=document.getElementById(e+"-container"),g=$("#resizeLine");var a,l,s,i,d,r,f,I,c,p,u,m,h=-1,S=-1,x=!1;function O(e){if(x){var t=e.clientX-o,l=e.clientY-_-n;if("V"==a)g.css("width","1px"),g.css("height",c.height+"px"),g.css("top",c.top-_-n-1+"px"),t>s&&t<d&&(f=e.clientX,g.css("left",t+"px"));else{if("H"!=a)return x=!1,window.removeEventListener("mousemove",O),window.removeEventListener("mouseup",M),g.css("width","0px"),g.css("height","0px"),g.css("left","0px"),void g.css("top","0px");g.css("width",c.width+"px"),g.css("height","1px"),g.css("left",c.left-o-1+"px"),l>i&&l<r&&(I=e.clientY,g.css("top",l+"px"))}}}function M(e){if(x&&void 0!==h&&-1!==h&&void 0!==S&&-1!==S){var o,_,n,t,l,j,D,b,v=$("#maincanvas"+u+"-container .canvas-buttons").height(),E=$("#maincanvas"+m+"-container .canvas-buttons").height();window.removeEventListener("mousemove",O),g.css("width","0px"),g.css("height","0px"),g.css("left","0px"),g.css("top","0px");var C=0;for(const e of g_scene_objects){var P=$(g_canvas_objects[C]).attr("data-indx");P==h?n=C:P==S&&(j=C),C++}if("V"==a)D=e.clientX>=s&&e.clientX<=d?e.clientX:f,c.left>D&&p.right>D||c.left<D&&p.right<D?(o=c.width+(c.left-D),t=p.width-(p.right-D)):(o=c.width,t=p.width),$("#maincanvas"+u+"-container").css("width",o+"px"),$("#maincanvas"+m+"-container").css("width",t+"px"),_=c.height,l=p.height;else{if("H"!=a)return window.removeEventListener("mouseup",M),void(x=!1);b=e.clientY>=i&&e.clientY<=r?e.clientY:I,c.top>b&&p.bottom>b||c.top<b&&p.bottom<b?(_=c.height+(c.top-b),l=p.height-(p.bottom-b)):(_=c.height,l=p.height),$("#maincanvas"+u+"-container").css("height",_+"px"),$("#maincanvas"+m+"-container").css("height",l+"px"),o=c.width,t=p.width,_-=v,l-=E}g_renderer.setPixelRatio(window.devicePixelRatio);var N=g_scene_objects[n].scene.children[0],T=get_min_max_xy(n).split("###");g_canvas_objects[n]=document.getElementById("maincanvas"+u),g_canvas_objects[n].width=o,g_canvas_objects[n].height=_,$("#maincanvas"+u).width(o),$("#maincanvas"+u).height(_),N.aspect=o/_,N.updateProjectionMatrix(),g_scene_objects[n].scene.children[0]=N,set_camera_z(N,parseFloat(T[2]),parseFloat(T[3]),parseFloat(T[0]),parseFloat(T[1]),g_offset_z,parseFloat(T[4]),parseFloat(T[5]),!0,n),context=g_canvas_objects[n].getContext("2d"),g_renderer.setSize(o,_),N.aspect=o/_,g_renderer.render(g_scene_objects[n].scene,N),context.drawImage(g_renderer.domElement,0,0,o,_),N.updateProjectionMatrix(),g_scene_objects[n].scene.children[0]=N,set_camera_z(N,parseFloat(T[2]),parseFloat(T[3]),parseFloat(T[0]),parseFloat(T[1]),g_offset_z,parseFloat(T[4]),parseFloat(T[5]),!0,n);var y=g_scene_objects[j].scene.children[0],Y=get_min_max_xy(j).split("###");g_canvas_objects[j]=document.getElementById("maincanvas"+m),g_canvas_objects[j].width=t,g_canvas_objects[j].height=l,y.aspect=t/l,y.updateProjectionMatrix(),g_scene_objects[j].scene.children[0]=y,set_camera_z(y,parseFloat(Y[2]),parseFloat(Y[3]),parseFloat(Y[0]),parseFloat(Y[1]),g_offset_z,parseFloat(Y[4]),parseFloat(Y[5]),!0,j),$("#maincanvas"+m).width(t),$("#maincanvas"+m).height(l),context=g_canvas_objects[j].getContext("2d"),g_renderer.setSize(t,l),y.aspect=t/l,g_renderer.render(g_scene_objects[j].scene,y),context.drawImage(g_renderer.domElement,0,0,t,l),y.updateProjectionMatrix(),g_scene_objects[j].scene.children[0]=y,set_camera_z(y,parseFloat(Y[2]),parseFloat(Y[3]),parseFloat(Y[0]),parseFloat(Y[1]),g_offset_z,parseFloat(Y[4]),parseFloat(Y[5]),!0,j),window.removeEventListener("mouseup",M),x=!1}}t.addEventListener("mousedown",(function(e){if(g_dragging||x)return;if(console.log(e.target.className),"canvas-content"!=e.target.className)return;e.preventDefault(),window.addEventListener("mousemove",O),window.addEventListener("mouseup",M),x=!0,a=$("#canvas-holder .container")[0].className.replace("container","").replace("-view","").toUpperCase().trim(),l=e.srcElement.id,h=parseInt($("#"+l+" canvas").attr("data-indx")),S=parseInt(h-1),u=(0==h?"":h+1).toString(),m=(0==S?"":S+1).toString();var t=$("#maincanvas"+u+"-container")[0],g=$("#maincanvas"+m+"-container")[0];c=t.getBoundingClientRect(),p=g.getBoundingClientRect();var f=c.right,I=c.bottom,j=p.left,D=p.top;s=Math.round(j)-o-1+150,d=Math.round(f)-o-1-150,i=Math.round(D)-_-n-1+150,r=Math.round(I)-_-n-1-150}))}async function activateOverhungShelf(e){if(logDebug("function : activateOverhungShelf; ","S"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0){if("Y"==g_all_pog_flag)var o=0;else o=e;"Y"==g_overhung_shelf_active?(g_overhung_shelf_active="N",$(".overhung_shelf").removeClass("overhung_shelf_active")):(g_overhung_shelf_active="Y",$(".overhung_shelf").addClass("overhung_shelf_active"));for(const e of g_pog_json){if(set_indicator_objects(o),"Y"!=g_all_pog_flag)break;o++}}logDebug("function : activateOverhungShelf; ","E")}async function identifyOverhungItems(e,o,_){if("undefined"!=typeof g_pog_json&&g_pog_json.length>0)if("Y"==g_all_pog_flag)var n=0;else n=e;var t="N",g="N",a=g_overhung_validation;g_overhung_validation="Y";for(const e of g_pog_json){var l=g_pog_json[n].ModuleInfo,s=0;for(const e of l){if(null==e.ParentModule||"undefined"==e.ParentModule){var i=0;for(const _ of e.ShelfInfo){if("Y"==t)break;if(void 0!==_&&("SHELF"==_.ObjType||"HANGINGBAR"==_.ObjType)){if("Y"==t)break;var d=_.X-_.W/2-_.LOverhang,r=_.X+_.W/2+_.ROverhang;d=wpdSetFixed(d)-.001,r=wpdSetFixed(r)+.001;var[f,I,c,p]=get_curr_module(_.X,_.Y,"N",s,i,_,n),u=0,[m,h]=getCombinationShelf(n,_.Shelf);if(-1==m&&-1==h)for(const e of _.ItemInfo){var S=wpdSetFixed(e.X)-wpdSetFixed(e.W/2),x=wpdSetFixed(e.X)+wpdSetFixed(e.W/2);if(S=wpdSetFixed(S),x=wpdSetFixed(x),(S<d||x>r)&&"Y"==I){if("Y"==o){t="Y",g="Y";break}g_pog_json[n].ModuleInfo[s].ShelfInfo[i].ItemInfo[u].OverhungItem="Y",g_pog_json[n].ModuleInfo[s].ShelfInfo[i].Overhung="Y",g_pog_json[n].ModuleInfo[s].ShelfInfo[i].ItemInfo[u].CarparkItem="N"}else"N"==I?(g_pog_json[n].ModuleInfo[s].ShelfInfo[i].ItemInfo[u].CarparkItem="Y",g_pog_json[n].ModuleInfo[s].ShelfInfo[i].ItemInfo[u].OverhungItem="N",g_pog_json[n].ModuleInfo[s].ShelfInfo[i].Overhung="N"):"Y"==I&&(g_pog_json[n].ModuleInfo[s].ShelfInfo[i].ItemInfo[u].OverhungItem="N",g_pog_json[n].ModuleInfo[s].ShelfInfo[i].ItemInfo[u].CarparkItem="N");u++}else{var O=g_combinedShelfs[m];last_shelf=O.length-1;var M=0;for(obj of O){var j=g_pog_json[obj.PIndex].ModuleInfo[obj.MIndex].ShelfInfo[obj.SIndex];d=wpdSetFixed(j.X-j.W/2-j.LOverhang),r=wpdSetFixed(j.X+j.W/2+j.ROverhang);d=wpdSetFixed(d),r=wpdSetFixed(r);u=0;for(const e of j.ItemInfo){S=wpdSetFixed(e.X)-wpdSetFixed(e.W/2),x=wpdSetFixed(e.X)+wpdSetFixed(e.W/2);if(S=wpdSetFixed(S),x=wpdSetFixed(x),(S<d&&0==M||x>r&&last_shelf==M)&&"Y"==I){if("Y"==o){t="Y",g="Y";break}g_pog_json[obj.PIndex].ModuleInfo[obj.MIndex].ShelfInfo[obj.SIndex].ItemInfo[u].OverhungItem="Y",g_pog_json[obj.PIndex].ModuleInfo[obj.MIndex].ShelfInfo[obj.SIndex].Overhung="Y",g_pog_json[obj.PIndex].ModuleInfo[obj.MIndex].ShelfInfo[obj.SIndex].ItemInfo[u].CarparkItem="N"}else"N"==I?(g_pog_json[obj.PIndex].ModuleInfo[obj.MIndex].ShelfInfo[obj.SIndex].ItemInfo[u].CarparkItem="Y",g_pog_json[obj.PIndex].ModuleInfo[obj.MIndex].ShelfInfo[obj.SIndex].ItemInfo[u].OverhungItem="N",g_pog_json[obj.PIndex].ModuleInfo[obj.MIndex].ShelfInfo[obj.SIndex].Overhung="N"):"Y"==I&&(g_pog_json[obj.PIndex].ModuleInfo[obj.MIndex].ShelfInfo[obj.SIndex].ItemInfo[u].OverhungItem="N",g_pog_json[obj.PIndex].ModuleInfo[obj.MIndex].ShelfInfo[obj.SIndex].ItemInfo[u].CarparkItem="N");u++}M++}}}i++}}s++}if("N"==t&&("Y"==(t=await validate_pog(n,"Y","Y"))&&(g="N"),"Y"==_))await save_validate_items_coll(g_errored_items);if("Y"!=g_all_pog_flag)break;n++}return g_overhung_validation=a,[t,g]}function sessionSetCombineDetails(){try{logDebug("function : sessionSetCombineDetails","S");var e=[];if(g_combinedShelfs.length>0){g_combinedShelfs.keySort({MIndex:"asc",X:"asc"});var o=0;for(combines of g_combinedShelfs){var _={};_.Index=o,_.Start=combines.Start,_.End=combines.End,_.SpreadItem=combines.SpreadItem,_.AllowAutoCrush=combines.AllowAutoCrush;var n={},t=[];for(obj of combines.ItemInfo)n.ObjID=obj.ObjID,n.PIndex=void 0!==obj.PIndex&&""!==obj.PIndex?obj.PIndex:combines[0].PIndex,n.MIndex=obj.MIndex,n.SIndex=obj.SIndex,n.IIndex=obj.IIndex,t.push(n);_.ItemInfo=t,e.push(_),o++}}sessionStorage.setItem("combinedShlfDets",JSON.stringify(e))}catch(e){logDebug("function : sessionSetCombineDetails","E"),error_handling(e)}}function sessionGetCombineDetails(){try{if(logDebug("function : sessionGetCombineDetails","S"),g_combinedShelfs.length>0){g_combinedShelfs.keySort({MIndex:"asc",X:"asc"});var e=JSON.parse(sessionStorage.getItem("combinedShlfDets"));for(cd of e){g_combinedShelfs[cd.Index].Start=cd.Start,g_combinedShelfs[cd.Index].End=cd.End,g_combinedShelfs[cd.Index].SpreadItem=cd.SpreadItem,g_combinedShelfs[cd.Index].AllowAutoCrush=cd.AllowAutoCrush;var o=[];for(obj of cd.ItemInfo)o.push(g_pog_json[obj.PIndex].ModuleInfo[obj.MIndex].ShelfInfo[obj.SIndex].ItemInfo[obj.IIndex]);g_combinedShelfs[cd.Index].ItemInfo=o}}}catch(e){logDebug("function : sessionGetCombineDetails","E"),error_handling(e)}}function get_auto_placing_item_loc(e,o,_,n,t,g,a,s){var i=g_pog_json[_].ModuleInfo[e].ShelfInfo[o].ItemInfo,d=g_pog_json[_].ModuleInfo[e].ShelfInfo[o],r=d.Y-d.H/2-d.LoOverHang,f=d.AutoPlacing,I=d.X+d.W/2+d.ROverhang,c=d.peg_vert_values,p=d.peg_horiz_values,u=[],m=[],h=d.Y,S="N";if(void 0===f&&(f="N"),c.length>0){var x=0;for(obj of c)u.push(h+c[x]),x++}if(p.length>0){var O=0;for(obj of p)m.push(g_pog_json[_].ModuleInfo[e].ShelfInfo[o].X+p[O]),O++}var M=-1,j=-1,D="Y",b=-1,v=-1;x=0,O=0;for(l=0;l<m.length&&(b=l,!(M>-1))&&m[l]+t+a<I;l++){for(x=0;x<u.length&&(u[x],v=x,u[x]-g-s>r);x++){var E=wpdSetFixed(m[l]),C=wpdSetFixed(m[l]+t),P=wpdSetFixed(u[x]),N=wpdSetFixed(u[x]-g);O=0,D="Y";for(const e of i){if(O!=n){var T=wpdSetFixed(e.X-e.W/2),y=wpdSetFixed(e.X+e.W/2),Y=wpdSetFixed(e.Y+e.H/2),R=wpdSetFixed(e.Y-e.H/2);if((P>R&&Y>P||C>I||E<=y&&T<E)&&T<E){D="N",O;break}if((T<C&&T>=E||y>E&&y<=C)&&(R<P&&R>=N||Y<=P&&Y>N)||(E<T&&C>T||E<y&&C>=y)&&P<=Y&&N>=R||(T<=E&&y>=C||T>=E&&y<=C)&&(Y>=P&&N>=R||Y>=P&&R<=N||Y>P&&R<=P)||E<T&&C>=y&&P<=Y&&P>R&&N<=R||E>T&&C<=y&&P>=Y&&N<Y&&N<=R||E<T&&C>=y&&P<=Y&&N>=R||E<T&&C>=y&&P<Y&&P>R||E>=T&&E<y&&N>=R&&N<Y){D="N",O;break}}O++}if("Y"==D){var[j,L]=get_top_y(P,i,.001,n,g,d.ItemInfo[n]);v>0&&(j-=s),M=E+t/2+a,0==b&&(M-=a),console.log("l_finalX ",M,j,i.Item),S="Y";break}}if("Y"==S)break}return[M,j]}function selectItemByGroup(e,o,_){try{var n;g_delete_details=[],clear_blinking(),"IB"==o?n="Brand":"IS"==o?n="Supplier":"IG"==o?n="Group":"ID"==o?n="Dept":"IL"==o?n="Class":"IC"==o?n="SubClass":"ICDT1"==o?n="CDTLvl1":"ICDT2"==o?n="CDTLvl2":"ICDT3"==o&&(n="CDTLvl3");var t=0;for(const o of g_pog_json[e].ModuleInfo){if(null==o.ParentModule||"undefined"==o.ParentModule){var g=0;for(const s of o.ShelfInfo){if(void 0!==s&&"NOTCH"!==s.ObjType&&"BASE"!==s.ObjType&&"DIVIDER"!==s.ObjType&&"TEXTBOX"!==s.ObjType){var a=0;for(const i of s.ItemInfo){if("DIVIDER"!==i.Item&&""!==_&&i[n]==_||""==_&&0==nvl(i[n])){var l=setDetailsArray(i.ObjID,t,g,i.W,i.H,i.X,i.Y,i.Z,a,s.ObjType,"N","ITEM",o.MObjID,s.SObjID,i.ItemID,i.Item,"N",0,0,i.Distance,i.TopObjID,i.BottomObjID,g_start_canvas,g_present_canvas,e);l.W=i.W,l.RW=i.RW,l.H=i.H,l.X=i.X,l.Y=i.Y,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(l)}a++}}g++}}t++}g_delete_details.length>0&&(g_multiselect="Y",g_mselect_drag="Y","undefined"!=typeof g_delete_details&&$.each(g_delete_details,(function(o,_){var n=g_scene_objects[e].scene.children[2].getObjectById(_.ObjID);g_intersected.push(n)}))),render_animate_selected()}catch(e){error_handling(e)}}function get_yaxis_on_paste(e,o,_,n,t){try{logDebug("function : get_yaxis_on_paste","S");var g=e.MaxMerch,a=wpdSetFixed(g_pog_json[t].ModuleInfo[_].H+g_pog_json[t].BaseH+e.H/2);let s=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.some((e=>e.Y===a)),i=0;var l=0;i=0!==g?g:(0===g||null===g)&&o.length>0?Math.max(...o.map((e=>e.H))):Number(g_default_max_merch),l=wpdSetFixed(i+e.Y+e.H);for(let g=1;g<=30;g++){if("N"!==validate_shelf_min_distance(_,n,l,o,"N",_,e.X,"N",e,t,"Y"))break;l=(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[n].ObjType,l+i+e.H)}return l<=a?l:l>a&&!s?l=a:-1}catch(e){logDebug("function : get_yaxis_on_paste","E"),error_handling(e)}}function loadDraftVersion(e){return logDebug("function : loadDraftVersion; seq_id : "+e,"S"),console.log("loadDraftVersion",e),new Promise((function(o,_){apex.server.process("GET_DRAFT_VERSION",{x01:e},{dataType:"text",success:function(e){""!==$.trim(e)?o($.trim(e)):o(null)}})}))}