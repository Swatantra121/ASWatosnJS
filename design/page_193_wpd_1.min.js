function wpdBuildShowChangesBlockSnapshot(e){var o=[];if(!Array.isArray(e))return o;for(const i of e)if(void 0!==i&&null!=i){var _=i.DragMouseStart&&void 0!==i.DragMouseStart.x?Number(i.DragMouseStart.x):0,t=i.DragMouseStart&&void 0!==i.DragMouseStart.y?Number(i.DragMouseStart.y):0,n=i.DragMouseEnd&&void 0!==i.DragMouseEnd.x?Number(i.DragMouseEnd.x):0,g=i.DragMouseEnd&&void 0!==i.DragMouseEnd.y?Number(i.DragMouseEnd.y):0,a={};a.BlkName=i.BlkName,a.BlkColor=i.BlkColor,a.BlkRule=i.BlkRule,a.DragMouseStart={x:_,y:t},a.DragMouseEnd={x:n,y:g},a.BlkModInfo=Array.isArray(i.BlkModInfo)?JSON.parse(JSON.stringify(i.BlkModInfo)):[],a.BlkShelfInfo=Array.isArray(i.BlkShelfInfo)?JSON.parse(JSON.stringify(i.BlkShelfInfo)):[],a.mod_index=Array.isArray(i.mod_index)?JSON.parse(JSON.stringify(i.mod_index)):[],o.push(a)}return o}function wpdCaptureShowChangesBlockSnapshot(e,o="N"){"Y"!=o&&Array.isArray(g_show_changes_block_snapshot)&&0!==g_show_changes_block_snapshot.length||(g_show_changes_block_snapshot=wpdBuildShowChangesBlockSnapshot(e))}function initiate_values_onload(){if(sessionStorage.setItem("g_dbuDebugEnabled",$v("P193_POGC_JS_DEBUG_ENABLE")),logDebug("onload code ; ","S"),!document.getElementById("ig_mod_details")){var e=document.createElement("div");e.id="ig_mod_details",e.style.paddingLeft="0px",e.style.display="none",document.body.appendChild(e)}try{var o=LZString.decompress(sessionStorage.getItem("POGJSON"));if(null!==o&&""!==o)try{g_pog_json=JSON.parse(o)}catch(e){console.log("Failed to parse POGJSON for page 193:",e)}}catch(e){console.log("Error while loading POGJSON from sessionStorage:",e)}null!==document.getElementById("draggable_table")&&(g_trs=document.getElementById("draggable_table").getElementsByTagName("tr")),$("#canvas-holder").bind("dragenter dragover",!1).bind("drop",(function(e){console.log("drop bind")}));var _=$v("P193_DELETE_IND");back_clicked="N";document.getElementById("P193_UPLOAD_HIDDEN");var t=null,n=0,g=!1;$(document).keydown((function(e){if(g_delete_details.length>0){new_details=JSON.parse(JSON.stringify(g_delete_details));for(const e of new_details)e.ShelfInfo=""}else new_details=[];e.altKey&&70==e.keyCode&&(e.preventDefault(),openInlineDialog("find",35,45)),73==e.keyCode&&1==e.ctrlKey&&"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&open_update_item_info();var o={},a=e.keyCode;if(onkeydown=onkeyup=function(e){if(o[e.keyCode]="keyup"==e.type,"keydown"==e.type&&console.log("keydown ",e.keyCode,e),"keyup"==e.type&&67==e.keyCode&&console.log("key up 67 up"),"keydown"==e.type&&67==e.keyCode?g_chest_move="Y":g_chest_move="N","keydown"==e.type&&e.shiftKey?g_shift_mutli_item_select="Y":(g_shift_mutli_item_select="N",g_shift_multi_item_first={},g_shift_multi_item_last={}),"keydown"==e.type&&"ShiftLeft"!==e.code&&("Numpad1"==e.code||"Numpad2"==e.code||"Numpad3"==e.code||"Numpad4"==e.code||"Numpad5"==e.code||"Numpad6"==e.code||"Numpad7"==e.code||"Numpad8"==e.code||"Numpad9"==e.code))switch(console.log("e.code",e.code),g=!0,e.code){case"Numpad1":n=1;break;case"Numpad2":n=2;break;case"Numpad3":n=3;break;case"Numpad4":n=4;break;case"Numpad5":n=5;break;case"Numpad6":n=6;break;case"Numpad7":n=7;break;case"Numpad8":n=8;break;case"Numpad9":n=9}"keyup"==e.type&&g_pog_index!==g_ComViewIndex&&(1!=o[16]||1!=o[72]||1!=o[49]&&1!=o[50]&&1!=o[51]&&1!=o[52]&&1!=o[53]&&1!=o[54]&&1!=o[55]&&1!=o[56]&&1!=o[57]&&!g?1!=o[16]||1!=o[86]||1!=o[49]&&1!=o[50]&&1!=o[51]&&1!=o[52]&&1!=o[53]&&1!=o[54]&&1!=o[55]&&1!=o[56]&&1!=o[57]&&!g?1!=o[16]||1!=o[68]||1!=o[49]&&1!=o[50]&&1!=o[51]&&1!=o[52]&&1!=o[53]&&1!=o[54]&&1!=o[55]&&1!=o[56]&&1!=o[57]&&!g?t=null:(t="depthfacing",a>=49&&a<=57?incrementFacingsFromKey(t,String.fromCharCode(a)):incrementFacingsFromKey(t,n),o={},t=null,n=0,g=!1):(t="vertfacing",console.log("map",o,e.type,e.keyCode,a,String.fromCharCode(a)),a>=49&&a<=57?incrementFacingsFromKey(t,String.fromCharCode(a)):incrementFacingsFromKey(t,n),o={},t=null,n=0,g=!1):(t="horizfacing",console.log("map",o,e.type,e.keyCode,a,String.fromCharCode(a)),a>=49&&a<=57?incrementFacingsFromKey(t,String.fromCharCode(a)):incrementFacingsFromKey(t,n),o={},t=null,a=null,n=0,g=!1))},!e.shiftKey||38!=e.keyCode&&40!=e.keyCode&&37!=e.keyCode&&39!=e.keyCode||g_pog_index===g_ComViewIndex)if(null===t||"horizfacing"!=t&&"vertfacing"!=t){if(null==t&&(g_pog_index==g_ComViewIndex&&("EDIT_PALLET"==g_compare_view&&46!==e.keyCode||"PREV_VERSION"==g_compare_view&&67==e.keyCode&&1==e.ctrlKey&&"Y"==g_edit_ind)||g_pog_index!==g_ComViewIndex))if(("N"==g_multiselect||38==e.keyCode&&1==e.ctrlKey||40==e.keyCode&&1==e.ctrlKey)&&(g_taskItemInContext1||g_taskItemInContext||38==e.keyCode&&1==e.ctrlKey||40==e.keyCode&&1==e.ctrlKey)&&"N"==g_dblclick_opened&&(67==e.keyCode&&1==e.ctrlKey||46==e.keyCode||86==e.keyCode&&1==e.ctrlKey||88==e.keyCode&&1==e.ctrlKey||69==e.keyCode&&1==e.ctrlKey||81==e.keyCode&&1==e.ctrlKey||76==e.keyCode&&1==e.ctrlKey||90==e.keyCode&&1==e.ctrlKey||38==e.keyCode&&1==e.ctrlKey||40==e.keyCode&&1==e.ctrlKey))if((69==e.keyCode&&1==e.ctrlKey||76==e.keyCode&&1==e.ctrlKey)&&e.preventDefault(),69==e.keyCode&&1==e.ctrlKey&&"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&"Y"==g_edit_ind&&("Y"==g_item_edit_flag||"Y"==g_module_edit_flag||"Y"==g_carpark_edit_flag)&&context_edit(),81==e.keyCode&&1==e.ctrlKey&&"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&"Y"==g_edit_ind&&"Y"==g_shelf_edit_flag&&context_edit(),38==e.keyCode&&1==e.ctrlKey&&"undefined"!=typeof g_pog_json&&g_pog_json.length>0?($("#maincanvas").css("cursor","zoom-in"),g_camera.position.set(g_camera.position.x,g_camera.position.y,g_camera.position.z-parseFloat($v("P193_POGCR_CAMERA_ZOOM_FACTOR"))),g_manual_zoom_ind="Y",render(g_pog_index)):40==e.keyCode&&1==e.ctrlKey&&"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&($("#maincanvas").css("cursor","zoom-out"),g_camera.position.set(g_camera.position.x,g_camera.position.y,g_camera.position.z+parseFloat($v("P193_POGCR_CAMERA_ZOOM_FACTOR"))),g_manual_zoom_ind="Y",render(g_pog_index)),"Y"==g_module_edit_flag||"Y"==g_shelf_edit_flag||"Y"==g_item_edit_flag)if(46==e.keyCode&&"Y"==_)g_keyCode=46,context_delete("DELETE",g_module_index,g_shelf_index,g_item_index,g_item_edit_flag,g_module_edit_flag,g_shelf_edit_flag,g_objectHit_id,"",g_delete_details,g_camera,g_pog_index,"N"),g_item_edit_flag="N",g_module_edit_flag="N",g_shelf_edit_flag="N",g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[];else if(67==e.keyCode&&1==e.ctrlKey&&"Y"==g_edit_ind)g_keyCode=67,context_copy("S",g_pog_index);else if(86!=e.keyCode||1!=e.ctrlKey||"Y"!=g_cut_action_done&&"Y"!=g_copy_action_done&&"Y"!=g_multi_copy_done||"Y"!=g_edit_ind)88==e.keyCode&&1==e.ctrlKey&&"Y"==g_edit_ind?(g_keyCode=88,context_cut(g_pog_index)):76==e.keyCode&&1==e.ctrlKey&&("Y"==g_shelf_edit_flag||"Y"==g_item_edit_flag&&"DIVIDER"==g_pog_json[p_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Item)&&"Y"==g_edit_ind?(g_keyCode=76,context_duplicate()):90!=e.keyCode||1!=e.ctrlKey||"Y"!=g_cut_action_done&&"Y"!=g_delete_action_done&&"Y"!=g_multi_delete_done||"Y"!=g_edit_ind?90==e.keyCode&&1==e.ctrlKey&&"N"==g_cut_action_done&&"N"==g_delete_action_done&&"N"==g_multi_delete_done&&g_undo_final_obj_arr.length-1>=0&&(g_keyCode=90,undo_actions_not_delete("UNDO",g_camera,g_pog_index)):g_undo_final_obj_arr.length-1>=0&&(g_keyCode=90,undo_actions_not_delete("UNDO",g_camera,g_pog_index));else{var i;g_keyCode=86,"Y"==g_cut_action_done?i="CUT":"Y"==g_copy_action_done&&(i="COPY"),"Y"!=g_cut_action_done&&"Y"!=g_copy_action_done&&"Y"!=g_multi_copy_done||context_paste(i,g_camera,"N","Y",g_pog_index)}else 90!=e.keyCode||1!=e.ctrlKey||"Y"!=g_cut_action_done&&"Y"!=g_delete_action_done&&"Y"!=g_multi_delete_done?90==e.keyCode&&1==e.ctrlKey&&"N"==g_cut_action_done&&"N"==g_delete_action_done&&"N"==g_multi_delete_done&&g_undo_final_obj_arr.length-1>=0&&(g_keyCode=90,undo_actions_not_delete("UNDO",g_camera,g_pog_index)):g_undo_final_obj_arr.length-1>=0&&(g_keyCode=90,undo_actions_not_delete("UNDO",g_camera,g_pog_index));else"Y"==g_multiselect&&JsonContains(new_details,"Object","SHELF")&&JsonContains(new_details,"ObjType","SHELF")&&JsonContains(new_details,"Object","ITEM")&&81==e.keyCode&&1==e.ctrlKey&&"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&"Y"==g_edit_ind?(e.preventDefault(),context_multi_edit("F"),g_mselect_drag="Y"):"Y"==g_multiselect&&JsonContains(new_details,"Object","ITEM")&&69==e.keyCode&&1==e.ctrlKey&&"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&"Y"==g_edit_ind?(e.preventDefault(),context_multi_edit("P"),g_mselect_drag="Y"):"Y"==g_multiselect&&46==e.keyCode&&"Y"==_?(context_delete("DELETE",g_module_index,g_shelf_index,g_item_index,g_item_edit_flag,g_module_edit_flag,g_shelf_edit_flag,g_objectHit_id,"",g_delete_details,g_camera,g_pog_index,g_productselect),g_item_edit_flag="N",g_module_edit_flag="N",g_shelf_edit_flag="N",g_keyCode=46):"Y"==g_multiselect&&67==e.keyCode&&1==e.ctrlKey?(context_copy("M",g_pog_index),g_keyCode=67):89==e.keyCode?g_redo_final_obj_arr.length-1>=0&&(g_keyCode=89,undo_actions_not_delete("REDO",g_camera,g_pog_index)):90!=e.keyCode||1!=e.ctrlKey||"Y"!=g_cut_action_done&&"Y"!=g_delete_action_done&&"Y"!=g_multi_delete_done?90==e.keyCode&&1==e.ctrlKey&&"N"==g_cut_action_done&&"N"==g_delete_action_done&&"N"==g_multi_delete_done&&g_undo_final_obj_arr.length-1>=0&&(g_keyCode=90,undo_actions_not_delete("UNDO",g_camera,g_pog_index)):g_undo_final_obj_arr.length-1>=0&&(g_keyCode=90,undo_actions_not_delete("UNDO",g_camera,g_pog_index))}else console.log("incrment facings ",t,0);else 38==e.keyCode?drag_fixel(g_module_index,g_shelf_index,g_item_index,"U",g_pog_index):40==e.keyCode?drag_fixel(g_module_index,g_shelf_index,g_item_index,"D",g_pog_index):37==e.keyCode?drag_fixel(g_module_index,g_shelf_index,g_item_index,"L",g_pog_index):39==e.keyCode&&drag_fixel(g_module_index,g_shelf_index,g_item_index,"R",g_pog_index)})),window.onbeforeunload=function(e){if(g_pog_json.length>0&&"undefined"!=typeof g_pog_json&&"N"==back_clicked){sessionStorage.setItem("POGJSON",LZString.compress(JSON.stringify(g_pog_json))),sessionStorage.setItem("g_color_arr",LZString.compress(JSON.stringify(g_color_arr))),sessionStorage.setItem("g_highlightArr",LZString.compress(JSON.stringify(g_highlightArr)));try{sessionStorage.setItem("g_ItemImages",JSON.stringify(g_ItemImages)),sessionStorage.setItem("IndexedDB_ind","N")}catch{add_img_indexeddb(g_ItemImages),sessionStorage.setItem("IndexedDB_ind","Y")}"undefined"!=typeof g_scene_objects_backup&&g_scene_objects_backup.length>0&&(sessionStorage.setItem("scene_objects_backup",LZString.compress(JSON.stringify(g_scene_objects_backup))),sessionStorage.setItem("pogjson_backup",LZString.compress(JSON.stringify(g_pogjson_backup)))),sessionStorage.setItem("g_show_live_image",g_show_live_image),sessionStorage.setItem("g_show_live_image_comp",g_show_live_image_comp),sessionStorage.setItem("g_show_notch_label",g_show_notch_label),sessionStorage.setItem("g_show_fixel_label",g_show_fixel_label),sessionStorage.setItem("g_show_notch_label_comp",g_show_notch_label_comp),sessionStorage.setItem("g_show_fixel_label_comp","N"),sessionStorage.setItem("g_show_item_label",g_show_item_label),sessionStorage.setItem("g_itemSubLabelInd",g_itemSubLabelInd),sessionStorage.setItem("g_itemSubLabel",g_itemSubLabel),sessionStorage.setItem("g_show_item_desc",g_show_item_desc),sessionStorage.setItem("g_show_max_merch",g_show_max_merch),sessionStorage.setItem("g_show_item_color",g_show_item_color),sessionStorage.setItem("g_show_fixel_space",g_show_fixel_space),sessionStorage.setItem("g_max_facing_enabled",g_max_facing_enabled),sessionStorage.setItem("g_show_days_of_supply",g_show_days_of_supply),sessionStorage.setItem("g_show_days_of_supply_comp","N"),sessionStorage.setItem("g_ComViewIndex",g_ComViewIndex),sessionStorage.setItem("g_ComBaseIndex",g_ComBaseIndex),sessionStorage.setItem("g_compare_view",g_compare_view),sessionStorage.setItem("g_compare_pog_flag",g_compare_pog_flag),sessionStorage.setItem("g_edit_pallet_mod_ind",g_edit_pallet_mod_ind),sessionStorage.setItem("g_edit_pallet_shelf_ind",g_edit_pallet_shelf_ind),sessionStorage.setItem("g_overhung_shelf_active",g_overhung_shelf_active),sessionStorage.setItem("g_combinedShelfs",JSON.stringify(g_combinedShelfs)),sessionSetCombineDetails(),sessionStorage.setItem("P193_EXISTING_DRAFT_VER",$v("P193_EXISTING_DRAFT_VER")),sessionStorage.setItem("P193_DRAFT_LIST",$v("P193_DRAFT_LIST")),sessionStorage.setItem("P193_POG_DESCRIPTION",$v("P193_POG_DESCRIPTION")),sessionStorage.setItem("P193_SELECT_COLOR_TYPE",$v("P193_SELECT_COLOR_TYPE")),sessionStorage.setItem("gPogIndex",g_pog_index)}else sessionStorage.removeItem("POGJSON"),sessionStorage.removeItem("g_ItemImages"),sessionStorage.removeItem("g_show_live_image"),sessionStorage.removeItem("g_show_notch_label"),sessionStorage.removeItem("g_show_fixel_label"),sessionStorage.removeItem("g_show_item_label"),sessionStorage.removeItem("g_itemSubLabelInd"),sessionStorage.removeItem("g_itemSubLabel"),sessionStorage.removeItem("g_show_item_desc"),sessionStorage.removeItem("g_show_fixel_space"),sessionStorage.removeItem("g_show_max_merch"),sessionStorage.removeItem("g_ItemImages"),sessionStorage.removeItem("g_show_item_color"),sessionStorage.removeItem("g_max_facing_enabled"),sessionStorage.removeItem("gPogIndex"),sessionStorage.removeItem("scene_objects_backup"),sessionStorage.removeItem("pogjson_backup"),sessionStorage.removeItem("g_overhung_shelf_active")},$(document).keyup((function(e){"Escape"===e.key?(g_dblclick_opened="N","Y"==g_auto_fill_active&&"N"==g_auto_fill_reg_open?("N"==g_autofill_edit&&update_module_block_list("U",$v("P193_EDIT_BLK"),"Y"),apex.theme.openRegion("auto_fill_reg"),g_auto_fill_reg_open="Y"):"Y"==g_auto_fill_active&&"Y"==g_auto_fill_reg_open&&clear_auto_fill_coll(),$s("P193_MODULE_EDIT_IND","N"),$s("P193_SHELF_EDIT_IND","N"),$s("P193_POG_EDIT_IND","N"),$s("P193_ITEM_EDIT_IND","N"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&""!==g_module_index&&-1!==g_module_index&&""!==g_shelf_index&&-1!==g_shelf_index?""==g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].TextImg&&(g_temp_image_arr=[],$s("P193_IMG_FILENAME",""),$("#IMAGE_AREA canvas").remove(),$("#VIEW_IMAGE canvas").remove()):(g_temp_image_arr=[],$s("P193_IMG_FILENAME",""),$("#IMAGE_AREA canvas").remove(),$("#VIEW_IMAGE canvas").remove()),g_world.remove(g_targetForDragging),render(g_pog_index)):"Control"==e.key&&($("#maincanvas").css("cursor","auto"),$("#maincanvas1").css("cursor","auto"))})),$(".custom_disable").prop("disabled",(function(e,o){return!o})),$("#P193_DRAFT_LIST").removeClass("apex_disabled"),$("button.ui-dialog-titlebar-close").on("click",(function(e){g_dblclick_opened="N",$s("P193_UPLOAD_HIDDEN",""),$s("P193_SHELF_EDIT_IND","N"),console.log('$s("P193_SHELF_EDIT_IND"',$v("P193_SHELF_EDIT_IND")),g_multiselect="N",g_mselect_drag="N",g_ctrl_select="N",g_productselect="N",""!==g_module_index&&-1!==g_module_index&&""!==g_shelf_index&&-1!==g_shelf_index?"undefined"!=typeof g_pog_json&&g_pog_json[g_pog_index].length>0&&""==new_pogjson[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].TextImg&&(g_temp_image_arr=[],$s("P193_IMG_FILENAME",""),$("#IMAGE_AREA canvas").remove(),$("#VIEW_IMAGE canvas").remove()):(g_temp_image_arr=[],$s("P193_IMG_FILENAME",""),$("#IMAGE_AREA canvas").remove(),$("#VIEW_IMAGE canvas").remove())}));var a={autoDismiss:!0,duration:3e3};apex.theme42.configureSuccessMessages(a),void 0===apex.theme42.configureSuccessMessages.options&&(apex.theme42.configureSuccessMessages.options=a),apex.message.setThemeHooks({beforeShow:function(e,o){"success"==e&&setTimeout((function(){$(".t-Alert").fadeOut("slow")}),3e3)}}),$(".t-Button--closeAlert").click((function(){$(".t-Alert").fadeOut("slow")})),$s("P193_DRAFT_LIST",sessionStorage.getItem("P193_DRAFT_LIST")),g_color_arr=null!==sessionStorage.getItem("g_color_arr")?JSON.parse(LZString.decompress(sessionStorage.getItem("g_color_arr"))):[],g_highlightArr=null!==sessionStorage.getItem("g_highlightArr")?JSON.parse(LZString.decompress(sessionStorage.getItem("g_highlightArr"))):[],$s("P193_POG_DESCRIPTION",sessionStorage.getItem("P193_POG_DESCRIPTION")),$s("P193_EXISTING_DRAFT_VER",sessionStorage.getItem("P193_EXISTING_DRAFT_VER")),$(".input-group").on("click",".button-plus",(function(e){incrementValue(e)})),$(".input-group").on("click",".button-minus",(function(e){decrementValue(e)})),$(".input-group1").on("click",".button-plus",(function(e){incrementValue(e)})),$(".input-group1").on("click",".button-minus",(function(e){decrementValue(e)})),$(".input-group2").on("click",".button-plus",(function(e){incrementValue(e)})),$(".input-group2").on("click",".button-minus",(function(e){decrementValue(e)})),$("#item_facings div").on("keydown",".quantity-field",(function(e){if(9==e.keyCode){var o=$(e.target).attr("name"),_=$(e.target).val();_>0&&incrementValue(e,o,_)}})),g_chest_as_pegboard=$v("P193_POGCR_CHEST_AS_PEGBOARD"),g_nodataModuleName=$v("P193_POGCR_NO_DATA_MODULE_NAME"),g_lr_overhung=$v("P193_POGCR_L_R_OVERHUNG"),g_pogcr_pdf_chest_split=$v("P193_POGCR_PDF_CHEST_SPLIT"),g_start_canvas=0,g_show_fixel_space=$v("P193_POGCR_DFLT_FIXEL_AVLSPACE_LBL"),g_show_days_of_supply=$v("P193_POGCR_DFT_DAYS_OF_SUPPLY"),g_get_orient_images=$v("P193_POGCR_OTHER_ORIENTATION_IMG"),g_drag_shelf_notch=$v("P193_POGCR_DRAG_SHELF_TO_NOTCH"),g_hangbar_dft_maxmerch=parseFloat($v("P193_POGCR_HGNGBAR_DFLT_MAXMCH"))/100,g_pegboard_dft_item_depth=parseFloat($v("P193_POGCR_DFT_PEGB_ITEM_DEPTH"))/100,g_pegbrd_auto_placing=$v("P193_POGCR_PEGBOARD_AUTO_PLACING"),g_pog_index=0,g_notch_label_position=$v("P193_POGCR_NOTCH_LABEL_POSITION").toUpperCase(),g_overhung_validation=$v("P193_POGCR_OVERHUNG_VALIDTION"),g_edit_ind=$v("P193_EDIT_IND"),g_default_checkbox=$v("P193_POGCR_DIVIDER_PLACING_DFLT_CB"),g_chest_move="N",g_auto_x_space=parseFloat($v("P193_POGCR_CHEST_ITEM_H_SPC"))/100,g_auto_y_space=parseFloat($v("P193_POGCR_CHEST_ITEM_V_SPC"))/100,g_multi_select_offset_perc=parseFloat($v("P193_POGCR_MULTI_SLCT_OFFSET_PERC")),g_select_item_color_change=$v("P193_POGCR_BLINK_COLOR_CHANGE"),g_textbox_threshold_value=parseFloat($v("P193_POGCR_THRESHOLD_TEXTBOX_VALUE"))/100,g_type_pog=null!==sessionStorage.getItem("g_type_pog")?sessionStorage.getItem("g_type_pog"):"",g_open_from="",g_sublabel_type=$v("P193_POGCR_ITEM_ADDITIONAL_INFO"),null!==sessionStorage.getItem("POGJSON")&&(window._pog_restore_in_progress?console.warn("POG restore already in progress, skipping duplicate call"):(window._pog_restore_in_progress=!0,async function(){try{var e=JSON.parse(LZString.decompress(sessionStorage.getItem("POGJSON")));if(g_pog_json=e,e&&e.length>0){addLoadingIndicator(),appendMultiCanvasRowCol(e.length,$v("P193_POGCR_TILE_VIEW")),g_pog_index=0,g_multi_pog_json=[],g_scene_objects=[],g_canvas_objects=[];for(var o=0;o<e.length;o++){g_pog_index=o;try{console.log("restore: TEMP_POG summary",o,{keys:Object.keys(e[o]||{}).slice(0,20),hasModuleInfo:void 0!==e[o]&&void 0!==e[o].ModuleInfo,moduleInfoLen:e[o]&&e[o].ModuleInfo?e[o].ModuleInfo.length:0})}catch(e){console.warn("restore: failed to log TEMP_POG for index",o,e)}init(o),console.log("restore: after init",o,{canvasId:g_canvas?g_canvas.id:null,canvasClientW:g_canvas?g_canvas.clientWidth:null,canvasClientH:g_canvas?g_canvas.clientHeight:null,hasRenderer:!!g_renderer,rendererDom:g_renderer&&g_renderer.domElement?g_renderer.domElement.id||"canvas":null,g_canvas_objects_len:g_canvas_objects.length,g_scene_objects_len:g_scene_objects.length,sceneChildren:g_scene?g_scene.children.length:null,worldChildren:g_world?g_world.children.length:null}),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects),await create_module_from_json(e,sessionStorage.getItem("new_pog_ind"),"F",$v("P193_PRODUCT_BTN_CLICK"),sessionStorage.getItem("pog_opened"),"N","N","Y","Y","","N",g_scene_objects[o].scene.children[0],g_scene_objects[o].scene,g_pog_index,o),console.log("restore: after create_module_from_json",o,{g_multi_pog_json_len:Array.isArray(g_multi_pog_json)?g_multi_pog_json.length:-1,thisPogModuleInfoLen:g_multi_pog_json[o]&&g_multi_pog_json[o].ModuleInfo?g_multi_pog_json[o].ModuleInfo.length:null,g_scene_children:g_scene?g_scene.children.length:null,g_world_children:g_world?g_world.children.length:null}),g_pog_index=o,render(o),animate_pog(o)}if(removeLoadingIndicator(regionloadWait),Array.isArray(g_multi_pog_json)&&g_multi_pog_json.length>0?g_pog_json=g_multi_pog_json:(console.warn("g_multi_pog_json is empty after restore; falling back to TEMP_POG"),g_pog_json=e),null!==sessionStorage.getItem("gPogIndex")){var _=parseInt(sessionStorage.getItem("gPogIndex"));g_pog_index=_,set_select_canvas(_),render(_),animate_pog(_)}}}catch(e){error_handling(e)}finally{window._pog_restore_in_progress=!1}}())),g_pogcr_live_new_item=$v("P193_POGCR_LIVE_NEW_ITEM"),g_pogcr_dflt_fixel_num=$v("P193_POGCR_DFLT_FIXEL_NUM"),g_default_max_merch=$v("P193_POGCR_DFT_MAX_MERCH");var i=g_pogcr_dflt_fixel_num.split(";");$s("P193_TEXTBOX_START_WITH",i[0]),$s("P193_DIVIDER_START_WITH",i[1]),document.documentElement.style.setProperty("--product_list_blink_color",g_select_item_color_change.replace("0x","#")),g_product_list_blink=$v("P193_PRODUCT_LIST_BLINK"),g_multi_cnvs_drag_conf=$v("P193_MULTI_CNVS_DRAG_CNFRM"),g_item_stack_valid=$v("P193_POGCR_ITEM_STACK_VALID_YN"),g_wf_pog_approval_enabled=$v("P193_WF_POG_APPROVAL_ENABLED"),g_pogcr_pog_approval_for_new_pog=$v("P193_POGCR_POG_APPROVAL_FOR_NEW_POG"),g_pogcr_enbl_oos_border=$v("P193_POGCR_ENBL_OOS_BORDER"),g_pogcr_oos_border_color=$v("P193_POGCR_OOS_BORDER_COLOR"),g_pogcr_enhance_textbox_fontsize=$v("P193_POGCR_ENHANCE_TEXTBOX_FONTSIZE"),g_item_vertical_text_display=$v("P193_ITEM_CODE_VERT_ALN"),g_item_text_center_align=$v("P193_ITEM_CODE_CTR_ALN"),apex.actions.add({name:"open-DPOG",label:"Open Draft POG",action:function(e,o,_){g_open_from="O",open_draft()},shortcut:"Alt+O,D"}),apex.actions.add({name:"open-EPOG",label:"Open Existing POG",action:function(e,o,_){g_open_from="O",open_pog()},shortcut:"Alt+O,E"}),apex.actions.add({name:"show-changes",label:"Show Changes",action:function(e,o,_){if("Y"==g_compare_pog_flag&&"POG"==g_compare_view&&g_ComViewIndex>-1)return void raise_error("POG already open.");g_show_live_image="N",g_show_live_image_1="N",g_compare_pog_flag="Y",g_curr_canvas=2;let t="undefined"!=typeof g_pog_json&&g_pog_json.length>0&&void 0!==g_pog_json[g_pog_index]?g_pog_json[g_pog_index]:null,n=t&&t.POGCode?t.POGCode:$v("P193_OPEN_POG_CODE"),g=t&&t.Version?t.Version:$v("P193_OPEN_POG_VERSION"),a=1,i=n;("Y"==$v("P193_OPEN_DRAFT")||t&&"N"==t.Opened)&&""!==$v("P193_EXISTING_DRAFT_VER")&&(a=2,i=$v("P193_EXISTING_DRAFT_VER")),""!==n&&""!==g||""!==i?comparePOG(a,n,g,i,"N","Y",g_show_changes_block_snapshot):raise_error("Please open a POG before Show Changes.")}}),apex.actions.add({name:"view-analysis",label:"View Analysis",action:function(){open_view_analysis()}}),apex.actions.add({name:"pog-save",label:"Save",action:function(e,o,_){g_open_from="O",save_af_version()}});document.getElementById("t_Header"),document.getElementById("t_Body_title"),document.getElementById("top_bar"),document.getElementById("t_Body_nav"),document.getElementById("side_bar");var r=window.devicePixelRatio;g_start_pixel_ratio=r}async function appendMultiCanvasRowCol(e,o=$v("P193_POGCR_TILE_VIEW"),_="N",t){console.log("dynamic rows cols"),"function"==typeof bindSplitterResizeSync&&bindSplitterResizeSync(),"H"==o?($(".viewH").addClass("view_active"),$(".viewV").removeClass("view_active")):($(".viewV").addClass("view_active"),$(".viewH").removeClass("view_active")),g_windowHeight=window.innerHeight-167,$("#canvas-holder .container").css("height",g_windowHeight+"px");var n=$("#canvas-holder .container").height(),g=$("#canvas-holder .container").width();console.log("appendMultiCanvasRowCol: p_pog_count=",e,"p_type=",o,"containerH=",n,"containerW=",g);var a,i=1,r=1,s="Y",l=0,d=e,f=0,c=[];$("[data-col]").each((function(){var e=$(this)[0];c.push(e)})),e<=3?(s="N",a=e,r=e):4==e?(s="N",a=2,r=2,i=2):5==e||6==e||9==e?(r=3,i=Math.ceil(e/r)):7==e||8==e||10==e||11==e||12==e||16==e?(r=4,i=Math.ceil(e/r)):13==e||14==e||15==e||17==e||18==e||19==e||20==e?(r=5,i=Math.ceil(e/r)):(r=5,i=5),$("#canvas-holder .container").html(""),"H"==o?$("#canvas-holder .container").addClass("h-view").removeClass("v-view"):$("#canvas-holder .container").addClass("v-view").removeClass("h-view");for(var I=1;I<=i;I++){if($("#canvas-holder .container").append('<div class="row" data-row="'+I+'"></div>'),"Y"==s)d%(i-I+1)>0?a=r:(a=d/(i-I+1),s="N"),d-=a;for(var p=1;p<=a;p++){var m=0==l?"":l+1,u="maincanvas"+m;if("Y"==_)if(t==l-1){$("[data-row="+I+"]").append('<div class="canvas-content" id="'+u+'-container" data-col="'+p+'" style="height:'+parseFloat((n/i).toFixed(2))+"px;width:"+parseFloat((g/a).toFixed(2))+'px"><div class="canvas-buttons" id="'+u+'-btns" ><span class="fa fa-close canvas-close" onClick="closePog('+l+')"></span><span class="fa fa-window-maximize canvas-max" onClick="maximizePog('+l+')"></span><span class="fa fa-minus canvas-min" onClick="minimizePog('+l+')"></span></div><canvas class="canvasregion" data-canvas=true id="'+u+'" ></canvas></div>'),f=1;try{(O=document.getElementById(u))&&(O.setAttribute("data-indx",l),-1===g_canvas_objects.indexOf(O)&&g_canvas_objects.push(O))}catch(e){}}else{var h=c[l-f];$(h).attr("id",u+"-container"),$("[data-row="+I+"]").append(h);var S=$(h).attr("id");$("[data-row="+I+"] #"+S).css("height",parseFloat((n/i).toFixed(2))).css("width",parseFloat((g/a).toFixed(2))).attr("data-col",p),$("[data-row="+I+"] #"+S+" .canvas-buttons").attr("id",u+"-btns"),$("[data-row="+I+"] #"+S+" .canvasregion").attr("id",u);try{(O=document.getElementById(u))&&(O.setAttribute("data-indx",l),-1===g_canvas_objects.indexOf(O)&&g_canvas_objects.push(O))}catch(e){}}else{var v="";e>1&&(v='<div class="canvas-buttons" id="maincanvas'+m+'-btns" ><span class="fa fa-close canvas-close" onClick="closePog('+l+')"></span></div>'),$("[data-row="+I+"]").append('<div class="canvas-content" id="maincanvas'+m+'-container" data-col="'+p+'" style="height:'+parseFloat((n/i).toFixed(2))+"px;width:"+parseFloat((g/a).toFixed(2))+'px">'+v+'<canvas class="canvasregion" data-canvas=true id="maincanvas'+m+'" ></canvas></div>');try{var O;(O=document.getElementById(u))&&(O.setAttribute("data-indx",l),-1===g_canvas_objects.indexOf(O)&&g_canvas_objects.push(O))}catch(e){}}l++}}if("Y"==_){var x=0;for(I=1;I<=g_pog_json.length;I++)if(2!==I){const e=g_renderer,o=(g_scene_objects[I-1-x].scene,g_scene_objects[I-1-x].scene.children.find((e=>"PerspectiveCamera"===e.type)));u="maincanvas"+(1==I?"":I);var D=$("#"+u).parent().height(),b=$("#"+u).parent().width(),j=D-$("#"+u+"-btns")[0].offsetHeight,M=Math.tan(Math.PI/180*o.fov/2);o.aspect=b/j,o.fov=360/Math.PI*Math.atan(M),o.updateProjectionMatrix(),e.setSize(b,j),render(I)}else 2==I&&(x=1)}makeResizableRow()}function init(e){logDebug("function : init","S");try{var o="maincanvas";(e=parseInt(e))>0&&(o="maincanvas"+(e+1)),g_canvas=document.getElementById(o),g_canvas.setAttribute("data-indx",e),$("#"+o).droppable({tolerance:"pointer",drop:function(e,o){create_action(o.helper.children(),e),$("#draggable_table .a-GV-w-scroll tr.selected").removeClass("selected")}}),g_canvas_region=document.getElementById("drawing_region"),g_selection=document.getElementById("selection"),g_canvas_objects.push(g_canvas),g_canvas.addEventListener("mousewheel",onDocumentMouseWheel,!1)}catch(e){return void(document.getElementById("canvas-holder").innerHTML="<p><b>Sorry, an error occurred:<br>"+e+"</b></p>")}createWorld(),console.log("scene",g_scene.uuid,g_scene),g_raycaster=new THREE.Raycaster,g_multiselect="N",g_ctrl_select="N";var _=document.getElementById("t_Header"),t=document.getElementById("t_Body_title"),n=document.getElementById("top_bar"),g=document.getElementById("t_Body_nav"),a=document.getElementById("wpdSplitter_splitter_first"),i=document.querySelector(".wtbar"),r=window.devicePixelRatio;g_start_pixel_ratio=r;var s=_.offsetHeight*r,l=(t.offsetHeight,n.offsetHeight*r),d=i.offsetHeight*r,f=g.offsetWidth*r,c=a.offsetWidth*r;g_selection.style.visibility="hidden",setUpMouseHander("maincanvas",doMouseDown,doMouseMove,doMouseUp,doMouseDoubleclick,g_canvas),g_tanFOV=Math.tan(Math.PI/180*g_camera.fov/2),g_windowHeight=window.innerHeight-(s+l+d),windowWidth=window.innerWidth-(f+c),g_initial_windowHeight=window.innerHeight-(s+l+d);var I=document.getElementById("drawing_region").offsetWidth*r,p=$("#"+o).parent()[0].offsetHeight,m=$("#"+o).parent()[0].offsetWidth;console.log("canvasContainerH",p,"canvasContainerW",m);var u=$("#"+o+"-btns")[0],h=0==typeof m?m:I,S=p-(void 0!==u?u.offsetHeight:0);$("#"+o).css("height",S+"px !important").css("width",h+"px !important"),g_canvas.width=h,g_canvas.height=S,g_camera.aspect=h/S;try{console.log("init: canvas set size ->",h,S,"camera.aspect=",g_camera.aspect)}catch(e){}g_camera.fov=360/Math.PI*Math.atan(g_tanFOV),g_camera.updateProjectionMatrix(),g_renderer.setSize(h,S),g_cut_support_obj_arr=[],loc_details={},g_cut_action_done="N",g_copy_action_done="N",g_delete_action_done="N",g_multi_delete_done="N",g_dup_action_done="N",g_multi_copy_done="N",g_curr_canvas=1,$(".peg_holes").addClass("peg_hole_acive"),window.addEventListener("resize",onWindowResize,!1),"Y"!=$v("P193_DELETE_IND")&&"Y"!=$v("P193_EDIT_IND")||window.addEventListener("contextmenu",onContextMenu,!1),window.addEventListener("click",(function(e){"button-plus"!==$(e.target).attr("class")&&"button-minus"!==$(e.target).attr("class")&&"quantity-field"!==$(e.target).attr("class")&&(document.getElementById("context-menu").classList.remove("active"),g_context_opened="N"),logo_clicked="N",void 0!==$(e.target).attr("id")?$(e.target).attr("id").startsWith("CUSTOM_COLOR")||$("#co-color-list").slideUp("fast",(function(){$("#co-color-list").css("display","none"),openChooseColor=!1})):"t-Icon fa fa-eyedropper"==$(e.target).attr("class")?console.log(" else if ",$(e.target).attr("class")):$("#co-color-list").slideUp("fast",(function(){$("#co-color-list").css("display","none"),openChooseColor=!1}))})),onWindowResize("F"),logDebug("function : init","E")}function clearUndoRedoInfo(){try{logDebug("function : clearUndoRedoInfo","S"),g_undo_final_obj_arr=[],g_redo_final_obj_arr=[],g_undo_all_obj_arr=[],g_redo_all_obj_arr=[],g_undo_details=[],g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_support_obj_arr=[],g_cut_loc_arr=[],g_cut_copy_arr=[],g_undoRedoAction="REDO",logDebug("function : clearUndoRedoInfo","E")}catch(e){error_handling(e)}}async function onWindowResize(e){logDebug("function : onWindowResize","S");try{var o=document.getElementById("t_Header"),_=document.getElementById("t_Body_title"),t=document.getElementById("top_bar"),n=document.getElementById("t_Body_nav"),g=document.getElementById("wpdSplitter_splitter_first"),a=document.querySelector(".wtbar"),i=window.devicePixelRatio,r=o.offsetHeight*i,s=_.offsetHeight*i,l=t.offsetHeight*i,d=n.offsetWidth*i,f=g.offsetWidth*i,c=(a.offsetHeight,parseFloat($(".t-Body-contentInner").css("padding-left").replace("px","")));i>2.5?(g_windowHeight=window.innerHeight-(r+s+l/2),windowWidth=window.innerWidth-(d+f+c)):(g_windowHeight=window.innerHeight-(r+s+l+l+10),windowWidth=window.innerWidth-(d+f+c+10)),g_tanFOV=Math.tan(Math.PI/180*g_camera.fov/2);i=window.devicePixelRatio;if(console.log(" resizing ",g_start_pixel_ratio,i),g_start_pixel_ratio!==i){var I=JSON.parse(JSON.stringify(g_pog_json));g_pog_json=[],appendMultiCanvasRowCol(I.length,$v("P193_POGCR_TILE_VIEW")),g_pog_index=0,g_multi_pog_json=[],g_scene_objects=[],g_canvas_objects=[],addLoadingIndicator();for(var p=0;p<=I.length-1;p++){g_pog_index=p,init(p),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects);await create_module_from_json(I,sessionStorage.getItem("new_pog_ind"),"F",$v("P193_PRODUCT_BTN_CLICK"),sessionStorage.getItem("pog_opened"),"N","N","Y","Y","","N",g_scene_objects[p].scene.children[0],g_scene_objects[p].scene,g_pog_index,p);g_pog_index=p,render(p),animate_pog(p)}removeLoadingIndicator(regionloadWait),g_pog_json=g_multi_pog_json}g_renderer.render(g_scene,g_camera),logDebug("function : onWindowResize","E")}catch(e){error_handling(e)}}async function create_module_from_json(e,o,_,t,n,g,a,i,r,s,l,d,f,c,I,p="N",m="N",u=[]){try{if(load_orientation_json(),$("#LIVE_IMAGE").addClass("apex_disabled"),"Y"==$v("P193_POGCR_DFT_NOTCH_LABEL")&&(g_show_notch_label="Y"),"Y"==$v("P193_POGCR_DFT_FIXEL_LABEL")&&(g_show_fixel_label="Y"),"Y"==$v("P193_POGCR_SHOW_DFLT_ITEM_LOC")&&(g_show_item_label="Y"),console.log("create_module_from_json:start",{p_pog_index:c,g_canvas_objects_len:g_canvas_objects?g_canvas_objects.length:0,g_scene_objects_len:g_scene_objects?g_scene_objects.length:0,has_p_camera:void 0!==d,has_p_scene:void 0!==f}),console.log("value",e,o,_,t,n,i,r,$v("P193_VDATE"),$v("P193_POG_POG_DEFAULT_COLOR"),$v("P193_POG_MODULE_DEFAULT_COLOR"),s,!0,"N",null,$v("P193_POGCR_DFT_SPREAD_PRODUCT"),parseFloat($v("P193_PEGB_DFT_HORIZ_SPACING")),parseFloat($v("P193_PEGBOARD_DFT_VERT_SPACING")),parseFloat($v("P193_BASKET_DFT_WALL_THICKNESS")),parseFloat($v("P193_CHEST_DFT_WALL_THICKNESS")),$v("P193_POGCR_PEGB_MAX_ARRANGE"),$v("P193_POGCR_DEFAULT_WRAP_TEXT"),parseInt($v("P193_POGCR_TEXT_DEFAULT_SIZE")),$v("P193_POG_TEXTBOX_DEFAULT_COLOR"),$v("P193_POG_SHELF_DEFAULT_COLOR"),$v("P193_DIV_COLOR"),$v("P193_SLOT_DIVIDER"),$v("P193_SLOT_ORIENTATION"),$v("P193_DIVIDER_FIXED"),$v("P193_POG_ITEM_DEFAULT_COLOR"),$v("P193_POGCR_DELIST_ITEM_DFT_COL"),g_peg_holes_active,$v("P193_POG_CP_SHELF_DFLT_COLOR"),3,$v("P193_MERCH_STYLE"),$v("P193_POGCR_LOAD_IMG_FROM"),$v("P193_BU_ID"),$v("P193_POGCR_DELIST_ITEM_DFT_COL"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_DISPLAY_ITEM_INFO"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_ITEM_NUM_LABEL_POS"),$v("P193_NOTCH_HEAD"),"N",$v("P193_POGCR_DFT_BASKET_FILL"),$v("P193_POGCR_DFT_BASKET_SPREAD"),d,c,I,$v("P193_POGCR_NOTCH_START_VALUE"),$v("P193_POGCR_MANUAL_CRUSH_ITEM"),"Y",""),console.log("create_module_from_json:start",c,{has_p_camera:!!d,p_camera_id:d&&d.uuid,has_p_scene:!!f,p_scene_children:f?f.children.length:null,global_scene_children:g_scene?g_scene.children.length:null,global_world_children:g_world?g_world.children.length:null,g_canvas_objects_len:g_canvas_objects?g_canvas_objects.length:null,g_scene_objects_len:g_scene_objects?g_scene_objects.length:null}),await create_module_from_json_lib(e,o,_,t,n,i,r,$v("P193_VDATE"),$v("P193_POG_POG_DEFAULT_COLOR"),$v("P193_POG_MODULE_DEFAULT_COLOR"),s,!0,"N",null,$v("P193_POGCR_DFT_SPREAD_PRODUCT"),parseFloat($v("P193_PEGB_DFT_HORIZ_SPACING")),parseFloat($v("P193_PEGBOARD_DFT_VERT_SPACING")),parseFloat($v("P193_BASKET_DFT_WALL_THICKNESS")),parseFloat($v("P193_CHEST_DFT_WALL_THICKNESS")),$v("P193_POGCR_PEGB_MAX_ARRANGE"),$v("P193_POGCR_DEFAULT_WRAP_TEXT"),parseInt($v("P193_POGCR_TEXT_DEFAULT_SIZE")),$v("P193_POG_TEXTBOX_DEFAULT_COLOR"),$v("P193_POG_SHELF_DEFAULT_COLOR"),$v("P193_DIV_COLOR"),$v("P193_SLOT_DIVIDER"),$v("P193_SLOT_ORIENTATION"),$v("P193_DIVIDER_FIXED"),$v("P193_POG_ITEM_DEFAULT_COLOR"),$v("P193_POGCR_DELIST_ITEM_DFT_COL"),g_peg_holes_active,$v("P193_POG_CP_SHELF_DFLT_COLOR"),3,$v("P193_MERCH_STYLE"),$v("P193_POGCR_LOAD_IMG_FROM"),$v("P193_BU_ID"),$v("P193_POGCR_DELIST_ITEM_DFT_COL"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_DISPLAY_ITEM_INFO"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_ITEM_NUM_LABEL_POS"),$v("P193_NOTCH_HEAD"),"N",$v("P193_POGCR_DFT_BASKET_FILL"),$v("P193_POGCR_DFT_BASKET_SPREAD"),d,c,I,$v("P193_POGCR_NOTCH_START_VALUE"),$v("P193_POGCR_MANUAL_CRUSH_ITEM"),"Y",""),console.log("create_module_from_json:done",{p_pog_index:c,g_pog_json_len:g_pog_json?g_pog_json.length:0}),g_pog_json[c].MassUpdate="N",$("#P193_POG_SUBDEPT").on("apexafterrefresh",(function(){void 0!==g_pog_json[c]&&apex.item(this).setValue(g_pog_json[c].SubDept)})),$("#P193_POG_DEPT").on("apexafterrefresh",(function(){void 0!==g_pog_json[c]&&apex.item(this).setValue(g_pog_json[c].Dept)})),apex.item("P193_POG_DIVISION").setValue(g_pog_json[c].Division),"Y"==i){if("undefined"!=typeof g_pog_json&&g_pog_json.length>0&&backupPog("F",-1,-1,c),"N"==g&&"Y"==a){var h="E"==n?"E":"D",S={SeqNo:"",POGCode:g_pog_json[c].POGCode,POGVersion:g_pog_json[c].Version,POGModule:"",Selection_Type:h,Print_Type:"P",SequenceId:"",TemplateId:$v("P193_PDF_TEMPLATE").split("-")[0],TemplateDetails:$v("P193_PDF_TEMPLATE")};create_pdf(S,l,"N",d,h,$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_ITEM_NUM_LABEL_POS"),$v("P193_POGCR_DISPLAY_ITEM_INFO"),$v("P193_NOTCH_HEAD"),"Y",c,"Y",g_all_pog_flag,$v("P193_MERCH_STYLE"),$v("P193_POGCR_LOAD_IMG_FROM"),$v("P193_BU_ID"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_ITEM_NUM_LABEL_POS"),$v("P193_POGCR_DISPLAY_ITEM_INFO"),$v("P193_POGCR_DELIST_ITEM_DFT_COL"),"","",g_hide_show_dos_label,"",$v("P193_POGCR_ENHANCE_PDF_IMG"),$v("P193_POGCR_PDF_IMG_ENHANCE_RATIO"),$v("P193_POGCR_PDF_CANVAS_SIZE"),$v("P193_VDATE"),$v("P193_POG_POG_DEFAULT_COLOR"),$v("P193_POG_MODULE_DEFAULT_COLOR"),$v("P193_POGCR_DFT_SPREAD_PRODUCT"),$v("P193_PEGB_DFT_HORIZ_SPACING"),$v("P193_PEGBOARD_DFT_VERT_SPACING"),$v("P193_BASKET_DFT_WALL_THICKNESS"),$v("P193_CHEST_DFT_WALL_THICKNESS"),$v("P193_POGCR_PEGB_MAX_ARRANGE"),$v("P193_POGCR_DEFAULT_WRAP_TEXT"),$v("P193_POGCR_TEXT_DEFAULT_SIZE"),$v("P193_POG_TEXTBOX_DEFAULT_COLOR"),$v("P193_POG_SHELF_DEFAULT_COLOR"),$v("P193_DIV_COLOR"),$v("P193_SLOT_DIVIDER"),$v("P193_SLOT_ORIENTATION"),$v("P193_DIVIDER_FIXED"),$v("P193_POG_ITEM_DEFAULT_COLOR"),$v("P193_POGCR_DFT_BASKET_FILL"),$v("P193_POGCR_DFT_BASKET_SPREAD"),$v("P193_POGCR_BAY_LIVE_IMAGE"),$v("P193_POGCR_BAY_WITHOUT_LIVE_IMAGE"),"N")}$(".live_image").css("color","white").css("cursor","pointer"),$(".open_pdf").css("color","black").css("cursor","pointer"),$(".open_pdf_online").css("color","black").css("cursor","pointer")}if(g_ItemImages.length>0&&"Y"==g_show_live_image&&"Y"==i)try{if($(".live_image").addClass("live_image_active"),"N"==a&&"N"==t&&"N"==$v("P193_POGCR_DFT_ITEM_DESC")&&"N"==p){await recreate_image_items("Y",$v("P193_MERCH_STYLE"),$v("P193_POGCR_LOAD_IMG_FROM"),$v("P193_BU_ID"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_ITEM_NUM_LABEL_POS"),$v("P193_POGCR_DISPLAY_ITEM_INFO"),$v("P193_POGCR_DELIST_ITEM_DFT_COL"),$v("P193_NOTCH_HEAD"),c,g_show_days_of_supply,$v("P193_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label);g_imagesShown="Y"}}catch(e){error_handling(e)}"N"==g_isPogItemsSet&&set_pog_page_items(c),"Y"==g_show_item_color?$(".item_color_legends").css("display","block"):$(".item_color_legends").css("display","none");var v=0;for(const e of g_pog_json[c].ModuleInfo){if(void 0===e.ParentModule||null==e.ParentModule){var O=0;for(const o of e.ShelfInfo){if("TEXTBOX"==o.ObjType){var x=g_world.getObjectById(g_pog_json[c].ModuleInfo[v].ShelfInfo[O].SObjID);void 0!==x&&(x.ShelfInfo=g_pog_json[c].ModuleInfo[v].ShelfInfo[O],textboxPriorityPlacing(x,c,g_pog_json[c].ModuleInfo[v].ShelfInfo[O].Z))}O++}}v++}}catch(e){error_handling(e)}return"SUCCESS"}function set_pog_page_items(e){try{logDebug("function : set_pog_page_items","S"),apex.item("P193_POG_WIDTH").setValue((100*g_pog_json[e].W).toFixed(2)),apex.item("P193_POG_DEPTH").setValue((100*g_pog_json[e].D).toFixed(2)),apex.item("P193_BACK_DEPTH").setValue((100*g_pog_json[e].BackDepth).toFixed(2)),"NaN"!==(100*g_pog_json[e].SegmentW).toFixed(2)&&apex.item("P193_POG_SEGMENT_WIDTH").setValue((100*g_pog_json[e].SegmentW).toFixed(2)),apex.item("P193_TRAFFIC_FLOW").setValue(g_pog_json[e].TrafficFlow),apex.item("P193_POG_BASE_HEIGHT").setValue((100*g_pog_json[e].BaseH).toFixed(2)),apex.item("P193_POG_BASE_WIDTH").setValue((100*g_pog_json[e].BaseW).toFixed(2)),apex.item("P193_POG_BASE_DEPTH").setValue((100*g_pog_json[e].BaseD).toFixed(2)),apex.item("P193_POG_NOTCH_WIDTH").setValue((100*g_pog_json[e].NotchW).toFixed(2)),apex.item("P193_POG_NOTCH_START").setValue((100*g_pog_json[e].NotchStart).toFixed(2)),apex.item("P193_POG_NOTCH_SPACING").setValue((100*g_pog_json[e].NotchSpacing).toFixed(2)),apex.item("P193_POG_COLOR").setValue(g_pog_json[e].Color),apex.item("P193_HORZ_START").setValue((100*g_pog_json[e].HorzStart).toFixed(2)),apex.item("P193_HORZ_SPACING").setValue((100*g_pog_json[e].HorzSpacing).toFixed(2)),apex.item("P193_POG_VERT_START").setValue((100*g_pog_json[e].VertStart).toFixed(2)),apex.item("P193_POG_VERT_SPACING").setValue((100*g_pog_json[e].VertSpacing).toFixed(2)),apex.item("P193_ALLOW_OVERLAP").setValue(g_pog_json[e].AllowOverlap),apex.item("P193_SPECIAL_TYPE").setValue(g_pog_json[e].SpecialType),apex.item("P193_SPECIAL_TYPE_DESC").setValue(g_pog_json[e].SpecialTypeDesc),apex.item("P193_DISPLAY_METERAGE").setValue(g_pog_json[e].DisplayMeterage),apex.item("P193_RPT_METERAGE").setValue(g_pog_json[e].RPTMeterage),apex.item("P193_EFF_START_DATE").setValue(g_pog_json[e].EffStartDate),apex.item("P193_BRAND_GROUP_ID").setValue(g_pog_json[e].BrandGroupID),apex.item("P193_REMARKS").setValue(g_pog_json[e].Remarks),apex.item("P193_STORE_SEGMENT").setValue(g_pog_json[e].StoreSegment),apex.item("P193_DESC_7").setValue(g_pog_json[e].Desc7),apex.item("P193_AREA").setValue(g_pog_json[e].Area),apex.item("P193_PLN_DEPT").setValue(g_pog_json[e].PLNDept),g_isPogItemsSet="Y",logDebug("function : set_pog_page_items","E")}catch(e){error_handling(e)}}async function create_shelf_edit_pog(e,o,_,t,n,g,a,i,r,s){logDebug("function : create_shelf_edit_pog; mod_index : "+e+"; p_module_width : "+_+"; draft_ind : "+t+"; new_pog_ind : "+n+"; pog_type : "+g+"; carpark_ind : "+a+"; recreate : "+i,"S");try{return create_shelf_edit_pog_lib(e,o,_,t,n,g,a,i,r,$v("P193_POGCR_DFT_SPREAD_PRODUCT"),$v("P193_POG_SHELF_DEFAULT_COLOR"),$v("P193_DIV_COLOR"),$v("P193_SLOT_DIVIDER"),$v("P193_SLOT_ORIENTATION"),$v("P193_DIVIDER_FIXED"),$v("P193_POG_ITEM_DEFAULT_COLOR"),$v("P193_POGCR_DELIST_ITEM_DFT_COL"),$v("P193_POG_CP_SHELF_DFLT_COLOR"),3,$v("P193_MERCH_STYLE"),$v("P193_POGCR_LOAD_IMG_FROM"),$v("P193_BU_ID"),$v("P193_POGCR_DELIST_ITEM_DFT_COL"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_DISPLAY_ITEM_INFO"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_ITEM_NUM_LABEL_POS"),$v("P193_NOTCH_HEAD"),"Y",g_camera,s,s,$v("P193_POGCR_MANUAL_CRUSH_ITEM"))}catch(e){error_handling(e)}}async function add_pog(e,o,_,t,n,g,a,i,r,s,l){logDebug("function : add_pog; uuid : "+e+"; width : "+o+"; height : "+_+"; depth : "+t+"; color : "+n+"; color_hex : "+g+"; x : "+a+"; y : "+i+"; p_edit_ind : "+r,"S");try{var d=[],f=0!=JSON.parse(sessionStorage.getItem("fixtureDimension")).length?JSON.parse(sessionStorage.getItem("fixtureDimension")):[{InnerDepth:1e3*t,InnerHeight:1e3*_,InnerWidth:1e3*o}],c=0;if("Y"==r){for(const e of g_pog_json[l].ModuleInfo){var I=g_world.getObjectById(e.MObjID);g_world.remove(I),c++}d=JSON.parse(g_temp_POG_arr),g_pog_json[l].ModuleInfo.splice(0),base_height=d[l].BaseH,d[l].ModuleInfo.sort(((e,o)=>e.Module>o.Module&&(null==e.ParentModule||null==o.ParentModule)?1:-1))}var p=[],m=g_pog_json[l].SegmentW,u=g_pog_json[l].SegmentW;if("A"==$v("P193_POG_MODULE_NAME_TYPE"))var h="A";else h=1;if("Y"==g_is_pog_template_open){var S=-1;for(c=0;c<f.length;c++){var v={};(D={}).SeqNo=c+1,D.Module=h,D.ParentModule=null,D.ParentModuleIndex="",D.POGModuleName="",D.SubDept=g_pog_json[l].SubDept,D.Remarks="",D.H=wpdSetFixed(parseFloat(f[c].InnerHeight/1e3)-g_pog_json[l].BaseH),D.W=wpdSetFixed(f[c].InnerWidth/1e3),D.D=wpdSetFixed(f[c].InnerDepth/1e3),D.Color=n,D.Rotation="",D.NotchW=g_pog_json[l].NotchW,D.NotchStart=g_pog_json[l].NotchStart,D.NotchSpacing=g_pog_json[l].NotchSpacing,D.HorzStart=g_pog_json[l].HorzStart,D.HorzSpacing=g_pog_json[l].HorzSpacing,D.VertStart=g_pog_json[l].VertStart,D.VertSpacing=g_pog_json[l].VertSpacing,D.AllowOverlap=g_pog_json[l].AllowOverlap,D.LNotch="",D.Backboard="",D.RNotch="",D.CompMObjID=void 0!==g_pog_json[l].ModuleInfo[c]?g_pog_json[l].ModuleInfo[c].CompMObjID:"",D.LastCount=0,D.EditFlag="Y",D.Carpark=[],D.ShelfInfo=[],D.ChestInfo=[],g_pog_json[l].ModuleInfo.push(D),g_pog_json[l].NotchW>0&&((v={}).Shelf=get_message("LEFT_NOTCH",h),v.ObjType="NOTCH",v.Desc="",v.MaxMerch=0,v.GrillH=0,v.LOverhang=0,v.ROverhang=0,v.SpacerThick=0,v.HorizGap=0,v.SpreadItem="L",v.Combine="N",v.AllowAutoCrush="N",v.H=D.H,v.W=g_pog_json[l].NotchW,v.D=D.D,v.Rotation=0,v.Slope=0,v.Color=n,v.LiveImage="",v.HorizSlotStart=0,v.HorizSlotSpacing=0,v.HorizStart=0,v.HorizSpacing=0,v.UOverHang=0,v.LoOverHang=0,v.VertiStart=0,v.VertiSpacing=0,v.X=a-D.W/2,v.Y=i,v.Z=0,v.InputText="",v.WrapText="",v.ReduceToFit="",v.TextDirection="",v.BsktFill="",v.BsktSpreadProduct="",v.SnapTo="",v.BsktWallH=0,v.BsktBaseH=0,v.BsktWallThickness=0,v.DSlotStart=0,v.DSlotSpacing=0,v.DGap=0,v.FrontOverHang=0,v.BackOverHang=0,v.SlotDivider="",v.AllowOverLap="N",v.AutoPlacing="N",v.AutoFillPeg="N",v.SlotOrientation="",v.DividerFixed="N",v.LObjID=-1,v.NotchLabelObjID=-1,v.FStyle="",v.FSize="",v.FBold="",v.TextImg="",v.TextImgName="",v.TextImgMime="",v.ItemInfo=[],v.Overhung="N",g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo.push(v),(v={}).Shelf=get_message("RIGHT_NOTCH",h),v.ObjType="NOTCH",v.Desc="",v.MaxMerch=0,v.GrillH=0,v.LOverhang=0,v.ROverhang=0,v.SpacerThick=0,v.HorizGap=0,v.SpreadItem="L",v.Combine="N",v.AllowAutoCrush="N",v.H=D.H,v.W=g_pog_json[l].NotchW,v.D=D.D,v.Rotation=0,v.Slope=0,v.Color=n,v.LiveImage="",v.HorizSlotStart=0,v.HorizSlotSpacing=0,v.HorizStart=0,v.HorizSpacing=0,v.UOverHang=0,v.LoOverHang=0,v.VertiStart=0,v.VertiSpacing=0,v.X=a+D.W/2-g_pog_json[l].NotchW,v.Y=i,v.Z=0,v.InputText="",v.WrapText="",v.ReduceToFit="",v.TextDirection="",v.BsktFill="",v.BsktSpreadProduct="",v.SnapTo="",v.BsktWallH=0,v.BsktBaseH=0,v.BsktWallThickness=0,v.DSlotStart=0,v.DSlotSpacing=0,v.DGap=0,v.FrontOverHang=0,v.BackOverHang=0,v.SlotDivider="",v.AllowOverLap="N",v.AutoPlacing="N",v.AutoFillPeg="N",v.SlotOrientation="",v.DividerFixed="N",v.LObjID=-1,v.NotchLabelObjID=-1,v.FStyle="",v.FSize="",v.FBold="",v.TextImg="",v.TextImgName="",v.TextImgMime="",v.ItemInfo=[],v.Overhung="N",g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo.push(v));await add_module(h,D.W,D.H,D.D,g,a,i,"N","Y",D.VertStart,D.VertSpacing,D.HorzStart,D.HorzSpacing,"Y",s,g_pog_json[l].ModuleInfo.length-1,l);if(g_pog_json[l].NotchW>0&&(g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo[g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo.length-2].X=g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].X-D.W/2,g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo[g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo.length-2].Y=g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].Y,g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo[g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo.length-1].X=g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].X+D.W/2-g_pog_json[l].NotchW,g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo[g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo.length-1].Y=g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].Y),"Y"==r&&void 0!==d[l].ModuleInfo[c]&&void 0!==d[l].ModuleInfo[c].ShelfInfo){var O=d[l].ModuleInfo,x=0;for(const e of O){if(void 0===e.ParentModule||null==e.ParentModule&&x>S){S=x,g_pog_json[l].ModuleInfo[c].SubDept=e.SubDept,g_pog_json[l].ModuleInfo[c].Remarks=e.Remarks;await create_shelf_edit_pog(c,d[l].ModuleInfo[x].ShelfInfo,e.W,"Y","Y","D","N","Y","Y",l,l);break}x+=1}}if("A"==$v("P193_POG_MODULE_NAME_TYPE"))h=nextLetter(h);else h=g_pog_json[l].ModuleInfo.length+1}}else if(g_pog_json[l].SegmentW==o){v={};(D={}).SeqNo=1,D.Module=h,D.ParentModule=null,D.ParentModuleIndex="",D.POGModuleName="",D.SubDept=g_pog_json[l].SubDept,D.Remarks="",D.H=parseFloat(_)-g_pog_json[l].BaseH,D.W=o,D.D=t,D.Color=n,D.Rotation="",D.NotchW=g_pog_json[l].NotchW,D.NotchStart=g_pog_json[l].NotchStart,D.NotchSpacing=g_pog_json[l].NotchSpacing,D.HorzStart=g_pog_json[l].HorzStart,D.HorzSpacing=g_pog_json[l].HorzSpacing,D.VertStart=g_pog_json[l].VertStart,D.VertSpacing=g_pog_json[l].VertSpacing,D.AllowOverlap=g_pog_json[l].AllowOverlap,D.LNotch="",D.Backboard="",D.RNotch="",D.LastCount=0,D.CompMObjID=void 0!==g_pog_json[l].ModuleInfo[0]?g_pog_json[l].ModuleInfo[0].CompMObjID:"",D.Carpark=[],D.EditFlag="Y",D.ShelfInfo=[],D.ChestInfo=[],g_pog_json[l].ModuleInfo.push(D),g_pog_json[l].NotchW>0&&((v={}).Shelf=get_message("LEFT_NOTCH",h),v.ObjType="NOTCH",v.Desc="",v.MaxMerch=0,v.GrillH=0,v.LOverhang=0,v.ROverhang=0,v.SpacerThick=0,v.HorizGap=0,v.SpreadItem="L",v.Combine="N",v.AllowAutoCrush="N",v.H=D.H,v.W=g_pog_json[l].NotchW,v.D=t,v.Rotation=0,v.Slope=0,v.Color=n,v.LiveImage="",v.HorizSlotStart=0,v.HorizSlotSpacing=0,v.HorizStart=0,v.HorizSpacing=0,v.UOverHang=0,v.LoOverHang=0,v.VertiStart=0,v.VertiSpacing=0,v.X=a-D.W/2,v.Y=i,v.Z=0,v.InputText="",v.WrapText="",v.ReduceToFit="",v.TextDirection="",v.BsktFill="",v.BsktSpreadProduct="",v.SnapTo="",v.BsktWallH=0,v.BsktBaseH=0,v.BsktWallThickness=0,v.DSlotStart=0,v.DSlotSpacing=0,v.DGap=0,v.FrontOverHang=0,v.BackOverHang=0,v.SlotDivider="",v.AllowOverLap="N",v.AutoPlacing="N",v.AutoFillPeg="N",v.SlotOrientation="",v.DividerFixed="N",v.LObjID=-1,v.NotchLabelObjID=-1,v.ItemInfo=[],v.FStyle="",v.FSize="",v.FBold="",v.TextImg="",v.TextImgName="",v.TextImgMime="",v.Overhung="N",g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo.push(v),(v={}).Shelf=get_message("RIGHT_NOTCH",h),v.ObjType="NOTCH",v.Desc="",v.MaxMerch=0,v.GrillH=0,v.LOverhang=0,v.ROverhang=0,v.SpacerThick=0,v.HorizGap=0,v.SpreadItem="L",v.Combine="N",v.AllowAutoCrush="N",v.H=D.H,v.W=g_pog_json[l].NotchW,v.D=t,v.Rotation=0,v.Slope=0,v.Color=n,v.LiveImage="",v.HorizSlotStart=0,v.HorizSlotSpacing=0,v.HorizStart=0,v.HorizSpacing=0,v.UOverHang=0,v.LoOverHang=0,v.VertiStart=0,v.VertiSpacing=0,v.X=a+D.W/2-g_pog_json[l].NotchW,v.Y=i,v.Z=0,v.InputText="",v.WrapText="",v.ReduceToFit="",v.TextDirection="",v.BsktFill="",v.BsktSpreadProduct="",v.SnapTo="",v.BsktWallH=0,v.BsktBaseH=0,v.BsktWallThickness=0,v.DSlotStart=0,v.DSlotSpacing=0,v.DGap=0,v.FrontOverHang=0,v.BackOverHang=0,v.SlotDivider="",v.AllowOverLap="N",v.AutoPlacing="N",v.AutoFillPeg="N",v.SlotOrientation="",v.DividerFixed="N",v.LObjID=-1,v.NotchLabelObjID=-1,v.ItemInfo=[],v.FStyle="",v.FSize="",v.FBold="",v.TextImg="",v.TextImgName="",v.TextImgMime="",v.Overhung="N",g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo.push(v));await add_module($v("P193_POG_MODULE"),o,D.H,t,g,a,i,"N","Y",D.VertStart,D.VertSpacing,D.HorzStart,D.HorzSpacing,"Y",s,g_pog_json[l].ModuleInfo.length-1,l);if(g_pog_json[l].NotchW>0&&(g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo[g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo.length-2].X=g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].X-D.W/2,g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo[g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo.length-2].Y=g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].Y,g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo[g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo.length-1].X=g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].X+g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].W/2-g_pog_json[l].NotchW,g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo[g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo.length-1].Y=g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].Y),"Y"==r&&void 0!==d[l].ModuleInfo&&void 0!==d[g_pog_json[l].ModuleInfo.length-1].ModuleInfo[0].ShelfInfo){O=d[l].ModuleInfo,c=0;for(const e of O){if(void 0===e.ParentModule||null==e.ParentModule){if(g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].SubDept=e.SubDept,g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].Remarks=e.Remarks,void 0!==e.Carpark&&e.Carpark.length>0)await create_shelf_edit_pog(0,d[l].ModuleInfo[c].Carpark,o,"Y","Y","D","Y","Y","Y",l,l);await create_shelf_edit_pog(0,d[l].ModuleInfo[c].ShelfInfo,o,"Y","Y","D","N","Y","Y",l,l);break}c+=1}}}else{p.push(m);for(c=0;c<1e3&&wpdSetFixed(u+=m)<=wpdSetFixed(o);c++)p.push(parseFloat(m));S=-1;for(c=0;c<p.length;c++){v={};(D={}).SeqNo=c+1,D.Module=h,D.ParentModule=null,D.ParentModuleIndex="",D.POGModuleName="",D.SubDept=g_pog_json[l].SubDept,D.Remarks="",D.H=parseFloat(_)-g_pog_json[l].BaseH,D.W=p[c],D.D=t,D.Color=n,D.Rotation="",D.NotchW=g_pog_json[l].NotchW,D.NotchStart=g_pog_json[l].NotchStart,D.NotchSpacing=g_pog_json[l].NotchSpacing,D.HorzStart=g_pog_json[l].HorzStart,D.HorzSpacing=g_pog_json[l].HorzSpacing,D.VertStart=g_pog_json[l].VertStart,D.VertSpacing=g_pog_json[l].VertSpacing,D.AllowOverlap=g_pog_json[l].AllowOverlap,D.LNotch="",D.Backboard="",D.RNotch="",D.CompMObjID=void 0!==g_pog_json[l].ModuleInfo[c]?g_pog_json[l].ModuleInfo[c].CompMObjID:"",D.LastCount=0,D.EditFlag="Y",D.Carpark=[],D.ShelfInfo=[],D.ChestInfo=[],g_pog_json[l].ModuleInfo.push(D),g_pog_json[l].NotchW>0&&((v={}).Shelf=get_message("LEFT_NOTCH",h),v.ObjType="NOTCH",v.Desc="",v.MaxMerch=0,v.GrillH=0,v.LOverhang=0,v.ROverhang=0,v.SpacerThick=0,v.HorizGap=0,v.SpreadItem="L",v.Combine="N",v.AllowAutoCrush="N",v.H=D.H,v.W=g_pog_json[l].NotchW,v.D=t,v.Rotation=0,v.Slope=0,v.Color=n,v.LiveImage="",v.HorizSlotStart=0,v.HorizSlotSpacing=0,v.HorizStart=0,v.HorizSpacing=0,v.UOverHang=0,v.LoOverHang=0,v.VertiStart=0,v.VertiSpacing=0,v.X=a-D.W/2,v.Y=i,v.Z=0,v.InputText="",v.WrapText="",v.ReduceToFit="",v.TextDirection="",v.BsktFill="",v.BsktSpreadProduct="",v.SnapTo="",v.BsktWallH=0,v.BsktBaseH=0,v.BsktWallThickness=0,v.DSlotStart=0,v.DSlotSpacing=0,v.DGap=0,v.FrontOverHang=0,v.BackOverHang=0,v.SlotDivider="",v.AllowOverLap="N",v.AutoPlacing="N",v.AutoFillPeg="N",v.SlotOrientation="",v.DividerFixed="N",v.LObjID=-1,v.NotchLabelObjID=-1,v.FStyle="",v.FSize="",v.FBold="",v.TextImg="",v.TextImgName="",v.TextImgMime="",v.ItemInfo=[],v.Overhung="N",g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo.push(v),(v={}).Shelf=get_message("RIGHT_NOTCH",h),v.ObjType="NOTCH",v.Desc="",v.MaxMerch=0,v.GrillH=0,v.LOverhang=0,v.ROverhang=0,v.SpacerThick=0,v.HorizGap=0,v.SpreadItem="L",v.Combine="N",v.AllowAutoCrush="N",v.H=D.H,v.W=g_pog_json[l].NotchW,v.D=t,v.Rotation=0,v.Slope=0,v.Color=n,v.LiveImage="",v.HorizSlotStart=0,v.HorizSlotSpacing=0,v.HorizStart=0,v.HorizSpacing=0,v.UOverHang=0,v.LoOverHang=0,v.VertiStart=0,v.VertiSpacing=0,v.X=a+D.W/2-g_pog_json[l].NotchW,v.Y=i,v.Z=0,v.InputText="",v.WrapText="",v.ReduceToFit="",v.TextDirection="",v.BsktFill="",v.BsktSpreadProduct="",v.SnapTo="",v.BsktWallH=0,v.BsktBaseH=0,v.BsktWallThickness=0,v.DSlotStart=0,v.DSlotSpacing=0,v.DGap=0,v.FrontOverHang=0,v.BackOverHang=0,v.SlotDivider="",v.AllowOverLap="N",v.AutoPlacing="N",v.AutoFillPeg="N",v.SlotOrientation="",v.DividerFixed="N",v.LObjID=-1,v.NotchLabelObjID=-1,v.FStyle="",v.FSize="",v.FBold="",v.TextImg="",v.TextImgName="",v.TextImgMime="",v.ItemInfo=[],v.Overhung="N",g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo.push(v));await add_module(h,p[c],D.H,t,g,a,i,"N","Y",D.VertStart,D.VertSpacing,D.HorzStart,D.HorzSpacing,"Y",s,g_pog_json[l].ModuleInfo.length-1,l);if(g_pog_json[l].NotchW>0&&(g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo[g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo.length-2].X=g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].X-p[c]/2,g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo[g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo.length-2].Y=g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].Y,g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo[g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo.length-1].X=g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].X+p[c]/2-g_pog_json[l].NotchW,g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo[g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].ShelfInfo.length-1].Y=g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].Y),"Y"==r&&void 0!==d[l].ModuleInfo[c]&&void 0!==d[l].ModuleInfo[c].ShelfInfo){O=d[l].ModuleInfo,x=0;for(const e of O){if(void 0===e.ParentModule||null==e.ParentModule&&x>S){if(S=x,g_pog_json[l].ModuleInfo[c].SubDept=e.SubDept,g_pog_json[l].ModuleInfo[c].Remarks=e.Remarks,void 0!==e.Carpark&&e.Carpark.length>0)await create_shelf_edit_pog(c,d[l].ModuleInfo[c].Carpark,o,"Y","Y","D","Y","Y","Y",l,l);await create_shelf_edit_pog(c,d[l].ModuleInfo[x].ShelfInfo,p[c],"Y","Y","D","N","Y","Y",l,l);break}x+=1}}if("A"==$v("P193_POG_MODULE_NAME_TYPE"))h=nextLetter(h);else h=g_pog_json[l].ModuleInfo.length+1}}if("Y"==r){c=0;for(const e of d[l].ModuleInfo){var D;if(null!==e.ParentModule&&"undefined"!==e.ParentModule)(D={SeqNo:0}).Module=e.Module,D.ParentModule=e.ParentModule,D.ParentModuleIndex=e.ParentModuleIndex,D.POGModuleName=e.ModuleName,D.SubDept=e.SubDept,D.Remarks=e.Remarks,D.H=e.H,D.W=e.W,D.D=e.D,D.Color=e.Color,D.Rotation=e.Rotation,D.NotchW=e.NotchW,D.NotchStart=e.NotchStart,D.NotchSpacing=e.NotchSpacing,D.HorzStart=e.HorzStart,D.HorzSpacing=e.HorzSpacing,D.VertStart=e.VertStart,D.VertSpacing=e.VertSpacing,D.AllowOverlap=e.AllowOverlap,D.LNotch=e.LNotch,D.Backboard=e.Backboard,D.RNotch=e.RNotch,D.LastCount=0,D.ShelfInfo=e.ShelfInfo,g_pog_json[l].ModuleInfo.push(D);c++}}module_arr=g_pog_json[l].ModuleInfo,module_info_arr=g_pog_json[l].ModuleInfo;c=0;for(const e of module_arr)if(null!==e.ParentModule&&"undefined"!==e.ParentModule){x=0;for(const o of module_info_arr)e.ParentModule==o.Module&&(g_pog_json[l].ModuleInfo[c].ParentModuleIndex=x),x++;c++}add_pog_code_header();var b=get_min_max_xy(l).split("###");set_camera_z(s,parseFloat(b[2]),parseFloat(b[3]),parseFloat(b[0]),parseFloat(b[1]),g_offset_z,parseFloat(b[4]),parseFloat(b[5]),!0,l),render(l),logDebug("function : add_pog","E")}catch(e){error_handling(e)}}function add_pog_base(e,o,_,t,n,g,a,i,r){logDebug("function : add_pog_base; uuid : "+e+"; width : "+o+"; height : "+_+"; depth : "+t+"; color : "+n+"; x : "+g+"; y : "+a+"; p_edit_ind : "+i,"S");try{if("Y"==i){var s=g_scene_objects[r].scene.children[2].getObjectById(g_pog_json[r].BaseObjID);g_scene_objects[r].scene.children[2].remove(s)}g_pog_base=new THREE.Mesh(new THREE.BoxGeometry(o,_,.001),new THREE.MeshStandardMaterial({color:n}));var l=add_wireframe(g_pog_base,2);g_pog_base.position.x=g,g_pog_base.position.y=a,g_pog_base.position.z=0,g_pog_base.uuid=e,g_scene_objects[r].scene.children[2].add(g_pog_base),g_pog_json[r].BaseObjID=g_pog_base.id,g_pog_json[r].BaseX=g,g_pog_json[r].BaseY=a,g_pog_json[r].BaseZ=0,g_pog_json[r].WFrameID=l,logDebug("function : add_pog_base","E")}catch(e){error_handling(e)}}async function add_module(e,o,_,t,n,g,a,i,r,s,l,d,f,c,I,p){try{var m;return logDebug("function : add_module; uuid : "+e+"; width : "+o+"; height : "+_+"; depth : "+t+"; color : "+n+"; x : "+g+"; y : "+a+"; p_edit_ind : "+i+"; pog_flag : "+r+"; vert_start : "+s+"; vert_spacing : "+l+"; horz_start : "+d+"; horz_spacing : "+f+"; recreate : "+c+"; module_ind : "+p,"S"),m=await add_module_lib(e,o,_,t,n,g,a,i,r,s,l,d,f,c,I,p,$v("P193_POGCR_DFT_SPREAD_PRODUCT"),parseFloat($v("P193_PEGB_DFT_HORIZ_SPACING")),parseFloat($v("P193_PEGBOARD_DFT_VERT_SPACING")),parseFloat($v("P193_BASKET_DFT_WALL_THICKNESS")),parseFloat($v("P193_CHEST_DFT_WALL_THICKNESS")),$v("P193_POGCR_PEGB_MAX_ARRANGE"),$v("P193_POGCR_DEFAULT_WRAP_TEXT"),parseInt($v("P193_POGCR_TEXT_DEFAULT_SIZE")),$v("P193_POG_TEXTBOX_DEFAULT_COLOR"),$v("P193_POG_SHELF_DEFAULT_COLOR"),$v("P193_DIV_COLOR"),$v("P193_SLOT_DIVIDER"),$v("P193_SLOT_ORIENTATION"),$("P193_DIVIDER_FIXED"),$v("P193_POG_ITEM_DEFAULT_COLOR"),$v("P193_POGCR_DELIST_ITEM_DFT_COL"),g_peg_holes_active,$v("P193_POG_CP_SHELF_DFLT_COLOR"),3,$v("P193_MERCH_STYLE"),$v("P193_POGCR_LOAD_IMG_FROM"),$v("P193_BU_ID"),$v("P193_POGCR_DELIST_ITEM_DFT_COL"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_DISPLAY_ITEM_INFO"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_ITEM_NUM_LABEL_POS"),$v("P193_NOTCH_HEAD"),"Y",g_pog_index,$v("P193_POGCR_DFT_BASKET_FILL"),$v("P193_POGCR_DFT_BASKET_SPREAD"),$v("P193_POGCR_MANUAL_CRUSH_ITEM")),$s("P193_MODULE_EDIT_IND","N"),m}catch(e){error_handling(e)}}function clear_search_fields(){logDebug("function : clear_search_fields","S"),$s("P193_ITEM",""),$s("P193_SUPP_NAME",""),$s("P193_SUPPLIER_CODE",""),$s("P193_MAIN_BRAND",""),$s("P193_ITEM_DESCRIPTION",""),$s("P193_DESCRIPTION_SEC",""),$s("P193_GROUP",""),$s("P193_DEPARTMENT",""),$s("P193_ITEM_BRAND",""),$s("P193_ITEM_WITHOUT_DIM","N"),$s("P193_USED_ITEM","A"),$s("P193_CLASS",""),$s("P193_SUB_CLASS",""),logDebug("function : clear_search_fields","E")}function get_select_dim(e){logDebug("function : get_select_dim","S");var o=select_height=select_depth=0;return"0"==e.MerchStyle?(o=e.OrgUW>0?e.OrgUW:e.W,select_height=e.OrgUH>0?e.OrgUH:e.H,select_depth=e.OrgUD>0?e.OrgUD:e.D):"1"==e.MerchStyle?(o=e.OrgTW>0?e.OrgTW:e.W,select_height=e.OrgTH>0?e.OrgTH:e.W,select_depth=e.OrgTD>0?e.OrgTD:e.W):"2"==e.MerchStyle?(o=e.OrgCW>0?e.OrgCW:e.W,select_height=e.OrgCH>0?e.OrgCH:e.W,select_depth=e.OrgCD>0?e.OrgCD:e.W):"3"==e.MerchStyle&&(o=e.OrgDW>0?e.OrgDW:e.W,select_height=e.OrgDH>0?e.OrgDH:e.W,select_depth=e.OrgDD>0?e.OrgDD:e.W),logDebug("function : get_select_dim","E"),[o,select_height,select_depth]}function check_dim_difference(e,o,_,t){logDebug("function : check_dim_difference; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+_,"S");var n=g_pog_json[t].ModuleInfo[e].ShelfInfo[o].ItemInfo[_],g="N";return("0"!=n.MerchStyle||wpdSetFixed(n.UW||0)===wpdSetFixed(n.OrgUW||0)&&wpdSetFixed(n.UH||0)===wpdSetFixed(n.OrgUH||0)&&wpdSetFixed(n.UD||0)===wpdSetFixed(n.OrgUD||0))&&("1"!=n.MerchStyle||wpdSetFixed(n.TW||0)===wpdSetFixed(n.OrgTW||0)&&wpdSetFixed(n.TH||0)===wpdSetFixed(n.OrgTH||0)&&wpdSetFixed(n.TD||0)===wpdSetFixed(n.OrgTD||0))&&("2"!=n.MerchStyle||wpdSetFixed(n.CW||0)===wpdSetFixed(n.OrgCW||0)&&wpdSetFixed(n.CH||0)===wpdSetFixed(n.OrgCH||0)&&wpdSetFixed(n.CD||0)===wpdSetFixed(n.OrgCD||0))&&("3"!=n.MerchStyle||wpdSetFixed(n.DW||0)===wpdSetFixed(n.OrgDW||0)&&wpdSetFixed(n.DH||0)===wpdSetFixed(n.OrgDH||0)&&wpdSetFixed(n.DD||0)===wpdSetFixed(n.OrgDD||0))||(g="Y"),wpdSetFixed(n.NW||0)===wpdSetFixed(n.OrgNW||0)&&wpdSetFixed(n.NH||0)===wpdSetFixed(n.OrgNH||0)&&wpdSetFixed(n.ND||0)===wpdSetFixed(n.OrgND||0)||(g="Y"),wpdSetFixed(n.CWPerc||0)===wpdSetFixed(n.OrgCWPerc||0)&&wpdSetFixed(n.CHPerc||0)===wpdSetFixed(n.OrgCHPerc||0)&&wpdSetFixed(n.CDPerc||0)===wpdSetFixed(n.OrgCDPerc||0)||(g="Y"),wpdSetFixed(n.CnW||0)===wpdSetFixed(n.OrgCnW||0)&&wpdSetFixed(n.CnH||0)===wpdSetFixed(n.OrgCnH||0)&&wpdSetFixed(n.CnD||0)===wpdSetFixed(n.OrgCnD||0)||(g="Y"),logDebug("function : check_dim_difference","E"),"Y"==g}async function org_dim_update_shelf(e,o,_,t,n,g,a){var i=0,r="N",s=g_pog_json[a].ModuleInfo[e].ShelfInfo[o];""!==t.ItemNesting&&("W"==t.ItemNesting?i=t.OrgNW:"H"==t.ItemNesting?i=t.OrgNH:"D"==t.ItemNesting&&(i=t.OrgND));var[l,d,f]=get_select_dim(t);if(t.WChanged="N",t.HChanged="N",t.DChanged="N",l>0)var[c,I,p,m,u,h]=set_dim_validate_item(e,o,_,l,d,f,t.ItemNesting,i,t.BHoriz,t.BVert,t.BaseD,t.Orientation,t.OrgCWPerc,t.OrgCHPerc,t.OrgCDPerc,"N","Y","N",a);else var c=t.W,I=t.H,p=t.D,m=t.RW,u=t.RH,h=t.RD,l=t.OW,d=t.OH,f=t.OD;if("ERROR"!==c){r="Y",g_pog_json[a].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].DimUpdate="Y",g_pog_json[a].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OW=l,g_pog_json[a].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OH=d,g_pog_json[a].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OD=f,update_item_org_dim(e,o,_,c,I,p,m,u,h,a);var[S,v]=get_item_xy(s,t,c,I,a);"BASKET"==g_pog_json[a].ModuleInfo[e].ShelfInfo[o].ObjType&&"DIVIDER"==g_pog_json[a].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].Item?console.log("Divider"):g_pog_json[a].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].Y=v}if("Y"!=r){var O=g_scene_objects[a].scene.children[2].getObjectById(t.ObjID);O.WireframeObj.material.color.setHex(g_dim_error_color),g_pog_json[a].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].DimUpdate="E",O.DimUpdate="E",O.BorderColour=g_dim_error_color}return logDebug("function : after  color  "+n,"E"),r}async function org_dim_update_items(e,o,_,t,n,g){logDebug("function : org_dim_update_items; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+_+"; item_code : "+t+"; exclude_item : "+n,"S");try{var a=0,i="Y",r=g_pog_json[g].ModuleInfo;for(const _ of r){if(void 0===_.ParentModule||null==_.ParentModule){var s=_.ShelfInfo,l=0;for(const _ of s){if("BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType&&"TEXTBOX"!==_.ObjType&&_.ItemInfo.length>0){var d=_.ItemInfo,f=0,c="Y",I="N";for(const r of d){if(a==e&&l==o&&"Y"==n&&(c="N"),"DIVIDER"!==r.Item&&r.Item==t){"Y";var p=0;""!==r.ItemNesting&&("W"==r.ItemNesting?p=r.OrgNW:"H"==r.ItemNesting?p=r.OrgNH:"D"==r.ItemNesting&&(p=r.OrgND));var[m,u,h]=get_select_dim(r);if(r.WChanged="N",r.HChanged="N",r.DChanged="N",m>0)var[S,v,O,x,D,b]=set_dim_validate_item(a,l,f,m,u,h,r.ItemNesting,p,r.BHoriz,r.BVert,r.BaseD,r.Orientation,r.OrgCWPerc,r.OrgCHPerc,r.OrgCDPerc,"N","Y","N",g);else var S=r.W,v=r.H,O=r.D,x=r.RW,D=r.RH,b=r.RD,m=r.OW,u=r.OH,h=r.OD;if("ERROR"!==S){I="Y",g_pog_json[g].ModuleInfo[a].ShelfInfo[l].ItemInfo[f].DimUpdate="Y",g_pog_json[g].ModuleInfo[a].ShelfInfo[l].ItemInfo[f].OW=m,g_pog_json[g].ModuleInfo[a].ShelfInfo[l].ItemInfo[f].OH=u,g_pog_json[g].ModuleInfo[a].ShelfInfo[l].ItemInfo[f].OD=h,update_item_org_dim(a,l,f,S,v,O,x,D,b,g);var[j,M]=get_item_xy(_,r,S,v,g);g_pog_json[g].ModuleInfo[a].ShelfInfo[l].ItemInfo[f].Y=M}else{var E=g_world.getObjectById(r.ObjID);E.WireframeObj.material.color.setHex(g_dim_error_color),g_pog_json[g].ModuleInfo[a].ShelfInfo[l].ItemInfo[f].DimUpdate="E",E.DimUpdate="E",E.BorderColour=g_dim_error_color,i="N"}}f+=1}if("Y"==c&&"Y"==I&&reorder_items(a,l,g))await recreate_all_items(a,l,_.ObjType,"Y",-1,-1,_.ItemInfo.length,"Y","N",-1,-1,g_start_canvas,"N",g,$v("P193_POGCR_DELIST_ITEM_DFT_COL"),$v("P193_MERCH_STYLE"),$v("P193_POGCR_LOAD_IMG_FROM"),$v("P193_BU_ID"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_ITEM_NUM_LABEL_POS"),$v("P193_POGCR_DISPLAY_ITEM_INFO"),"Y")}l+=1}}a+=1}return render(g),logDebug("function : org_dim_update_items","E"),i}catch(e){error_handling(e)}}function update_item_org_dim(e,o,_,t,n,g,a,i,r,s){logDebug("function : update_item_org_dim; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+_+"; item_width : "+t+"; item_height : "+n+"; item_depth : "+g+"; real_width : "+a+"; real_height : "+i+"; real_depth : "+r,"S"),g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].UW=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgUW,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].UH=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgUH,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].UD=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgUD,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].CW=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgCW,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].CH=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgCH,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].CD=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgCD,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].TW=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgTW,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].TH=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgTH,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].TD=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgTD,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].DW=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgDW,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].DH=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgDH,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].DD=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgDD,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].CWPerc=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgCWPerc,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].CHPerc=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgCHPerc,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].CDPerc=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgCDPerc,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].NW=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgNW,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].NH=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgNH,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].ND=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgND,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].CnW=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgCnW,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].CnH=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgCnH,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].CnD=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgCnD,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OldNW=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgNW,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OldNH=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgNH,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OldND=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgND,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OldCnW=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgCnW,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OldCnH=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgCnH,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OldCnD=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].OrgCnD,t>0&&n>0&&(g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].W=t,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].H=n,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].D=g,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].RW=a,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].RH=i,g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[_].RD=r),logDebug("function : update_item_org_dim","E")}function update_carpark_item_values(e,o,_){logDebug("function : update_carpark_item_values; p_module_index : "+e+"; i_item_index : "+o,"S");var t=null!==sessionStorage.getItem("items_details")?JSON.parse(sessionStorage.getItem("items_details")):{},n=g_pog_json[_].ModuleInfo[e].Carpark[0].ItemInfo[o];return n.W=t.OrgUW,n.RW=t.RW,n.OW=t.RW,n.UW=t.UW,n.H=t.OrgUH,n.RH=t.RH,n.OH=t.OH,n.UH=t.UH,n.D=t.OrgUD,n.RD=t.RD,n.OD=t.OD,n.UD=t.UD,n.Color=t.Color,n.PegID=t.PegID,n.LocID=t.LocID,n.PegSpread=t.PegSpread,n.PegPerFacing=t.PegPerFacing,n.BsktFactor=t.BsktFactor,n.OverHang=t.OverHang,n.HorizGap=t.HorizGap,n.VertGap=t.VertGap,n.Price=t.Price,n.Cost=t.Cost,n.RegMovement=t.RegMovement,n.AvgSales=t.AvgSales,n.ItemStatus=t.ItemStatus,n.CDTLvl1=t.CDTLvl1,n.CDTLvl2=t.CDTLvl2,n.CDTLvl3=t.CDTLvl3,n.StoreCnt=t.StoreCnt,n.WeeksOfInventory=t.WeeksOfInventory,n.MoveBasis=t.MoveBasis,n.Orientation=t.Orientation,n.OrientationDesc=t.OrientationDesc,n.ItemCondition=t.ItemCondition,n.AUR=t.AUR,n.ItemRanking=t.ItemRanking,n.WeeklySales=t.WeeklySales,n.WeeklyNetMargin=t.WeeklyNetMargin,n.WeeklyQty=t.WeeklyQty,n.NetMarginPercent=t.NetMarginPercent,n.CumulativeNM=t.CumulativeNM,n.TOP80B2=t.TOP80B2,n.ItemBrandC=t.ItemBrandC,n.ItemPOGDept=t.ItemPOGDept,n.ItemRemark=t.ItemRemark,n.RTVStatus=t.RTVStatus,n.Pusher=t.Pusher,n.Divider=t.Divider,n.BackSupport=t.BackSupport,n.OOSPerc=t.OOSPerc,ItemsInfo.InitialItemDesc=t.InitialItemDesc,ItemsInfo.InitialBrand=t.InitialBrand,ItemsInfo.InitialBarcode=t.InitialBarcode,g_pog_json[_].ModuleInfo[e].Carpark[0].ItemInfo[o]=n,logDebug("function : update_carpark_item_values","E"),"SUCCESS"}async function edit_carpark_items(e,o){logDebug("function : edit_carpark_items; i_item_index : "+e,"S");g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[e];var _=parseFloat($v("P193_ITEM_WIDTH"))/100,t=g_pog_json[o].ModuleInfo[g_module_index].Carpark[0],n=0;for(const d of t.ItemInfo){if(n!==e){var[g,a,i,r,s,l]=get_new_orientation_dim(g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].Orientation,d.W,d.H,d.D);_+=g}n++}if(_>t.W)return alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",t.Shelf)),logDebug("function : edit_carpark_items"),!1;update_carpark_item_values(g_module_index,e,o),n=0;for(const _ of g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo){var d=g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].Orientation;if(e==n)var[g,a,i,r,s,l]=get_new_orientation_dim(d,_.W,_.H,_.D);else g=_.W,a=_.H,i=_.D;g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].W=g,g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].H=a,g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].D=i,g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].RW=g,g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].RH=a,g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].RD=i,g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].X=0==n?t.X-t.W/2+g/2:g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n-1].X+g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n-1].W/2+g/2,g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].Y=t.Y+t.H/2+a/2;var f=g_scene_objects[o].scene.children[2].getObjectById(_.ObjID);g_scene_objects[o].scene.children[2].remove(f);var c=g_orientation_json[_.Orientation].split("###"),I=await add_carpark_item(_.ItemID,_.W,_.H,_.D,_.Color,_.X,_.Y,_.Z,g_module_index,0,n,"Y","N",g_show_live_image,parseInt(c[1]),o);g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].ObjID=I,n+=1}return render(o),animate_all_pog(),g_dblclick_opened="N",$s("P193_ITEM_EDIT_IND","N"),logDebug("function : edit_carpark_items","E"),!0}function set_dim_change_values(e,o,_){try{logDebug("function : set_dim_change_values dim_details: "+e+"item_code: "+o,"S");var t=g_pog_json[_].ModuleInfo,n=0;if("N"==g_carpark_item_flag)for(const s of t){if(void 0===s.ParentModule||null==s.ParentModule){var g=s.ShelfInfo,a=0;for(const t of g){if("BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&"TEXTBOX"!==t.ObjType&&t.ItemInfo.length>0){var i=t.ItemInfo,r=0;for(const t of i)"DIVIDER"!==t.Item&&t.Item==o&&(g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].OrgUW=e.U[0],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].OrgUH=e.U[1],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].OrgUD=e.U[2],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].OrgTW=e.T[0],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].OrgTH=e.T[1],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].OrgTD=e.T[2],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].OrgDW=e.D[0],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].OrgDH=e.D[1],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].OrgDD=e.D[2],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].OrgCW=e.C[0],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].OrgCH=e.C[1],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].OrgCD=e.C[2],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].OrgCWPerc=e.R[0],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].OrgCHPerc=e.R[1],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].OrgCDPerc=e.R[2],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].OrgCnW=e.O[0],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].OrgCnH=e.O[1],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].OrgCnD=e.O[2],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].OrgNW=e.N[0],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].OrgNH=e.N[1],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].OrgND=e.N[2],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].CnW=e.O[0],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].CnH=e.O[1],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].CnD=e.O[2],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].NW=e.N[0],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].NH=e.N[1],g_pog_json[_].ModuleInfo[n].ShelfInfo[a].ItemInfo[r].ND=e.N[2]),r+=1}a+=1}}n+=1}else{n=0;for(const g of t){if((void 0===g.ParentModule||null==g.ParentModule)&&void 0!==g.Carpark[0]){var s=g.Carpark[0].ItemInfo;a=0;for(const t of s)t.Item==o&&(g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].OrgUW=e.U[0],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].OrgUH=e.U[1],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].OrgUD=e.U[2],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].OrgTW=e.T[0],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].OrgTH=e.T[1],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].OrgTD=e.T[2],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].OrgDW=e.D[0],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].OrgDH=e.D[1],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].OrgDD=e.D[2],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].OrgCW=e.C[0],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].OrgCH=e.C[1],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].OrgCD=e.C[2],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].OrgCWPerc=e.R[0],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].OrgCHPerc=e.R[1],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].OrgCDPerc=e.R[2],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].OrgCnW=e.O[0],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].OrgCnH=e.O[1],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].OrgCnD=e.O[2],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].OrgNW=e.N[0],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].OrgNH=e.N[1],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].OrgND=e.N[2],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].CnW=e.O[0],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].CnH=e.O[1],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].CnD=e.O[2],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].NW=e.N[0],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].NH=e.N[1],g_pog_json[_].ModuleInfo[n].Carpark[0].ItemInfo[a].ND=e.N[2]),a+=1}n+=1}}logDebug("function : set_dim_change_values","E")}catch(e){error_handling(e)}}async function get_edit_item_img(e,o,_,t,n,g,a){facing_edit="N";var i=-1,r="N",s=t.Item,l=g_orientation_json[n].split("###"),d=0;for(const e of g_ItemImages){if(s==e.Item&&l[0]==e.Orientation&&g==e.MerchStyle){i=d;break}d++}var f=g_pog_json[a].ModuleInfo;for(modules of f){if("Y"==r)break;if((void 0===modules.ParentModule||null==modules.ParentModule)&&modules.ShelfInfo.length>0){d=0;for(const e of modules.ShelfInfo){if("Y"==r)break;if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){for(const o of e.ItemInfo){if(o.Orientation==l[0]&&o.Item==s&&t.ObjID!==o.ObjID){r="Y";break}0}}d++}}0}if(ItemImageInfo={},-1!==i&&"N"==r)await call_ajax(e,o,_,l[0],i,s,g,parseFloat($v("P193_POGCR_IMG_MAX_WIDTH")),parseFloat($v("P193_POGCR_IMG_MAX_HEIGHT")),parseFloat($v("P193_IMAGE_COMPRESS_RATIO")));else{ItemImageInfo.Item=t.Item,ItemImageInfo.MIndex=e,ItemImageInfo.SIndex=o,ItemImageInfo.IIndex=_,ItemImageInfo.Orientation=l[0],ItemImageInfo.MerchStyle=g,ItemImageInfo.ItemImage=null,g_ItemImages.push(ItemImageInfo);await call_ajax(e,o,_,l[0],g_ItemImages.length-1,s,g,parseFloat($v("P193_POGCR_IMG_MAX_WIDTH")),parseFloat($v("P193_POGCR_IMG_MAX_HEIGHT")),parseFloat($v("P193_IMAGE_COMPRESS_RATIO")))}}function get_spread_gap(e,o,_){logDebug("function : get_spread_gap; spread_product : "+e+"; p_module_index : "+o+"; p_shelf_index : "+_,"S");var t=g_pog_json[p_pog_index].ModuleInfo[o].ShelfInfo[_],n=t.HorizGap,g=(e=t.SpreadItem,0),a=0,i=0,r=[],s=0;if(n>0)a=n;else if("E"==e){for(const e of t.ItemInfo)g+=e.W,i+=1,t.ItemInfo[s].W=t.ItemInfo[s].OW*e.BHoriz,s++;a=(t.W+t.LOverhang+t.ROverhang-g)/(i-1)}else if("F"==e){r=t.ItemInfo,s=0;for(const e of r)g+=e.OW*e.BHoriz,i+=e.BHoriz,s++;a=(t.W+t.LOverhang+t.ROverhang-g)/(i-1);s=0;for(const e of r)e.BHoriz>1&&(t.ItemInfo[s].W=t.ItemInfo[s].OW*e.BHoriz+a*(e.BHoriz-1)),s++}return logDebug("function : get_spread_gap","E"),a}async function recreate_multi_items(e,o,_,t,n,g,a,i,r,s,l){logDebug("function : recreate_multi_items; p_module_index : "+e+"; p_shelf_index : "+o+"; shelf_obj_type : "+_+"; p_edit_ind : "+t+"; locationX : "+n+"; edit_item_index : "+g+"; item_length : "+a+"; shelf_edit : "+r,"S");try{var d=g_pog_json[l].ModuleInfo[e].ShelfInfo[o],f=d.HorizGap,c=f,I=d.SpreadItem,p=(d.Combine,d.Rotation,d.X-d.W/2),m=d.Y-d.H/2,u=[],h=0;if(void 0!==s)u=s;else u=d.ItemInfo;var S=u.length,v=0;for(const e of u){var O=g_world.getObjectById(e.ObjID);g_world.remove(O),e.W,v++}if("SHELF"==_&&(d.AvlSpace=wpdSetFixed(d.W+d.LOverhang+d.ROverhang)),render(l),"R"==I)for(v=(u=d.ItemInfo).length-1;v>=0;v--){if(S-=1,h=get_item_xaxis(u[v].W,u[v].H,u[v].D,_,n,c,I,f,e,o,S,t,d.ItemInfo.length,r,l),"DIVIDER"==u[v].Item){var x=g_pog_json[l].ModuleInfo[e].ShelfInfo,D=-1,b=0;for(const e of x)e.Shelf==u[v].ItemID&&"DIVIDER"==e.ObjType&&(D=b),b++;g_pog_json[l].ModuleInfo[e].ShelfInfo[D].X=h}d.ItemInfo[S].Distance=h-u[v].W/2-p,"PEGBOARD"==d.ObjType&&(d.ItemInfo[S].PegBoardX=h-u[v].W/2-p,d.ItemInfo[S].PegBoardY=d.ItemInfo[S].Y-u[v].H/2-m,d.ItemInfo[S].FromProductList="N"),d.ItemInfo[S].OldObjID=u[v].ObjID;var j=u[v].ObjID;if("Y"==g_show_live_image&&"DIVIDER"!==u[v].Item)var M=g_orientation_json[d.ItemInfo[S].Orientation].split("###"),E=await add_items_with_image(u[v].ItemID,u[v].W,u[v].H,u[v].D,u[v].Color,h,u[v].Y,"",e,o,v,u[v].BHoriz,u[v].BVert,u[v].Item,parseInt(M[0]),parseInt(M[1]),"N",i,$v("P193_MERCH_STYLE"),$v("P193_POGCR_LOAD_IMG_FROM"),$v("P193_BU_ID"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_ITEM_NUM_LABEL_POS"),$v("P193_POGCR_DISPLAY_ITEM_INFO"),l);else if("DIVIDER"==u[v].Item)E=add_items(u[v].ItemID,u[v].W,u[v].H,u[v].D,u[v].Color,h,u[v].Y,"",e,o,v,u[v].Rotation,l);else E=await add_items_prom(u[v].ItemID,u[v].W,u[v].H,u[v].D,u[v].Color,h,u[v].Y,"",e,o,v,"N",i,$v("P193_POGCR_DELIST_ITEM_DFT_COL"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_DISPLAY_ITEM_INFO"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_ITEM_NUM_LABEL_POS"),l);if("E"==u[v].DimUpdate)(O=g_world.getObjectById(E)).WireframeObj.material.color.setHex(16711680);var P=0;if(P="PEGBOARD"==d.ObjType?d.Z+d.D/2+u[v].D/2:.001+d.D/1e3,d.ItemInfo[v].X=h,d.ItemInfo[v].Z=P,d.ItemInfo[v].ObjID=E,d.ItemInfo[v].CType=d.ObjType,void 0!==u[v].TopObjID&&""!==u[v].TopObjID||void 0!==u[v].BottomObjID&&""!==u[v].BottomObjID){C=""!==u[v].TopObjID&&void 0!==u[v].TopObjID?"BOTTOM":"TOP";reset_top_bottom_obj_id(C,j,E,h,"N",l)}"DIVIDER"==u[v].Item&&(g_pog_json[l].ModuleInfo[e].ShelfInfo[D].ShelfDivObjID=E)}else{v=0,u=d.ItemInfo;for(const g of u){if(h=get_item_xaxis(g.W,g.H,g.D,_,n,c,I,f,e,o,v,t,d.ItemInfo.length,r,l),"DIVIDER"==g.Item){x=g_pog_json[l].ModuleInfo[e].ShelfInfo,D=-1,b=0;for(const e of x)e.Shelf==g.ItemID&&"DIVIDER"==e.ObjType&&(D=b),b++;g_pog_json[l].ModuleInfo[e].ShelfInfo[D].X=h}d.ItemInfo[v].Distance=h-g.W/2-p,"PEGBOARD"==d.ObjType&&(d.ItemInfo[v].PegBoardX=h-g.W/2-p,d.ItemInfo[v].PegBoardY=d.ItemInfo[v].Y-g.H/2-m,d.ItemInfo[v].FromProductList="N"),d.ItemInfo[v].OldObjID=g.ObjID;j=g.ObjID;if("Y"==g_show_live_image&&"DIVIDER"!==g.Item)M=g_orientation_json[d.ItemInfo[v].Orientation].split("###"),E=await add_items_with_image(g.ItemID,g.W,g.H,g.D,g.Color,h,d.ItemInfo[v].Y,"",e,o,v,g.BHoriz,g.BVert,g.Item,parseInt(M[0]),parseInt(M[1]),"N",i,$v("P193_MERCH_STYLE"),$v("P193_POGCR_LOAD_IMG_FROM"),$v("P193_BU_ID"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_ITEM_NUM_LABEL_POS"),$v("P193_POGCR_DISPLAY_ITEM_INFO"),l);else if("DIVIDER"==g.Item)E=add_items(g.ItemID,g.W,g.H,g.D,g.Color,h,g.Y,"",e,o,v,g.Rotation,l);else E=await add_items_prom(g.ItemID,g.W,g.H,g.D,g.Color,h,d.ItemInfo[v].Y,"",e,o,v,"N",i,$v("P193_POGCR_DELIST_ITEM_DFT_COL"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_DISPLAY_ITEM_INFO"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_ITEM_NUM_LABEL_POS"),l);if("E"==g.DimUpdate)(O=g_world.getObjectById(E)).WireframeObj.material.color.setHex(16711680);if(P="PEGBOARD"==d.ObjType?d.Z+d.D/2+g.D/2:.001+d.D/1e3,d.ItemInfo[v].X=h,d.ItemInfo[v].Z=P,d.ItemInfo[v].ObjID=E,d.ItemInfo[v].CType=d.ObjType,void 0!==g.TopObjID&&""!==g.TopObjID||void 0!==g.BottomObjID&&""!==g.BottomObjID){C=""!==g.TopObjID&&void 0!==g.TopObjID?"BOTTOM":"TOP";reset_top_bottom_obj_id(C,j,E,h,"N",l)}"DIVIDER"==g.Item&&(g_pog_json[l].ModuleInfo[e].ShelfInfo[D].ShelfDivObjID=E),v+=1}}!async function(){await update_undo_redo_objID(g_pog_json)}();u=d.ItemInfo;v=0;for(const e of u){if(void 0!==e.TopObjID&&""!==e.TopObjID||void 0!==e.BottomObjID&&""!==e.BottomObjID){var C;C=""!==e.TopObjID&&void 0!==e.TopObjID?"BOTTOM":"TOP";reset_top_bottom_obj_id(C,e.OldObjID,e.ObjID,e.X,"Y",l)}v+=1}if("SHELF"==d.ObjType||"PALLET"==d.ObjType)reset_top_bottom_objects(e,o,"N",l);return render(l),g_item_edit_flag="",g_item_index="",logDebug("function : recreate_multi_items","E"),h}catch(e){error_handling(e)}}function get_max_merch(e,o,_,t,n,g){logDebug("function : get_max_merch; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+_+"; p_edit_ind : "+t+"; locationX : "+n,"S");try{var a=0,i=0,r=0,s=0,l=g_pog_json[g].ModuleInfo[e].ShelfInfo[o],d=l.ObjType,f=l.Rotation,c=l.Slope;if(-1!==_)var I=wpdSetFixed(l.D-l.ItemInfo[_].RD/l.ItemInfo[_].BaseD);else I=wpdSetFixed(l.D+2);if(0!==f||0!==c)var p=wpdSetFixed(l.X-l.ShelfRotateWidth/2),m=wpdSetFixed(l.X+l.ShelfRotateWidth/2);else p=wpdSetFixed(l.X-l.W/2),m=wpdSetFixed(l.X+l.W/2);0!==l.MaxMerch&&"HANGINGBAR"!==d&&(r=l.MaxMerch);var u=wpdSetFixed(l.Y+l.H/2),h=[];a=0;if("CHEST"!=d&&"BASKET"!=d||(i=l.BsktWallH),-1!==_&&-1!==n)var S=wpdSetFixed(n-l.ItemInfo[_].W/2),v=wpdSetFixed(n+l.ItemInfo[_].W/2);if(g_pog_json[g].ModuleInfo[e].ShelfInfo.length>1){if("PEGBOARD"==d)h.push(l.H+l.LOverhang);else if("HANGINGBAR"==d){u=l.Y;var O=0;for(const _ of g_pog_json[g].ModuleInfo[e].ShelfInfo){if(0!==_.Rotation||0!==_.Slope)var x=wpdSetFixed(_.X+_.ShelfRotateWidth/2),D=wpdSetFixed(_.X-_.ShelfRotateWidth/2);else x=wpdSetFixed(_.X+_.W/2),D=wpdSetFixed(_.X-_.W/2);"BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType&&"TEXTBOX"!==_.ObjType&&((S>=D&&S<x||v<=x&&v>D)&&-1!==n||-1==n)&&o!==O&&_.Y+_.H/2<u&&(x>p&&D<=p||D<m&&D>=p)&&(0!==_.Rotation||0!==_.Slope?h.push(wpdSetFixed(u-(_.Y+_.ShelfRotateHeight))):h.push(wpdSetFixed(u-(_.Y+_.H/2)))),O++}}else{O=0;for(const _ of g_pog_json[g].ModuleInfo[e].ShelfInfo){if("BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType&&"TEXTBOX"!==_.ObjType){if(0!==_.Rotation||0!==_.Slope)x=wpdSetFixed(_.X+_.ShelfRotateWidth/2),D=wpdSetFixed(_.X-_.ShelfRotateWidth/2);else x=wpdSetFixed(_.X+_.W/2),D=wpdSetFixed(_.X-_.W/2);((S>=D&&S<x||v<=x&&v>D)&&-1!==n||-1==n)&&o!==O&&_.Y-_.H/2>=u&&(x>p&&D<=p||D<m&&D>=p)&&_.D>I&&(0!==_.Rotation||0!==_.Slope?h.push(wpdSetFixed(_.Y-_.ShelfRotateHeight/2-u)):h.push(wpdSetFixed(_.Y-_.H/2-u)))}O++}}a=0==h.length?g_pog_json[g].ModuleInfo[e].H+g_pog_json[g].BaseH-u+5:Math.min.apply(Math,h)}else a=g_pog_json[g].ModuleInfo[e].H-u+5;if("CHEST"==d||"BASKET"==d){var b=g_pog_json[g].ModuleInfo[e].ShelfInfo[o].ItemInfo,j=g_pog_json[g].ModuleInfo[e].ShelfInfo[o].Y+g_pog_json[g].ModuleInfo[e].ShelfInfo[o].H/2,M=0,E="N";for(var P of b)"DIVIDER"==P.Item&&(M=P.Y-P.H/2-j,E="Y");s=a<i&&i>0||0==i?a:i,"Y"==E&&M>0&&(s=M)}else s=a<r&&r>0||0==r?a:r;return logDebug("function : get_max_merch; p_module_index","E"),wpdSetFixed(s)}catch(e){error_handling(e)}}function validate_shelf_min_distance(e,o,_,t,n,g,a,i,r,s,l="N"){logDebug("function : validate_shelf_min_distance; curr_module : "+e+"; p_shelf_index : "+o+"; shelf_y : "+_+"; allow_crush : "+n+"; p_module_index : "+g+"; shelf_x : "+a+"; alert_ind : "+i,"S");try{var d=r.ObjType,f=r.Rotation,c=r.Slope,I=r.H,p=r.W,m=r.SObjID;if(0!==f||0!==c){var u=wpdSetFixed(a-r.ShelfRotateWidth/2),h=wpdSetFixed(a+r.ShelfRotateWidth/2),S=wpdSetFixed(_+r.ShelfRotateHeight/2),v=wpdSetFixed(_-r.ShelfRotateHeight/2);p=r.ShelfRotateWidth,I=r.ShelfRotateHeight}else u=wpdSetFixed(a-r.W/2),h=wpdSetFixed(a+r.W/2),S=wpdSetFixed(_+r.H/2),v=wpdSetFixed(_-r.H/2);var O=0,x=0,D="Y",b=[],j=[],M=[],E=[],P=[],C=[],N=[],T="N",y="N",R=0,w=[],[F,Y]=getCombinationShelf(s,r.Shelf);-1!==F&&-1!==Y&&(w=g_combinedShelfs[F]);var H="N";if("Y"==$v("P193_POGCR_DRAG_SHELF_IN_PEGBOARD")&&"SHELF"==r.ObjType){var L=g_pog_json[s].ModuleInfo[e].ShelfInfo,A=0,B="Y";for(const e of L){if("PEGBOARD"==e.ObjType&&"SHELF"==d){var k=wpdSetFixed(e.Y+e.H/2),G=wpdSetFixed(e.Y-e.H/2),W=wpdSetFixed(e.X-e.W/2),V=wpdSetFixed(e.X+e.W/2);if(k>=S&&v>=G&&u>=W&&V>=h){if(H="Y","Y"==(B=validate_shelf_inside_pegboard(g,o,s,a,_,e)))break}else D="N"}else if("PEGBOARD"==e.ObjType&&"PEGBOARD"==d){k=wpdSetFixed(e.Y+e.H/2),G=wpdSetFixed(e.Y-e.H/2),W=wpdSetFixed(e.X-e.W/2),V=wpdSetFixed(e.X+e.W/2);if(k>=S&&v>=G&&u>=W&&V>=h){H="Y",D="N",B="N";break}B="Y"}A++}"Y"==B?D="Y":(D="N",alert(get_message("ITEM_POSITION_OVERLAP",r.Shelf)))}else"Y"==$v("P193_POGCR_DRAG_SHELF_IN_PEGBOARD")&&"PEGBOARD"==r.ObjType?(D="Y",H="Y"):D="N";if("N"==H){for(const t of g_pog_json[s].ModuleInfo){if("Y"==y)break;if(null==t.ParentModule||"undefined"==t.ParentModule){var X=0;for(const n of t.ShelfInfo){if("Y"==y)break;if(void 0!==n&&"TEXTBOX"!==n.ObjType&&"BASE"!==n.ObjType&&"NOTCH"!==n.ObjType&&"DIVIDER"!==n.ObjType&&m!==n.SObjID&&"CHEST"!==n.ObjType&&(e==g&&X!==o||e!==g)){var U="N";if(w.length>1)for(A=0;A<w.length-1;A++)if(n.Shelf==w[A].Shelf){U="Y";break}if("N"==U)if("HANGINGBAR"==d&&"HANGINGBAR"==n.ObjType){if(n.ItemInfo.length>0){for(const e of n.ItemInfo){if("Y"==y)break;var z=wpdSetFixed(e.X-e.W/2),J=wpdSetFixed(e.X+e.W/2),K=wpdSetFixed(e.Y+e.H/2),Z=wpdSetFixed(e.Y-e.H/2);for(const e of r.ItemInfo){"BASKET"==r.ObjType&&"BT"==r.BsktSpreadProduct?(_e=a-r.W/2+e.W/2,te=e.Y):"HANGINGBAR"==r.ObjType?(_e=a-r.W/2+e.Distance+e.W/2,te=_-e.H/2):"PEGBOARD"==r.ObjType||"CHEST"==r.ObjType&&"Y"==g_chest_as_pegboard?(_e=a-r.W/2+e.PegBoardX+e.W/2,te=e.Y):(_e=a-r.W/2+e.Distance+e.W/2,te=_+r.H/2+e.H/2);var q=wpdSetFixed(_e-e.W/2),Q=wpdSetFixed(_e+e.W/2),ee=wpdSetFixed(te+e.H/2),oe=wpdSetFixed(te-e.H/2);if((q<J&&q>=z||Q>z&&Q<=J)&&(oe<K&&oe>=Z||ee<=K&&ee>Z)||(z<q&&J>q||z<Q&&J>=Q)&&K<=ee&&Z>=oe||(q<=z&&Q>=J||q>=z&&Q<=J)&&(ee>=K&&Z>=oe||ee>=K&&oe<=Z||ee>K&&oe<=K)||z<q&&J>=Q&&K<=ee&&K>oe&&Z<=oe||z>q&&J<=Q&&K>=ee&&Z<ee&&Z<=oe||z<q&&J>=Q&&K<=ee&&Z>=oe||z<q&&J>=Q&&K<ee&&K>oe||z>=q&&z<Q&&Z>=oe&&Z<ee){y="Y";break}0}0}}}else if(n.ItemInfo.length>0&&"DIVIDER"!==n.ObjType){for(const e of n.ItemInfo){if("Y"==y)break;z=wpdSetFixed(e.X-e.W/2),J=wpdSetFixed(e.X+e.W/2),K=wpdSetFixed(e.Y+e.H/2),Z=wpdSetFixed(e.Y-e.H/2);if(_<e.Y+e.H/2&&_>e.Y-e.H/2&&(u>z&&u<J||h>z&&h<J||z>u&&J<h)){y="Y";break}for(const e of r.ItemInfo){var _e,te;"BASKET"==r.ObjType&&"BT"==r.BsktSpreadProduct?(_e=a-r.W/2+e.W/2,te=e.Y):"HANGINGBAR"==r.ObjType?(_e=a-r.W/2+e.Distance+e.W/2,te=_-e.H/2):"PEGBOARD"==r.ObjType||"CHEST"==r.ObjType&&"Y"==g_chest_as_pegboard?(_e=a-r.W/2+e.PegBoardX+e.W/2,te=e.Y):(_e=a-r.W/2+e.Distance+e.W/2,te=_+r.H/2+e.H/2);q=wpdSetFixed(_e-e.W/2),Q=wpdSetFixed(_e+e.W/2),ee=wpdSetFixed(te+e.H/2),oe=wpdSetFixed(te-e.H/2);if((q<J&&q>=z||Q>z&&Q<=J)&&(oe<K&&oe>=Z||ee<=K&&ee>Z)||(z<q&&J>q||z<Q&&J>=Q)&&K<=ee&&Z>=oe||(q<=z&&Q>=J||q>=z&&Q<=J)&&(ee>=K&&Z>=oe||ee>=K&&oe<=Z||ee>K&&oe<=K)||z<q&&J>=Q&&K<=ee&&K>oe&&Z<=oe||z>q&&J<=Q&&K>=ee&&Z<ee&&Z<=oe||z<q&&J>=Q&&K<=ee&&Z>=oe||z<q&&J>=Q&&K<ee&&K>oe||z>=q&&z<Q&&Z>=oe&&Z<ee){y="Y";break}0}0}}}X++}}R++}if("Y"==y)return"N"!=l||"Y"!=g_overhung_shelf_active||"SHELF"!=d&&"HANGINGBAR"!=d||"Y"===g_overhung_validation?("Y"==i&&alert(get_message("LOST_FROM_SHELF_ERR_VERT",r.Shelf)),D="N"):(r.Overhung="Y",D="Y"),D;A=0;for(const t of g_pog_json[s].ModuleInfo[e].ShelfInfo){if("BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&"TEXTBOX"!==t.ObjType&&"CHEST"!==t.ObjType&&(e==g&&A!==o||e!==g)){if(0!==t.Rotation||0!==t.Slope)var ne=wpdSetFixed(t.X+t.ShelfRotateWidth/2),ge=wpdSetFixed(t.X-t.ShelfRotateWidth/2),ae=wpdSetFixed(t.ShelfRotateHeight),ie=wpdSetFixed(t.ShelfRotateWidth);else ne=wpdSetFixed(t.X+t.W/2),ge=wpdSetFixed(t.X-t.W/2),ae=wpdSetFixed(t.H),ie=wpdSetFixed(t.W);if(("SHELF"==d||"HANGINGBAR"==d)&&r.D==t.D&&isShelfOverlapShelf(a,_,p,I,t.X,t.Y,ie,ae))return"Y"==i&&alert(get_message("LOST_FROM_SHELF_ERR_VERT",r.Shelf)),"N";t.Y>=_&&"HANGINGBAR"!==d&&(ne>u&&ge<=u||ge<h&&ge>=u)?(b.push(wpdSetFixed(t.Y-ae/2-(_+I/2))),P.push(A)):t.Y<=_&&"HANGINGBAR"==d&&(ne>u&&ge<=u||ge<h&&ge>=u)&&(b.push(wpdSetFixed(_-I/2-(t.Y+ae/2))),P.push(A)),t.Y<=_&&"HANGINGBAR"!==d&&(ne>u&&ge<=u||ge<h&&ge>=u)?(j.push(wpdSetFixed(_-I/2-(t.Y+ae/2))),C.push(A)):t.Y>=_&&"HANGINGBAR"==d&&(ne>u&&ge<=u||ge<h&&ge>=u)&&(j.push(wpdSetFixed(t.Y-ae/2-(_+I/2))),C.push(A))}A++}if(j.length>0&&(x=Math.min.apply(Math,j)),0!==x){var re=j.findIndex((function(e){return e==x}));if("HANGINGBAR"!==d&&"PEGBOARD"!==g_pog_json[s].ModuleInfo[e].ShelfInfo[C[re]].ObjType&&"PEGBOARD"!==d&&"HANGINGBAR"!==g_pog_json[s].ModuleInfo[e].ShelfInfo[C[re]].ObjType&&"ROD"!==g_pog_json[s].ModuleInfo[e].ShelfInfo[C[re]].ObjType&&"CHEST"!==d){me=g_pog_json[s].ModuleInfo[e].ShelfInfo[C[re]].ItemInfo;A=0;for(const o of me){if(0!==g_pog_json[s].ModuleInfo[e].ShelfInfo[C[re]].Rotation||0!==g_pog_json[s].ModuleInfo[e].ShelfInfo[C[re]].Slope)var se=o.ItemRotateWorldX;else se=o.X;var le=0;if(void 0!==o.TopObjID&&""!==o.TopObjID){K=o.H;$.each(me,(function(e,_){wpdSetFixed(o.X)==wpdSetFixed(_.X)&&e!==A&&(K+=_.H)})),le=K}else le=o.H;le>x&&(h>wpdSetFixed(se-o.W/2)&&u<=wpdSetFixed(se-o.W/2)||u<wpdSetFixed(se+o.W/2)&&u>=wpdSetFixed(se-o.W/2))&&(M.push(wpdSetFixed(le)),E.push(A),(o.CrushVert>0||o.CHPerc>0)&&(T="Y")),A++}}else if("HANGINGBAR"==g_pog_json[s].ModuleInfo[e].ShelfInfo[C[re]].ObjType){me=g_pog_json[s].ModuleInfo[e].ShelfInfo[C[re]].ItemInfo;var de="N";A=0;for(const e of me){if(v>wpdSetFixed(e.Y-e.H/2)){q=wpdSetFixed(e.X-e.W/2),Q=wpdSetFixed(e.X+e.W/2),ee=wpdSetFixed(e.Y+e.H/2),oe=wpdSetFixed(e.Y-e.H/2),R=0;for(const e of t){K=wpdSetFixed(e.Y+e.H/2),Z=wpdSetFixed(e.Y-e.H/2),z=wpdSetFixed(e.X-e.W/2),J=wpdSetFixed(e.X+e.W/2);(q>z&&q<J&&Q>J||Q>z&&Q<J&&q<z||q>z&&q<J&&Q>z&&Q<J||q<z&&Q>J)&&oe<K&&(de="Y"),R++}}A++}re="Y"==de?0:-1}else re=-1}else re=-1;if("HANGINGBAR"!==d&&"PEGBOARD"!==d&&"CHEST"!==d)re=M.findIndex((function(e){return e>x}));if(-1==re)if(M=[],0==b.length)O=wpdSetFixed(g_pog_json[s].ModuleInfo[e].H+g_pog_json[s].BaseH-_+5);else{O=Math.min.apply(Math,b);re=b.findIndex((function(e){return e==O}));if("HANGINGBAR"!==d&&"PEGBOARD"!==g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].ObjType&&"PEGBOARD"!==d&&"CHEST"!==g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].ObjType&&"CHEST"!==d){var fe=wpdSetFixed(g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].X-g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].W/2),ce=wpdSetFixed(g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].X+g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].W/2);A=0;for(const e of t){if(0!==r.Rotation||0!==r.Slope)se=e.ItemRotateWorldX;else se=e.X;le=0;if(void 0!==e.TopObjID&&""!==e.TopObjID){K=e.H,R=0;for(const o of t)wpdSetFixed(e.X)==wpdSetFixed(o.X)&&R!==A&&(K+=o.H),R++;le=K}else le=e.H;le>O&&(ce>se-e.W/2&&fe<=se-e.W/2||fe<se+e.W/2&&fe>=se-e.W/2)&&(M.push(wpdSetFixed(le)),E.push(A),(e.CrushVert>0||e.CHPerc>0)&&(T="Y")),A++}re=M.findIndex((function(e){return e>O}))}else if("HANGINGBAR"!==g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].ObjType&&"PEGBOARD"!==d&&"CHEST"!==d){var Ie=wpdSetFixed(r.H/2),pe=0;A=0;for(const e of t)wpdSetFixed(e.H-Ie)>pe&&(pe=wpdSetFixed(e.H-Ie)),A++;O-=pe;var me=g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].ItemInfo;fe=wpdSetFixed(r.X-r.W/2),ce=wpdSetFixed(r.X+r.W/2),A=0;for(const o of me){if(0!==g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].Rotation||0!==g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].Slope)se=o.ItemRotateWorldX;else se=o.X;le=0;if(void 0!==o.TopObjID&&""!==o.TopObjID){K=o.H;$.each(me,(function(e,_){wpdSetFixed(o.X)==wpdSetFixed(_.X)&&e!==A&&(K+=_.H)})),le=K}else le=o.H;le>O&&(ce>wpdSetFixed(se-o.W/2)&&fe<=wpdSetFixed(se-o.W/2)||fe<wpdSetFixed(se+o.W/2)&&fe>=wpdSetFixed(se-o.W/2))&&(M.push(wpdSetFixed(le)),E.push(A),(o.CrushVert>0||o.CHPerc>0)&&(T="Y")),A++}re=M.findIndex((function(e){return e>O}))}else if("PEGBOARD"!==d&&"CHEST"!==d){me=g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].ItemInfo,de="N",A=0;for(const o of t){if(g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].Y-g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].H/2>o.Y-o.H/2){q=wpdSetFixed(o.X-o.W/2),Q=wpdSetFixed(o.X+o.W/2),ee=wpdSetFixed(o.Y+o.H/2),oe=wpdSetFixed(o.Y-o.H/2),R=0;for(const e of me){K=wpdSetFixed(e.Y+e.H/2),Z=wpdSetFixed(e.Y-e.H/2),z=wpdSetFixed(e.X-e.W/2),J=wpdSetFixed(e.X+e.W/2);(q>z&&q<J&&Q>J||Q>z&&Q<J&&q<z||q>z&&q<J&&Q>z&&Q<J||q<z&&Q>J)&&oe<K&&(de="Y"),R++}}A++}re="Y"==de?0:-1}else re=-1}if(-1==re&&(b.length>0||j.length>0)){O=0,x=0;var ue="N",he=-1;if(b.length>0&&(O=Math.min.apply(Math,b)),j.length>0&&(x=Math.min.apply(Math,j)),b.length>0&&j.length>0){if(x<O){re=j.findIndex((function(e){return e==x}));P=C}else if(O<x)re=b.findIndex((function(e){return e==O}));else if(O==x){ue="Y";re=b.findIndex((function(e){return e==O}));he=j.findIndex((function(e){return e==x}))}}else if(b.length>0)re=b.findIndex((function(e){return e==O}));else{re=j.findIndex((function(e){return e==x}));P=C}var Se="N";if("Y"==ue){if(0!==g_pog_json[s].ModuleInfo[e].ShelfInfo[C[he]].Rotation||0!==g_pog_json[s].ModuleInfo[e].ShelfInfo[C[he]].Slope)var ve=wpdSetFixed(g_pog_json[s].ModuleInfo[e].ShelfInfo[C[he]].Y+g_pog_json[s].ModuleInfo[e].ShelfInfo[C[he]].ShelfRotateHeight/2),Oe=wpdSetFixed(g_pog_json[s].ModuleInfo[e].ShelfInfo[C[he]].Y-g_pog_json[s].ModuleInfo[e].ShelfInfo[C[he]].ShelfRotateHeight/2);else ve=wpdSetFixed(g_pog_json[s].ModuleInfo[e].ShelfInfo[C[he]].Y+g_pog_json[s].ModuleInfo[e].ShelfInfo[C[he]].H/2),Oe=wpdSetFixed(g_pog_json[s].ModuleInfo[e].ShelfInfo[C[he]].Y-g_pog_json[s].ModuleInfo[e].ShelfInfo[C[he]].H/2);(ve>=S&&Oe<=S||ve>=v&&ve<=S)&&(Se="Y")}if("N"==Se){if(0!==g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].Rotation||0!==g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].Slope)ve=wpdSetFixed(g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].Y+g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].ShelfRotateHeight/2),Oe=wpdSetFixed(g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].Y-g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].ShelfRotateHeight/2);else ve=wpdSetFixed(g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].Y+g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].H/2),Oe=wpdSetFixed(g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].Y-g_pog_json[s].ModuleInfo[e].ShelfInfo[P[re]].H/2);ve>=S&&Oe<=S||ve>=v&&ve<=S?(re=0,n="N"):re=-1}else re=0,n="N"}if(-1===re||"Y"!=g_overhung_shelf_active||"SHELF"!=d&&"HANGINGBAR"!=d||"Y"===g_overhung_validation||(r.Overhung="Y",D="Y"),"N"==n&&-1!==re||"Y"==n&&-1!==re&&"N"==T)"Y"==i&&(g_validationAlert="Y",alert(get_message("LOST_FROM_SHELF_ERR_VERT",r.Shelf))),D="N";else if("Y"==n&&-1!==re&&"Y"==T){le=0,A=0;for(const _ of t){var xe=_.CrushVert>0?_.CrushVert:_.CHPerc;if(_.H>O&&xe>0)"Y"==crushItem(s,e,o,A,"H","Y",-1,-1)&&N.push(A);A++}if(M.length>N.length)"Y"==i&&alert(get_message("LOST_FROM_SHELF_ERR_VERT",r.Shelf)),D="N";else{A=0;for(const _ of t){xe=_.CrushVert>0?_.CrushVert:_.CHPerc;if(_.H>O&&xe>0)crushItem(s,e,o,A,"H","Y",-1,-1);A++}D="R"}}else D="Y";logDebug("function : validate_shelf_min_distance","E")}return D}catch(e){error_handling(e)}}function item_height_validation(e,o,_,t,n,g,a,i,r,s,l,d,f,c="N",I="N"){logDebug("function : item_height_validation; item_height : "+e+"; p_module_index : "+o+"; p_shelf_index : "+_+"; i_item_index : "+t+"; p_edit_ind : "+n+"; i_final_x : "+g+"; allow_crush : "+a+"; crush_height : "+i+"; item_fixed : "+r+"; alert_ind : "+s+"; item_depth : "+l+"; facing_edit : "+d,"S");try{var p=g_pog_json[f].ModuleInfo[o].ShelfInfo[_],m=p.ItemInfo[t],u=g_pog_json[f].ModuleInfo[o];m.Orientation;0==i&&(i=m.CHPerc),l_max_merch=get_cap_max_merch(o,_,u,p,f,g_dft_max_merch,"N",c,t);get_module_max_merch(o,_,f,c,t);if("Y"!==p.Topmerch){var h=get_cap_max_merch(o,_,u,p,f,g_dft_max_merch,"Y",c,t);l_max_merch=h<l_max_merch?h:l_max_merch}var S=0;m.HChanged="N";var v=m,O=p.MaxMerch,x=p.ItemInfo;if(void 0!==v.TopObjID&&""!==v.TopObjID||void 0!==v.BottomObjID&&""!==v.BottomObjID){var D=e,b=0;for(const e of x)wpdSetFixed(v.X)==wpdSetFixed(e.X)&&b!==t&&(D+=e.H),b++;e=D}if("Y"==g_overhung_shelf_active&&("SHELF"==p.ObjType||"HANGINGBAR"==p.ObjType)&&"Y"!==g_overhung_validation&&!(void 0!==v.TopObjID&&""!=v.TopObjID||void 0!==v.BottomObjID&&""!=v.BottomObjID)){if(e>l_max_merch&&(p.Overhung="Y"),"Y"==a){var j=0;for(var M of p.ItemInfo){crushItem(f,o,_,j,"H","Y",-1,-1);j++}}return"N"}var E=void 0===v.MVertCrushed||"N"==v.MVertCrushed?"N":"Y";if((e>l_max_merch||"Y"==E)&&"Y"==n&&"Y"==a&&i>0&&"N"==r){if("N"==crushItem(f,o,_,t,"H","Y",-1,-1)){if(v.BVert>1&&("N"==d||"Y"==d&&"Y"==I)){var P=0;if(0==(P=Math.floor(100*l_max_merch/(v.RH/v.BVert*100)))&&(P=1),P=(k=nvl(v.MPogVertFacings)>0?v.MPogVertFacings:v.MVertFacings)<P&&k>-1?k:P,(S=v.RH/v.BVert*P)>l_max_merch)return"Y"==s&&alert(get_message("LOST_FROM_SHELF_ERR_VERT",p.Shelf)),g_error_category="H","Y";m.H=S;var C=p,[N,T]=get_item_xy(C,v,v.W,v.H,f);return"BASKET"==p.ObjType&&"DIVIDER"==v.Item?console.log("no validation"):m.Y=T,m.BVert=P,m.HChanged="Y",g_error_category="",logDebug("function : item_height_validation","E"),"N"}return"Y"==s&&alert(get_message("LOST_FROM_SHELF_ERR_VERT",p.Shelf)),g_error_category="H","Y"}return logDebug("function : item_height_validation","E"),"N"}if(wpdSetFixed(e)>l_max_merch&&0==O){var y=p.Y+p.H/2,R=p.ObjType,w=g_pog_json[f].ModuleInfo[o].ShelfInfo,F=[],Y=[],H=-1,L=0;for(const e of w)"BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&L!==_&&(e.Y>y&&"HANGINGBAR"!==R&&L!==_?(F.push(e.Y-parseFloat(y)),Y.push(L)):e.Y<y&&L!==_&&(F.push(parseFloat(y)-e.Y),Y.push(L))),L++;if(F.length>0){var A=Math.min.apply(Math,F);H=Y[F.findIndex((function(e){return e==A}))]}var B=-1;if(-1!==H){B=wpdSetFixed(p.D-g_pog_json[f].ModuleInfo[o].ShelfInfo[H].D);l=wpdSetFixed(l)}return e>l_max_merch?("Y"==s&&alert(get_message("LOST_FROM_SHELF_ERR_VERT",p.Shelf)),g_error_category="H","Y"):l>B?("Y"==s&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",p.Shelf)),g_error_category="D","Y"):"N"}if(wpdSetFixed(e)>l_max_merch&&O>0){if(v.BVert>1&&("N"==d||"Y"==d&&"Y"==I)){var k;P=0;if(0==(P=Math.floor(100*l_max_merch/(v.RH/v.BVert*100)))&&(P=1),P=(k=nvl(v.MPogVertFacings)>0?v.MPogVertFacings:v.MVertFacings)<P&&k>-1?k:P,(S=v.RH/v.BVert*P)>l_max_merch)return"Y"==s&&alert(get_message("LOST_FROM_SHELF_ERR_VERT",p.Shelf)),g_error_category="H","Y";m.H=S;C=p;var[N,T]=get_item_xy(C,v,v.W,v.H,f);return"BASKET"==p.ObjType&&"DIVIDER"==v.Item?console.log("no validation"):m.Y=T,m.BVert=P,m.HChanged="Y",g_error_category="",logDebug("function : item_height_validation","E"),"N"}return"Y"==s&&alert(get_message("LOST_FROM_SHELF_ERR_VERT",p.Shelf)),g_error_category="H","Y"}if("Y"==n&&"Y"==a&&i>0&&"N"==r&&(void 0===v.TopObjID||""==v.TopObjID)&&(void 0===v.BottomObjID||""==v.BottomObjID))crushItem(f,o,_,t,"H","Y",-1,-1);return g_error_category="",logDebug("function : item_height_validation","E"),"N"}catch(e){error_handling(e)}}function validate_items(e,o,_,t,n,g,a,i,r,s,l,d,f,c,I,p,m,u,h,S,v,O,x,D="N",b="N",j="N"){logDebug("function : validate_items; shelf_obj_type : "+n+"; p_module_index : "+g+"; p_shelf_index : "+a+"; i_item_index : "+i+"; p_edit_ind : "+r+"; crush_width : "+s+"; crush_height : "+l+"; crush_depth : "+d+"; i_final_x : "+f+"; item_fixed : "+c+"; valid_height : "+I+"; alert_ind : "+p+"; valid_bottom : "+m+"; facing_edit : "+u+"; crush_item : "+S+"; valid_width : "+v+"; valid_depth : "+O,"S");try{var M=g_pog_json[x].ModuleInfo[g].ShelfInfo[a];if(M.ItemInfo.length>0){var E=0,P=M.SpreadItem;[currCombinationIndex,currShelfCombIndx]=getCombinationShelf(x,M.Shelf),-1!==currCombinationIndex&&-1!==currShelfCombIndx&&(P=g_combinedShelfs[currCombinationIndex].SpreadItem);var C=M.AllowAutoCrush,N=M.peg_vert_values,T=(M.peg_horiz_values,0),y=0,R=wpdSetFixed(M.X-M.W/2),w=wpdSetFixed(M.X+M.W/2),F=wpdSetFixed(M.Y-M.H/2),Y=wpdSetFixed(M.Y+M.H/2);for(Q=0;Q<t.length;Q++)M.ItemInfo[t[Q]].WChanged="N",M.ItemInfo[t[Q]].DChanged="N";if(-1!==i&&(M.ItemInfo[i].WChanged="N",M.ItemInfo[i].DChanged="N"),"PEGBOARD"==n)var H=M.VertiSpacing;else H=M.HorizGap;var L=M.DGap;c="N";T=H>0?H:0;valid_values=["SHELF","CHEST","PALLET","HANGINGBAR","PEGBOARD","ROD"];var A=!1;if(-1!==valid_values.indexOf(n)){if(M.Overhung="N","PEGBOARD"==n||"Y"==g_chest_as_pegboard&&"CHEST"==n&&void 0!==N){if(validate_peg="Y",M.ItemInfo.length>0)for("Y"==g_chest_as_pegboard&&"CHEST"==n||(F=wpdSetFixed(F-M.LoOverHang),Y=wpdSetFixed(Y+M.UOverHang),R=wpdSetFixed(R-M.LOverhang),w=wpdSetFixed(w+M.ROverhang)),Q=0;Q<t.length;Q++){var B=M.ItemInfo[t[Q]].X,k=wpdSetFixed(M.ItemInfo[t[Q]].X-M.ItemInfo[t[Q]].W/2),G=wpdSetFixed(M.ItemInfo[t[Q]].X+M.ItemInfo[t[Q]].W/2),W=wpdSetFixed(M.ItemInfo[t[Q]].Y+M.ItemInfo[t[Q]].H/2),V=wpdSetFixed(M.ItemInfo[t[Q]].Y-M.ItemInfo[t[Q]].H/2),X=M.ItemInfo[t[Q]].Y;if("Y"!=g_chest_as_pegboard||"CHEST"!=n){if(parseFloat(k)<parseFloat(R)||parseFloat(G)>parseFloat(w)||parseFloat(V)<parseFloat(F)||parseFloat(W)>parseFloat(Y)){validate_peg="H";break}}else if("Y"==b&&(parseFloat(k)<parseFloat(R)||parseFloat(G)>parseFloat(w)||parseFloat(V)<parseFloat(F)||parseFloat(W)>parseFloat(Y))&&"Y"==M.AutoPlacing){if(M.AutoPlacing="Y","N"==(U=find_pegboard_gap(e[Q],o[Q],B,X,H,g,a,t[Q],t[Q],"Y",x,"Y",g_auto_x_space,g_auto_y_space))){validate_peg="H";break}validate_peg="Y"}else{console.log("validate item start ",t[Q],M.ItemInfo[t[Q]].Item,M.ItemInfo[t[Q]].X,M.ItemInfo[t[Q]].Y);var U=find_pegboard_gap(e[Q],o[Q],B,X,H,g,a,t[Q],t[Q],"Y",x,"Y",g_auto_x_space,g_auto_y_space);if(console.log(" find pegboard return ",U,M.ItemInfo[t[Q]].Item),"N"==U&&"Y"==g_chest_as_pegboard&&"CHEST"==n&&void 0!==N)if(console.log(" valid failure ",U,M.ItemInfo[t[Q]].Item,M.ItemInfo[t[Q]]),"Y"==M.AllowAutoCrush)"Y"==(te=crushItem(x,g,a,t[Q],"A","Y",_,t))&&(U="Y");if(console.log("validate items after ",U),M.ItemInfo[t[Q]].D>M.BsktWallH&&"CHEST"==n&&"Y"==O){var z=1,J=M.ItemInfo[t[Q]];z=Math.floor(100*M.BsktWallH/(J.RD/J.BaseD*100)),z=0==(z=(ze=nvl(J.MPogDepthFacings)>0?J.MPogDepthFacings:J.MDepthFacings)<z&&ze>-1?ze:z)?1:z;var K=0;if(K=J.RD/J.BaseD*z,M.BsktWallH<K){validate_peg="D";break}M.ItemInfo[t[Q]].D=K,M.ItemInfo[t[Q]].RD=K,M.ItemInfo[t[Q]].BaseD=z,M.ItemInfo[t[Q]].DChanged="Y"}if("N"==U&&("Y"==v||"Y"==I)){validate_peg="N";break}if("D"==U){validate_peg="D";break}}}if("N"==validate_peg)return"Y"==p&&("Y"==g_chest_as_pegboard&&"CHEST"==n?alert(get_message("POGC_CHEST_SPACE_VALID",M.Shelf)):alert(get_message("ITEM_POSITION_OVERLAP",M.Shelf))),g_error_category="D",!1;if("H"==validate_peg)return"Y"==p&&alert(get_message("ITEM_OUTSIDE_PEGBOARD",M.Shelf)),g_error_category="D",!1;if("D"==validate_peg)return"Y"==p&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",M.Shelf)),g_error_category="D",!1;if("W"==validate_peg)"Y"==p&&confirm(get_message("POGCR_REDUCE_DEPTH_TO_ONE"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){return g_error_category="",!0}),(function(){return g_error_category="D",!1}));else if("Y"==validate_peg){for(Q=0;Q<t.length;Q++)console.log(" valid success ",M.ItemInfo[t[Q]].Item,M.ItemInfo[t[Q]]);return g_error_category="",!0}if(void 0!==M.AutoFillPeg&&"Y"==M.AutoFillPeg&&-1!==f)if(-1!==i){if(M.MaxMerch<M.ItemInfo[i].D&&M.MaxMerch>0||M.ItemInfo[i].D>g_pegboard_dft_item_depth&&0==M.MaxMerch&&g_pegboard_dft_item_depth>0)return"Y"==p&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",M.Shelf)),g_error_category="D",!1}else{var Z=M.ItemInfo,q="N",Q=0;for(const e of Z)-1!==t.indexOf(Q)&&(M.MaxMerch>0&&e.D>M.MaxMerch||e.D>g_pegboard_dft_item_depth&&0==M.MaxMerch&&g_pegboard_dft_item_depth>0)&&(q="Y"),Q++;if("Y"==q)return"Y"==p&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",M.Shelf)),g_error_category="D",!1}}else if("PALLET"==n&&"Y"==D){var ee=0,oe=0;Z=M.ItemInfo;ee=e.reduce(((e,o)=>e+o),0),ee+=T*(parseFloat(e.length)-1);Q=0;for(const e of Z)-1==t.indexOf(Q)&&(H>0?oe+=e.W+H:oe=wpdSetFixed(oe+e.W)),Q++;if((y=(100*M.W+100*M.LOverhang+100*M.ROverhang-100*oe)/100)<ee)return"Y"==p&&(g_validationFlag="N",alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",M.Shelf))),g_error_category="W",!1}else if("ROD"!==n){if("Y"==I){if(E=get_max_merch(g,a,i,r,f,x),-1!==(We=o.findIndex((function(e){return e>E})))&&"Y"==g_overhung_shelf_active&&("SHELF"==n||"HANGINGBAR"==n)&&"Y"!==g_overhung_validation)if(-1==i){var _e=!1;for(Q=0;Q<t.length;Q++){"N"==(te=crushItem(x,g,a,t[Q],"H","Y",-1,-1))&&(M.Overhung="Y",_e=!0)}_e&&(g_error_category="H",A=!0)}else{"N"==(te=crushItem(x,g,a,i,"H","Y",-1,-1))&&(M.Overhung="Y",g_error_category="H",A=!0)}if(!A)if(-1!==We&&"Y"==r&&"Y"==C&&l>0&&"N"==c&&"Y"==S){if(o[We]=o[We]-o[We]*(l/100),-1!==o.findIndex((function(e){return e>E})))return"Y"==p&&alert(get_message("LOST_FROM_SHELF_ERR_VERT",M.Shelf)),g_error_category="H",!1;M.ItemInfo[t[We]].H=o[We]}else if(-1!==We){var te="Y";for(Q=0;Q<t.length;Q++){if("N"==(te=crushItem(x,g,a,t[Q],"H","Y",-1,-1))){"Y"==p&&alert(get_message("LOST_FROM_SHELF_ERR_VERT",M.Shelf));break}}if("N"==te)return g_error_category="H",!1}}if("Y"==v&&"PALLET"!==n){ee=0,oe=0,Z=M.ItemInfo;var ne="N",ge=-1;ee=e.reduce(((e,o)=>e+o),0),ee+=T*(parseFloat(e.length)-1);var ae=Z.some((e=>"Y"===e.Fixed)),ie=!1;if(M.ItemInfo.length>0){if("M"==P&&-1!=i){var re=M.ItemInfo[i],se=wpdSetFixed(re.X-re.W/2),le=wpdSetFixed(re.X+re.W/2),de=wpdSetFixed(re.Y+re.H/2),fe=wpdSetFixed(re.Y-re.H/2),ce="Y";if(se<R&&le>w&&"N"==g_overhung_shelf_active)return alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",M.Shelf)),g_error_category="W",!1;if(Z.length>0){var Ie=0;for(const e of Z){if(Ie!==i&&(div_start=wpdSetFixed(e.X-e.W/2),div_end=wpdSetFixed(e.X+e.W/2),div_top=wpdSetFixed(e.Y+e.H/2),div_bottom=wpdSetFixed(e.Y-e.H/2),(div_start<le&&div_start>=se||div_end>se&&div_end<=le)&&(div_bottom<de&&div_bottom>=fe||div_top<=de&&div_top>fe)||(se<div_start&&le>div_start||se<div_end&&le>=div_end)&&de<=div_top&&fe>=div_bottom||(div_start<=se&&div_end>=le||div_start>=se&&div_end<=le)&&(div_top>=de&&fe>=div_bottom||div_top>=de&&div_bottom<=fe||div_top>de&&div_bottom<=de)||se<div_start&&le>=div_end&&de<=div_top&&de>div_bottom&&fe<=div_bottom||se>div_start&&le<=div_end&&de>=div_top&&fe<div_top&&fe<=div_bottom||se<div_start&&le>=div_end&&de<=div_top&&fe>=div_bottom||se<div_start&&le>=div_end&&de<div_top&&de>div_bottom||se>=div_start&&se<div_end&&fe>=div_bottom&&fe<div_top)){ce="N";break}Ie++}}if("N"==ce){if(!(i>-1&&"Y"==C))return alert(get_message("ITEM_POSITION_OVERLAP_SHELF_HANG",M.Shelf)),g_error_category="W",!1;if("N"==(te=crushItem(x,g,a,i,"W","Y",-1,-1)))return alert(get_message("ITEM_POSITION_OVERLAP_SHELF_HANG",M.Shelf)),g_error_category="W",!1;A=!0}}if(A||"M"===P||!ae||"HANGINGBAR"!=n&&"SHELF"!=n||(ie=validateShelfWithFixedItem(M,P,H,Z)),!A){if("Y"==r){bookend_array=[];Q=0;for(const e of Z)(!ae&&Q<i&&"B"==e.Fixed&&"R"!==P&&(h.length>0&&-1==h.indexOf(e.ObjID)||0==h.length)||!ae&&Q>i&&"B"==e.Fixed&&"R"==P&&(h.length>0&&-1==h.indexOf(e.ObjID)||0==h.length))&&(ne="Y",bookend_array.push(Q)),Q++;if("R"!==P)ge=Math.max.apply(Math,bookend_array);else ge=Math.min.apply(Math,bookend_array);if("N"==ne){Q=0;for(const e of Z)"SHELF"==n?Q===i||void 0!==e.BottomObjID&&""!=e.BottomObjID||(H>0?oe+=wpdSetFixed(e.W+H):oe=wpdSetFixed(oe+e.W)):Q!==i&&(H>0?oe+=wpdSetFixed(e.W+H):oe=wpdSetFixed(oe+e.W)),Q++}else{Q=0;for(const e of Z)(Q>ge&&Q<i&&"R"!==P&&Q!==t[0]||Q<ge&&Q>i&&"R"==P&&Q!==t[0])&&(H>0?oe+=wpdSetFixed(e.W+H):oe=wpdSetFixed(oe+e.W)),Q++}}else{var pe=Math.min.apply(Math,t),me=Math.max.apply(Math,t);bookend_array=[];Q=0;for(const e of Z)"R"!==P?Q<pe&&"B"==e.Fixed&&(ne="Y",bookend_array.push(Q)):"R"==P&&Q>me&&"B"==e.Fixed&&(ne="Y",bookend_array.push(Q)),Q++;if("R"!==P)ge=Math.max.apply(Math,bookend_array);else ge=Math.min.apply(Math,bookend_array);if("N"==ne){Q=0;for(const e of Z)"SHELF"==n?-1!=t.indexOf(Q)||void 0!==e.BottomObjID&&""!=e.BottomObjID||(H>0?oe+=wpdSetFixed(e.W+H):oe=wpdSetFixed(oe+e.W)):-1==t.indexOf(Q)&&(H>0?oe+=wpdSetFixed(e.W+H):oe=wpdSetFixed(oe+e.W)),Q++}else{Q=0;for(const e of Z)(Q>ge&&"R"!==P&&Q!==t[0]||Q<ge&&"R"==P&&Q!==t[0])&&(H>0?oe+=wpdSetFixed(e.W+H):oe=wpdSetFixed(oe+e.W)),Q++}}y="N"==ne?wpdSetFixed((100*M.W+100*M.LOverhang+100*M.ROverhang-100*oe)/100):"R"!==P?wpdSetFixed(w-(M.ItemInfo[ge].X+M.ItemInfo[ge].W/2)-oe):wpdSetFixed(M.ItemInfo[ge].X-M.ItemInfo[ge].W/2-R-oe)}}else y=wpdSetFixed((100*M.W+100*M.LOverhang+100*M.ROverhang)/100);if(!A&&!ae&&g_combinedShelfs.length>0){var[ue,he]=getCombinationShelf(x,M.Shelf);if(-1!==currShelfCombIndx&&void 0!==g_pog_json[x].ModuleInfo[g_combinedShelfs[ue][g_combinedShelfs[ue].length-1].MIndex]){var Se=g_combinedShelfs[ue].ItemInfo;C=g_combinedShelfs[ue].AllowAutoCrush;var ve=0,Oe=0;Q=0;for(var xe of g_combinedShelfs[ue])ve+=xe.W,Q++;var De=0;for(var be of Se)Oe+=be.RW,De++;Oe-=ee,y=(100*ve+100*g_pog_json[x].ModuleInfo[g_combinedShelfs[ue][0].MIndex].ShelfInfo[g_combinedShelfs[ue][0].SIndex].LOverhang+100*g_pog_json[x].ModuleInfo[g_combinedShelfs[ue][g_combinedShelfs[ue].length-1].MIndex].ShelfInfo[g_combinedShelfs[ue][g_combinedShelfs[ue].length-1].SIndex].ROverhang-100*Oe)/100}}if("Y"==g_overhung_shelf_active&&("SHELF"==n||"HANGINGBAR"==n)&&-1!==i)if(y<ee){te="N";"Y"==C&&(te=crushItem(x,g,a,i,"W","Y",-1,-1)),je=void 0===M.ItemInfo[i].MHorizCrushed||"N"==M.ItemInfo[i].MHorizCrushed?"N":"Y",M.Overhung="Y",g_error_category="W",A=!0}else-1!==currShelfCombIndx&&y>=ee&&"Y"==C&&("N"==(te=crushItem(x,g,a,i,"W","Y",-1,-1))&&(M.Overhung="Y",g_error_category="W"),A=!0);if(!A){var je="N";if(-1!==i&&void 0!==M.ItemInfo[i].Orientation){var Me=M.ItemInfo[i].Orientation,[Ee,Pe,Ce,Ne,Te,ye]=get_new_orientation_dim(Me,0,0,0);"H"==Te?je=void 0===M.ItemInfo[i].MVertCrushed||"N"==M.ItemInfo[i].MVertCrushed?"N":"Y":"W"==Te?je=void 0===M.ItemInfo[i].MHorizCrushed||"N"==M.ItemInfo[i].MHorizCrushed?"N":"Y":"D"==Te&&(je=void 0===M.ItemInfo[i].MDepthCrushed||"N"==M.ItemInfo[i].MDepthCrushed?"N":"Y")}if((y<ee||ie||"Y"==je)&&"Y"==C&&"N"==m&&"Y"==S){if(-1!==i&&(M.ItemInfo[i].AvlSpace=y),"N"==(te=crushItem(x,g,a,i,"W","Y",-1,-1))&&(y<ee||ie))return"Y"!=g_overhung_shelf_active||"SHELF"!=n&&"HANGINGBAR"!=n?("Y"==p&&(g_validationFlag="N",alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",M.Shelf))),"Y"==j?(g_error_category="",!0):(g_error_category="W",!1)):(M.Overhung="Y",g_error_category="",!0);if("F"==te){if(-1===i||"N"!=u&&("Y"!=u||"Y"!=j))return"Y"==p&&(g_validationFlag="N",alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",M.Shelf))),g_error_category="W",!1;if(!((Le=M.ItemInfo[i]).BHoriz>1))return"Y"==j?(g_error_category="",!0):("Y"==p&&(g_validationFlag="N",alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",M.Shelf))),g_error_category="W",!1);var Re=1;Re=0==(Re=Math.floor(100*y/(Le.RW/Le.BHoriz*100)))||Re<0?1:Re;var we=0;if(y<(we=wpdSetFixed(Le.RW/Le.BHoriz*Re+T*(e.length-1))))return"Y"==p&&(g_validationFlag="N",alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",M.Shelf))),g_error_category="W",!1;var Fe="N";wpdSetFixed(Le.X+Le.W/2)>wpdSetFixed(M.X+M.W/2)&&"N"==g_overhung_shelf_active&&("SHELF"==M.ObjType||"HANGINGBAR"==M.ObjType)&&(Fe="Y"),"N"==Fe?(Le.W=we,Le.BHoriz=Re,Le.WChanged="Y"):"Y"==p&&(g_validationFlag="N",alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",M.Shelf)))}else g_error_category="",A=!0}else if((y<ee||ie)&&"N"==m&&("N"==g_overhung_shelf_active&&("SHELF"==n||"HANGINGBAR"==n)||"SHELF"!==n&&"HANGINGBAR"!==n)){if(-1!==i&&(M.ItemInfo[i].AvlSpace=y),-1===i||"N"!=u&&("Y"!=u||"Y"!=j))return"Y"==p&&(g_validationFlag="N",alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",M.Shelf))),g_error_category="W",!1;if(!((Le=M.ItemInfo[i]).BHoriz>1))return"Y"==j?(g_error_category="",!0):("Y"==p&&(g_validationFlag="N",alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",M.Shelf))),g_error_category="W",!1);Re=1;Re=0==(Re=Math.floor(100*y/(Le.RW/Le.BHoriz*100)))?1:Re;we=0;if(y<(we=Le.RW/Le.BHoriz*Re+T*(parseFloat(e.length)-1))||ie)return"Y"==p&&(g_validationFlag="N",alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",M.Shelf))),g_error_category="W",!1;Fe="N";Le.X+Le.W/2>M.X+M.W/2&&"N"==g_overhung_shelf_active&&("SHELF"==M.ObjType||"HANGINGBAR"==M.ObjType)&&(Fe="Y"),"N"==Fe?(Le.W=we,Le.BHoriz=Re,Le.WChanged="Y"):"Y"==p&&(g_validationFlag="N",alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",M.Shelf)))}else if("Y"==C&&"N"==m&&"Y"==S)te=crushItem(x,g,a,i,"W","Y",-1,-1)}}}if("PEGBOARD"!==n&&"HANGINGBAR"!==n&&"Y"==O&&("CHEST"!=n||"Y"!=g_chest_as_pegboard)){min_distance_arr=[],min_index_arr=[];var Ye,He=0;for(itemindex of t){var Le=M.ItemInfo[itemindex],Ae=(se=wpdSetFixed(Le.X-Le.W/2),le=wpdSetFixed(Le.X+Le.W/2),0),Be=null;for(shelfs of g_pog_json[x].ModuleInfo[g].ShelfInfo){var ke=shelfs.D;if("TEXTBOX"!==shelfs.ObjType&&"DIVIDER"!==shelfs.ObjType&&"NOTCH"!==shelfs.ObjType&&"BASE"!==shelfs.ObjType&&Be!==ke&&"CHEST"!==shelfs.ObjType){var $e=wpdSetFixed(shelfs.X+shelfs.W/2),Ge=wpdSetFixed(shelfs.X-shelfs.W/2);wpdSetFixed(shelfs.Y)<wpdSetFixed(Le.Y+Le.H/2)&&Ae>a&&(se>=Ge&&se<$e||le<=$e&&le>Ge)&&"DIVIDER"!==shelfs.ObjType&&"NOTCH"!==shelfs.ObjType&&(min_distance_arr.push(Math.abs(Le.Y-Le.H/2-shelfs.Y)),min_index_arr.push(Ae))}Be=ke,Ae++}}min_distance=Math.min.apply(Math,min_distance_arr);var We=min_distance_arr.findIndex((function(e){return e==min_distance}));if(-1!==(Ye=min_index_arr[We])&&void 0!==Ye&&(He=g_pog_json[x].ModuleInfo[g].ShelfInfo[Ye].D),-1!==(We=_.findIndex((function(e){return e>wpdSetFixed(M.D-He)})))&&"Y"==g_overhung_shelf_active&&("SHELF"==n||"HANGINGBAR"==n)&&"Y"!==g_overhung_validation){if(-1==i){for(_e=!1,Q=0;Q<t.length;Q++){"N"==(te=crushItem(x,g,a,t[Q],"D","Y",_,t))&&(M.Overhung="Y",_e=!0)}_e&&(g_error_category="D")}else{"N"==(te=crushItem(x,g,a,i,"D","Y",_,t))&&(M.Overhung="Y",g_error_category="D")}A=!0}if(!A){var Ve="N";if(-1!==i&&void 0!==M.ItemInfo[i].Orientation&&(Ve=M.ItemInfo[i].MDepthCrushed),-1===We&&"Y"!=Ve||"Y"!=C||"N"!=c||"Y"!=S||-1===i)if(-1!==We)if(-1!==i&&("N"==u||"Y"==u&&"Y"==j)){if(!((Le=M.ItemInfo[i]).BaseD>1))return"Y"==j?(g_error_category="",!0):("Y"==p&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",M.Shelf)),g_error_category="D",!1);z=1;z=Math.floor(100*M.D/(Le.RD/Le.BaseD*100)),z=0==(z=(ze=nvl(Le.MPogDepthFacings)>0?Le.MPogDepthFacings:Le.MDepthFacings)<z&&ze>-1?ze:z)?1:z;K=0;if(K=Le.RD/Le.BaseD*z,M.D<K)return"Y"==p&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",M.Shelf)),g_error_category="D",!1;M.ItemInfo[i].D=K,M.ItemInfo[i].BaseD=z,M.ItemInfo[i].DChanged="Y"}else{for(Q=0;Q<t.length;Q++){if("N"==(te=crushItem(x,g,a,t[Q],"D","Y",_,t))){"Y"==p&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",M.Shelf));break}}if("Y"==j)return g_error_category="",!0;if("N"==te)return g_error_category="D",!1}else{if(-1!==i)te=crushItem(x,g,a,i,"D","Y",_,t);if("SHELF"==n&&"Y"==m)for(De=0;De<t.length;De++){if(void 0!==(Le=M.ItemInfo[t[De]]).BottomObjID&&""!==Le.BottomObjID){var Xe=get_shelf_item_ind(g,a,Le.BottomObjID,x);if(_[De]>M.ItemInfo[Xe].D)return"Y"==p&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",M.Shelf)),g_error_category="D",!1}else if(void 0!==Le.TopObjID&&""!==Le.TopObjID){var Ue=get_shelf_item_ind(g,a,Le.TopObjID,x);if(_[De]<M.ItemInfo[Ue].D)return"Y"==p&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",M.Shelf)),g_error_category="D",!1}}}else{if("N"==(te=crushItem(x,g,a,i,"D","Y",_,t)))return"Y"==p&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",M.Shelf)),"Y"==j?(g_error_category="",!0):(g_error_category="D",!1);if("F"==te){if(-1===i||"N"!=u&&("Y"!=u||"Y"!=j))return"Y"==p&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",M.Shelf)),g_error_category="D",!1;if(!((Le=M.ItemInfo[i]).BaseD>1))return"Y"==j?(g_error_category="",!0):("Y"==p&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",M.Shelf)),g_error_category="D",!1);var ze,z=1;z=Math.floor(100*M.D/(Le.RD/Le.BaseD*100)),z=0==(z=(ze=nvl(Le.MPogDepthFacings)>0?Le.MPogDepthFacings:Le.MDepthFacings)<z&&ze>-1?ze:z)?1:z;var K=0;if(K=Le.RD/Le.BaseD*z,M.D<K)return"Y"==p&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",M.Shelf)),g_error_category="D",!1;M.ItemInfo[i].D=K,M.ItemInfo[i].BaseD=z,M.ItemInfo[i].DChanged="Y"}}}}}}if("CHEST"!=n&&"PALLET"!=n||-1===f){if("HANGINGBAR"==n&&-1!==f){if(-1!==i)return!(M.ItemInfo[i].D>M.MaxMerch&&M.MaxMerch>0||M.ItemInfo[i].D>g_hangbar_dft_maxmerch&&0==M.MaxMerch&&g_hangbar_dft_maxmerch>0)||("Y"!==g_overhung_validation?("Y"==g_overhung_shelf_active&&(M.Overhung="Y"),!0):("Y"==p&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",M.Shelf)),g_error_category="D",!1));Z=M.ItemInfo,q="N",Q=0;for(const e of Z)-1!==t.indexOf(Q)&&(M.MaxMerch>0&&e.D>M.MaxMerch||e.D>g_hangbar_dft_maxmerch&&0==M.MaxMerch&&g_hangbar_dft_maxmerch>0)&&(q="Y"),Q++;return"Y"==q?("Y"==p&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",M.Shelf)),g_error_category="D",!1):("Y"!==g_overhung_validation&&"Y"==g_overhung_shelf_active&&(M.Overhung="Y"),!0)}if("ROD"==n){var Je=0;return M.ItemInfo.length>0&&$.each(M.ItemInfo,(function(e,o){Je+=o.D+L})),Je>M.D?("Y"==p&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",M.Shelf)),g_error_category="D",!1):(g_error_category="",logDebug("function : validate_items","E"),!0)}return g_error_category="",logDebug("function : validate_items","E"),!0}if("PALLET"!=n||"Y"!=m){var Z=M.ItemInfo,q="N",Q=0;for(const e of Z){if(-1!==t.indexOf(Q)){se=wpdSetFixed(f-M.ItemInfo[Q].W/2),le=wpdSetFixed(f+M.ItemInfo[Q].W/2);se<wpdSetFixed(M.X-M.W/2-M.LOverhang)||wpdSetFixed(M.X+M.W/2+M.ROverhang)}Q++}return"Y"!=q||("Y"==p&&alert(get_message("LOST_FROM_FIXTURE_AREA",M.Shelf)),g_error_category="W",!1)}for(De=0;De<t.length;De++){if(void 0!==(Le=M.ItemInfo[t[De]]).BottomObjID&&""!==Le.BottomObjID){Xe=get_shelf_item_ind(g,a,Le.BottomObjID,x);if(_[De]>M.ItemInfo[Xe].D)return"Y"==p&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",M.Shelf)),g_error_category="D",!1}else if(void 0!==Le.TopObjID&&""!==Le.TopObjID){Ue=get_shelf_item_ind(g,a,Le.TopObjID,x);if(_[De]<M.ItemInfo[Ue].D)return"Y"==p&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",M.Shelf)),g_error_category="D",!1}}}catch(e){error_handling(e)}}function find_prev_ind(e,o,_,t){logDebug("function : find_prev_ind; i_item_index : "+o+"; item_bottom : "+_+"; spread_product : "+t,"S");var n=-1;return o>0&&("R"!==t?$.each(e,(function(e,t){e<o&&_==wpdSetFixed(t.Y+t.H/2)&&(n=Math.max(n,e))})):$.each(e,(function(e,t){e>o&&_==wpdSetFixed(t.Y+t.H/2)&&(n=-1!==n?Math.min(n,e):e)}))),-1==n&&("R"!==t?$.each(e,(function(e,t){e>o&&_==wpdSetFixed(t.Y+t.H/2)&&(n=-1!==n?Math.min(n,e):e)})):$.each(e,(function(e,t){e<o&&_==wpdSetFixed(t.Y+t.H/2)&&(n=Math.max(n,e))}))),logDebug("function : find_prev_ind","E"),n}function get_item_index(e,o,_){logDebug("function : get_item_index; obj_id : "+e+"; check_type : "+o,"S");var t=g_shelf_index=l_item_index=-1,n=g_pog_json[_].ModuleInfo,g=0;for(const _ of n){if(l_item_index>-1)break;if(null==_.ParentModule||"undefined"==_.ParentModule){var a=0;for(const n of _.ShelfInfo){if(l_item_index>-1)break;if(void 0!==n&&"BASE"!==n.ObjType&&"NOTCH"!==n.ObjType&&"DIVIDER"!==n.ObjType&&"TEXTBOX"!==n.ObjType&&n.ItemInfo.length>0){var i=0;for(const _ of n.ItemInfo){if(("C"==o?_.CompItemObjID:_.ObjID)==e){t=g,g_shelf_index=a,l_item_index=i;break}i++}}a++}}g++}return logDebug("function : get_item_index","E"),[t,g_shelf_index,l_item_index]}function get_shelf_item_ind(e,o,_,t){logDebug("function : get_shelf_item_ind; p_module_index : "+e+"; p_shelf_index : "+o+"; obj_id : "+_,"S");var n=g_pog_json[t].ModuleInfo[e].ShelfInfo[o].ItemInfo,g=-1,a=0;for(const e of n){if(e.ObjID==_){g=a;break}a++}return logDebug("function : get_shelf_item_ind","E"),g}function get_basket_fill_count(e,o,_,t,n,g,a,r){logDebug("function : get_basket_fill_count; p_module_index : "+e+"; p_shelf_index : "+o+"; basket_spread : "+_+"; basket_fill : "+t+"; shelf_width : "+n+"; max_merch : "+g+"; shelf_depth : "+a,"S");var s=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo,l=2*g_pog_json[r].ModuleInfo[e].ShelfInfo[o].BsktWallThickness,d=wpdSetFixed(a-l),f=0,c=0;for(const e of s)"DIVIDER"!==e.Item&&(f+=e.D,console.log("items.D",e,e.D,f));if("F"==t)if("LR"==_){for(i=1;i<1e3;i++)if(f*i>n){c=i-1;break}}else if("BT"==_){for(i=1;i<1e3;i++)if(f*i>g){c=i-1;break}}else if("FB"==_)for(i=1;i<1e3;i++)if(f*i>d){c=i-1;break}return 0==c&&(c=1),logDebug("function : get_basket_fill_count","E"),c}function get_min_shelf(e,o,_){logDebug("function : get_min_shelf; p_module_index : "+e+"; p_final_y : "+o,"S");var t=g_pog_json[_].ModuleInfo[e].ShelfInfo,n=[],g=[],a=0;for(const e of t)"BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.Y<o&&(n.push(parseFloat(o)-e.Y),g.push(a)),a++;if(n.length>0){var i=Math.min.apply(Math,n),r=n.findIndex((function(e){return e==i}));div_shelf_index=g[r],shelf_found="Y"}else div_shelf_index=0,shelf_found="N";return logDebug("function : get_min_shelf","E"),div_shelf_index+","+shelf_found}async function reset_auto_crush(e,o,_,t,n,g,a){logDebug("function : reset_auto_crush; p_module_index : "+e+"; p_shelf_index : "+o+"; edit_item_index : "+_,"S");var i=g_pog_json[t].ModuleInfo[e].ShelfInfo[o],r=g_pog_json[a].ModuleInfo[n].ShelfInfo[g],s=i.ItemInfo,l=[],d="N",f=0,c=0,I=0,p=i.HorizGap,[m,u]=getCombinationShelf(t,i.Shelf);if(-1==m&&-1==u)if("PEGBOARD"===i.ObjType||"Y"==g_chest_as_pegboard&&"CHEST"==i.ObjType&&void 0!==i.peg_vert_values){if("Y"==g_chest_as_pegboard&&("CHEST"==i.ObjType||"CHEST"==r.ObjType)){if(void 0!==r.ItemInfo[_])var h=r.ItemInfo[_];else h=i.ItemInfo[_];if(-1!==_&&void 0!==h){j=void 0===h?-1:h.Orientation;var[S,v,O,x,D,b]=get_new_orientation_dim(j,0,0,0);"N"==h.MHorizCrushed&&(h.W=h.RW,"W"==D?h.CrushHoriz=0:"H"==D?h.CrushVert=0:"D"==D&&(h.CrushD=0)),"N"==h.MVertCrushed&&(h.H=h.RH,"H"==x?h.CrushVert=0:"W"==x?h.CrushHoriz=0:"D"==x&&(h.CrushD=0)),"N"==h.MDepthCrushed&&(h.D=h.RD,"W"==b?h.CrushHoriz=0:"H"==b?h.CrushVert=0:"D"==b&&(h.CrushD=0))}}}else{if("Y"==g_overhung_shelf_active&&"N"==i.AllowAutoCrush){I=0;for(const e of s)"0"!=i.ItemInfo[I].CapFacing&&""!=i.ItemInfo[I].CapFacing||0!=i.ItemInfo[I].NVal||(i.ItemInfo[I].W=e.RW,i.ItemInfo[I].H=e.RH,i.ItemInfo[I].D=e.RD),i.ItemInfo[I].CrushHoriz=0,i.ItemInfo[I].CrushVert=0,i.ItemInfo[I].CrushD=0,i.ItemInfo[I].MHorizCrushed="N",i.ItemInfo[I].MVertCrushed="N",i.ItemInfo[I].MDepthCrushed="N",I++}else{c=0;for(const e of s)"N"==e.Fixed&&e.CWPerc>0&&("Y"==i.AllowAutoCrush&&"N"==e.MHorizCrushed||"N"==i.AllowAutoCrush)&&(d="Y",l.push(c)),c++;if("Y"==d){d="N";I=0;for(const e of s)_!==I&&("Y"==i.AllowAutoCrush&&"Y"==e.MHorizCrushed?f+=e.W:f+=e.RW,p>0&&(f+=e.SpreadItem)),I++;if(f<=i.W){I=0;for(const e of s){if(-1!==l.indexOf(I)&&I!==_&&("Y"==i.AllowAutoCrush&&"N"==e.MHorizCrushed||"N"==i.AllowAutoCrush)){var j=void 0===e?-1:e.Orientation,[S,v,O,x,D,b]=get_new_orientation_dim(j,0,0,0);i.ItemInfo[I].W=e.RW,"W"==D?i.ItemInfo[I].CrushHoriz=0:"H"==D?i.ItemInfo[I].CrushVert=0:"D"==D&&(i.ItemInfo[I].CrushD=0),"N"==i.AllowAutoCrush&&(i.ItemInfo[I].MHorizCrushed="N")}I++}}else if("Y"==i.AllowAutoCrush){I=0;for(const n of s)_!==I&&await crushItem(t,e,o,I,"W","Y",-1,-1),I++}reorder_items(e,o,t)&&console.log("reorderedin crush")}}if("SHELF"==i.ObjType){var M=0;for(const e of s){if(M==_&&"N"==e.MVertCrushed){var j=void 0===e?-1:e.Orientation,[S,v,O,x,D,b]=get_new_orientation_dim(j,0,0,0);if(e.CrushVert>0&&("0"==e.CapFacing||""==e.CapFacing)&&0==e.NVal){e.H=e.RH,i.ItemInfo[M].H=e.RH;var[E,P]=get_item_xy(i,e,e.W,e.H,t);i.ItemInfo[M].Y=P,"N"==e.MVertCrushed&&("H"==x?i.ItemInfo[M].CrushVert=0:"W"==x?i.ItemInfo[M].CrushHoriz=0:"D"==x&&(i.ItemInfo[M].CrushD=0))}e.CrushD>0&&(e.D=e.RD,i.ItemInfo[M].D=e.RD,"N"==e.MDepthCrushed&&("H"==b?i.ItemInfo[M].CrushVert=0:"W"==b?i.ItemInfo[M].CrushHoriz=0:"D"==b&&(i.ItemInfo[M].CrushD=0)))}M++}}}else{l_allow_comb_crush=g_combinedShelfs[m][0].AllowAutoCrush;s=g_combinedShelfs[m].ItemInfo;if("N"==l_allow_comb_crush)for(const e of s)g_pog_json[t].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].W=g_pog_json[t].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].RW,g_pog_json[t].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].H=g_pog_json[t].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].RH,g_pog_json[t].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].D=g_pog_json[t].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].RD,g_pog_json[t].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].CrushHoriz=0,g_pog_json[t].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].CrushVert=0,g_pog_json[t].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].CrushD=0,g_pog_json[t].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].MHorizCrushed="N",g_pog_json[t].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].MVertCrushed="N",g_pog_json[t].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].MDepthCrushed="N";else"Y"==l_allow_comb_crush&&await crushItem(t,g_combinedShelfs[m][0].MIndex,g_combinedShelfs[m][0].SIndex,-1,"W","Y",-1,-1)}return logDebug("function : reset_auto_crush","E"),"SUCCESS"}async function find_select_module(e){logDebug("function : get_multiselect_obj","S");try{for(const e of g_pog_json[0].ModuleInfo)void 0!==e.ParentModule&&null!=e.ParentModule||0;var o=[];if("undefined"!=typeof g_pog_json&&g_pog_json.length>0){var _=g_pog_json[e].ModuleInfo,t=0;for(const e of _){if(null==e.ParentModule||"undefined"==e.ParentModule){var n=get_actual_mod_xy(e,e.W,e.H,e.X-e.W/2);detail_arr=n.split("###");var g=detail_arr[4],a=detail_arr[6],i=detail_arr[5],r=detail_arr[7];g_DragMouseStart.x<=g_DragMouseEnd.x&&g_DragMouseStart.y>=g_DragMouseEnd.y?g>=g_DragMouseStart.x&&a>=g_DragMouseStart.x&&i<=g_DragMouseStart.y&&r<=g_DragMouseStart.y&&g<=g_DragMouseEnd.x&&a<=g_DragMouseEnd.x&&i>=g_DragMouseEnd.y&&r>=g_DragMouseEnd.y&&o.push(t):g_DragMouseStart.x>=g_DragMouseEnd.x&&g_DragMouseStart.y>=g_DragMouseEnd.y?g>=g_DragMouseEnd.x&&a>=g_DragMouseEnd.x&&i>=g_DragMouseEnd.y&&r>=g_DragMouseEnd.y&&g<=g_DragMouseStart.x&&a<=g_DragMouseStart.x&&i<=g_DragMouseStart.y&&r<=g_DragMouseStart.y&&o.push(t):g_DragMouseStart.x<=g_DragMouseEnd.x&&g_DragMouseStart.y<=g_DragMouseEnd.y?g>=g_DragMouseStart.x&&a>=g_DragMouseStart.x&&i>=g_DragMouseStart.y&&r>=g_DragMouseStart.y&&g<=g_DragMouseEnd.x&&a<=g_DragMouseEnd.x&&i<=g_DragMouseEnd.y&&r<=g_DragMouseEnd.y&&o.push(t):g_DragMouseStart.x>=g_DragMouseEnd.x&&g_DragMouseStart.y<=g_DragMouseEnd.y&&g<=g_DragMouseStart.x&&a<=g_DragMouseStart.x&&i>=g_DragMouseStart.y&&r>=g_DragMouseStart.y&&g>=g_DragMouseEnd.x&&a>=g_DragMouseEnd.x&&i<=g_DragMouseEnd.y&&r<=g_DragMouseEnd.y&&o.push(t)}t++}}return console.log("mod_list",o),o}catch(e){error_handling(e)}}async function duplicate_drag_obj(e,o,_,t,n,g,a,i,r,s="Y"){logDebug("function : duplicate_drag_obj; i_final_x : "+e+"; p_final_y : "+o+"; pModIndex : "+_+"; pShelfIndex : "+t+"; i_shelf_edit_flag : "+n+"; i_module_edit_flag : "+g,"S");try{var l=-1,d=g_pog_json[i].ModuleInfo[_].ShelfInfo[t];if(g_dup_mod_list.length>0){var f=0;for(const D of g_pog_json[0].ModuleInfo){if((void 0===D.ParentModule||null==D.ParentModule)&&void 0!==g_dup_mod_list.find((e=>e==f))){g_module_edit_flag="Y",g_module_index=f,g_multiItemCopy="N",context_copy("S",i),g_cut_action_done="N",g_copy_action_done="N",g_dup_action_done="Y",g_delete_action_done="N",g_multi_delete_done="N",g_multi_copy_done="N";await context_paste("COPY",a,"Y",s,r,i);(O={}).MIndex=g_pog_json[r].ModuleInfo.length-1,O.MObjID=g_pog_json[r].ModuleInfo[g_pog_json[r].ModuleInfo.length-1].MObjID,O.SIndex="",O.SObjID="",O.ObjType=""}f++}g_dup_mod_list=[]}else if("Y"==n){var c=JSON.parse(JSON.stringify(d));c.ItemInfo=[];var I=d.AllowAutoCrush;g_cut_copy_arr[0].X=e,g_cut_copy_arr[0].Y=o,console.log("final x and y ",g_cut_copy_arr[0].X,g_cut_copy_arr[0].Y);var p="TEXTBOX"==c.ObjType?"N":"Y",[l,m,u,h]=get_curr_module(e,o,n,_,t,c,r),S=validate_shelf_min_distance(l,t,o,[],I,_,e,p,c,r);if("Y"==S||"R"==S||"TEXTBOX"==c.ObjType&&"N"==S){g_cut_action_done="N",g_copy_action_done="N",g_dup_action_done="Y",g_delete_action_done="N",g_multi_delete_done="N",g_multi_copy_done="N";f=0;for(const b of g_pog_json[r].ModuleInfo){if(parseFloat(e)>parseFloat(b.X)-b.W/2&&parseFloat(e)<parseFloat(b.X)+b.W/2&&parseFloat(o)>parseFloat(b.Y)-b.H/2&&parseFloat(o)<parseFloat(b.Y)+b.H/2&&(null==b.ParentModule||void 0===b.ParentModule)){l=f;break}f++}if(-1==l){f=0;for(const j of g_pog_json[r].ModuleInfo){if(null==j.ParentModule||void 0===j.ParentModule){l=f;break}f++}}async function v(){var[e,o,n]=await context_create_shelfs(g_cut_copy_arr[0],-1,-1,_,t,"N","Y",a,"Y","","Y",r),g={};g.MIndex=_,g.MObjID=g_pog_json[r].ModuleInfo[_].MObjID,g.SIndex=t,g.SObjID=d.SObjID,g.ObjType=d.ObjType;var i=[],s=o;i.moduleIndex=_,i.shelfIndex=t,i.actionType="DUPLICATE_SHELF",i.startCanvas=r,i.g_present_canvas=g_start_canvas,i.objectID=s,i.moduleObjectID=g_pog_json[r].ModuleInfo[_].MObjID,i.module=g_pog_json[r].ModuleInfo[_].Module,i.push(JSON.parse(JSON.stringify(d)));JSON.parse(JSON.stringify(d.ItemInfo));g_allUndoObjectsInfo.push(i),logFinalUndoObjectsInfo("SHELF_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","N"),g_allUndoObjectsInfo=[];var l=g_pog_json[r].ModuleInfo[_].ShelfInfo;l.sort(((e,o)=>e.Y>o.Y&&"NOTCH"!==e.ObjType&&"BASE"!==e.ObjType?1:-1)),l.sort(((e,o)=>e.Y>o.Y&&"NOTCH"!==e.ObjType&&"BASE"!==e.ObjType?1:-1));await calculateFixelAndSupplyDays("N",r)}if("TEXTBOX"==g_cut_loc_arr[0].ShelfObjType&&g_cut_support_obj_arr.length>0&&g_pog_json[r].ModuleInfo.push(g_cut_support_obj_arr[0]),_=l,g_cut_copy_arr[0].Shelf=g_pog_json[r].ModuleInfo[_].Module+(g_pog_json[r].ModuleInfo[_].ShelfInfo.length+1),g_pog_json[r].ModuleInfo[_].ShelfInfo.push(g_cut_copy_arr[0]),t=g_pog_json[r].ModuleInfo[_].ShelfInfo.length-1,g_cut_copy_arr[0].ItemInfo=[],v(),"N"==g_manual_zoom_ind){var O,x=(O=get_min_max_xy(r)).split("###");set_camera_z(a,parseFloat(x[2]),parseFloat(x[3]),parseFloat(x[0]),parseFloat(x[1]),g_offset_z,parseFloat(x[4]),parseFloat(x[5]),!0,g_pog_index)}}}else if("Y"==g){async function v(){await context_paste("COPY",a,"Y",s,r,i);var e={};e.MIndex=g_pog_json[r].ModuleInfo.length-1,e.MObjID=g_pog_json[r].ModuleInfo[g_pog_json[r].ModuleInfo.length-1].MObjID,e.SIndex="",e.SObjID="",e.ObjType=""}g_cut_action_done="N",g_copy_action_done="N",g_dup_action_done="Y",g_delete_action_done="N",g_multi_delete_done="N",g_multi_copy_done="N",res=await v()}else if("Y"==g_item_edit_flag){async function v(){var[g,l,d,f]=get_curr_module(e,o,n,_,t,c,r);_=g;await context_paste("COPY",a,"Y",s,r,i);var I={};I.MIndex=g_pog_json[r].ModuleInfo.length-1,I.MObjID=g_pog_json[r].ModuleInfo[g_pog_json[r].ModuleInfo.length-1].MObjID,I.SIndex="",I.SObjID="",I.ObjType=""}g_cut_action_done="N",g_copy_action_done="N",g_dup_action_done="Y",g_delete_action_done="N",g_multi_delete_done="N",g_multi_copy_done="N",console.log("g_multi_copy_done",g_multi_copy_done),res=await v(),async function(){await recreate_compare_views(g_compare_view,"N")}(),g_cut_copy_arr=[],g_cut_support_obj_arr=[],g_cut_loc_arr=[],loc_details={},g_undo_details=[],g_duplicating="N",g_drag_inprogress="N"}logDebug("function : duplicate_drag_obj","E")}catch(M){error_handling(M)}}function get_curr_module(e,o,_,t,n,g,a){logDebug("function : get_curr_module; i_final_x : "+e+"; p_final_y : "+o+"; i_shelf_edit_flag : "+_+"; p_module_index : "+t+"; p_shelf_index : "+n,"S");try{var i="N",r=-1,s=0,l=0,d=0,f="N",c="N";if(mod_top=0,-1==r){$.each(g_pog_json[a].ModuleInfo,(function(_,t){null!=t.ParentModule&&void 0!==t.ParentModule||$.each(t.ShelfInfo,(function(t,n){if("CHEST"==n.ObjType&&parseFloat(e)>parseFloat(n.X)-n.W/2&&parseFloat(e)<parseFloat(n.X)+n.W/2&&parseFloat(o)>parseFloat(n.Y)-n.H/2&&parseFloat(o)<parseFloat(n.Y)+n.H/2)return r=_,i="N",c="Y",!1}))}))}if("N"==c){for(let _=0;_<g_pog_json[a].ModuleInfo.length;_++){let t=g_pog_json[a].ModuleInfo[_];if(parseFloat(e)>parseFloat(t.X)-t.W/2&&parseFloat(e)<parseFloat(t.X)+t.W/2&&parseFloat(o)>parseFloat(t.Y)-t.H/2&&parseFloat(o)<parseFloat(t.Y)+t.H/2&&(null==t.ParentModule||void 0===t.ParentModule)){i="Y",r=_;break}{let _=-1,t=Number.MAX_VALUE;for(let n=0;n<g_pog_json[a].ModuleInfo.length;n++){let g=g_pog_json[a].ModuleInfo[n];if(null==g.ParentModule||void 0===g.ParentModule){let a=parseFloat(e)-parseFloat(g.X),i=parseFloat(o)-parseFloat(g.Y),r=Math.sqrt(a*a+i*i);r<t&&(t=r,_=n)}-1!==_&&(r=_,i="N")}if(-1==r)for(let e=0;e<g_pog_json[a].ModuleInfo.length;e++){let o=g_pog_json[a].ModuleInfo[e];if(null==o.ParentModule||void 0===o.ParentModule){r=e,i="N";break}}}}"Y"==_&&(0===g.Rotation&&0===g.Slope||($.each(g_pog_json[a].ModuleInfo,(function(e,o){null!=o.ParentModule&&void 0!==o.ParentModule||(s=Math.min(s,parseFloat(o.X)-o.W/2),l=Math.max(l,parseFloat(o.X)+o.W/2),mod_top=Math.max(mod_top,parseFloat(o.Y)+o.H/2),d=Math.min(d,parseFloat(o.Y)-o.H/2))})),e+g.ShelfRotateWidth/2>s&&e-g.ShelfRotateWidth/2<l&&o-g.ShelfRotateHeight/2<mod_top&&o+g.ShelfRotateHeight/2>d&&"TEXTBOX"!==g.ObjType&&0!==g.Rotation&&0==g.Slope?f="Y":($.each(g_pog_json[a].ModuleInfo,(function(o,_){if((null==_.ParentModule||void 0===_.ParentModule)&&parseFloat(e)>parseFloat(_.X)-_.W/2&&parseFloat(e)<parseFloat(_.X)+_.W/2)return r=o,i="N",!1})),-1==r&&$.each(g_pog_json[a].ModuleInfo,(function(e,o){if(null==o.ParentModule||void 0===o.ParentModule)return r=e,i="N",!1})))))}return logDebug("function : get_curr_module","E"),console.log("values",r,i,f,-1),[r,i,f,-1]}catch(e){error_handling(e)}}function replaceMenuKey(e,o,_){var t=e.trim(),n=t,g=n.toUpperCase().indexOf(_.toUpperCase());n=-1!=g?n.replace(n.charAt(g),"<b><u>"+n.charAt(g)+"</u></b>"):n+"(<b><u>"+_.toUpperCase()+"</u></b>)";var a=o;return a=a.replace(t,n)}function swapSpecialFixel(e,o,_){var t=new RegExp("["+e+"]/"),n=_.Shelf.replace(t,o);_.Shelf=n}function validate_shelf_inside_pegboard(e,o,_,t,n,g){var a=g_pog_json[_].ModuleInfo[e].ShelfInfo[o].ItemInfo,i=g_pog_json[_].ModuleInfo[e].ShelfInfo[o],r="Y",s=n+i.H/2,l=n-i.H/2,d=t-i.W/2,f=t+i.W/2;if(a.length>0){for(const t of a){if(item_start=wpdSetFixed(t.X-t.W/2),item_end=wpdSetFixed(t.X+t.W/2),item_top=wpdSetFixed(t.Y+t.H/2),item_bottom=wpdSetFixed(t.Y-t.H/2),g.ItemInfo.length>0)for(const t of g.ItemInfo){if(div_start=wpdSetFixed(t.X-t.W/2),div_end=wpdSetFixed(t.X+t.W/2),div_top=wpdSetFixed(t.Y+t.H/2),div_bottom=wpdSetFixed(t.Y-t.H/2),(div_start<item_end&&div_start>=item_start||div_end>item_start&&div_end<=item_end)&&(div_bottom<item_top&&div_bottom>=item_bottom||div_top<=item_top&&div_top>item_bottom)||(item_start<=div_start&&item_end>div_start||item_start<div_end&&item_end>=div_end)&&item_top<=div_top&&item_bottom>=div_bottom||(div_start<=item_start&&div_end>=item_end||div_start>=item_start&&div_end<=item_end)&&(div_top>=item_top&&item_bottom>=div_bottom||div_top>=item_top&&div_bottom<=item_bottom||div_top>item_top&&div_bottom<=item_top)||item_start<div_start&&item_end>=div_end&&item_top<=div_top&&item_top>div_bottom&&item_bottom<=div_bottom||item_start>div_start&&item_end<=div_end&&item_top>=div_top&&item_bottom<div_top&&item_bottom<=div_bottom||item_start<div_start&&item_end>=div_end&&item_top<=div_top&&item_bottom>=div_bottom||item_start<div_start&&item_end>=div_end&&item_top<div_top&&item_top>div_bottom||item_start>=div_start&&item_start<div_end&&item_bottom>=div_bottom&&item_bottom<div_top){r="N",g_pog_json[_].ModuleInfo[e].ShelfInfo[o].InsidePegboard="N";break}g_pog_json[_].ModuleInfo[e].ShelfInfo[o].InsidePegboard="Y"}else g_pog_json[_].ModuleInfo[e].ShelfInfo[o].InsidePegboard="Y";0}}else{var c=s,I=l,p=d,m=f;if(g.ItemInfo.length>0)for(const t of g.ItemInfo){if(div_start=wpdSetFixed(t.X-t.W/2),div_end=wpdSetFixed(t.X+t.W/2),div_top=wpdSetFixed(t.Y+t.H/2),div_bottom=wpdSetFixed(t.Y-t.H/2),(div_start<m&&div_start>=p||div_end>p&&div_end<=m)&&(div_bottom<c&&div_bottom>=I||div_top<=c&&div_top>I)||(p<div_start&&m>div_start||p<div_end&&m>=div_end)&&c<=div_top&&I>=div_bottom||(div_start<=p&&div_end>=m||div_start>=p&&div_end<=m)&&(div_top>=c&&I>=div_bottom||div_top>=c&&div_bottom<=I||div_top>c&&div_bottom<=c)||p<div_start&&m>=div_end&&c<=div_top&&c>div_bottom&&I<=div_bottom||p>div_start&&m<=div_end&&c>=div_top&&I<div_top&&I<=div_bottom||p<div_start&&m>=div_end&&c<=div_top&&I>=div_bottom||p<div_start&&m>=div_end&&c<div_top&&c>div_bottom||p>=div_start&&p<div_end&&I>=div_bottom&&I<div_top){r="N",g_pog_json[_].ModuleInfo[e].ShelfInfo[o].InsidePegboard="N";break}g_pog_json[_].ModuleInfo[e].ShelfInfo[o].InsidePegboard="Y"}else g_pog_json[_].ModuleInfo[e].ShelfInfo[o].InsidePegboard="Y"}for(const e of g_pog_json[_].ModuleInfo)for(const o of e.ShelfInfo)if("Y"==o.InsidePegboard&&o.SObjID!=i.SObjID){var u=wpdSetFixed(o.Y+o.H/2),h=wpdSetFixed(o.Y-o.H/2),S=wpdSetFixed(o.X-o.W/2),v=wpdSetFixed(o.X+o.W/2);if((S<f&&S>=d||v>d&&v<=f)&&(h<s&&h>=l||u<=s&&u>l)||(d<S&&f>S||d<v&&f>=v)&&s<=u&&l>=h||(S<=d&&v>=f||S>=d&&v<=f)&&(u>=s&&l>=h||u>=s&&h<=l||u>s&&h<=s)||d<S&&f>=v&&s<=u&&s>h&&l<=h||d>S&&f<=v&&s>=u&&l<u&&l<=h||d<S&&f>=v&&s<=u&&l>=h||d<S&&f>=v&&s<u&&s>h||d>=S&&d<v&&l>=h&&l<u){r="N";break}if(o.ItemInfo.length>0)for(const e of o.ItemInfo){var O=wpdSetFixed(e.Y+e.H/2),x=wpdSetFixed(e.Y-e.H/2),D=wpdSetFixed(e.X-e.W/2),b=wpdSetFixed(e.X+e.W/2);if((D<f&&D>=d||b>d&&b<=f)&&(x<s&&x>=l||O<=s&&O>l)||(d<D&&f>D||d<b&&f>=b)&&s<=O&&l>=x||(D<=d&&b>=f||D>=d&&b<=f)&&(O>=s&&l>=x||O>=s&&x<=l||O>s&&x<=s)||d<D&&f>=b&&s<=O&&s>x&&l<=x||d>D&&f<=b&&s>=O&&l<O&&l<=x||d<D&&f>=b&&s<=O&&l>=x||d<D&&f>=b&&s<O&&s>x||d>=D&&d<b&&l>=x&&l<O){r="N";break}}if(a.length>0)for(const e of a)if(drag_shelf_item_start=wpdSetFixed(e.X-e.W/2),drag_shelf_item_end=wpdSetFixed(e.X+e.W/2),drag_shelf_item_top=wpdSetFixed(e.Y+e.H/2),drag_shelf_item_bottom=wpdSetFixed(e.Y-e.H/2),o.ItemInfo.length>0)for(const e of o.ItemInfo){O=wpdSetFixed(e.Y+e.H/2),x=wpdSetFixed(e.Y-e.H/2),D=wpdSetFixed(e.X-e.W/2),b=wpdSetFixed(e.X+e.W/2);if((D<drag_shelf_item_end&&D>=drag_shelf_item_start||b>drag_shelf_item_start&&b<=drag_shelf_item_end)&&(x<drag_shelf_item_top&&x>=drag_shelf_item_bottom||O<=drag_shelf_item_top&&O>drag_shelf_item_bottom)||(drag_shelf_item_start<D&&drag_shelf_item_end>D||drag_shelf_item_start<b&&drag_shelf_item_end>=b)&&drag_shelf_item_top<=O&&drag_shelf_item_bottom>=x||(D<=drag_shelf_item_start&&b>=drag_shelf_item_end||D>=drag_shelf_item_start&&b<=drag_shelf_item_end)&&(O>=drag_shelf_item_top&&drag_shelf_item_bottom>=x||O>=drag_shelf_item_top&&x<=drag_shelf_item_bottom||O>drag_shelf_item_top&&x<=drag_shelf_item_top)||drag_shelf_item_start<D&&drag_shelf_item_end>=b&&drag_shelf_item_top<=O&&drag_shelf_item_top>x&&drag_shelf_item_bottom<=x||drag_shelf_item_start>D&&drag_shelf_item_end<=b&&drag_shelf_item_top>=O&&drag_shelf_item_bottom<O&&drag_shelf_item_bottom<=x||drag_shelf_item_start<D&&drag_shelf_item_end>=b&&drag_shelf_item_top<=O&&drag_shelf_item_bottom>=x||drag_shelf_item_start<D&&drag_shelf_item_end>=b&&drag_shelf_item_top<O&&drag_shelf_item_top>x||drag_shelf_item_start>=D&&drag_shelf_item_start<b&&drag_shelf_item_bottom>=x&&drag_shelf_item_bottom<O){r="N";break}}}return r}function makeResizableRow(){const e=$("#t_Body_nav").width(),o=$("#top_bar").height(),_=$("#t_Header").height(),t=$("#resizeLine"),n=$("#canvas-holder .container")[0];var g,a,i,r,s,l,d,f,c=$("#canvas-holder .container .row").length,I=!1,p=-1,m=-1;if(c>1)for(var u=1;u<c;u++){$("#canvas-holder .container .row")[u].addEventListener("mousedown",h)}function h(t){if(!g_dragging&&!I&&(console.log(t.target.className),"row"==t.target.className)){t.preventDefault(),window.addEventListener("mousemove",S),window.addEventListener("mouseup",v),I=!0,g=$("#canvas-holder .container")[0].className.replace("container","").replace("-view","").toUpperCase().trim(),p=parseInt($(t.srcElement).attr("data-row")),m=p-1;var l=(f=n.getBoundingClientRect()).right,d=f.bottom,c=f.left,u=f.top;a=Math.round(c)-e-1+150,r=Math.round(l)-e-1-150,i=Math.round(u)-o-_-1+150,s=Math.round(d)-o-_-1-150}}function S(n){if(I){var c=n.clientX-e,p=n.clientY-o-_;if("H"==g)t.css("width","1px"),t.css("height",f.height+"px"),t.css("top",f.top-o-_-1+"px"),c>a&&c<r&&(l=n.clientX,t.css("left",c+"px"));else{if("V"!=g)return I=!1,window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",v),t.css("width","0px"),t.css("height","0px"),t.css("left","0px"),void t.css("top","0px");t.css("width",f.width+"px"),t.css("height","1px"),t.css("left",f.left-e-1+"px"),p>i&&p<s&&(d=n.clientY,t.css("top",p+"px"))}}}function v(e){if(I&&-1!==typeof p&&-1!==m){var o,_,n,f,c,u,h,x=$("[data-row = "+p+"] .canvas-content"),D=$("[data-row = "+m+"] .canvas-content"),b=$("[data-row="+p+"]")[0].getBoundingClientRect(),j=$("[data-row="+m+"]")[0].getBoundingClientRect();if(window.removeEventListener("mousemove",S),t.css("width","0px"),t.css("height","0px"),t.css("left","0px"),t.css("top","0px"),"H"==g)c=e.clientX>=a&&e.clientX<=r?e.clientX:l,b.left>c&&j.right>c||b.left<c&&j.right<c?(o=b.width+(b.left-c),n=j.width-(j.right-c)):(o=b.width,n=j.width),$("[data-row="+p+"] .canvas-content").css("width",o+"px"),$("[data-row="+m+"] .canvas-content").css("width",n+"px"),_=b.height,f=j.height;else{if("V"!=g)return window.removeEventListener("mouseup",v),void(I=!1);u=e.clientY>=i&&e.clientY<=s?e.clientY:d,b.top>u&&j.bottom>u||b.top<u&&j.bottom<u?(_=b.height+(b.top-u),f=j.height-(j.bottom-u)):(_=b.height,f=j.height),$("[data-row="+p+"] .canvas-content").css("height",_+"px"),$("[data-row="+m+"] .canvas-content").css("height",f+"px"),o=b.width,n=j.width}for(elm of(g_renderer.setPixelRatio(window.devicePixelRatio),x)){var M=$(elm).attr("id"),E=$("#"+M+" .canvasregion").attr("data-indx"),P=$("#"+M+" .canvasregion").attr("id");h=$("#"+M+" .canvas-buttons").height(),O(E,P,$(elm).width(),$(elm).height()-h)}for(elm of D){M=$(elm).attr("id"),E=$("#"+M+" .canvasregion").attr("data-indx"),P=$("#"+M+" .canvasregion").attr("id");h=$("#"+M+" .canvas-buttons").height(),O(E,P,$(elm).width(),$(elm).height()-h)}$("#canvas-holder .container").css("display","block !important"),window.removeEventListener("mouseup",v),I=!1}}function O(e,o,_,t){var n=g_scene_objects[e].scene.children[0],g=get_min_max_xy(e).split("###");g_canvas_objects[e]=document.getElementById(o),g_canvas_objects[e].width=_,g_canvas_objects[e].height=t,$("#"+o).width(_),$("#"+o).height(t),n.aspect=_/t,n.updateProjectionMatrix(),g_scene_objects[e].scene.children[0]=n,set_camera_z(n,parseFloat(g[2]),parseFloat(g[3]),parseFloat(g[0]),parseFloat(g[1]),g_offset_z,parseFloat(g[4]),parseFloat(g[5]),!0,e),context=g_canvas_objects[e].getContext("2d"),g_renderer.setSize(_,t),n.aspect=_/t,g_renderer.render(g_scene_objects[e].scene,n),context.drawImage(g_renderer.domElement,0,0,_,t),n.updateProjectionMatrix(),g_scene_objects[e].scene.children[0]=n,set_camera_z(n,parseFloat(g[2]),parseFloat(g[3]),parseFloat(g[0]),parseFloat(g[1]),g_offset_z,parseFloat(g[4]),parseFloat(g[5]),!0,e)}}function openItemSubLabel(e){try{var o="N";if(g_pog_json.length>0){var _=-1;_="Y"==g_all_pog_flag?0:g_pog_index,""!==e&&(o="Y");var t=g_pog_index;g_delete_details.is_dragging="Y",$("#item_sublbl_sub .items").removeClass("item_sublabel_active"),""==e?($(".item_sublabel").removeClass("item_sublabel_active"),$("#item_sublbl_sub .items").removeClass("item_sublabel_active")):($(".item_sublabel").addClass("item_sublabel_active"),$("#item_sublbl_sub ."+e).addClass("item_sublabel_active"));for(const t of g_pog_json){if((_!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex)&&(g_renderer=g_scene_objects[_].renderer,g_scene=g_scene_objects[_].scene,g_camera=g_scene_objects[_].scene.children[0],showItemSubLabel(e,o,$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_ITEM_NUM_LABEL_POS"),_),set_indicator_objects(_)),"N"==g_all_pog_flag)break;_++}g_scene_objects.length>0&&(g_renderer=g_scene_objects[t].renderer,g_scene=g_scene_objects[t].scene,g_camera=g_scene_objects[t].scene.children[0]),g_delete_details.is_dragging="N"}}catch(e){error_handling(e)}}function checkChestCrushedItemHit(e,o,_,t,n,g){try{var a=0,i=wpdSetFixed(e-_/2),r=wpdSetFixed(e+_/2),s=wpdSetFixed(o+t/2),l=wpdSetFixed(o-t/2);const p=wpdSetFixed(n.X-n.W/2),m=wpdSetFixed(n.X+n.W/2),u=wpdSetFixed(n.Y-n.H/2),h=wpdSetFixed(n.Y+n.H/2);for(const e of n.ItemInfo){if(a!==g){var d=wpdSetFixed(e.X-e.W/2),f=wpdSetFixed(e.X+e.W/2),c=wpdSetFixed(e.Y+e.H/2),I=wpdSetFixed(e.Y-e.H/2);if(s<I||l>c||r<d||i>f){if(s>h||l<u||i<p||r>m)return"Y"}else if((d<r&&d>=i||f>i&&f<=r)&&(I<s&&I>=l||c<=s&&c>l)||(i<d&&r>d||i<f&&r>=f)&&s<=c&&l>=I||(d<=i&&f>=r||d>=i&&f<=r)&&(c>=s&&l>=I||c>=s&&I<=l||c>s&&I<=s)||i<d&&r>=f&&s<=c&&s>I&&l<=I||i>d&&r<=f&&s>=c&&l<c&&l<=I||i<d&&r>=f&&s<=c&&l>=I||i<d&&r>=f&&s<c&&s>I||i>=d&&i<f&&l>=I&&l<c)return"Y"}a++}return"N"}catch(e){error_handling(e)}}function getChestOverlappedItemDimension(e,o,_,t,n){try{const S=wpdSetFixed(e-_/2),v=wpdSetFixed(e+_/2),O=wpdSetFixed(o+t/2),x=wpdSetFixed(o-t/2);var g,a,i,r,s=0,l=0,d=0,f=0,c=0,I=0,p="N",m="N";"CHEST"==nvl(n.ObjType)?(g=wpdSetFixed(n.Y+n.H/2),a=wpdSetFixed(n.Y-n.H/2),i=wpdSetFixed(n.X-n.W/2),r=wpdSetFixed(n.X+n.W/2),O>g&&(l=c=O-g,m="Y"),x<a&&(l+=I=a-x,m="Y"),S<i&&(s=d=i-S,m="Y"),v>r&&(s+=f=v-r,m="Y")):(g=wpdSetFixed(n.Y+n.H/2),a=wpdSetFixed(n.Y-n.H/2),i=wpdSetFixed(n.X-n.W/2),r=wpdSetFixed(n.X+n.W/2),((i<v&&i>=S||r>S&&r<=v)&&(a<O&&a>=x||g<=O&&g>x)||(S<i&&v>i||S<r&&v>=r)&&O<=g&&x>=a||(i<=S&&r>=v||i>=S&&r<=v)&&(g>=O&&x>=a||g>=O&&a<=x||g>O&&a<=O)||S<i&&v>=r&&O<=g&&O>a&&x<=a||S>i&&v<=r&&O>=g&&x<g&&x<=a||S<i&&v>=r&&O<=g&&x>=a||S<i&&v>=r&&O<g&&O>a||S>=i&&S<r&&x>=a&&x<g)&&(O>a&&a>x&&!(x<g&&g<O)&&(l=c=O-a,p="Y"),x<g&&g<O&&!(O>a&&a>x)&&(l+=I=g-x,p="Y"),S<r&&r<v&&!(v>i&&i>S)&&(s=d=r-S,p="Y"),v>i&&i>S&&!(S<r&&r<v)&&(s+=f=v-i,p="Y")));const D=Math.ceil(s/_*100),b=Math.ceil(l/t*100),j=wpdSetFixed(_*(1-D/100)),M=wpdSetFixed(t*(1-b/100));var u=e,h=o;return 0!==D&&(u=f>d?"Y"==m?r-j/2:i-j/2:"Y"==m?i+j/2:r+j/2),0!==b&&(h=c>I?"Y"==m?g-M/2:a-M/2:"Y"==m?a+M/2:g+M/2),"Y"==p||"Y"==m?0==D&&0!==b?[e,h,_,M,0,b]:0!==D&&0==b?[u,o,j,t,D,0]:0!==D&&0!==b?"Y"==m?[u,h,j,M,D,b]:D>b?[e,h,_,M,0,b]:[u,o,j,t,D,0]:[e,o,_,t,0,0]:[e,o,_,t,0,0]}catch(e){error_handling(e)}}function crushChestItemHW(e,o,_,t,n,g,a,i,r,s){try{var l=0,d=o.RH+nvl(o.CapHeight),f=o.RW,c=o.X,I=o.Y,p=[],m=wpdSetFixed(c-f/2),u=wpdSetFixed(c+f/2),h=wpdSetFixed(I+d/2),S=wpdSetFixed(I-d/2);for(const o of e.ItemInfo){if(l!==_){var v=wpdSetFixed(o.X-o.W/2),O=wpdSetFixed(o.X+o.W/2),x=wpdSetFixed(o.Y+o.H/2);h<wpdSetFixed(o.Y-o.H/2)||S>x||u<v||m>O||p.push(o)}l++}var D=wpdSetFixed(e.X-e.W/2),b=wpdSetFixed(e.X+e.W/2),j=wpdSetFixed(e.Y-e.H/2);(h>wpdSetFixed(e.Y+e.H/2)||S<j||m<D||u>b)&&p.push(e);var M=[];const A=5040;if(p.length<=7)M=permuteArrayOfArrays(p);else for(var E=0;E<A;E++){var P=p.slice().sort((()=>Math.random()-.5));M.push(P)}var C=[];for(const e of M){var[N,T,y,R]=[c,I,f,d],w=0,F=0,Y=0,H=0;for(const o of e)[N,T,y,R,w,F]=getChestOverlappedItemDimension(N,T,y,R,o),Y+=w,H+=F;C.push({ItemW:y,ItemH:R,ItemX:N,ItemY:T,FinalWidthCrushPerc:Y,FinalHeightCrush:H,Area:y*R})}var L=getObjectWithHighestValue(C,"Area");N=L.ItemX,T=L.ItemY,y=L.ItemW,R=L.ItemH;Y=L.FinalWidthCrushPerc,H=L.FinalHeightCrush;if("Y"==s){if(Y<=n&&H<=t&&"N"==g&&"N"==a)return o.W=y,o.X=N,o.WChanged="Y","W"==r?o.CrushHoriz=Y:"H"==r?o.CrushVert=Y:"D"==r&&(o.CrushD=Y),o.H=R,o.Y=T,o.HChanged="Y","H"==i?o.CrushVert=H:"W"==i?o.CrushHoriz=H:"D"==i&&(o.CrushD=H),g_error_category="","Y";if("Y"==g||"Y"==a){const s=wpdSetFixed(f-f*(n/100)),l=wpdSetFixed(d-d*(t/100));return"N"==checkChestCrushedItemHit(o.X,o.Y,"Y"==g?s:f,"Y"==a?l:o.H,e,_)?("Y"==g&&(o.W=s,o.WChanged="Y","W"==r?o.CrushHoriz=n:"H"==r?o.CrushVert=n:"D"==r&&(o.CrushD=n)),"Y"==a&&(o.H=l,o.HChanged="Y","H"==i?o.CrushVert=t:"W"==i?o.CrushHoriz=t:"D"==i&&(o.CrushD=t)),g_error_category="","Y"):(g_error_category="W","N")}return g_error_category="W","N"}return g_error_category="","Y"}catch(e){error_handling(e)}}function isShelfOverlapShelf(e,o,_,t,n,g,a,i){try{const r=Math.abs(wpdSetFixed(e-n))<wpdSetFixed(_/2+a/2),s=Math.abs(wpdSetFixed(o-g))<wpdSetFixed(t/2+i/2);return r&&s}catch(e){error_handling(e)}}function getAutofillModShelf(e,o,_,t,n){try{var g=wpdSetFixed(Math.min(e.x,o.x)),a=wpdSetFixed(Math.max(e.x,o.x)),i=wpdSetFixed(Math.max(e.y,o.y)),r=wpdSetFixed(Math.min(e.y,o.y)),s=[],l=[],d=0,f=0;for(const e of _[t].ModuleInfo){if(null==e.ParentModule){const o=wpdSetFixed(e.X-e.W/2),_=wpdSetFixed(e.X+e.W/2),t=wpdSetFixed(e.Y+e.H/2),n=wpdSetFixed(e.Y-e.H/2),l=Math.max(g,o),c=Math.min(a,_),I=Math.min(i,t),p=Math.max(r,n);if(l<c&&p<I){const g=c-l;g>d&&(d=g,s[0]={moduleInfo:e,dragStart:l,dragEnd:c,dragTop:I,dragBottom:p,modStart:o,modEnd:_,modTop:t,modBottom:n,modIdx:f})}}f++}if(f=0,s.length>0){for(const e of g_mod_block_list){if(void 0===e||null==e||void 0===e.BlkModInfo||null==e.BlkModInfo||0==e.BlkModInfo.length||void 0===e.BlkModInfo[0]||null==e.BlkModInfo[0]||void 0===e.BlockDim||null==e.BlockDim||void 0===e.BlockDim.FinalTop||void 0===e.BlockDim.FinalBtm)continue;const o=e.BlkModInfo[0];if(void 0!==o.dragStart&&void 0!==o.dragEnd&&(o.dragStart<s[0].dragEnd&&o.dragEnd>s[0].dragStart&&e.BlockDim.FinalTop>s[0].dragBottom&&e.BlockDim.FinalBtm<s[0].dragTop)){if(o.dragEnd>s[0].dragStart&&o.dragEnd<s[0].dragEnd&&(s[0].dragStart=o.dragEnd),o.dragStart<s[0].dragEnd&&s[0].dragStart<o.dragStart&&(s[0].dragEnd=o.dragStart),s[0].dragStart>=o.dragStart&&s[0].dragEnd<=o.dragEnd)return[s=[],l=[]];g_DragMouseStart.x=s[0].dragStart,g_DragMouseEnd.x=s[0].dragEnd}}for(const e of s[0].moduleInfo.ShelfInfo){if("TEXTBOX"!=e.ObjType&&"DIVIDER"!=e.ObjType&&"BASE"!=e.ObjType&&"DIVIDER"!=e.ObjType){const o=wpdSetFixed(e.X-e.W/2),_=wpdSetFixed(e.X+e.W/2),t=wpdSetFixed(e.Y+e.H/2),n=wpdSetFixed(e.Y-e.H/2);if(g<_&&a>o&&i>n&&r<t){const t=Math.min(a,_)-Math.max(g,o);l.push({ShelfInfo:e,OverlapWidth:t,ShelfIdx:f})}}f++}}else s=[],l=[];return[s,l]}catch(e){error_handling(e)}}async function setAutofillBlock(e,o,_="N",t="Y",n="#ffffff"){try{var g={},a=[],i=[],r=[],s=[],l={},d=o;if("Y"==_){var f=[];for(const e of g_mod_block_list){(x={}).BlkColor=e.BlkColor,x.BlkName=e.BlkName,x.BlkRule=e.BlkRule,x.BlkFilters=e.BlockFilters.join(" AND "),x.OldBlkName=e.BlkName,e.BlkFilters=x.BlkFilters,f.push(x)}closeInlineDialog("block_details");await save_blk_dtl_coll(e,o,f)}s=o==d&&"U"==e?[]:[d],g.BlkName=d,g.BlkColor="N"==t?n:$v("P193_BLK_COLOR"),g.BlkRule=$v("P193_BLK_RULE");var c=[],I=[],p=[];if(!("U"===e||Array.isArray(g_autofillModInfo)&&0!=g_autofillModInfo.length&&Array.isArray(g_autofillShelfInfo)&&0!=g_autofillShelfInfo.length))return!1;if("U"!==e){g.DragMouseStart=g_DragMouseStart,g.DragMouseEnd=g_DragMouseEnd,g.BlkModInfo=g_autofillModInfo,g.BlkShelfInfo=g_autofillShelfInfo;for(const e of g_autofillShelfInfo)e.ShelfInfo.BlkName=d,e.ShelfInfo.MIndex=g_autofillModInfo[0].modIdx,e.ShelfInfo.SIndex=e.ShelfIdx,c.push(e.ShelfInfo);I.push(g_autofillModInfo[0].modIdx),I.sort(),p=c}else{for(const e of g_mod_block_list)if(e.BlkName==o){p=e.g_delete_details,I=e.mod_index,g.DragMouseStart=e.DragMouseStart,g.DragMouseEnd=e.DragMouseEnd;break}for(const e of p)e.BlkName=g.BlkName;g_DragMouseStart=g.DragMouseStart,g_DragMouseEnd=g.DragMouseEnd}if(g.g_delete_details=p,"N"!=t){var m=apex.region("block_filters").widget().interactiveGrid("getViews","grid").model;m.forEach((function(e){var o="object"==typeof m.getValue(e,"FILTER")?m.getValue(e,"FILTER").v:m.getValue(e,"FILTER"),_=m.getValue(e,"VALUE");if(r.push(o+"#"+_),""!==o){var t=o.split("-");i.push(t[0]),a.push(t[0]+" = "+("C"==t[1]?'"':"")+_+("C"==t[1]?'"':""))}}))}for(const e of g_mod_block_list)s.push(e.BlkName);var u=findDuplicates(s),h=findDuplicates(i);if(u.length>0)alert(get_message("POGCR_BLK_DUP"));else if(h.length>0)alert(get_message("POGCR_DUP_REC_FOUND"));else if(!i.includes("SUBCLASS")||i.includes("CLASS")&&i.includes("DEPT"))if(i.includes("CLASS")&&!i.includes("DEPT"))alert(get_message("POGCR_DEPT_MANDATE"));else{if(g.BlockFilters=a,g.FilterVal=r,g.mod_index=I,"U"==e){for(const e of g_mod_block_list)if(e.BlkName==o)for(const _ of e.BlockDim.ColorObj.children)if(_.uuid==o){e.BlockDim.ColorObj.remove(_);break}var S=0;for(const e of g_mod_block_list)e.BlkName==o&&(l=JSON.parse(JSON.stringify(e)),g_mod_block_list.splice(S,1)),S++}"N"!=t&&(apex.region("block_filters").widget().interactiveGrid("getActions").set("edit",!1),apex.region("block_filters").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("block_filters").refresh(),clear_blinking());var v="N"==t?n:$v("P193_BLK_COLOR"),O=await colorAutofillBlock(g_DragMouseStart,g_DragMouseEnd,I,v,d,e,l,g_pog_index);if(void 0===O||null==O)return!1;if(g.BlockDim=O,g_mod_block_list.push(g),closeInlineDialog("block_details"),"U"==e){var x={};f=[];for(const e of g_mod_block_list){if(e.BlkName!==d&&e.BlkName!==o)(x={}).BlkColor=e.BlkColor,x.BlkName=e.BlkName,x.BlkRule=e.BlkRule,x.BlkFilters=e.BlockFilters.join(" AND "),x.OldBlkName=e.BlkName,e.BlkFilters=x.BlkFilters,f.push(x);else if(e.BlkName==o||e.BlkName==d){(x={}).BlkColor=$v("P193_BLK_COLOR"),x.BlkName=d,x.BlkRule=$v("P193_BLK_RULE"),x.BlkFilters=a.join(" AND "),x.OldBlkName=o,e.BlkFilters=x.BlkFilters,f.push(x)}}await save_blk_dtl_coll(e,o,f)}else if("Y"==e){f=[];for(const e of g_mod_block_list){(x={}).BlkColor=e.BlkColor,x.BlkName=e.BlkName,x.BlkRule=e.BlkRule,x.BlkFilters=e.BlockFilters.join(" AND "),e.BlkFilters=x.BlkFilters,f.push(x)}await save_blk_dtl_coll(e,o,f)}else if("A"==e&&"N"!=t){f=[];for(const e of g_mod_block_list){(x={}).BlkColor=e.BlkColor,x.BlkName=e.BlkName,x.BlkRule=e.BlkRule,x.BlkFilters=e.BlockFilters.join(" AND "),e.BlkFilters=x.BlkFilters,f.push(x)}await save_blk_dtl_coll(e,o,f);return!0}}else alert(get_message("POGCR_DEPT_CLASS_MANDATE"))}catch(e){return error_handling(e),!1}}async function colorAutofillBlock(e,o,_,t,n,g,a,i,r){try{var s=0,l=0,d=0,f=0,c=parseInt($v("P193_POGCR_BLK_TXT_SIZE"));if(!Array.isArray(g_autofillModInfo)||0==g_autofillModInfo.length)return null;if(!Array.isArray(_)||0==_.length)return null;if(void 0===g_pog_json[i]||null==g_pog_json[i]||void 0===g_pog_json[i].ModuleInfo||void 0===g_pog_json[i].ModuleInfo[_[0]])return null;c=parseInt($v("P193_POGCR_BLK_TXT_SIZE"));var I=g_autofillModInfo[0].dragBottom,p=g_autofillModInfo[0].dragTop,m=g_autofillModInfo[0].modTop,u=g_autofillModInfo[0].modBottom,h=g_pog_json[i].ModuleInfo[_[0]].ShelfInfo,S=-1,v=-1;if("U"!==g){S=get_below_shelf(h,_[0],I,i);f=(v=get_above_shelf(h,_[0],p,m,i))-S,d=g_autofillModInfo[0].dragEnd-g_autofillModInfo[0].dragStart,s=g_autofillModInfo[0].dragStart+(g_autofillModInfo[0].dragEnd-g_autofillModInfo[0].dragStart)/2-g_pog_json[i].ModuleInfo[_[0]].X;if(g_pog_json[i].ModuleInfo[_[0]].Y<S)l=S-g_pog_json[i].ModuleInfo[_[0]].Y+f/2;else l=0-(g_pog_json[i].ModuleInfo[_[0]].Y-S)+f/2}else s=a.BlockDim.CalcX,l=a.BlockDim.CalcY,d=a.BlockDim.BlkWidth,f=a.BlockDim.BlkHeight,v=a.BlockDim.FinalTop,S=a.BlockDim.FinalBtm;if(!Number.isFinite(d)||!Number.isFinite(f)||d<=0||f<=0)return null;if(!Number.isFinite(s)||!Number.isFinite(l))return null;var O=parseInt(t.replace("#","0x"),16);new THREE.Color(O);"string"!=typeof n&&(n="BLK"),n.endsWith("_AFP")&&(n=n.slice(0,-4)),console.log("val",e,o,_[0],t,n),console.log("calc_height",d,f,l,v,m,S,u);let b=dcText(n,c,0,O,d,f,"N","N","Arial","",c,0,-1,4);if(!b)return null;var x=g_world.getObjectById(g_pog_json[i].ModuleInfo[_[0]].MObjID);if(!x||"function"!=typeof x.add)return null;x.add(b),b.uuid=n+"_AFP",b.material&&(b.material.opacity=.5),b.position&&(b.position.x=s,b.position.y=l,b.position.z=.009),render(i),g_delete_details=[],g_mselect_drag="N";var D={};if(D.CalcX=s,D.CalcY=l,D.CalcZ=.009,D.BlkWidth=d,D.BlkHeight=f,D.ColorObj=x,D.FinalTop=v,D.FinalBtm=S,"Y"==r){for(shelfs of(g_DragMouseStart.x=e.x,g_DragMouseStart.y=e.y,g_DragMouseEnd.x=o.x,g_DragMouseEnd.y=o.y,await get_multiselect_obj(i),a.g_delete_details=[],g_delete_details))a.g_delete_details.push(shelfs);g_delete_details=[]}return D}catch(e){return console.warn("colorAutofillBlock skipped due to invalid render state:",e),null}}g_show_error=!0,g_pog_json=[],g_mod_block_list=[],g_pog_edited_ind="Y",g_auto_fill_active="N",g_autofillModInfo=[],g_autofillShelfInfo=[],g_autofill_detail={},g_allUndoObjectsInfo=[],g_deletedItems=[],g_delete_details=[],g_ComViewIndex=-1,g_show_changes_block_snapshot=[],g_show_live_image="N",g_selected_block=[],window.addEventListener("load",(function(){for(var e=document.querySelectorAll(".disclosure-nav"),o=[],_=0;_<e.length;_++)o[_]=new DisclosureNav(e[_]);var t=document.getElementById("arrow-behavior-switch");t&&t.addEventListener("change",(function(){for(var e=t.checked,_=0;_<o.length;_++)o[_].updateKeyControls(e)})),o.forEach(((o,_)=>{for(var t=e[_].querySelectorAll('[href="#mythical-page-content"]'),n=document.getElementById("mythical-page-heading"),g=0;g<t.length;g++)t[g].href="#mythical-page-content",t[g].addEventListener("click",(e=>{var o=e.target.innerText;n.innerText=o;for(var _=0;_<t.length;_++)t[_].removeAttribute("aria-current");e.target.setAttribute("aria-current","page")}))}))}),!1);var g_current_highlighted_block=null;function _getRenderableMesh(e){if(!e)return null;if("Mesh"===e.type)return e;if("Group"===e.type||"Object3D"===e.type){const o=e.getObjectByProperty&&e.getObjectByProperty("type","Mesh");if(o)return o;let _=null;return e.traverse((e=>{_||"Mesh"!==e.type||(_=e)})),_}return null}function clearAutofillBlockHighlight(){try{if(!g_current_highlighted_block||!Array.isArray(g_mod_block_list))return;for(const o of g_mod_block_list)if(o.BlkName===g_current_highlighted_block&&o.BlockDim&&o.BlockDim.ColorObj){var e=_getRenderableMesh(o.BlockDim.ColorObj.getObjectByProperty("uuid",g_current_highlighted_block));if(e&&e.userData&&e.userData._outline)try{e.userData._outlineInterval&&(clearInterval(e.userData._outlineInterval),e.userData._outlineInterval=null),e.userData._outline&&e.userData._outline.parent&&e.userData._outline.parent.remove(e.userData._outline),e.userData._outline=null}catch(e){console.warn(e)}break}}catch(e){console.warn(e)}finally{g_current_highlighted_block=null;try{render()}catch(e){}}}function highlightAutofillBlock(e,o){try{if(!e||!Array.isArray(g_mod_block_list))return;g_current_highlighted_block&&g_current_highlighted_block!==e&&clearAutofillBlockHighlight();for(const i of g_mod_block_list)if(i.BlkName===e&&i.BlockDim&&i.BlockDim.ColorObj){var _=_getRenderableMesh(i.BlockDim.ColorObj.getObjectByProperty("uuid",e));if(!_)return;if(_.userData&&_.userData._outline)return _.userData._outline.visible=!0,g_current_highlighted_block=e,void render(o);try{var t=null;t=_.geometry?_.geometry:new THREE.Geometry;var n=new THREE.EdgesGeometry(t),g=new THREE.LineBasicMaterial({color:16776960,linewidth:2}),a=new THREE.LineSegments(n,g);a.position.set(0,0,0),a.rotation.set(0,0,0),a.scale.set(1,1,1),_.add(a),_.userData||(_.userData={}),_.userData._outline=a,_.userData._outlineInterval=setInterval((function(){try{if(_.userData&&_.userData._outline){_.userData._outline.visible=!_.userData._outline.visible;try{render(o)}catch(e){}}}catch(e){}}),500),g_current_highlighted_block=e,render(o)}catch(e){console.warn(e)}break}}catch(e){console.warn(e)}}function validateShelfWithFixedItem(e,o,_,t){try{var n=wpdSetFixed(e.X-e.W/2),g=wpdSetFixed(e.X+e.W/2),a=[],i="N",r=[],s=0;for(const e of t)e.IIndex=s,"Y"==e.Fixed?(r.push(e),0!==s&&(a.push(r),(r=[]).push(e)),i="Y"):(r.push(e),i="N"),s++;for(splitShelfItems of("N"==i&&a.push(r),a)){var l=0,d=n,f=g;for(item of splitShelfItems)"Y"==item.Fixed&&(0==l&&(d=wpdSetFixed(item.X+item.W/2)),l==splitShelfItems.length-1&&(f=wpdSetFixed(item.X-item.W/2))),l++;var c=f-d;for(item of splitShelfItems)"N"!=item.Fixed||void 0!==item.BottomObjID&&""!==item.BottomObjID||(c=item.BHoriz>1&&"F"==o?wpdSetFixed(c-(item.W+_*(item.BHoriz-1))):wpdSetFixed(c-item.W));if(c<0)return!0}return!1}catch(e){error_handling(e)}}function open_draft(){g_color_arr=[],g_highlightArr=[],"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&"Y"==g_pog_edited_ind?confirm(get_message("POGCR_CHANGE_REVERT_WARN"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){openCustomDialog("OPEN_DRAFT",$v("P193_OPEN_DRAFT_URL"),"P193_DRAFT_TRIGGER_ELEMENT")})):openCustomDialog("OPEN_DRAFT",$v("P193_OPEN_DRAFT_URL"),"P193_DRAFT_TRIGGER_ELEMENT"),g_dblclick_opened="Y"}function openCustomDialog(e,o,_){try{$s(_,e),apex.navigation.redirect(o)}catch(e){error_handling(e)}}function open_pog(){try{logDebug("function : open_pog","S"),$s("P193_OPEN_POG_CODE",""),$s("P193_DIVISION",""),$s("P193_EXISTING_POG_TYPE","R"),$s("P193_POG_STATUS",""),$s("P193_DRAFT_LIST",""),$s("P193_POG_DESCRIPTION",""),$s("P193_EXISTING_DRAFT_VER",""),$s("P193_MULTI_POG_CODE",""),sessionStorage.removeItem("g_color_arr"),sessionStorage.removeItem("g_highlightArr"),g_highlightArr=[],g_dblclick_opened="Y","undefined"!=typeof g_pog_json&&g_pog_json.length>0&&"Y"==g_pog_edited_ind?confirm(get_message("POGCR_CHANGE_REVERT_WARN"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){openCustomDialog("OPEN_EXITPOG",$v("P193_EXIST_POG_URL"),"P193_EXISTPOG_TRIGGER_ELEMENT")})):openCustomDialog("OPEN_EXITPOG",$v("P193_EXIST_POG_URL"),"P193_EXISTPOG_TRIGGER_ELEMENT"),logDebug("function : open_pog","E")}catch(e){error_handling(e)}}async function open_draft_pog(e="N",o,_){if(null!==o)var t=JSON.parse(o);g_pog_json=[],g_mod_block_list=[],g_show_changes_block_snapshot=[],sessionStorage.removeItem("g_combinedShelfs"),sessionStorage.removeItem("combinedShlfDets"),g_combinedShelfs=[];var n=[];g_scene_objects=[],g_canvas_objects=[],appendMultiCanvasRowCol(1,$v("P_POGCR_TILE_VIEW")),$("#canvas-list-holder").html("");for(const e of t)n.push(parseInt(e.SequenceID));if(1==t.length){var g=t[0].SequenceID,a=t[0].DescriptionDetails,i=t[0].Description;$s("P193_DRAFT_LIST",g),$s("P193_OPEN_POG_CODE",a),$s("P193_OPEN_POG_VERSION",""),$s("P193_OPEN_DRAFT","Y");var r=t[0].DraftVersion;$s("P193_EXISTING_DRAFT_VER",r),addLoadingIndicator(),apex.server.process("GET_POG_JSON",{x01:g},{dataType:"html"}).done((function(e){var o=$.trim(e);o.match(/ERROR.*/)?(window.open("f?p="+$v("pFlowId")+":25:"+$v("pInstance")+":APEX_CLONE_SESSION:NO::P193_OPEN_NEW_TAB,P193_PRODUCT_BTN_CLICK,P193_DRAFT_LIST,P193_POG_DESCRIPTION,P193_EXISTING_DRAFT_VER:Y,N,"+p_draft_seq_id+","+p_draft_desc+","+p_draft_version),sessionStorage.removeItem("POGJSON"),resolve("SUCESS")):""!==o&&(g_pog_json=JSON.parse($.trim(e)))})),await get_json_data([$v("P193_DRAFT_LIST")],e,i),removeLoadingIndicator(regionloadWait),upload_file_flag="N",g_auto_fill_active="N",await auto_fill_setup(0),g_mod_block_list&&0!==g_mod_block_list.length?(apex.region("mod_block_details").refresh(),$("#added_attribute").show(),apex.region("added_attribute").refresh()):await createDynamicBlocks($v("P193_OPEN_POG_CODE"),$v("P193_OPEN_DRAFT"),$v("P193_OPEN_POG_VERSION"),$v("P193_EXISTING_DRAFT_VER")),await runattrCollections(),add_pog_versions(),wpdCaptureShowChangesBlockSnapshot(g_mod_block_list,"Y")}}async function get_json_data(e,o="N",_){logDebug("function : get_json_data; pog_code : "+e,"S"),g_ComBaseIndex=-1,g_ComViewIndex=-1,g_compare_pog_flag="N",g_compare_view="NONE",g_colorBackup="N",l_new_pog_ind="N";var t=[];g_pog_json_data=[];try{if("Y"==$v("P193_POGCR_VALIDATE_POG")&&1==e.length){init(0),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects),set_indicator_objects(g_scene_objects.length-1),g_pog_index=0;await getJson("Y","",e[0],"N","Y",g_camera,g_scene,0,o,_);g_dblclick_opened="N";await create_module_from_json(g_pog_json,sessionStorage.getItem("new_pog_ind"),"F","N",sessionStorage.getItem("pog_opened"),"Y","N","Y","N","","Y",g_camera,g_scene,g_pog_index,g_pog_index);animate_all_pog(),generateMultiPogDropdown(),$(".t-Body-actionsToggle").hasClass("is-active")&&(apex.region("draggable_table").widget().interactiveGrid("getActions").set("edit",!1),apex.region("draggable_table").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("draggable_table").refresh())}else{g_scene_objects=[],g_canvas_objects=[],appendMultiCanvasRowCol(e.length,$v("P193_POGCR_TILE_VIEW")),switchCanvasView($v("P193_POGCR_TILE_VIEW")),g_multi_pog_json=[],await setDefaultState("Y");for(var n=0;n<=e.length-1;n++){init(n),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects),g_seqArrDtl={},g_seqArrDtl.seqId=e[n],g_seqArrDtl.index=n,g_seqArrDtl.pogCode="",g_seqArrDtl.pogVersion="",g_seqArrDtl.pogType="D",g_seqArr.push(g_seqArrDtl),g_pog_index=n,set_indicator_objects(g_scene_objects.length-1);await getJson("Y","",e[n],"Y","Y",g_camera,g_scene,n,o,"Y",_);render(n);var g=g_canvas_objects[n].getAttribute("id");$("#"+g+"-btns").append('<span id="block_title" style="float:left">'+g_pog_json[n].POGCode+"</span>")}g_pog_json=g_multi_pog_json,generateMultiPogDropdown();await animate_all_pog();if($(".t-Body-actionsToggle").hasClass("is-active")&&(apex.region("draggable_table").widget().interactiveGrid("getActions").set("edit",!1),apex.region("draggable_table").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("draggable_table").refresh()),"Y"==o)await get_all_images(0,g_get_orient_images,"Y",$v("P193_POGCR_IMG_MAX_WIDTH"),$v("P193_POGCR_IMG_MAX_HEIGHT"),$v("P193_IMAGE_COMPRESS_RATIO"));if(g_ItemImages.length>0&&"Y"==g_show_live_image&&"Y"==o){var a=0;$(".live_image").addClass("live_image_active");for(const e of g_pog_json){try{g_renderer=g_scene_objects[a].renderer,g_scene=g_scene_objects[a].scene,g_camera=g_scene_objects[a].scene.children[0],g_world=g_scene_objects[a].scene.children[2];await recreate_image_items("Y",$v("P193_MERCH_STYLE"),$v("P193_POGCR_LOAD_IMG_FROM"),$v("P193_BU_ID"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_ITEM_NUM_LABEL_POS"),$v("P193_POGCR_DISPLAY_ITEM_INFO"),$v("P193_POGCR_DELIST_ITEM_DFT_COL"),$v("P193_NOTCH_HEAD"),a,g_show_days_of_supply,$v("P193_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label)}catch(e){error_handling(e)}a++}g_imagesShown="Y",animate_all_pog()}var i=0;for(const e of g_pog_json)i>0&&await enableDisableFlags(i),i++;if(g_pog_index=0,g_scene_objects.length>0&&void 0!==g_scene_objects[g_pog_index]){void 0!==g_scene_objects[g_pog_index].Indicators&&(g_show_fixel_label=g_scene_objects[g_pog_index].Indicators.FixelLabel,g_show_item_label=g_scene_objects[g_pog_index].Indicators.ItemLabel,g_show_notch_label=g_scene_objects[g_pog_index].Indicators.NotchLabel,g_show_max_merch=g_scene_objects[g_pog_index].Indicators.MaxMerch,g_show_item_color=g_scene_objects[g_pog_index].Indicators.ItemColor,g_show_item_desc=g_scene_objects[g_pog_index].Indicators.ItemDesc,g_show_live_image=g_scene_objects[g_pog_index].Indicators.LiveImage,g_show_days_of_supply=g_scene_objects[g_pog_index].Indicators.DaysOfSupply,g_overhung_shelf_active=g_scene_objects[g_pog_index].Indicators.OverhungShelf,g_itemSubLabelInd=g_scene_objects[g_pog_index].Indicators.ItemSubLabelInd,g_itemSubLabel=g_scene_objects[g_pog_index].Indicators.ItemSubLabel);g=g_canvas_objects[g_pog_index].getAttribute("id");$("[data-pog]").removeClass("multiPogList_active"),$(".canvas_highlight").removeClass("canvas_highlight"),$("#"+g+"-btns").addClass("canvas_highlight"),$("[data-indx="+g_pog_index+"]").addClass("multiPogList_active"),g_all_pog_flag="N"}}var r=0;for(const e of g_pog_json){if(t=[],void 0!==g_pog_json[r].DeleteItems&&g_pog_json[r].DeleteItems.length>0){n=0;for(var s of g_pog_json[r].DeleteItems)t.push(s.Item),n++}void 0!==t&&(g_open_productlist="D"),r++}logDebug("function : get_json_data","E")}catch(e){error_handling(e)}}function get_draft_ind(e){return logDebug("function : get_draft_ind; seq_id : "+e,"S"),console.log("get_draft_ind",e),new Promise((function(o,_){apex.server.process("GET_DRAFT_IND",{x01:e},{dataType:"text",success:function(e){console.log("get_draft_ind pData",e),""!=$.trim(e)&&(logDebug("function : get_draft_ind","E"),o($.trim(e)))}})}))}function loadDraftVersion(e){return logDebug("function : loadDraftVersion; seq_id : "+e,"S"),console.log("loadDraftVersion",e),new Promise((function(o,_){apex.server.process("GET_DRAFT_VERSION",{x01:e},{dataType:"text",success:function(e){""!==$.trim(e)?o($.trim(e)):o(null)}})}))}function generateMultiPogDropdown(){var e,o;$("[data-pog=true]").remove();for(var _=0;_<g_pog_json.length;_++)(_!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex)&&(o="<a onclick=setPogActive("+_+") class='float_left top_icon print_rep' data-indx='"+_+"' data-pog=true>"+g_pog_json[_].POGCode+(null!=(e=g_pog_json[_].Version)?" - "+e:"")+"</a>",$("#multiPogDropdown").append(o),$("[data-pog]").removeClass("multiPogList_active"),$("[data-indx="+g_pog_index+"]").addClass("multiPogList_active"))}async function get_existing_pog(e,o,_,t,n="N"){logDebug("function : get_existing_pog; pog_code : "+e+"; pog_version : "+o,"S"),$(".item_label").removeClass("item_label_active"),$(".item_desc").removeClass("item_label_active"),$(".fixel_label").removeClass("fixel_label_active"),$(".notch_label").removeClass("notch_label_active"),$(".fixel_merch").removeClass("max_merch_active"),$(".item_color").removeClass("item_color_active"),$(".overhung_shelf").removeClass("overhung_shelf_active"),$(".item_sublabel").removeClass("item_sublabel_active"),$("#item_sublbl_sub .items").removeClass("item_sublabel_active"),sessionStorage.removeItem("g_color_arr"),sessionStorage.removeItem("g_highlightArr"),g_color_arr=[],g_highlightArr=[],l_new_pog_ind="N";try{if("Y"==$v("P193_POGCR_VALIDATE_POG")&&"N"==t){init(_),console.log("init complete",{canvasNo:_,g_canvas_objects_len:g_canvas_objects?g_canvas_objects.length:0,g_scene_objects_len:g_scene_objects?g_scene_objects.length:0,dom_canvas_count:document.querySelectorAll("canvas[data-canvas=true]").length}),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects);try{console.log("get_existing_pog: pushed scene object index=",g_scene_objects.length-1,"renderer present=",objects.renderer&&objects.renderer.domElement&&objects.renderer.domElement.id)}catch(e){}set_indicator_objects(g_scene_objects.length-1);await getJson("N",e,o,"N","Y",g_camera,g_scene,_,n);if("Y"==await validate_pog(_)){removeLoadingIndicator(regionloadWait);await save_validate_items_coll(g_errored_items);apex.region("ig_errored_item").refresh(),apex.event.trigger("#P193_ERROR_METHOD","apexrefresh"),g_dblclick_opened="Y",openInlineDialog("errored_items",60,65)}else{g_dblclick_opened="N";await create_module_from_json(g_pog_json,sessionStorage.getItem("new_pog_ind"),"F","N",sessionStorage.getItem("pog_opened"),"N","N","Y","N","","Y",g_camera,g_scene,g_pog_index,g_pog_index,n)}}else{try{const e=document.querySelectorAll("canvas[data-canvas=true]"),o=new Set;e.forEach((function(e){o.has(e.id)?e.parentNode&&e.parentNode.removeChild(e):o.add(e.id)}))}catch(e){console.warn("normalize canvases failed",e)}init(_),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects),set_indicator_objects(g_scene_objects.length-1);await getJson("N",e,o,"Y","Y",g_camera,g_scene,_,n);console.log("after getJson",{g_pog_json_len:g_pog_json?g_pog_json.length:0,g_pog_index:g_pog_index})}logDebug("function : get_existing_pog","E")}catch(e){error_handling(e)}}async function open_existing_pog(e,o,_="N"){try{logDebug("function : open_existing ; ","S"),addLoadingIndicator(),$("#canvas-list-holder").html(""),g_open_pog_flag="Y";var t=[],n=[],g=[];g_scene_objects=[],g_scene_objects_backup=[],g_canvas_objects=[],g_pogjson_backup=[],g_pogjson_data_backup=[],g_seqArr=[],g_all_pog_flag="N",g_ComBaseIndex=-1,g_ComViewIndex=-1,g_compare_pog_flag="N",g_compare_view="NONE",g_colorBackup="N",g_mod_block_list=[],g_show_changes_block_snapshot=[],$s("P193_EXISTING_DRAFT_VER",""),appendMultiCanvasRowCol(1,$v("P193_POGCR_TILE_VIEW"));try{console.log("open_existing_pog: after appendMultiCanvasRowCol, g_canvas_objects.length=",g_canvas_objects.length,"DOM canvas count=",document.querySelectorAll("canvas").length)}catch(e){}g_pog_json=[],g_pog_json=[],g_pog_json_data=[],sessionStorage.removeItem("g_combinedShelfs"),sessionStorage.removeItem("combinedShlfDets"),g_combinedShelfs=[];for(const o of e)t.push(o.POGCode),n.push(o.POGVersion),g.push(o.IsRealPOG);var a="";if("N"==g_show_live_image&&(g_show_live_image=$v("P193_POGCR_DFLT_LIVE_IMAGES"),g_imagesShown="N"),"Y"==g_compare_pog_flag&&"POG"==g_compare_view&&"N"==g_show_live_image&&(g_show_live_image=$v("P193_POGCR_DFLT_LIVE_IMAGES"),g_imagesShownComp="N"),g_combinedShelfs=[],1==t.length)if($(".save_template").css("display","block"),a+=t[0]+":",$s("P193_SELECTED_RECORDS",a),g_pog_index=0,g_multi_pog_json=[],appendMultiCanvasRowCol(1),g_canvas_objects=[],await setDefaultState("N"),$("#pog_list_btn").css("display","none"),$("#chng_view_btn").css("display","none"),$(".add_pog").css("display","block"),$(".open_par").css("display","block"),"N"==g[0])removeLoadingIndicator(regionloadWait),confirm(get_message("VIRTUAL_POG_OPEN_ALERT"),get_global_ind_values("AI_CONFIRM_OK_TEXT"),get_global_ind_values("AI_CONFIRM_CANCEL_TEXT"),(function(){$s("P193_OPEN_POG","Y"),$s("P193_OPEN_POG_CODE",t[0]),$s("P193_OPEN_POG_VERSION",n[0]),async function(){g_seqArrDtl={},g_seqArrDtl.seqId="",g_seqArrDtl.index=0,g_seqArrDtl.pogCode=t[0],g_seqArrDtl.pogVersion=n[0],g_seqArrDtl.pogType="E",g_seqArr.push(g_seqArrDtl),addLoadingIndicator(),await get_existing_pog(t[0],n[0],0,"N","N"),removeLoadingIndicator(regionloadWait),render(0),animate_all_pog()}()}));else{$s("P193_OPEN_POG","Y"),$s("P193_OPEN_POG_CODE",t[0]),$s("P193_OPEN_POG_VERSION",n[0]),async function(){g_pog_index=0,g_seqArrDtl={},g_seqArrDtl.seqId="",g_seqArrDtl.index=0,g_seqArrDtl.pogCode=t[0],g_seqArrDtl.pogVersion=n[0],g_seqArrDtl.pogType="E",g_seqArr.push(g_seqArrDtl),await get_existing_pog(t[0],n[0],0,"N","N"),removeLoadingIndicator(regionloadWait),g_auto_fill_active="N",$s("P193_OPEN_DRAFT","N"),await auto_fill_setup(0),g_mod_block_list&&0!==g_mod_block_list.length?apex.region("mod_block_details").refresh():await createDynamicBlocks($v("P193_OPEN_POG_CODE"),$v("P193_OPEN_DRAFT"),$v("P193_OPEN_POG_VERSION"),$v("P193_EXISTING_DRAFT_VER")),await runattrCollections(),wpdCaptureShowChangesBlockSnapshot(g_mod_block_list,"Y"),add_pog_versions(),render(0),animate_all_pog()}()}else if($("#pog_list_btn").css("display","block"),$("#chng_view_btn").css("display","block"),$(".add_pog").css("display","block"),$(".open_par").css("display","block"),"M"==o)t.length>0&&apex.server.process("CHECK_MOD_COUNT",{x01:"P",x02:"",f01:t,f02:n},{dataType:"text",success:async function(e){if(""!=$.trim(e))alert(get_message("POGCR_MAX_MOD_ERR",$v("P193_POGCR_MAX_MOD_OPEN")));else{for(const e of g);sessionStorage.setItem("pog_code_list",JSON.stringify(t)),$s("P193_OPEN_POG","Y"),$s("P193_OPEN_POG_CODE",t[0]),$s("P193_OPEN_POG_VERSION",n[0]),i=0;for(const e of t)a+=t[i]+":",i++;$s("P193_SELECTED_RECORDS",a),g_pog_index=0,g_multi_pog_json=[],appendMultiCanvasRowCol(t.length,$v("P193_POGCR_TILE_VIEW")),await setDefaultState("N"),g_canvas_objects=[];var o=0;for(const e of t){g_pog_index=o,g_seqArrDtl={},g_seqArrDtl.seqId="",g_seqArrDtl.index=o,g_seqArrDtl.pogCode=e,g_seqArrDtl.pogVersion=n[o],g_seqArrDtl.pogType="E",g_seqArr.push(g_seqArrDtl);await get_existing_pog(e,n[o],o,"Y",_);"Y"==$v("P193_AUTO_REFRESH_SALES_FOR_POG")&&"Y"!=g_pog_json[o].NewPOG&&(await refresh_sales_data(13,"",$v("P193_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label,g_show_days_of_supply,"N","N","N",t[o],t[o],"N",g_pog_index,"Y"),$s("P193_REFRESH_SALE_CALL","Y")),"Y"==$v("P193_POGCR_ITEM_DIM_AUTO_REFRESH")&&await itemDimUpdate(g_pog_index),g_pog_index=o,render(o);var r=g_canvas_objects[o].getAttribute("id");$("#"+r+"-btns").append('<span id="block_title" style="float:left">'+e+"</span>"),o==t.length-1&&removeLoadingIndicator(regionloadWait),o++}if(g_pog_json=g_multi_pog_json,generateMultiPogDropdown(),reset_canvas_region(),"Y"==_){addLoadingIndicator();await get_all_images(0,g_get_orient_images,"Y",$v("P193_POGCR_IMG_MAX_WIDTH"),$v("P193_POGCR_IMG_MAX_HEIGHT"),$v("P193_IMAGE_COMPRESS_RATIO"));removeLoadingIndicator(regionloadWait)}if(g_ItemImages.length>0&&"Y"==g_show_live_image&&"Y"==_){var s=0;$(".live_image").addClass("live_image_active");for(const e of g_pog_json){try{g_renderer=g_scene_objects[s].renderer,g_scene=g_scene_objects[s].scene,g_camera=g_scene_objects[s].scene.children[0],g_world=g_scene_objects[s].scene.children[2],addLoadingIndicator();await recreate_image_items("Y",$v("P193_MERCH_STYLE"),$v("P193_POGCR_LOAD_IMG_FROM"),$v("P193_BU_ID"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_ITEM_NUM_LABEL_POS"),$v("P193_POGCR_DISPLAY_ITEM_INFO"),$v("P193_POGCR_DELIST_ITEM_DFT_COL"),$v("P193_NOTCH_HEAD"),s,g_show_days_of_supply,$v("P193_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label);removeLoadingIndicator(regionloadWait)}catch(e){error_handling(e)}s++}g_imagesShown="Y",animate_all_pog()}o=0;for(const e of g_pog_json){await enableDisableFlags(o);o++}await save_update_json_items(g_multi_pog_json);if(g_pog_index=0,g_scene_objects.length>0&&void 0!==g_scene_objects[g_pog_index]){void 0!==g_scene_objects[g_pog_index].Indicators&&(g_show_fixel_label=g_scene_objects[g_pog_index].Indicators.FixelLabel,g_show_item_label=g_scene_objects[g_pog_index].Indicators.ItemLabel,g_show_notch_label=g_scene_objects[g_pog_index].Indicators.NotchLabel,g_show_max_merch=g_scene_objects[g_pog_index].Indicators.MaxMerch,g_show_item_color=g_scene_objects[g_pog_index].Indicators.ItemColor,g_show_item_desc=g_scene_objects[g_pog_index].Indicators.ItemDesc,g_show_live_image=g_scene_objects[g_pog_index].Indicators.LiveImage,g_show_days_of_supply=g_scene_objects[g_pog_index].Indicators.DaysOfSupply,g_overhung_shelf_active=g_scene_objects[g_pog_index].Indicators.OverhungShelf,g_itemSubLabelInd=g_scene_objects[g_pog_index].Indicators.ItemSubLabelInd,g_itemSubLabel=g_scene_objects[g_pog_index].Indicators.ItemSubLabel);r=g_canvas_objects[g_pog_index].getAttribute("id");$("[data-pog]").removeClass("multiPogList_active"),$(".canvas_highlight").removeClass("canvas_highlight"),$("#"+r+"-btns").addClass("canvas_highlight"),$("[data-indx="+g_pog_index+"]").addClass("multiPogList_active"),g_all_pog_flag="N"}}},loadingIndicatorPosition:"page"});else if(t.length>15)alert(get_message("POGCR_MAX_TAB_MESS","15"));else{for(const e of g);sessionStorage.setItem("pog_code_list",JSON.stringify(t)),i=0;var r=[];for(const e of t)a+=t[i]+":",i+=1;$s("P193_SELECTED_RECORDS",a),i=0;for(const e of t){if(0==i)r.push(e);else await open_in_new_tab(e,n[i],"","","",$v("P193_SELECTED_RECORDS"));i+=1}r.length>0&&(g_pog_index=0,g_multi_pog_json=[],appendMultiCanvasRowCol(1),$s("P193_OPEN_POG","Y"),$s("P193_OPEN_POG_CODE",r[0]),$s("P193_OPEN_POG_VERSION",n[0]),addLoadingIndicator(),await get_existing_pog(r[0],n[0],0,_),"Y"==$v("P193_AUTO_REFRESH_SALES_FOR_POG")&&"Y"!=g_pog_json[0].NewPOG&&(await refresh_sales_data(13,"",$v("P193_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label,g_show_days_of_supply,"N","N","N",t[0],t[0],"N",g_pog_index,"Y"),$s("P193_REFRESH_SALE_CALL","Y")),"Y"==$v("P193_POGCR_ITEM_DIM_AUTO_REFRESH")&&await itemDimUpdate(g_pog_index),removeLoadingIndicator(regionloadWait))}logDebug("function : open_existing ; ","E")}catch(e){error_handling(e)}}async function auto_fill_setup(e,o=""){return console.log("pog json length",g_pog_json[e],g_pog_json.length),new Promise(((_,t)=>{"N"==g_all_pog_flag||"Y"==g_all_pog_flag&&1==g_pog_json.length?($s("P193_OPEN_POG_CODE",`${g_pog_json[e].POGCode}`),$s("P193_OPEN_POG_VERSION",`${g_pog_json[e].Version}`),"N"==g_auto_fill_active&&void 0!==typeof g_pog_json[e]&&g_pog_json.length>0?apex.server.process("GET_AUTOFILL",{x01:$v("P193_OPEN_POG_CODE"),x02:"Y"==$v("P193_OPEN_DRAFT")?$v("P193_EXISTING_DRAFT_VER"):$v("P193_OPEN_POG_VERSION"),x03:$v("P193_OPEN_DRAFT"),x04:o},{dataType:"json",success:async function(n){try{if("ERROR"==$.trim(n).split(",")[0])return raise_error(n),void _();var g=!1;for(const o of g_pog_json[e].ModuleInfo){if(g)break;if(void 0===o.ParentModule||null==o.ParentModule)for(const e of o.ShelfInfo){if(g)break;if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){const o=Array.isArray(e.ItemInfo)?e.ItemInfo:e.ItemInfo?[e.ItemInfo]:[];for(const e of o)if("DIVIDER"!==e.Item){g=!0;break}}}0}if(g||""!=o){await async function(){if(g_auto_fill_active="Y",$s("P193_BLOCK_SELECTION","P"),g_undo_final_obj_arr=[],g_redo_final_obj_arr=[],g_prev_undo_action="",""==o&&await clear_item("N","N",e),g_undo_final_obj_arr=[],g_redo_final_obj_arr=[],g_auto_fill_reg_open="Y",(void 0!==n.AFVersion||void 0!==g_autofill_detail.AFVersion)&&(void 0===g_autofill_detail.AFVersion&&(g_autofill_detail.AFPOGCode=n.AFPOGCode,g_autofill_detail.AFPOGVersion=n.AFPOGVersion,g_autofill_detail.AFVersion=n.AFVersion,g_autofill_detail.BlkSelType=n.AFType,g_autofill_detail.AutofillRule=n.AFRule,g_autofill_detail.BlkInfo=JSON.parse(n.AFJSON).BlkInfo),$s("P193_BLOCK_SELECTION",g_autofill_detail.BlkSelType),$s("P193_AF_VERSION",g_autofill_detail.AFVersion),$s("P193_AUTOFILL_RULE",g_autofill_detail.AutofillRule),"M"==$v("P193_BLOCK_SELECTION"))){g_mod_block_list=g_autofill_detail.BlkInfo,await async function(){for(const o of g_mod_block_list){g_autofillModInfo=o.BlkModInfo,g_autofillShelfInfo=o.BlkShelfInfo;var e=await colorAutofillBlock(o.DragMouseStart,o.DragMouseEnd,o.mod_index,o.BlkColor,o.BlkName,"U",o,g_pog_index);o.BlockDim=e}g_autofill_detail.BlkInfo=g_mod_block_list,await save_blk_dtl_coll("Y","",g_mod_block_list),g_mod_block_list=g_autofill_detail.BlkInfo,wpdCaptureShowChangesBlockSnapshot(g_mod_block_list,""!==o?"Y":"N")}()}}()}_()}catch(e){t(e)}},error:function(e){t(e)}}):_()):(alert(get_message("POGCR_AUTOFILL_VALID")),_())}))}async function clear_item(e,o,_){logDebug("function : clear_item; info_called : "+e+"; p_clearInfoType : "+o,"S");try{g_pog_edited_ind="Y","N"==e&&($(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),$(".clear_item").addClass("active"));var t="N"==e?"CLEAR_ITEM":"CLEAR_POG_INFO",n=g_pog_json[_].ModuleInfo;g_undo_obj_arr=[],g_undo_details=[],g_undo_supp_obj_arr=[];var g=[],a=[];if("CLEAR_POG_INFO"==t){var i={};i.OldPOGCode=g_pog_json[_].POGCode,i.OldPOGName=g_pog_json[_].Name,i.OldPOGDivision=g_pog_json[_].Division,i.OldPOGDept=g_pog_json[_].Dept,i.OldPOGSubDept=g_pog_json[_].SubDept,i.OldEffStartDate=g_pog_json[_].EffStartDate}return $.each(n,(function(e,o){void 0!==o.ParentModule&&null!=o.ParentModule||(g_pog_json[_].ModuleInfo[e].EditFlag="Y",$.each(o.ShelfInfo,(function(o,t){if(t.ItemInfo.length>0){$.each(t.ItemInfo,(function(e,o){a.push(o.ItemID)}));var n=g_pog_json[_].ModuleInfo[e].ShelfInfo[o].SObjID;g.moduleIndex=e,g.module=g_pog_json[_].ModuleInfo[e].Module,g.shelfIndex=o,g.pogInfo=i,g.actionType="ITEM_DELETE",g.startCanvas=g_start_canvas,g.objectID=n,g.g_deletedItems=a,g.moduleObjectID=g_pog_json[_].ModuleInfo[e].MObjID,g.push(JSON.parse(JSON.stringify(g_pog_json[_].ModuleInfo[e].ShelfInfo[o]))),g_allUndoObjectsInfo.push(g),g=[]}})))})),await delete_items("Y",_),logFinalUndoObjectsInfo("ITEM_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","N"),g_allUndoObjectsInfo=[],showFixelAvailableSpace("N","N",_),render(_),await recreate_compare_views(g_compare_view,"N"),apex.message.showPageSuccess(g_pog_refresh_msg),logDebug("function : clear_item","E"),"SUCCESS"}catch(e){error_handling(e)}}function save_blk_dtl_coll(e,o,_){return new Promise((function(t,n){apex.server.process("SAVE_BLOCK_LIST",{x01:e,x02:o,p_clob_01:JSON.stringify(_)},{dataType:"text",success:async function(o){console.log("pData",o),"Y"!=e&&"U"!=e||(g_autofill_edit="N"),t("success")},loadingIndicatorPosition:"page"})}))}function delete_items(e,o){return logDebug("function : delete_items; delete_obj : "+e,"S"),new Promise((function(_,t){var n=g_pog_json[o].ModuleInfo;"N"==e&&(g_pog_json[o].POGCode="",g_pog_json[o].Name=""),$.each(n,(function(_,t){void 0!==t.ParentModule&&null!=t.ParentModule||$.each(t.ShelfInfo,(function(t,n){var g={},a="N";"Y"==e?$.each(n.ItemInfo,(function(e,_){if("DIVIDER"!==_.Item){g_deletedItems.push(_.ItemID);var t=g_scene_objects[o].scene.children[2].getObjectById(_.ObjID);g_scene_objects[o].scene.children[2].remove(t),void 0!==g_pog_json[o].DeleteItems&&g_pog_json[o].DeleteItems.push(_)}else g=_,a="Y"})):$.each(n.ItemInfo,(function(e,o){"DIVIDER"==o.Item&&(g=o,a="Y")})),g_pog_json[o].ModuleInfo[_].ShelfInfo[t].ItemInfo=[],"Y"==a&&g_pog_json[o].ModuleInfo[_].ShelfInfo[t].ItemInfo.push(g)}))})),_("SUCCESS"),logDebug("function : delete_items","E")}))}function get_below_shelf(e,o,_,t){var n=-1,g=0,a=[],i=[];g=0;for(const o of e)"BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType&&_<=o.Y+o.H/2&&(a.push(o.Y+o.H/2-_),i.push(g)),g++;if(a.length>0){var r=Math.min.apply(Math,a),s=a.findIndex((function(e){return e==r}));n=g_pog_json[t].ModuleInfo[o].ShelfInfo[i[s]].Y-g_pog_json[t].ModuleInfo[o].ShelfInfo[i[s]].H/2}else n=_;return n}function get_above_shelf(e,o,_,t,n){var g=-1,a=0,i=[],r=[];a=0;for(const o of e)"BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType&&_<=o.Y-o.H/2&&(i.push(o.Y-o.H/2-_),r.push(a)),a++;if(i.length>0){var s=Math.min.apply(Math,i),l=i.findIndex((function(e){return e==s}));g=g_pog_json[n].ModuleInfo[o].ShelfInfo[r[l]].Y-g_pog_json[n].ModuleInfo[o].ShelfInfo[r[l]].H/2}else g=t;return g}async function doMouseUp(e,o,_,t,n,g,a,i){logDebug("function : doMouseUp; x : "+e+"; y : "+o+"; prevX : "+t+"; prevY : "+n,"S");try{var r,s,l,d=g.width,f=g.height,c=2*e/d-1,I=1-2*o/f;g_raycaster.setFromCamera(new THREE.Vector2(c,I),a),g_intersects=g_raycaster.intersectObject(g_targetForDragging),r=g_intersects[0].point.x,s=g_intersects[0].point.y,l=g_intersects[0].point.z;var p=new THREE.Vector3(r,s,l);g_scene_objects[i].scene.children[2].worldToLocal(p);var m=Math.min(19,Math.max(-19,p.x)),u=Math.min(19,Math.max(-19,p.y)),h=g_drag_z,S=Math.abs(e-t)<=2&&Math.abs(o-n)<=2;if("Y"==g_compare_pog_flag&&"POG"==g_compare_view&&S&&!0!==g_selecting&&"N"==g_auto_fill_active)return;if("Y"==g_shelf_edit_flag){if("SHELF"==g_shelf_object_type)var v=wpdSetFixed(g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X-g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].W/2),O=wpdSetFixed(g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X+g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].W/2),x=wpdSetFixed(g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y+g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].H/2),D=wpdSetFixed(g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y-g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].H/2),b=textboxHit(g_start_canvas,g_module_index,g_shelf_index,v,O,x,D,"N"),M=isShelfOnPegboard(g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X,g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y,g_module_index,g_start_canvas,g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index],g_pog_json);("Y"==g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].InsidePegboard||M||b)&&"SHELF"==g_shelf_object_type?g_dragItem.position.z=b?.00115:.016:"PEGBOARD"==g_shelf_object_type||"CHEST"==g_shelf_object_type&&"Y"==g_chest_as_pegboard?g_dragItem.position.z=.00115:"ROD"==g_shelf_object_type?g_dragItem.position.z=.005:"TEXTBOX"!==g_shelf_object_type&&(0!=g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Slope||0!=g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Rotation?g_dragItem.position.z=g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].D/2+5e-4:g_dragItem.position.z=5e-4,g_drag_z=5e-4)}if(g_delete_details.length>0&&"Y"==g_duplicating?g_multiItemCopy="Y":g_multiItemCopy="N","undefined"!=typeof g_pog_json&&g_pog_json.length>0&&(g_selecting&&"Y"==g_multiselect&&"N"==g_shift_mutli_item_select?(g_duplicating="N",await get_multiselect_obj(i),"Y"==g_area_zoom_ind?(select_zoom(a,i),g_area_zoom_ind="N",g_multiselect="N",g_ctrl_select="N"):set_multi_blink(g_pog_json,i),g_selecting=!1,g_selection.style.visibility="hidden"):"Y"==g_shift_mutli_item_select&&multiSelectItemsWithShift(i,g_multi_select_offset_perc)),$("#maincanvas").css("cursor","auto"),"Y"==g_auto_fill_active){if([g_autofillModInfo,g_autofillShelfInfo]=getAutofillModShelf(g_DragMouseStart,g_DragMouseEnd,g_pog_json,g_pog_index),g_autofillShelfInfo.length>=1)apex.region("block_filters").widget().interactiveGrid("getActions").set("edit",!1),apex.region("block_filters").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("block_filters").refresh(),apex.event.trigger("#P193_BLK_RULE","apexrefresh"),$s("P193_BLK_NAME",""),$s("P193_BLK_COLOR",randomColor()),$s("P193_BLK_FILTER",""),$("#ADD_BLK").css("display","inline"),$("#SAVE_BLK").css("display","inline"),$("#UPDATE_BLK").css("display","none"),openInlineDialog("block_details",40,65);else if("undefined"!=typeof g_dragItem&&null!=g_dragItem&&"Y"==g_drag_inprogress&&(g_dragItem.length&&g_dragItem.length>0||void 0!==g_dragItem.uuid||"object"==typeof g_dragItem)){var E;if(void 0===(E=getAutoFillCurrModule(m,u,g_module_index,i))||-1===E){try{var P=null;if(g_dragItem&&(void 0!==g_dragItem.uuid?P=g_dragItem.uuid:g_dragItem.length&&g_dragItem.length>0&&g_dragItem[0]&&void 0!==g_dragItem[0].uuid&&(P=g_dragItem[0].uuid)),P)if((F=g_mod_block_list.filter((function(e){return e.BlkName==P})))&&F.length>0&&F[0].BlockDim){var C=F[0].BlockDim.CalcX,N=F[0].BlockDim.CalcY,T=F[0].BlockDim.CalcZ;g_dragItem&&g_dragItem.position&&"function"==typeof g_dragItem.updateMatrix&&(g_dragItem.position.set(C,N,T),g_dragItem.updateMatrix(),render(i),alert(get_message("VALIDATE_SWAP_BLOCK_MSG")))}}catch(e){}return g_dragItem=void 0,!1}if(void 0!==E&&-1!==E){var y={},R={},w=!1;P=null;if(g_dragItem&&(void 0!==g_dragItem.uuid?P=g_dragItem.uuid:g_dragItem.length&&g_dragItem.length>0&&g_dragItem[0]&&void 0!==g_dragItem[0].uuid&&(P=g_dragItem[0].uuid)),!P)return g_dragItem=void 0,!1;var F=g_mod_block_list.filter((e=>e.BlkName==P));y.x=g_pog_json[i].ModuleInfo[E].X-g_pog_json[i].ModuleInfo[E].W/2,y.y=u+F[0].BlockDim.BlkHeight/2,R.x=g_pog_json[i].ModuleInfo[E].X+g_pog_json[i].ModuleInfo[E].W/2,R.y=u-F[0].BlockDim.BlkHeight/2;var Y=getAutoFillCurrShelf(y,R,E,i);if(void 0!==E&&-1!==E){for(colorObj of g_mod_block_list)if(colorObj.BlkName!==g_dragItem.uuid){var H=colorObj.BlockDim.FinalTop,L=colorObj.BlockDim.FinalBtm,A=g_pog_json[i].ModuleInfo[colorObj.mod_index[0]].X-g_pog_json[i].ModuleInfo[colorObj.mod_index[0]].W/2,B=g_pog_json[i].ModuleInfo[colorObj.mod_index[0]].X+g_pog_json[i].ModuleInfo[colorObj.mod_index[0]].W/2;if(H>u&&L<u&&A<m&&B>m)return await swapColoredBlocks(colorObj,F[0],i),g_dragItem=void 0,w=!0,render(i),!0}if(!w)if(-1===Y){F[0].BlockDim.ColorObj.remove(g_dragItem),F[0].mod_index=[E];var k=await add_module_autofill_color(y,R,[E],F[0].BlkColor,F[0].BlkName,"Y",F[0],i,"Y");F[0].BlockDim=k,await save_blk_dtl_coll("Y","",g_mod_block_list),render(i)}else{C=F[0].BlockDim.CalcX,N=F[0].BlockDim.CalcY,T=F[0].BlockDim.CalcZ;g_dragItem.position.set(C,N,T),g_dragItem.updateMatrix(),render(i),alert(get_message("VALIDATE_SWAP_BLOCK_MSG"))}}else{C=F[0].BlockDim.CalcX,N=F[0].BlockDim.CalcY,T=F[0].BlockDim.CalcZ;g_dragItem.position.set(C,N,T),g_dragItem.updateMatrix(),render(i)}}}}else if("Y"!==g_shift_mutli_item_select&&("Y"==g_mselect_drag&&g_start_canvas==g_present_canvas&&"N"==g_duplicating&&"N"==g_drag_inprogress||"Y"==g_canvas_drag&&"Y"==g_mselect_drag&&g_start_canvas!==g_present_canvas&&"N"==g_duplicating&&"PREV_VERSION"!==g_compare_view)){g_duplicating="N",g_delete_details.is_dragging="Y",g_combineItemModf=[];var G=await multi_drag_setup(m,u,a,i);g_delete_details.is_dragging="N",render(i)}else if("EDIT_PALLET"==g_compare_view&&"Y"==g_item_edit_flag&&"Y"==g_drag_inprogress&&"N"==g_canvas_drag&&g_present_canvas==g_ComViewIndex&&g_ComViewIndex==g_start_canvas)update_item_edit_pallet(m,u,g_module_index,g_shelf_index,g_item_index,g_item_edit_flag,g_ComBaseIndex,g_ComViewIndex);else if("Y"==g_duplicating&&"Y"==g_drag_inprogress&&g_present_canvas!==g_ComViewIndex)duplicate_drag_obj(m,u,g_module_index,g_shelf_index,g_shelf_edit_flag,g_module_edit_flag,a,g_start_canvas,g_present_canvas,$v("P193_POGCR_MODULE_COPY_WITH_ITEM"));else if("Y"==g_canvas_drag&&"Y"==g_drag_inprogress&&g_dragItem.StartCanvas!==g_present_canvas&&"N"==g_duplicating&&("Y"==g_compare_pog_flag&&parseInt(g_present_canvas)==g_ComViewIndex&&"POG"==g_compare_view||"N"==g_compare_pog_flag||"Y"==g_compare_pog_flag&&parseInt(g_present_canvas)!==g_ComViewIndex))multi_canvas_drag(m,u,g_module_index,g_shelf_index,g_shelf_edit_flag,g_module_edit_flag,i);else if(null!=g_dragItem&&"Y"==g_drag_inprogress&&"N"==g_duplicating)if(g_start_canvas!==g_present_canvas&&"Y"==g_drag_inprogress&&"PREV_VERSION"!=g_compare_view){var W=g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index];if(g_world=g_scene_objects[g_start_canvas].scene.children[2],"Y"==g_shelf_edit_flag){var[V,X]=await create_drag_objects(g_module_index,g_shelf_index,g_item_index,W,W.ItemInfo,g_show_live_image,"SHELF",g_dragItem,g_start_canvas,g_present_canvas);W.SObjID=X;var U=[];if(g_drag_items_arr.length>0){for(const e of g_drag_items_arr){var[V,X]=await create_drag_objects(g_module_index,g_shelf_index,e.IIndex,e.ShelfInfo,e.ItemInfo,g_show_live_image,"ITEM",e,g_start_canvas,g_present_canvas);W.ItemInfo[g_item_index].ObjID=X,U.push(V)}U.length>0&&(g_drag_items_arr=[],g_drag_items_arr=U),await set_inter_canvas_items(K,Z,g_dragItem,U,W.W,W.H,W.ObjType,W.BsktSpreadProduct,W.Rotation,W.Slope,g_shelf_index,g_module_index,g_start_canvas)}render(g_start_canvas)}else if("Y"==g_item_edit_flag){var[V,X]=await create_drag_objects(g_module_index,g_shelf_index,g_item_index,g_dragItem.ShelfInfo,g_dragItem.ItemInfo,g_show_live_image,"ITEM",g_dragItem,g_start_canvas,g_present_canvas);if("Y"==g_carpark_item_flag){var z=g_pog_json[g_start_canvas].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].X,J=g_pog_json[g_start_canvas].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].Y;g_pog_json[g_start_canvas].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].Z}else z=W.ItemInfo[g_item_index].X,J=W.ItemInfo[g_item_index].Y,W.ItemInfo[g_item_index].Z;"Y"==g_carpark_item_flag?g_pog_json[g_start_canvas].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].ObjID=X:W.ItemInfo[g_item_index].ObjID=X,V.position.x=z,V.position.y=J,V.position.z=g_drag_z}g_pog_index=g_start_canvas,animate_pog(i),g_canvas_drag="N",g_drag_inprogress="N",g_intersected=[]}else if("Y"==g_duplicating)g_cut_copy_arr=[],g_cut_support_obj_arr=[],g_cut_loc_arr=[],loc_details={},g_undo_details=[],g_duplicating="N",g_drag_inprogress="N";else{g_mousedown_locx="",g_final_x=g_dragItem.position.x,g_finalY=g_dragItem.position.y,u=g_dragItem.position.y,g_final_z=g_dragItem.position.z;var K=0,Z=0,q="N",Q=[];if(g_allUndoObjectsInfo=[],-1!==g_module_index&&""!==g_module_index&&-1!==g_shelf_index&&""!==g_shelf_index){g_pog_json[i].ModuleInfo[g_module_index];var ee=g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index]}var oe=ee,[E,_e,te,ne]=get_curr_module(g_final_x,u,g_shelf_edit_flag,g_module_index,g_shelf_index,oe,i),ge="";if("Y"==g_item_edit_flag){var[_e,E,ae,ie,re,se,le,M]=get_div_shelf_index(g_final_x,u,E,_e,i,g_dragItem,!0);if("Y"!==M){var[de,fe,ce,Ie,pe,me,ue,he,ge]=itemInPegboardOverhang(g_final_x,u,i,g_dragItem);de&&([_e,E,ae,ie,re,se,le]=[fe,ce,Ie,pe,me,ue,he])}}if((0!==nvl(g_pog_json)&&"Y"==g_item_edit_flag||"Y"==g_shelf_edit_flag)&&void 0!==se&&-1!==se&&(checkDuplicate("",E,se,"BACKUP")||backupPog("S",se,E,i)),"Y"==g_shelf_edit_flag){K=ee.X,Z=ee.Y,ee.Z,(Ye=[]).moduleIndex=g_module_index,Ye.module=g_pog_json[i].ModuleInfo[g_module_index].Module,Ye.shelfIndex=g_shelf_index,Ye.objectID=ee.SObjID,Ye.moduleObjectID=g_pog_json[i].ModuleInfo[E].MObjID,Ye.actionType="SHELF_DRAG",Ye.startCanvas=g_start_canvas,Ye.g_present_canvas=g_present_canvas;var Se=ee;Ye.push(JSON.parse(JSON.stringify(ee))),g_allUndoObjectsInfo.push(Ye),ee.Y=u,ee.X=g_final_x,old_iteminfo=JSON.parse(JSON.stringify(ee.ItemInfo));var ve,Oe=!1,[xe,De]=getCombinationShelf(i,g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Shelf);if(-1!==xe&&(comb_shelf_ind="Y"),ve=await getconfirm_shelfmove(i),g_pog_json[i].ModuleInfo[E].H>.1&&"ROD"!==g_shelf_object_type&&"TEXTBOX"!==g_shelf_object_type&&"Y"==g_auto_position_ind?Oe=auto_position_shelf(g_module_index,E,g_shelf_index,te,g_final_x,u,"N",i):await set_all_items(g_module_index,g_shelf_index,g_final_x,u,g_shelf_edit_flag,"E","Y",i,i),-1!==g_module_index&&""!==g_module_index&&-1!==g_shelf_index&&""!==g_shelf_index){var be=ee.ItemInfo,je=ee.AllowAutoCrush;"Y"==g_shelf_edit_flag&&"Y"==ve&&("Y"==g_max_facing_enabled&&reset_auto_crush(g_module_index,g_shelf_index,g_item_index,i,g_module_index,g_shelf_index,i),await set_auto_facings(g_module_index,g_shelf_index,-1,be,"B","S","D",i))}if("Y"==g_shelf_edit_flag&&"ROD"!==g_shelf_object_type&&"TEXTBOX"!==g_shelf_object_type&&"N"==te&&"Y"==ve){var Me=E==g_module_index?g_module_index:E;q=await validate_shelf_min_distance(Me,g_shelf_index,ee.Y,be,je,g_module_index,ee.X,"Y",oe,i)}else q="Y"==te?"N":"Y";if("N"==ve&&(q="N"),"Y"!=q&&"R"!=q||"Y"!=g_shelf_edit_flag||"Y"!=ve){if("N"==q&&"Y"==g_shelf_edit_flag){if(ee.X=K,ee.Y=Z,ee.ItemInfo=old_iteminfo,"Y"==te&&alert(get_message("LOST_FROM_SHELF_ROTATION_ERR",ee.Shelf,g_pog_json[i].POGCode+g_pog_json[i].ModuleInfo[g_module_index].Module)),"Y"==g_max_facing_enabled){await set_all_items(g_module_index,g_shelf_index,K,Z,g_shelf_edit_flag,"E","Y",i,i);G=await recreate_all_items(g_module_index,g_shelf_index,g_shelf_object_type,"Y",g_final_x,-1,g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.length,"N","N",-1,-1,g_start_canvas,"",i,$v("P193_POGCR_DELIST_ITEM_DFT_COL"),$v("P193_MERCH_STYLE"),$v("P193_POGCR_LOAD_IMG_FROM"),$v("P193_BU_ID"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_ITEM_NUM_LABEL_POS"),$v("P193_POGCR_DISPLAY_ITEM_INFO"),"Y",ge)}else ee.ItemInfo.length>0&&"N"==te&&await set_all_items(g_module_index,g_shelf_index,K,Z,g_shelf_edit_flag,"E","Y",i,i);g_dragItem.position.set(K,Z,g_drag_z),"Y"==g_shelf_edit_flag&&("PEGBOARD"==g_shelf_object_type||"CHEST"==g_shelf_object_type&&"Y"==g_chest_as_pegboard?g_dragItem.position.z=15e-5:"ROD"==g_shelf_object_type?g_dragItem.position.z=.005:"TEXTBOX"==g_shelf_object_type?g_dragItem.position.z=5e-4:g_dragItem.position.z=0==nvl(g_dragItem.position.z)?15e-5:g_dragItem.position.z)}}else{g_pog_edited_ind="Y",g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Combine="N","SHELF"!=g_shelf_object_type&&"HANGINGBAR"!=g_shelf_object_type||await generateCombinedShelfs(i,g_module_index,g_shelf_index,$v("P193_POGCR_DELIST_ITEM_DFT_COL"),$v("P193_MERCH_STYLE"),$v("P193_POGCR_LOAD_IMG_FROM"),$v("P193_BU_ID"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_ITEM_NUM_LABEL_POS"),$v("P193_POGCR_DISPLAY_ITEM_INFO"),"Y","","Y");var[Me,Ee]=await set_shelf_after_drag(comb_shelf_ind="R",g_shelf_edit_flag,g_module_index,E,g_shelf_index,g_final_x,ee.Y,"Y","Y",g_module_index,g_shelf_index,i,i,xe);"Y"==g_itemSubLabelInd&&showItemSubLabel(g_itemSubLabel,g_itemSubLabelInd,$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_ITEM_NUM_LABEL_POS"),i);Se=g_pog_json[i].ModuleInfo[Me].ShelfInfo[Ee];var Pe=0;if(!Oe&&ee.X>g_pog_json[i].ModuleInfo[Me].X-g_pog_json[i].ModuleInfo[Me].W/2&&ee.X<g_pog_json[i].ModuleInfo[Me].X+g_pog_json[i].ModuleInfo[Me].W/2&&ee.Y+ee.H/2>g_pog_json[i].ModuleInfo[Me].Y-g_pog_json[i].ModuleInfo[Me].H/2&&ee.Y<g_pog_json[i].ModuleInfo[Me].Y+g_pog_json[i].ModuleInfo[Me].H/2&&g_pog_json[i].ModuleInfo[Me].NotchSpacing>0&&"CHEST"!==g_shelf_object_type&&"ROD"!==g_shelf_object_type&&"TEXTBOX"!==g_shelf_object_type){var[Ce,Ne]=find_top_notch(Me,Ee,ee.Y,g_final_x,g_drag_shelf_notch,i);if(Ce>-1&&Ne>-1){var Te=g_scene_objects[i].scene.children[2].getObjectById(g_pog_json[i].ModuleInfo[Me].ShelfInfo[Ee].SObjID);g_pog_json[i].ModuleInfo[Me].ShelfInfo[Ee].X=Ne,g_pog_json[i].ModuleInfo[Me].ShelfInfo[Ee].Y=Ce,Te.X=wpdSetFixed(100*g_pog_json[i].ModuleInfo[Me].ShelfInfo[Ee].X-100*g_pog_json[i].ModuleInfo[Me].ShelfInfo[Ee].W/2),Te.Y=wpdSetFixed(100*g_pog_json[i].ModuleInfo[Me].ShelfInfo[Ee].Y-100*g_pog_json[i].ModuleInfo[Me].ShelfInfo[Ee].H/2),await set_all_items(Me,Ee,Ne,Ce,g_shelf_edit_flag,"N","Y",i,i),Te.position.set(Ne,Ce)}}if(g_undo_details=[],g_undo_obj_arr=[],g_undo_supp_obj_arr=[],g_redo_final_obj_arr=[],g_redo_all_obj_arr=[],logFinalUndoObjectsInfo("SHELF_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","Y"),g_allUndoObjectsInfo=[],"Y"==g_show_max_merch&&(await add_merch("N",i),await add_merch("Y",i)),"Y"==g_show_notch_label&&await update_single_notch_label("Y",Me,Ee,$v("P193_NOTCH_HEAD"),"",i,"N"),"Y"==g_fixel_label&&await show_fixel_labels("Y",i),await recreate_compare_views(g_compare_view,"N"),be.length>0&&(g_pog_json[i].ModuleInfo[Me].EditFlag="Y"),"CHEST"==Se.ObjType&&"Y"==g_chest_as_pegboard&&(Se.ChestEdit="Y"),"Y"==Se.InsidePegboard){(Te=g_scene_objects[i].scene.children[2].getObjectById(g_pog_json[i].ModuleInfo[Me].ShelfInfo[Ee].SObjID)).position.z=.016;for(const e of Se.ItemInfo){g_scene_objects[i].scene.children[2].getObjectById(e.ObjID).position.z=.016,Pe++}}}}if("Y"==g_item_edit_flag&&"Y"==_e&&-1!==se){if("Y"==g_carpark_item_flag){z=g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].X,J=g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].Y,g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].Z;var ye=g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].Fixed,Re=(be=g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo,Q=JSON.parse(JSON.stringify(g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index])),g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].SpreadItem),we=g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index]}else{z=ee.ItemInfo[g_item_index].X,J=ee.ItemInfo[g_item_index].Y,ee.ItemInfo[g_item_index].Z;ye=ee.ItemInfo[g_item_index].Fixed,be=ee.ItemInfo,Q=JSON.parse(JSON.stringify(ee.ItemInfo[g_item_index])),Re=ee.SpreadItem,we=ee.ItemInfo[g_item_index];g_temp_cut_arr.push(JSON.parse(JSON.stringify(g_pog_json[i].ModuleInfo))),g_isBookend=ee.ItemInfo[g_item_index].Fixed,g_movedObjID=ee.ItemInfo[g_item_index].ObjID}var Fe;item_width_arr=[],item_height_arr=[],item_depth_arr=[],Io=[],no=[],isTopItem="N",$e=-1,ke=-1,We="N",old_div_shelf="",drag_direction=z<g_final_x?"F":"B";var Ye=[],xe="";if(no.push(to),g_shelf_index!==se||g_module_index!==E){Ye=[];var[xe,De]=getCombinationShelf(i,g_pog_json[i].ModuleInfo[E].ShelfInfo[se].Shelf);if(-1!==xe){if(Ye.CombineInd="Y",Ye.CombShelfIndex=De,currCombination=g_combinedShelfs[xe],currCombination.length>1)for(obj of currCombination)Ye.push(JSON.parse(JSON.stringify(g_pog_json[obj.PIndex].ModuleInfo[obj.MIndex].ShelfInfo[obj.SIndex])))}else Ye.push(JSON.parse(JSON.stringify(g_pog_json[i].ModuleInfo[E].ShelfInfo[se])));Ye.moduleIndex=E,Ye.shelfIndex=se,Ye.actionType="ITEM_DELETE",Ye.startCanvas=g_start_canvas,Ye.objectID=g_pog_json[i].ModuleInfo[E].ShelfInfo[se].SObjID,Ye.module=g_pog_json[i].ModuleInfo[E].Module,Ye.moduleObjectID=g_pog_json[i].ModuleInfo[E].MObjID,g_allUndoObjectsInfo.push(Ye)}if("Y"==g_carpark_item_flag)if(g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo.length>1)(Ye=[]).moduleIndex=g_module_index,Ye.shelfIndex=g_shelf_index,Ye.IsCarpark="Y",Ye.actionType="ITEM_DELETE",Ye.startCanvas=g_start_canvas,Ye.objectID=g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].SObjID,Ye.module=g_pog_json[i].ModuleInfo[g_module_index].Module,Ye.moduleObjectID=g_pog_json[i].ModuleInfo[g_module_index].MObjID,Ye.push(JSON.parse(JSON.stringify(g_pog_json[i].ModuleInfo[g_module_index].Carpark[0]))),g_allUndoObjectsInfo.push(Ye);else{for(var He=[],Le=(Pe=0,g_undo_final_obj_arr.length);Pe<Le;Pe++)void 0!==g_undo_final_obj_arr[Pe].IsCarpark&&"N"!=g_undo_final_obj_arr[Pe][0][0].IsCarpark||He.push(g_undo_final_obj_arr[Pe]);g_undo_final_obj_arr=He;for(He=[],Pe=0,Le=g_redo_final_obj_arr.length;Pe<Le;Pe++)void 0!==g_redo_final_obj_arr[Pe].IsCarpark&&"N"!=g_undo_final_obj_arr[Pe][0][0].IsCarpark||He.push(g_redo_final_obj_arr[Pe]);g_redo_final_obj_arr=He}if("N"==g_carpark_item_flag){Ye=[];var[Ae,Be]=getCombinationShelf(i,ee.Shelf);if(-1!==Ae){if(Ae!==xe||g_shelf_index==se&&g_module_index==E){if(Ye.CombineInd="Y",Ye.CombShelfIndex=Be,currCombination=g_combinedShelfs[Ae],currCombination.length>1)for(obj of currCombination)Ye.push(JSON.parse(JSON.stringify(g_pog_json[obj.PIndex].ModuleInfo[obj.MIndex].ShelfInfo[obj.SIndex])));Ye.moduleIndex=g_module_index,Ye.shelfIndex=g_shelf_index,Ye.actionType="ITEM_DELETE",Ye.startCanvas=g_start_canvas,Ye.objectID=ee.SObjID,Ye.module=g_pog_json[i].ModuleInfo[g_module_index].Module,Ye.moduleObjectID=g_pog_json[i].ModuleInfo[g_module_index].MObjID,g_allUndoObjectsInfo.push(Ye)}}else Ye.push(JSON.parse(JSON.stringify(ee))),Ye.moduleIndex=g_module_index,Ye.shelfIndex=g_shelf_index,Ye.actionType="ITEM_DELETE",Ye.startCanvas=g_start_canvas,Ye.objectID=ee.SObjID,Ye.module=g_pog_json[i].ModuleInfo[g_module_index].Module,Ye.moduleObjectID=g_pog_json[i].ModuleInfo[g_module_index].MObjID,g_allUndoObjectsInfo.push(Ye)}if(E==g_module_index&&g_shelf_index==se&&(g_item_index>0&&g_item_index<ee.ItemInfo.length-1?g_final_x>ee.ItemInfo[g_item_index-1].X&&g_final_x<ee.ItemInfo[g_item_index+1].X&&(drag_direction="S"):0==g_item_index&&ee.ItemInfo.length>1?g_final_x<ee.ItemInfo[g_item_index+1].X&&(drag_direction="S"):g_item_index==ee.ItemInfo.length-1&&ee.ItemInfo.length>1&&g_final_x>ee.ItemInfo[g_item_index-1].X&&(drag_direction="S")),old_item_ind=g_item_index,"N"==g_carpark_item_flag&&"BASKET"==ee.ItemInfo[g_item_index].CType&&(ee.ItemInfo[g_item_index].H=ee.ItemInfo[g_item_index].OH,ee.ItemInfo[g_item_index].W=ee.ItemInfo[g_item_index].OW,ee.ItemInfo[g_item_index].D=ee.ItemInfo[g_item_index].OD,ee.ItemInfo[g_item_index].BaseD=1,ee.ItemInfo[g_item_index].BHoriz=1,ee.ItemInfo[g_item_index].BVert=1),$.each(be,(function(e,o){"Y"==g_carpark_item_flag?g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[e].Exists="E":ee.ItemInfo[e].Exists="E"})),"DIVIDER"==we.Item&&("PEGBOARD"==ae||"TEXTBOX"==ae||"HANGINGBAR"==ae||"ROD"==ae||"CHEST"==ae&&"Y"==g_chest_as_pegboard))g_dragItem.position.set(z,J,g_drag_z),alert(get_message("LOST_FROM_SHELF_ROTATION_ERR",we.ItemID,g_pog_json[i].ModuleInfo[E].ShelfInfo[se].Shelf));else{if("N"==g_carpark_item_flag&&(void 0!==we.TopObjID&&""!==we.TopObjID||void 0!==we.BottomObjID&&""!==we.BottomObjID))reset_bottom_item(g_module_index,g_shelf_index,g_item_index,g_module_index,g_shelf_index,g_final_x,i);("F"==Re||we.CrushHoriz>0&&"N"==we.MHorizCrushed)&&(we.W=we.RW,ee.ItemInfo[g_item_index].W=we.RW);var[Fe,ke,$e,Ge,We,we,Ve,Xe,Ue]=await update_item_loc(E,g_module_index,g_shelf_index,se,ae,g_item_index,g_final_x,le,we,ie,re,u,g_pog_json,drag_direction,i,i);if("DIVIDER"==we.Item&&(old_div_shelf=JSON.parse(JSON.stringify(g_pog_json[i].ModuleInfo[$e].ShelfInfo[Ve]))),"Y"==g_pegbrd_auto_placing&&"PEGBOARD"==Ge||"PEGBOARD"!==Ge&&"CHEST"!==Ge||"CHEST"==Ge&&"N"==g_chest_as_pegboard?we.Edited="Y":we.Edited="N",we.SameShelf="N","N"==(oe=g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke]).AllowAutoCrush&&oe.SObjID!==ee.SObjID&&(we.CrushVert=0,we.CrushD=0,we.CrushHoriz=0),"Y"==g_carpark_item_flag?g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].Y=u:(ee.ItemInfo[g_item_index].Y=u,"PALLET"==Ge&&"PALLET"!==g_shelf_object_type&&(we.Z=0+we.D/2,ee.ItemInfo[g_item_index].Z=0+we.D/2)),"CHEST"==Ge&&"Y"==g_chest_as_pegboard)Je=u;else if("PEGBOARD"!==Ge)var[ze,Je]=get_item_xy(oe,we,we.W,we.H,i);else Je=u;var Ke=-1;if("Y"==Xe?(Ke=g_pog_json[i].ModuleInfo[E].ShelfInfo[se].ItemInfo[Ue].ObjID,ee.ItemInfo[g_item_index].BottomObjID=g_pog_json[i].ModuleInfo[E].ShelfInfo[se].ItemInfo[Ue].ObjID,ee.ItemInfo[g_item_index].X=g_pog_json[i].ModuleInfo[E].ShelfInfo[se].ItemInfo[Ue].X,g_pog_json[i].ModuleInfo[E].ShelfInfo[se].ItemInfo[Ue].TopObjID=ee.ItemInfo[g_item_index].ObjID,"PALLET"==Ge&&(ee.ItemInfo[g_item_index].Z=g_pog_json[i].ModuleInfo[E].ShelfInfo[se].ItemInfo[Ue].Z,we.Z=ee.ItemInfo[g_item_index].Z),Fe="R"==Re?Ue-1:Ue+1,we.BottomObjID=Ke,we.TopItem="Y",g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo[Ue].BelowItem="Y",Je=g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo[Ue].Y+g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo[Ue].H/2+we.H/2):(we.TopItem="N",we.X=g_final_x),"DIVIDER"!==we.Item?we.Y=Je:"BASKET"==Ge&&"DIVIDER"==we.Item?we.Y=u:we.Y=Je,we.YDistance=u-(g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].Y+g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].H/2),we.DropY=Je,"DIVIDER"==we.Item&&"CHEST"!==Ge&&"PALLET"!==Ge&&(we.Rotation=0),we.SIndex=ke,we.Dragged="Y","N"==g_carpark_item_flag&&("PEGBOARD"==Ge&&"PEGBOARD"==ee.ObjType||"CHEST"==Ge&&"CHEST"==ee.ObjType&&"Y"==g_chest_as_pegboard)&&(we.SameShelf="Y"),"Y"==g_carpark_item_flag?0==g_item_index?g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo.splice(g_item_index,g_item_index+1):g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo.splice(g_item_index,1):0==g_item_index?ee.ItemInfo.splice(g_item_index,g_item_index+1):ee.ItemInfo.splice(g_item_index,1),"Y"==Xe){Pe=0;for(const e of g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo){if(e.ObjID==Ke){Fe="R"==Re?Pe-1:Pe+1;break}Pe++}}else await crushItem(i,g_module_index,g_shelf_index,-1,"W","Y",-1,-1);we.DfacingUpd="Y";var Ze=await set_item_after_drag(Ge,Re,$e,ke,Fe,we,i);Pe=0;for(const e of g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo){if(e.ObjID==we.ObjID){Ze=Pe;break}Pe++}var[$e,ke,Ze]=await set_combine_items_after_drag($e,ke,i,Ze,g_module_index,g_shelf_index,g_item_index,i,g_final_x,"N");"BASKET"==g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ObjType&&"DIVIDER"==g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo[Ze].Item&&(g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo[Ze].Y=g_finalY);var qe=g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo[Ze];if(reorder_items($e,ke,i)){const e=g_invalidPosition;Pe=0;for(const e of g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo){if(e.ObjID==qe.ObjID){Ze=Pe;break}Pe++}var Qe=0;for(const e of g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo){e.CType=g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ObjType;var eo=get_item_xaxis(e.W,e.H,e.D,e.CType,-1,g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].HorizGap,g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].SpreadItem,g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].HorizGap,$e,ke,Qe,"Y",g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo.length,"N",i,ge);e.X=eo,Qe++}G="N";if(check_dim_difference($e,ke,Ze,i))G=await check_item_dim_valid(qe,$e,ke,Ze,i);else if("PEGBOARD"!==Ge)if("BASKET"==Ge&&"DIVIDER"==we.Item||"Y"==g_chest_as_pegboard&&"CHEST"==Ge);else G=update_validate_item_height(qe,$e,ke,Ze,g_final_x,Ge,-1,i);if("N"==Xe&&"DIVIDER"!==g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo[Ze].Item)await set_auto_facings($e,ke,Ze,qe,"B","I","D",i);g_invalidPosition=e}("PEGBOARD"==Ge||"Y"==g_chest_as_pegboard&&"CHEST"==Ge)&&(g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo[Ze].Exists="N",g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo[Ze].X=g_final_x,g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo[Ze].Y=u,g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo[Ze].DropY=u),"F"==g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].SpreadItem&&$.each(g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo,(function(e,o){o.W=o.RW}));qe=g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo[Ze];item_width_arr.push(wpdSetFixed(qe.W)),item_height_arr.push(wpdSetFixed(qe.H)),item_depth_arr.push(wpdSetFixed(qe.D)),Io.push(Ze);var oo={};if(g_combineItemModf=[],oo.NewMIndex=$e,oo.NewSIndex=ke,oo.OldMIndex=$e,oo.OldSIndex=ke,oo.OldIIndex=Ze,oo.OldObjID=qe.ObjID,g_combineItemModf.push(oo),"F"!=G&&"N"!=G||!await validate_items(item_width_arr,item_height_arr,item_depth_arr,Io,Ge,$e,ke,Ze,We,we.CrushHoriz,we.CrushVert,we.CrushD,g_final_x,ye,"N","Y",Xe,"N",[],"Y","Y","Y",i)){if(Q.DimUpdate=g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo[Ze].DimUpdate,"N"==g_carpark_item_flag)reset_bottom_item($e,ke,Ze,-1,-1,g_final_x,i);if(0==Ze?g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo.splice(Ze,Ze+1):g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo.splice(Ze,1),"Y"==g_carpark_item_flag?(g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo.splice(g_item_index,0,Q),g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].X=z,g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].Y=J):(ee.ItemInfo.splice(g_item_index,0,Q),ee.ItemInfo[g_item_index].X=z,ee.ItemInfo[g_item_index].Y=J),0!==ee.Rotation){Te=g_scene_objects[i].scene.children[2].getObjectById(ee.SObjID),e=ee.ItemInfo[g_item_index].RotationX,o=ee.ItemInfo[g_item_index].RotationY,h=ee.ItemInfo[g_item_index].RotationZ;var _o=new THREE.Vector3(e,o,h).applyMatrix4(Te.matrixWorld);g_dragItem.position.x=_o.x,g_dragItem.position.y=_o.y,g_dragItem.position.z=_o.z,g_dragItem.quaternion.copy(Te.quaternion),g_dragItem.updateMatrix()}else g_dragItem.position.set(z,J,g_itemDragZ),g_dragItem.updateMatrix()}else{g_pog_edited_ind="Y";var X=0;g_undo_details=[],g_undo_obj_arr=[],g_undo_supp_obj_arr=[];var to={},no=[];if(to.MIndex=g_module_index,to.SIndex=g_shelf_index,to.NewModuleIndex=$e,to.NewShelfIndex=ke,no.push(to),g_shelf_index!==se||E!==g_module_index){try{if(reorder_items($e,ke,i)){if("SHELF"==ae&&("L"==g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].SpreadItem||"R"==g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].SpreadItem)){var go=mergeAdjacentItems(i,$e,ke,Ze);go>-1&&(Ze=go)}G=await recreate_all_items($e,ke,ae,"Y",g_final_x,Ze,g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo.length,"N","N",-1,-1,g_start_canvas,"",i,$v("P193_POGCR_DELIST_ITEM_DFT_COL"),$v("P193_MERCH_STYLE"),$v("P193_POGCR_LOAD_IMG_FROM"),$v("P193_BU_ID"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_ITEM_NUM_LABEL_POS"),$v("P193_POGCR_DISPLAY_ITEM_INFO"),"Y",ge);var ao=-1;if(g_combineItemModf.length>0)for(var io=0;io<g_combineItemModf.length;io++)if(g_combineItemModf[io].OldMIndex==$e&&g_combineItemModf[io].OldSIndex==ke){$e=g_combineItemModf[io].OldMIndex,ke=g_combineItemModf[io].OldSIndex,ao=io;break}var ro=g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo,so={X:"asc",Y:"asc"};if(ro.keySort(so),-1!==ao){var lo=0;for(item of ro)item.ObjID==g_combineItemModf[ao].NewObjID&&(Ze=lo),lo++}g_combineItemModf=[];var fo=g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo[Ze],Te=g_scene_objects[i].scene.children[2].getObjectById(fo.ObjID);g_intersected.push(Te),render_animate_selected()}update_item_distance($e,ke,i),render(i)}catch(e){error_handling(e)}logFinalUndoObjectsInfo("SHELF_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","Y",g_carpark_item_flag),g_allUndoObjectsInfo=[],g_pog_json[i].ModuleInfo[$e].EditFlag="Y","CHEST"==g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ObjType&&"Y"==g_chest_as_pegboard&&(g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ChestEdit="Y")}try{if("F"==ee.SpreadItem){Pe=0;for(const e of ee.ItemInfo)0==e.CrushHoriz&&(e.W=e.RW),Pe++}var[xe,De]=getCombinationShelf(i,g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].Shelf),[co,Be]=getCombinationShelf(i,g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Shelf);if((xe!==co&&xe>-1||-1==xe||g_shelf_index==se&&E==g_module_index)&&reorder_items(g_module_index,g_shelf_index,i)){G=await recreate_all_items(g_module_index,g_shelf_index,ee.ObjType,"Y",g_final_x,Ze,ee.ItemInfo.length,"N","N",-1,-1,g_start_canvas,"",i,$v("P193_POGCR_DELIST_ITEM_DFT_COL"),$v("P193_MERCH_STYLE"),$v("P193_POGCR_LOAD_IMG_FROM"),$v("P193_BU_ID"),$v("P193_POGCR_ITEM_NUM_LBL_COLOR"),$v("P193_POGCR_ITEM_NUM_LABEL_POS"),$v("P193_POGCR_DISPLAY_ITEM_INFO"),"Y",ge),ao=-1;if(g_combineItemModf.length>0)for(io=0;io<g_combineItemModf.length;io++)if(g_combineItemModf[io].OldMIndex==$e&&g_combineItemModf[io].OldSIndex==ke){$e=g_combineItemModf[io].NewMIndex,ke=g_combineItemModf[io].NewSIndex,ao=io;break}ro=g_pog_json[i].ModuleInfo[$e].ShelfInfo[ke].ItemInfo,so={X:"asc",Y:"asc"};if(ro.keySort(so),-1!==ao){lo=0;for(item of ro)item.ObjID==g_combineItemModf[ao].NewObjID&&(Ze=lo),lo++}}update_item_distance(g_module_index,g_shelf_index,i),g_pog_json[i].ModuleInfo[g_module_index].EditFlag="Y","CHEST"==g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType&&"Y"==g_chest_as_pegboard&&(g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ChestEdit="Y"),render(i)}catch(e){error_handling(e)}if(g_shelf_index==se&&E==g_module_index&&(logFinalUndoObjectsInfo("SHELF_DRAG","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","Y",g_carpark_item_flag),g_allUndoObjectsInfo=[]),"Y"==g_carpark_item_flag&&"DB"==$v("P193_POGCR_LOAD_IMG_FROM")){var Io=[];(be=[]).push(we),Io.push(Ze);G=await get_images($e,ke,be,Io,parseFloat($v("P193_POGCR_IMG_MAX_WIDTH")),parseFloat($v("P193_POGCR_IMG_MAX_HEIGHT")),parseFloat($v("P193_IMAGE_COMPRESS_RATIO")));if(be.length>0)G=await get_images(Pe,j,be,Io,parseFloat($v("P193_POGCR_IMG_MAX_WIDTH")),parseFloat($v("P193_POGCR_IMG_MAX_HEIGHT")),parseFloat($v("P193_IMAGE_COMPRESS_RATIO")));if(0==g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo.length){var po=g_scene_objects[i].scene.children[2].getObjectById(g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].SObjID);g_scene_objects[i].scene.children[2].remove(po),g_pog_json[i].ModuleInfo[g_module_index].Carpark.splice(0,1)}}recreate_compare_views(g_compare_view,"N")}if("Y"==g_invalidPosition){var mo=g_undoRedoAction;g_invalidPosition="N",g_validationFlag="Y",undo_actions_not_delete("UNDO",a,i),alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",ee.Shelf)),g_redo_final_obj_arr.pop(),g_undoRedoAction=mo}}}else"Y"==g_item_edit_flag&&rollback_item(g_module_index,g_shelf_index,g_item_index,g_drag_z,i);if("Y"==g_shelf_edit_flag){if("N"==g_manual_zoom_ind&&!S){var uo=get_min_max_xy(i).split("###");set_camera_z(a,parseFloat(uo[2]),parseFloat(uo[3]),parseFloat(uo[0]),parseFloat(uo[1]),g_offset_z,parseFloat(uo[4]),parseFloat(uo[5]),!1,i)}if(0!==g_rotation||0!==g_slope){if(0!==g_rotation){if(g_dragItem.quaternion.copy(a.quaternion),g_dragItem.lookAt(g_pog_json[i].CameraX,g_pog_json[i].CameraY,g_pog_json[i].CameraZ),"TEXTBOX"==ee.ObjType){var ho=g_slope;0==g_rotation?g_dragItem.rotateX(ho/2*Math.PI/180):g_dragItem.rotateX(ho*Math.PI/180)}else g_dragItem.rotateX(ho*Math.PI/180);g_dragItem.rotateY(g_rotation*Math.PI/180),g_dragItem.updateMatrix()}ee.ItemInfo.length>0&&(g_scene_objects[i].scene.updateMatrixWorld(),await set_all_items(g_module_index,g_shelf_index,K,Z,g_shelf_edit_flag,"N","Y",i,i))}update_rotate_shelfs(i)}g_drag_inprogress="N",g_rotation=0,g_slope=0}g_drag_inprogress="N",g_duplicating="N",g_canvas_drag="N",g_mselect_drag="N","undefined"!=typeof g_dragItem&&"N"==g_canvas_drag&&"N"==g_drag_inprogress&&g_dragItem.StartCanvas==g_present_canvas&&(g_dragItem=[],g_drag_items_arr=[]),render_animate_selected(),render(i),logDebug("function : doMouseUp","E")}catch(e){error_handling(e)}}async function doMouseMove(e,o,_,t,n,g,a,i,r){try{if(g_present_canvas=parseInt(r),g_taskItemInContext=!0,"CANVAS"==_.target.nodeName){var s=_.target;i=s.getAttribute("id");var d=parseInt(s.getAttribute("data-indx")),f=s.width,c=s.height,I=2*e/f-1,p=1-2*o/c,m=o;if(d>-1&&void 0!==g_scene_objects[d]?(a=g_scene_objects[d].scene.children[0],J=g_scene_objects[d].scene.children[2]):J=g_world,a.updateProjectionMatrix(),g_raycaster.setFromCamera(new THREE.Vector2(I,p),a),g_intersects=g_raycaster.intersectObjects(J.children),g_selecting){var u=document.getElementById("t_Header"),h=document.getElementById("t_Body_title"),S=document.getElementById("top_bar"),v=document.getElementById("side_bar"),O=window.devicePixelRatio,x=$(document).scrollTop(),D=$(".t-Region-body").scrollLeft(),b=parseFloat($(".t-Body-contentInner").css("padding-left").replace("px",""))*O,j=u.offsetHeight,M=h.offsetHeight,E=S.offsetHeight,P=v.offsetWidth;g_mouse.x=_.clientX+D-(P+b),g_mouse.y=_.clientY+x-(M+b+j+E);var C=g_startMouse.x,N=g_mouse.x,T=g_startMouse.y,y=g_mouse.y;if(C>N){var R=C;C=N,N=R}if(T>y){R=T;T=y,y=R}return g_DragMouseEnd.x=Math.min(19,Math.max(-19,I)),g_DragMouseEnd.y=Math.min(19,Math.max(-19,o)),g_multiselect="Y",g_selection.style.left=C+"px",g_selection.style.top=T+"px",g_selection.style.width=Math.max(0,N-C-20)+"px",g_selection.style.height=Math.max(0,y-T)+"px",void(g_selection.style.visibility="visible")}if(console.log("MouseMove",g_dragging),g_dragging&&"N"==g_duplicating){g_pog_index=r,g_raycaster.setFromCamera(new THREE.Vector2(I,p),a),g_intersects=g_raycaster.intersectObject(g_targetForDragging);var w=g_drag_z,F=g_intersects[0].point.x,Y=g_intersects[0].point.y,H=g_intersects[0].point.z,L=new THREE.Vector3(F,Y,H);if(J.worldToLocal(L),I=Math.min(19,Math.max(-19,L.x)),o=Math.min(19,Math.max(-19,L.y)),g_intersected){for(var A=0;A<g_intersected.length;A++)void 0!==g_intersected[A]&&(g_select_color=g_intersected[A].BorderColour,void 0!==g_intersected[A].WireframeObj&&(g_intersected[A].WireframeObj.material.color.setHex(g_select_color),"Y"==g_intersected[A].ImageExists&&"Y"==g_show_live_image&&(g_intersected[A].WireframeObj.material.transparent=!0,g_intersected[A].WireframeObj.material.opacity=.0025)));clearInterval(g_myVar),g_select_color=0,render(r)}u=document.getElementById("t_Header"),h=document.getElementById("t_Body_title"),S=document.getElementById("top_bar");var B=document.getElementById("t_Body_nav"),G=(v=document.getElementById("side_bar"),document.querySelector(".wtbar")),W=(O=window.devicePixelRatio,x=$(document).scrollTop(),D=$(".t-Region-body").scrollLeft(),b=parseFloat($(".t-Body-contentInner").css("padding-left").replace("px",""))*O,j=u.offsetHeight,M=h.offsetHeight,E=S.offsetHeight,B.offsetWidth,P=v.offsetWidth,G.offsetHeight);g_mouse.x=_.clientX+D-(P+b),g_mouse.y=_.clientY+x-(M+b+j+E+W);C=g_startMouse.x,N=g_mouse.x,T=g_startMouse.y,y=g_mouse.y;if(C>N){var V=C;C=N,N=V}if(T>y){var X=T;T=y,y=X}if(g_DragMouseEnd.x=I,g_DragMouseEnd.y=o,_.shiftKey&&"Y"==g_manual_zoom_ind)g_grabbing_progress="Y",$(i).css("cursor","grabbing"),g_prevMouse=g_nextMouse,g_nextMouse.x=I,g_nextMouse.y=o,grab_interval=parseFloat($v("P193_POGCR_GRAB_INTERVAL")),e>t&&a.position.set(a.position.x-grab_interval,a.position.y,a.position.z),e<t&&a.position.set(a.position.x+grab_interval,a.position.y,a.position.z),m>n&&a.position.set(a.position.x,a.position.y+grab_interval,a.position.z),m<n&&a.position.set(a.position.x,a.position.y-grab_interval,a.position.z),render(r);else if("Y"==g_mselect_drag&&g_curr_canvas==g_present_canvas){A=0;for(const ae of g_delete_details){var U=J.getObjectById(ae.ObjID);if(void 0!==U&&(U.WireframeObj.material.color.setHex(0),"PEGBOARD"==ae.ObjType||"CHEST"==ae.ObjType&&"Y"==g_chest_as_pegboard?U.position.set(I+ae.XDistance,o-ae.YDistance,g_drag_z):U.position.set(I+ae.XDistance,o+ae.YDistance,g_drag_z),U.updateMatrix(),"SHELF"==ae.Object&&"N"==ae.IsDivider&&0!==ae.Rotation)){g_scene.updateMatrixWorld();var z=0;z=ae.Slope>0?0-ae.Slope:-ae.Slope,U.quaternion.copy(a.quaternion),U.lookAt(g_pog_json[r].CameraX,g_pog_json[r].CameraY,g_pog_json[r].CameraZ),U.rotateY(ae.Rotation*Math.PI/180),"TEXTBOX"==ae.ObjType&&0==ae.Rotation?U.rotateX(z/2*Math.PI/180):U.rotateX(z*Math.PI/180),U.updateMatrix(),g_scene.updateMatrixWorld(),await set_all_items(ae.MIndex,ae.SIndex,I+ae.XDistance,o+ae.YDistance,"Y","N","N",r,r),await update_rotate_shelfs(r)}A++}render(r)}else if(0==g_selecting&&"undefined"!=typeof g_dragItem)if("N"==g_auto_fill_active&&("Y"==g_compare_pog_flag&&g_start_canvas==g_ComViewIndex&&g_present_canvas==g_ComViewIndex&&"PREV_VERSION"==g_compare_view||"PREV_VERSION"!=g_compare_view||g_start_canvas!=g_ComViewIndex&&g_present_canvas!=g_ComViewIndex))if(g_curr_canvas!==g_present_canvas&&"N"==g_carpark_item_flag&&("Y"==g_compare_pog_flag&&parseInt(g_present_canvas)==g_ComViewIndex&&"POG"==g_compare_view||"N"==g_compare_pog_flag||"Y"==g_compare_pog_flag&&parseInt(g_present_canvas)!==g_ComViewIndex)){g_canvas_drag="Y";var J=g_scene_objects[g_present_canvas].scene.children[2],K=g_scene_objects[g_curr_canvas].scene.children[2],Z=(g_scene_objects[g_curr_canvas].renderer,g_scene_objects[g_curr_canvas].scene.children[0],g_show_live_image);if("N"==g_mselect_drag){if("Y"==g_item_edit_flag){async function q(){g_world=g_scene_objects[g_present_canvas].scene.children[2];var[e,_]=await create_drag_objects(g_module_index,g_shelf_index,g_item_index,g_dragItem.ShelfInfo,g_dragItem.ItemInfo,Z,"ITEM",g_dragItem,g_start_canvas,g_present_canvas);e.position.x=I,e.position.y=o,e.position.z=w,K.remove(g_dragItem),render(g_curr_canvas),g_dragItem=e,g_curr_canvas=g_present_canvas,g_canvas_drag="Y",g_drag_inprogress="Y",g_dragItem.updateMatrix()}q()}else if("Y"==g_shelf_edit_flag){async function Q(){g_world=g_scene_objects[g_present_canvas].scene.children[2];var[e,_]=await create_drag_objects(g_module_index,g_shelf_index,g_item_index,g_dragItem.ShelfInfo,g_dragItem.ItemInfo,Z,"SHELF",g_dragItem,g_start_canvas,g_present_canvas);K.remove(g_dragItem),g_dragItem=e;var t=g_curr_canvas;g_curr_canvas=g_present_canvas,g_canvas_drag="Y",g_drag_inprogress="Y",g_dragItem.updateMatrix();var n=[];if(g_drag_items_arr.length>0){for(const o of g_drag_items_arr){K.remove(o);var[e,_]=await create_drag_objects(g_module_index,g_shelf_index,o.IIndex,o.ShelfInfo,o.ItemInfo,Z,"ITEM",o,g_start_canvas,g_present_canvas);n.push(e)}n.length>0&&(g_drag_items_arr=[],g_drag_items_arr=n),await set_inter_canvas_items(I,o,g_dragItem,n,g_dragItem.W,g_dragItem.H,g_shelf_object_type,g_shelf_basket_spread,g_dragItem.Rotation,g_dragItem.ItemSlope,g_shelf_index,g_module_index,g_start_canvas)}render(t)}await Q()}}else{var ee,oe,_e=-1,te=g_curr_canvas;g_world=g_scene_objects[g_present_canvas].scene.children[2];for(const ie of g_multi_drag_item_arr){async function q(){var e=g_pog_json[g_start_canvas].ModuleInfo[ie.MIndex].ShelfInfo[ie.SIndex],_=g_pog_json[g_start_canvas].ModuleInfo[ie.MIndex].ShelfInfo[ie.SIndex].ItemInfo[ie.IIndex].ObjID,t=K.getObjectById(_);[ee,oe]=await create_drag_objects(ie.MIndex,ie.SIndex,ie.IIndex,e,e.ItemInfo[ie.IIndex],Z,"ITEM",t,g_start_canvas,g_present_canvas),void 0!==t&&(t.position.set(I+ie.XDistance,o+ie.YDistance,g_drag_z),t.updateMatrix()),ee.position.x=I,ee.position.y=o,ee.position.z=w,K.remove(t),g_dragItem=ee,g_curr_canvas=g_present_canvas,g_canvas_drag="Y",g_drag_inprogress="Y",g_dragItem.updateMatrix()}_e++,await q();var ne=g_pog_json[g_start_canvas].ModuleInfo[ie.MIndex].ShelfInfo[ie.SIndex].ItemInfo;for(const re of ne)if(void 0!==re.TopObjID&&""!==re.TopObjID||void 0!==re.BottomObjID&&""!==re.BottomObjID){var ge=""!==re.TopObjID&&void 0!==re.TopObjID?"BOTTOM":"TOP";await reset_top_bottom_obj_id(ge,re.OldObjID,re.ObjID,re.X,"N",g_start_canvas)}k=0;for(const se of g_delete_details)se.ObjID==g_multi_drag_item_arr[_e].ObjID&&(g_delete_details[k].OldObjID=g_delete_details[_e].ObjID,g_delete_details[k].ObjID=oe),k++;g_multi_drag_item_arr[_e].OldObjID=g_multi_drag_item_arr[_e].ObjID,g_multi_drag_item_arr[_e].ObjID=oe,g_pog_json[g_start_canvas].ModuleInfo[ie.MIndex].ShelfInfo[ie.SIndex].ItemInfo[ie.IIndex].ObjID=oe}_e=-1;for(const le of g_multi_drag_shelf_arr){async function Q(){var e=g_pog_json[g_start_canvas].ModuleInfo[le.MIndex].ShelfInfo[le.SIndex],_=K.getObjectById(le.ObjID);[n,oe]=await create_drag_objects(le.MIndex,le.SIndex,le.IIndex,e,e.ItemInfo,Z,"SHELF",_,g_start_canvas,g_present_canvas),K.remove(_),_=n,g_canvas_drag="Y",g_drag_inprogress="Y",_.updateMatrix();g_drag_items_arr=[],$.each(le.ItemInfo,(function(e,o){var _=K.getObjectById(o.ObjID);"CHEST"==g_shelf_object_type&&"Y"==g_chest_as_pegboard?(_.PegBoardX=o.PegBoardX,_.PegBoardY=o.PegBoardY):"PEGBOARD"!==g_shelf_object_type?_.Distance=o.Distance:(_.PegBoardX=o.PegBoardX,_.PegBoardY=o.PegBoardY),_.ItemInfo=o,_.IIndex=e,_.StartCanvas=g_curr_canvas,_.MIndex=le.MIndex,_.SIndex=le.SIndex,g_drag_items_arr.push(_)}));var t=[];if(g_drag_items_arr.length>0){for(const o of g_drag_items_arr){K.remove(o);var[n,g]=await create_drag_objects(le.MIndex,le.SIndex,o.IIndex,e,o.ItemInfo,Z,"ITEM",o,g_start_canvas,g_present_canvas);t.push(n);var a=0;for(const e of g_delete_details)e.ObjID==o.id&&(g_delete_details[a].OldObjID=o.id,g_delete_details[a].ObjID=g),a++;o.ItemInfo.ObjID=g,g_pog_json[g_start_canvas].ModuleInfo[le.MIndex].ShelfInfo[le.SIndex].ItemInfo[o.IIndex].ObjID=g}t.length>0&&(g_drag_items_arr=[],g_drag_items_arr=t),await set_inter_canvas_items(I,o,_,t,_.W,_.H,g_shelf_object_type,g_shelf_basket_spread,_.Rotation,_.ItemSlope,le.SIndex,le.MIndex,g_start_canvas)}}_e++,await Q(),l=0;for(const de of g_delete_details)de.ObjID==g_multi_drag_shelf_arr[_e].ObjID&&(g_delete_details[l].OldObjID=g_delete_details[_e].ObjID,g_delete_details[l].ObjID=oe),l++;g_multi_drag_shelf_arr[_e].OldObjID=g_multi_drag_shelf_arr[_e].ObjID,g_multi_drag_shelf_arr[_e].ObjID=oe,g_pog_json[g_start_canvas].ModuleInfo[le.MIndex].ShelfInfo[le.SIndex].SObjID=oe}render(g_curr_canvas),render(te),g_curr_canvas=g_present_canvas}render(r)}else if("Y"==g_compare_pog_flag&&g_present_canvas==g_ComViewIndex&&"PREV_VERSION"==g_compare_view||"Y"==g_compare_pog_flag&&g_start_canvas==g_ComViewIndex&&"EDIT_PALLET"==g_compare_view||"N"==g_compare_pog_flag||"Y"==g_compare_pog_flag&&g_start_canvas!==g_ComViewIndex&&"N"==g_carpark_item_flag){if(g_drag_inprogress="Y",0==g_intersects.length)return;if(("PEGBOARD"==g_shelf_object_type||"CHEST"==g_shelf_object_type&&"Y"==g_chest_as_pegboard)&&"Y"==g_shelf_edit_flag&&(g_drag_z=.00115),"Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&g_present_canvas==g_ComViewIndex)for(const fe of g_drag_items_arr)fe.position.set(I,o,fe.position.z);else if("TEXTBOX"==g_shelf_object_type&&"Y"==g_shelf_edit_flag)g_dragItem.position.set(I,o);else{if(g_present_canvas===g_ComViewIndex&&(g_present_canvas!=g_ComViewIndex||"PREV_VERSION"!=g_compare_view))return!1;g_dragItem.position.set(I,o,g_drag_z)}g_dragItem.updateMatrix(),"Y"!=g_shelf_edit_flag&&"Y"!=g_item_edit_flag||"N"!=g_canvas_drag?"Y"==g_shelf_edit_flag&&await set_inter_canvas_items(I,o,g_dragItem,g_drag_items_arr,g_dragItem.W,g_dragItem.H,g_shelf_object_type,g_shelf_basket_spread,g_dragItem.Rotation,g_dragItem.ItemSlope,g_shelf_index,g_module_index,g_start_canvas):await set_all_items(g_module_index,g_shelf_index,I,o,g_shelf_edit_flag,"N","N",g_curr_canvas,g_curr_canvas),"Y"==g_shelf_edit_flag&&0!==g_rotation&&(g_dragItem.quaternion.copy(a.quaternion),g_dragItem.lookAt(g_pog_json[g_curr_canvas].CameraX,g_pog_json[g_curr_canvas].CameraY,g_pog_json[g_curr_canvas].CameraZ),g_dragItem.rotateY(g_rotation*Math.PI/180),"TEXTBOX"==g_pog_json[g_curr_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType&&0==g_rotation?g_dragItem.rotateX(g_slope/2*Math.PI/180):g_dragItem.rotateX(g_slope*Math.PI/180),g_dragItem.updateMatrix()),render(r)}else g_scene_objects[g_curr_canvas].scene.children[2].remove(g_dragItem),render(g_curr_canvas);else if("Y"==g_auto_fill_active){if(g_drag_inprogress="Y",0==g_intersects.length)return;w=g_dragItem.position.z;I-=g_pog_json[g_start_canvas].ModuleInfo[g_module_index].X,o-=g_pog_json[g_start_canvas].ModuleInfo[g_module_index].Y,g_dragItem.position.set(I,o,w),g_dragItem.updateMatrix(),render(r)}}else g_selecting&&(g_selecting=!1,g_selection.style.visibility="hidden"),"Y"==g_duplicating&&(g_drag_inprogress="Y")}else g_selecting&&(g_selecting=!1,g_selection.style.visibility="hidden",g_dragging=!1)}catch(ce){error_handling(ce)}}function doMouseDoubleclick(e,o,_,t,n,g,a,i){if(logDebug("function : doMouseDoubleclick; x : "+e+"; y : "+o+"; startX : "+_+"; startY : "+t,"S"),g_taskItemInContext=clickInsideElement(n,"canvasregion"),g_taskItemInContext1=clickInsideElement(n,"canvasregion1"),g_dblclick_opened="N","N"==g_dblclick_opened&&g_ComViewIndex!==i){var r=2*e/g.width-1,s=1-2*o/g.height;if(g_raycaster.setFromCamera(new THREE.Vector2(r,s),a),g_intersects=g_raycaster.intersectObjects(g_scene_objects[i].scene.children[2].children),0==g_intersects.length)return"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&void 0!==_&&e<=g.width&&(open_pog_modal("edit_pog",i,"N"),g_dblclick_opened="Y",$s("P193_MODULE_DISP","")),!1;var l=g_intersects[0];g_objectHit=l.object,g_object_hit_ind="o",g_dblclick_objid=g_objectHit.id,g_objectHit_uuid=g_objectHit.uuid,g_carpark_edit_flag="N",g_carpark_item_flag="N",g_module_edit_flag="N",g_shelf_edit_flag="N",g_item_edit_flag="N",g_module_index="",g_shelf_index="",g_module_cnt="",g_item_index="",g_module_width="",g_module_X="",g_shelf_max_merch="",$.each(g_pog_json[i].ModuleInfo,(function(e,o){if("Y"==g_carpark_edit_flag)return!1;null==o.ParentModule&&void 0!==o.Carpark&&void 0!==o.Carpark[0]&&o.Carpark[0].ItemInfo.length>0&&$.each(o.Carpark,(function(o,_){if(_.SObjID==g_objectHit_id)return g_module_index=e,g_shelf_index=o,g_carpark_edit_flag="Y",!1;g_carpark_edit_flag="N"}))})),"N"==g_carpark_edit_flag&&$.each(g_pog_json[i].ModuleInfo,(function(e,o){if(o.MObjID==g_dblclick_objid&&null==o.ParentModule)return g_module_index=e,g_module_cnt=e,g_module_width=o.W,g_module_X=o.X,g_module_edit_flag="Y",!1;g_module_edit_flag="N"})),"N"==g_module_edit_flag&&"N"==g_carpark_edit_flag&&$.each(g_pog_json[i].ModuleInfo,(function(e,o){if("Y"==g_shelf_edit_flag)return!1;null==o.ParentModule&&$.each(o.ShelfInfo,(function(o,_){if("BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType){if(_.SObjID==g_dblclick_objid)return g_module_index=e,g_shelf_index=o,g_shelf_max_merch=_.MaxMerch,g_shelf_edit_flag="Y",!1;g_shelf_edit_flag="N"}}))})),"N"==g_shelf_edit_flag&&"N"==g_module_edit_flag&&"N"==g_carpark_edit_flag&&$.each(g_pog_json[i].ModuleInfo,(function(e,o){if("Y"==g_item_edit_flag)return!1;null==o.ParentModule&&(void 0!==o.Carpark&&void 0!==o.Carpark[0]&&o.Carpark[0].ItemInfo.length>0&&$.each(o.Carpark[0].ItemInfo,(function(_,t){if(t.ObjID==g_objectHit_id)return g_module_index=e,g_shelf_index=0,g_item_index=_,g_item_edit_flag="Y",g_shelf_object_type=o.Carpark[0].ObjType,g_wireframe_id=t.WFrameID,g_carpark_item_flag="Y",!1;g_item_edit_flag="N"})),$.each(o.ShelfInfo,(function(o,_){if("BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType){if("Y"==g_item_edit_flag)return!1;$.each(_.ItemInfo,(function(t,n){if(n.ObjID==g_dblclick_objid)return g_module_index=e,g_shelf_index=o,g_item_index=t,g_item_edit_flag="Y",g_shelf_object_type=_.ObjType,!1;g_item_edit_flag="N"}))}})))})),"Y"==g_carpark_item_flag?g_object_hit_ind="I":"Y"==g_module_edit_flag?g_object_hit_ind="M":"Y"==g_shelf_edit_flag?g_object_hit_ind="S":"Y"==g_item_edit_flag?(g_object_hit_ind="I",g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Exists="E"):g_objectHit_uuid.match(/BASE.*/)&&(g_object_hit_ind="B"),g_dblclick_opened="Y";try{open_edit_modal_popup(g_object_hit_ind,g_module_index,g_shelf_index,"N",i)}catch(e){error_handling(e)}}logDebug("function : doMouseDoubleclick","E")}async function setDefaultState(e){g_module_obj_array=[],g_peg_holes_active="Y",g_show_peg_tags="N",g_draftPogInd="Y"==e?"D":"E";var o=$v("P193_POGCR_SHOW_DFLT_ITEM_LOC"),_=$v("P193_POGCR_DFT_ITEM_DESC"),t=$v("P193_POGCR_DFLT_LIVE_IMAGES"),n=$v("P193_POGCR_DFT_NOTCH_LABEL"),g=$v("P193_POGCR_DFT_FIXEL_LABEL"),a=$v("P193_POGCR_DFT_DAYS_OF_SUPPLY"),i=$v("P193_POGCR_DFLT_FIXEL_AVLSPACE_LBL"),r=$v("P193_POGCR_AUTO_DEPTH_CAL");g_auto_cal_depth_fac=r;var s=$v("P193_POGCR_DFT_OVERHUNG_LABEL");sessionStorage.setItem("g_show_item_desc",_),g_show_fixel_label=g,g_show_item_label=o,g_show_notch_label=n,g_show_item_color="N",g_show_item_desc=_,g_show_live_image=t,g_show_days_of_supply=a,g_show_fixel_space=i,g_overhung_shelf_active=s,g_itemSubLabelInd="N",g_itemSubLabel=""}async function update_item_xy_distance(e,o,_,t){new_details=JSON.parse(JSON.stringify(g_delete_details));for(const e of new_details)e.ShelfInfo="";if(JsonContains(new_details,"Object","SHELF")){var n=0;for(const e of g_delete_details){update_item_distance(e.MIndex,e.SIndex,g_pog_index);var g=e.XAxis,a=e.YAxis;g_delete_details[n].XDistance=wpdSetFixed(g-_),g_delete_details[n].YDistance=wpdSetFixed(a-t),n+=1}}else{var i=0,r=0;for(const e of g_delete_details)i+=e.W,r=Math.max(r,e.H);n=0;var s=0;for(const e of g_delete_details){if(0!==nvl(e.BottomObjID)||0!==nvl(e.TopObjID)){g=e.XAxis,a=e.YAxis;g_delete_details[n].XDistance=wpdSetFixed(g-_),g_delete_details[n].YDistance=wpdSetFixed(a-t)}else{var l=0;0==n?s=(g=_-i/2)+e.W/2:("PEGBOARD"==e.ObjType&&(l=.01),s=(g=s+e.W/2+l)+e.W/2);a=e.YAxis;g_delete_details[n].XDistance=wpdSetFixed(g-_),g_delete_details[n].YDistance=e.H/2}n+=1}}if("Y"==e)for(const e of g_delete_details){void 0===e.IntoShelf&&(e.IntoShelf="N");var d=!1;for(const o of g_multi_drag_shelf_arr)if(o.MIndex===e.MIndex&&o.SIndex===e.SIndex){d=!0;break}if("SHELF"!=e.Object||"N"!=e.IsDivider||d)"N"==e.IntoShelf&&(g_multi_drag_item_arr.push(e),"Y"==g_delete_details.multi_carpark_ind?g_multi_drag_item_arr[g_multi_drag_item_arr.length-1].ItemObj=[JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[e.MIndex].Carpark[e.SIndex].ItemInfo[e.IIndex]))]:g_multi_drag_item_arr[g_multi_drag_item_arr.length-1].ItemObj=[JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex]))]);else{g_multi_drag_shelf_arr.push(e),e.IntoShelf="Y",g_multi_drag_shelf_arr[g_multi_drag_shelf_arr.length-1].ItemInfo=[],j=0;for(const _ of g_delete_details){if(e.MIndex==_.MIndex&&e.SIndex==_.SIndex&&"SHELF"!==_.Object){_.IntoShelf="Y";var f=g_pog_json[o].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[_.IIndex];g_multi_drag_shelf_arr[g_multi_drag_shelf_arr.length-1].ItemInfo.push(f),"Y"==g_delete_details.multi_carpark_ind?g_delete_details[j].ItemObj=[JSON.parse(JSON.stringify(g_pog_json[o].ModuleInfo[_.MIndex].Carpark[_.SIndex].ItemInfo[_.IIndex]))]:g_delete_details[j].ItemObj=[JSON.parse(JSON.stringify(f))]}j+=1}}}}async function open_edit_modal_popup(e,o,_,t,n,g="N"){logDebug("function : open_edit_modal_popup; object_ind : "+e+"; module_ind : "+o+"; shelf_ind : "+_+"; duplicate_fixel : "+t,"S");var a="N";if("Y"==g_carpark_item_flag?a="N":"I"==e&&(a=g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[g_item_index].Item),"M"==e){if("undefined"!=typeof g_pog_json&&g_pog_json[n].ModuleInfo.length>0){var i=[],r=0;for(const e of g_pog_json[n].ModuleInfo)g_module_index!==r&&i.push(e.Module.toUpperCase()),r++}var s=[],l={};l.PogModule=g_pog_json[n].ModuleInfo[o].Module,l.ModuleName=g_pog_json[n].ModuleInfo[o].POGModuleName,l.Remarks=g_pog_json[n].ModuleInfo[o].Remarks,l.H=(100*g_pog_json[n].ModuleInfo[o].H).toFixed(2),l.W=(100*g_pog_json[n].ModuleInfo[o].W).toFixed(2),l.D=(100*g_pog_json[n].ModuleInfo[o].D).toFixed(2),l.Rotation=(100*g_pog_json[n].ModuleInfo[o].Rotation).toFixed(2),l.NotchW=(100*g_pog_json[n].ModuleInfo[o].NotchW).toFixed(2),l.NStart=(100*g_pog_json[n].ModuleInfo[o].NotchStart).toFixed(2),l.Nspacing=(100*g_pog_json[n].ModuleInfo[o].NotchSpacing).toFixed(2),l.HorzStart=(100*g_pog_json[n].ModuleInfo[o].HorzStart).toFixed(2),l.HorzSpacing=(100*g_pog_json[n].ModuleInfo[o].HorzSpacing).toFixed(2),l.VertStart=(100*g_pog_json[n].ModuleInfo[o].VertStart).toFixed(2),l.VertSpacing=(100*g_pog_json[n].ModuleInfo[o].VertSpacing).toFixed(2),l.AllowOvrelap=g_pog_json[n].ModuleInfo[o].AllowOverlap,l.LeftNotch=g_pog_json[n].ModuleInfo[o].LNotch,l.MBackBoard=g_pog_json[n].ModuleInfo[o].Backboard,l.RightNotch=g_pog_json[n].ModuleInfo[o].RNotch,l.LastCompCount=g_pog_json[n].ModuleInfo[o].LastCount,l.Division=g_pog_json[n].Division,l.Dept=g_pog_json[n].Dept,l.Subdept=g_pog_json[n].ModuleInfo[o].SubDept,l.Color=g_pog_json[n].ModuleInfo[o].Color,l.ModNames=i,l.Type="E",l.IsTemplate=g_is_pog_template_open,s.push(l),sessionStorage.setItem("modulelist",JSON.stringify(s)),$s("P193_MODULE_EDIT_IND","Y"),openCustomDialog("create_module",$v("P193_CREATE_MODAL_URL"),"P193_MODALPOG_TRIGGER"),g_temp_POG_arr=JSON.stringify(g_pog_json),apex.item("P193_MODULE_NAME").setFocus(),$("#DELETE_MODULE").css("display","inline")}else if("S"==e)if("TEXTBOX"==g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ObjType){if($s("P193_OBJECT_TYPE",g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ObjType),$s("P193_TEXT_NAME",g_pog_json[n].ModuleInfo[o].ShelfInfo[_].Desc),$s("P193_TEXT_HEIGHT",(100*g_pog_json[n].ModuleInfo[o].ShelfInfo[_].H).toFixed(2)),$s("P193_TEXT_WIDTH",(100*g_pog_json[n].ModuleInfo[o].ShelfInfo[_].W).toFixed(2)),$s("P193_TEXT_ROTATION",g_pog_json[n].ModuleInfo[o].ShelfInfo[_].Rotation),$s("P193_TEXT_SLOPE",g_pog_json[n].ModuleInfo[o].ShelfInfo[_].Slope),$s("P193_TEXT_COLOR",g_pog_json[n].ModuleInfo[o].ShelfInfo[_].Color),$s("P193_TEXT",g_pog_json[n].ModuleInfo[o].ShelfInfo[_].InputText),$s("P193_WRAP_TEXT",g_pog_json[n].ModuleInfo[o].ShelfInfo[_].WrapText),$s("P193_REDUCETOFIT",g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ReduceToFit),$s("P193_FONT_STYLE",g_pog_json[n].ModuleInfo[o].ShelfInfo[_].FStyle),$s("P193_FONT_SIZE",g_pog_json[n].ModuleInfo[o].ShelfInfo[_].FSize),$s("P193_BOLD",g_pog_json[n].ModuleInfo[o].ShelfInfo[_].FBold),apex.item("P193_TEXT_NAME").setFocus(),"N"==t?($s("P193_TEXT_ID",g_pog_json[n].ModuleInfo[o].ShelfInfo[_].Shelf),$s("P193_SHELF_EDIT_IND","Y"),$("#DELETE_TEXT").css("display","inline")):($s("P193_TEXT_ID",""),$s("P193_SHELF_EDIT_IND","N")),g_temp_image_arr=[],""!==g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].TextImg){var d={};if(d.FileName=g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].TextImgName,d.MimeType=g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].TextImgMime,d.Image=g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].TextImg,g_temp_image_arr.push(d),g_temp_image_arr.length>0){var f=new Image;f.src="data:image/png;base64,"+g_temp_image_arr[0].Image,f.onload=function(){const e=document.createElement("canvas");e.width=500,e.height=100;e.getContext("2d").drawImage(f,0,0,500,100),$("#VIEW_IMAGE canvas").remove(),document.getElementById("VIEW_IMAGE").append(e)}}}else $s("P193_IMG_FILENAME",""),$("#IMAGE_AREA canvas").remove(),$("#VIEW_IMAGE canvas").remove();const e=["P193_TEXT_WIDTH","P193_TEXT_HEIGHT","P193_TEXT_COLOR","P193_TEXT_SLOPE","P193_TEXT_ROTATION","P193_FONT_STYLE","P193_FONT_SIZE","P193_BOLD","P193_TEXT","P193_WRAP_TEXT","P193_REDUCETOFIT","P193_IMG_FILENAME"];for(const o of e)$("#"+o+"_CONTAINER .inc_tag_icon").remove(),$("#"+o).removeClass("apex-item-has-icon"),$("#"+o+"_CONTAINER").removeClass("apex-item-wrapper--has-icon");$("#P193_TEXT_ID, #P193_TEXT_NAME").hasClass("apex_disabled")&&$("#P193_TEXT_ID, #P193_TEXT_NAME").removeClass("apex_disabled"),openInlineDialog("add_textbox",75,85)}else{"N"==t?$s("P193_SHELF_EDIT_IND","Y"):$s("P193_SHELF_EDIT_IND","N");var c=[];if("undefined"!=typeof g_pog_json&&g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo.length>0){r=0;for(const e of g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo)g_shelf_index!==r&&c.push(e.Shelf.toUpperCase().trim()),r++}var I=[],p={};p.Allowcrush=g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].AllowAutoCrush,p.Module=g_pog_json[n].ModuleInfo[g_module_index].Module,p.ShelfLen=g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo.length,p.ModW=g_pog_json[n].ModuleInfo[g_module_index].W,p.ModH=g_pog_json[n].ModuleInfo[g_module_index].H,p.ModD=g_pog_json[n].ModuleInfo[g_module_index].D,p.ModX=g_pog_json[n].ModuleInfo[g_module_index].X,p.POGLen=g_pog_json.length,p.POGCode=g_pog_json[n].POGCode,void 0===g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ManualCrush||""==g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ManualCrush?$v("P193_POGCR_MANUAL_CRUSH_ITEM"):g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ManualCrush,p.ShelfInfo=g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index],p.module_index=o,p.shelf_index=_,p.duplicate_fixel=t,p.mod_disp_ind=$v("P193_MODULE_DISP"),p.edited_ind=$v("P193_SHELF_EDIT_IND"),p.g_duplicating=g_duplicating,p.g_item_edit_flag=g_item_edit_flag,p.delete_details=g_delete_details,p.g_overhung_shelf_active=g_overhung_shelf_active,p.g_multiselect=g_multiselect,p.object_type=g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ObjType,p.ShlfNames=c,p.dividerchecked=g_default_checkbox,I.push(p),sessionStorage.setItem("shelf_arr",JSON.stringify(I)),openCustomDialog("SHELF_EDIT",$v("P193_SHELF_URL"),"P193_SHELF_TRIGGER_ELEMENT")}else if("I"==e&&"DIVIDER"!==a){var m={},u=0;"Y"==g_carpark_item_flag?(m=JSON.parse(JSON.stringify(g_pog_json[n].ModuleInfo[o].Carpark[0].ItemInfo[g_item_index])),u=g_pog_json[n].ModuleInfo[o].H):(m=JSON.parse(JSON.stringify(g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[g_item_index])),u=get_max_merch(o,_,g_item_index,"N",-1,n));var h=JSON.parse(JSON.stringify(g_pog_json[n].ModuleInfo[o].ShelfInfo[_]));h.ItemInfo="",m.ItemInfo=g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo,m.MIndex=g_module_index,m.SIndex=g_shelf_index,m.IIndex=g_item_index,m.ShelfInfo=[h],m.Maxmerch=u,m.PIndex=n,m.ShelfAutoCrush=g_pog_json[n].ModuleInfo[o].ShelfInfo[_].AllowAutoCrush,m.g_combinedShelfs=g_combinedShelfs,m.g_multiselect=g_multiselect,m.g_ctrl_select=g_ctrl_select,m.g_carpark_item_flag=g_carpark_item_flag;var[S,v,O,x,D,b]=get_new_orientation_dim(m.Orientation,m.OW,m.OH,m.OD),j=g_orientation_json[m.Orientation];m.item_width=S,m.item_height=v,m.item_depth=O,m.actualHeight=x,m.actualWidth=D,m.actualDepth=b,m.Orientdetails=j,m.Shelf=g_pog_json[n].ModuleInfo[o].ShelfInfo[_].Shelf,m.ObjType=g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ObjType,m.BsktFill=g_pog_json[n].ModuleInfo[o].ShelfInfo[_].BsktFill,m.Combine=g_pog_json[n].ModuleInfo[o].ShelfInfo[_].Combine,"N"==g_carpark_item_flag&&(m.UnitperCase=g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[g_item_index].UnitperCase,m.UnitperTray=g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[g_item_index].UnitperTray,m.CapDepthChanged=g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[g_item_index].CapDepthChanged),m.g_overhung_shelf_active=g_overhung_shelf_active,m.g_auto_cal_depth_fac=g_auto_cal_depth_fac,sessionStorage.setItem("items_details",JSON.stringify(m)),openCustomDialog("OPEN_",$v("P193_PRODUCT_DETAILS_URL"),"P193_PRODUCT_DETAILS_TRIGGER"),logDebug("function : item region image loading","E")}else"I"==e&&"DIVIDER"==a?($s("P193_OBJECT_TYPE","DIVIDER"),$s("P193_DIVIDER_NAME",g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[g_item_index].Desc),$s("P193_DIV_HEIGHT",(100*g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[g_item_index].H).toFixed(2)),$s("P193_DIV_WIDTH",(100*g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[g_item_index].W).toFixed(2)),$s("P193_DIV_DEPTH",(100*g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[g_item_index].D).toFixed(2)),$s("P193_DIV_ROTATION",g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[g_item_index].Rotation),$s("P193_DIV_COLOR",g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[g_item_index].Color),$s("P193_DIVIDER_FIXED",g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[g_item_index].Fixed),$s("P193_SLOT_DIVIDER",g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[g_item_index].SlotDivider),$s("P193_SLOT_ORIENTATION",g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[g_item_index].Orientation),"N"==t?($s("P193_DIVIDER_ID",g_pog_json[n].ModuleInfo[o].ShelfInfo[_].ItemInfo[g_item_index].ItemID),$s("P193_ITEM_EDIT_IND","Y"),$("#DELETE_DIVIDER").css("display","inline")):($s("P193_DIVIDER_ID",g_pog_json[n].ModuleInfo[g_module_index].Module+(g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo.length+1)),$s("P193_ITEM_EDIT_IND","N")),apex.item("P193_DIVIDER_NAME").setFocus(),openInlineDialog("add_divider",75,85)):"B"==e&&(open_pog_modal("edit_pog",n,g),$s("P193_MODULE_DISP",""));logDebug("function : open_edit_modal_popup","E")}async function onload_create_pog(){logDebug("function : onload_create_pog; ","S"),sessionStorage.setItem("P193_EXISTING_DRAFT_VER",sessionStorage.getItem("P193_EXISTING_DRAFT_VER")),sessionStorage.setItem("P193_DRAFT_LIST",sessionStorage.getItem("P193_DRAFT_LIST")),sessionStorage.setItem("P193_POG_DESCRIPTION",sessionStorage.getItem("P193_POG_DESCRIPTION"));var e=LZString.decompress(sessionStorage.getItem("POGJSON"));if(g_ItemImages=null!==sessionStorage.getItem("g_ItemImages")?JSON.parse(sessionStorage.getItem("g_ItemImages")):[],g_scene_objects_backup=null!==sessionStorage.getItem("scene_objects_backup")?JSON.parse(LZString.decompress(sessionStorage.getItem("scene_objects_backup"))):[],g_pogjson_backup=null!==sessionStorage.getItem("pogjson_backup")?JSON.parse(LZString.decompress(sessionStorage.getItem("pogjson_backup"))):[],generateCanvasListHolder(g_pogjson_backup),""!==e&&null!==e)try{g_pog_json=JSON.parse(e)}catch(e){console.log(e)}sessionStorage.removeItem("POGJSON"),sessionStorage.removeItem("g_ItemImages"),apex.server.process("GET_JSON_FROM_COLL",{pageItems:["P1_ID_COLUMN"]},{dataType:"html",loadingIndicatorPosition:"page"}).done((function(e){if(""!==$.trim(e)||"undefined"!=typeof g_pog_json&&g_pog_json.length>0){g_show_fixel_label=sessionStorage.getItem("g_show_fixel_label"),g_show_item_label=""==sessionStorage.getItem("g_show_item_label")||null==sessionStorage.getItem("g_show_item_label")?"Y":sessionStorage.getItem("g_show_item_label"),g_show_notch_label=sessionStorage.getItem("g_show_notch_label"),g_show_live_image=sessionStorage.getItem("g_show_live_image"),g_show_max_merch=sessionStorage.getItem("g_show_max_merch"),g_show_item_desc=""==sessionStorage.getItem("g_show_item_desc")||null==sessionStorage.getItem("g_show_item_desc")?"N":sessionStorage.getItem("g_show_item_desc"),g_show_fixel_space=""==sessionStorage.getItem("g_show_fixel_space")||null==sessionStorage.getItem("g_show_fixel_space")?"N":sessionStorage.getItem("g_show_fixel_space"),g_max_facing_enabled=sessionStorage.getItem("g_max_facing_enabled"),g_show_item_color=""==sessionStorage.getItem("g_show_item_color")||null==sessionStorage.getItem("g_show_item_color")?"N":sessionStorage.getItem("g_show_item_color"),g_show_days_of_supply=sessionStorage.getItem("g_show_days_of_supply"),g_ComViewIndex=parseInt(sessionStorage.getItem("g_ComViewIndex")),g_ComBaseIndex=parseInt(sessionStorage.getItem("g_ComBaseIndex")),g_compare_view=sessionStorage.getItem("g_compare_view"),g_compare_pog_flag=sessionStorage.getItem("g_compare_pog_flag"),g_pog_index=null!==sessionStorage.getItem("g_pog_index")?parseInt(sessionStorage.getItem("g_pog_index")):0,g_edit_pallet_mod_ind=null!==sessionStorage.getItem("g_edit_pallet_mod_ind")?parseInt(sessionStorage.getItem("g_edit_pallet_mod_ind")):-1,g_edit_pallet_shelf_ind=null!==sessionStorage.getItem("g_edit_pallet_shelf_ind")?parseInt(sessionStorage.getItem("g_edit_pallet_shelf_ind")):-1,g_overhung_shelf_active=null!==sessionStorage.getItem("g_overhung_shelf_active")?sessionStorage.getItem("g_overhung_shelf_active"):"N",g_itemSubLabelInd=null!==sessionStorage.getItem("g_itemSubLabelInd")?sessionStorage.getItem("g_itemSubLabelInd"):"N",g_itemSubLabel=null!==sessionStorage.getItem("g_itemSubLabel")?sessionStorage.getItem("g_itemSubLabel"):"",g_combinedShelfs=null!==sessionStorage.getItem("g_combinedShelfs")?JSON.parse(sessionStorage.getItem("g_combinedShelfs")):[],sessionGetCombineDetails(),"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&(g_json=g_pog_json),g_pog_json_data=JSON.parse(JSON.stringify(g_json)),g_module_obj_array=[],$(".live_image").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".open_pdf").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),async function(){if(""==$v("P193_ERROR_FLAG")){pog_edited_ind="Y",apex.navigation.redirect("f?p="+$v("pFlowId")+":"+$v("pFlowStepId")+":"+$v("pInstance")+":APPLICATION_PROCESS=DOWNLOAD_ERROR_TMPL"),g_ComViewIndex>-1&&"Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&g_pog_json_data.splice(g_ComViewIndex,1),g_pog_json=[],addLoadingIndicator();await create_all_pog_onload(g_pog_json_data);removeLoadingIndicator(regionloadWait),g_ComViewIndex>-1&&"Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&await edit_pallet("Y",g_edit_pallet_mod_ind,g_edit_pallet_shelf_ind,g_ComBaseIndex,"Y"),g_pog_json_data=[],removeParam(""),$s("P193_ERROR_FLAG","")}else if(""!==$v("P193_UPLD_ID")){removeParam(""),apex.server.process("GET_ITEM_JSON",{pageItems:["P1_ID_COLUMN"]},{dataType:"html"}).done((function(e){if(""!==$.trim(e))try{async function o(){appendMultiCanvasRowCol(g_pog_json.length,$v("P193_POGCR_TILE_VIEW")),g_multi_pog_json=[],g_canvas_objects=[];for(var e=0;e<=g_pog_json.length-1;e++){init(e),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects),set_indicator_objects(e);var o=g_canvas_objects[e].getAttribute("id");$("#"+o+"-btns").append('<span id="block_title" style="float:left">'+g_pog_json[e].POGCode+"</span>"),void 0!==g_scene_objects[e].Indicators&&(g_show_fixel_label=g_scene_objects[e].Indicators.FixelLabel,g_show_item_label=g_scene_objects[e].Indicators.ItemLabel,g_show_notch_label=g_scene_objects[e].Indicators.NotchLabel,g_show_max_merch=g_scene_objects[e].Indicators.MaxMerch,g_show_item_color=g_scene_objects[e].Indicators.ItemColor,g_show_item_desc=g_scene_objects[e].Indicators.ItemDesc,g_show_live_image=g_scene_objects[e].Indicators.LiveImage,g_show_days_of_supply=g_scene_objects[e].Indicators.DaysOfSupply,g_overhung_shelf_active=g_scene_objects[e].Indicators.OverhungShelf,g_itemSubLabelInd=g_scene_objects[e].Indicators.ItemSubLabelInd,g_itemSubLabel=g_scene_objects[e].Indicators.ItemSubLabel),g_all_pog_flag="N"}ItemJSON.length>0&&("FAIL"==await item_upld_create(ItemJSON,g_pog_index)&&apex.navigation.redirect("f?p="+$v("pFlowId")+":"+$v("pFlowStepId")+":"+$v("pInstance")+":APPLICATION_PROCESS=DOWNLOAD_ERROR_TMPL"));pog_edited_ind="Y",g_ComViewIndex>-1&&"Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&g_pog_json.splice(g_ComViewIndex,1);await save_pog_to_json(g_pog_json);var _=JSON.parse(JSON.stringify(g_pog_json));_.length>1&&($("#pog_list_btn").css("display","block"),$("#chng_view_btn").css("display","block"),$(".add_pog").css("display","block"),$(".open_par").css("display","block")),g_pog_json=[];for(e=0;e<=_.length-1;e++){void 0!==g_scene_objects[e].Indicators&&(g_show_fixel_label=g_scene_objects[e].Indicators.FixelLabel,g_show_item_label=g_scene_objects[e].Indicators.ItemLabel,g_show_notch_label=g_scene_objects[e].Indicators.NotchLabel,g_show_max_merch=g_scene_objects[e].Indicators.MaxMerch,g_show_item_color=g_scene_objects[e].Indicators.ItemColor,g_show_item_desc=g_scene_objects[e].Indicators.ItemDesc,g_show_live_image=g_scene_objects[e].Indicators.LiveImage,g_show_days_of_supply=g_scene_objects[e].Indicators.DaysOfSupply,g_overhung_shelf_active=g_scene_objects[e].Indicators.OverhungShelf,g_itemSubLabelInd=g_scene_objects[e].Indicators.ItemSubLabelInd,g_itemSubLabel=g_scene_objects[e].Indicators.ItemSubLabel),g_pog_index=e,g_world=g_scene_objects[e].scene.children[2],g_camera=g_scene_objects[e].scene.children[0],g_scene=g_scene_objects[e].scene,set_indicator_objects(e);await create_module_from_json(_,"T","F",$v("P193_PRODUCT_BTN_CLICK"),"N","N","N","Y","Y","","N",g_scene_objects[e].scene.children[0],g_scene_objects[e].scene,g_pog_index,e);render(e)}await render_all_pog();g_pog_json=g_multi_pog_json;for(e=0;e<=g_pog_json.length-1;e++)if(e>0)await enableDisableFlags(e);g_ComViewIndex>-1&&"Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&await edit_pallet("Y",g_edit_pallet_mod_ind,g_edit_pallet_shelf_ind,g_ComBaseIndex,"Y"),$(".open_product").css("display","block"),$s("P193_UPLD_ID","")}ItemJSON=JSON.parse($.trim(e)),g_pog_index=null!==sessionStorage.getItem("export_index")?parseInt(sessionStorage.getItem("export_index")):0,o(),apex.message.showPageSuccess(get_message("SUCCESS_MSG"))}catch{raise_error($.trim(e))}else{raise_error(get_message("POGCR_NO_ITEM_ERR"));var _=[];if(void 0!==g_pog_json[g_pog_index]&&g_pog_json.length>0?(_=g_pog_json,"N"):_=g_pog_json_data,g_pog_json=[],void 0!==_[g_pog_index]&&_.length>0){async function o(){g_ComViewIndex>-1&&"Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&_.splice(g_ComViewIndex,1),addLoadingIndicator();await create_all_pog_onload(_);removeLoadingIndicator(regionloadWait),g_ComViewIndex>-1&&"Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&await edit_pallet("Y",g_edit_pallet_mod_ind,g_edit_pallet_shelf_ind,g_ComBaseIndex,"Y")}o()}g_pog_json_data=[]}null!==apex.region("draggable_table")&&apex.region("draggable_table").refresh()}))}else if("Y"==sessionStorage.getItem("POGExists")&&"N"==$v("P193_NEW_SESSION")){void 0!==g_pog_json[g_pog_index]&&g_pog_json.length>0?(POG_JSON=JSON.parse(JSON.stringify(g_pog_json)),create_json="N"):POG_JSON=JSON.parse(JSON.stringify(g_pog_json_data)),g_ComViewIndex>-1&&"Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&(POG_JSON.splice(g_ComViewIndex,1),g_pog_json.splice(g_ComViewIndex,1)),g_pog_json=[],addLoadingIndicator();await create_all_pog_onload(POG_JSON);removeLoadingIndicator(regionloadWait),g_ComViewIndex>-1&&"Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&await edit_pallet("Y",g_edit_pallet_mod_ind,g_edit_pallet_shelf_ind,g_ComBaseIndex,"Y"),g_pog_json.length>1&&animate_all_pog()}generateMultiPogDropdown(),"Y"==g_show_live_image&&animate_all_pog()}(),g_dblclick_opened="N"}else"Y"==$v("P193_OPEN_NEW_TAB")&&raise_error($v("P193_NEW_TAB_POG_CODE")+" - POG Details Not Found");logDebug("function : onload_create_pog; ","E")}))}function remove_param_on_load(){try{logDebug("function : remove_param_on_load ; ","S"),"Y"==$v("P193_NEW_SESSION")&&(g_pog_json=[],$s("P193_NEW_SESSION","N"),sessionStorage.removeItem("POGJSON"),sessionStorage.removeItem("P193_EXISTING_DRAFT_VER"),sessionStorage.removeItem("P193_DRAFT_LIST"),sessionStorage.removeItem("P193_POG_DESCRIPTION")),sessionStorage.setItem("POGExists","N"),removeParam("P193_NEW_SESSION"),logDebug("function : remove_param_on_load ; ","E")}catch(e){error_handling(e)}}function sessionGetCombineDetails(){try{if(logDebug("function : sessionGetCombineDetails","S"),g_combinedShelfs.length>0){g_combinedShelfs.keySort({MIndex:"asc",X:"asc"});var e=JSON.parse(sessionStorage.getItem("combinedShlfDets"));for(cd of e){g_combinedShelfs[cd.Index].Start=cd.Start,g_combinedShelfs[cd.Index].End=cd.End,g_combinedShelfs[cd.Index].SpreadItem=cd.SpreadItem,g_combinedShelfs[cd.Index].AllowAutoCrush=cd.AllowAutoCrush;var o=[];for(obj of cd.ItemInfo)o.push(g_pog_json[obj.PIndex].ModuleInfo[obj.MIndex].ShelfInfo[obj.SIndex].ItemInfo[obj.IIndex]);g_combinedShelfs[cd.Index].ItemInfo=o}}}catch(e){logDebug("function : sessionGetCombineDetails","E"),error_handling(e)}}function sessionSetCombineDetails(){try{logDebug("function : sessionSetCombineDetails","S");var e=[];if(g_combinedShelfs.length>0){g_combinedShelfs.keySort({MIndex:"asc",X:"asc"});var o=0;for(combines of g_combinedShelfs){var _={};_.Index=o,_.Start=combines.Start,_.End=combines.End,_.SpreadItem=combines.SpreadItem,_.AllowAutoCrush=combines.AllowAutoCrush;var t={},n=[];for(obj of combines.ItemInfo)t.ObjID=obj.ObjID,t.PIndex=void 0!==obj.PIndex&&""!==obj.PIndex?obj.PIndex:combines[0].PIndex,t.MIndex=obj.MIndex,t.SIndex=obj.SIndex,t.IIndex=obj.IIndex,n.push(t);_.ItemInfo=n,e.push(_),o++}}sessionStorage.setItem("combinedShlfDets",JSON.stringify(e))}catch(e){logDebug("function : sessionSetCombineDetails","E"),error_handling(e)}}function clear_auto_fill_coll(){g_auto_fill_active="N",g_auto_fill_reg_open="N",g_autofill_edit="N",apex.server.process("DELETE_AUTOFILL_COLL",{x01:""},{dataType:"text",success:async function(e){for(const e of g_mod_block_list)for(const o of e.BlockDim.ColorObj.children)if(o.uuid==e.BlkName){e.BlockDim.ColorObj.remove(o);break}render(g_pog_index),null!==apex.region("mod_block_details")&&apex.region("mod_block_details").refresh(),console.log("pData",e),$s("P193_MULTI_PRODUCT",""),$(".dropdown").removeClass("disable_dropdown"),$(".live_image").removeClass("disable_dropdown"),$(".3d_popup").removeClass("disable_dropdown"),$(".open_product").removeClass("disable_dropdown"),$(".left_icon").removeClass("disable_dropdown"),$(".autofill_btn").removeClass("item_label_active")},loadingIndicatorPosition:"page"})}function getAutoFillCurrModule(e,o,_,t){logDebug("function : getAutoFillCurrModule; pfinalX : "+e+"; pFinalY : "+o+"; p_module_index : "+_,"S");try{var n=-1,g=0;g=0;for(modules of g_pog_json[t].ModuleInfo){if(parseFloat(e)>parseFloat(modules.X)-modules.W/2&&parseFloat(e)<parseFloat(modules.X)+modules.W/2&&parseFloat(o)>parseFloat(modules.Y)-modules.H/2&&parseFloat(o)<parseFloat(modules.Y)+modules.H/2&&(null==modules.ParentModule||void 0===modules.ParentModule)){n=g;break}g++}return logDebug("function : getAutoFillCurrModule","E"),n}catch(e){error_handling(e)}}function getAutoFillCurrShelf(e,o,_,t){logDebug("function : getAutoFillCurrShelf; pBlockStart : "+e+"; pBlockEnd : "+o+"; p_module_index : "+_,"S");try{var n=-1,g=0;for(shelfs of g_pog_json[t].ModuleInfo[_].ShelfInfo){if(parseFloat(e.y)>parseFloat(shelfs.Y)-shelfs.H/2&&parseFloat(o.y)<parseFloat(shelfs.Y)+shelfs.H/2){n=g;break}g++}return logDebug("function : getAutoFillCurrShelf","E"),n}catch(e){error_handling(e)}}async function swapColoredBlocks(e,o,_){logDebug("function : swapColoredBlocks; pSwapBlock : "+e,"S");var t=o.BlockDim.ColorObj,n=parseFloat(o.BlockDim.CalcX),g=parseFloat(o.BlockDim.CalcY),a=parseFloat(o.BlockDim.FinalTop),i=parseFloat(o.BlockDim.FinalBtm),r=parseFloat(o.BlockDim.BlkWidth),s=parseFloat(o.BlockDim.BlkHeight),l=JSON.parse(JSON.stringify(o.g_delete_details)),d=JSON.parse(JSON.stringify(o.mod_index)),f=t.getObjectByProperty("uuid",g_dragItem.uuid),c=e.BlockDim.ColorObj,I=parseFloat(e.BlockDim.CalcX),p=parseFloat(e.BlockDim.CalcY),m=parseFloat(e.BlockDim.FinalTop),u=parseFloat(e.BlockDim.FinalBtm),h=parseFloat(e.BlockDim.BlkWidth),S=parseFloat(e.BlockDim.BlkHeight),v=JSON.parse(JSON.stringify(e.g_delete_details)),O=JSON.parse(JSON.stringify(e.mod_index)),x=c.getObjectByProperty("uuid",e.BlkName);for(g_shelf of(e.BlockDim.CalcX=n,e.BlockDim.CalcY=g,e.BlockDim.FinalTop=a,e.BlockDim.FinalBtm=i,e.BlockDim.BlkWidth=r,e.BlockDim.BlkHeight=s,e.mod_index=d,e.g_delete_details=l,e.g_delete_details))g_shelf.BlkName=e.BlkName;for(g_shelf of(x.position.x=n,x.position.y=g,x.geometry.dispose(),x.geometry=new THREE.BoxGeometry(r,s,.001),o.BlockDim.CalcX=I,o.BlockDim.CalcY=p,o.BlockDim.FinalTop=m,o.BlockDim.FinalBtm=u,o.BlockDim.BlkWidth=h,o.BlockDim.BlkHeight=S,o.mod_index=O,o.g_delete_details=v,o.g_delete_details))g_shelf.BlkName=o.BlkName;f.position.x=I,f.position.y=p,f.geometry.dispose(),f.geometry=new THREE.BoxGeometry(h,S,.001),c.remove(x),t.remove(f),c.add(f),t.add(x),o.BlockDim.ColorObj=c,e.BlockDim.ColorObj=t,t.updateMatrix(),c.updateMatrix(),f.updateMatrix(),x.updateMatrix(),render(_),logDebug("function : swapColoredBlocks","E")}async function get_multiselect_obj(e){logDebug("function : get_multiselect_obj","S");try{g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[];var o="CARPARK_ITEM";if(g_dup_mod_list=await find_select_module(e),"undefined"!=typeof g_pog_json&&g_pog_json.length>0){var _=g_pog_json[e].ModuleInfo,t=0;for(const O of _){if(null==O.ParentModule||"undefined"==O.ParentModule){var n=0;for(const o of O.ShelfInfo){if(void 0!==o&&"NOTCH"!==o.ObjType&&"BASE"!==o.ObjType&&"DIVIDER"!==o.ObjType){if(0!==o.Rotation||0!==o.Slope)var g=o.X-o.ShelfRotateWidth/2,a=o.X+o.ShelfRotateWidth/2,i=o.Y-o.ShelfRotateHeight/2,r=o.Y+o.ShelfRotateHeight/2;else g=o.X-o.W/2,a=o.X+o.W/2,i=o.Y-o.H/2,r=o.Y+o.H/2;if(g_DragMouseStart.x<=g_DragMouseEnd.x&&g_DragMouseStart.y>=g_DragMouseEnd.y){if(g>=g_DragMouseStart.x&&a>=g_DragMouseStart.x&&i<=g_DragMouseStart.y&&r<=g_DragMouseStart.y&&g<=g_DragMouseEnd.x&&a<=g_DragMouseEnd.x&&i>=g_DragMouseEnd.y&&r>=g_DragMouseEnd.y){var s=setDetailsArray(o.SObjID,t,n,o.W,o.H,o.X,o.Y,o.Z,-1,o.ObjType,"N","SHELF",O.MObjID,-1,"","","N",o.Rotation,o.Slope,0,"","",g_start_canvas,g_present_canvas,e);g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(s)}}else if(g_DragMouseStart.x>=g_DragMouseEnd.x&&g_DragMouseStart.y>=g_DragMouseEnd.y){if(g>=g_DragMouseEnd.x&&a>=g_DragMouseEnd.x&&i>=g_DragMouseEnd.y&&r>=g_DragMouseEnd.y&&g<=g_DragMouseStart.x&&a<=g_DragMouseStart.x&&i<=g_DragMouseStart.y&&r<=g_DragMouseStart.y){s=setDetailsArray(o.SObjID,t,n,o.W,o.H,o.X,o.Y,o.Z,-1,o.ObjType,"N","SHELF",O.MObjID,-1,"","","N",o.Rotation,o.Slope,0,"","",g_start_canvas,g_present_canvas,e);g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(s)}}else if(g_DragMouseStart.x<=g_DragMouseEnd.x&&g_DragMouseStart.y<=g_DragMouseEnd.y){if(g>=g_DragMouseStart.x&&a>=g_DragMouseStart.x&&i>=g_DragMouseStart.y&&r>=g_DragMouseStart.y&&g<=g_DragMouseEnd.x&&a<=g_DragMouseEnd.x&&i<=g_DragMouseEnd.y&&r<=g_DragMouseEnd.y){s=setDetailsArray(o.SObjID,t,n,o.W,o.H,o.X,o.Y,o.Z,-1,o.ObjType,"N","SHELF",O.MObjID,-1,"","","N",o.Rotation,o.Slope,0,"","",g_start_canvas,g_present_canvas,e);g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(s)}}else if(g_DragMouseStart.x>=g_DragMouseEnd.x&&g_DragMouseStart.y<=g_DragMouseEnd.y&&g<=g_DragMouseStart.x&&a<=g_DragMouseStart.x&&i>=g_DragMouseStart.y&&r>=g_DragMouseStart.y&&g>=g_DragMouseEnd.x&&a>=g_DragMouseEnd.x&&i<=g_DragMouseEnd.y&&r<=g_DragMouseEnd.y){s=setDetailsArray(o.SObjID,t,n,o.W,o.H,o.X,o.Y,o.Z,-1,o.ObjType,"N","SHELF",O.MObjID,-1,"","","N",o.Rotation,o.Slope,0,"","",g_start_canvas,g_present_canvas,e);g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(s)}var l=0,d=o.ItemInfo,f={X:"asc"};d.keySort(f);for(const _ of d){var c=_.X-_.W/2,I=_.X+_.W/2,p=_.Y-_.H/2,m=_.Y+_.H/2;if(g_DragMouseStart.x<=g_DragMouseEnd.x&&g_DragMouseStart.y>=g_DragMouseEnd.y){if(c>=g_DragMouseStart.x&&I>=g_DragMouseStart.x&&p<=g_DragMouseStart.y&&m<=g_DragMouseStart.y&&c<=g_DragMouseEnd.x&&I<=g_DragMouseEnd.x&&p>=g_DragMouseEnd.y&&m>=g_DragMouseEnd.y){var u="N",h="ITEM";if("DIVIDER"==_.Item&&(u="Y",h="SHELF"),(s=setDetailsArray(_.ObjID,t,n,_.W,_.H,_.X,_.Y,_.Z,l,o.ObjType,u,h,O.MObjID,o.SObjID,_.ItemID,_.Item,"N",0,0,_.Distance,_.TopObjID,_.BottomObjID,g_start_canvas,g_present_canvas,e)).W=_.W,s.RW=_.RW,s.H=_.H,s.X=_.X,s.Y=_.Y,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(s),void 0!==n&&void 0!==t&&g_delete_details.length>0){var S=g_pog_json[e].ModuleInfo[t].ShelfInfo[n];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(S)}}}else if(g_DragMouseStart.x>=g_DragMouseEnd.x&&g_DragMouseStart.y>=g_DragMouseEnd.y){if(c>=g_DragMouseEnd.x&&I>=g_DragMouseEnd.x&&p>=g_DragMouseEnd.y&&m>=g_DragMouseEnd.y&&c<=g_DragMouseStart.x&&I<=g_DragMouseStart.x&&p<=g_DragMouseStart.y&&m<=g_DragMouseStart.y){u="N",h="ITEM";if("DIVIDER"==_.Item&&(u="Y",h="SHELF"),(s=setDetailsArray(_.ObjID,t,n,_.W,_.H,_.X,_.Y,_.Z,l,o.ObjType,u,h,O.MObjID,o.SObjID,_.ItemID,_.Item,"N",0,0,_.Distance,_.TopObjID,_.BottomObjID,g_start_canvas,g_present_canvas,e)).W=_.W,s.RW=_.RW,s.H=_.H,s.X=_.X,s.Y=_.Y,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(s),void 0!==n&&void 0!==t&&g_delete_details.length>0){S=g_pog_json[e].ModuleInfo[t].ShelfInfo[n];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(S)}}}else if(g_DragMouseStart.x<=g_DragMouseEnd.x&&g_DragMouseStart.y<=g_DragMouseEnd.y){if(c>=g_DragMouseStart.x&&I>=g_DragMouseStart.x&&p>=g_DragMouseStart.y&&m>=g_DragMouseStart.y&&c<=g_DragMouseEnd.x&&I<=g_DragMouseEnd.x&&p<=g_DragMouseEnd.y&&m<=g_DragMouseEnd.y){u="N",h="ITEM";if("DIVIDER"==_.Item&&(u="Y",h="SHELF"),(s=setDetailsArray(_.ObjID,t,n,_.W,_.H,_.X,_.Y,_.Z,l,o.ObjType,u,h,O.MObjID,o.SObjID,_.ItemID,_.Item,"N",0,0,_.Distance,_.TopObjID,_.BottomObjID,g_start_canvas,g_present_canvas,e)).W=_.W,s.RW=_.RW,s.H=_.H,s.X=_.X,s.Y=_.Y,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(s),void 0!==n&&void 0!==t&&g_delete_details.length>0){S=g_pog_json[e].ModuleInfo[t].ShelfInfo[n];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(S)}}}else if(g_DragMouseStart.x>=g_DragMouseEnd.x&&g_DragMouseStart.y<=g_DragMouseEnd.y&&c<=g_DragMouseStart.x&&I<=g_DragMouseStart.x&&p>=g_DragMouseStart.y&&m>=g_DragMouseStart.y&&c>=g_DragMouseEnd.x&&I>=g_DragMouseEnd.x&&p<=g_DragMouseEnd.y&&m<=g_DragMouseEnd.y){u="N",h="ITEM";if("DIVIDER"==_.Item&&(u="Y",h="SHELF"),(s=setDetailsArray(_.ObjID,t,n,_.W,_.H,_.X,_.Y,_.Z,l,o.ObjType,u,h,O.MObjID,o.SObjID,_.ItemID,_.Item,"N",0,0,_.Distance,_.TopObjID,_.BottomObjID,g_start_canvas,g_present_canvas,e)).W=_.W,s.RW=_.RW,s.H=_.H,s.X=_.X,s.Y=_.Y,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(s),void 0!==n&&void 0!==t&&g_delete_details.length>0){S=g_pog_json[e].ModuleInfo[t].ShelfInfo[n];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(S)}}l++}}n++}var v=O.Carpark;if(void 0!==v&&v.length>0){l=0,d=O.Carpark[0].ItemInfo,f={X:"asc"};d.keySort(f);u="N";for(const _ of d){c=_.X-_.W/2,I=_.X+_.W/2,p=_.Y-_.H/2,m=_.Y+_.H/2;if(g_DragMouseStart.x<=g_DragMouseEnd.x&&g_DragMouseStart.y>=g_DragMouseEnd.y){if(c>=g_DragMouseStart.x&&I>=g_DragMouseStart.x&&p<=g_DragMouseStart.y&&m<=g_DragMouseStart.y&&c<=g_DragMouseEnd.x&&I<=g_DragMouseEnd.x&&p>=g_DragMouseEnd.y&&m>=g_DragMouseEnd.y)(s=setDetailsArray(_.ObjID,t,0,_.W,_.H,_.X,_.Y,_.Z,l,v.ObjType,u,o,O.MObjID,v.SObjID,_.ItemID,_.Item,"N",0,0,_.Distance,_.TopObjID,_.BottomObjID,g_start_canvas,g_present_canvas,e)).W=_.W,s.RW=_.RW,s.H=_.H,s.X=_.X,s.Y=_.Y,s.IsCarpark="Y",g_delete_details.multi_delete_shelf_ind="",g_delete_details.multi_carpark_ind="Y",g_delete_details.push(s)}else if(g_DragMouseStart.x>=g_DragMouseEnd.x&&g_DragMouseStart.y>=g_DragMouseEnd.y){if(c>=g_DragMouseEnd.x&&I>=g_DragMouseEnd.x&&p>=g_DragMouseEnd.y&&m>=g_DragMouseEnd.y&&c<=g_DragMouseStart.x&&I<=g_DragMouseStart.x&&p<=g_DragMouseStart.y&&m<=g_DragMouseStart.y)(s=setDetailsArray(_.ObjID,t,0,_.W,_.H,_.X,_.Y,_.Z,l,v.ObjType,u,o,O.MObjID,v.SObjID,_.ItemID,_.Item,"N",0,0,_.Distance,_.TopObjID,_.BottomObjID,g_start_canvas,g_present_canvas,e)).W=_.W,s.RW=_.RW,s.H=_.H,s.X=_.X,s.Y=_.Y,s.IsCarpark="Y",g_delete_details.multi_delete_shelf_ind="",g_delete_details.multi_carpark_ind="Y",g_delete_details.push(s)}else if(g_DragMouseStart.x<=g_DragMouseEnd.x&&g_DragMouseStart.y<=g_DragMouseEnd.y){if(c>=g_DragMouseStart.x&&I>=g_DragMouseStart.x&&p>=g_DragMouseStart.y&&m>=g_DragMouseStart.y&&c<=g_DragMouseEnd.x&&I<=g_DragMouseEnd.x&&p<=g_DragMouseEnd.y&&m<=g_DragMouseEnd.y)(s=setDetailsArray(_.ObjID,t,0,_.W,_.H,_.X,_.Y,_.Z,l,v.ObjType,u,o,O.MObjID,v.SObjID,_.ItemID,_.Item,"N",0,0,_.Distance,_.TopObjID,_.BottomObjID,g_start_canvas,g_present_canvas,e)).W=_.W,s.RW=_.RW,s.H=_.H,s.X=_.X,s.Y=_.Y,s.IsCarpark="Y",g_delete_details.multi_delete_shelf_ind="",g_delete_details.multi_carpark_ind="Y",g_delete_details.push(s)}else if(g_DragMouseStart.x>=g_DragMouseEnd.x&&g_DragMouseStart.y<=g_DragMouseEnd.y){if(c<=g_DragMouseStart.x&&I<=g_DragMouseStart.x&&p>=g_DragMouseStart.y&&m>=g_DragMouseStart.y&&c>=g_DragMouseEnd.x&&I>=g_DragMouseEnd.x&&p<=g_DragMouseEnd.y&&m<=g_DragMouseEnd.y)(s=setDetailsArray(_.ObjID,t,0,_.W,_.H,_.X,_.Y,_.Z,l,v.ObjType,u,o,O.MObjID,v.SObjID,_.ItemID,_.Item,"N",0,0,_.Distance,_.TopObjID,_.BottomObjID,g_start_canvas,g_present_canvas,e)).W=_.W,s.RW=_.RW,s.H=_.H,s.X=_.X,s.Y=_.Y,s.IsCarpark="Y",g_delete_details.multi_delete_shelf_ind="",g_delete_details.multi_carpark_ind="Y",g_delete_details.push(s)}l++}}}t++}g_delete_details.StartCanvas=g_start_canvas,g_delete_details.g_present_canvas=g_present_canvas}"Y"==g_delete_details.multi_carpark_ind&&g_delete_details.some((e=>e.Object!==o))&&confirm(get_message("CARPARK_MULTI_SEL_CONF"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){for(var _=g_delete_details.length-1;_>=0;--_)g_delete_details[_].Object!==o&&g_delete_details.splice(_,1);set_multi_blink(g_pog_json,e)}),(function(){g_delete_details=[],set_multi_blink(g_pog_json,e)})),logDebug("function : get_multiselect_obj","E")}catch(e){error_handling(e)}}function setDetailsArray(e,o,_,t,n,g,a,i,r,s,l,d,f,c,I,p,m,u,h,S,v,O,x,D,b){var j={};return j.ObjID=e,j.MIndex=o,j.SIndex=_,j.ObjWidth=t,j.ObjHeight=n,j.XAxis=g,j.YAxis=a,j.ZAxis=i,j.IIndex=r,j.ObjType=s,j.IsDivider=l,j.Object=d,j.MObjID=f,j.SObjID=c,j.ItemID=I,j.Item=p,j.Exists=m,j.Rotation=u,j.Slope=h,j.Distance=S,j.TopObjID=v,j.BottomObjID=O,j.StartCanvas=x,j.g_present_canvas=D,j.p_pog_index=b,"SHELF"==d&&(j.AllowAutoCrush=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].AllowAutoCrush,j.Rotation=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].Rotation,j.Slope=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].Slope,j.Color=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].Color,j.Combine=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].Combine,j.LOverhang=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].LOverhang,j.ROverhang=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].ROverhang,j.DivHeight=void 0===g_pog_json[b].ModuleInfo[o].ShelfInfo[_].DivHeight?0:g_pog_json[b].ModuleInfo[o].ShelfInfo[_].DivHeight,j.DivWidth=void 0===g_pog_json[b].ModuleInfo[o].ShelfInfo[_].DivWidth?0:g_pog_json[b].ModuleInfo[o].ShelfInfo[_].DivWidth,j.DivPst=void 0===g_pog_json[b].ModuleInfo[o].ShelfInfo[_].DivPst?"N":g_pog_json[b].ModuleInfo[o].ShelfInfo[_].DivPst,j.DivPed=void 0===g_pog_json[b].ModuleInfo[o].ShelfInfo[_].DivPed?"N":g_pog_json[b].ModuleInfo[o].ShelfInfo[_].DivPed,j.DivPbtwFace=void 0===g_pog_json[b].ModuleInfo[o].ShelfInfo[_].DivPbtwFace?"N":g_pog_json[b].ModuleInfo[o].ShelfInfo[_].DivPbtwFace,j.NoDivIDShow=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].NoDivIDShow,j.DivFillCol=void 0===g_pog_json[b].ModuleInfo[o].ShelfInfo[_].DivFillCol?"#3D393D":g_pog_json[b].ModuleInfo[o].ShelfInfo[_].DivFillCol,j.SpreadItem=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].SpreadItem,j.W=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].W,j.H=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].H,j.D=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].D,j.MaxMerch=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].MaxMerch),"TEXTBOX"==s&&(j.FBold=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].FBold,j.FSize=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].FSize,j.FStyle=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].FStyle,j.InputText=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].InputText,j.TextImg=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].TextImg,j.TextImgMime=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].TextImgMime,j.TextImgName=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].TextImgName,j.ReduceToFit=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].ReduceToFit,j.WrapText=g_pog_json[b].ModuleInfo[o].ShelfInfo[_].WrapText),j}async function comparePOG(e,o,_,t,n,g="N",a=[]){logDebug("function : comparePOG","S"),await get_compare_pog(e,o,_,t,n,g,a),logDebug("function : comparePOG","E")}function fit_pog_to_canvas_default(e){try{if(null==e||e<0)return;if(!Array.isArray(g_scene_objects)||void 0===g_scene_objects[e])return;var o=get_min_max_xy(e).split("###"),_=g_scene_objects[e].scene.children[0];set_camera_z(_,parseFloat(o[2]),parseFloat(o[3]),parseFloat(o[0]),parseFloat(o[1]),g_offset_z,parseFloat(o[4]),parseFloat(o[5]),!1,e),render(e)}catch(e){error_handling(e)}}async function render_compare_pog_blocks_from_snapshot(e,o){var _=Array.isArray(e)?wpdBuildShowChangesBlockSnapshot(e):[];if(0!==_.length){g_mod_block_list=[];for(const e of _)void 0!==e&&null!=e&&(g_DragMouseStart={x:Number(e.DragMouseStart&&void 0!==e.DragMouseStart.x?e.DragMouseStart.x:0),y:Number(e.DragMouseStart&&void 0!==e.DragMouseStart.y?e.DragMouseStart.y:0)},g_DragMouseEnd={x:Number(e.DragMouseEnd&&void 0!==e.DragMouseEnd.x?e.DragMouseEnd.x:0),y:Number(e.DragMouseEnd&&void 0!==e.DragMouseEnd.y?e.DragMouseEnd.y:0)},Array.isArray(e.BlkModInfo)&&e.BlkModInfo.length>0&&Array.isArray(e.BlkShelfInfo)&&e.BlkShelfInfo.length>0?(g_autofillModInfo=JSON.parse(JSON.stringify(e.BlkModInfo)),g_autofillShelfInfo=JSON.parse(JSON.stringify(e.BlkShelfInfo))):[g_autofillModInfo,g_autofillShelfInfo]=getAutofillModShelf(g_DragMouseStart,g_DragMouseEnd,g_pog_json,o),Array.isArray(g_autofillModInfo)&&0!==g_autofillModInfo.length&&Array.isArray(g_autofillShelfInfo)&&0!==g_autofillShelfInfo.length&&await setAutofillBlock("A",e.BlkName,"N","N",e.BlkColor||"#FFFFFF"))}}async function render_compare_pog_blocks(e,o,_,t=[]){var n=g_pog_index,g=g_mod_block_list,a=g_auto_fill_active,i=g_DragMouseStart,r=g_DragMouseEnd,s=g_autofill_detail;try{g_pog_index=_,g_auto_fill_active="Y",g_mod_block_list=[],g_autofill_detail={};var l=Array.isArray(t)?t:[];l.length>0?await render_compare_pog_blocks_from_snapshot(l,_):(await auto_fill_setup(1),g_mod_block_list&&0!==g_mod_block_list.length?apex.region("mod_block_details").refresh():await createDynamicBlocks(e,"N",o,"N",$v("P193_EXISTING_DRAFT_VER"))),fit_pog_to_canvas_default(_);var d=get_min_max_xy(_).split("###"),f=g_scene_objects[_].scene.children[0];set_camera_z(f,parseFloat(d[2]),parseFloat(d[3]),parseFloat(d[0]),parseFloat(d[1]),g_offset_z,parseFloat(d[4]),parseFloat(d[5]),!1,_),render(_)}catch(e){error_handling(e)}finally{g_pog_index=n,g_auto_fill_active=a,g_mod_block_list=g,g_autofill_detail=s,g_DragMouseStart=i,g_DragMouseEnd=r}}async function get_compare_pog(e,o,_,t,n,g="N",a=[]){logDebug("function : get_compare_pog; compare_ind : "+e+"; pog_code : "+o+"; pog_version : "+_+"; draft_id : "+t+"; prev_version : "+n,"S");try{"Y"==n&&$(".item_color_legends").css("display","none"),addLoadingIndicator();var r,s,l=g_pog_index;"1"==e?(r="N",s="E"):(r="Y",s="N"),apex.server.process("GET_COMPARE_JSON",{x01:e,x02:o,x03:_,x04:t},{dataType:"html"}).done((function(e){var o=$.trim(e);if(o.match(/ERROR.*/))raise_error(o),removeLoadingIndicator(regionloadWait);else if(""!==o){g_json=JSON.parse($.trim(e));JSON.parse(JSON.stringify(g_pog_json));g_pog_json_data=g_json;var _=g_pog_json_data[0].ModuleInfo;i=0;for(const e of _){if(null!=e.ShelfInfo&&void 0!==e.ShelfInfo||(e.ShelfInfo=[]),void 0===e.ParentModule||null==e.ParentModule){null!==e.SubDept&&void 0!==e.SubDept&&(subdept=e.SubDept),j=0;for(const o of e.ShelfInfo)void 0!==o.ItemInfo&&null!=o.ItemInfo||(o.ItemInfo=[]),j+=1}i+=1}$(".live_image").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".open_pdf").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".open_pdf_online").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),async function(){g_pog_json_data[0].PreVersion="";var e,o=g_pog_json_data[0];g_comp_base_code=o.POGCode,o.PreVersion="Y",o.POGCode="Y"!=g?o.POGCode+"-PREV_VERSION":o.POGCode,g_ComBaseIndex=l,g_colorBackup="N",g_comp_view_code=o.POGCode,"Y"==g_compare_pog_flag&&"PREV_VERSION"==g_compare_view?(g_pog_json[g_ComViewIndex]=o,g_ComViewIndex=g_ComViewIndex,init(g_ComViewIndex),(e={}).scene=g_scene,e.renderer=g_renderer,g_scene_objects[g_ComViewIndex]=e):(g_pog_json.push(o),g_ComViewIndex=g_pog_json.length-1,appendMultiCanvasRowCol(g_pog_json.length,$v("P193_POGCR_TILE_VIEW")),init(g_ComViewIndex),(e={}).scene=g_scene,e.renderer=g_renderer,g_scene_objects.push(e));var _=JSON.parse(JSON.stringify(g_pog_json));if(g_json=[g_pog_json[g_ComViewIndex]],g_compare_view="Y"==n?"PREV_VERSION":"POG",g_compare_pog_flag="Y",set_indicator_objects(g_ComViewIndex),modifyWindowAfterMinMax(g_scene_objects),g_pog_index=g_ComViewIndex,g_multi_pog_json=[],g_world=g_scene_objects[g_ComViewIndex].scene.children[2],g_camera=g_scene_objects[g_ComViewIndex].scene.children[0],await create_module_from_json(_,r,"F",$v("P193_PRODUCT_BTN_CLICK"),s,"N","N","Y","Y","","Y",g_scene_objects[g_ComViewIndex].scene.children[0],g_scene_objects[g_ComViewIndex].scene,g_pog_index,g_ComViewIndex),"Y"==g){var t=g_pog_edited_ind;await clear_item("N","N",g_ComViewIndex),g_pog_edited_ind=t}if(removeLoadingIndicator(regionloadWait),render(g_ComViewIndex),"Y"==g&&(await render_compare_pog_blocks(o.POGCode,o.Version,g_ComViewIndex,a),fit_pog_to_canvas_default(g_ComBaseIndex),fit_pog_to_canvas_default(g_ComViewIndex),"undefined"!=typeof window&&"function"==typeof window.requestAnimationFrame&&window.requestAnimationFrame((function(){fit_pog_to_canvas_default(g_ComBaseIndex),fit_pog_to_canvas_default(g_ComViewIndex)}))),"Y"==n){if("Y"==g_show_item_color)await showItemColor("OFF",g_ComViewIndex);await two_pog_diff_checker(g_ComBaseIndex,g_ComViewIndex,g),await calculateFixelAndSupplyDays("N",g_ComViewIndex)}render(g_pog_index),g_pog_index=l,add_pog_code_header()}(),$s("P193_OPEN_DRAFT","Y"),g_auto_position_ind="N",g_dblclick_opened="N"}}))}catch(e){error_handling(e),removeLoadingIndicator(regionloadWait)}}async function modifyWindowAfterMinMax(e){g_scene_objects=[],console.log("modify"),g_canvas_objects=[];for(var o=g_pog_index,_=0;_<e.length;_++){init(_);var t="maincanvas";_>0&&(t="maincanvas"+(_+1)),g_camera=e[_].scene.getObjectByProperty("type","PerspectiveCamera"),g_scene=e[_].scene,g_pog_index=_,console.log("scene",g_scene.uuid);var n=$("#"+t).parent()[0].offsetHeight,g=$("#"+t).parent()[0].offsetWidth,a=$("#"+t+"-btns")[0],i=g,r=n-(void 0!==a?a.offsetHeight:0);$("#"+t).css("height",r+"px !important").css("width",i+"px !important"),$("#"+t).height(r),$("#"+t).width(i),g_camera.aspect=i/r,g_camera.fov=360/Math.PI*Math.atan(g_tanFOV),g_camera.updateProjectionMatrix();var s=get_min_max_xy(_).split("###");set_camera_z(g_camera,parseFloat(s[2]),parseFloat(s[3]),parseFloat(s[0]),parseFloat(s[1]),g_offset_z,parseFloat(s[4]),parseFloat(s[5]),!0,_),objects={},objects.scene=g_scene,objects.renderer=g_renderer,console.log("objects",objects),g_scene_objects.push(objects),set_indicator_objects(_),render(_)}g_pog_index=o}async function createDynamicBlocks(e,o,_,t="",n="Y",g=""){return new Promise(((a,i)=>{apex.server.process("CREATE_DYNAMIC_BLOCK",{x01:e,x02:_,x03:g,x04:"Y"==o?t:""},{dataType:"json",success:async function(e){try{console.log("Blocks:",e);for(const o of e){g_DragMouseStart={x:Number(o.x1),y:Number(o.y1)},g_DragMouseEnd={x:Number(o.x2),y:Number(o.y2)},console.log("Start:",g_DragMouseStart,"End:",g_DragMouseEnd),[g_autofillModInfo,g_autofillShelfInfo]=getAutofillModShelf(g_DragMouseStart,g_DragMouseEnd,g_pog_json,g_pog_index),console.log("Mod Info:",g_autofillModInfo),console.log("Shelf Info:",g_autofillShelfInfo),!0===await setAutofillBlock("A",o.block_name,"N","N",o.color)?(console.log("Created Block:",o.block_name,o.color),await new Promise((e=>setTimeout(e,50)))):console.warn("Skipped block due to invalid block dimensions:",o.block_name)}if("Y"==n){var o=[];for(const e of g_mod_block_list){var _={};_.BlkColor=e.BlkColor,_.BlkName=e.BlkName,_.BlkRule=e.BlkRule,_.BlkFilters=e.BlockFilters.join(" AND "),e.BlkFilters=_.BlkFilters,o.push(_)}await save_blk_dtl_coll("A","Blks",o);apex.region("mod_block_details").refresh(),$("#added_attribute").show(),apex.region("added_attribute").refresh(),wpdCaptureShowChangesBlockSnapshot(g_mod_block_list)}console.log("All blocks created"),a(!0)}catch(e){i(e)}},error:function(e){console.error("AJAX Error:",e),i(e)}})}))}async function save_af_version(){logDebug("function : save_af_verion","S");var e=$v("P193_OPEN_POG_CODE"),o=$v("P193_OPEN_POG_VERSION"),_=$v("P193_OPEN_DRAFT"),t=$v("P193_EXISTING_DRAFT_VER"),n=0;null!==apex.region("mod_block_details")&&(n=apex.region("mod_block_details").widget().interactiveGrid("getViews","grid").model.getTotalRecords());function g(e){const o=getAfVersion();var _=$v("P193_OPEN_POG_CODE"),t=$v("P193_OPEN_POG_VERSION");g_autofill_detail.AFPOGCode=_,g_autofill_detail.AFPOGVersion=t,g_autofill_detail.AFVersion=o,g_autofill_detail.BlkSelType="M",g_autofill_detail.AutofillRule=$v("P193_AUTOFILL_RULE"),g_autofill_detail.BlkInfo=g_mod_block_list;var n=$v("P193_OPEN_DRAFT"),g=$v("P193_EXISTING_DRAFT_VER");apex.server.process("SAVE_AUTOFILL",{x01:g_autofill_detail.AFPOGCode,x02:$v("P193_AF_VERSION"),x03:g_autofill_detail.AutofillRule,x04:g_autofill_detail.BlkSelType,x05:g_autofill_detail.AFPOGVersion,p_clob_01:JSON.stringify(filterAutoFillJsontag(g_autofill_detail)),x06:e,x07:o,x08:"Y"==n?g:""},{dataType:"text",success:function(e){"ERROR"==$.trim(e).split(",")[0]&&raise_error(e)}})}0!=n?apex.server.process("CHECK_AUTOFILL_EXISTS",{x01:e,x02:o,x03:"Y"==_?t:""},{dataType:"text",success:function(e){e=$.trim(e),console.log("Exists Check:",e),"YES"==e&&apex.message.confirm("Do you want to override the existing version?",(function(e){g(e?"U":"N")})),"DELETE"==e&&apex.message.confirm("You already have existing blockings.Process to delete oldest version",(function(e){e?g("D"):console.log("NO ACTION")})),"OVERIDE"==e&&apex.message.confirm("You already have existing blockings.Do you want to overide?",(function(e){e?g("O"):console.log("NO ACTION")})),"NO"==e&&g("S")}}):alert(get_message("POGCR_BLK_NULL"))}function getAfVersion(){const e=new Date,o=e.getFullYear(),_=String(e.getMonth()+1).padStart(2,"0"),t=String(e.getDate()).padStart(2,"0"),n=String(e.getHours()).padStart(2,"0"),g=String(e.getMinutes()).padStart(2,"0"),a=String(e.getSeconds()).padStart(2,"0");return Number(`${o}${_}${t}${n}${g}${a}`)}function wpdInitializeAttributeReorder(){document.querySelectorAll(".u-tC").forEach((e=>{let o=null;e.addEventListener("dragstart",(function(e){const _=e.target.closest(".attr-chip");_&&(o=_,_.classList.add("dragging"))})),e.addEventListener("dragend",(function(e){const _=e.target.closest(".attr-chip");_&&(_.classList.remove("dragging"),o=null)})),e.addEventListener("dragover",(function(_){if(_.preventDefault(),!o)return;const t=wpdGetAttributeInsertPosition(e,_.clientY);null==t?e.appendChild(o):e.insertBefore(o,t)}))}))}function wpdGetAttributeInsertPosition(e,o){return[...e.querySelectorAll(".attr-chip:not(.dragging)")].reduce(((e,_)=>{const t=_.getBoundingClientRect(),n=o-t.top-t.height/2;return n<0&&n>e.offset?{offset:n,element:_}:e}),{offset:Number.NEGATIVE_INFINITY}).element}function wpdCollectAttributeSequence(e){const o=e.querySelectorAll(".attr-chip"),_=[];return o.forEach(((e,o)=>{_.push({seq_id:e.dataset.seq,new_position:o+1})})),_}async function open_view_analysis(){logDebug("function : open_view_analysis","S");try{let e=g_pog_json[g_pog_index].POGCode,o=g_pog_json[g_pog_index].Version;await show_view_analysis(e,o)}catch(e){error_handling(e)}finally{logDebug("function : open_view_analysis","E")}}function add_pog_versions(){logDebug("function : add_pog_versions","S");try{const e=document.getElementById("top_ver");if(!e)return;e.innerHTML="";const o=document.createElement("option");o.value="",o.textContent="Select",e.appendChild(o);const _=$v("P193_AF_VERSIONS"),t=$v("P193_AF_VERSION");if(_&&""!==_.trim()){_.split(":").forEach((function(o){const _=o.trim(),n=document.createElement("option");n.value=_,n.textContent=_,_===t&&(n.selected=!0),e.appendChild(n)}))}logDebug("function : add_pog_versions","E")}catch(e){logDebug("function : add_pog_versions","E"),error_handling(e)}}function apply_attribute_selection(){logDebug("function : apply_attribute_selection","S");try{const e=document.getElementById("attr_select");if(!e)return;e.innerHTML="";const o=document.createElement("option");o.value="Default",o.textContent="Default",e.appendChild(o);document.querySelectorAll(".attr-chip").forEach((o=>{const _=o.querySelector(".attr-name"),t=o.querySelector(".attr-value");if(_&&t){const o=document.createElement("option");o.textContent=_.textContent.trim(),o.value=t.textContent.trim(),e.appendChild(o)}})),logDebug("function : apply_attribute_selection","E")}catch(e){logDebug("function : apply_attribute_selection","E"),error_handling(e)}}async function handle_attribute_change(e){logDebug("function : handle_attribute_change","S");try{var o=e.value;e.options[e.selectedIndex].text;for(const e of g_mod_block_list)for(const o of e.BlockDim.ColorObj.children)if(o.uuid==e.BlkName){e.BlockDim.ColorObj.remove(o);break}render(g_pog_index),g_mod_block_list=[],await createDynamicBlocks($v("P193_OPEN_POG_CODE"),$v("P193_OPEN_DRAFT"),$v("P193_OPEN_POG_VERSION"),$v("P193_EXISTING_DRAFT_VER"),"Y","Default"==o?"":o),apex.region("mod_block_details").refresh(),logDebug("function : handle_attribute_change","E")}catch(e){logDebug("function : handle_attribute_change","E"),error_handling(e)}}async function handle_version_change(e){logDebug("function : handle_version_change","S");try{var o=e.value;e.options[e.selectedIndex].text;for(const e of g_mod_block_list)for(const o of e.BlockDim.ColorObj.children)if(o.uuid==e.BlkName){e.BlockDim.ColorObj.remove(o);break}render(g_pog_index),g_mod_block_list=[],g_autofill_detail=[],g_auto_fill_active="N",await auto_fill_setup(0,o),apex.region("mod_block_details").refresh(),await runattrCollections(),wpdCaptureShowChangesBlockSnapshot(g_mod_block_list,"Y"),logDebug("function : handle_version_change","E")}catch(e){logDebug("function : handle_version_change","E"),error_handling(e)}}function onContextMenu(e){logDebug("function : onContextMenu","S");var o="N";if("CANVAS"==e.target.nodeName&&g_scene_objects.length>0){set_curr_canvas(e),g_canvas=e.target,g_pog_index=parseInt(g_canvas.getAttribute("data-indx")),g_context_opened="Y";"Y"==g_compare_pog_flag&&5,console.log("event",e.target,g_pog_index);var _=g_canvas.getBoundingClientRect(),t=_.left,n=_.top,g=e.clientX-_.left,a=e.clientY-_.top;if(prevX=startX=g,prevY=startY=a,g_dragging=doMouseDown(g,a,t,n,e,g_canvas,"Y",g_pog_index),console.log("return from MouseDown",g_dragging),console.log("constext ",g_start_canvas,g_ComViewIndex,g_compare_view,g_compare_pog_flag),"N"==g_carpark_item_flag&&"N"==g_carpark_edit_flag&&(g_start_canvas==g_ComViewIndex&&"POG"==g_compare_view&&"Y"==g_compare_pog_flag||g_start_canvas!==g_ComViewIndex&&"Y"==g_compare_pog_flag||"N"==g_compare_pog_flag)){e.preventDefault(),new_details=JSON.parse(JSON.stringify(g_delete_details));for(const e of new_details)e.ShelfInfo="";o="Y"}if("Y"==o){var i=document.getElementById("t_Header"),r=document.getElementById("t_Body_title"),s=document.getElementById("top_bar"),l=document.getElementById("t_Body_nav"),d=document.getElementById("side_bar"),f=document.getElementById("maincanvas-btns"),c=(null!=f&&f.offsetHeight,window.devicePixelRatio,parseFloat($(".t-Body-contentInner").css("padding-left").replace("px","")),i.offsetHeight,r.offsetHeight,s.offsetHeight,l.offsetWidth),I=d.offsetWidth,p=document.getElementById("context-menu"),m=parseInt(e.clientX-$(".t-Region-body").scrollLeft()+p.offsetWidth),u=parseInt($(window).width()-(c+I)),h=parseInt(e.clientX-$(".t-Region-body").scrollLeft()+p.offsetWidth);e.clientY>window.innerHeight/2?p.style.top=e.clientY-$(document).scrollTop()-p.offsetHeight+"px":p.style.top=e.clientY-$(document).scrollTop()+"px",m>u&&("Y"==g_shelf_edit_flag||"Y"==g_item_edit_flag)?p.style.left=e.clientX-$(".t-Region-body").scrollLeft()-p.offsetWidth+"px":p.style.left=h>u?e.clientX-$(".t-Region-body").scrollLeft()-p.offsetWidth+"px":e.clientX-$(".t-Region-body").scrollLeft()+"px",console.log("contextElement.style.top",p.style.top,p.style.left,e),p.classList.add("active")}}logDebug("function : onContextMenu","E")}async function context_func(e){logDebug("function : context_func; action : "+e,"S"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&("copy_pogc_image"!=e&&"zoom_selected_pogc"!=e&&"N"==g_module_edit_flag&&"N"==g_shelf_edit_flag&&"N"==g_item_edit_flag&&"edit"!==e&&"Y"!==g_multiselect&&"muledit"!==e?alert(get_message("NO_OBJECT_ERROR")):"add"==e?context_add():"delete"==e?delete_blk_details(g_selected_block):"edit"==e&&open_blk_details(g_selected_block,"Y")),g_taskItemInContext="",g_context_opened="N",logDebug("function : context_func","E")}function createAttributeCollection(){return apex.server.process("CREATE_ATTRIBUTE_COLL",{x01:$v("P193_OPEN_POG_CODE"),x02:$v("P193_AF_VERSION")},{dataType:"text"})}async function runattrCollections(){try{let e=await createAttributeCollection();if($("#added_attribute").show(),apex.region("added_attribute").refresh(),"ERROR"===$.trim(e).split(",")[0])return void raise_error(e)}catch(e){console.error(e),raise_error("Server Error")}}function doMouseDown(e,o,_,t,n,g,a,i){logDebug("function : doMouseDown; x : "+e+"; y : "+o+"; startX : "+_+"; startY : "+t+"; context_call : "+a,"S");try{if(g_scene_objects.length>0){var r=document.getElementById("t_Header"),s=document.getElementById("t_Body_title"),l=document.getElementById("top_bar"),d=document.getElementById("t_Body_nav"),f=document.getElementById("side_bar"),c=window.devicePixelRatio,I=$(document).scrollTop(),p=$(".t-Region-body").scrollLeft(),m=r.offsetHeight,u=s.offsetHeight,h=l.offsetHeight,S=(d.offsetWidth,f.offsetWidth),v=parseFloat($(".t-Body-contentInner").css("padding-left").replace("px",""))*c;g_global_counter+=1,g_start_coorX=_,g_start_coorY=t,g_taskItemInContext=!0,g_taskItemInContext1=!0,"N"==a&&(g_selection.style.visibility="hidden");var O={},x={};void 0!==g_scene_objects[g_pog_index]&&g_scene_objects.length>0&&(O=g_scene_objects[g_pog_index].scene.children[0],x=g_scene_objects[g_pog_index].scene.children[2]);for(var D=[],b=0,j=g_undo_final_obj_arr.length;b<j;b++)g_undo_final_obj_arr[b][0].length>0&&void 0!==g_undo_final_obj_arr[b][0][0]&&void 0===g_undo_final_obj_arr[b][0][0].CurrCanvas&&D.push(g_undo_final_obj_arr[b]);g_undo_final_obj_arr=D;for(D=[],b=0,j=g_redo_final_obj_arr.length;b<j;b++)void 0!==g_redo_final_obj_arr[b][0][0]&&void 0===g_redo_final_obj_arr[b][0][0].CurrCanvas&&D.push(g_redo_final_obj_arr[b]);g_redo_final_obj_arr=D,g_curr_canvas=g_pog_index,g_start_canvas=g_pog_index,reset_indicators(),"Y"==g_show_item_color&&(g_pog_json[i].GroupingType=g_scene_objects[g_pog_index].Indicators.canvas_color_flag,$s("P193_SELECT_COLOR_TYPE",g_scene_objects[g_pog_index].Indicators.canvas_color_flag));var M=g.width,E=g.height,P=2*e/M-1,C=1-2*o/E;if(g_carpark_item_flag="N",g_carpark_edit_flag="N",g_module_edit_flag="N",g_shelf_edit_flag="N",g_item_edit_flag="N",g_module_index=-1,g_shelf_index=-1,g_module_cnt=-1,g_item_index=-1,g_module_width=-1,comp_obj_id=-1,g_module_X="",g_shelf_max_merch="",g_shelf_basket_spread="",render(g_pog_index),O.updateProjectionMatrix(),g_raycaster.setFromCamera(new THREE.Vector2(P,C),O),g_intersects=g_raycaster.intersectObjects(x.children),$s("P193_SELECTED_CANVAS",`${g_curr_canvas}`),0==g_intersects.length){if(g_mselect_drag="N",g_multiselect="N",g_ctrl_select="N",g_delete_details=[],$("#draggable_table .product_list_blink").removeClass("product_list_blink"),g_intersected&&g_intersected.length>0){for(b=0;b<g_intersected.length;b++)void 0!==g_intersected[b]&&(void 0!==g_intersected[b].BorderColour&&(g_select_color=g_intersected[b].BorderColour),g_intersected[b].WireframeObj.material.color.setHex(g_intersected[b].BorderColour),"Y"==g_intersected[b].ImageExists&&"Y"==g_show_live_image&&(g_intersected[b].WireframeObj.material.transparent=!0,g_intersected[b].WireframeObj.material.opacity=.0025));clearInterval(g_myVar),g_select_color=0,render(g_pog_index)}if(x.add(g_targetForDragging),g_targetForDragging.position.set(0,0,0),render(g_pog_index),g_intersects=g_raycaster.intersectObjects(x.children),g_intersects.length>0){var N=g_intersects[0].point.x,T=g_intersects[0].point.y;g_drag_z=g_intersects[0].point.z,g_drag_z+=.001;var y=new THREE.Vector3(N,T,Y);x.worldToLocal(y);P=Math.min(19,Math.max(-19,y.x)),o=Math.min(19,Math.max(-19,y.y));if("N"==a&&(g_DragMouseStart.x=P,g_DragMouseStart.y=o,g_DragMouseEnd.x=P,g_DragMouseEnd.y=o),g_startMouse.x=n.clientX+p-(S+v),g_startMouse.y=n.clientY+I-(u+v+m+h),g_prevMouse.x=P,g_prevMouse.y=o,g_nextMouse=g_prevMouse.clone(),x.remove(g_targetForDragging),g_intersected=[],g_select_zoom_arr=[],"N"!=g_context_opened||n.shiftKey)return!(!n.shiftKey||"Y"!=g_manual_zoom_ind)||("Y"!=g_context_opened||n.shiftKey||(g_mselect_drag="N",g_context_opened="N"),!1);var R=g_startMouse.x,w=g_startMouse.y;return g_selecting=!0,g_selection.style.left=g_startMouse.x+"px",g_selection.style.top=g_startMouse.y+"px",g_selection.style.width=R-g_startMouse.x+"px",g_selection.style.height=w-g_startMouse.y+"px",g_selection.style.visibility="visible",!0}return g_intersected=[],g_select_zoom_arr=[],!1}if(g_intersects.length>0){if("drag_object"==g_intersects[0].object.uuid){var F=g_intersects[1];g_objectHit=F.object;N=g_intersects[1].point.x;g_mousedown_locx=g_intersects[1].point.x;T=g_intersects[1].point.y;var Y=g_intersects[1].point.z;g_drag_z=g_intersects[1].point.z}else{F=g_intersects[0];g_objectHit=F.object;N=g_intersects[0].point.x;g_mousedown_locx=g_intersects[0].point.x;T=g_intersects[0].point.y,Y=g_intersects[0].point.z;g_drag_z=g_objectHit.position.z}y=new THREE.Vector3(N,T,Y);x.worldToLocal(y);P=Math.min(19,Math.max(-19,y.x)),g_drag_z;g_drag_z+=.001,g_itemDragZ=g_objectHit.position.z,g_itemDragX=g_objectHit.position.x;o=Math.min(19,Math.max(-19,y.y));g_objectHit_uuid=g_objectHit.uuid,g_objectHit_id=g_objectHit.id,b=0;var H,L="N";if("Y"==g_multiselect||"Y"==g_ctrl_select){for(const e of g_delete_details)e.ObjID==g_objectHit_id&&(L="Y");"Y"==L&&(update_item_xy_distance("Y",i,P,o),g_mselect_drag="Y")}else g_mselect_drag="N";if(get_object_identity(g_pog_index,g_multiselect,g_multi_copy_done,P,o),"N"==a&&"N"==g_ctrl_select&&(g_multiselect="N"),-1!==g_module_index&&-1!==g_shelf_index&&update_item_distance(g_module_index,g_shelf_index,g_pog_index),g_ComViewIndex==g_pog_index&&"EDIT_PALLET"==g_compare_view){if(g_intersects.length>0){var A=g_pog_json[g_ComViewIndex].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index];if(void 0!==A&&(""==A.TopObjID||void 0===A.TopObjID))for(const e of g_intersects){for(const o of g_pog_json[g_ComViewIndex].ModuleInfo){b=0;for(const _ of o.ShelfInfo){var B=0;for(const o of _.ItemInfo){if(o.ObjID==e.object.id){var k=g_scene_objects[g_ComViewIndex].scene.children[2].getObjectById(o.ObjID);"PEGBOARD"!==g_shelf_object_type?k.Distance=o.Distance:(k.PegBoardX=o.PegBoardX,k.PegBoardY=o.PegBoardY),k.ItemInfo=o,k.IIndex=B,k.StartCanvas=g_start_canvas,k.MIndex=g_module_index,k.SIndex=g_shelf_index,k.old_position_x=k.position.x,k.old_position_y=k.position.y,k.old_position_z=k.position.z,g_drag_items_arr.push(k)}B++}b++}0}}}if(0==g_drag_items_arr.length)return!1}if(g_intersects.length>0&&"N"==a&&"Y"!==g_mselect_drag){if(0==n.altKey){if(g_intersected&&g_intersected[0]!=g_intersects[0].object)for(b=0;b<g_intersected.length;b++)void 0!==g_intersected[b]&&(void 0!==g_intersected[b].BorderColour&&(g_select_color=g_intersected[b].BorderColour),g_intersected[b].WireframeObj.material.color.setHex(g_intersected[b].BorderColour),"Y"==g_intersected[b].ImageExists&&"Y"==g_show_live_image&&(g_intersected[b].WireframeObj.material.transparent=!0,g_intersected[b].WireframeObj.material.opacity=.0025));g_intersected=[],g_select_zoom_arr=[],g_intersected.push(g_objectHit)}else if(1==n.altKey&&(g_select_zoom_arr.push(g_objectHit),g_intersected.push(g_objectHit),"Y"==g_item_edit_flag||"Y"==g_shelf_edit_flag)){var G=g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index],W=g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index];add_ctrl_select_items("Y"==g_shelf_edit_flag?"S":"I","Y"==g_shelf_edit_flag?{}:G,W,g_module_index,g_shelf_index,g_item_index,g_pog_json[i].ModuleInfo[g_module_index].MObjID,g_objectHit_id,i),g_ctrl_select="Y",g_multiselect="Y",g_multiItemCopy="Y"}render_animate_selected()}else if(g_intersected){for(b=0;b<g_intersected.length;b++)void 0!==g_intersected[b]&&(g_select_color=g_intersected[b].BorderColour,g_intersected[b].WireframeObj.material.color.setHex(g_intersected[b].BorderColour),"Y"!=g_intersected[b].ImageExists||"Y"!=g_show_live_image&&"Y"!=g_show_live_image_comp||(g_intersected[b].WireframeObj.material.transparent=!0,g_intersected[b].WireframeObj.material.opacity=.0025));clearInterval(g_myVar),g_select_color=0,render(g_pog_index)}if(g_pog_index==g_ComViewIndex){if("POG"!==g_compare_view&&"undefined"!=typeof comp_obj_id&&"PREV_VERSION"!==g_compare_view&&"EDIT_PALLET"!==g_compare_view)void 0!==(k=g_scene_objects[g_ComBaseIndex].scene.children[2].getObjectById(comp_obj_id))&&g_intersected.push(k),clearInterval(g_myVar),g_select_color=0,render_animate_selected();else if("POG"==g_compare_view||"PREV_VERSION"==g_compare_view&&0==n.altKey||"EDIT_PALLET"==g_compare_view){var V=get_similar_items(g_objectHit_uuid,"I",g_ComBaseIndex);if(g_intersected=[],V.length>0){for(b=0;b<V.length;b++)g_intersected.push(V[b]);clearInterval(g_myVar),g_select_color=0,render_animate_selected()}}}else if(("Y"==g_module_edit_flag||"Y"==g_shelf_edit_flag||"Y"==g_item_edit_flag)&&g_ComViewIndex>-1&&0==n.altKey)if("POG"!==g_compare_view&&"undefined"!=typeof comp_obj_id&&"Y"==g_compare_pog_flag){if(g_scene_objects[g_ComViewIndex].scene.children[2].children.length>0){k=g_scene_objects[g_ComViewIndex].scene.children[2].getObjectById(comp_obj_id);g_intersected=[],void 0!==k&&g_intersected.push(k),clearInterval(g_myVar),g_select_color=0,render_animate_selected()}}else if("Y"==g_item_edit_flag){V=get_similar_items(g_objectHit_uuid,"I",g_ComViewIndex);if(g_intersected=[],V.length>0){for(b=0;b<V.length;b++)g_intersected.push(V[b]);clearInterval(g_myVar),g_select_color=0,render_animate_selected()}}if(g_drag_x=g_module_X,"Y"==g_shift_mutli_item_select&&-1!==g_item_index)(H="Y"==g_carpark_item_flag?g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index]:g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index]).isCarpark=g_carpark_item_flag,$.isEmptyObject(g_shift_multi_item_first)?g_shift_multi_item_first=H:g_shift_multi_item_last=H;if(-1!==g_shelf_index&&-1!==g_module_index)update_item_distance(g_module_index,g_shelf_index,g_pog_index);if(render(g_pog_index),0===nvl(g_pog_json)||"PREV_VERSION"===g_compare_view||"Y"!=g_item_edit_flag&&"Y"!=g_shelf_edit_flag||backupPog("S",g_shelf_index,g_module_index,g_pog_index),"Y"==g_carpark_edit_flag||"Y"==g_shelf_edit_flag&&g_pog_index==g_ComViewIndex&&"EDIT_PALLET"==g_compare_view)return!1;if(g_pog_index==g_ComViewIndex&&"EDIT_PALLET"!==g_compare_view&&"PREV_VERSION"!==g_compare_view)return!1;if("Y"==g_module_edit_flag||-1!==g_module_obj_array.indexOf(g_objectHit)||g_objectHit_uuid.match(/BASE.*/)||g_objectHit_uuid.match(/NOTCH.*/)){if("N"==g_auto_fill_active)n.ctrlKey&&"Y"==g_module_edit_flag?(context_copy("S",i),g_duplicating="Y"):n.ctrlKey&&"Y"==g_item_edit_flag&&(context_copy("S",i),g_duplicating="Y",g_dupShelfDepth=g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].D);else if("Y"==g_auto_fill_active&&g_mod_block_list.length>0){var X=function(e){try{if("undefined"==typeof g_raycaster)return!1;for(const n of g_mod_block_list)if(n.BlkName===e){var o=n.BlockDim&&n.BlockDim.ColorObj?n.BlockDim.ColorObj:null;if(!o)return!1;var _=o.getObjectByProperty("uuid",e);if(!_)return!1;var t=g_raycaster.intersectObject(_,!0);return t&&t.length>0}}catch(e){return!1}return!1};for(colorObj of g_mod_block_list)if(colorObj.mod_index[0]==g_module_index&&X(colorObj.BlkName)){var U=colorObj.BlkName,z=colorObj.BlockDim.ColorObj;g_selected_block=U,console.log("block name",g_selected_block);try{highlightAutofillBlock(U,i)}catch(e){console.warn(e)}return g_dragItem=z.getObjectByProperty("uuid",U),!0}}if("N"==g_context_opened){g_startMouse.x=n.clientX+p-(S+v),g_startMouse.y=n.clientY+I-(u+v+m+h),g_prevMouse.x=P,g_prevMouse.y=o,g_nextMouse=g_prevMouse.clone(),g_DragMouseStart.x=P,g_DragMouseStart.y=o,g_DragMouseEnd.x=P,g_DragMouseEnd.y=o;R=g_startMouse.x+1,w=g_startMouse.y+1;if(n.shiftKey||(g_selecting=!0,g_selection.style.left=g_startMouse.x+"px",g_selection.style.top=g_startMouse.y+"px",g_selection.style.width=R-g_startMouse.x+"px",g_selection.style.height=w-g_startMouse.y+"px",g_selection.style.visibility="visible"),g_intersected){for(b=0;b<g_intersected.length;b++)void 0!==g_intersected[b]&&(g_select_color=g_intersected[b].BorderColour,g_intersected[b].WireframeObj.material.color.setHex(g_intersected[b].BorderColour),"Y"==g_intersected[b].ImageExists&&"Y"==g_show_live_image&&(g_intersected[b].WireframeObj.material.transparent=!0,g_intersected[b].WireframeObj.material.opacity=.0025));clearInterval(g_myVar),g_select_color=0,render(g_pog_index),g_intersected=[],g_select_zoom_arr=[]}if(g_select_zoom_arr.push(g_objectHit),g_intersected.push(g_objectHit),g_pog_index==g_ComViewIndex&&"Y"==g_module_edit_flag&&"undefined"!=typeof comp_obj_id)void 0!==(k=g_scene_objects[g_ComViewIndex].scene.children[2].getObjectById(comp_obj_id))&&g_intersected.push(k);else if("Y"==g_module_edit_flag&&"Y"==g_compare_pog_flag&&"undefined"!=typeof comp_obj_id){if(g_scene_objects[g_ComViewIndex].scene.children[2].children.length>0)void 0!==(k=g_scene_objects[i].scene.children[2].getObjectById(comp_obj_id))&&g_intersected.push(k)}else if(g_objectHit_uuid.match(/BASE.*/)&&"Y"==g_compare_pog_flag&&void 0!==g_pog_json[i].CompBaseObjID){void 0!==(k=g_scene_objects[g_ComViewIndex].scene.children[2].getObjectById(g_pog_json[i].CompBaseObjID))&&g_intersected.push(k)}return render_animate_selected(),!0}return!1}if("N"==g_auto_fill_active){if(g_dragItem=g_objectHit,"N"==g_chest_move&&"CHEST"==g_shelf_object_type&&"Y"==g_shelf_edit_flag&&"Y"==g_chest_as_pegboard){g_startMouse.x=n.clientX+p-(S+v),g_startMouse.y=n.clientY+I-(u+v+m+h),g_prevMouse.x=P,g_prevMouse.y=o,g_nextMouse=g_prevMouse.clone(),g_DragMouseStart.x=P,g_DragMouseStart.y=o,g_DragMouseEnd.x=P,g_DragMouseEnd.y=o;R=g_startMouse.x+1,w=g_startMouse.y+1;n.shiftKey||(g_selecting=!0,g_selection.style.left=g_startMouse.x+"px",g_selection.style.top=g_startMouse.y+"px",g_selection.style.width=R-g_startMouse.x+"px",g_selection.style.height=w-g_startMouse.y+"px",g_selection.style.visibility="visible")}else{if("Y"==g_shelf_edit_flag&&"DIVIDER"!==g_shelf_object_type&&"TEXTBOX"!==g_shelf_object_type){g_dragItem.ShelfInfo=g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index],g_dragItem.StartCanvas=g_start_canvas,g_dragItem.MIndex=g_module_index,g_dragItem.SIndex=g_shelf_index;B=0;for(const e of g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo){void 0!==(k=x.getObjectById(e.ObjID))&&("PEGBOARD"!==g_shelf_object_type?k.Distance=e.Distance:(k.PegBoardX=e.PegBoardX,k.PegBoardY=e.PegBoardY),k.ItemInfo=e,k.IIndex=B,k.StartCanvas=g_start_canvas,k.MIndex=g_module_index,k.SIndex=g_shelf_index,g_drag_items_arr.push(k)),B++}}else"Y"==g_item_edit_flag?(g_dragItem.ItemInfo=g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index],g_dragItem.MIndex=g_module_index,g_dragItem.SIndex=g_shelf_index,g_dragItem.IIndex=g_item_index,g_dragItem.StartCanvas=g_start_canvas):"Y"==g_shelf_edit_flag&&(g_dragItem.ShelfInfo=g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index],g_dragItem.StartCanvas=g_start_canvas,g_dragItem.MIndex=g_module_index,g_dragItem.SIndex=g_shelf_index);n.ctrlKey&&"Y"==g_shelf_edit_flag?(context_copy("S",i),g_duplicating="Y",render_animate_selected()):n.ctrlKey&&"Y"==g_item_edit_flag&&(context_copy("S",i),g_duplicating="Y",g_dupShelfDepth=g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].D,render_animate_selected())}if("N"==a)return!0}}else if(g_intersected){for(b=0;b<g_intersected.length;b++)void 0!==g_intersected[b]&&(g_select_color=g_intersected[b].BorderColour,g_intersected[b].WireframeObj.material.color.setHex(g_intersected[b].BorderColour),"Y"==g_intersected[b].ImageExists&&"Y"==g_show_live_image&&(g_intersected[b].WireframeObj.material.transparent=!0,g_intersected[b].WireframeObj.material.opacity=.0025));clearInterval(g_myVar),g_select_color=0,render(g_pog_index),g_intersected=[],g_select_zoom_arr=[]}logDebug("function : doMouseDown","E")}}catch(e){error_handling(e)}}async function context_delete(e,o,_,t,n,g,a,i,r,s,l,d,f){logDebug("function : context_delete; action : "+e+"; moduleIndex : "+o+"; shelfIndex : "+_+"; itemIndex : "+t+"; i_item_edit_flag : "+n+"; i_module_edit_flag : "+g+"; i_shelf_edit_flag : "+a+"; objectHitID : "+i+"; shelfObjType : "+r,"S");try{var c="N",I=g;if("DELETE"==e){if("Y"!==s.multi_carpark_ind&&await get_delist_item(d,g_multiselect,_,o,t,a,g,n,s),void 0!==s&&s.length>0&&(I="N"),await deleteObject(d,s,f,I,o,"U"),"Y"==g&&"N"==g_manual_zoom_ind){var p=get_min_max_xy(d).split("###");set_camera_z(l,parseFloat(p[2]),parseFloat(p[3]),parseFloat(p[0]),parseFloat(p[1]),g_offset_z,parseFloat(p[4]),parseFloat(p[5]),!0,d),render(d)}}else{var m="N",u=g_pog_json[d].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index];"N"==g_carpark_item_flag&&-1!==t&&(m=u.ItemInfo[t].Item),"Y"==g?delete_module(i,o,l,d):"Y"==a||"Y"==n&&"DIVIDER"==m?("Y"==n&&"DIVIDER"==m&&(c="Y"),r=u.ObjType,delete_shelf(i,o,_,t,r,c,"N",d)):"Y"==n&&"DIVIDER"!==m&&delete_item(i,o,_,t,e,"Y",d)}"Y"==g_show_live_image&&animate_pog(d);await recreate_compare_views(g_compare_view,"N");logDebug("function : context_delete","E")}catch(e){error_handling(e)}}async function deleteObject(e,o,_,t="N",n=-1,g){logDebug("function : deleteObject; p_pog_index : "+e+"; pProductListOpen : "+_+"; pDeleteModule : "+t+"; pModuleIndex : "+n,"S");try{g_mselect_drag="N";var a="N";if("Y"!==t){var i="N",r="";for(const e of o)e.Object!==r&&""!==r&&(i="Y"),r=e.Object,"SHELF"==e.Object&&(a="Y");"Y"==i&&"Y"==a?confirm(get_message("ITEM_FIXEL_DELETE"),get_message("SHCT_YES"),get_message("SHCT_NO"),(async function(){await deleteObjectLib(e,a,o,_,"N",-1,"")}),(async function(){a="N",await deleteObjectLib(e,a,o,_,"N",-1,"")})):await deleteObjectLib(e,a,o,_,"N",-1,"")}else await deleteObjectLib(e,a,o,_,"Y",n,g);g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],logDebug("function : deleteObject","E")}catch(e){error_handling(e)}}wpdInitializeAttributeReorder();