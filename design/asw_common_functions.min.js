var g_page_no=function(){var e=(document.documentElement.className||"").match(/page-(\d+)/);return"P"+(e?e[1]:"0")+"_"}();console.log(g_page_no);var g_splitter_resize_bound="N";function runCanvasReflow(){try{if("function"==typeof window.reset_canvas_region)window.reset_canvas_region();else{var e=$v(g_page_no+"POGCR_TILE_VIEW");switchCanvasView(""==e?"V":e,"Y")}}catch(e){error_handling(e)}}function bindSplitterResizeSync(){try{if("Y"==g_splitter_resize_bound)return;g_splitter_resize_bound="Y",$(document).off("click.aswSplitterResize").on("click.aswSplitterResize",".a-Splitter-thumb",(function(){setTimeout(runCanvasReflow,80),setTimeout(runCanvasReflow,260),setTimeout(runCanvasReflow,520)})),$(document).off("transitionend.aswSplitterResize").on("transitionend.aswSplitterResize","#side_bar, #drawing_region, #wpdSplitter_splitter_first",(function(){setTimeout(runCanvasReflow,30)}))}catch(e){error_handling(e)}}function set_curr_canvas(e){if("CANVAS"==e.target.nodeName){if("mousemove"!==e.type)g_canvas=e.target,"mousedown"==e.type&&(g_all_pog_flag="N"),g_pog_index=parseInt(g_canvas.getAttribute("data-indx")),null==g_pog_index&&(g_pog_index=0);else e.target;if(g_scene_objects.length>0&&void 0!==g_scene_objects[g_pog_index]&&(g_scene=g_scene_objects[g_pog_index].scene,g_camera=g_scene.children[0],g_world=g_scene.children[2],g_renderer=g_scene_objects[g_pog_index].renderer,void 0!==g_pog_json[g_pog_index]&&"N"==g_all_pog_flag&&($s(g_page_no+"OPEN_POG_CODE",g_pog_json[g_pog_index].POGCode),$s(g_page_no+"OPEN_POG_VERSION",g_pog_json[g_pog_index].Version)),void 0!==g_scene_objects[g_pog_index].Indicators&&(g_show_fixel_label=g_scene_objects[g_pog_index].Indicators.FixelLabel,g_show_item_label=g_scene_objects[g_pog_index].Indicators.ItemLabel,g_show_notch_label=g_scene_objects[g_pog_index].Indicators.NotchLabel,g_show_max_merch=g_scene_objects[g_pog_index].Indicators.MaxMerch,g_show_item_color=g_scene_objects[g_pog_index].Indicators.ItemColor,g_show_item_desc=g_scene_objects[g_pog_index].Indicators.ItemDesc,g_show_live_image=g_scene_objects[g_pog_index].Indicators.LiveImage,g_show_days_of_supply=g_scene_objects[g_pog_index].Indicators.DaysOfSupply,g_overhung_shelf_active=g_scene_objects[g_pog_index].Indicators.OverhungShelf,g_itemSubLabelInd=g_scene_objects[g_pog_index].Indicators.ItemSubLabelInd,g_itemSubLabel=g_scene_objects[g_pog_index].Indicators.ItemSubLabel),"mousedown"==e.type||"contextmenu"==e.type||"dblclick"==e.type)){var _=g_canvas.getAttribute("id");$("[data-pog]").removeClass("multiPogList_active"),$(".canvas_highlight").removeClass("canvas_highlight"),$("#"+_+"-btns").addClass("canvas_highlight"),$("[data-indx="+g_pog_index+"]").addClass("multiPogList_active"),g_all_pog_flag="N"}}}function set_select_canvas(e){if(g_scene_objects.length>0&&void 0!==g_scene_objects[e]&&(g_scene=g_scene_objects[e].scene,g_camera=g_scene.children[0],g_world=g_scene.children[2],g_renderer=g_scene_objects[e].renderer,$s(g_page_no+"OPEN_POG_CODE",g_pog_json[g_pog_index].POGCode),$s(g_page_no+"OPEN_POG_VERSION",g_pog_json[g_pog_index].Version),void 0!==g_scene_objects[e].Indicators&&(g_show_fixel_label=g_scene_objects[e].Indicators.FixelLabel,g_show_item_label=g_scene_objects[e].Indicators.ItemLabel,g_show_notch_label=g_scene_objects[e].Indicators.NotchLabel,g_show_max_merch=g_scene_objects[e].Indicators.MaxMerch,g_show_item_color=g_scene_objects[e].Indicators.ItemColor,g_show_item_desc=g_scene_objects[e].Indicators.ItemDesc,g_show_live_image=g_scene_objects[e].Indicators.LiveImage,g_show_days_of_supply=g_scene_objects[e].Indicators.DaysOfSupply,g_overhung_shelf_active=g_scene_objects[e].Indicators.OverhungShelf,g_itemSubLabelInd=g_scene_objects[g_pog_index].Indicators.ItemSubLabelInd,g_itemSubLabel=g_scene_objects[g_pog_index].Indicators.ItemSubLabel),void 0!==g_canvas_objects[e])){var _=g_canvas_objects[e].getAttribute("id");$("[data-pog]").removeClass("multiPogList_active"),$(".canvas_highlight").removeClass("canvas_highlight"),$("#"+_+"-btns").addClass("canvas_highlight"),$("[data-indx="+e+"]").addClass("multiPogList_active"),g_all_pog_flag="N"}}async function appendMultiCanvasRowCol(e,_=$v(g_page_no+"POGCR_TILE_VIEW"),t="N",o){console.log("dynamic rows cols"),bindSplitterResizeSync(),"H"==_?($(".viewH").addClass("view_active"),$(".viewV").removeClass("view_active")):($(".viewV").addClass("view_active"),$(".viewH").removeClass("view_active")),g_windowHeight=window.innerHeight-167,$("#canvas-holder .container").css("height",g_windowHeight+"px");var a=$("#canvas-holder .container").height(),g=$("#canvas-holder .container").width();console.log("appendMultiCanvasRowCol: p_pog_count=",e,"p_type=",_,"containerH=",a,"containerW=",g);var i,n=1,s=1,r="Y",l=0,c=e,d=0,p=[];$("[data-col]").each((function(){var e=$(this)[0];p.push(e)})),e<=3?(r="N",i=e,s=e):4==e?(r="N",i=2,s=2,n=2):5==e||6==e||9==e?(s=3,n=Math.ceil(e/s)):7==e||8==e||10==e||11==e||12==e||16==e?(s=4,n=Math.ceil(e/s)):13==e||14==e||15==e||17==e||18==e||19==e||20==e?(s=5,n=Math.ceil(e/s)):(s=5,n=5),$("#canvas-holder .container").html(""),"H"==_?$("#canvas-holder .container").addClass("h-view").removeClass("v-view"):$("#canvas-holder .container").addClass("v-view").removeClass("h-view");for(var m=1;m<=n;m++){if($("#canvas-holder .container").append('<div class="row" data-row="'+m+'"></div>'),"Y"==r)c%(n-m+1)>0?i=s:(i=c/(n-m+1),r="N"),c-=i;for(var f=1;f<=i;f++){var v=0==l?"":l+1,h="maincanvas"+v;if("Y"==t)if(o==l-1){$("[data-row="+m+"]").append('<div class="canvas-content" id="'+h+'-container" data-col="'+f+'" style="height:'+parseFloat((a/n).toFixed(2))+"px;width:"+parseFloat((g/i).toFixed(2))+'px"><div class="canvas-buttons" id="'+h+'-btns" ><span class="fa fa-close canvas-close" onClick="closePog('+l+')"></span><span class="fa fa-window-maximize canvas-max" onClick="maximizePog('+l+')"></span><span class="fa fa-minus canvas-min" onClick="minimizePog('+l+')"></span></div><canvas class="canvasregion" data-canvas=true id="'+h+'" ></canvas></div>'),d=1;try{(x=document.getElementById(h))&&(x.setAttribute("data-indx",l),-1===g_canvas_objects.indexOf(x)&&g_canvas_objects.push(x))}catch(e){}}else{var u=p[l-d];$(u).attr("id",h+"-container"),$("[data-row="+m+"]").append(u);var b=$(u).attr("id");$("[data-row="+m+"] #"+b).css("height",parseFloat((a/n).toFixed(2))).css("width",parseFloat((g/i).toFixed(2))).attr("data-col",f),$("[data-row="+m+"] #"+b+" .canvas-buttons").attr("id",h+"-btns"),$("[data-row="+m+"] #"+b+" .canvasregion").attr("id",h);try{(x=document.getElementById(h))&&(x.setAttribute("data-indx",l),-1===g_canvas_objects.indexOf(x)&&g_canvas_objects.push(x))}catch(e){}}else{var I="";e>1&&(I='<div class="canvas-buttons" id="maincanvas'+v+'-btns" ><span class="fa fa-close canvas-close" onClick="closePog('+l+')"></span><span class="fa fa-window-maximize canvas-max" onClick="maximizePog('+l+')"></span><span class="fa fa-minus canvas-min" onClick="minimizePog('+l+')"></span></div>'),$("[data-row="+m+"]").append('<div class="canvas-content" id="maincanvas'+v+'-container" data-col="'+f+'" style="height:'+parseFloat((a/n).toFixed(2))+"px;width:"+parseFloat((g/i).toFixed(2))+'px">'+I+'<canvas class="canvasregion" data-canvas=true id="maincanvas'+v+'" ></canvas></div>');try{var x;(x=document.getElementById(h))&&(x.setAttribute("data-indx",l),-1===g_canvas_objects.indexOf(x)&&g_canvas_objects.push(x))}catch(e){}}l++}}if("Y"==t){var j=0;for(m=1;m<=g_pog_json.length;m++)if(2!==m){const e=g_renderer,_=(g_scene_objects[m-1-j].scene,g_scene_objects[m-1-j].scene.children.find((e=>"PerspectiveCamera"===e.type)));h="maincanvas"+(1==m?"":m);var O=$("#"+h).parent().height(),C=$("#"+h).parent().width(),D=O-$("#"+h+"-btns")[0].offsetHeight,w=Math.tan(Math.PI/180*_.fov/2);_.aspect=C/D,_.fov=360/Math.PI*Math.atan(w),_.updateProjectionMatrix(),e.setSize(C,D),render(m)}else 2==m&&(j=1)}makeResizableRow()}async function switchCanvasView(e,_="N"){var t,o,a,g="Y",i=g_pog_index;a=$("[data-row]").length,$("[data-col]").length,"Collapse"==$(".a-Splitter-thumb").attr("title")&&(_="Y");var n=$("#drawing_region").width(),s=$("#side_bar").width();if((!(o=$("#canvas-holder").width())||o<=0)&&(o=n-s),(!o||o<=0)&&(o=$("#canvas-holder .container").width()),t=$("#canvas-holder .container").height(),$s(g_page_no+"POGCR_TILE_VIEW",e),"H"==e&&($("#canvas-holder .container").hasClass("v-view")&&"N"==_||"Y"==_)){$("#canvas-holder .container").css("display","flex").addClass("h-view").removeClass("v-view"),$(".viewH").addClass("view_active"),$(".viewV").removeClass("view_active");for(var r=1;r<=a;r++){var l=$("[data-row="+r+"] [data-col]").length;$("[data-row="+r+"] .canvas-content").css("height",parseFloat((t/l).toFixed(2))).css("width",parseFloat((o/a).toFixed(2)))}}else if("V"==e&&($("#canvas-holder .container").hasClass("h-view")&&"N"==_||"Y"==_)){$("#canvas-holder .container").css("display","grid").addClass("v-view").removeClass("h-view"),$(".viewV").addClass("view_active"),$(".viewH").removeClass("view_active");for(r=1;r<=a;r++){l=$("[data-row="+r+"] [data-col]").length;$("[data-row="+r+"] .canvas-content").css("height",parseFloat((t/a).toFixed(2))).css("width",parseFloat((o/l).toFixed(2)))}}else g="N";if("Y"==g&&g_pog_json.length>0){g_canvas_objects=[];for(r=1;r<=g_pog_json.length;r++){const e=g_renderer,_=g_scene_objects[r-1].scene,t=g_scene_objects[r-1].scene.children.find((e=>"PerspectiveCamera"===e.type));var c="maincanvas"+(1==r?"":r);g_canvas=document.getElementById(c);var d=$("#"+c).parent().height(),p=$("#"+c).parent().width(),m=$("#"+c+"-btns")[0],f=p,v=d-(g_scene_objects.length>1?m.offsetHeight:0);$("#"+c).css("height",v+"px !important").css("width",f+"px !important"),$("#"+c).height(v),$("#"+c).width(f),g_canvas.width=f,g_canvas.height=v,g_canvas_objects.push($("#"+c)[0]);var h=Math.tan(Math.PI/180*t.fov/2);t.aspect=f/v,t.fov=360/Math.PI*Math.atan(h),t.updateProjectionMatrix(),e.setSize(f,v);var u=get_min_max_xy(r-1).split("###");set_camera_z(t,parseFloat(u[2]),parseFloat(u[3]),parseFloat(u[0]),parseFloat(u[1]),g_offset_z,parseFloat(u[4]),parseFloat(u[5]),!0,r-1),g_pog_index=r-1,g_scene=_,g_camera=t,render(r-1)}}g_pog_index=i}function generateCanvasListHolder(e){if($("#canvas-list-holder").html(""),e.length>0){for($("#canvas-list-holder").css({display:"flex",width:"auto"}),$("#canvas-list-holder").append('<div class="canvas-holder-div"><span class="canvas-holder-code expand-tab" onclick="expandAllPog()">'+g_expand_all_pog+"</span></div>"),i=0;i<e.length;i++)console.log("generage",i),$("#canvas-list-holder").append('<div class="canvas-holder-div"><span class="canvas-holder-code">'+e[i].POGCode+'</span><span class="fa fa-window-arrow-up canvas-expand" onClick=expandPog('+i+')></span><span class="fa fa-window-maximize canvas-max" onclick="maximizePog('+i+', 0)"></span><span class="fa fa-close canvas-close" onclick="closePog('+i+', 0)"></span></div>');$("#canvas-list-holder").width()>=window.innerWidth&&$("#canvas-list-holder").css("width","100%")}else $("#canvas-list-holder").css({display:"none",width:"auto"})}function onDocumentMouseWheel(e){logDebug("function : onDocumentMouseWheel","S");var _=g_canvas.getAttribute("id");if(console.log("jselector",_,e.target.nodeName,e.ctrlKey),"CANVAS"==e.target.nodeName)if(e.ctrlKey){g_duplicating="N",e.preventDefault(),e.stopPropagation(),g_manual_zoom_ind="Y";var t=g_canvas.getBoundingClientRect(),o=e.clientX-t.left,a=e.clientY-t.top,g=parseFloat($v(g_page_no+"POGCR_CAMERA_ZOOM_FACTOR")),i=2*o/(g_canvas.width/window.devicePixelRatio)-1,n=1-2*a/(g_canvas.height/window.devicePixelRatio),s=new THREE.Vector3(i,n,e.deltaY/500);s.unproject(g_camera),s.sub(g_camera.position),e.deltaY<0?($(_).css("cursor","zoom-in"),g_camera.position.addVectors(g_camera.position,s.setLength(g))):($(_).css("cursor","zoom-out"),g_camera.position.subVectors(g_camera.position,s.setLength(g))),render(g_pog_index)}else if("Y"==g_manual_zoom_ind){var r=parseFloat($v(g_page_no+"POGCR_WHEEL_UP_DOWN_INTER"));e.deltaY<0?g_camera.position.set(g_camera.position.x,g_camera.position.y+r,g_camera.position.z):e.deltaY>0&&g_camera.position.set(g_camera.position.x,g_camera.position.y-r,g_camera.position.z),render(g_pog_index)}logDebug("function : onDocumentMouseWheel","E")}function set_indicator_objects(e){var _={};_.FixelLabel=g_show_fixel_label,_.ItemLabel=g_show_item_label,_.NotchLabel=g_show_notch_label,_.MaxMerch=g_show_max_merch,_.ItemColor=g_show_item_color,_.ItemDesc=g_show_item_desc,_.LiveImage=g_show_live_image,_.DaysOfSupply=g_show_days_of_supply,_.OverhungShelf=g_overhung_shelf_active,_.ItemSubLabelInd=g_itemSubLabelInd,_.ItemSubLabel=g_itemSubLabel,g_scene_objects[e].Indicators=_}async function onWindowResize(e){logDebug("function : onWindowResize","S");try{var _=document.getElementById("t_Header"),t=document.getElementById("t_Body_title"),o=document.getElementById("top_bar"),a=document.getElementById("t_Body_nav"),g=document.getElementById("side_bar"),i=window.devicePixelRatio,n=_.offsetHeight*i,s=t.offsetHeight*i,r=o.offsetHeight*i,l=a.offsetWidth*i,c=g.offsetWidth*i,d=parseFloat($(".t-Body-contentInner").css("padding-left").replace("px",""));i>2.5?(g_windowHeight=window.innerHeight-(n+s+r/2),windowWidth=window.innerWidth-(l+c+d)):(g_windowHeight=window.innerHeight-(n+s+r+r+10),windowWidth=window.innerWidth-(l+c+d+10)),g_tanFOV=Math.tan(Math.PI/180*g_camera.fov/2);i=window.devicePixelRatio;if(console.log(" resizing ",g_start_pixel_ratio,i),g_start_pixel_ratio!==i){var p=JSON.parse(JSON.stringify(g_pog_json));g_pog_json=[],appendMultiCanvasRowCol(p.length,$v(g_page_no+"POGCR_TILE_VIEW")),g_pog_index=0,g_multi_pog_json=[],g_scene_objects=[],g_canvas_objects=[],addLoadingIndicator();for(var m=0;m<=p.length-1;m++){g_pog_index=m,init(m),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects);await create_module_from_json(p,sessionStorage.getItem("new_pog_ind"),"F",$v(g_page_no+"PRODUCT_BTN_CLICK"),sessionStorage.getItem("pog_opened"),"N","N","Y","Y","","N",g_scene_objects[m].scene.children[0],g_scene_objects[m].scene,g_pog_index,m);g_pog_index=m,render(m),animate_pog(m)}removeLoadingIndicator(regionloadWait),g_pog_json=g_multi_pog_json}g_renderer.render(g_scene,g_camera),logDebug("function : onWindowResize","E")}catch(e){error_handling(e)}}function get_object_identity(e,_,t,o,a){logDebug("function : get_object_identity","S");try{var g=0;for(const _ of g_pog_json[e].ModuleInfo){if("Y"==g_carpark_edit_flag)break;if(null==_.ParentModule&&void 0!==_.Carpark&&_.Carpark.length>0&&_.Carpark[0].ItemInfo.length>0){var i=0;for(const e of _.Carpark){if(e.SObjID==g_objectHit_id){g_module_index=g,g_shelf_index=i,g_carpark_edit_flag="Y";break}g_carpark_edit_flag="N",i++}}g++}if("N"==g_carpark_edit_flag){g=0;for(const _ of g_pog_json[e].ModuleInfo){if(g_taskItemInContext||"POG"==g_compare_view||"EDIT_PALLET"==g_compare_view){if(_.MObjID==g_objectHit_id&&null==_.ParentModule){g_module_index=g,g_module_cnt=g,g_module_width=_.W,g_module_X=_.X,g_module_edit_flag="Y",comp_obj_id=_.CompMObjID,g_wireframe_id=_.WFrameID,apex.item(g_page_no+"MODULE_DISP").setValue(_.Module);break}g_module_edit_flag="N"}else{if(_.CompMObjID==g_objectHit_id&&null==_.ParentModule){g_module_index=g,g_module_cnt=g,g_module_width=_.W,g_module_X=_.X,g_module_edit_flag="Y",comp_obj_id=_.MObjID,g_wireframe_id=_.WFrameID,apex.item(g_page_no+"MODULE_DISP").setValue(_.Module);break}g_module_edit_flag="N"}g++}}if("N"==g_module_edit_flag&&"N"==g_carpark_edit_flag){i=0;for(const _ of g_pog_json[e].ModuleInfo){if("Y"==g_shelf_edit_flag)break;null==_.ParentModule&&$.each(_.ShelfInfo,(function(e,_){if("BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType)if(g_taskItemInContext||"POG"==g_compare_view||"EDIT_PALLET"==g_compare_view){if(_.SObjID==g_objectHit_id)return g_module_index=i,g_shelf_index=e,g_shelf_max_merch=_.MaxMerch,g_shelf_basket_spread=_.BsktSpreadProduct,g_shelf_edit_flag="Y",g_wireframe_id=_.WFrameID,g_shelf_object_type=_.ObjType,comp_obj_id=_.CompShelfObjID,g_rotation=_.Rotation,_.Slope>0?g_slope=0-_.Slope:_.Slope<0?g_slope=-_.Slope:g_slope=0,!1;g_shelf_edit_flag="N"}else{if(_.CompShelfObjID==g_objectHit_id)return g_module_index=i,g_shelf_index=e,g_shelf_max_merch=_.MaxMerch,g_shelf_edit_flag="Y",g_wireframe_id=_.WFrameID,g_shelf_object_type=_.ObjType,g_shelf_basket_spread=_.BsktSpreadProduct,g_rotation=_.Rotation,comp_obj_id=_.SObjID,_.Slope>0?g_slope=0-_.Slope:_.Slope<0?g_slope=-_.Slope:g_slope=0,!1;g_shelf_edit_flag="N"}})),i++}}if("N"==g_shelf_edit_flag&&"N"==g_module_edit_flag&&"N"==g_carpark_edit_flag){var n=0;for(const _ of g_pog_json[e].ModuleInfo){if("Y"==g_item_edit_flag)break;if(null==_.ParentModule){if(void 0!==_.Carpark&&void 0!==_.Carpark[0]&&_.Carpark.length>0&&_.Carpark[0].ItemInfo.length>0){i=0;for(const e of _.Carpark[0].ItemInfo){if(g_taskItemInContext||"POG"==g_compare_view||"EDIT_PALLET"==g_compare_view){if(e.ObjID==g_objectHit_id){g_module_index=n,g_shelf_index=0,g_item_index=i,g_item_edit_flag="Y",g_shelf_object_type=_.Carpark[0].ObjType,g_wireframe_id=e.WFrameID,comp_obj_id=e.CompItemObjID,g_carpark_item_flag="Y";break}g_item_edit_flag="N"}else{if(e.ObjID==g_objectHit_id){g_module_index=n,g_shelf_index=0,g_item_index=i,g_item_edit_flag="Y",g_shelf_object_type=_.Carpark[0].ObjType,g_wireframe_id=e.WFrameID,comp_obj_id=e.ObjID,g_carpark_item_flag="Y";break}g_item_edit_flag="N"}i++}}g=0;for(const e of _.ShelfInfo){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){if("Y"==g_item_edit_flag)break;i=0;for(const _ of e.ItemInfo){if(g_taskItemInContext||"POG"==g_compare_view||"EDIT_PALLET"==g_compare_view||"PREV_VERSION"==g_compare_view){if(_.ObjID==g_objectHit_id){g_module_index=n,g_shelf_index=g,g_item_index=i,g_item_edit_flag="Y",g_shelf_object_type=e.ObjType,g_wireframe_id=_.WFrameID,comp_obj_id=_.CompItemObjID;break}g_item_edit_flag="N"}else{if(_.CompItemObjID==g_objectHit_id){g_module_index=n,g_shelf_index=g,g_item_index=i,g_item_edit_flag="Y",comp_obj_id=_.ObjID,g_shelf_object_type=e.ObjType,g_wireframe_id=_.WFrameID;break}g_item_edit_flag="N"}i++}}g++}}n++}}if("N"==_&&"N"==t){g_delete_details=[];var s=g_pog_json[e].ModuleInfo[g_module_index];if(-1!==g_shelf_index&&-1==g_item_index&&"N"==g_carpark_item_flag){var r=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index];(c={}).ObjID=r.SObjID,c.MIndex=g_module_index,c.SIndex=g_shelf_index,c.ObjWidth=r.W,c.ObjHeight=r.H,c.XAxis=r.X,c.YAxis=r.Y,c.ZAxis=r.Z,c.IIndex=-1,c.ObjType=r.ObjType,c.IsDivider="N",c.Object="SHELF",c.MObjID=s.MObjID,c.SObjID=r.SObjID,c.ItemID=r.Shelf,c.Item="",c.Exists="N",c.Rotation=r.Rotation,c.Slope=r.Slope,c.Distance=0,c.TopObjID="",c.BottomObjID="",c.StartCanvas=g_start_canvas,c.g_present_canvas=g_present_canvas,c.p_pog_index=e,c.W=r.W,c.H=r.H,c.D=r.D,c.AllowAutoCrush=r.AllowAutoCrush,c.Rotation=r.Rotation,c.Slope=r.Slope,c.Color=r.Color,c.Combine=r.Combine,c.LOverhang=r.LOverhang,c.ROverhang=r.ROverhang,c.DivHeight=void 0===r.DivHeight?0:r.DivHeight,c.DivWidth=void 0===r.DivWidth?0:r.DivWidth,c.DivPst=void 0===r.DivPst?"N":r.DivPst,c.DivPed=void 0===r.DivPed?"N":r.DivPed,c.DivPbtwFace=void 0===r.DivPbtwFace?"N":r.DivPbtwFace,c.NoDivIDShow=r.NoDivIDShow,c.DivFillCol=void 0===r.DivFillCol?"#3D393D":r.DivFillCol,c.SpreadItem=r.SpreadItem,c.MaxMerch=r.MaxMerch,c.FBold=r.FBold,c.FSize=r.FSize,c.FStyle=r.FStyle,c.InputText=r.InputText,c.TextImg=r.TextImg,c.TextImgMime=r.TextImgMime,c.TextImgName=r.TextImgName,c.ReduceToFit=r.ReduceToFit,c.TextDirection=r.TextDirection,c.WrapText=r.WrapText,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(c)}else if(-1!==g_shelf_index&&-1!==g_item_index&&"N"==g_carpark_item_flag){r=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index];var l=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index],c={},d="N",p="ITEM";"DIVIDER"==l.Item&&(d="Y",p="SHELF"),c.ObjID=l.ObjID,c.MIndex=g_module_index,c.SIndex=g_shelf_index,c.ObjWidth=l.W,c.ObjHeight=l.H,c.XAxis=l.X,c.YAxis=l.Y,c.ZAxis=l.Z,c.IIndex=g_item_index,c.ObjType=r.ObjType,c.IsDivider=d,c.Object=p,c.MObjID=s.MObjID,c.SObjID=r.SObjID,c.ItemID=l.ItemID,c.Item=l.Item,c.W=l.W,c.H=l.H,c.X=l.X,c.Y=l.Y,c.Exists="N",c.Rotation=0,c.Slope=0,c.Distance=l.Distance,c.TopObjID=l.TopObjID,c.BottomObjID=l.BottomObjID,c.StartCanvas=g_start_canvas,c.g_present_canvas=g_present_canvas,c.p_pog_index=e,c.Color=l.Color,"DIVIDER"==l.Item&&(c.DivHeight=void 0===l.DivHeight?0:l.DivHeight,c.DivWidth=void 0===l.DivWidth?0:l.DivWidth,c.DivPst=void 0===l.DivPst?"N":l.DivPst,c.DivPed=void 0===l.DivPed?"N":l.DivPed,c.DivPbtwFace=void 0===l.DivPbtwFace?"N":l.DivPbtwFace,c.NoDivIDShow=l.NoDivIDShow,c.DivFillCol=void 0===l.DivFillCol?"#3D393D":l.DivFillCol,c.LOverhang=0,c.ROverhang=0,c.MaxMerch=0),c.D=l.D,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(c)}else if(-1!==g_shelf_index&&-1!==g_item_index&&"Y"==g_carpark_item_flag){var m=g_pog_json[e].ModuleInfo[g_module_index].Carpark;l=g_pog_json[e].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index];(c={}).ObjID=l.ObjID,c.MIndex=g_module_index,c.SIndex=0,c.ObjWidth=l.W,c.ObjHeight=l.H,c.XAxis=l.X,c.YAxis=l.Y,c.ZAxis=l.Z,c.IIndex=g_item_index,c.ObjType=m.ObjType,c.IsDivider="N",c.Object="CARPARK_ITEM",c.MObjID=s.MObjID,c.SObjID=m.SObjID,c.ItemID=l.ItemID,c.Item=l.Item,c.W=l.W,c.H=l.H,c.X=l.X,c.Y=l.Y,c.Exists="N",c.Rotation=0,c.Slope=0,c.Distance=l.Distance,c.TopObjID=l.TopObjID,c.BottomObjID=l.BottomObjID,c.IsCarpark="Y",c.StartCanvas=g_start_canvas,c.g_present_canvas=g_present_canvas,c.p_pog_index=e,c.Color=l.Color,g_delete_details.multi_delete_shelf_ind="",g_delete_details.multi_carpark_ind="Y",g_delete_details.push(c)}g_delete_details.StartCanvas=g_start_canvas,g_delete_details.g_present_canvas=g_present_canvas,update_item_xy_distance("N",e,o,a)}logDebug("function : get_object_identity","E")}catch(e){error_handling(e)}}async function getJson(e,_,t,o,a,g,i,n,s="N",r="Y",l){logDebug("function : getJson; new_pog_ind : "+e+"; pog_version : "+t+"; recreate : "+o+"; create_json : "+a,"S");try{return new Promise((function(l,c){var d,p="N",m="N";"Y"==e?(d="GET_POG_JSON",p="N",$s(g_page_no+"OPEN_POG_CODE","")):"T"==e?(d="OPEN_TEMPLATE",p="N",$s(g_page_no+"OPEN_POG_CODE","")):(d="GET_EXISTING_POG",p="E");var f=-1;f="Y"==e?t:_,apex.server.process(d,{x01:f,x02:t},{dataType:"html"}).done((function(_){var c="Y",d=$.trim(_);try{g_json=JSON.parse($.trim(_))}catch{c="N"}if("N"==c)raise_error(d);else if(""!==d){if(g_json=JSON.parse($.trim(_)),"Y"==a?g_pog_json_data.push(JSON.parse(JSON.stringify(g_json[0]))):g_pog_json_data=g_pog_json,"undefined"!=typeof g_pog_json_data){!async function(){if("Y"==e){m=await get_draft_ind(f);let _=await loadDraftVersion(f);g_pog_json_data[g_pog_index].draftVersion=_,"Y"==e&&"Y"==m&&(p="E",e="N")}if(sessionStorage.setItem("new_pog_ind",e),sessionStorage.setItem("pog_opened",p),sessionStorage.setItem("POGExists","Y"),"Y"==r&&await setDefaultState(e),await create_module_from_json(g_pog_json_data,e,"F","N",p,"N","N",o,a,t,"Y",g,i,g_pog_index,n,s),"N"==e&&"Y"==m&&sessionStorage.setItem("new_pog_ind","Y"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&backupPog("F",-1,-1,g_pog_index),"Y"==g_compare_pog_flag&&"POG"!==g_compare_view)await recreate_compare_views(g_compare_view,"N");logDebug("function : getJson","E"),l("SUCCESS")}()}clearUndoRedoInfo(),g_dblclick_opened="N"}})),console.log("blockList",g_mod_block_list)}))}catch(e){error_handling(e)}try{if(Array.isArray(g_mod_block_list)&&g_mod_block_list.length>0)for(const e of g_mod_block_list)try{if(void 0===e.BlockDim||0===Object.keys(e.BlockDim).length){g_autofillModInfo=e.BlkModInfo||[],g_autofillShelfInfo=e.BlkShelfInfo||[];var c=await colorAutofillBlock(e.DragMouseStart,e.DragMouseEnd,e.mod_index,e.BlkColor,e.BlkName,"U",e,p_pog_index,"N");e.BlockDim=c}}catch(e){error_handling(e)}}catch(e){error_handling(e)}}async function get_json_data(e,_="N",t){logDebug("function : get_json_data; pog_code : "+e,"S"),g_ComBaseIndex=-1,g_ComViewIndex=-1,g_compare_pog_flag="N",g_compare_view="NONE",g_colorBackup="N",l_new_pog_ind="N";var o=[];g_pog_json_data=[];try{if("Y"==$v(g_page_no+"POGCR_VALIDATE_POG")&&1==e.length){init(0),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects),set_indicator_objects(g_scene_objects.length-1),g_pog_index=0;await getJson("Y","",e[0],"N","Y",g_camera,g_scene,0,_,t);g_dblclick_opened="N";await create_module_from_json(g_pog_json,sessionStorage.getItem("new_pog_ind"),"F","N",sessionStorage.getItem("pog_opened"),"Y","N","Y","N","","Y",g_camera,g_scene,g_pog_index,g_pog_index);animate_all_pog(),generateMultiPogDropdown(),$(".t-Body-actionsToggle").hasClass("is-active")&&(apex.region("draggable_table").widget().interactiveGrid("getActions").set("edit",!1),apex.region("draggable_table").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("draggable_table").refresh())}else{g_scene_objects=[],g_canvas_objects=[],appendMultiCanvasRowCol(e.length,$v(g_page_no+"POGCR_TILE_VIEW")),switchCanvasView($v(g_page_no+"POGCR_TILE_VIEW")),g_multi_pog_json=[],await setDefaultState("Y");for(var a=0;a<=e.length-1;a++){init(a),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects),g_seqArrDtl={},g_seqArrDtl.seqId=e[a],g_seqArrDtl.index=a,g_seqArrDtl.pogCode="",g_seqArrDtl.pogVersion="",g_seqArrDtl.pogType="D",g_seqArr.push(g_seqArrDtl),g_pog_index=a,set_indicator_objects(g_scene_objects.length-1);await getJson("Y","",e[a],"Y","Y",g_camera,g_scene,a,_,"Y",t);render(a);var g=g_canvas_objects[a].getAttribute("id");$("#"+g+"-btns").append('<span id="block_title" style="float:left">'+g_pog_json[a].POGCode+"</span>")}g_pog_json=g_multi_pog_json,generateMultiPogDropdown();await animate_all_pog();if($(".t-Body-actionsToggle").hasClass("is-active")&&(apex.region("draggable_table").widget().interactiveGrid("getActions").set("edit",!1),apex.region("draggable_table").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("draggable_table").refresh()),"Y"==_)await get_all_images(0,g_get_orient_images,"Y",$v(g_page_no+"POGCR_IMG_MAX_WIDTH"),$v(g_page_no+"POGCR_IMG_MAX_HEIGHT"),$v(g_page_no+"IMAGE_COMPRESS_RATIO"));if(g_ItemImages.length>0&&"Y"==g_show_live_image&&"Y"==_){var i=0;$(".live_image").addClass("live_image_active");for(const e of g_pog_json){try{g_renderer=g_scene_objects[i].renderer,g_scene=g_scene_objects[i].scene,g_camera=g_scene_objects[i].scene.children[0],g_world=g_scene_objects[i].scene.children[2];await recreate_image_items("Y",$v(g_page_no+"MERCH_STYLE"),$v(g_page_no+"POGCR_LOAD_IMG_FROM"),$v(g_page_no+"BU_ID"),$v(g_page_no+"POGCR_ITEM_NUM_LBL_COLOR"),$v(g_page_no+"POGCR_ITEM_NUM_LABEL_POS"),$v(g_page_no+"POGCR_DISPLAY_ITEM_INFO"),$v(g_page_no+"POGCR_DELIST_ITEM_DFT_COL"),$v(g_page_no+"NOTCH_HEAD"),i,g_show_days_of_supply,$v(g_page_no+"POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label)}catch(e){error_handling(e)}i++}g_imagesShown="Y",animate_all_pog()}var n=0;for(const e of g_pog_json)n>0&&await enableDisableFlags(n),n++;if(g_pog_index=0,g_scene_objects.length>0&&void 0!==g_scene_objects[g_pog_index]){void 0!==g_scene_objects[g_pog_index].Indicators&&(g_show_fixel_label=g_scene_objects[g_pog_index].Indicators.FixelLabel,g_show_item_label=g_scene_objects[g_pog_index].Indicators.ItemLabel,g_show_notch_label=g_scene_objects[g_pog_index].Indicators.NotchLabel,g_show_max_merch=g_scene_objects[g_pog_index].Indicators.MaxMerch,g_show_item_color=g_scene_objects[g_pog_index].Indicators.ItemColor,g_show_item_desc=g_scene_objects[g_pog_index].Indicators.ItemDesc,g_show_live_image=g_scene_objects[g_pog_index].Indicators.LiveImage,g_show_days_of_supply=g_scene_objects[g_pog_index].Indicators.DaysOfSupply,g_overhung_shelf_active=g_scene_objects[g_pog_index].Indicators.OverhungShelf,g_itemSubLabelInd=g_scene_objects[g_pog_index].Indicators.ItemSubLabelInd,g_itemSubLabel=g_scene_objects[g_pog_index].Indicators.ItemSubLabel);g=g_canvas_objects[g_pog_index].getAttribute("id");$("[data-pog]").removeClass("multiPogList_active"),$(".canvas_highlight").removeClass("canvas_highlight"),$("#"+g+"-btns").addClass("canvas_highlight"),$("[data-indx="+g_pog_index+"]").addClass("multiPogList_active"),g_all_pog_flag="N"}}var s=0;for(const e of g_pog_json){if(o=[],void 0!==g_pog_json[s].DeleteItems&&g_pog_json[s].DeleteItems.length>0){a=0;for(var r of g_pog_json[s].DeleteItems)o.push(r.Item),a++}void 0!==o&&(g_open_productlist="D"),s++}logDebug("function : get_json_data","E")}catch(e){error_handling(e)}}async function create_module_from_json(e,_,t,o,a,g,i,n,s,r,l,c,d,p,m,f="N",v="N",h=[]){try{if(load_orientation_json(),$("#LIVE_IMAGE").addClass("apex_disabled"),"Y"==$v(g_page_no+"POGCR_DFT_NOTCH_LABEL")&&(g_show_notch_label="Y"),"Y"==$v(g_page_no+"POGCR_DFT_FIXEL_LABEL")&&(g_show_fixel_label="Y"),"Y"==$v(g_page_no+"POGCR_SHOW_DFLT_ITEM_LOC")&&(g_show_item_label="Y"),console.log("create_module_from_json:start",{p_pog_index:p,g_canvas_objects_len:g_canvas_objects?g_canvas_objects.length:0,g_scene_objects_len:g_scene_objects?g_scene_objects.length:0,has_p_camera:void 0!==c,has_p_scene:void 0!==d}),await create_module_from_json_lib(e,_,t,o,a,n,s,$v(g_page_no+"VDATE"),$v(g_page_no+"POG_POG_DEFAULT_COLOR"),$v(g_page_no+"POG_MODULE_DEFAULT_COLOR"),r,!0,"N",null,$v(g_page_no+"POGCR_DFT_SPREAD_PRODUCT"),parseFloat($v(g_page_no+"PEGB_DFT_HORIZ_SPACING")),parseFloat($v(g_page_no+"PEGBOARD_DFT_VERT_SPACING")),parseFloat($v(g_page_no+"BASKET_DFT_WALL_THICKNESS")),parseFloat($v(g_page_no+"CHEST_DFT_WALL_THICKNESS")),$v(g_page_no+"POGCR_PEGB_MAX_ARRANGE"),$v(g_page_no+"POGCR_DEFAULT_WRAP_TEXT"),parseInt($v(g_page_no+"POGCR_TEXT_DEFAULT_SIZE")),$v(g_page_no+"POG_TEXTBOX_DEFAULT_COLOR"),$v(g_page_no+"POG_SHELF_DEFAULT_COLOR"),$v(g_page_no+"DIV_COLOR"),$v(g_page_no+"SLOT_DIVIDER"),$v(g_page_no+"SLOT_ORIENTATION"),$v(g_page_no+"DIVIDER_FIXED"),$v(g_page_no+"POG_ITEM_DEFAULT_COLOR"),$v(g_page_no+"POGCR_DELIST_ITEM_DFT_COL"),g_peg_holes_active,$v(g_page_no+"POG_CP_SHELF_DFLT_COLOR"),3,$v(g_page_no+"MERCH_STYLE"),$v(g_page_no+"POGCR_LOAD_IMG_FROM"),$v(g_page_no+"BU_ID"),$v(g_page_no+"POGCR_DELIST_ITEM_DFT_COL"),$v(g_page_no+"POGCR_ITEM_NUM_LBL_COLOR"),$v(g_page_no+"POGCR_DISPLAY_ITEM_INFO"),$v(g_page_no+"POGCR_ITEM_NUM_LBL_COLOR"),$v(g_page_no+"POGCR_ITEM_NUM_LABEL_POS"),$v(g_page_no+"NOTCH_HEAD"),"N",$v(g_page_no+"POGCR_DFT_BASKET_FILL"),$v(g_page_no+"POGCR_DFT_BASKET_SPREAD"),c,p,m,$v(g_page_no+"POGCR_NOTCH_START_VALUE"),$v(g_page_no+"POGCR_MANUAL_CRUSH_ITEM"),"Y",""),console.log("create_module_from_json:done",{p_pog_index:p,g_pog_json_len:g_pog_json?g_pog_json.length:0}),g_pog_json[p].MassUpdate="N",$("#"+g_page_no+"POG_SUBDEPT").on("apexafterrefresh",(function(){void 0!==g_pog_json[p]&&apex.item(this).setValue(g_pog_json[p].SubDept)})),$("#"+g_page_no+"POG_DEPT").on("apexafterrefresh",(function(){void 0!==g_pog_json[p]&&apex.item(this).setValue(g_pog_json[p].Dept)})),apex.item(g_page_no+"POG_DIVISION").setValue(g_pog_json[p].Division),"Y"==n){if("undefined"!=typeof g_pog_json&&g_pog_json.length>0&&backupPog("F",-1,-1,p),"N"==g&&"Y"==i){var u="E"==a?"E":"D",b={SeqNo:"",POGCode:g_pog_json[p].POGCode,POGVersion:g_pog_json[p].Version,POGModule:"",Selection_Type:u,Print_Type:"P",SequenceId:"",TemplateId:$v(g_page_no+"PDF_TEMPLATE").split("-")[0],TemplateDetails:$v(g_page_no+"PDF_TEMPLATE")};create_pdf(b,l,"N",c,u,$v(g_page_no+"POGCR_ITEM_NUM_LBL_COLOR"),$v(g_page_no+"POGCR_ITEM_NUM_LABEL_POS"),$v(g_page_no+"POGCR_DISPLAY_ITEM_INFO"),$v(g_page_no+"NOTCH_HEAD"),"Y",p,"Y",g_all_pog_flag,$v(g_page_no+"MERCH_STYLE"),$v(g_page_no+"POGCR_LOAD_IMG_FROM"),$v(g_page_no+"BU_ID"),$v(g_page_no+"POGCR_ITEM_NUM_LBL_COLOR"),$v(g_page_no+"POGCR_ITEM_NUM_LABEL_POS"),$v(g_page_no+"POGCR_DISPLAY_ITEM_INFO"),$v(g_page_no+"POGCR_DELIST_ITEM_DFT_COL"),"","",g_hide_show_dos_label,"",$v(g_page_no+"POGCR_ENHANCE_PDF_IMG"),$v(g_page_no+"POGCR_PDF_IMG_ENHANCE_RATIO"),$v(g_page_no+"POGCR_PDF_CANVAS_SIZE"),$v(g_page_no+"VDATE"),$v(g_page_no+"POG_POG_DEFAULT_COLOR"),$v(g_page_no+"POG_MODULE_DEFAULT_COLOR"),$v(g_page_no+"POGCR_DFT_SPREAD_PRODUCT"),$v(g_page_no+"PEGB_DFT_HORIZ_SPACING"),$v(g_page_no+"PEGBOARD_DFT_VERT_SPACING"),$v(g_page_no+"BASKET_DFT_WALL_THICKNESS"),$v(g_page_no+"CHEST_DFT_WALL_THICKNESS"),$v(g_page_no+"POGCR_PEGB_MAX_ARRANGE"),$v(g_page_no+"POGCR_DEFAULT_WRAP_TEXT"),$v(g_page_no+"POGCR_TEXT_DEFAULT_SIZE"),$v(g_page_no+"POG_TEXTBOX_DEFAULT_COLOR"),$v(g_page_no+"POG_SHELF_DEFAULT_COLOR"),$v(g_page_no+"DIV_COLOR"),$v(g_page_no+"SLOT_DIVIDER"),$v(g_page_no+"SLOT_ORIENTATION"),$v(g_page_no+"DIVIDER_FIXED"),$v(g_page_no+"POG_ITEM_DEFAULT_COLOR"),$v(g_page_no+"POGCR_DFT_BASKET_FILL"),$v(g_page_no+"POGCR_DFT_BASKET_SPREAD"),$v(g_page_no+"POGCR_BAY_LIVE_IMAGE"),$v(g_page_no+"POGCR_BAY_WITHOUT_LIVE_IMAGE"),"N")}$(".live_image").css("color","white").css("cursor","pointer"),$(".open_pdf").css("color","black").css("cursor","pointer"),$(".open_pdf_online").css("color","black").css("cursor","pointer")}if(g_ItemImages.length>0&&"Y"==g_show_live_image&&"Y"==n)try{if($(".live_image").addClass("live_image_active"),"N"==i&&"N"==o&&"N"==$v(g_page_no+"POGCR_DFT_ITEM_DESC")&&"N"==f){await recreate_image_items("Y",$v(g_page_no+"MERCH_STYLE"),$v(g_page_no+"POGCR_LOAD_IMG_FROM"),$v(g_page_no+"BU_ID"),$v(g_page_no+"POGCR_ITEM_NUM_LBL_COLOR"),$v(g_page_no+"POGCR_ITEM_NUM_LABEL_POS"),$v(g_page_no+"POGCR_DISPLAY_ITEM_INFO"),$v(g_page_no+"POGCR_DELIST_ITEM_DFT_COL"),$v(g_page_no+"NOTCH_HEAD"),p,g_show_days_of_supply,$v(g_page_no+"POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label);g_imagesShown="Y"}}catch(e){error_handling(e)}"N"==g_isPogItemsSet&&set_pog_page_items(p),"Y"==g_show_item_color?$(".item_color_legends").css("display","block"):$(".item_color_legends").css("display","none");var I=0;for(const e of g_pog_json[p].ModuleInfo){if(void 0===e.ParentModule||null==e.ParentModule){var x=0;for(const _ of e.ShelfInfo){if("TEXTBOX"==_.ObjType){var j=g_world.getObjectById(g_pog_json[p].ModuleInfo[I].ShelfInfo[x].SObjID);void 0!==j&&(j.ShelfInfo=g_pog_json[p].ModuleInfo[I].ShelfInfo[x],textboxPriorityPlacing(j,p,g_pog_json[p].ModuleInfo[I].ShelfInfo[x].Z))}x++}}I++}}catch(e){error_handling(e)}return"SUCCESS"}async function update_module_block_list(e,_,t="N"){var o={},a=[],g=[],i=[],n=[],s={},r=$v(g_page_no+"BLK_NAME")+"_AFP";if("Y"==t){var l=[];for(const e of g_mod_block_list){(x={}).BlkColor=e.BlkColor,x.BlkName=e.BlkName,x.BlkRule=e.BlkRule,x.BlkFilters=e.BlockFilters.join(" AND "),x.OldBlkName=e.BlkName,e.BlkFilters=x.BlkFilters,l.push(x)}closeInlineDialog("block_details");await save_blk_dtl_coll(e,_,l)}else{n=_==r&&"U"==e?[]:[r],o.BlkName=r,o.BlkColor=$v(g_page_no+"BLK_COLOR"),o.BlkRule=$v(g_page_no+"BLK_RULE");var c=[],d=[],p=[];if("U"!==e){var m=-1;for(const e of g_delete_details)"TEXTBOX"!==e.ObjType&&(c.push(e),m!==e.MIndex&&d.push(e.MIndex),e.BlkName=o.BlkName,m=e.MIndex);if(d.sort(),g_mod_block_list.length>0)for(const e of c){var f=!0;for(const _ of g_mod_block_list){if(!f)break;for(const t of _.g_delete_details)if(e.MIndex==t.MIndex&&e.SIndex==t.SIndex){f=!1;break}}f&&p.push(e)}else p=c}else{for(const e of g_mod_block_list)if(e.BlkName==_){p=e.g_delete_details,d=e.mod_index,o.DragMouseStart=e.DragMouseStart,o.DragMouseEnd=e.DragMouseEnd;break}for(const e of p)e.BlkName=o.BlkName;g_DragMouseStart=o.DragMouseStart,g_DragMouseEnd=o.DragMouseEnd}o.g_delete_details=p;var v=apex.region("block_filters").widget().interactiveGrid("getViews","grid").model;v.forEach((function(e){var _="object"==typeof v.getValue(e,"FILTER")?v.getValue(e,"FILTER").v:v.getValue(e,"FILTER"),t=v.getValue(e,"VALUE");if(i.push(_+"#"+t),""!==_){var o=_.split("-");g.push(o[0]),a.push(o[0]+" = "+("C"==o[1]?'"':"")+t+("C"==o[1]?'"':""))}}));for(const e of g_mod_block_list)n.push(e.BlkName);var h=findDuplicates(n),u=findDuplicates(g);if(h.length>0)alert(get_message("POGCR_BLK_DUP"));else if(u.length>0)alert(get_message("POGCR_DUP_REC_FOUND"));else if(!g.includes("SUBCLASS")||g.includes("CLASS")&&g.includes("DEPT"))if(g.includes("CLASS")&&!g.includes("DEPT"))alert(get_message("POGCR_DEPT_MANDATE"));else{if(o.BlockFilters=a,o.FilterVal=i,o.mod_index=d,"U"==e){for(const e of g_mod_block_list)if(e.BlkName==_)for(const t of e.BlockDim.ColorObj.children)if(t.uuid==_){e.BlockDim.ColorObj.remove(t);break}var b=0;for(const e of g_mod_block_list)e.BlkName==_&&(s=JSON.parse(JSON.stringify(e)),g_mod_block_list.splice(b,1)),b++}apex.region("block_filters").widget().interactiveGrid("getActions").set("edit",!1),apex.region("block_filters").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("block_filters").refresh(),clear_blinking();var I=await colorAutofillBlock(g_DragMouseStart,g_DragMouseEnd,d,$v(g_page_no+"BLK_COLOR"),r,e,s,g_pog_index,"N");if(o.BlockDim=I,g_mod_block_list.push(o),closeInlineDialog("block_details"),"U"==e){l=[];for(const e of g_mod_block_list){if(e.BlkName!==r&&e.BlkName!==_)(x={}).BlkColor=e.BlkColor,x.BlkName=e.BlkName,x.BlkRule=e.BlkRule,x.BlkFilters=e.BlockFilters.join(" AND "),x.OldBlkName=e.BlkName,e.BlkFilters=x.BlkFilters,l.push(x);else if(e.BlkName==_||e.BlkName==r){(x={}).BlkColor=$v(g_page_no+"BLK_COLOR"),x.BlkName=r,x.BlkRule=$v(g_page_no+"BLK_RULE"),x.BlkFilters=a.join(" AND "),x.OldBlkName=_,e.BlkFilters=x.BlkFilters,l.push(x)}}await save_blk_dtl_coll(e,_,l)}else if("Y"==e||"A"==e){l=[];for(const e of g_mod_block_list){var x;(x={}).BlkColor=e.BlkColor,x.BlkName=e.BlkName,x.BlkRule=e.BlkRule,x.BlkFilters=e.BlockFilters.join(" AND "),e.BlkFilters=x.BlkFilters,l.push(x)}await save_blk_dtl_coll(e,_,l)}}else alert(get_message("POGCR_DEPT_CLASS_MANDATE"))}}function open_blk_details(e,_){console.log(e),$s(g_page_no+"EDIT_BLK",e),g_autofill_edit="Y"==_?"Y":"N";var t=apex.region("block_filters").widget().interactiveGrid("getViews","grid").model;for(const n of g_mod_block_list)if(n.BlkName==e){$s(g_page_no+"BLK_NAME",n.BlkName.slice(0,-4)),$s(g_page_no+"BLK_COLOR",n.BlkColor),$s(g_page_no+"BLK_RULE",n.BlkRule);var o,a=apex.region("block_filters"),g=a.call("getCurrentView");if("N"==_){if(n.FilterVal.length>0){var i=0;for(const e of n.FilterVal)"grid"===g.internalIdentifier&&(o=a.widget().find(".a-GV-row").last(),g.view$.grid("setSelection",o),a.call("getActions").invoke("selection-add-row")),i++}i=0;t.forEach((function(e){if(console.log(n.FilterVal[i],e),void 0!==n.FilterVal[i]){var _=n.FilterVal[i].split("#");t.setValue(e,"FILTER",`${_[0]}`),t.setValue(e,"VALUE",`${_[1]}`)}i++}))}else t.clearChanges(),apex.region("block_filters").refresh();$("#ADD_BLK").css("display","none"),$("#SAVE_BLK").css("display","none"),$("#UPDATE_BLK").css("display","inline"),g_auto_fill_reg_open="N",openInlineDialog("block_details",40,65);break}}function clear_blinking(){if(g_intersected){for(var e=0;e<g_intersected.length;e++)g_select_color=g_intersected[e].BorderColour,g_intersected[e].WireframeObj.material.color.setHex(g_intersected[e].BorderColour),"Y"==g_intersected[e].ImageExists&&"Y"==g_show_live_image&&(g_intersected[e].WireframeObj.material.transparent=!0,g_intersected[e].WireframeObj.material.opacity=.0025);clearInterval(g_myVar),g_select_color=0,render(g_pog_index),g_intersected=[],g_select_zoom_arr=[]}}function add_pog_code_header(){$("#canvas-holder #block_title").remove();for(var e=0;e<g_scene_objects.length;e++){var _=g_canvas_objects[e].getAttribute("id");$("#"+_+"-btns").append('<span id="block_title" style="float:left">'+g_pog_json[e].POGCode+"</span>")}}function closePog(e,_){0==_?(g_scene_objects_backup.splice(e,1),g_pogjson_backup.splice(e,1),g_pogjson_data_backup.splice(e,1),generateCanvasListHolder(g_pogjson_backup)):confirm(get_message("POGCR_CLOSE_POG_WARN"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){g_scene_objects.splice(e,1),g_pog_json.splice(e,1),g_pog_json_data.splice(e,1),appendMultiCanvasRowCol(g_scene_objects.length,$v(g_page_no+"POGCR_TILE_VIEW")),modifyWindowAfterMinMax(g_scene_objects),e==g_ComViewIndex&&"Y"==g_compare_pog_flag?(g_compare_view="NONE",g_compare_pog_flag="N",g_edit_pallet_mod_ind=-1,g_edit_pallet_shelf_ind=-1,g_ComViewIndex=-1,g_ComBaseIndex=-1,g_comp_view_code="",g_comp_base_code=""):reset_compare_index(e),add_pog_code_header(),generateMultiPogDropdown(),g_pog_json.length>0&&(g_pog_index=0,set_select_canvas(g_pog_index))}))}function delete_blk_details(e){confirm(get_message("SHCT_DELETE_CONFIRM_MSG"),get_global_ind_values("AI_CONFIRM_OK_TEXT"),get_global_ind_values("AI_CONFIRM_CANCEL_TEXT"),(function(){!async function(){var _=0;for(const t of g_mod_block_list){if(t.BlkName==e){for(const _ of t.BlockDim.ColorObj.children)if(_.uuid==e){t.BlockDim.ColorObj.remove(_);break}g_mod_block_list.splice(_,1);break}_++}render(g_pog_index),await save_blk_dtl_coll("D",e,[]),closeInlineDialog("block_details"),g_autofill_edit="N",apex.event.trigger(g_page_no+"POG_RULE","apexrefresh"),"P25_"==g_page_no?(apex.theme.openRegion("auto_fill_reg"),g_auto_fill_reg_open="Y"):apex.region("mod_block_details").refresh()}()}))}async function show_view_analysis(e,_){logDebug("function : show_view_analysis; p_pog_code : "+e+"; pog_version : "+_,"S");try{var t="number"==typeof g_pog_index&&g_pog_index>-1?g_pog_index:0,o=JSON.parse(JSON.stringify(g_pog_json))[t];if(void 0===o)return;g_scene_objects=[],g_canvas_objects=[];let e=g_pog_json[0];g_pog_json.push(e),await appendCanvasForGraph(),init(0);var a={};a.scene=g_scene,a.renderer=g_renderer,g_scene_objects.push(a),g_world=g_scene_objects[0].scene.children[2],g_camera=g_scene_objects[0].scene.children[0],await create_module_from_json([o],"N","F","N","E","N","N","Y","Y",o.Version,"Y",g_scene_objects[0].scene.children[0],g_scene_objects[0].scene,0,0),render(0),g_ComViewIndex=-1;var g,i=document.getElementById("maincanvas2-container");i.insertAdjacentHTML("beforeend",'<div style="padding:10px; height:100%; box-sizing:border-box; display:flex; flex-direction:column;">\n                <div style="flex:1 1 auto; min-height:0;">\n                    <canvas id="analysisChart_1" style="width:100%;height:100%;display:block;"></canvas>\n                </div>\n            </div>'),(g=i.querySelector(".canvasregion")).remove(),(g=i.querySelector(".canvasregion"))&&g.remove();const _=document.getElementById("analysisChart_1").getContext("2d");new Chart(_,{type:"line",data:{labels:["Module 1","Module 2","Module 3","Module 4"],datasets:[{label:"Sales Performance",data:[120,190,300,150],backgroundColor:["#4e73df","#1cc88a","#36b9cc","#f6c23e"]}]},options:{responsive:!0,plugins:{title:{display:!0,text:"Chart.js Line Chart - Cubic interpolation mode"}},interaction:{intersect:!1},scales:{x:{display:!0,title:{display:!0}},y:{display:!0,title:{display:!0,text:"Value"},suggestedMin:-10,suggestedMax:200}}}})}catch(e){error_handling(e)}finally{logDebug("function : show_view_analysis","E")}}async function appendCanvasForGraph(){g_windowHeight=window.innerHeight-167,$("#canvas-holder .container").css("height",g_windowHeight+"px");var e=$("#canvas-holder .container").height(),_=$("#canvas-holder .container").width();$("#canvas-holder .container").html(""),$("#canvas-holder .container").addClass("h-view").removeClass("v-view"),$("#canvas-holder .container").append('<div class="row" data-row="1"></div>');for(var t=0;t<=1;t++){var o=0==t?"":t+1,a="maincanvas"+o,g='<div class="canvas-buttons" id="maincanvas'+o+'-btns" ><span class="fa fa-close canvas-close" onClick="closePog('+t+')"></span><span class="fa fa-window-maximize canvas-max" onClick="maximizePog('+t+')"></span><span class="fa fa-minus canvas-min" onClick="minimizePog('+t+')"></span></div>';if($('[data-row="1"]').append('<div class="canvas-content" id="maincanvas'+o+'-container" data-col="'+t+'1" style="height:'+parseFloat(e.toFixed(2))+"px;width:"+parseFloat((_/2).toFixed(2))+'px">'+g+'<canvas class="canvasregion" data-canvas=true id="maincanvas'+o+'" ></canvas></div>'),0==t)try{var i=document.getElementById(a);i&&(i.setAttribute("data-indx",0),-1===g_canvas_objects.indexOf(i)&&g_canvas_objects.push(i))}catch(e){error_handling(err)}}makeResizableRow()}function doMouseDown(e,_,t,o,a,g,i,n){logDebug("function : doMouseDown; x : "+e+"; y : "+_+"; startX : "+t+"; startY : "+o+"; context_call : "+i,"S");try{if(g_scene_objects.length>0){var s=document.getElementById("t_Header"),r=document.getElementById("t_Body_title"),l=document.getElementById("top_bar"),c=document.getElementById("t_Body_nav"),d=document.getElementById("wpdSplitter_splitter_first"),p=document.querySelector(".wtbar"),m=window.devicePixelRatio;g_start_pixel_ratio=m;var f=$(document).scrollTop(),v=$(".t-Region-body").scrollLeft(),h=s.offsetHeight,u=r.offsetHeight,b=l.offsetHeight,I=p.offsetHeight,x=(c.offsetWidth,d.offsetWidth),j=parseFloat($(".t-Body-contentInner").css("padding-left").replace("px",""))*m;g_global_counter+=1,g_start_coorX=t,g_start_coorY=o,g_taskItemInContext=!0,g_taskItemInContext1=!0,"N"==i&&(g_selection.style.visibility="hidden");var O={},C={};void 0!==g_scene_objects[g_pog_index]&&g_scene_objects.length>0&&(O=g_scene_objects[g_pog_index].scene.children[0],C=g_scene_objects[g_pog_index].scene.children[2]);for(var D=[],w=0,E=g_undo_final_obj_arr.length;w<E;w++)g_undo_final_obj_arr[w][0].length>0&&void 0!==g_undo_final_obj_arr[w][0][0]&&void 0===g_undo_final_obj_arr[w][0][0].CurrCanvas&&D.push(g_undo_final_obj_arr[w]);g_undo_final_obj_arr=D;for(D=[],w=0,E=g_redo_final_obj_arr.length;w<E;w++)void 0!==g_redo_final_obj_arr[w][0][0]&&void 0===g_redo_final_obj_arr[w][0][0].CurrCanvas&&D.push(g_redo_final_obj_arr[w]);g_redo_final_obj_arr=D,g_curr_canvas=g_pog_index,g_start_canvas=g_pog_index,reset_indicators(),"Y"==g_show_item_color&&(g_pog_json[n].GroupingType=g_scene_objects[g_pog_index].Indicators.canvas_color_flag,$s("P193_SELECT_COLOR_TYPE",g_scene_objects[g_pog_index].Indicators.canvas_color_flag));var y=g.width,S=g.height,P=2*e/y-1,N=1-2*_/S;if(g_carpark_item_flag="N",g_carpark_edit_flag="N",g_module_edit_flag="N",g_shelf_edit_flag="N",g_item_edit_flag="N",g_module_index=-1,g_shelf_index=-1,g_module_cnt=-1,g_item_index=-1,g_module_width=-1,comp_obj_id=-1,g_module_X="",g_shelf_max_merch="",g_shelf_basket_spread="",render(g_pog_index),O.updateProjectionMatrix(),g_raycaster.setFromCamera(new THREE.Vector2(P,N),O),g_intersects=g_raycaster.intersectObjects(C.children),$s("P193_SELECTED_CANVAS",`${g_curr_canvas}`),0==g_intersects.length){if(g_mselect_drag="N",g_multiselect="N",g_ctrl_select="N",g_delete_details=[],g_intersected&&g_intersected.length>0){for(w=0;w<g_intersected.length;w++)void 0!==g_intersected[w]&&(void 0!==g_intersected[w].BorderColour&&(g_select_color=g_intersected[w].BorderColour),g_intersected[w].WireframeObj.material.color.setHex(g_intersected[w].BorderColour),"Y"==g_intersected[w].ImageExists&&"Y"==g_show_live_image&&(g_intersected[w].WireframeObj.material.transparent=!0,g_intersected[w].WireframeObj.material.opacity=.0025));clearInterval(g_myVar),g_select_color=0,render(g_pog_index)}if(C.add(g_targetForDragging),g_targetForDragging.position.set(0,0,0),render(g_pog_index),g_intersects=g_raycaster.intersectObjects(C.children),g_intersects.length>0){var M=g_intersects[0].point.x,T=g_intersects[0].point.y;g_drag_z=g_intersects[0].point.z,g_drag_z+=.001;var L=new THREE.Vector3(M,T,Y);C.worldToLocal(L);P=Math.min(19,Math.max(-19,L.x)),_=Math.min(19,Math.max(-19,L.y));if("N"==i&&(g_DragMouseStart.x=P,g_DragMouseStart.y=_,g_DragMouseEnd.x=P,g_DragMouseEnd.y=_),g_startMouse.x=a.clientX+v-(x+j),g_startMouse.y=a.clientY+f-(u+j+h+b+I),g_prevMouse.x=P,g_prevMouse.y=_,g_nextMouse=g_prevMouse.clone(),C.remove(g_targetForDragging),g_intersected=[],g_select_zoom_arr=[],"N"!=g_context_opened||a.shiftKey)return!(!a.shiftKey||"Y"!=g_manual_zoom_ind)||("Y"!=g_context_opened||a.shiftKey||(g_mselect_drag="N",g_context_opened="N"),!1);var k=g_startMouse.x,R=g_startMouse.y;return g_selecting=!0,g_selection.style.left=g_startMouse.x+"px",g_selection.style.top=g_startMouse.y+"px",g_selection.style.width=k-g_startMouse.x+"px",g_selection.style.height=R-g_startMouse.y+"px",g_selection.style.visibility="visible",!0}return g_intersected=[],g_select_zoom_arr=[],!1}if(g_intersects.length>0){if("drag_object"==g_intersects[0].object.uuid){var B=g_intersects[1];g_objectHit=B.object;M=g_intersects[1].point.x;g_mousedown_locx=g_intersects[1].point.x;T=g_intersects[1].point.y;var Y=g_intersects[1].point.z;g_drag_z=g_intersects[1].point.z}else{B=g_intersects[0];g_objectHit=B.object;M=g_intersects[0].point.x;g_mousedown_locx=g_intersects[0].point.x;T=g_intersects[0].point.y,Y=g_intersects[0].point.z;g_drag_z=g_objectHit.position.z}L=new THREE.Vector3(M,T,Y);C.worldToLocal(L);P=Math.min(19,Math.max(-19,L.x)),g_drag_z;g_drag_z+=.001,g_itemDragZ=g_objectHit.position.z,g_itemDragX=g_objectHit.position.x;_=Math.min(19,Math.max(-19,L.y));g_objectHit_uuid=g_objectHit.uuid,g_objectHit_id=g_objectHit.id,w=0;var A,F="N";if("Y"==g_multiselect||"Y"==g_ctrl_select){for(const e of g_delete_details)e.ObjID==g_objectHit_id&&(F="Y");"Y"==F&&(update_item_xy_distance("Y",n,P,_),g_mselect_drag="Y")}else g_mselect_drag="N";if(get_object_identity(g_pog_index,g_multiselect,g_multi_copy_done,P,_),"N"==i&&"N"==g_ctrl_select&&(g_multiselect="N"),-1!==g_module_index&&-1!==g_shelf_index&&update_item_distance(g_module_index,g_shelf_index,g_pog_index),g_intersects.length>0&&"N"==i&&"Y"!==g_mselect_drag){if(0==a.altKey){if(g_intersected&&g_intersected[0]!=g_intersects[0].object)for(w=0;w<g_intersected.length;w++)void 0!==g_intersected[w]&&(void 0!==g_intersected[w].BorderColour&&(g_select_color=g_intersected[w].BorderColour),g_intersected[w].WireframeObj.material.color.setHex(g_intersected[w].BorderColour),"Y"==g_intersected[w].ImageExists&&"Y"==g_show_live_image&&(g_intersected[w].WireframeObj.material.transparent=!0,g_intersected[w].WireframeObj.material.opacity=.0025));g_intersected=[],g_select_zoom_arr=[],g_intersected.push(g_objectHit)}else if(1==a.altKey&&(g_select_zoom_arr.push(g_objectHit),g_intersected.push(g_objectHit),"Y"==g_item_edit_flag||"Y"==g_shelf_edit_flag)){var G=g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index],H=g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index];add_ctrl_select_items("Y"==g_shelf_edit_flag?"S":"I","Y"==g_shelf_edit_flag?{}:G,H,g_module_index,g_shelf_index,g_item_index,g_pog_json[n].ModuleInfo[g_module_index].MObjID,g_objectHit_id,n),g_ctrl_select="Y",g_multiselect="Y",g_multiItemCopy="Y"}render_animate_selected()}else if(g_intersected){for(w=0;w<g_intersected.length;w++)void 0!==g_intersected[w]&&(g_select_color=g_intersected[w].BorderColour,g_intersected[w].WireframeObj.material.color.setHex(g_intersected[w].BorderColour),"Y"!=g_intersected[w].ImageExists||"Y"!=g_show_live_image&&"Y"!=g_show_live_image_comp||(g_intersected[w].WireframeObj.material.transparent=!0,g_intersected[w].WireframeObj.material.opacity=.0025));clearInterval(g_myVar),g_select_color=0,render(g_pog_index)}if(g_pog_index==g_ComViewIndex){if("POG"!==g_compare_view&&"undefined"!=typeof comp_obj_id&&"PREV_VERSION"!==g_compare_view&&"EDIT_PALLET"!==g_compare_view)void 0!==(W=g_scene_objects[g_ComBaseIndex].scene.children[2].getObjectById(comp_obj_id))&&g_intersected.push(W),clearInterval(g_myVar),g_select_color=0,render_animate_selected();else if("POG"==g_compare_view||"PREV_VERSION"==g_compare_view&&0==a.altKey||"EDIT_PALLET"==g_compare_view){var V=get_similar_items(g_objectHit_uuid,"I",g_ComBaseIndex);if(g_intersected=[],V.length>0){for(w=0;w<V.length;w++)g_intersected.push(V[w]);clearInterval(g_myVar),g_select_color=0,render_animate_selected()}}}else if(("Y"==g_module_edit_flag||"Y"==g_shelf_edit_flag||"Y"==g_item_edit_flag)&&g_ComViewIndex>-1&&0==a.altKey)if("POG"!==g_compare_view&&"undefined"!=typeof comp_obj_id&&"Y"==g_compare_pog_flag){if(g_scene_objects[g_ComViewIndex].scene.children[2].children.length>0){var W=g_scene_objects[g_ComViewIndex].scene.children[2].getObjectById(comp_obj_id);g_intersected=[],void 0!==W&&g_intersected.push(W),clearInterval(g_myVar),g_select_color=0,render_animate_selected()}}else if("Y"==g_item_edit_flag){V=get_similar_items(g_objectHit_uuid,"I",g_ComViewIndex);if(g_intersected=[],V.length>0){for(w=0;w<V.length;w++)g_intersected.push(V[w]);clearInterval(g_myVar),g_select_color=0,render_animate_selected()}}if(g_drag_x=g_module_X,"Y"==g_shift_mutli_item_select&&-1!==g_item_index)(A="Y"==g_carpark_item_flag?g_pog_json[n].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index]:g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index]).isCarpark=g_carpark_item_flag,$.isEmptyObject(g_shift_multi_item_first)?g_shift_multi_item_first=A:g_shift_multi_item_last=A;if(-1!==g_shelf_index&&-1!==g_module_index)update_item_distance(g_module_index,g_shelf_index,g_pog_index);if(render(g_pog_index),0===nvl(g_pog_json)||"PREV_VERSION"===g_compare_view||"Y"!=g_item_edit_flag&&"Y"!=g_shelf_edit_flag||backupPog("S",g_shelf_index,g_module_index,g_pog_index),"Y"==g_carpark_edit_flag||"Y"==g_shelf_edit_flag&&g_pog_index==g_ComViewIndex&&"EDIT_PALLET"==g_compare_view)return!1;if(g_pog_index==g_ComViewIndex&&"EDIT_PALLET"!==g_compare_view&&"PREV_VERSION"!==g_compare_view)return!1;if("Y"==g_module_edit_flag||-1!==g_module_obj_array.indexOf(g_objectHit)||g_objectHit_uuid.match(/BASE.*/)||g_objectHit_uuid.match(/NOTCH.*/)){if("N"==g_auto_fill_active)a.ctrlKey&&"Y"==g_module_edit_flag?(context_copy("S",n),g_duplicating="Y"):a.ctrlKey&&"Y"==g_item_edit_flag&&(context_copy("S",n),g_duplicating="Y",g_dupShelfDepth=g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].D);else if("Y"==g_auto_fill_active&&g_mod_block_list.length>0){var U=function(e){try{if("undefined"==typeof g_raycaster)return!1;for(const a of g_mod_block_list)if(a.BlkName===e){var _=a.BlockDim&&a.BlockDim.ColorObj?a.BlockDim.ColorObj:null;if(!_)return!1;var t=_.getObjectByProperty("uuid",e);if(!t)return!1;var o=g_raycaster.intersectObject(t,!0);return o&&o.length>0}}catch(e){return!1}return!1};for(colorObj of g_mod_block_list)if(colorObj.mod_index[0]==g_module_index&&U(colorObj.BlkName)){var z=colorObj.BlkName,X=colorObj.BlockDim.ColorObj;return g_dragItem=X.getObjectByProperty("uuid",z),!0}}if("N"==g_context_opened){g_startMouse.x=a.clientX+v-(x+j),g_startMouse.y=a.clientY-(u+j+h+b+I),g_prevMouse.x=P,g_prevMouse.y=_,g_nextMouse=g_prevMouse.clone(),g_DragMouseStart.x=P,g_DragMouseStart.y=_,g_DragMouseEnd.x=P,g_DragMouseEnd.y=_;k=g_startMouse.x+1,R=g_startMouse.y+1;if(a.shiftKey||(g_selecting=!0,g_selection.style.left=g_startMouse.x+"px",g_selection.style.top=g_startMouse.y+"px",g_selection.style.width=k-g_startMouse.x+"px",g_selection.style.height=R-g_startMouse.y+"px",g_selection.style.visibility="visible"),g_intersected){for(w=0;w<g_intersected.length;w++)void 0!==g_intersected[w]&&(g_select_color=g_intersected[w].BorderColour,g_intersected[w].WireframeObj.material.color.setHex(g_intersected[w].BorderColour),"Y"==g_intersected[w].ImageExists&&"Y"==g_show_live_image&&(g_intersected[w].WireframeObj.material.transparent=!0,g_intersected[w].WireframeObj.material.opacity=.0025));clearInterval(g_myVar),g_select_color=0,render(g_pog_index),g_intersected=[],g_select_zoom_arr=[]}if(g_select_zoom_arr.push(g_objectHit),g_intersected.push(g_objectHit),g_pog_index==g_ComViewIndex&&"Y"==g_module_edit_flag&&"undefined"!=typeof comp_obj_id)void 0!==(W=g_scene_objects[g_ComViewIndex].scene.children[2].getObjectById(comp_obj_id))&&g_intersected.push(W);else if("Y"==g_module_edit_flag&&"Y"==g_compare_pog_flag&&"undefined"!=typeof comp_obj_id){if(g_scene_objects[g_ComViewIndex].scene.children[2].children.length>0)void 0!==(W=g_scene_objects[n].scene.children[2].getObjectById(comp_obj_id))&&g_intersected.push(W)}else if(g_objectHit_uuid.match(/BASE.*/)&&"Y"==g_compare_pog_flag&&void 0!==g_pog_json[n].CompBaseObjID){void 0!==(W=g_scene_objects[g_ComViewIndex].scene.children[2].getObjectById(g_pog_json[n].CompBaseObjID))&&g_intersected.push(W)}return render_animate_selected(),!0}return!1}if("N"==g_auto_fill_active){if(g_dragItem=g_objectHit,"N"==g_chest_move&&"CHEST"==g_shelf_object_type&&"Y"==g_shelf_edit_flag&&"Y"==g_chest_as_pegboard){g_startMouse.x=a.clientX+v-(x+j),g_startMouse.y=a.clientY-(u+j+h+b+I),g_prevMouse.x=P,g_prevMouse.y=_,g_nextMouse=g_prevMouse.clone(),g_DragMouseStart.x=P,g_DragMouseStart.y=_,g_DragMouseEnd.x=P,g_DragMouseEnd.y=_;k=g_startMouse.x+1,R=g_startMouse.y+1;a.shiftKey||(g_selecting=!0,g_selection.style.left=g_startMouse.x+"px",g_selection.style.top=g_startMouse.y+"px",g_selection.style.width=k-g_startMouse.x+"px",g_selection.style.height=R-g_startMouse.y+"px",g_selection.style.visibility="visible")}else{if("Y"==g_shelf_edit_flag&&"DIVIDER"!==g_shelf_object_type&&"TEXTBOX"!==g_shelf_object_type){g_dragItem.ShelfInfo=g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index],g_dragItem.StartCanvas=g_start_canvas,g_dragItem.MIndex=g_module_index,g_dragItem.SIndex=g_shelf_index;var K=0;for(const e of g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo){void 0!==(W=C.getObjectById(e.ObjID))&&("PEGBOARD"!==g_shelf_object_type?W.Distance=e.Distance:(W.PegBoardX=e.PegBoardX,W.PegBoardY=e.PegBoardY),W.ItemInfo=e,W.IIndex=K,W.StartCanvas=g_start_canvas,W.MIndex=g_module_index,W.SIndex=g_shelf_index,g_drag_items_arr.push(W)),K++}}else"Y"==g_item_edit_flag?(g_dragItem.ItemInfo=g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index],g_dragItem.MIndex=g_module_index,g_dragItem.SIndex=g_shelf_index,g_dragItem.IIndex=g_item_index,g_dragItem.StartCanvas=g_start_canvas):"Y"==g_shelf_edit_flag&&(g_dragItem.ShelfInfo=g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index],g_dragItem.StartCanvas=g_start_canvas,g_dragItem.MIndex=g_module_index,g_dragItem.SIndex=g_shelf_index);a.ctrlKey&&"Y"==g_shelf_edit_flag?(context_copy("S",n),g_duplicating="Y",render_animate_selected()):a.ctrlKey&&"Y"==g_item_edit_flag&&(context_copy("S",n),g_duplicating="Y",g_dupShelfDepth=g_pog_json[n].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].D,render_animate_selected())}if("N"==i)return!0}}else if(g_intersected){for(w=0;w<g_intersected.length;w++)void 0!==g_intersected[w]&&(g_select_color=g_intersected[w].BorderColour,g_intersected[w].WireframeObj.material.color.setHex(g_intersected[w].BorderColour),"Y"==g_intersected[w].ImageExists&&"Y"==g_show_live_image&&(g_intersected[w].WireframeObj.material.transparent=!0,g_intersected[w].WireframeObj.material.opacity=.0025));clearInterval(g_myVar),g_select_color=0,render(g_pog_index),g_intersected=[],g_select_zoom_arr=[]}logDebug("function : doMouseDown","E")}}catch(e){error_handling(e)}}"function"!=typeof window.reset_canvas_region&&(window.reset_canvas_region=async function(){try{"undefined"==typeof g_show_plano_rate&&(g_show_plano_rate="N"),"undefined"==typeof g_open_productlist&&(g_open_productlist="Y"),$("#par_region").length>0&&$("#draggable_table").length>0&&("N"==g_show_plano_rate||"Y"==g_open_productlist?($("#par_region").hide(),$("#draggable_table").show(),$("#wpdSplitter_splitter_second").css("overflow","hidden"),"Collapse"==$(".a-Splitter-thumb").attr("aria-label")&&null!==apex.region("draggable_table").widget()&&(apex.region("draggable_table").widget().interactiveGrid("getActions").set("edit",!1),apex.region("draggable_table").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("draggable_table").widget().interactiveGrid("getViews").grid.curInst._refreshGrid())):($("#draggable_table").hide(),$("#par_region").show(),$("#wpdSplitter_splitter_second").css("scrollbar-width","thin").css("overflow","auto")),"Collapse"!==$(".a-Splitter-thumb").attr("aria-label")&&(g_show_plano_rate="N",g_open_productlist="Y"));var e=$v(g_page_no+"POGCR_TILE_VIEW");switchCanvasView(""==e?"V":e,"Y")}catch(e){error_handling(e)}});