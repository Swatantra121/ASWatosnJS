var g_item_vertical_text_display=$v("P53_ITEM_CODE_VERT_ALN"),g_item_text_center_align=$v("P53_ITEM_CODE_CTR_ALN");function setUpMouseHander(e,_,t,o,s,n){try{if("string"==typeof e&&(e=document.getElementById(e)),!e||!e.addEventListener)throw"first argument in setUpMouseHander is not a valid element";var a,g;document.addEventListener("mousemove",(function(e){if(_){var t=document.getElementById("maincanvas"),o=g_pog_json;void 0!==g_scene_objects[n]?(new_camera=g_scene_objects[n].scene.children[0],new_world=g_scene_objects[n].scene.children[2]):(new_camera=g_camera,new_world=g_world);var s=t.getBoundingClientRect(),i=(s.height,e.clientX-s.left),r=e.clientY-s.top;_(i,r,e,a,g,t,o,"#maincanvas",n)}a=i,g=r})),s.domElement.addEventListener("mousedown",(function(e){if(!g_dragging&&1==window.event.which){g_taskItemInContext=clickInsideElement(e,"canvasregion"),g_taskItemInContext1=clickInsideElement(e,"canvasregion1"),g_taskItemInContext?g_canvas=document.getElementById("maincanvas"):g_canvas=document.getElementById("maincanvas1");var _=g_canvas.getBoundingClientRect(),o=_.left,s=_.top,i=e.clientX-_.left,r=e.clientY-_.top;a=i,g=r,g_dragging=t(i,r,o,s,e,g_canvas,"N",n)}})),s.domElement.addEventListener("mouseup",(function(e){if(g_dragging){g_taskItemInContext=clickInsideElement(e,"canvasregion"),g_taskItemInContext1=clickInsideElement(e,"canvasregion1");var _=[],t={};if(g_taskItemInContext?(g_canvas=document.getElementById("maincanvas"),_=g_pog_json,void 0!==g_scene_objects[n]?(t=g_scene_objects[n].scene.children[0],g_scene_objects[n].scene.children[2]):(t=g_camera,g_world)):(g_canvas=document.getElementById("maincanvas1"),_=g_pog_json_comp,t=g_camera_comp,g_world_comp),o){var s=g_canvas.getBoundingClientRect(),i=e.clientX-s.left,r=e.clientY-s.top;o(i,r,e,a,g,g_canvas,t,_,n)}g_dragging=!1}}))}catch(e){error_handling(e)}}function init(){try{g_canvas_region=document.getElementById("drawing_region"),g_selection=document.getElementById("selection"),g_renderer=new THREE.WebGLRenderer({canvas:g_canvas,antialias:!0}),g_canvas_objects.push(g_canvas)}catch(e){return void(document.getElementById("canvas-holder").innerHTML="<p><b>Sorry, an error occurred:<br>"+e+"</b></p>")}createWorld(),g_raycaster=new THREE.Raycaster,render(),multiselect="N",ctrl_select="N",g_windowHeight=window.innerHeight,windowWidth=window.innerWidth,setUpMouseHander("maincanvas",doMouseMove,doMouseDown,doMouseUp,g_renderer,g_pog_index),g_tanFOV=Math.tan(Math.PI/180*g_camera.fov/2),g_windowHeight=window.innerHeight,windowWidth=window.innerWidth,g_initial_windowHeight=window.innerHeight,g_camera.aspect=windowWidth/g_windowHeight,g_camera.fov=360/Math.PI*Math.atan(g_tanFOV*(g_windowHeight/g_initial_windowHeight)),g_camera.updateProjectionMatrix(),g_renderer.render(g_scene,g_camera),window.addEventListener("resize",onWindowResize,!1),onWindowResize("F")}function onWindowResize(e){try{g_windowHeight=window.innerHeight,windowWidth=window.innerWidth,g_camera.aspect=windowWidth/g_windowHeight,g_camera.fov=360/Math.PI*Math.atan(g_tanFOV*(g_windowHeight/g_initial_windowHeight)),g_renderer.setSize(windowWidth,g_windowHeight),g_camera.updateProjectionMatrix(),g_renderer.render(g_scene,g_camera)}catch(e){error_handling(e)}}async function create_module_from_json(e,_,t,o,s,n,a,g,i,r){try{if($("#LIVE_IMAGE").addClass("apex_disabled"),console.log("g_show_live_image",g_show_live_image),"Y"==$v("P53_POGCR_DFT_NOTCH_LABEL")&&(g_show_notch_label="Y"),"Y"==$v("P53_POGCR_DFT_FIXEL_LABEL")&&(g_show_fixel_label="Y"),"Y"==$v("P53_POGCR_SHOW_DFLT_ITEM_LOC")&&(g_show_item_label="Y"),await load_orientation_json(),await create_module_from_json_lib(e,_,t,o,s,g,i,$v("P53_VDATE"),$v("P53_POG_DEFAULT_COLOR"),$v("P53_MODULE_DEFAULT_COLOR"),null,!1,"N",null,$v("P53_POGCR_DFT_SPREAD_PRODUCT"),parseFloat($v("P53_PEGBOARD_DFT_HORZ_SPC")),parseFloat($v("P53_PEGBOARD_DFT_VERT_SPC")),parseFloat($v("P53_BASKET_WALL_THICK")),parseFloat($v("P53_CHEST_WALL_THICK")),$v("P53_POGCR_PEG_ITEM_AUTO_PLACE"),$v("P53_POGCR_DEFAULT_WRAP_TEXT"),parseInt($v("P53_POGCR_TEXT_DEFAULT_SIZE")),$v("P53_POG_TEXTBOX_DEFAULT_COLOR"),$v("P53_SHELF_DEFAULT_COLOR"),$v("P53_DIV_COLOR"),$v("P53_SLOT_DIVIDER"),$v("P53_SLOT_ORIENTATION"),$v("P53_DIVIDER_FIXED"),$v("P53_ITEM_DFT_COLOR"),$v("P53_POGCR_DELIST_ITEM_DFT_COLOR"),"Y",null,1,$v("P53_MERCH_STYLE"),$v("P53_POGCR_LOAD_IMG_FROM"),$v("P53_BU_ID"),$v("P53_POGCR_DELIST_ITEM_DFT_COLOR"),$v("P53_POGCR_ITEM_NUM_LBL_COLOR"),$v("P53_POGCR_DISPLAY_ITEM_INFO"),$v("P53_POGCR_ITEM_NUM_LBL_COLOR"),$v("P53_POGCR_ITEM_NUM_LABEL_POS"),$v("P53_NOTCH_HEAD"),"N",$v("P53_POGCR_DFT_BASKET_FILL"),$v("P53_POGCR_DFT_BASKET_SPREAD"),g_camera,r,null,$v("P53_POGCR_NOTCH_START_VALUE"),"N","Y","N"),await get_all_images(r,"N","N",$v("P53_POGCR_IMG_MAX_WIDTH"),$v("P53_POGCR_IMG_MAX_HEIGHT"),$v("P53_IMAGE_COMPRESS_RATIO")),console.log('$v("P53_POGCR_DFT_ITEM_DESC")',$v("P53_POGCR_DFT_ITEM_DESC"),g_ItemImages.length,$v("P53_POGCR_DFLT_LIVE_IMAGES"),g_show_live_image),("Y"==$v("P53_POGCR_DFT_ITEM_DESC")||0==g_ItemImages.length&&"Y"==$v("P53_POGCR_DFLT_LIVE_IMAGES"))&&(await showHideItemDescription("Y",$v("P53_ITEM_DFT_COLOR"),$v("P53_POGCR_DISPLAY_ITEM_INFO"),r),g_show_item_desc="Y","Y"==$v("P53_POGCR_DFT_ITEM_DESC")?g_show_live_image="N":g_show_live_image="Y"),$("#LIVE_IMAGE").removeClass("apex_disabled"),g_ItemImages.length>0&&"N"==a&&"Y"==$v("P53_POGCR_DFLT_LIVE_IMAGES")&&"N"==$v("P53_POGCR_DFT_ITEM_DESC"))try{g_show_live_image="Y",await recreate_image_items("Y",$v("P53_MERCH_STYLE"),$v("P53_POGCR_LOAD_IMG_FROM"),$v("P53_BU_ID"),$v("P53_POGCR_ITEM_NUM_LBL_COLOR"),$v("P53_POGCR_ITEM_NUM_LABEL_POS"),$v("P53_POGCR_DISPLAY_ITEM_INFO"),$v("P53_POGCR_DELIST_ITEM_DFT_COL"),$v("P53_NOTCH_HEAD"),r,"N","",$v("P53_POGCR_ITEM_DETAIL_LIST"))}catch(e){console.log("load images problem",e)}else if("N"==$v("P53_POGCR_DFT_ITEM_DESC")&&"Y"==$v("P53_POGCR_DFT_DAYS_OF_SUPPLY"))showHideDaysOfSupplyLabel("Y","N",r,"Y","N",$v("P53_POGCR_FONTSIZE_DAYSOFSUPP"),$v("P53_POGCR_ITEM_DETAIL_LIST"));animate_pog(0);var l=get_min_max_xy(r).split("###");set_camera_z(g_scene_objects[r].scene.children[0],parseFloat(l[2]),parseFloat(l[3]),parseFloat(l[0]),parseFloat(l[1]),g_offset_z,parseFloat(l[4]),parseFloat(l[5]),r),render(),"Y"==n&&removeLoadingIndicator(regionloadWait)}catch(e){error_handling(e)}return"SUCCESS"}function doMouseMove(e,_,t,o,s,n,a,g,r){try{var l=n.width/window.devicePixelRatio,d=n.height/window.devicePixelRatio,c=2*e/l-1,m=1-2*_/d,I=$(document).scrollTop(),p=$(".t-Region-body").scrollLeft();g_camera.updateProjectionMatrix(),g_raycaster.setFromCamera(new THREE.Vector2(c,m),g_camera),void 0!==g_scene_objects[r]?g_intersects=g_raycaster.intersectObjects(g_scene_objects[r].scene.children[2].children):g_intersects=g_raycaster.intersectObjects(g_world.children);var u=$(document),f=$(window),D=$("#object_info"),O=D.offset(),h=O.top-u.scrollTop(),E=(f.height(),D.height(),O.left-u.scrollLeft());f.width(),D.width();g_mouse.x=t.clientX+p-20,g_mouse.y=t.clientY+I;var M=g_startMouse.x,v=g_mouse.x,P=g_startMouse.y,b=g_mouse.y;if(M>v){var x=M;M=v,v=x}if(P>b){var j=P;P=b,b=j}if(g_dragging){g_raycaster.setFromCamera(new THREE.Vector2(c,m),g_camera),g_intersects=g_raycaster.intersectObject(g_targetForDragging);g_drag_z;var T=g_intersects[0].point.x,y=g_intersects[0].point.y,S=g_intersects[0].point.z,C=new THREE.Vector3(T,y,S);g_scene_objects[r].scene.children[2].worldToLocal(C),c=Math.min(19,Math.max(-19,C.x)),_=Math.min(19,Math.max(-19,C.y)),g_selecting&&(g_multiselect="Y",g_DragMouseEnd.x=c,g_DragMouseEnd.y=_,g_selection.style.left=M+"px",g_selection.style.top=P+"px",g_selection.style.width=v-M-5+"px",g_selection.style.height=b-P-5+"px",console.log("g_selection.style.left",g_selection.style.left,g_selection.style.top,g_selection.style.width)),g_DragMouseEnd.x=c,g_DragMouseEnd.y=_}else g_selecting&&(g_selecting=!1,g_selection.style.visibility="hidden");var L=document.getElementById("object_info");$("#object_info").contents().filter((function(){return 3==this.nodeType})).remove();var R="",w=0,F=[],A=" | ";if(g_intersects.length>0&&void 0!==g_intersects[0].object.ItemID&&""!==g_intersects[0].object.ItemID&&"DIVIDER"!==g_intersects[0].object.ItemID){var N=$v("P53_POGCR_ITEM_DESC_LIST").split(":");for(i=0;i<N.length;i++){var H=0;A=i>0?" | ":"";"ITEM"==N[i]&&(R=R+A+get_message("ITEM_ID")+': <span style="color:yellow">'+g_intersects[0].object.ItemID+"</span>",H=(" | "+get_message("ITEM_ID")+": "+g_intersects[0].object.ItemID).visualLength("ruler")),"UPC"==N[i]&&(R=R+A+get_message("POGCR_REP_TEMP_HEAD_BARCODE")+': <span style="color:yellow">'+g_intersects[0].object.Barcode+"</span>",H=(" | "+get_message("POGCR_REP_TEMP_HEAD_BARCODE")+": "+g_intersects[0].object.Barcode).visualLength("ruler")),"DESC"==N[i]&&(R=R+A+get_message("DESCRIPTION")+': <span style="color:yellow">'+g_intersects[0].object.Description+"</span>",H=(" | "+get_message("DESCRIPTION")+": "+g_intersects[0].object.Description).visualLength("ruler")),"BRAND"==N[i]&&(R=R+A+get_message("POGCR_BRAND")+': <span style="color:yellow">'+g_intersects[0].object.Brand+"</span>",H=(" | "+get_message("POGCR_BRAND")+": "+g_intersects[0].object.Brand).visualLength("ruler")),"GROUP"==N[i]&&(R=R+A+get_message("POGCR_GROUP_LBL")+': <span style="color:yellow">'+g_intersects[0].object.Group+"</span>",H=(" | "+get_message("POGCR_GROUP_LBL")+": "+g_intersects[0].object.Group).visualLength("ruler")),"DEPT"==N[i]&&(R=R+A+get_message("POGCR_TEMP_HEAD_DEPARTMENT")+': <span style="color:yellow">'+g_intersects[0].object.Dept+"</span>",H=(" | "+get_message("POGCR_TEMP_HEAD_DEPARTMENT")+": "+g_intersects[0].object.Dept).visualLength("ruler")),"CLASS"==N[i]&&(R=R+A+get_message("POGCR_CLASS_LBL")+': <span style="color:yellow">'+g_intersects[0].object.Class+"</span>",H=(" | "+get_message("POGCR_CLASS_LBL")+": "+g_intersects[0].object.Class).visualLength("ruler")),"SUBCLASS"==N[i]&&(R=R+A+get_message("POGCR_SUBCLASS_LBL")+': <span style="color:yellow">'+g_intersects[0].object.SubClass+"</span>",H=(" | "+get_message("POGCR_SUBCLASS_LBL")+": "+g_intersects[0].object.SubClass).visualLength("ruler")),"ITEM_SIZE"==N[i]&&(R=R+A+get_message("POGCR_ITEMSIZE_LBL")+': <span style="color:yellow">'+g_intersects[0].object.SizeDesc+"</span>",H=(" | "+get_message("POGCR_ITEMSIZE_LBL")+": "+g_intersects[0].object.SizeDesc).visualLength("ruler")),"SUPPLIER"==N[i]&&(R=R+A+get_message("POGCR_REP_HEAD_SUPPLIERS")+': <span style="color:yellow">'+g_intersects[0].object.Supplier+"</span>",H=(" | "+get_message("POGCR_REP_HEAD_SUPPLIERS")+": "+g_intersects[0].object.Supplier).visualLength("ruler")),"WIDTH"==N[i]&&(R=R+A+get_message("POGCR_WIDTH_LBL")+': <span style="color:yellow">'+(100*g_intersects[0].object.OW).toFixed(2)+"</span>",H=(" | "+get_message("POGCR_WIDTH_LBL")+": "+(100*g_intersects[0].object.OW).toFixed(2)).visualLength("ruler")),"HEIGHT"==N[i]&&(R=R+A+get_message("POGCR_HEIGHT_LBL")+': <span style="color:yellow">'+(100*g_intersects[0].object.OH).toFixed(2)+"</span>",H=(" | "+get_message("POGCR_HEIGHT_LBL")+": "+(100*g_intersects[0].object.OH).toFixed(2)).visualLength("ruler")),"DEPTH"==N[i]&&(R=R+A+get_message("POGCR_DEPTH_LBL")+': <span style="color:yellow">'+(100*g_intersects[0].object.OD).toFixed(2)+"</span>",H=(" | "+get_message("POGCR_DEPTH_LBL")+": "+(100*g_intersects[0].object.OD).toFixed(2)).visualLength("ruler")),"STORE"==N[i]&&(R=R+A+get_message("POGCR_STORE_LBL")+': <span style="color:yellow">'+g_intersects[0].object.StoreCnt+"</span>",H=(" | "+get_message("POGCR_STORE_LBL")+": "+g_intersects[0].object.StoreCnt).visualLength("ruler")),"ITEM_DIM"==N[i]&&(R=R+A+get_message("POGCR_ITEM_DIM_LBL")+': <span style="color:yellow">'+g_intersects[0].object.ItemDim+"</span>",H=(" | "+get_message("POGCR_ITEM_DIM_LBL")+": "+g_intersects[0].object.ItemDim).visualLength("ruler")),"POSITION"==N[i]&&(R=R+A+get_message("POGCR_POSITION_LBL")+': <span style="color:yellow">'+g_intersects[0].object.LocID+"</span>",H=(" | "+get_message("POGCR_POSITION_LBL")+": "+g_intersects[0].object.LocID).visualLength("ruler")),"SHELF"==N[i]&&(R=R+A+get_message("POGCR_SHELF_LBL")+': <span style="color:yellow">'+g_intersects[0].object.Shelf+"</span>",H=(" | "+get_message("POGCR_SHELF_LBL")+": "+g_intersects[0].object.Shelf).visualLength("ruler")),"ORIENTATION"==N[i]&&(R=R+A+get_message("POGCR_ORIENTATION_LBL")+': <span style="color:yellow">'+g_intersects[0].object.OrientationDesc+"</span>",H=(" | "+get_message("POGCR_ORIENTATION_LBL")+": "+g_intersects[0].object.OrientationDesc).visualLength("ruler")),"DEPTH_FACING"==N[i]&&(R=R+A+get_message("POGCR_DEPTH_FACING_LBL")+': <span style="color:yellow">'+g_intersects[0].object.DFacing+"</span>",H=(" | "+get_message("POGCR_DEPTH_FACING_LBL")+": "+g_intersects[0].object.DFacing).visualLength("ruler")),"HORIZ_FACING"==N[i]&&(R=R+A+get_message("TEMP_HEAD_HORIZ_FACING")+': <span style="color:yellow">'+g_intersects[0].object.HorizFacing+"</span>",H=(" | "+get_message("TEMP_HEAD_HORIZ_FACING")+": "+g_intersects[0].object.HorizFacing).visualLength("ruler")),"VERT_FACING"==N[i]&&(R=R+A+get_message("TEMP_HEAD_VERT_FACING")+': <span style="color:yellow">'+g_intersects[0].object.VertFacing+"</span>",H=(" | "+get_message("TEMP_HEAD_VERT_FACING")+": "+g_intersects[0].object.VertFacing).visualLength("ruler")),"SELLING_PRICE"==N[i]&&(R=R+A+get_message("SELLING_PRICE_LBL")+': <span style="color:yellow">'+parseFloat(g_intersects[0].object.SellingPrice).toFixed(2)+"</span>",H=(" | "+get_message("SELLING_PRICE_LBL")+": "+g_intersects[0].object.SellingPrice).visualLength("ruler")),"SALES_UNIT"==N[i]&&(R=R+A+get_message("SALES_UNIT_LBL")+': <span style="color:yellow">'+parseFloat(g_intersects[0].object.SalesUnit).toFixed(2)+"</span>",H=(" | "+get_message("SALES_UNIT_LBL")+": "+g_intersects[0].object.SalesUnit).visualLength("ruler")),"NET_SALES"==N[i]&&(R=R+A+get_message("NET_SALES_LBL")+': <span style="color:yellow">'+parseFloat(g_intersects[0].object.NetSales).toFixed(2)+"</span>",H=(" | "+get_message("NET_SALES_LBL")+": "+g_intersects[0].object.NetSales).visualLength("ruler")),"PROFIT"==N[i]&&(R=R+A+get_message("PROFIT_LBL")+': <span style="color:yellow">'+parseFloat(g_intersects[0].object.Profit).toFixed(2)+"</span>",H=(" | "+get_message("PROFIT_LBL")+": "+g_intersects[0].object.Profit).visualLength("ruler")),"TOTAL_MARGIN"==N[i]&&(R=R+A+get_message("POGCR_TOTAL_MARGIN")+': <span style="color:yellow">'+parseFloat(g_intersects[0].object.TotalMargin).toFixed(2)+"</span>",H=(" | "+get_message("POGCR_TOTAL_MARGIN")+": "+g_intersects[0].object.TotalMargin).visualLength("ruler")),(w+=H)>1300&&(R+="<br>",F.push(w),w=0)}}else if(g_intersects.length>0&&void 0!==g_intersects[0].object.FixelID&&""!==g_intersects[0].object.FixelID){var G=void 0!==a[r].Version&&null!==a[r].Version?a[r].Version:"",Y="",B=A+get_message("POGCR_POG_VERSION")+': <span style="color:yellow">'+G+" </span> ";R=R+get_message("POGCR_POG_CODE")+': <span style="color:yellow">'+a[r].POGCode+" </span> "+B+Y+A+get_message("POGCR_POG_MOD")+': <span style="color:yellow">'+g_intersects[0].object.Module+" </span> "+A+get_message("POGCR_FIXEL_ID")+': <span style="color:yellow">'+g_intersects[0].object.FixelID+"</span>",L.classList.add("active")}else if(g_intersects.length>0&&void 0!==g_intersects[0].object.Module&&""!==g_intersects[0].object.Module){G=void 0!==a[r].Version&&null!==a[r].Version?a[r].Version:"",Y="",B=A+get_message("POGCR_POG_VERSION")+': <span style="color:yellow">'+G+" </span> ";R=R+get_message("POGCR_POG_CODE")+': <span style="color:yellow">'+a[r].POGCode+" </span> "+B+Y+A+get_message("POGCR_POG_MOD")+': <span style="color:yellow">'+g_intersects[0].object.Module+"</span>",L.classList.add("active")}else if(void 0!==a&&a.length>0){G=void 0!==a[r].Version&&null!==a[r].Version?a[r].Version:"",Y="",B=A+get_message("POGCR_POG_VERSION")+': <span style="color:yellow">'+G+" </span> ";R=R+get_message("POGCR_POG_CODE")+': <span style="color:yellow">'+a[r].POGCode+" </span> "+B+Y,L.classList.add("active")}else L.classList.remove("active");if(g_intersects.length>0)if(void 0!==g_intersects[0].object.ItemID&&""!==g_intersects[0].object.ItemID&&"DIVIDER"!==g_intersects[0].object.ItemID){d=R.visualHeight("ruler")+12;var W=N.length>7?150:50;if(F.length>0)l=Math.max.apply(Math,F)+W;else l=R.visualLength("ruler")+W}else d=R.visualHeight("ruler")+7,l=R.visualLength("ruler")+50;else d=R.visualHeight("ruler")+7,l=R.visualLength("ruler")+50;$("#object_info").html(R),L.style.top=window.innerHeight-D.height()-15+"px",L.style.width=l+"px",L.style.height=d+"px",L.style.fontSize="large",L.style.fontFamily="Tahoma",L.style.left="0px"}catch(e){error_handling(e)}}function get_textbox_z(e,_,t,o,s,n,a){try{var g=t-s/2,i=t+s/2,r=o+n/2,l=o-n/2,d=g_pog_json[a].ModuleInfo,c="N",m=0;for(const e of d){if("Y"==c)break;if(void 0===e.ParentModule||null==e.ParentModule){var I=e.ShelfInfo;for(const e of I){if("Y"==c)break;if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType)if(e.ItemInfo.length>0){var p=e.ItemInfo;for(const _ of p){var u=_.X-_.W/2,f=_.X+_.W/2,D=_.Y+_.H/2,O=_.Y-_.H/2;if(g>=u&&g<f&&(r>O&&r<=D||l>=O&&l<D)||i>u&&i<=f&&(r>O&&r<=D||l>=O&&l<D)||g<u&&i>f&&(r>O&&r<=D||l>=O&&l<D)){c="Y",m=g_pog_json[a].BackDepth/2+e.D+.005;break}if(g>=u&&g&&r>D&&l<O||i>u&&i<=f&&r>D&&l<O){c="Y",m=g_pog_json[a].BackDepth/2+e.D+.005;break}1}}else{u=e.X-e.W/2,f=e.X+e.W/2,D=e.Y+e.H/2,O=e.Y-e.H/2;if(g>=u&&g<f&&(r>O&&r<=D||l>=O&&l<D)||i>u&&i<=f&&(r>O&&r<=D||l>=O&&l<D)||g<u&&i>f&&(r>O&&r<=D||l>=O&&l<D)){c="Y",m=g_pog_json[a].BackDepth/2+e.D+.005;break}if(g>=u&&g&&r>D&&l<O||i>u&&i<=f&&r>D&&l<O){c="Y",m=g_pog_json[a].BackDepth/2+e.D+.005;break}}1}}1}return"N"==c&&g_pog_json[a].ModuleInfo[e].ShelfInfo[_].Y-g_pog_json[a].ModuleInfo[e].ShelfInfo[_].H/2<=0?m=g_pog_json[a].BackDepth/2+.005+g_pog_json[a].BaseD:"N"==c&&(m=g_pog_json[a].BackDepth/2+.005),parseFloat(m.toFixed(3))}catch(e){error_handling(e)}}async function set_scene(e,_,t,o,s,n,a,g,i,r,l,d,c,m,I,p,u="N",f="",D,O,h,E){logDebug("function : set_scene; template_id : "+e+"; save_pdf : "+_+"; notch_label : "+t+"; fixel_label : "+o+"; item_label : "+s+"; pdf_lang : "+n+"; save_pog : "+a+"; mime_type : "+g+"; new_item_label : "+i,"S");get_curr_canvas(),get_canvas_world("LABEL");var M=[];render();console.log(" before base64 ",getDateTime()),console.log(" before base64 ",getDateTime());var v=[];if("Y"==(U=D.split("###"))[0]){if("Y"==U[1]){v=await create_combine_pog($v("P53_POGCR_BAY_LIVE_IMAGE"),"Y","N",$v("P53_VDATE"),$v("P53_MODULE_DEFAULT_COLOR"),$v("P53_MODULE_DEFAULT_COLOR"),$v("P53_POGCR_DFT_SPREAD_PRODUCT"),parseFloat($v("P53_PEGBOARD_DFT_HORZ_SPC")),parseFloat($v("P53_PEGBOARD_DFT_VERT_SPC")),parseFloat($v("P53_BASKET_WALL_THICK")),parseFloat($v("P53_CHEST_WALL_THICK")),"N","N",parseInt($v("P53_POGCR_TEXT_DEFAULT_SIZE")),$v("P53_POG_TEXTBOX_DEFAULT_COLOR"),"#3D393D","","N","","N","#FFFFFF",$v("P53_POGCR_DELIST_ITEM_DFT_COL"),$v("P53_MERCH_STYLE"),$v("P53_POGCR_LOAD_IMG_FROM"),$v("P53_BU_ID"),$v("P53_POGCR_ITEM_NUM_LBL_COLOR"),$v("P53_POGCR_DISPLAY_ITEM_INFO"),$v("P53_POGCR_ITEM_NUM_LABEL_POS"),$v("P53_NOTCH_HEAD"),$v("P53_POGCR_DFT_BASKET_FILL"),$v("P53_POGCR_DFT_BASKET_SPREAD"),0,O,h,E);for(const e of v)M.push(e)}if(void 0!==U[2]&&""!==U[2]){v=await create_combine_pog($v("P53_POGCR_BAY_WITHOUT_LIVE_IMAGE"),"N",U[2],$v("P53_VDATE"),$v("P53_POG_DEFAULT_COLOR"),$v("P53_MODULE_DEFAULT_COLOR"),$v("P53_POGCR_DFT_SPREAD_PRODUCT"),parseFloat($v("P53_PEGBOARD_DFT_HORZ_SPC")),parseFloat($v("P53_PEGBOARD_DFT_VERT_SPC")),parseFloat($v("P53_BASKET_WALL_THICK")),parseFloat($v("P53_CHEST_WALL_THICK")),"N","N",parseInt($v("P53_POGCR_TEXT_DEFAULT_SIZE")),$v("P53_POG_TEXTBOX_DEFAULT_COLOR"),"#3D393D","","N","","N","#FFFFFF",$v("P53_POGCR_DELIST_ITEM_DFT_COL"),$v("P53_MERCH_STYLE"),$v("P53_POGCR_LOAD_IMG_FROM"),$v("P53_BU_ID"),$v("P53_POGCR_ITEM_NUM_LBL_COLOR"),$v("P53_POGCR_DISPLAY_ITEM_INFO"),$v("P53_POGCR_ITEM_NUM_LABEL_POS"),$v("P53_NOTCH_HEAD"),$v("P53_POGCR_DFT_BASKET_FILL"),$v("P53_POGCR_DFT_BASKET_SPREAD"),0,O,h,E);for(const e of v)M.push(e)}}else{var P;g_pog_json.length>1?(P=await get_full_canvas(I),reset_zoom()):P=g_canvas_objects[I];var b=P.toDataURL("image/jpeg",.5);console.log(" after  base64 ",getDateTime()),(q={Module:"POG"}).ImgData=b.match(/,(.*)$/)[1],M.push(q)}var x=JSON.parse(JSON.stringify(g_pog_json));if("xlsx"==g)await save_pog_to_json(g_pog_json);if("Y"==g_textbox_merge_pdf)x=await merge_textboxes_pdf(x,I);var j=0,T=0;for(const e of x[I].ModuleInfo)void 0!==e.ParentModule&&null!=e.ParentModule||T++;var y=JSON.parse(JSON.stringify(g_pog_json)),S=[],C=0;if("Y"==g_pogcr_pdf_chest_split){for(const e of x[I].ModuleInfo){if(void 0===e.ParentModule||null==e.ParentModule){var L=0,R=parseFloat((e.X-e.W/2).toFixed(4)),w=parseFloat((e.X+e.W/2).toFixed(4));for(const _ of e.ShelfInfo){if("CHEST"==_.ObjType){var F=parseFloat((_.X-_.W/2).toFixed(4)),A=parseFloat((_.X+_.W/2).toFixed(4));(R>F&&w<A||R<F&&w<A&&w>F||R>F&&w>A&&R<A)&&(_.MIndex=C,_.SIndex=L,S.push(_),x[I].ModuleInfo[C].ShelfInfo.splice(L,1),g_pog_json[I].ModuleInfo[C].ShelfInfo.splice(L,1))}L++}}C++}for(chest of S){var N=parseFloat((chest.X-chest.W/2).toFixed(4)),H=parseFloat((chest.X+chest.W/2).toFixed(4)),G=chest.ItemInfo,Y=0;for(const e of x[I].ModuleInfo){if(void 0===e.ParentModule||null==e.ParentModule){var $="N",B=parseFloat((e.X-e.W/2).toFixed(4)),W=parseFloat((e.X+e.W/2).toFixed(4)),X=JSON.parse(JSON.stringify(chest));B>N&&W<H?($="Y",X.W=e.W,X.X=e.X):B<N&&W<H&&W>N?($="Y",X.W=parseFloat((W-N).toFixed(4)),X.X=parseFloat((N+X.W/2).toFixed(4))):B>N&&W>H&&B<H&&($="Y",X.W=parseFloat((H-B).toFixed(4)),X.X=parseFloat((B+X.W/2).toFixed(4)));var V=[],z=parseFloat((X.X-X.W/2).toFixed(4)),k=parseFloat((X.X+X.W/2).toFixed(4));for(items of G)items.X>=z&&items.X<=k&&V.push(items);V.sort((function(e,_){return parseInt(e.LocID)-parseInt(_.LocID)})),X.ItemInfo=V,"Y"==$&&(x[I].ModuleInfo[Y].ShelfInfo.push(X),g_pog_json[I].ModuleInfo[Y].ShelfInfo.push(X))}Y++}}}j=0;for(const e of x[I].ModuleInfo){if(void 0===e.ParentModule||null==e.ParentModule){"undefined"!=typeof g_renderer_pdf&&null!==g_renderer_pdf&&""!==g_renderer_pdf&&(g_renderer_pdf.forceContextLoss(),g_renderer_pdf.context=null,g_renderer_pdf.domElement=null,g_renderer_pdf=null),init_pdf(300,400,3,"N","Y");try{await create_scene(j,i,r,T,m,$v("P53_POGCR_ITEM_NUM_LBL_COLOR"),$v("P53_POGCR_ITEM_NUM_LABEL_POS"),"",I)}catch(e){error_handling(e)}var U,Z=(U=get_min_max_xy_module(e,j,e.W,e.H,e.X,x[I].W,T,I)).split("###"),[K,J]=set_camera_z_offside(g_camera_pdf,parseFloat(Z[2]),parseFloat(Z[3]),parseFloat(Z[0]),parseFloat(Z[1]),g_offset_z,0,parseFloat(Z[5]),I);g_camera_pdf.position.x=parseFloat(Z[2]),g_camera_pdf.position.y=J-.09,g_camera_pdf.position.z=K,null!==g_renderer_pdf&&(animate_pog_pdf(),g_renderer_pdf.render(g_scene_pdf,g_camera_pdf));var q;b=await g_new_canvas.toDataURL("image/jpeg",.5);(q={}).Module=e.Module,q.ImgData=b.match(/,(.*)$/)[1],M.push(q)}j+=1}for(const e of x[I].ModuleInfo)if(void 0===e.ParentModule||null==e.ParentModule)for(const _ of e.ShelfInfo)if("TEXTBOX"==_.ObjType){var Q=g_scene_objects[g_pog_index].scene.children[2].getObjectById(_.SObjID);void 0!==Q&&(Q.material.transparent=!0)}render(),console.log("mod_arr",M),await send_to_db(x[I].POGCode,M),console.log("finished sending"),logDebug("function : Download PDF","S"),apex.server.process("DOWNLOAD_PDF",{x01:e.SeqNo,x02:e.POGCode,x03:e.POGVersion,x04:e.Selection_Type,x05:e.Print_Type,x06:e.TemplateId,x07:e.SequenceId,x08:_,x09:e.POGModule,p_clob_01:JSON.stringify(x)},{dataType:"html"}).done((function(e){g_pog_json=y,g_show_fixel_label="Y"==o?"Y":"N",g_show_item_label="Y"==s?"Y":"N",g_show_notch_label="Y"==t?"Y":"N",g_show_item_desc="Y"==d?"Y":"N";var _="f?p="+$v("pFlowId")+":"+$v("pFlowStepId")+":"+$v("pInstance")+":APPLICATION_PROCESS=OPEN_PDF:NO::AI_RANDOM_STRING:"+(new Date).getTime();removeLoadingIndicator(regionloadWait),window.open(_,"new data"),async function(){if(console.log("item_desc",d,r,c,m),"N"==d&&"Y"==r)showHideItemDescription("N",$v("P53_ITEM_DFT_COLOR"),$v("P53_POGCR_DISPLAY_ITEM_INFO"),I);else if("Y"==d&&"N"==r)showHideItemDescription("Y",$v("P53_ITEM_DFT_COLOR"),$v("P53_POGCR_DISPLAY_ITEM_INFO"),I);if("N"==c&&"Y"==m)await recreate_image_items("N",$v("P53_MERCH_STYLE"),$v("P53_POGCR_LOAD_IMG_FROM"),$v("P53_BU_ID"),$v("P53_POGCR_ITEM_NUM_LBL_COLOR"),$v("P53_POGCR_ITEM_NUM_LABEL_POS"),$v("P53_POGCR_DISPLAY_ITEM_INFO"),$v("P53_POGCR_DELIST_ITEM_DFT_COL"),$v("P53_NOTCH_HEAD"),I,"N","",$v("P53_POGCR_ITEM_DETAIL_LIST"));else if("Y"==c&&"N"==m&&"N"==d)await recreate_image_items("Y",$v("P53_MERCH_STYLE"),$v("P53_POGCR_LOAD_IMG_FROM"),$v("P53_BU_ID"),$v("P53_POGCR_ITEM_NUM_LBL_COLOR"),$v("P53_POGCR_ITEM_NUM_LABEL_POS"),$v("P53_POGCR_DISPLAY_ITEM_INFO"),$v("P53_POGCR_DELIST_ITEM_DFT_COL"),$v("P53_NOTCH_HEAD"),I,"N","",$v("P53_POGCR_ITEM_DETAIL_LIST"));show_notch_labels(g_show_notch_label,$v("P435_NOTCH_HEAD"),"Y",I),show_fixel_labels(g_show_fixel_label,I),show_item_labels(g_show_item_label,$v("P435_POGCR_ITEM_NUM_LBL_COLOR"),$v("P435_POGCR_ITEM_NUM_LABEL_POS"),I)}(),"undefined"!=typeof g_renderer_pdf&&null!==g_renderer_pdf&&""!==g_renderer_pdf&&(g_renderer_pdf.forceContextLoss(),g_renderer_pdf.context=null,g_renderer_pdf.domElement=null,g_renderer_pdf=null)})),logDebug("function : set_scene","E")}async function doMouseUp(e,_,t,o,s,n,a,g,i){logDebug("function : doMouseUp; x : "+e+"; y : "+_+"; prevX : "+o+"; prevY : "+s,"S");try{var r=n.width/window.devicePixelRatio,l=n.height/window.devicePixelRatio,d=2*e/r-1,c=1-2*_/l;if(g_raycaster.setFromCamera(new THREE.Vector2(d,c),a),g_intersects=g_raycaster.intersectObject(g_targetForDragging),0==g_intersects.length)return;var m=g_intersects[0].point.x,I=g_intersects[0].point.y,p=g_intersects[0].point.z,u=new THREE.Vector3(m,I,p);g_scene_objects[i].scene.children[0].worldToLocal(u);Math.min(19,Math.max(-19,u.x)),Math.min(19,Math.max(-19,u.y)),g_drag_z;if("Y"==g_shelf_edit_flag&&("PEGBOARD"==g_shelf_object_type?g_dragItem.position.z=15e-5:"ROD"==g_shelf_object_type?g_dragItem.position.z=.005:"TEXTBOX"!==g_shelf_object_type&&(g_dragItem.position.z=5e-4)),g_delete_details.length>0?g_multiItemCopy="Y":g_multiItemCopy="N",g_selecting&&void 0!==g&&g.length>0){await get_multiselect_obj(g,i);"Y"==g_area_zoom_ind?(new_camera=get_canvas_camera("MOUSEUP"),new_pogjson=get_canvas_json("MOUSEUP"),select_zoom(g_scene_objects[g_pog_index].scene.children[0],i),g_area_zoom_ind="N"):g_selecting=!1,g_selection.style.visibility="hidden"}logDebug("function : doMouseUp","E")}catch(e){error_handling(e)}}function doMouseDown(e,_,t,o,s,n,a,g){logDebug("function : doMouseDown; x : "+e+"; y : "+_+"; startX : "+t+"; startY : "+o+"; context_call : "+a,"S");try{window.devicePixelRatio;var i=$(document).scrollTop(),r=$(".t-Region-body").scrollLeft();g_multiselect="Y",g_global_counter+=1,g_start_coorX=t,g_start_coorY=o,g_taskItemInContext=clickInsideElement(s,"canvasregion"),g_taskItemInContext1=clickInsideElement(s,"canvasregion1"),g_selection.style.visibility="hidden";var l,d={};g_taskItemInContext&&(n=document.getElementById("maincanvas"),void 0!==g_scene_objects[g_pog_index]&&g_scene_objects.length>0&&(d=g_scene_objects[g_pog_index].scene.children[0],l=g_scene_objects[g_pog_index].scene.children[2]));var c=get_canvas_json("LABEL"),m=n.width/window.devicePixelRatio,I=n.height/window.devicePixelRatio,p=2*e/m-1,u=1-2*_/I;if(g_carpark_item_flag="N",g_carpark_edit_flag="N",g_module_edit_flag="N",g_shelf_edit_flag="N",g_item_edit_flag="N",g_module_index=-1,g_shelf_index=-1,g_module_cnt=-1,g_item_index=-1,g_module_width=-1,comp_obj_id=-1,g_module_X="",g_shelf_max_merch="",g_shelf_basket_spread="",render(),d.updateProjectionMatrix(),g_raycaster.setFromCamera(new THREE.Vector2(p,u),d),g_intersects=g_raycaster.intersectObjects(l.children),0==g_intersects.length){if(l.add(g_targetForDragging),g_targetForDragging.position.set(0,0,0),render(),g_intersects=g_raycaster.intersectObjects(l.children),g_intersects.length>0){var f=g_intersects[0].point.x,D=g_intersects[0].point.y;g_drag_z=g_intersects[0].point.z,g_drag_z+=.001;var O=new THREE.Vector3(f,D,v);l.worldToLocal(O);p=Math.min(19,Math.max(-19,O.x)),_=Math.min(19,Math.max(-19,O.y));if(g_DragMouseStart.x=p,g_DragMouseStart.y=_,g_DragMouseEnd.x=p,g_DragMouseEnd.y=_,g_startMouse.x=s.clientX+r-20,g_startMouse.y=s.clientY+i,g_prevMouse.x=p,g_prevMouse.y=_,g_nextMouse=g_prevMouse.clone(),l.remove(g_targetForDragging),g_intersected=[],g_select_zoom_arr=[],s.shiftKey)return!1;var h=g_startMouse.x,E=g_startMouse.y;return g_selecting=!0,g_selection.style.left=g_startMouse.x+"px",g_selection.style.top=g_startMouse.y+"px",g_selection.style.width=h-g_startMouse.x+"px",g_selection.style.height=E-g_startMouse.y+"px",g_selection.style.visibility="visible",!0}return g_intersected=[],g_select_zoom_arr=[],!1}if(g_intersects.length>0){if("drag_object"==g_intersects[0].object.uuid){var M=g_intersects[1];g_objectHit=M.object;f=g_intersects[1].point.x;g_mousedown_locx=g_intersects[1].point.x;D=g_intersects[1].point.y;var v=g_intersects[1].point.z;g_drag_z=g_intersects[1].point.z}else{M=g_intersects[0];g_objectHit=M.object;f=g_intersects[0].point.x;g_mousedown_locx=g_intersects[0].point.x;D=g_intersects[0].point.y,v=g_intersects[0].point.z;g_drag_z=g_objectHit.position.z}O=new THREE.Vector3(f,D,v);l.worldToLocal(O);p=Math.min(19,Math.max(-19,O.x));var P=g_drag_z;g_drag_z+=.001,g_itemDragZ=g_objectHit.position.z,g_itemDragX=g_objectHit.position.x;_=Math.min(19,Math.max(-19,O.y));if(g_objectHit_uuid=g_objectHit.uuid,g_objectHit_id=g_objectHit.id,console.log("g_objectHit_id",g_objectHit_id,g_objectHit_uuid,p,_,P),get_object_identity(c,g),-1!==g_module_index&&-1!==g_shelf_index&&update_item_distance(g_module_index,g_shelf_index,g),g_drag_x=g_module_X,render(),"Y"==g_module_edit_flag||-1!==g_module_obj_array.indexOf(g_objectHit)||g_objectHit_uuid.match(/BASE.*/)||g_objectHit_uuid.match(/NOTCH.*/)){g_startMouse.x=s.clientX+r-20,g_startMouse.y=s.clientY+i,g_prevMouse.x=p,g_prevMouse.y=_,g_nextMouse=g_prevMouse.clone(),g_DragMouseStart.x=p,g_DragMouseStart.y=_,g_DragMouseEnd.x=p,g_DragMouseEnd.y=_;h=g_startMouse.x+1,E=g_startMouse.y+1;return"N"!=g_context_opened||s.shiftKey||(g_selecting=!0,g_selection.style.left=g_startMouse.x+"px",g_selection.style.top=g_startMouse.y+"px",g_selection.style.width=h-g_startMouse.x+"px",g_selection.style.height=E-g_startMouse.y+"px",g_selection.style.visibility="visible"),!0}return g_dragItem=g_objectHit,console.log("evt.ctrlKey",s.ctrlKey,g_module_edit_flag,g_item_edit_flag,g_ctrl_select,g_mselect_drag,g_multiItemCopy),!1}if(g_intersected){for(var b=0;b<g_intersected.length;b++)g_select_color=g_intersected[b].BorderColour,g_intersected[b].WireframeObj.material.color.setHex(g_intersected[b].BorderColour),"Y"!=g_intersected[b].ImageExists||"Y"!=g_show_live_image&&"Y"!=g_show_live_image_comp||(g_intersected[b].WireframeObj.material.transparent=!0,g_intersected[b].WireframeObj.material.opacity=.0025);clearInterval(g_myVar),g_select_color=0,render(),g_intersected=[],g_select_zoom_arr=[]}logDebug("function : doMouseDown","E")}catch(e){error_handling(e)}}async function get_multiselect_obj(e,_){logDebug("function : get_multiselect_obj","S");try{if(console.log("g multiselect obj",e),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],void 0!==e&&e.length>0){var t=e[_].ModuleInfo,o=0;for(const D of t){if(null==D.ParentModule||"undefined"==D.ParentModule){var s=0;for(const t of D.ShelfInfo){if(void 0!==t&&"NOTCH"!==t.ObjType&&"BASE"!==t.ObjType&&"DIVIDER"!==t.ObjType){if(0!==t.Rotation||0!==t.Slope)var n=t.X-t.ShelfRotateWidth/2,a=t.X+t.ShelfRotateWidth/2,g=t.Y-t.ShelfRotateHeight/2,i=t.Y+t.ShelfRotateHeight/2;else n=t.X-t.W/2,a=t.X+t.W/2,g=t.Y-t.H/2,i=t.Y+t.H/2;if(g_DragMouseStart.x<g_DragMouseEnd.x&&g_DragMouseStart.y>g_DragMouseEnd.y){if(n>g_DragMouseStart.x&&a>g_DragMouseStart.x&&g<g_DragMouseStart.y&&i<g_DragMouseStart.y&&n<g_DragMouseEnd.x&&a<g_DragMouseEnd.x&&g>g_DragMouseEnd.y&&i>g_DragMouseEnd.y)(I={}).ObjID=t.SObjID,I.MIndex=o,I.SIndex=s,I.ObjWidth=t.W,I.ObjHeight=t.H,I.XAxis=t.X,I.YAxis=t.Y,I.ZAxis=t.Z,I.IIndex=-1,I.ObjType=t.ObjType,I.IsDivider="N",I.Object="SHELF",I.MObjID=D.MObjID,I.SObjID=-1,I.ItemID="",I.Item="",I.Exists="N",I.Rotation=t.Rotation,I.Slope=t.Slope,I.Distance=0,I.TopObjID="",I.BottomObjID="",g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(I)}else if(g_DragMouseStart.x>g_DragMouseEnd.x&&g_DragMouseStart.y>g_DragMouseEnd.y){if(n>g_DragMouseEnd.x&&a>g_DragMouseEnd.x&&g>g_DragMouseEnd.y&&i>g_DragMouseEnd.y&&n<g_DragMouseStart.x&&a<g_DragMouseStart.x&&g<g_DragMouseStart.y&&i<g_DragMouseStart.y)(I={}).ObjID=t.SObjID,I.MIndex=o,I.SIndex=s,I.ObjWidth=t.W,I.ObjHeight=t.H,I.XAxis=t.X,I.YAxis=t.Y,I.ZAxis=t.Z,I.IIndex=-1,I.ObjType=t.ObjType,I.IsDivider="N",I.Object="SHELF",I.MObjID=D.MObjID,I.SObjID=-1,I.ItemID="",I.Item="",I.Exists="N",I.Rotation=t.Rotation,I.Slope=t.Slope,I.Distance=0,I.TopObjID="",I.BottomObjID="",g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(I)}else if(g_DragMouseStart.x<g_DragMouseEnd.x&&g_DragMouseStart.y<g_DragMouseEnd.y){if(n>g_DragMouseStart.x&&a>g_DragMouseStart.x&&g>g_DragMouseStart.y&&i>g_DragMouseStart.y&&n<g_DragMouseEnd.x&&a<g_DragMouseEnd.x&&g<g_DragMouseEnd.y&&i<g_DragMouseEnd.y)(I={}).ObjID=t.SObjID,I.MIndex=o,I.SIndex=s,I.ObjWidth=t.W,I.ObjHeight=t.H,I.XAxis=t.X,I.YAxis=t.Y,I.ZAxis=t.Z,I.IIndex=-1,I.ObjType=t.ObjType,I.IsDivider="N",I.Object="SHELF",I.MObjID=D.MObjID,I.SObjID=-1,I.ItemID="",I.Item="",I.Exists="N",I.Rotation=t.Rotation,I.Slope=t.Slope,I.Distance=0,I.TopObjID="",I.BottomObjID="",g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(I)}else if(g_DragMouseStart.x>g_DragMouseEnd.x&&g_DragMouseStart.y<g_DragMouseEnd.y){if(n<g_DragMouseStart.x&&a<g_DragMouseStart.x&&g>g_DragMouseStart.y&&i>g_DragMouseStart.y&&n>g_DragMouseEnd.x&&a>g_DragMouseEnd.x&&g<g_DragMouseEnd.y&&i<g_DragMouseEnd.y)(I={}).ObjID=t.SObjID,I.MIndex=o,I.SIndex=s,I.ObjWidth=t.W,I.ObjHeight=t.H,I.XAxis=t.X,I.YAxis=t.Y,I.ZAxis=t.Z,I.IIndex=-1,I.ObjType=t.ObjType,I.IsDivider="N",I.Object="SHELF",I.MObjID=D.MObjID,I.SObjID=-1,I.ItemID="",I.Item="",I.Exists="N",I.Rotation=t.Rotation,I.Slope=t.Slope,I.Distance=0,I.TopObjID="",I.BottomObjID="",g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(I)}var r=0;for(const n of t.ItemInfo){var l=n.X-n.W/2,d=n.X+n.W/2,c=n.Y-n.H/2,m=n.Y+n.H/2;if(g_DragMouseStart.x<g_DragMouseEnd.x&&g_DragMouseStart.y>g_DragMouseEnd.y){if(l>g_DragMouseStart.x&&d>g_DragMouseStart.x&&c<g_DragMouseStart.y&&m<g_DragMouseStart.y&&l<g_DragMouseEnd.x&&d<g_DragMouseEnd.x&&c>g_DragMouseEnd.y&&m>g_DragMouseEnd.y){var I={},p="N",u="ITEM";if("DIVIDER"==n.Item&&(p="Y",u="SHELF"),I.ObjID=n.ObjID,I.MIndex=o,I.SIndex=s,I.ObjWidth=n.W,I.ObjHeight=n.H,I.XAxis=n.X,I.YAxis=n.Y,I.ZAxis=n.Z,I.IIndex=r,I.ObjType=t.ObjType,I.IsDivider=p,I.Object=u,I.MObjID=D.MObjID,I.SObjID=t.SObjID,I.ItemID=n.ItemID,I.Item=n.Item,I.W=n.W,I.H=n.H,I.X=n.X,I.Y=n.Y,I.Exists="N",I.Rotation=0,I.Slope=0,I.Distance=n.Distance,I.TopObjID=n.TopObjID,I.BottomObjID=n.BottomObjID,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(I),void 0!==s&&void 0!==o&&g_delete_details.length>0){var f=e[_].ModuleInfo[o].ShelfInfo[s];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(f)}}}else if(g_DragMouseStart.x>g_DragMouseEnd.x&&g_DragMouseStart.y>g_DragMouseEnd.y){if(l>g_DragMouseEnd.x&&d>g_DragMouseEnd.x&&c>g_DragMouseEnd.y&&m>g_DragMouseEnd.y&&l<g_DragMouseStart.x&&d<g_DragMouseStart.x&&c<g_DragMouseStart.y&&m<g_DragMouseStart.y){I={},p="N",u="ITEM";if("DIVIDER"==n.Item&&(p="Y",u="SHELF"),I.ObjID=n.ObjID,I.MIndex=o,I.SIndex=s,I.ObjWidth=n.W,I.ObjHeight=n.H,I.XAxis=n.X,I.YAxis=n.Y,I.ZAxis=n.Z,I.IIndex=r,I.ObjType=t.ObjType,I.IsDivider=p,I.Object=u,I.MObjID=D.MObjID,I.SObjID=t.SObjID,I.ItemID=n.ItemID,I.Item=n.Item,I.W=n.W,I.H=n.H,I.X=n.X,I.Y=n.Y,I.Exists="N",I.Rotation=0,I.Slope=0,I.Distance=n.Distance,I.TopObjID=n.TopObjID,I.BottomObjID=n.BottomObjID,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(I),void 0!==s&&void 0!==o&&g_delete_details.length>0){f=e[_].ModuleInfo[o].ShelfInfo[s];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(f)}}}else if(g_DragMouseStart.x<g_DragMouseEnd.x&&g_DragMouseStart.y<g_DragMouseEnd.y){if(l>g_DragMouseStart.x&&d>g_DragMouseStart.x&&c>g_DragMouseStart.y&&m>g_DragMouseStart.y&&l<g_DragMouseEnd.x&&d<g_DragMouseEnd.x&&c<g_DragMouseEnd.y&&m<g_DragMouseEnd.y){I={},p="N",u="ITEM";if("DIVIDER"==n.Item&&(p="Y",u="SHELF"),I.ObjID=n.ObjID,I.MIndex=o,I.SIndex=s,I.ObjWidth=n.W,I.ObjHeight=n.H,I.XAxis=n.X,I.YAxis=n.Y,I.ZAxis=n.Z,I.IIndex=r,I.ObjType=t.ObjType,I.IsDivider=p,I.Object=u,I.MObjID=D.MObjID,I.SObjID=t.SObjID,I.ItemID=n.ItemID,I.Item=n.Item,I.W=n.W,I.H=n.H,I.X=n.X,I.Y=n.Y,I.Exists="N",I.Rotation=0,I.Slope=0,I.Distance=n.Distance,I.TopObjID=n.TopObjID,I.BottomObjID=n.BottomObjID,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(I),void 0!==s&&void 0!==o&&g_delete_details.length>0){f=e[_].ModuleInfo[o].ShelfInfo[s];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(f)}}}else if(g_DragMouseStart.x>g_DragMouseEnd.x&&g_DragMouseStart.y<g_DragMouseEnd.y&&l<g_DragMouseStart.x&&d<g_DragMouseStart.x&&c>g_DragMouseStart.y&&m>g_DragMouseStart.y&&l>g_DragMouseEnd.x&&d>g_DragMouseEnd.x&&c<g_DragMouseEnd.y&&m<g_DragMouseEnd.y){I={},p="N",u="ITEM";if("DIVIDER"==n.Item&&(p="Y",u="SHELF"),I.ObjID=n.ObjID,I.MIndex=o,I.SIndex=s,I.ObjWidth=n.W,I.ObjHeight=n.H,I.XAxis=n.X,I.YAxis=n.Y,I.ZAxis=n.Z,I.IIndex=r,I.ObjType=t.ObjType,I.IsDivider=p,I.Object=u,I.MObjID=D.MObjID,I.SObjID=t.SObjID,I.ItemID=n.ItemID,I.Item=n.Item,I.W=n.W,I.H=n.H,I.X=n.X,I.Y=n.Y,I.Exists="N",I.Rotation=0,I.Slope=0,I.Distance=n.Distance,I.TopObjID=n.TopObjID,I.BottomObjID=n.BottomObjID,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(I),void 0!==s&&void 0!==o&&g_delete_details.length>0){f=e[_].ModuleInfo[o].ShelfInfo[s];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(f)}}r++}}s++}}o++}}logDebug("function : get_multiselect_obj","E")}catch(e){error_handling(e)}}function select_zoom(e,_){logDebug("function : select_zoom","S");var t=g=i=r=0;try{if(g_cutaway_cam_detail=[],console.log("g_DragMouseStart",g_DragMouseStart,g_DragMouseEnd,g_multiselect),0!==g_DragMouseStart.x&&0!==g_DragMouseEnd.x&&"Y"==g_multiselect){if(g_DragMouseStart.x>g_DragMouseEnd.x?(t=g_DragMouseStart.x-g_DragMouseEnd.x,i=g_DragMouseEnd.x+t/2):(t=g_DragMouseEnd.x-g_DragMouseStart.x,i=g_DragMouseStart.x+t/2),g_DragMouseStart.y>g_DragMouseEnd.y?(g=g_DragMouseStart.y-g_DragMouseEnd.y,r=g_DragMouseEnd.y+g/2):(g=g_DragMouseEnd.y-g_DragMouseStart.y,r=g_DragMouseStart.y+g/2),set_camera_z(g_scene_objects[g_pog_index].scene.children[0],i,r,t,g,0,i,r,!0,_),g_manual_zoom_ind="Y",(d={}).x=i,d.y=r,d.width=t,d.height=g,d.offset=0,g_cutaway_cam_detail.push(d),g_intersected){for(var o=0;o<g_intersected.length;o++)g_select_color=g_intersected[o].BorderColour,g_intersected[o].WireframeObj.material.color.setHex(g_select_color),"Y"!=g_intersected[o].ImageExists||"Y"!=g_show_live_image&&"Y"!=g_show_live_image_comp||(g_intersected[o].WireframeObj.material.transparent=!0,g_intersected[o].WireframeObj.material.opacity=.0025);clearInterval(g_myVar),g_select_color=0,render()}g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_multiselect="N",g_intersected=[]}else if(g_select_zoom_arr.length>0){var s=maxx=miny=maxy=-1;for(o=0;o<g_select_zoom_arr.length;o++){var n="N",a="N";$.each(g_pog_json[_].ModuleInfo,(function(e,t){if("Y"==n)return!1;if(null==t.ParentModule||"undefined"==t.ParentModule){if(t.MObjID==g_select_zoom_arr[o].id)return s=-1==s?t.X-t.W/2:Math.min(s,t.X-t.W/2),-1==miny?miny=t.Y-t.H/2+g_pog_json[_].BaseH:miny=Math.min(miny,t.Y-t.H/2+g_pog_json[_].BaseH),maxx=Math.max(maxx,t.X+t.W/2),maxy=Math.max(maxy,t.Y+t.H/2+g_pog_json[_].BaseH),n="Y",a="Y",!1;$.each(t.ShelfInfo,(function(e,_){if("Y"==n)return!1;if(void 0!==_&&"NOTCH"!==_.ObjType&&"BASE"!==_.ObjType&&"DIVIDER"!==_.ObjType){if(g_shelf.SObjID==g_select_zoom_arr[o].id)return 0!==_.Rotation||0!==_.Slope?(shelf_width=void 0===_.ShelfRotateWidth?_.W:_.ShelfRotateWidth,shelf_height=void 0===_.ShelfRotateHeight?_.W:_.ShelfRotateHeight):(shelf_width=_.W,shelf_height=_.H),s=-1==s?_.X-shelf_width/2:Math.min(s,_.X-shelf_width/2),-1==miny?miny=_.Y-shelf_height/2:miny=Math.min(miny,_.Y-shelf_height/2),maxx=Math.max(maxx,_.X+shelf_width/2),maxy=Math.max(maxy,_.Y+shelf_height/2),n="Y",a="Y",!1;_.ItemInfo.length>0&&$.each(_.ItemInfo,(function(e,t){if(t.ObjID==g_select_zoom_arr[o].id)return 0!==_.Rotation||0!==_.Slope?(item_width=void 0===t.RotationWidth||null==t.RotationWidth||0==t.RotationWidth?t.W:t.RotationWidth,item_height=void 0===t.RotationHeight||null==t.RotationHeight||0==t.RotationHeight?t.H:t.RotationHeight):(item_width=t.W,item_height=t.H),s=-1==s?t.X-item_width/2:Math.min(s,t.X-item_width/2),-1==miny?miny=t.Y-item_height/2:miny=Math.min(miny,t.Y-item_height/2),maxx=Math.max(maxx,t.X+item_width/2),maxy=Math.max(maxy,t.Y+item_height/2),n="Y",a="Y",!1}))}}))}}))}if("Y"==a){if(g_intersected){for(o=0;o<g_intersected.length;o++)g_select_color=g_intersected[o].BorderColour,g_intersected[o].WireframeObj.material.color.setHex(g_select_color),"Y"!=g_intersected[o].ImageExists||"Y"!=g_show_live_image&&"Y"!=g_show_live_image_comp||(g_intersected[o].WireframeObj.material.transparent=!0,g_intersected[o].WireframeObj.material.opacity=.0025);clearInterval(g_myVar),g_select_color=0,render()}t=maxx-s;var g=maxy-miny,i=s+t/2,r=miny+g/2;set_camera_z(g_scene_objects[g_pog_index].scene.children[0],i,r,t,g,.5,i,r,!0,_),(d={}).x=i,d.y=r,d.width=t,d.height=g,d.offset=.5,g_cutaway_cam_detail.push(d),g_manual_zoom_ind="Y",g_select_zoom_arr=[],render()}}else{if("Y"==g_module_edit_flag){t=g_pog_json[_].ModuleInfo[g_module_index].W,g=g_pog_json[_].ModuleInfo[g_module_index].H,i=g_pog_json[_].ModuleInfo[g_module_index].X,r=g_pog_json[_].ModuleInfo[g_module_index].Y;var l=g_offset_z}else if("Y"==g_shelf_edit_flag){t=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].W,g=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].H,i=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X,r=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y;l=0}else if("Y"==g_item_edit_flag){t=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].W,g=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].H,i=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].X,r=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Y;l=0}var d;if(t>0)set_camera_z(g_scene_objects[g_pog_index].scene.children[0],i,r,t,g,l,i,r,!0,_),(d={}).x=i,d.y=r,d.width=t,d.height=g,d.offset=l,g_cutaway_cam_detail.push(d),g_manual_zoom_ind="Y",render()}}catch(e){error_handling(e)}logDebug("function : select_zoom","E")}function get_object_identity(e,_){logDebug("function : get_object_identity","S");try{var t=0;for(const s of e[_].ModuleInfo){if("Y"==g_carpark_edit_flag)break;if(null==s.ParentModule&&void 0!==s.Carpark&&s.Carpark.length>0&&s.Carpark[0].ItemInfo.length>0){var o=0;for(const e of s.Carpark){if(e.SObjID==g_objectHit_id){g_module_index=t,g_shelf_index=o,g_carpark_edit_flag="Y";break}g_carpark_edit_flag="N",o++}}t++}if(console.log("module index on click",g_module_index,g_shelf_index,g_module_edit_flag,g_shelf_edit_flag,g_item_edit_flag,g_carpark_edit_flag),"N"==g_carpark_edit_flag){t=0;for(const o of e[_].ModuleInfo){if(g_taskItemInContext||"POG"==g_compare_view||"EDIT_PALLET"==g_compare_view){if(o.MObjID==g_objectHit_id&&null==o.ParentModule){g_module_index=t,g_module_cnt=t,g_module_width=o.W,g_module_X=o.X,g_module_edit_flag="Y",comp_obj_id=o.CompMObjID,g_wireframe_id=o.WFrameID;break}g_module_edit_flag="N"}else{if(o.CompMObjID==g_objectHit_id&&null==o.ParentModule){g_module_index=t,g_module_cnt=t,g_module_width=o.W,g_module_X=o.X,g_module_edit_flag="Y",comp_obj_id=o.MObjID,g_wireframe_id=o.WFrameID;break}g_module_edit_flag="N"}t++}}if("N"==g_module_edit_flag&&"N"==g_carpark_edit_flag){o=0;for(const t of e[_].ModuleInfo){if("Y"==g_shelf_edit_flag)break;null==t.ParentModule&&$.each(t.ShelfInfo,(function(e,_){if("BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType)if(g_taskItemInContext||"POG"==g_compare_view||"EDIT_PALLET"==g_compare_view){if(_.SObjID==g_objectHit_id)return g_module_index=o,g_shelf_index=e,g_shelf_max_merch=_.MaxMerch,g_shelf_basket_spread=_.BsktSpreadProduct,g_shelf_edit_flag="Y",g_wireframe_id=_.WFrameID,g_shelf_object_type=_.ObjType,comp_obj_id=_.CompShelfObjID,g_rotation=_.Rotation,_.Slope>0?g_slope=0-_.Slope:_.Slope<0?g_slope=-_.Slope:g_slope=0,!1;g_shelf_edit_flag="N"}else{if(_.CompShelfObjID==g_objectHit_id)return g_module_index=o,g_shelf_index=e,g_shelf_max_merch=_.MaxMerch,g_shelf_edit_flag="Y",g_wireframe_id=_.WFrameID,g_shelf_object_type=_.ObjType,g_shelf_basket_spread=_.BsktSpreadProduct,g_rotation=_.Rotation,comp_obj_id=_.SObjID,_.Slope>0?g_slope=0-_.Slope:_.Slope<0?g_slope=-_.Slope:g_slope=0,!1;g_shelf_edit_flag="N"}})),o++}}if("N"==g_shelf_edit_flag&&"N"==g_module_edit_flag&&"N"==g_carpark_edit_flag){var s=0;for(const n of e[_].ModuleInfo){if("Y"==g_item_edit_flag)break;if(null==n.ParentModule){if(void 0!==n.Carpark&&void 0!==n.Carpark[0]&&n.Carpark.length>0&&n.Carpark[0].ItemInfo.length>0){o=0;for(const e of n.Carpark[0].ItemInfo){if(g_taskItemInContext||"POG"==g_compare_view||"EDIT_PALLET"==g_compare_view){if(e.ObjID==g_objectHit_id){g_module_index=s,g_shelf_index=0,g_item_index=o,g_item_edit_flag="Y",g_shelf_object_type=n.Carpark[0].ObjType,g_wireframe_id=e.WFrameID,comp_obj_id=e.CompItemObjID,g_carpark_item_flag="Y";break}g_item_edit_flag="N"}else{if(e.ObjID==g_objectHit_id){g_module_index=s,g_shelf_index=0,g_item_index=o,g_item_edit_flag="Y",g_shelf_object_type=n.Carpark[0].ObjType,g_wireframe_id=e.WFrameID,comp_obj_id=e.ObjID,g_carpark_item_flag="Y";break}g_item_edit_flag="N"}o++}}t=0;for(const e of n.ShelfInfo){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){if("Y"==g_item_edit_flag)break;o=0;for(const _ of e.ItemInfo){if(g_taskItemInContext||"POG"==g_compare_view||"EDIT_PALLET"==g_compare_view){if(_.ObjID==g_objectHit_id){g_module_index=s,g_shelf_index=t,g_item_index=o,g_item_edit_flag="Y",g_shelf_object_type=e.ObjType,g_wireframe_id=_.WFrameID,comp_obj_id=_.CompItemObjID;break}g_item_edit_flag="N"}else{if(_.CompItemObjID==g_objectHit_id){g_module_index=s,g_shelf_index=t,g_item_index=o,g_item_edit_flag="Y",comp_obj_id=_.ObjID,g_shelf_object_type=e.ObjType,g_wireframe_id=_.WFrameID;break}g_item_edit_flag="N"}o++}}t++}}s++}}logDebug("function : get_object_identity","E")}catch(e){error_handling(e)}}function area_zoom(){logDebug("function : area_zoom","S"),"N"==g_area_zoom_ind?($(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),$(".area_zoom").addClass("active"),g_area_zoom_ind="Y",g_select_zoom_arr=[]):($(".area_zoom").removeClass("active"),g_area_zoom_ind="N"),logDebug("function : area_zoom","E")}function onDocumentMouseWheel(e){var _,t,o;if(logDebug("function : onDocumentMouseWheel","S"),g_taskItemInContext=clickInsideElement(e,"canvasregion"),g_taskItemInContext1=clickInsideElement(e,"canvasregion1"),g_taskItemInContext?(_=document.getElementById("maincanvas"),t=g_camera,o="#maincanvas"):(_=document.getElementById("maincanvas1"),t=g_camera_comp,o="#maincanvas1"),e.ctrlKey){g_duplicating="N",e.preventDefault(),e.stopPropagation(),g_manual_zoom_ind="Y";var s=_.getBoundingClientRect(),n=e.clientX-s.left,a=e.clientY-s.top,g=parseFloat($v("P53_POGCR_CAMERA_ZOOM_FACTOR")),i=2*n/(_.width/window.devicePixelRatio)-1,r=1-2*a/(_.height/window.devicePixelRatio),l=new THREE.Vector3(i,r,e.deltaY/500);l.unproject(t),l.sub(t.position),e.deltaY<0?($(o).css("cursor","zoom-in"),t.position.addVectors(t.position,l.setLength(g))):($(o).css("cursor","zoom-out"),t.position.subVectors(t.position,l.setLength(g))),render()}else if("Y"==g_manual_zoom_ind){var d=parseFloat($v("P53_POGCR_WHEEL_UP_DOWN_INTER"));e.deltaY<0?t.position.set(t.position.x,t.position.y+d,t.position.z):e.deltaY>0&&t.position.set(t.position.x,t.position.y-d,t.position.z),render()}logDebug("function : onDocumentMouseWheel","E")}function reset_zoom(e){logDebug("function : reset_zoom","S");try{if("undefined"!=typeof g_pog_json&&g_pog_json.length>0||"undefined"!=typeof g_pog_json_comp&&g_pog_json_comp.length>0){if($(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),$("#maincanvas").css("cursor","auto"),$("#maincanvas1").css("cursor","auto"),g_manual_zoom_ind="N",g_area_zoom_ind="N",g_select_zoom_arr=[],1==g_curr_canvas){var _=get_min_max_xy(e).split("###");set_camera_z(g_scene_objects[e].scene.children[0],parseFloat(_[2]),parseFloat(_[3]),parseFloat(_[0]),parseFloat(_[1]),g_offset_z,parseFloat(_[4]),parseFloat(_[5]),!0,e)}if("undefined"!=typeof g_pog_json_comp&&g_pog_json_comp.length>0&&2==g_curr_canvas&&"CUTAWAY"!==g_compare_view){_=get_min_max_xy(e).split("###");set_camera_z(g_camera_comp,parseFloat(_[2]),parseFloat(_[3]),parseFloat(_[0]),parseFloat(_[1]),g_offset_z,parseFloat(_[4]),parseFloat(_[5]),!0,e)}else 2==g_curr_canvas&&"CUTAWAY"!==g_compare_view&&set_camera_z(g_camera_comp,g_pog_json[e].CompCamX,g_pog_json[e].CompCamY,g_pog_json[e].CompCamWidth,g_pog_json[e].CompCamHeight,g_offset_z,g_pog_json[e].CompCamWidth,g_pog_json[e].CompCamHeight,!0,e);render(),g_intersected=[]}logDebug("function : reset_zoom","E")}catch(e){error_handling(e)}}async function comparePOGPortal(e,_,t,o,s){try{logDebug("function : comparePOG","S"),await get_compare_pog(e,_,t,o,s),logDebug("function : comparePOG","E")}catch(e){error_handling(e)}}async function get_compare_pog(e,_,t,o,s){logDebug("function : get_compare_pog; compare_ind : "+e+"; pog_code : "+_+"; pog_version : "+t+"; draft_id : "+o+"; prev_version : "+s,"S");try{"Y"==s&&$(".item_color_legends").css("display","none"),addLoadingIndicator();var n,a,g=g_pog_index;"1"==e?(n="N",a="E"):(n="Y",a="N"),apex.server.process("GET_COMPARE_JSON",{x01:e,x02:_,x03:t,x04:o},{dataType:"html"}).done((function(e){var _=$.trim(e);if(_.match(/ERROR.*/))raise_error(_),removeLoadingIndicator(regionloadWait);else if(""!==_){g_json=JSON.parse($.trim(e));JSON.parse(JSON.stringify(g_pog_json));g_pog_json_data=g_json;var t=g_pog_json_data[0].ModuleInfo;i=0;for(const e of t){if(null!=e.ShelfInfo&&void 0!==e.ShelfInfo||(e.ShelfInfo=[]),void 0===e.ParentModule||null==e.ParentModule){null!==e.SubDept&&void 0!==e.SubDept&&(subdept=e.SubDept),j=0;for(const _ of e.ShelfInfo)void 0!==_.ItemInfo&&null!=_.ItemInfo||(_.ItemInfo=[]),j+=1}i+=1}$(".live_image").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".open_pdf").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".open_pdf_online").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),async function(){g_pog_json_data[0].PreVersion="";var e,_=g_pog_json_data[0];g_comp_base_code=_.POGCode,_.PreVersion="Y",_.POGCode=_.POGCode+"-PREV_VERSION",g_ComBaseIndex=g,g_colorBackup="N",g_comp_view_code=_.POGCode,"Y"==g_compare_pog_flag&&"PREV_VERSION"==g_compare_view?(g_pog_json[g_ComViewIndex]=_,g_ComViewIndex=g_ComViewIndex,init(g_ComViewIndex),(e={}).scene=g_scene,e.renderer=g_renderer,g_scene_objects[g_ComViewIndex]=e):(g_pog_json.push(_),g_ComViewIndex=g_pog_json.length-1,appendMultiCanvasRowCol(g_pog_json.length,$v("P25_POGCR_TILE_VIEW")),init(g_ComViewIndex),(e={}).scene=g_scene,e.renderer=g_renderer,g_scene_objects.push(e));var t=JSON.parse(JSON.stringify(g_pog_json));if(g_json=[g_pog_json[g_ComViewIndex]],g_compare_view="Y"==s?"PREV_VERSION":"POG",g_compare_pog_flag="Y",set_indicator_objects(g_ComViewIndex),modifyWindowAfterMinMax(g_scene_objects),g_pog_index=g_ComViewIndex,g_multi_pog_json=[],g_world=g_scene_objects[g_ComViewIndex].scene.children[2],g_camera=g_scene_objects[g_ComViewIndex].scene.children[0],await create_module_from_json(t,n,"F",$v("P25_PRODUCT_BTN_CLICK"),a,"N","N","Y","Y","","Y",g_scene_objects[g_ComViewIndex].scene.children[0],g_scene_objects[g_ComViewIndex].scene,g_pog_index,g_ComViewIndex),removeLoadingIndicator(regionloadWait),render(g_ComViewIndex),"Y"==s){if("Y"==g_show_item_color)await showItemColor("OFF",g_ComViewIndex);await two_pog_diff_checker(g_ComBaseIndex,g_ComViewIndex),await calculateFixelAndSupplyDays("N",g_ComViewIndex)}render(g_pog_index),g_pog_index=g,add_pog_code_header()}(),$s("P25_OPEN_DRAFT","Y"),g_auto_position_ind="N",g_dblclick_opened="N"}}))}catch(e){error_handling(e),removeLoadingIndicator(regionloadWait)}}$(document).keydown((function(e){get_canvas_world("LABEL");var _=get_canvas_json("LABEL"),t=get_canvas_camera("LABEL");e.keyCode;38==e.keyCode&&1==e.ctrlKey&&void 0!==_&&_.length>0?($("#maincanvas").css("cursor","zoom-in"),t.position.set(t.position.x,t.position.y,t.position.z-parseFloat($v("P53_POGCR_CAMERA_ZOOM_FACTOR"))),g_manual_zoom_ind="Y",render()):40==e.keyCode&&1==e.ctrlKey&&void 0!==_&&_.length>0&&($("#maincanvas").css("cursor","zoom-out"),t.position.set(t.position.x,t.position.y,t.position.z+parseFloat($v("P53_POGCR_CAMERA_ZOOM_FACTOR"))),g_manual_zoom_ind="Y",render()),g_renderer.domElement.addEventListener("mousewheel",onDocumentMouseWheel,!1)}));