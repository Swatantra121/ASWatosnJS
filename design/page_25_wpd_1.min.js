var g_default_camera_z="0";function initiate_values_onload(){sessionStorage.setItem("g_dbuDebugEnabled",$v("P25_POGC_JS_DEBUG_ENABLE")),logDebug("onload code ; ","S"),null!==document.getElementById("draggable_table")&&(g_trs=document.getElementById("draggable_table").getElementsByTagName("tr")),$("#canvas-holder").bind("dragenter dragover",!1).bind("drop",(function(e){console.log("drop bind")}));var e=$v("P25_DELETE_IND");back_clicked="N";document.getElementById("P25_UPLOAD_HIDDEN").onchange=function(e){try{if(""!==$v("P25_UPLOAD_HIDDEN")){const _=e.target.files[0];var o,t;const n=URL.createObjectURL(_),a=new Image;a.src=n,a.onerror=function(){URL.revokeObjectURL(this.src)},a.onload=function(){URL.revokeObjectURL(this.src);var e=$v("P25_POGCR_IMG_RESOLUTION").split("x");const[n,i]=calculateSize(a,parseFloat(e[0]),parseFloat(e[1])),d=document.createElement("canvas");d.width=n,d.height=i,o=_.name,t=_.type;d.getContext("2d").drawImage(a,0,0,n,i),d.toBlob((e=>{var _=d.toDataURL(t);const[l,r]=get_visible_size(.012,parseFloat($v("P25_TEXT_WIDTH"))/100,parseFloat($v("P25_TEXT_HEIGHT"))/100,d,g_camera);var g=document.createElement("canvas");g.width=l,g.height=r;g.getContext("2d").drawImage(a,0,0,l,r);var s={};g_temp_image_arr=[],s.FileName=o,s.MimeType=t,s.Image=_.split(",")[1],s.ImageBlob=e,s.MaxWidth=n,s.MaxHeight=i,s.CompressRatio=parseFloat($v("P25_COMPRESS_RATIO")),g_temp_image_arr.push(s),$("#P25_IMG_FILENAME").removeClass("apex_disabled"),$s("P25_IMG_FILENAME",o),$("#P25_IMG_FILENAME").addClass("apex_disabled"),$("#IMAGE_AREA canvas").remove(),document.getElementById("IMAGE_AREA").append(g);var f=new Image;f.src="data:image/png;base64,"+g_temp_image_arr[0].Image,f.onload=function(){const e=document.createElement("canvas");e.width=500,e.height=100;e.getContext("2d").drawImage(f,0,0,500,100),$("#VIEW_IMAGE canvas").remove(),document.getElementById("VIEW_IMAGE").append(e)}}),t,parseFloat($v("P25_COMPRESS_RATIO"))),$("#P25_UPLOAD_HIDDEN")[0].value=""}}}catch(e){error_handling(e)}};var o=null,t=0,_=!1;$(document).keydown((function(n){if(g_delete_details.length>0){new_details=JSON.parse(JSON.stringify(g_delete_details));for(const e of new_details)e.ShelfInfo=""}else new_details=[];n.altKey&&70==n.keyCode&&(n.preventDefault(),openInlineDialog("find",35,45)),73==n.keyCode&&1==n.ctrlKey&&"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&open_update_item_info();var a={},i=n.keyCode;if(onkeydown=onkeyup=function(e){if(a[e.keyCode]="keyup"==e.type,"keydown"==e.type&&console.log("keydown ",e.keyCode,e),"keyup"==e.type&&67==e.keyCode&&console.log("key up 67 up"),"keydown"==e.type&&67==e.keyCode?g_chest_move="Y":g_chest_move="N","keydown"==e.type&&e.shiftKey?g_shift_mutli_item_select="Y":(g_shift_mutli_item_select="N",g_shift_multi_item_first={},g_shift_multi_item_last={}),"keydown"==e.type&&"ShiftLeft"!==e.code&&("Numpad1"==e.code||"Numpad2"==e.code||"Numpad3"==e.code||"Numpad4"==e.code||"Numpad5"==e.code||"Numpad6"==e.code||"Numpad7"==e.code||"Numpad8"==e.code||"Numpad9"==e.code))switch(console.log("e.code",e.code),_=!0,e.code){case"Numpad1":t=1;break;case"Numpad2":t=2;break;case"Numpad3":t=3;break;case"Numpad4":t=4;break;case"Numpad5":t=5;break;case"Numpad6":t=6;break;case"Numpad7":t=7;break;case"Numpad8":t=8;break;case"Numpad9":t=9}"keyup"==e.type&&g_pog_index!==g_ComViewIndex&&(1!=a[16]||1!=a[72]||1!=a[49]&&1!=a[50]&&1!=a[51]&&1!=a[52]&&1!=a[53]&&1!=a[54]&&1!=a[55]&&1!=a[56]&&1!=a[57]&&!_?1!=a[16]||1!=a[86]||1!=a[49]&&1!=a[50]&&1!=a[51]&&1!=a[52]&&1!=a[53]&&1!=a[54]&&1!=a[55]&&1!=a[56]&&1!=a[57]&&!_?1!=a[16]||1!=a[68]||1!=a[49]&&1!=a[50]&&1!=a[51]&&1!=a[52]&&1!=a[53]&&1!=a[54]&&1!=a[55]&&1!=a[56]&&1!=a[57]&&!_?o=null:(o="depthfacing",i>=49&&i<=57?incrementFacingsFromKey(o,String.fromCharCode(i)):incrementFacingsFromKey(o,t),a={},o=null,t=0,_=!1):(o="vertfacing",console.log("map",a,e.type,e.keyCode,i,String.fromCharCode(i)),i>=49&&i<=57?incrementFacingsFromKey(o,String.fromCharCode(i)):incrementFacingsFromKey(o,t),a={},o=null,t=0,_=!1):(o="horizfacing",console.log("map",a,e.type,e.keyCode,i,String.fromCharCode(i)),i>=49&&i<=57?incrementFacingsFromKey(o,String.fromCharCode(i)):incrementFacingsFromKey(o,t),a={},o=null,i=null,t=0,_=!1))},!n.shiftKey||38!=n.keyCode&&40!=n.keyCode&&37!=n.keyCode&&39!=n.keyCode||g_pog_index===g_ComViewIndex)if(null===o||"horizfacing"!=o&&"vertfacing"!=o){if(null==o&&(g_pog_index==g_ComViewIndex&&("EDIT_PALLET"==g_compare_view&&46!==n.keyCode||"PREV_VERSION"==g_compare_view&&67==n.keyCode&&1==n.ctrlKey&&"Y"==g_edit_ind)||g_pog_index!==g_ComViewIndex))if(("N"==g_multiselect||38==n.keyCode&&1==n.ctrlKey||40==n.keyCode&&1==n.ctrlKey)&&(g_taskItemInContext1||g_taskItemInContext||38==n.keyCode&&1==n.ctrlKey||40==n.keyCode&&1==n.ctrlKey)&&"N"==g_dblclick_opened&&(67==n.keyCode&&1==n.ctrlKey||46==n.keyCode||86==n.keyCode&&1==n.ctrlKey||88==n.keyCode&&1==n.ctrlKey||69==n.keyCode&&1==n.ctrlKey||81==n.keyCode&&1==n.ctrlKey||76==n.keyCode&&1==n.ctrlKey||90==n.keyCode&&1==n.ctrlKey||38==n.keyCode&&1==n.ctrlKey||40==n.keyCode&&1==n.ctrlKey))if((69==n.keyCode&&1==n.ctrlKey||76==n.keyCode&&1==n.ctrlKey)&&n.preventDefault(),69==n.keyCode&&1==n.ctrlKey&&"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&"Y"==g_edit_ind&&("Y"==g_item_edit_flag||"Y"==g_module_edit_flag||"Y"==g_carpark_edit_flag)&&context_edit(),81==n.keyCode&&1==n.ctrlKey&&"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&"Y"==g_edit_ind&&"Y"==g_shelf_edit_flag&&context_edit(),38==n.keyCode&&1==n.ctrlKey&&"undefined"!=typeof g_pog_json&&g_pog_json.length>0?($("#maincanvas").css("cursor","zoom-in"),g_camera.position.set(g_camera.position.x,g_camera.position.y,g_camera.position.z-parseFloat($v("P25_POGCR_CAMERA_ZOOM_FACTOR"))),g_manual_zoom_ind="Y",render(g_pog_index)):40==n.keyCode&&1==n.ctrlKey&&"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&($("#maincanvas").css("cursor","zoom-out"),g_camera.position.set(g_camera.position.x,g_camera.position.y,g_camera.position.z+parseFloat($v("P25_POGCR_CAMERA_ZOOM_FACTOR"))),g_manual_zoom_ind="Y",render(g_pog_index)),"Y"==g_module_edit_flag||"Y"==g_shelf_edit_flag||"Y"==g_item_edit_flag)if(46==n.keyCode&&"Y"==e)g_keyCode=46,context_delete("DELETE",g_module_index,g_shelf_index,g_item_index,g_item_edit_flag,g_module_edit_flag,g_shelf_edit_flag,g_objectHit_id,"",g_delete_details,g_camera,g_pog_index,"N"),g_item_edit_flag="N",g_module_edit_flag="N",g_shelf_edit_flag="N",g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[];else if(67==n.keyCode&&1==n.ctrlKey&&"Y"==g_edit_ind)g_keyCode=67,context_copy("S",g_pog_index);else if(86!=n.keyCode||1!=n.ctrlKey||"Y"!=g_cut_action_done&&"Y"!=g_copy_action_done&&"Y"!=g_multi_copy_done||"Y"!=g_edit_ind)88==n.keyCode&&1==n.ctrlKey&&"Y"==g_edit_ind?(g_keyCode=88,context_cut(g_pog_index)):76==n.keyCode&&1==n.ctrlKey&&("Y"==g_shelf_edit_flag||"Y"==g_item_edit_flag&&"DIVIDER"==g_pog_json[p_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Item)&&"Y"==g_edit_ind?(g_keyCode=76,context_duplicate()):90!=n.keyCode||1!=n.ctrlKey||"Y"!=g_cut_action_done&&"Y"!=g_delete_action_done&&"Y"!=g_multi_delete_done||"Y"!=g_edit_ind?90==n.keyCode&&1==n.ctrlKey&&"N"==g_cut_action_done&&"N"==g_delete_action_done&&"N"==g_multi_delete_done&&g_undo_final_obj_arr.length-1>=0&&(g_keyCode=90,undo_actions_not_delete("UNDO",g_camera,g_pog_index)):g_undo_final_obj_arr.length-1>=0&&(g_keyCode=90,undo_actions_not_delete("UNDO",g_camera,g_pog_index));else{var d;g_keyCode=86,"Y"==g_cut_action_done?d="CUT":"Y"==g_copy_action_done&&(d="COPY"),"Y"!=g_cut_action_done&&"Y"!=g_copy_action_done&&"Y"!=g_multi_copy_done||context_paste(d,g_camera,"N","Y",g_pog_index)}else 90!=n.keyCode||1!=n.ctrlKey||"Y"!=g_cut_action_done&&"Y"!=g_delete_action_done&&"Y"!=g_multi_delete_done?90==n.keyCode&&1==n.ctrlKey&&"N"==g_cut_action_done&&"N"==g_delete_action_done&&"N"==g_multi_delete_done&&g_undo_final_obj_arr.length-1>=0&&(g_keyCode=90,undo_actions_not_delete("UNDO",g_camera,g_pog_index)):g_undo_final_obj_arr.length-1>=0&&(g_keyCode=90,undo_actions_not_delete("UNDO",g_camera,g_pog_index));else"Y"==g_multiselect&&JsonContains(new_details,"Object","SHELF")&&JsonContains(new_details,"ObjType","SHELF")&&JsonContains(new_details,"Object","ITEM")&&81==n.keyCode&&1==n.ctrlKey&&"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&"Y"==g_edit_ind?(n.preventDefault(),context_multi_edit("F"),g_mselect_drag="Y"):"Y"==g_multiselect&&JsonContains(new_details,"Object","ITEM")&&69==n.keyCode&&1==n.ctrlKey&&"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&"Y"==g_edit_ind?(n.preventDefault(),context_multi_edit("P"),g_mselect_drag="Y"):"Y"==g_multiselect&&46==n.keyCode&&"Y"==e?(context_delete("DELETE",g_module_index,g_shelf_index,g_item_index,g_item_edit_flag,g_module_edit_flag,g_shelf_edit_flag,g_objectHit_id,"",g_delete_details,g_camera,g_pog_index,g_productselect),g_item_edit_flag="N",g_module_edit_flag="N",g_shelf_edit_flag="N",g_keyCode=46):"Y"==g_multiselect&&67==n.keyCode&&1==n.ctrlKey?(context_copy("M",g_pog_index),g_keyCode=67):89==n.keyCode?g_redo_final_obj_arr.length-1>=0&&(g_keyCode=89,undo_actions_not_delete("REDO",g_camera,g_pog_index)):90!=n.keyCode||1!=n.ctrlKey||"Y"!=g_cut_action_done&&"Y"!=g_delete_action_done&&"Y"!=g_multi_delete_done?90==n.keyCode&&1==n.ctrlKey&&"N"==g_cut_action_done&&"N"==g_delete_action_done&&"N"==g_multi_delete_done&&g_undo_final_obj_arr.length-1>=0&&(g_keyCode=90,undo_actions_not_delete("UNDO",g_camera,g_pog_index)):g_undo_final_obj_arr.length-1>=0&&(g_keyCode=90,undo_actions_not_delete("UNDO",g_camera,g_pog_index))}else console.log("incrment facings ",o,0);else 38==n.keyCode?drag_fixel(g_module_index,g_shelf_index,g_item_index,"U",g_pog_index):40==n.keyCode?drag_fixel(g_module_index,g_shelf_index,g_item_index,"D",g_pog_index):37==n.keyCode?drag_fixel(g_module_index,g_shelf_index,g_item_index,"L",g_pog_index):39==n.keyCode&&drag_fixel(g_module_index,g_shelf_index,g_item_index,"R",g_pog_index)})),window.onbeforeunload=function(e){if(g_pog_json.length>0&&"undefined"!=typeof g_pog_json&&"N"==back_clicked){sessionStorage.setItem("POGJSON",LZString.compress(JSON.stringify(g_pog_json))),sessionStorage.setItem("g_color_arr",LZString.compress(JSON.stringify(g_color_arr))),sessionStorage.setItem("g_highlightArr",LZString.compress(JSON.stringify(g_highlightArr)));try{sessionStorage.setItem("g_ItemImages",JSON.stringify(g_ItemImages)),sessionStorage.setItem("IndexedDB_ind","N")}catch{add_img_indexeddb(g_ItemImages),sessionStorage.setItem("IndexedDB_ind","Y")}"undefined"!=typeof g_scene_objects_backup&&g_scene_objects_backup.length>0&&(sessionStorage.setItem("scene_objects_backup",LZString.compress(JSON.stringify(g_scene_objects_backup))),sessionStorage.setItem("pogjson_backup",LZString.compress(JSON.stringify(g_pogjson_backup)))),sessionStorage.setItem("g_show_live_image",g_show_live_image),sessionStorage.setItem("g_show_live_image_comp",g_show_live_image_comp),sessionStorage.setItem("g_show_notch_label",g_show_notch_label),sessionStorage.setItem("g_show_fixel_label",g_show_fixel_label),sessionStorage.setItem("g_show_notch_label_comp",g_show_notch_label_comp),sessionStorage.setItem("g_show_fixel_label_comp","N"),sessionStorage.setItem("g_show_item_label",g_show_item_label),sessionStorage.setItem("g_itemSubLabelInd",g_itemSubLabelInd),sessionStorage.setItem("g_itemSubLabel",g_itemSubLabel),sessionStorage.setItem("g_show_item_desc",g_show_item_desc),sessionStorage.setItem("g_show_max_merch",g_show_max_merch),sessionStorage.setItem("g_show_item_color",g_show_item_color),sessionStorage.setItem("g_show_fixel_space",g_show_fixel_space),sessionStorage.setItem("g_max_facing_enabled",g_max_facing_enabled),sessionStorage.setItem("g_show_days_of_supply",g_show_days_of_supply),sessionStorage.setItem("g_show_days_of_supply_comp","N"),sessionStorage.setItem("g_ComViewIndex",g_ComViewIndex),sessionStorage.setItem("g_ComBaseIndex",g_ComBaseIndex),sessionStorage.setItem("g_compare_view",g_compare_view),sessionStorage.setItem("g_compare_pog_flag",g_compare_pog_flag),sessionStorage.setItem("g_edit_pallet_mod_ind",g_edit_pallet_mod_ind),sessionStorage.setItem("g_edit_pallet_shelf_ind",g_edit_pallet_shelf_ind),sessionStorage.setItem("g_overhung_shelf_active",g_overhung_shelf_active),sessionStorage.setItem("g_combinedShelfs",JSON.stringify(g_combinedShelfs)),sessionSetCombineDetails(),sessionStorage.setItem("P25_EXISTING_DRAFT_VER",$v("P25_EXISTING_DRAFT_VER")),sessionStorage.setItem("P25_DRAFT_LIST",$v("P25_DRAFT_LIST")),sessionStorage.setItem("P25_POG_DESCRIPTION",$v("P25_POG_DESCRIPTION")),sessionStorage.setItem("P25_SELECT_COLOR_TYPE",$v("P25_SELECT_COLOR_TYPE")),sessionStorage.setItem("gPogIndex",g_pog_index)}else sessionStorage.removeItem("POGJSON"),sessionStorage.removeItem("g_ItemImages"),sessionStorage.removeItem("g_show_live_image"),sessionStorage.removeItem("g_show_notch_label"),sessionStorage.removeItem("g_show_fixel_label"),sessionStorage.removeItem("g_show_item_label"),sessionStorage.removeItem("g_itemSubLabelInd"),sessionStorage.removeItem("g_itemSubLabel"),sessionStorage.removeItem("g_show_item_desc"),sessionStorage.removeItem("g_show_fixel_space"),sessionStorage.removeItem("g_show_max_merch"),sessionStorage.removeItem("g_ItemImages"),sessionStorage.removeItem("g_show_item_color"),sessionStorage.removeItem("g_max_facing_enabled"),sessionStorage.removeItem("gPogIndex"),sessionStorage.removeItem("scene_objects_backup"),sessionStorage.removeItem("pogjson_backup"),sessionStorage.removeItem("g_overhung_shelf_active")},$(document).keyup((function(e){"Escape"===e.key?(g_dblclick_opened="N","Y"==g_auto_fill_active&&"N"==g_auto_fill_reg_open?("N"==g_autofill_edit&&update_module_block_list("U",$v("P25_EDIT_BLK"),"Y"),apex.theme.openRegion("auto_fill_reg"),g_auto_fill_reg_open="Y"):"Y"==g_auto_fill_active&&"Y"==g_auto_fill_reg_open&&clear_auto_fill_coll(),$s("P25_MODULE_EDIT_IND","N"),$s("P25_SHELF_EDIT_IND","N"),$s("P25_POG_EDIT_IND","N"),$s("P25_ITEM_EDIT_IND","N"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&""!==g_module_index&&-1!==g_module_index&&""!==g_shelf_index&&-1!==g_shelf_index?""==g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].TextImg&&(g_temp_image_arr=[],$s("P25_IMG_FILENAME",""),$("#IMAGE_AREA canvas").remove(),$("#VIEW_IMAGE canvas").remove()):(g_temp_image_arr=[],$s("P25_IMG_FILENAME",""),$("#IMAGE_AREA canvas").remove(),$("#VIEW_IMAGE canvas").remove()),g_world.remove(g_targetForDragging),render(g_pog_index)):"Control"==e.key&&($("#maincanvas").css("cursor","auto"),$("#maincanvas1").css("cursor","auto"))})),$(".custom_disable").prop("disabled",(function(e,o){return!o})),$("#drawing_region .t-Region-header, #DELETE_POG, #DELETE_SHELF, #DELETE_TEXT").css("display","none"),$(".create_module, .create_shelf, .create_pegboard, .create_text, .create_hangingbar, .create_basket, .create_chest, .create_rod, .create_pallet, .create_divider").css("visibility","hidden"),$(".open_pdf, .open_fixel, .clear_item, .clear_pog_att, .clear_pog_info, .item_color_legends").css("display","block"),$("#P25_DRAFT_LIST").removeClass("apex_disabled"),"N"==$v("P25_SHOW_PRODUCT")?($(".open_product").css("display","block"),$(".close_product").css("display","none")):($(".open_product").css("display","none"),$(".close_product").css("display","block")),$("button.ui-dialog-titlebar-close").on("click",(function(e){g_dblclick_opened="N",$s("P25_UPLOAD_HIDDEN",""),$s("P25_SHELF_EDIT_IND","N"),console.log('$s("P25_SHELF_EDIT_IND"',$v("P25_SHELF_EDIT_IND")),g_multiselect="N",g_mselect_drag="N",g_ctrl_select="N",g_productselect="N",""!==g_module_index&&-1!==g_module_index&&""!==g_shelf_index&&-1!==g_shelf_index?"undefined"!=typeof g_pog_json&&g_pog_json[g_pog_index].length>0&&""==new_pogjson[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].TextImg&&(g_temp_image_arr=[],$s("P25_IMG_FILENAME",""),$("#IMAGE_AREA canvas").remove(),$("#VIEW_IMAGE canvas").remove()):(g_temp_image_arr=[],$s("P25_IMG_FILENAME",""),$("#IMAGE_AREA canvas").remove(),$("#VIEW_IMAGE canvas").remove())}));var n={autoDismiss:!0,duration:3e3};apex.theme42.configureSuccessMessages(n),void 0===apex.theme42.configureSuccessMessages.options&&(apex.theme42.configureSuccessMessages.options=n),apex.message.setThemeHooks({beforeShow:function(e,o){"success"==e&&setTimeout((function(){$(".t-Alert").fadeOut("slow")}),3e3)}}),$(".t-Button--closeAlert").click((function(){$(".t-Alert").fadeOut("slow")})),$s("P25_DRAFT_LIST",sessionStorage.getItem("P25_DRAFT_LIST")),g_color_arr=null!==sessionStorage.getItem("g_color_arr")?JSON.parse(LZString.decompress(sessionStorage.getItem("g_color_arr"))):[],g_highlightArr=null!==sessionStorage.getItem("g_highlightArr")?JSON.parse(LZString.decompress(sessionStorage.getItem("g_highlightArr"))):[],$s("P25_POG_DESCRIPTION",sessionStorage.getItem("P25_POG_DESCRIPTION")),$s("P25_EXISTING_DRAFT_VER",sessionStorage.getItem("P25_EXISTING_DRAFT_VER")),$(".input-group").on("click",".button-plus",(function(e){incrementValue(e)})),$(".input-group").on("click",".button-minus",(function(e){decrementValue(e)})),$(".input-group1").on("click",".button-plus",(function(e){incrementValue(e)})),$(".input-group1").on("click",".button-minus",(function(e){decrementValue(e)})),$(".input-group2").on("click",".button-plus",(function(e){incrementValue(e)})),$(".input-group2").on("click",".button-minus",(function(e){decrementValue(e)})),$("#item_facings div").on("keydown",".quantity-field",(function(e){if(9==e.keyCode){var o=$(e.target).attr("name"),t=$(e.target).val();t>0&&incrementValue(e,o,t)}})),g_chest_as_pegboard=$v("P25_POGCR_CHEST_AS_PEGBOARD"),g_nodataModuleName=$v("P25_POGCR_NO_DATA_MODULE_NAME"),g_lr_overhung=$v("P25_POGCR_L_R_OVERHUNG"),g_pogcr_pdf_chest_split=$v("P25_POGCR_PDF_CHEST_SPLIT"),g_start_canvas=0,g_show_fixel_space=$v("P25_POGCR_DFLT_FIXEL_AVLSPACE_LBL"),g_show_days_of_supply=$v("P25_POGCR_DFT_DAYS_OF_SUPPLY"),g_get_orient_images=$v("P25_POGCR_OTHER_ORIENTATION_IMG"),g_drag_shelf_notch=$v("P25_POGCR_DRAG_SHELF_TO_NOTCH"),g_hangbar_dft_maxmerch=parseFloat($v("P25_POGCR_HGNGBAR_DFLT_MAXMCH"))/100,g_pegboard_dft_item_depth=parseFloat($v("P25_POGCR_DFT_PEGB_ITEM_DEPTH"))/100,g_pegbrd_auto_placing=$v("P25_POGCR_PEGBOARD_AUTO_PLACING"),g_pog_index=0,g_notch_label_position=$v("P25_POGCR_NOTCH_LABEL_POSITION").toUpperCase(),g_overhung_validation=$v("P25_POGCR_OVERHUNG_VALIDTION"),g_edit_ind=$v("P25_EDIT_IND"),g_default_checkbox=$v("P25_POGCR_DIVIDER_PLACING_DFLT_CB"),g_chest_move="N",g_auto_x_space=parseFloat($v("P25_POGCR_CHEST_ITEM_H_SPC"))/100,g_auto_y_space=parseFloat($v("P25_POGCR_CHEST_ITEM_V_SPC"))/100,g_multi_select_offset_perc=parseFloat($v("P25_POGCR_MULTI_SLCT_OFFSET_PERC")),g_select_item_color_change=$v("P25_POGCR_BLINK_COLOR_CHANGE"),g_textbox_threshold_value=parseFloat($v("P25_POGCR_THRESHOLD_TEXTBOX_VALUE"))/100,g_type_pog=null!==sessionStorage.getItem("g_type_pog")?sessionStorage.getItem("g_type_pog"):"",g_open_from="",g_sublabel_type=$v("P25_POGCR_ITEM_ADDITIONAL_INFO"),g_pogcr_live_new_item=$v("P25_POGCR_LIVE_NEW_ITEM"),g_pogcr_dflt_fixel_num=$v("P25_POGCR_DFLT_FIXEL_NUM"),g_default_max_merch=$v("P25_POGCR_DFT_MAX_MERCH");var a=g_pogcr_dflt_fixel_num.split(";");$s("P25_TEXTBOX_START_WITH",a[0]),$s("P25_DIVIDER_START_WITH",a[1]),document.documentElement.style.setProperty("--product_list_blink_color",g_select_item_color_change.replace("0x","#")),g_product_list_blink=$v("P25_PRODUCT_LIST_BLINK"),g_multi_cnvs_drag_conf=$v("P25_MULTI_CNVS_DRAG_CNFRM"),g_item_stack_valid=$v("P25_POGCR_ITEM_STACK_VALID_YN"),g_wf_pog_approval_enabled=$v("P25_WF_POG_APPROVAL_ENABLED"),g_pogcr_pog_approval_for_new_pog=$v("P25_POGCR_POG_APPROVAL_FOR_NEW_POG"),g_pogcr_enbl_oos_border=$v("P25_POGCR_ENBL_OOS_BORDER"),g_pogcr_oos_border_color=$v("P25_POGCR_OOS_BORDER_COLOR"),g_pogcr_enhance_textbox_fontsize=$v("P25_POGCR_ENHANCE_TEXTBOX_FONTSIZE"),g_item_vertical_text_display=$v("P25_ITEM_CODE_VERT_ALN"),g_item_text_center_align=$v("P25_ITEM_CODE_CTR_ALN"),setParams($v("P25_POGCR_LABEL_TEXT_SIZE"),$v("P25_POGCR_STATUS_ERR_COLOR"),$v("P25_CAMERA_Z"),$v("P25_POGCR_TEXBOX_MERGE_PDF"),$v("P25_POGCR_HNGBAR_DFCNG_MAXMCH"),$v("P25_POGCR_AUTO_APLY_DEPTH_FAC"),$v("P25_POGCR_AUTO_APLY_VERT_FAC"),null,$v("P25_POGCR_ITEM_DIM_ERR_COLOR"),$v("P25_AUTO_HLITE_NON_MV_ITEM"),$v("P25_POGCR_NOIMAGE_SHOW_DESC"),$v("P25_POGCR_NOTCH_LABEL_POSITION"),$v("P25_POGCR_FIXEL_ITEM_LABEL"),$v("P25_POGCR_ITEM_DESC_VERTI"),parseFloat($v("P25_POGCR_DFT_MAX_MERCH"))),apex.actions.add({name:"create-pog",label:"Create POG",action:function(e,o,t){create_pog_modal("icon-bar","create_pog","add_pog")},shortcut:"Alt+C,N"}),apex.actions.add({name:"open-template",label:"Open Template",action:function(e,o,t){open_template()},shortcut:"Alt+C,O"}),apex.actions.add({name:"create-template",label:"New Template",action:function(e,o,t){create_pog_modal("icon-bar","create_template","add_pog")},shortcut:"Alt+C,T"}),apex.actions.add({name:"open-DPOG",label:"Open Draft POG",action:function(e,o,t){g_open_from="O",open_draft()},shortcut:"Alt+O,D"}),apex.actions.add({name:"open-EPOG",label:"Open Existing POG",action:function(e,o,t){g_open_from="O",open_pog()},shortcut:"Alt+O,E"}),apex.actions.add({name:"live-image",label:"Live Image",action:async function(e,o,t){e.preventDefault();const _=document.createElement("div");_.id="cursorOverlay",_.style.position="fixed",_.style.top=0,_.style.left=0,_.style.width="100vw",_.style.height="100vh",_.style.cursor="wait",_.style.zIndex=9999,_.style.backgroundColor="transparent",document.body.appendChild(_),await new Promise(requestAnimationFrame),await menuActions("LIVE_IMAGE","-"),document.body.removeChild(_)},shortcut:"Alt+L"}),apex.actions.add({name:"3d-view",label:"3d View",action:function(e,o,t){menuActions("OPEN_3D","-")},shortcut:"Alt+3"}),apex.actions.add({name:"Renumbering",label:"Renumbering",action:function(e,o,t){menuActions("RENUMBERING","-")},shortcut:"Alt+B,R"}),apex.actions.add({name:"Fixel-Label",label:"Fixel Label",action:function(e,o,t){menuActions("FIXEL_LABEL","-")},shortcut:"Alt+B,F"}),apex.actions.add({name:"Item-Label",label:"Item Label",action:function(e,o,t){menuActions("ITEM_LABEL","-")},shortcut:"Alt+B,I"}),apex.actions.add({name:"Notch-Label",label:"Notch Label",action:function(e,o,t){menuActions("NOTCH_LABEL","-")},shortcut:"Alt+B,U"}),apex.actions.add({name:"Recal-Compare",label:"Recal Compare",action:function(e,o,t){menuActions("Recal_Compare","-")},shortcut:"Alt+B,C"}),apex.actions.add({name:"Maxm-Label",label:"Max Merch Label",action:function(e,o,t){menuActions("FIXEL_MERCH","-")},shortcut:"Alt+B,M"}),apex.actions.add({name:"Highlight",label:"Highlight",action:function(e,o,t){menuActions("CONDITIONAL_HIGHLIGHT","-")},shortcut:"Alt+B,H"}),apex.actions.add({name:"Item-Group",label:"Item Group",action:function(e,o,t){},shortcut:"Alt+B,G"}),apex.actions.add({name:"ShowFixel-AvailSpace",label:"Show Fixel Available Space",action:function(e,o,t){menuActions("FIXEL_AVAILABLE_SPACE","-")},shortcut:"Alt+B,A"}),apex.actions.add({name:"ShowItem-Desc",label:"Show Item Description",action:function(e,o,t){menuActions("SHOW_ITEM_DESCRIPTION","-")},shortcut:"Alt+B,D"}),apex.actions.add({name:"Daysof-Supply",label:"Days of Supply",action:function(e,o,t){menuActions("SHOW_DAYS_OF_SUPPLY","-")},shortcut:"Alt+B,Q"}),apex.actions.add({name:"Clear-POGInfo",label:"Clear POG Info",action:function(e,o,t){menuActions("CLEAR_POG","-")},shortcut:"Alt+U,C"}),apex.actions.add({name:"Open-Fixel",label:"Open Fixel",action:function(e,o,t){menuActions("OPEN_FIXEL","-")},shortcut:"Alt+U,X"}),apex.actions.add({name:"Auto-AlignPeg",label:"Auto Align Pegboard Items",action:function(e,o,t){update_auto_position_peg()},shortcut:"Alt+U,P"}),apex.actions.add({name:"Generate-PDF",label:"Generate PDF",action:function(e,o,t){open_pdf()},shortcut:"Alt+U,G"}),apex.actions.add({name:"Generate-PDFOn",label:"Generate PDF Online",action:function(e,o,t){open_pdf_online()},shortcut:"Alt+U,O"}),apex.actions.add({name:"Maximize-Facing",label:"Maximize Facing",action:function(e,o,t){menuActions("MAXIMIZE_FACINGS","S")},shortcut:"Alt+U,M"}),apex.actions.add({name:"Clear-Item",label:"Clear Item",action:function(e,o,t){menuActions("CLEAR_ITEM","N")},shortcut:"Alt+U,I"}),apex.actions.add({name:"Clear-Attribute",label:"Clear Attribute",action:function(e,o,t){clear_pog_att_init("N")},shortcut:"Alt+U,A"}),apex.actions.add({name:"Maxm-FacAll",label:"Maximize Facing All",action:function(e,o,t){menuActions("MAXIMIZE_FACINGS","A")},shortcut:"Alt+U,F"}),apex.actions.add({name:"Peg-Holes",label:"Peg Holes",action:function(e,o,t){menuActions("PEG_HOLES","-")},shortcut:"Alt+U,H"}),apex.actions.add({name:"Peg-Tages",label:"Peg Tages",action:function(e,o,t){menuActions("PEG_TAGS","-")},shortcut:"Alt+U,T"}),apex.actions.add({name:"Reset-Zoom",label:"Reset Zoom",action:function(e,o,t){menuActions("RESET_ZOOM","-")},shortcut:"Alt+Z,R"}),apex.actions.add({name:"area-zoom",label:"Area Zoom",action:function(e,o,t){menuActions("AREA_ZOOM","-")},shortcut:"Alt+Z,A"}),apex.actions.add({name:"area-zoomarea",label:"Area Zoom Area",action:function(e,o,t){menuActions("AREA_ZOOM_AREA","-")},shortcut:"Alt+Z,S"}),apex.actions.add({name:"Auto-Position",label:"Auto Position",action:function(e,o,t){menuActions("AUTO_POSITION","-")},shortcut:"Alt+A,A"}),apex.actions.add({name:"Auto-PosiALL",label:"Auto Position ALL",action:function(e,o,t){menuActions("AUTO_POSITION_ALL","-")},shortcut:"Alt+A,L"}),apex.actions.add({name:"Auto-PosiPeg",label:"Auto Position Pegboard",action:function(e,o,t){menuActions("AUTO_POSITION_PEG","-")},shortcut:"Alt+A,E"}),apex.actions.add({name:"Open-Product",label:"Open Product",action:function(e,o,t){open_product("OPEN")},shortcut:"Alt+P"}),apex.actions.add({name:"Compare-POG",label:"Compare POG",action:function(e,o,t){menuActions("COMPARE_POG","-")},shortcut:"Alt+V,C"}),apex.actions.add({name:"Previous-Version",label:"Previous Version",action:function(e,o,t){menuActions("PREV_VERSION","-")},shortcut:"Alt+V,P"}),apex.actions.add({name:"Compare-Diff-Pog",label:"Compare POG",action:function(e,o,t){menuActions("PREV_VERSION","DIFF")}}),apex.actions.add({name:"Left",label:"Left",action:function(e,o,t){menuActions("CREATE_SIDE_VIEW","LEFT")},shortcut:"Alt+V,L"}),apex.actions.add({name:"Right",label:"Right",action:function(e,o,t){menuActions("CREATE_SIDE_VIEW","RIGHT")},shortcut:"Alt+V,R"}),apex.actions.add({name:"Top",label:"Top",action:function(e,o,t){menuActions("CREATE_SIDE_VIEW","TOP")},shortcut:"Alt+V,T"}),apex.actions.add({name:"Bottom",label:"Bottom",action:function(e,o,t){menuActions("CREATE_SIDE_VIEW","BOTTOM")},shortcut:"Alt+V,B"}),apex.actions.add({name:"Back",label:"Back",action:function(e,o,t){menuActions("CREATE_SIDE_VIEW","BACK")},shortcut:"Alt+V,K"}),apex.actions.add({name:"cutaway",label:"CutAway",action:function(e,o,t){menuActions("CREATE_SIDE_VIEW","CUTAWAY")},shortcut:"Alt+V,A"}),apex.actions.add({name:"edit-pallet",label:"Edit Pallet",action:function(e,o,t){menuActions("EDIT_PALLET","-")},shortcut:"Alt+V,E"}),apex.actions.add({name:"Close-Compare",label:"Close Compare",action:function(e,o,t){menuActions("CLOSE_COMPARE","-")},shortcut:"Alt+V,X"}),apex.actions.add({name:"Planogram-Itemdtls",label:"Planogram Item Details",action:function(e,o,t){open_pog_report("PLANOGRAM_ITEM_DETAIL")},shortcut:"Alt+R,P"}),apex.actions.add({name:"Inout-Items",label:"In & Out Items",action:function(e,o,t){open_pog_report("IN_OUT_ITEMS_WPD_SCRN")},shortcut:"Alt+R,I"}),apex.actions.add({name:"auto-fIll-pog",label:"Auto Fill POG",action:function(e,o,t){auto_fill_setup(g_pog_index)},shortcut:"Alt+I"}),apex.actions.add({name:"create-shelf",label:"create shelf",action:function(e,o,t){open_modal("icon-bar","create_shelf","add_shelf")},shortcut:"Space,S"}),apex.actions.add({name:"Create-Module",label:"Create Module",action:function(e,o,t){open_modal("icon-bar","create_module","add_module")},shortcut:"Space,M"}),apex.actions.add({name:"create-Pegboard",label:"Create Pegboard",action:function(e,o,t){open_modal("icon-bar","create_pegboard","add_shelf")},shortcut:"Space,G"}),apex.actions.add({name:"create-Text",label:"Create Text",action:function(e,o,t){open_modal("icon-bar","create_text","add_textbox")},shortcut:"Space,T"}),apex.actions.add({name:"create-hangingbar",label:"Create Hangingbar",action:function(e,o,t){open_modal("icon-bar","create_hangingbar","add_shelf")},shortcut:"Space,B"}),apex.actions.add({name:"create-basket",label:"Create Basket",action:function(e,o,t){open_modal("icon-bar","create_basket","add_shelf")},shortcut:"Space,K"}),apex.actions.add({name:"create-chest",label:"Create Chest",action:function(e,o,t){open_modal("icon-bar","create_chest","add_shelf")},shortcut:"Space,C"}),apex.actions.add({name:"create-rod",label:"Create Rod",action:function(e,o,t){open_modal("icon-bar","create_rod","add_shelf")},shortcut:"Space,R"}),apex.actions.add({name:"create-pallet",label:"Create Pallet",action:function(e,o,t){open_modal("icon-bar","create_pallet","add_shelf")},shortcut:"Space,P"}),apex.actions.add({name:"create-divider",label:"Create Divider",action:function(e,o,t){open_modal("icon-bar","create_divider","add_divider")},shortcut:"Space,D"}),apex.actions.add({name:"download-Tem",label:"Download Temp",action:function(e,o,t){export_temp()},shortcut:"Alt+E,D"}),apex.actions.add({name:"import-Tem",label:"Import Temp",action:function(e,o,t){import_temp()},shortcut:"Alt+E,I"}),apex.actions.add({name:"save-pog",label:"Save POG",action:function(e,o,t){save_pog()},shortcut:"Alt+S"}),apex.actions.add({name:"save-draft",label:"Save Draft",action:function(e,o,t){open_save_draft()},shortcut:"Alt+D"}),apex.actions.add({name:"save-Template",label:"Save Template",action:function(e,o,t){save_template()},shortcut:"Alt+T"}),apex.actions.add({name:"save-wpog",label:"Save WPOG",action:function(e,o,t){save_pog_final("Y")},shortcut:"Alt+W"}),apex.actions.add({name:"Item-Gbrand",label:"Item Gbrand",action:function(e,o,t){menuActions("SHOW_ITEM_COLOR","IB")},shortcut:"Alt+G,B"}),apex.actions.add({name:"Item-Gsupp",label:"Item Gsupp",action:function(e,o,t){menuActions("SHOW_ITEM_COLOR","IS")},shortcut:"Alt+G,S"}),apex.actions.add({name:"Item-Glabel",label:"Item Glabel",action:function(e,o,t){menuActions("SHOW_ITEM_COLOR","IG")},shortcut:"Alt+G,L"}),apex.actions.add({name:"Item-Gdept",label:"Item Gdept",action:function(e,o,t){menuActions("SHOW_ITEM_COLOR","ID")},shortcut:"Alt+G,D"}),apex.actions.add({name:"Item-Gclasslabel",label:"Item Gclasslabel",action:function(e,o,t){menuActions("SHOW_ITEM_COLOR","IL")},shortcut:"Alt+G,C"}),apex.actions.add({name:"Item-Gsubclasslabel",label:"Item Gsubclasslabel",action:function(e,o,t){menuActions("SHOW_ITEM_COLOR","IC")},shortcut:"Alt+G,A"}),apex.actions.add({name:"Item-Gcdtlvl1",label:"Item Gcdtlvl1",action:function(e,o,t){menuActions("SHOW_ITEM_COLOR","ICDT1")},shortcut:"Alt+G,1"}),apex.actions.add({name:"Item-Gcdtlvl2",label:"Item Gcdtlvl2",action:function(e,o,t){menuActions("SHOW_ITEM_COLOR","ICDT2")},shortcut:"Alt+G,2"}),apex.actions.add({name:"Item-Gcdtlvl3",label:"Item Gcdtlvl3",action:function(e,o,t){menuActions("SHOW_ITEM_COLOR","ICDT3")},shortcut:"Alt+G,3"}),apex.actions.add({name:"Item-Goff",label:"Item Goff",action:function(e,o,t){menuActions("SHOW_ITEM_COLOR","OFF")},shortcut:"Alt+G,O"}),apex.actions.add({name:"shortcut",label:"shortcut",action:function(e,o,t){openInlineDialog("shortcut",35,45)},shortcut:"Alt+K"}),apex.actions.add({name:"Overhung-Shelf",label:"Overhung Shelf",action:function(e,o,t){menuActions("ACTIVATE_OVERHUNG_SHELF","-")},shortcut:"Alt+B,O"}),apex.actions.add({name:"POG-Exception-Report",label:"POG-Exception-Report",action:function(e,o,t){open_pog_report("POG_EXCEPTION_WPD_SCRN")},shortcut:"Alt+R,X"}),apex.actions.add({name:"Refresh-Sales",label:"Refresh Sales",action:function(e,o,t){menuActions("REFRESH_SALES","-")},shortcut:"Alt+U,R"}),apex.actions.add({name:"Refresh-Items",label:"Refresh Items",action:function(e,o,t){menuActions("REFRESH_ITEMS","-")},shortcut:"Alt+U,U"}),apex.actions.add({name:"Label-LOnOff",label:"Label LOnOff",action:function(e,o,t){menuActions("SHOW_ITEM_SUBLBL","")},shortcut:"Alt+H,L"}),apex.actions.add({name:"Label-Product",label:"Label product",action:function(e,o,t){menuActions("SHOW_ITEM_SUBLBL","LPR")},shortcut:"Alt+H,I"}),apex.actions.add({name:"Label-Qty",label:"Label Qty",action:function(e,o,t){menuActions("SHOW_ITEM_SUBLBL","LQT")},shortcut:"Alt+H,Q"}),apex.actions.add({name:"Label-Sales",label:"Label Sales",action:function(e,o,t){menuActions("SHOW_ITEM_SUBLBL","LSL")},shortcut:"Alt+H,S"}),apex.actions.add({name:"Label-Tstock",label:"Label Tstock",action:function(e,o,t){menuActions("SHOW_ITEM_SUBLBL","LST")},shortcut:"Alt+H,T"}),apex.actions.add({name:"Label-Dpp",label:"Label Dpp",action:function(e,o,t){menuActions("SHOW_ITEM_SUBLBL","LDP")},shortcut:"Alt+H,P"}),apex.actions.add({name:"Label-CountStore",label:"Label CountStore",action:function(e,o,t){menuActions("SHOW_ITEM_SUBLBL","LSC")},shortcut:"Alt+H,C"}),apex.actions.add({name:"Label-Nproduct",label:"Label Nproduct",action:function(e,o,t){menuActions("SHOW_ITEM_SUBLBL","LNP")},shortcut:"Alt+H,N"}),apex.actions.add({name:"Label-Cos",label:"Label Cos",action:function(e,o,t){menuActions("SHOW_ITEM_SUBLBL","COS")},shortcut:"Alt+H,O"}),apex.actions.add({name:"Label-Dos",label:"Label Dos",action:function(e,o,t){menuActions("SHOW_ITEM_SUBLBL","DOS")},shortcut:"Alt+H,D"}),apex.actions.add({name:"Label-SalesUnit",label:"Label_SalesUnit",action:function(e,o,t){menuActions("SHOW_ITEM_SUBLBL","SU")},shortcut:"Alt+H,U"}),apex.actions.add({name:"Label-SalesValue",label:"Label SalesValue",action:function(e,o,t){menuActions("SHOW_ITEM_SUBLBL","SV")},shortcut:"Alt+H,V"}),apex.actions.add({name:"Label-VrmPer",label:"Label VrmPer",action:function(e,o,t){menuActions("SHOW_ITEM_SUBLBL","VRMPer")},shortcut:"Alt+H,R"}),apex.actions.add({name:"Label-Edlp",label:"Label Edlp",action:function(e,o,t){menuActions("SHOW_ITEM_SUBLBL","EDLP")},shortcut:"Alt+H,E"}),apex.actions.add({name:"Refresh-Auto-Div",label:"Refresh-Auto-Div",action:function(e,o,t){menuActions("REFRESH_AUTO_DIVIDER")},shortcut:"Alt+R,A"}),apex.actions.add({name:"Add-POG",label:"Add-POG",action:function(e,o,t){menuActions("Add_POG")},shortcut:"Alt+A,P"}),apex.actions.add({name:"Open-PAR",label:"Open-PAR",action:function(e,o,t){open_product("OPEN_PAR")},shortcut:"Alt+A,R"}),apex.actions.add({name:"Auto-PosiALLNoSbSh",label:"Auto-PosiALLNoSbSh",action:function(e,o,t){menuActions("AUTO_POSITION_NO_SUBSHLF","-")},shortcut:"Alt+A,X"}),underlineMenuKey();var i=document.getElementById("t_Header"),d=document.getElementById("t_Body_title"),l=document.getElementById("top_bar"),r=document.getElementById("t_Body_nav"),g=document.getElementById("side_bar"),s=window.devicePixelRatio;g_start_pixel_ratio=s;var f=i.offsetHeight*s,p=d.offsetHeight*s,c=l.offsetHeight*s,I=r.offsetWidth*s,u=g.offsetWidth*s;g_windowHeight=window.innerHeight-(f+p+c),g_windowWidth=window.innerWidth-(I+u),$("#canvas-holder").css("height",g_windowHeight);const m=document.querySelector("#canvas-list-holder");let h,S,O=!1;m.addEventListener("mousedown",(e=>{O=!0,h=e.pageX-m.offsetLeft,S=m.scrollLeft})),m.addEventListener("mouseleave",(()=>{O=!1})),m.addEventListener("mouseup",(()=>{O=!1})),m.addEventListener("mousemove",(e=>{if(!O)return;e.preventDefault();const o=e.pageX-m.offsetLeft-h;m.scrollLeft=S-o})),set_status(),$('[aria-describedby="add_textbox"]').on("keydown",(function(e){13==e.keyCode&&(e.preventDefault(),$("#CREATE_TEXT").click())})),$('[aria-describedby="add_divider"]').on("keydown",(function(e){13==e.keyCode&&(e.preventDefault(),$("#CREATE_DIVIDER").click())})),apex._originalShowSpinner=apex._originalShowSpinner||apex.util.showSpinner,$("div.a-TreeView-content").click((function(e){e.preventDefault();const o=$(this).find("a.a-TreeView-label")[0],t=$(o).attr("href");apex.util.showSpinner=function(){$.unblockUI(),$("#apex_wait_popup").css("visibility","hidden"),$("#apex_wait_overlay").css("visibility","hidden"),$(".u-Processing").css("visibility","hidden")},apex.message.confirm(get_message("NAV_BAR_REDIR_CONF"),(function(e){e?window.location.href=t:apex.util.showSpinner=apex._originalShowSpinner}))})),logDebug("onload code ; ","E")}function set_curr_canvas(e){if("CANVAS"==e.target.nodeName){if("mousemove"!==e.type)g_canvas=e.target,"mousedown"==e.type&&(g_all_pog_flag="N"),g_pog_index=parseInt(g_canvas.getAttribute("data-indx")),null==g_pog_index&&(g_pog_index=0);else e.target;if(g_scene_objects.length>0&&void 0!==g_scene_objects[g_pog_index]&&(g_scene=g_scene_objects[g_pog_index].scene,g_camera=g_scene.children[0],g_world=g_scene.children[2],g_renderer=g_scene_objects[g_pog_index].renderer,void 0!==g_pog_json[g_pog_index]&&"N"==g_all_pog_flag&&($s("P25_OPEN_POG_CODE",g_pog_json[g_pog_index].POGCode),$s("P25_OPEN_POG_VERSION",g_pog_json[g_pog_index].Version)),void 0!==g_scene_objects[g_pog_index].Indicators&&(g_show_fixel_label=g_scene_objects[g_pog_index].Indicators.FixelLabel,g_show_item_label=g_scene_objects[g_pog_index].Indicators.ItemLabel,g_show_notch_label=g_scene_objects[g_pog_index].Indicators.NotchLabel,g_show_max_merch=g_scene_objects[g_pog_index].Indicators.MaxMerch,g_show_item_color=g_scene_objects[g_pog_index].Indicators.ItemColor,g_show_item_desc=g_scene_objects[g_pog_index].Indicators.ItemDesc,g_show_live_image=g_scene_objects[g_pog_index].Indicators.LiveImage,g_show_days_of_supply=g_scene_objects[g_pog_index].Indicators.DaysOfSupply,g_overhung_shelf_active=g_scene_objects[g_pog_index].Indicators.OverhungShelf,g_itemSubLabelInd=g_scene_objects[g_pog_index].Indicators.ItemSubLabelInd,g_itemSubLabel=g_scene_objects[g_pog_index].Indicators.ItemSubLabel),"mousedown"==e.type||"contextmenu"==e.type||"dblclick"==e.type)){var o=g_canvas.getAttribute("id");$("[data-pog]").removeClass("multiPogList_active"),$(".canvas_highlight").removeClass("canvas_highlight"),$("#"+o+"-btns").addClass("canvas_highlight"),$("[data-indx="+g_pog_index+"]").addClass("multiPogList_active"),g_all_pog_flag="N"}}}function set_select_canvas(e){if(g_scene_objects.length>0&&void 0!==g_scene_objects[e]&&(g_scene=g_scene_objects[e].scene,g_camera=g_scene.children[0],g_world=g_scene.children[2],g_renderer=g_scene_objects[e].renderer,$s("P25_OPEN_POG_CODE",g_pog_json[e].POGCode),$s("P25_OPEN_POG_VERSION",g_pog_json[e].Version),void 0!==g_scene_objects[e].Indicators&&(g_show_fixel_label=g_scene_objects[e].Indicators.FixelLabel,g_show_item_label=g_scene_objects[e].Indicators.ItemLabel,g_show_notch_label=g_scene_objects[e].Indicators.NotchLabel,g_show_max_merch=g_scene_objects[e].Indicators.MaxMerch,g_show_item_color=g_scene_objects[e].Indicators.ItemColor,g_show_item_desc=g_scene_objects[e].Indicators.ItemDesc,g_show_live_image=g_scene_objects[e].Indicators.LiveImage,g_show_days_of_supply=g_scene_objects[e].Indicators.DaysOfSupply,g_overhung_shelf_active=g_scene_objects[e].Indicators.OverhungShelf,g_itemSubLabelInd=g_scene_objects[g_pog_index].Indicators.ItemSubLabelInd,g_itemSubLabel=g_scene_objects[g_pog_index].Indicators.ItemSubLabel),void 0!==g_canvas_objects[e])){var o=g_canvas_objects[e].getAttribute("id");$("[data-pog]").removeClass("multiPogList_active"),$(".canvas_highlight").removeClass("canvas_highlight"),$("#"+o+"-btns").addClass("canvas_highlight"),$("[data-indx="+e+"]").addClass("multiPogList_active"),g_all_pog_flag="N"}}function init(e){logDebug("function : init","S");try{var o="maincanvas";(e=parseInt(e))>0&&(o="maincanvas"+(e+1)),g_canvas=document.getElementById(o),g_canvas.setAttribute("data-indx",e),$("#"+o).droppable({tolerance:"pointer",drop:function(e,o){create_action(o.helper.children(),e),$("#draggable_table .a-GV-w-scroll tr.selected").removeClass("selected")}}),g_canvas_region=document.getElementById("drawing_region"),g_selection=document.getElementById("selection"),g_canvas_objects.push(g_canvas),g_canvas.addEventListener("mousewheel",onDocumentMouseWheel,!1)}catch(e){return void(document.getElementById("canvas-holder").innerHTML="<p><b>Sorry, an error occurred:<br>"+e+"</b></p>")}createWorld(),console.log("scene",g_scene.uuid,g_scene),g_raycaster=new THREE.Raycaster,g_multiselect="N",g_ctrl_select="N";var t=document.getElementById("t_Header"),_=document.getElementById("t_Body_title"),n=document.getElementById("top_bar"),a=document.getElementById("t_Body_nav"),i=document.getElementById("side_bar"),d=window.devicePixelRatio;g_start_pixel_ratio=d;var l=t.offsetHeight*d,r=_.offsetHeight*d,g=n.offsetHeight*d,s=a.offsetWidth*d,f=i.offsetWidth*d;g_selection.style.visibility="hidden",setUpMouseHander("maincanvas",doMouseDown,doMouseMove,doMouseUp,doMouseDoubleclick,g_canvas),e>0&&makeResizableDiv(o),g_tanFOV=Math.tan(Math.PI/180*g_camera.fov/2),g_windowHeight=window.innerHeight-(l+r+g),windowWidth=window.innerWidth-(s+f),g_initial_windowHeight=window.innerHeight-(l+r+g);var p=$("#"+o).parent()[0].offsetHeight,c=$("#"+o).parent()[0].offsetWidth;console.log("canvasContainerH",p,"canvasContainerW",c);var I=$("#"+o+"-btns")[0],u=c,m=p-(void 0!==I?I.offsetHeight:0);$("#"+o).css("height",m+"px !important").css("width",u+"px !important"),g_canvas.width=u,g_canvas.height=m,g_camera.aspect=u/m,g_camera.fov=360/Math.PI*Math.atan(g_tanFOV),g_camera.updateProjectionMatrix(),g_renderer.setSize(u,m),g_cut_support_obj_arr=[],loc_details={},g_cut_action_done="N",g_copy_action_done="N",g_delete_action_done="N",g_multi_delete_done="N",g_dup_action_done="N",g_multi_copy_done="N",g_curr_canvas=1,$(".peg_holes").addClass("peg_hole_acive"),window.addEventListener("resize",onWindowResize,!1),"Y"!=$v("P25_DELETE_IND")&&"Y"!=$v("P25_EDIT_IND")||window.addEventListener("contextmenu",onContextMenu,!1),window.addEventListener("click",(function(e){"button-plus"!==$(e.target).attr("class")&&"button-minus"!==$(e.target).attr("class")&&"quantity-field"!==$(e.target).attr("class")&&(document.getElementById("context-menu").classList.remove("active"),g_context_opened="N"),logo_clicked="N",void 0!==$(e.target).attr("id")?$(e.target).attr("id").startsWith("CUSTOM_COLOR")||$("#co-color-list").slideUp("fast",(function(){$("#co-color-list").css("display","none"),openChooseColor=!1})):"t-Icon fa fa-eyedropper"==$(e.target).attr("class")?console.log(" else if ",$(e.target).attr("class")):$("#co-color-list").slideUp("fast",(function(){$("#co-color-list").css("display","none"),openChooseColor=!1}))})),logDebug("function : init","E")}function onDocumentMouseWheel(e){logDebug("function : onDocumentMouseWheel","S");var o=g_canvas.getAttribute("id");if(console.log("jselector",o,e.target.nodeName,e.ctrlKey),"CANVAS"==e.target.nodeName)if(e.ctrlKey){g_duplicating="N",e.preventDefault(),e.stopPropagation(),g_manual_zoom_ind="Y";var t=g_canvas.getBoundingClientRect(),_=e.clientX-t.left,n=e.clientY-t.top,a=parseFloat($v("P25_POGCR_CAMERA_ZOOM_FACTOR")),i=2*_/(g_canvas.width/window.devicePixelRatio)-1,d=1-2*n/(g_canvas.height/window.devicePixelRatio),l=new THREE.Vector3(i,d,e.deltaY/500);l.unproject(g_camera),l.sub(g_camera.position),e.deltaY<0?($(o).css("cursor","zoom-in"),g_camera.position.addVectors(g_camera.position,l.setLength(a))):($(o).css("cursor","zoom-out"),g_camera.position.subVectors(g_camera.position,l.setLength(a))),render(g_pog_index)}else if("Y"==g_manual_zoom_ind){var r=parseFloat($v("P25_POGCR_WHEEL_UP_DOWN_INTER"));e.deltaY<0?g_camera.position.set(g_camera.position.x,g_camera.position.y+r,g_camera.position.z):e.deltaY>0&&g_camera.position.set(g_camera.position.x,g_camera.position.y-r,g_camera.position.z),render(g_pog_index)}logDebug("function : onDocumentMouseWheel","E")}function onContextMenu(e){logDebug("function : onContextMenu","S");var o="N";if("CANVAS"==e.target.nodeName&&g_scene_objects.length>0){set_curr_canvas(e),g_canvas=e.target,g_pog_index=parseInt(g_canvas.getAttribute("data-indx")),g_context_opened="Y";"Y"==g_compare_pog_flag&&5,console.log("event",e.target,g_pog_index);var t=g_canvas.getBoundingClientRect(),_=t.left,n=t.top,a=e.clientX-t.left,i=e.clientY-t.top;if(prevX=startX=a,prevY=startY=i,g_dragging=doMouseDown(a,i,_,n,e,g_canvas,"Y",g_pog_index),console.log("constext ",g_start_canvas,g_ComViewIndex,g_compare_view,g_compare_pog_flag),"N"==g_carpark_item_flag&&"N"==g_carpark_edit_flag&&(g_start_canvas==g_ComViewIndex&&"POG"==g_compare_view&&"Y"==g_compare_pog_flag||g_start_canvas!==g_ComViewIndex&&"Y"==g_compare_pog_flag||"N"==g_compare_pog_flag)){e.preventDefault(),new_details=JSON.parse(JSON.stringify(g_delete_details));for(const e of new_details)e.ShelfInfo="";"Y"!=g_multiselect&&"Y"!=g_ctrl_select||!(new_details.length>0)||"EDIT_PALLET"===g_compare_view||-1==g_shelf_index&&-1==g_item_index?(g_multiselect="N",g_ctrl_select="N",$("#context-menu a.edit_color").css("display","none"),$("#context-menu a.multi_edit").css("display","none"),g_mselect_drag="N",g_pog_json.length>1?$("#context-menu a.multedit").css("display","block"):$("#context-menu a.multedit").css("display","none"),"Y"==g_cut_action_done||"Y"==g_copy_action_done||"Y"==g_multi_copy_done?$("#context-menu a.paste").css("color","white").attr("onclick",'context_func("paste","RESET_PASTE")').css("cursor","pointer"):$("#context-menu a.paste").removeAttr("onclick").css("cursor","auto").css("color","grey"),"Y"==$v("P25_DELETE_IND")?$("#context-menu a.delete").css("display","block"):$("#context-menu a.delete").css("display","none"),"Y"==$v("P25_EDIT_IND")?($("#context-menu a.cut, #context-menu a.copy, #context-menu a.paste, #context-menu a.edit").css("display","block"),"Y"==g_shelf_edit_flag&&"EDIT_PALLET"!==g_compare_view?($("#context-menu a.edit_location, #context-menu a.duplicate").css("display","block"),$("#context-menu a.edit_facings, #context-menu a.edit_color, #context-menu a.multedit, #context-menu a.edit_item_loc").css("display","none"),"SHELF"==g_shelf_object_type||"HANGINGBAR"==g_shelf_object_type?($("#context-menu a.spread_product").css("display","block"),$(".submenu").css("top","50%")):$("#context-menu a.spread_product").css("display","none")):"Y"==g_item_edit_flag&&"DIVIDER"==g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Item?("DIVIDER"==g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Item?$("#context-menu a.edit_location").css("display","block"):$("#context-menu a.edit_location").css("display","none"),$("#context-menu a.duplicate").css("display","block"),$("#context-menu a.edit_facings, #context-menu a.spread_product, #context-menu a.edit_color, #context-menu a.multedit, #context-menu a.edit_item_loc").css("display","none")):($("#context-menu a.edit_item_loc").css("display","none"),$("#context-menu a.edit_location, #context-menu a.duplicate").css("display","none"),"Y"==g_item_edit_flag&&"DIVIDER"!==g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Item?("CHEST"==g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType&&"Y"==g_chest_as_pegboard&&$("#context-menu a.edit_item_loc").css("display","block"),void 0!==g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].BottomObjID&&""!==g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].BottomObjID||void 0!==g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].TopObjID&&""!==g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].TopObjID?$(".input-group").css("display","none"):($(".input-group").css("display",""),$("#context-menu a.multedit").css("display","none")),$(".input-group2").css("display",""),$('input[name="horizfacing"]').val(g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].BHoriz),$('input[name="vertfacing"]').val(g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].BVert),$('input[name="depthfacing"]').val(g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].BaseD),"FACING_CHANGE"===g_prev_undo_action||""!=g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].OldItemBaseHoriz&&void 0!==g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].OldItemBaseHoriz||(g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].OldItemBaseHoriz=g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].BHoriz,g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].OldItemBaseVert=g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].BVert,g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].OldItemBaseDepth=g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].BaseD),g_incre_mod_index=g_module_index,g_incre_shelf_index=g_shelf_index,g_incre_item_index=g_item_index,"Y"==$v("P25_POGCR_DISPLAY_ITEM")&&3==g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].MerchStyle?$("#context-menu a.edit_facings").css("display","none"):$("#context-menu a.edit_facings").css("display","block"),$(".facing_submenu").css("top","74%"),$("#context-menu a.edit_color").css("display","block"),$("#context-menu a.duplicate").css("display","none")):$("#context-menu a.edit_facings").css("display","none"),"Y"==g_module_edit_flag&&$("#context-menu a.multedit").css("display","none"),$("#context-menu a.spread_product").css("display","none"))):$("#context-menu a.cut, #context-menu a.copy, #context-menu a.paste, #context-menu a.edit, #context-menu a.edit_location, #context-menu a.duplicate, #context-menu a.edit_facings, #context-menu a.spread_product").css("display","none")):($("#context-menu a.cut, #context-menu a.edit, #context-menu a.edit_location, #context-menu a.duplicate, #context-menu a.edit_item_loc").css("display","none"),$("#context-menu a.copy, #context-menu a.paste").css("display","block"),g_pog_json.length>1?$("#context-menu a.multedit").css("display","block"):$("#context-menu a.multedit").css("display","none"),"Y"==g_cut_action_done||"Y"==g_copy_action_done||"Y"==g_multi_copy_done?$("#context-menu a.paste").css("color","white").attr("onclick",'context_func("paste","RESET_PASTE")').css("cursor","pointer"):$("#context-menu a.paste").removeAttr("onclick").css("cursor","auto").css("color","grey"),JsonContains(new_details,"Object","SHELF")&&JsonContains(new_details,"ObjType","SHELF")&&JsonContains(new_details,"Object","ITEM")?($(".edit_products, .edit_fixtures, #context-menu a.spread_product, #context-menu a.multi_edit").css("display","block"),g_mselect_drag="Y",$(".edit_submenu").css("top","85%"),$(".submenu").css("top","50%"),JsonContains(new_details,"Object","ITEM")?($("#context-menu a.edit_facings").css("display","block"),$('input[name="horizfacing"]').val(""),$('input[name="vertfacing"]').val(""),$('input[name="depthfacing"]').val(""),$(".facing_submenu").css("top","57%"),$(".submenu").css("top","43%")):$("#context-menu a.edit_facings").css("display","none")):JsonContains(new_details,"Object","SHELF")&&JsonContains(new_details,"ObjType","SHELF")?($(".edit_fixtures, #context-menu a.spread_product, #context-menu a.multi_edit").css("display","block"),$(".edit_products").css("display","none"),g_mselect_drag="Y",$(".edit_submenu").css("top","85%"),$(".submenu").css("top","50%"),$("#context-menu a.edit_facings").css("display","none")):JsonContains(new_details,"Object","ITEM")?($("#context-menu a.multi_edit").css("display","block"),g_mselect_drag="Y",$(".edit_products").css("display","block"),$("#context-menu a.multedit").css("display","none"),$(".edit_fixtures").css("display","none"),$(".edit_submenu").css("top","83%"),void 0!==g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index]&&"Y"==$v("P25_POGCR_DISPLAY_ITEM")&&3==g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].MerchStyle?$("#context-menu a.edit_facings").css("display","none"):$("#context-menu a.edit_facings").css("display","block"),$('input[name="horizfacing"]').val(""),$('input[name="vertfacing"]').val(""),$('input[name="depthfacing"]').val(""),$("#context-menu a.spread_product").css("display","none"),$(".facing_submenu").css("top","50%")):JsonContains(new_details,"Object","SHELF")&&JsonContains(new_details,"ObjType","TEXTBOX")?($(".edit_fixtures, #context-menu a.multi_edit").css("display","block"),$(".edit_products").css("display","none"),g_mselect_drag="Y",$(".edit_submenu").css("top","85%"),$(".submenu").css("top","50%"),$("#context-menu a.edit_facings").css("display","none")):$("#context-menu a.spread_product, #context-menu a.edit_facings").css("display","none"),JsonContains(new_details,"Object","SHELF")||JsonContains(new_details,"Object","ITEM")?$("#context-menu a.edit_color").css("display","block"):(console.log("new_details context 7",new_details),$("#context-menu a.edit_color").css("display","none")),"Y"==$v("P25_DELETE_IND")?$("#context-menu a.delete").css("display","block"):$("#context-menu a.delete").css("display","none")),o="Y"}else"Y"==g_carpark_item_flag&&(e.preventDefault(),$("#context-menu a.cut, #context-menu a.copy, #context-menu a.paste, #context-menu a.edit_location, #context-menu a.duplicate, #context-menu a.edit_facings, #context-menu a.spread_product, #context-menu a.delete, #context-menu a.edit_color, #context-menu a.multi_edit, #context-menu a.multedit, #context-menu a.edit_item_loc").css("display","none"),g_mselect_drag="N",$("#context-menu a.edit").css("display","block"),o="Y");if("Y"==o){var d=document.getElementById("t_Header"),l=document.getElementById("t_Body_title"),r=document.getElementById("top_bar"),g=document.getElementById("t_Body_nav"),s=document.getElementById("side_bar"),f=document.getElementById("maincanvas-btns"),p=(null!=f&&f.offsetHeight,window.devicePixelRatio,parseFloat($(".t-Body-contentInner").css("padding-left").replace("px","")),d.offsetHeight,l.offsetHeight,r.offsetHeight,g.offsetWidth),c=s.offsetWidth,I=document.getElementById("context-menu"),u=parseInt(e.clientX-$(".t-Region-body").scrollLeft()+I.offsetWidth),m=parseInt($(window).width()-(p+c)),h=parseInt(e.clientX-$(".t-Region-body").scrollLeft()+I.offsetWidth);e.clientY>window.innerHeight/2?I.style.top=e.clientY-$(document).scrollTop()-I.offsetHeight+"px":I.style.top=e.clientY-$(document).scrollTop()+"px",u>m&&("Y"==g_shelf_edit_flag||"Y"==g_item_edit_flag)?(I.style.left=e.clientX-$(".t-Region-body").scrollLeft()-I.offsetWidth+"px","Y"==g_shelf_edit_flag?$(".submenu").css("right","100%"):$(".facing_submenu").css("right","100%"),$(".edit_submenu").css("right","190px")):h>m?(I.style.left=e.clientX-$(".t-Region-body").scrollLeft()-I.offsetWidth+"px",$(".submenu").css("right","-200px"),$(".edit_submenu").css("right","-200px"),$(".facing_submenu").css("right","-190px")):(I.style.left=e.clientX-$(".t-Region-body").scrollLeft()+"px",$(".submenu").css("right","-200px"),$(".edit_submenu").css("right","-200px"),e.clientX>m/2?$(".facing_submenu").css("right","100%"):$(".facing_submenu").css("right","-190px")),console.log("contextElement.style.top",I.style.top,I.style.left,e),I.classList.add("active")}}logDebug("function : onContextMenu","E")}async function onWindowResize(e){logDebug("function : onWindowResize","S");try{var o=document.getElementById("t_Header"),t=document.getElementById("t_Body_title"),_=document.getElementById("top_bar"),n=document.getElementById("t_Body_nav"),a=document.getElementById("side_bar"),i=window.devicePixelRatio,d=o.offsetHeight*i,l=t.offsetHeight*i,r=_.offsetHeight*i,g=n.offsetWidth*i,s=a.offsetWidth*i,f=parseFloat($(".t-Body-contentInner").css("padding-left").replace("px",""));i>2.5?(g_windowHeight=window.innerHeight-(d+l+r/2),windowWidth=window.innerWidth-(g+s+f)):(g_windowHeight=window.innerHeight-(d+l+r+r+10),windowWidth=window.innerWidth-(g+s+f+10)),g_tanFOV=Math.tan(Math.PI/180*g_camera.fov/2);i=window.devicePixelRatio;if(console.log(" resizing ",g_start_pixel_ratio,i),g_start_pixel_ratio!==i){var p=JSON.parse(JSON.stringify(g_pog_json));g_pog_json=[],appendMultiCanvasRowCol(p.length,$v("P25_POGCR_TILE_VIEW")),g_pog_index=0,g_multi_pog_json=[],g_scene_objects=[],g_canvas_objects=[],addLoadingIndicator();for(var c=0;c<=p.length-1;c++){g_pog_index=c,init(c),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects);await create_module_from_json(p,sessionStorage.getItem("new_pog_ind"),"F",$v("P25_PRODUCT_BTN_CLICK"),sessionStorage.getItem("pog_opened"),"N","N","Y","Y","","N",g_scene_objects[c].scene.children[0],g_scene_objects[c].scene,g_pog_index,c);g_pog_index=c,render(c),animate_pog(c)}removeLoadingIndicator(regionloadWait),g_pog_json=g_multi_pog_json}g_renderer.render(g_scene,g_camera),logDebug("function : onWindowResize","E")}catch(e){error_handling(e)}}async function create_module_from_json(e,o,t,_,n,a,i,d,l,r,g,s,f,p,c,I="N",u="N",m=[]){try{if(console.log("value",e,o,t,_,n,d,l,$v("P25_VDATE"),$v("P25_POG_POG_DEFAULT_COLOR"),$v("P25_POG_MODULE_DEFAULT_COLOR"),r,!0,"N",null,$v("P25_POGCR_DFT_SPREAD_PRODUCT"),parseFloat($v("P25_PEGB_DFT_HORIZ_SPACING")),parseFloat($v("P25_PEGBOARD_DFT_VERT_SPACING")),parseFloat($v("P25_BASKET_DFT_WALL_THICKNESS")),parseFloat($v("P25_CHEST_DFT_WALL_THICKNESS")),$v("P25_POGCR_PEGB_MAX_ARRANGE"),$v("P25_POGCR_DEFAULT_WRAP_TEXT"),parseInt($v("P25_POGCR_TEXT_DEFAULT_SIZE")),$v("P25_POG_TEXTBOX_DEFAULT_COLOR"),$v("P25_POG_SHELF_DEFAULT_COLOR"),$v("P25_DIV_COLOR"),$v("P25_SLOT_DIVIDER"),$v("P25_SLOT_ORIENTATION"),$v("P25_DIVIDER_FIXED"),$v("P25_POG_ITEM_DEFAULT_COLOR"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),g_peg_holes_active,$v("P25_POG_CP_SHELF_DFLT_COLOR"),3,$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_NOTCH_HEAD"),"N",$v("P25_POGCR_DFT_BASKET_FILL"),$v("P25_POGCR_DFT_BASKET_SPREAD"),s,p,c,$v("P25_POGCR_NOTCH_START_VALUE"),$v("P25_POGCR_MANUAL_CRUSH_ITEM"),"Y",""),await create_module_from_json_lib(e,o,t,_,n,d,l,$v("P25_VDATE"),$v("P25_POG_POG_DEFAULT_COLOR"),$v("P25_POG_MODULE_DEFAULT_COLOR"),r,!0,"N",null,$v("P25_POGCR_DFT_SPREAD_PRODUCT"),parseFloat($v("P25_PEGB_DFT_HORIZ_SPACING")),parseFloat($v("P25_PEGBOARD_DFT_VERT_SPACING")),parseFloat($v("P25_BASKET_DFT_WALL_THICKNESS")),parseFloat($v("P25_CHEST_DFT_WALL_THICKNESS")),$v("P25_POGCR_PEGB_MAX_ARRANGE"),$v("P25_POGCR_DEFAULT_WRAP_TEXT"),parseInt($v("P25_POGCR_TEXT_DEFAULT_SIZE")),$v("P25_POG_TEXTBOX_DEFAULT_COLOR"),$v("P25_POG_SHELF_DEFAULT_COLOR"),$v("P25_DIV_COLOR"),$v("P25_SLOT_DIVIDER"),$v("P25_SLOT_ORIENTATION"),$v("P25_DIVIDER_FIXED"),$v("P25_POG_ITEM_DEFAULT_COLOR"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),g_peg_holes_active,$v("P25_POG_CP_SHELF_DFLT_COLOR"),3,$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_NOTCH_HEAD"),"N",$v("P25_POGCR_DFT_BASKET_FILL"),$v("P25_POGCR_DFT_BASKET_SPREAD"),s,p,c,$v("P25_POGCR_NOTCH_START_VALUE"),$v("P25_POGCR_MANUAL_CRUSH_ITEM"),"Y",""),g_pog_json[p].MassUpdate="N",$("#P25_POG_SUBDEPT").on("apexafterrefresh",(function(){void 0!==g_pog_json[p]&&apex.item(this).setValue(g_pog_json[p].SubDept)})),$("#P25_POG_DEPT").on("apexafterrefresh",(function(){void 0!==g_pog_json[p]&&apex.item(this).setValue(g_pog_json[p].Dept)})),apex.item("P25_POG_DIVISION").setValue(g_pog_json[p].Division),"N"==i&&"Y"==d&&c==p)await enableDisableFlags(p);if("Y"==d){if("undefined"!=typeof g_pog_json&&g_pog_json.length>0&&backupPog("F",-1,-1,p),"DB"==$v("P25_POGCR_LOAD_IMG_FROM")&&"N"==_&&"N"==i&&"N"==I)await get_all_images(p,g_get_orient_images,"N",$v("P25_POGCR_IMG_MAX_WIDTH"),$v("P25_POGCR_IMG_MAX_HEIGHT"),$v("P25_IMAGE_COMPRESS_RATIO"));if("N"==a&&"Y"==i){var h="E"==n?"E":"D",S={SeqNo:"",POGCode:g_pog_json[p].POGCode,POGVersion:g_pog_json[p].Version,POGModule:"",Selection_Type:h,Print_Type:"P",SequenceId:"",TemplateId:$v("P25_PDF_TEMPLATE").split("-")[0],TemplateDetails:$v("P25_PDF_TEMPLATE")};await create_pdf(S,g,"N",s,h,$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_NOTCH_HEAD"),"Y",p,"Y",g_all_pog_flag,$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),"","",g_hide_show_dos_label,"Y",$v("P25_POGCR_ENHANCE_PDF_IMG"),$v("P25_POGCR_PDF_IMG_ENHANCE_RATIO"),$v("P25_POGCR_PDF_CANVAS_SIZE"),$v("P25_VDATE"),$v("P25_POG_POG_DEFAULT_COLOR"),$v("P25_POG_MODULE_DEFAULT_COLOR"),$v("P25_POGCR_DFT_SPREAD_PRODUCT"),$v("P25_PEGB_DFT_HORIZ_SPACING"),$v("P25_PEGBOARD_DFT_VERT_SPACING"),$v("P25_BASKET_DFT_WALL_THICKNESS"),$v("P25_CHEST_DFT_WALL_THICKNESS"),$v("P25_POGCR_PEGB_MAX_ARRANGE"),$v("P25_POGCR_DEFAULT_WRAP_TEXT"),$v("P25_POGCR_TEXT_DEFAULT_SIZE"),$v("P25_POG_TEXTBOX_DEFAULT_COLOR"),$v("P25_POG_SHELF_DEFAULT_COLOR"),$v("P25_DIV_COLOR"),$v("P25_SLOT_DIVIDER"),$v("P25_SLOT_ORIENTATION"),$v("P25_DIVIDER_FIXED"),$v("P25_POG_ITEM_DEFAULT_COLOR"),$v("P25_POGCR_DFT_BASKET_FILL"),$v("P25_POGCR_DFT_BASKET_SPREAD"),$v("P25_POGCR_BAY_LIVE_IMAGE"),$v("P25_POGCR_BAY_WITHOUT_LIVE_IMAGE"),"N")}$(".live_image").css("color","white").css("cursor","pointer"),$(".open_pdf").css("color","black").css("cursor","pointer"),$(".open_pdf_online").css("color","black").css("cursor","pointer")}if(g_ItemImages.length>0&&"Y"==g_show_live_image&&"Y"==d)try{if($(".live_image").addClass("live_image_active"),"N"==i&&"N"==_&&"N"==$v("P25_POGCR_DFT_ITEM_DESC")&&"N"==I){await recreate_image_items("Y",$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_NOTCH_HEAD"),p,g_show_days_of_supply,$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label);g_imagesShown="Y"}}catch(e){error_handling(e)}"N"==g_isPogItemsSet&&set_pog_page_items(p),"Y"==g_show_item_color?$(".item_color_legends").css("display","block"):$(".item_color_legends").css("display","none");var O=0;for(const e of g_pog_json[p].ModuleInfo){if(void 0===e.ParentModule||null==e.ParentModule){var M=0;for(const o of e.ShelfInfo){if("TEXTBOX"==o.ObjType){var x=g_world.getObjectById(g_pog_json[p].ModuleInfo[O].ShelfInfo[M].SObjID);void 0!==x&&(x.ShelfInfo=g_pog_json[p].ModuleInfo[O].ShelfInfo[M],textboxPriorityPlacing(x,p,g_pog_json[p].ModuleInfo[O].ShelfInfo[M].Z))}M++}}O++}}catch(e){error_handling(e)}return"SUCCESS"}async function create_shelf_edit_pog(e,o,t,_,n,a,i,d,l,r){logDebug("function : create_shelf_edit_pog; mod_index : "+e+"; p_module_width : "+t+"; draft_ind : "+_+"; new_pog_ind : "+n+"; pog_type : "+a+"; carpark_ind : "+i+"; recreate : "+d,"S");try{return create_shelf_edit_pog_lib(e,o,t,_,n,a,i,d,l,$v("P25_POGCR_DFT_SPREAD_PRODUCT"),$v("P25_POG_SHELF_DEFAULT_COLOR"),$v("P25_DIV_COLOR"),$v("P25_SLOT_DIVIDER"),$v("P25_SLOT_ORIENTATION"),$v("P25_DIVIDER_FIXED"),$v("P25_POG_ITEM_DEFAULT_COLOR"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_POG_CP_SHELF_DFLT_COLOR"),3,$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_NOTCH_HEAD"),"Y",g_camera,r,r,$v("P25_POGCR_MANUAL_CRUSH_ITEM"))}catch(e){error_handling(e)}}async function add_pog(e,o,t,_,n,a,i,d,l,r,g){logDebug("function : add_pog; uuid : "+e+"; width : "+o+"; height : "+t+"; depth : "+_+"; color : "+n+"; color_hex : "+a+"; x : "+i+"; y : "+d+"; p_edit_ind : "+l,"S");try{var s=[],f=0!=JSON.parse(sessionStorage.getItem("fixtureDimension")).length?JSON.parse(sessionStorage.getItem("fixtureDimension")):[{InnerDepth:1e3*_,InnerHeight:1e3*t,InnerWidth:1e3*o}],p=0;if("Y"==l){for(const e of g_pog_json[g].ModuleInfo){var c=g_world.getObjectById(e.MObjID);g_world.remove(c),p++}s=JSON.parse(g_temp_POG_arr),g_pog_json[g].ModuleInfo.splice(0),base_height=s[g].BaseH,s[g].ModuleInfo.sort(((e,o)=>e.Module>o.Module&&(null==e.ParentModule||null==o.ParentModule)?1:-1))}var I=[],u=g_pog_json[g].SegmentW,m=g_pog_json[g].SegmentW;if("A"==$v("P25_POG_MODULE_NAME_TYPE"))var h="A";else h=1;if("Y"==g_is_pog_template_open){var S=-1;for(p=0;p<f.length;p++){var O={};(v={}).SeqNo=p+1,v.Module=h,v.ParentModule=null,v.ParentModuleIndex="",v.POGModuleName="",v.SubDept=g_pog_json[g].SubDept,v.Remarks="",v.H=wpdSetFixed(parseFloat(f[p].InnerHeight/1e3)-g_pog_json[g].BaseH),v.W=wpdSetFixed(f[p].InnerWidth/1e3),v.D=wpdSetFixed(f[p].InnerDepth/1e3),v.Color=n,v.Rotation="",v.NotchW=g_pog_json[g].NotchW,v.NotchStart=g_pog_json[g].NotchStart,v.NotchSpacing=g_pog_json[g].NotchSpacing,v.HorzStart=g_pog_json[g].HorzStart,v.HorzSpacing=g_pog_json[g].HorzSpacing,v.VertStart=g_pog_json[g].VertStart,v.VertSpacing=g_pog_json[g].VertSpacing,v.AllowOverlap=g_pog_json[g].AllowOverlap,v.LNotch="",v.Backboard="",v.RNotch="",v.CompMObjID=void 0!==g_pog_json[g].ModuleInfo[p]?g_pog_json[g].ModuleInfo[p].CompMObjID:"",v.LastCount=0,v.EditFlag="Y",v.Carpark=[],v.ShelfInfo=[],v.ChestInfo=[],g_pog_json[g].ModuleInfo.push(v),g_pog_json[g].NotchW>0&&((O={}).Shelf=get_message("LEFT_NOTCH",h),O.ObjType="NOTCH",O.Desc="",O.MaxMerch=0,O.GrillH=0,O.LOverhang=0,O.ROverhang=0,O.SpacerThick=0,O.HorizGap=0,O.SpreadItem="L",O.Combine="N",O.AllowAutoCrush="N",O.H=v.H,O.W=g_pog_json[g].NotchW,O.D=v.D,O.Rotation=0,O.Slope=0,O.Color=n,O.LiveImage="",O.HorizSlotStart=0,O.HorizSlotSpacing=0,O.HorizStart=0,O.HorizSpacing=0,O.UOverHang=0,O.LoOverHang=0,O.VertiStart=0,O.VertiSpacing=0,O.X=i-v.W/2,O.Y=d,O.Z=0,O.InputText="",O.WrapText="",O.ReduceToFit="",O.TextDirection="",O.BsktFill="",O.BsktSpreadProduct="",O.SnapTo="",O.BsktWallH=0,O.BsktBaseH=0,O.BsktWallThickness=0,O.DSlotStart=0,O.DSlotSpacing=0,O.DGap=0,O.FrontOverHang=0,O.BackOverHang=0,O.SlotDivider="",O.AllowOverLap="N",O.AutoPlacing="N",O.AutoFillPeg="N",O.SlotOrientation="",O.DividerFixed="N",O.LObjID=-1,O.NotchLabelObjID=-1,O.FStyle="",O.FSize="",O.FBold="",O.TextImg="",O.TextImgName="",O.TextImgMime="",O.ItemInfo=[],O.Overhung="N",g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo.push(O),(O={}).Shelf=get_message("RIGHT_NOTCH",h),O.ObjType="NOTCH",O.Desc="",O.MaxMerch=0,O.GrillH=0,O.LOverhang=0,O.ROverhang=0,O.SpacerThick=0,O.HorizGap=0,O.SpreadItem="L",O.Combine="N",O.AllowAutoCrush="N",O.H=v.H,O.W=g_pog_json[g].NotchW,O.D=v.D,O.Rotation=0,O.Slope=0,O.Color=n,O.LiveImage="",O.HorizSlotStart=0,O.HorizSlotSpacing=0,O.HorizStart=0,O.HorizSpacing=0,O.UOverHang=0,O.LoOverHang=0,O.VertiStart=0,O.VertiSpacing=0,O.X=i+v.W/2-g_pog_json[g].NotchW,O.Y=d,O.Z=0,O.InputText="",O.WrapText="",O.ReduceToFit="",O.TextDirection="",O.BsktFill="",O.BsktSpreadProduct="",O.SnapTo="",O.BsktWallH=0,O.BsktBaseH=0,O.BsktWallThickness=0,O.DSlotStart=0,O.DSlotSpacing=0,O.DGap=0,O.FrontOverHang=0,O.BackOverHang=0,O.SlotDivider="",O.AllowOverLap="N",O.AutoPlacing="N",O.AutoFillPeg="N",O.SlotOrientation="",O.DividerFixed="N",O.LObjID=-1,O.NotchLabelObjID=-1,O.FStyle="",O.FSize="",O.FBold="",O.TextImg="",O.TextImgName="",O.TextImgMime="",O.ItemInfo=[],O.Overhung="N",g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo.push(O));await add_module(h,v.W,v.H,v.D,a,i,d,"N","Y",v.VertStart,v.VertSpacing,v.HorzStart,v.HorzSpacing,"Y",r,g_pog_json[g].ModuleInfo.length-1,g);if(g_pog_json[g].NotchW>0&&(g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo[g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo.length-2].X=g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].X-v.W/2,g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo[g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo.length-2].Y=g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].Y,g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo[g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo.length-1].X=g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].X+v.W/2-g_pog_json[g].NotchW,g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo[g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo.length-1].Y=g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].Y),"Y"==l&&void 0!==s[g].ModuleInfo[p]&&void 0!==s[g].ModuleInfo[p].ShelfInfo){var M=s[g].ModuleInfo,x=0;for(const e of M){if(void 0===e.ParentModule||null==e.ParentModule&&x>S){S=x,g_pog_json[g].ModuleInfo[p].SubDept=e.SubDept,g_pog_json[g].ModuleInfo[p].Remarks=e.Remarks;await create_shelf_edit_pog(p,s[g].ModuleInfo[x].ShelfInfo,e.W,"Y","Y","D","N","Y","Y",g,g);break}x+=1}}if("A"==$v("P25_POG_MODULE_NAME_TYPE"))h=nextLetter(h);else h=g_pog_json[g].ModuleInfo.length+1}}else if(g_pog_json[g].SegmentW==o){O={};(v={}).SeqNo=1,v.Module=h,v.ParentModule=null,v.ParentModuleIndex="",v.POGModuleName="",v.SubDept=g_pog_json[g].SubDept,v.Remarks="",v.H=parseFloat(t)-g_pog_json[g].BaseH,v.W=o,v.D=_,v.Color=n,v.Rotation="",v.NotchW=g_pog_json[g].NotchW,v.NotchStart=g_pog_json[g].NotchStart,v.NotchSpacing=g_pog_json[g].NotchSpacing,v.HorzStart=g_pog_json[g].HorzStart,v.HorzSpacing=g_pog_json[g].HorzSpacing,v.VertStart=g_pog_json[g].VertStart,v.VertSpacing=g_pog_json[g].VertSpacing,v.AllowOverlap=g_pog_json[g].AllowOverlap,v.LNotch="",v.Backboard="",v.RNotch="",v.LastCount=0,v.CompMObjID=void 0!==g_pog_json[g].ModuleInfo[0]?g_pog_json[g].ModuleInfo[0].CompMObjID:"",v.Carpark=[],v.EditFlag="Y",v.ShelfInfo=[],v.ChestInfo=[],g_pog_json[g].ModuleInfo.push(v),g_pog_json[g].NotchW>0&&((O={}).Shelf=get_message("LEFT_NOTCH",h),O.ObjType="NOTCH",O.Desc="",O.MaxMerch=0,O.GrillH=0,O.LOverhang=0,O.ROverhang=0,O.SpacerThick=0,O.HorizGap=0,O.SpreadItem="L",O.Combine="N",O.AllowAutoCrush="N",O.H=v.H,O.W=g_pog_json[g].NotchW,O.D=_,O.Rotation=0,O.Slope=0,O.Color=n,O.LiveImage="",O.HorizSlotStart=0,O.HorizSlotSpacing=0,O.HorizStart=0,O.HorizSpacing=0,O.UOverHang=0,O.LoOverHang=0,O.VertiStart=0,O.VertiSpacing=0,O.X=i-v.W/2,O.Y=d,O.Z=0,O.InputText="",O.WrapText="",O.ReduceToFit="",O.TextDirection="",O.BsktFill="",O.BsktSpreadProduct="",O.SnapTo="",O.BsktWallH=0,O.BsktBaseH=0,O.BsktWallThickness=0,O.DSlotStart=0,O.DSlotSpacing=0,O.DGap=0,O.FrontOverHang=0,O.BackOverHang=0,O.SlotDivider="",O.AllowOverLap="N",O.AutoPlacing="N",O.AutoFillPeg="N",O.SlotOrientation="",O.DividerFixed="N",O.LObjID=-1,O.NotchLabelObjID=-1,O.ItemInfo=[],O.FStyle="",O.FSize="",O.FBold="",O.TextImg="",O.TextImgName="",O.TextImgMime="",O.Overhung="N",g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo.push(O),(O={}).Shelf=get_message("RIGHT_NOTCH",h),O.ObjType="NOTCH",O.Desc="",O.MaxMerch=0,O.GrillH=0,O.LOverhang=0,O.ROverhang=0,O.SpacerThick=0,O.HorizGap=0,O.SpreadItem="L",O.Combine="N",O.AllowAutoCrush="N",O.H=v.H,O.W=g_pog_json[g].NotchW,O.D=_,O.Rotation=0,O.Slope=0,O.Color=n,O.LiveImage="",O.HorizSlotStart=0,O.HorizSlotSpacing=0,O.HorizStart=0,O.HorizSpacing=0,O.UOverHang=0,O.LoOverHang=0,O.VertiStart=0,O.VertiSpacing=0,O.X=i+v.W/2-g_pog_json[g].NotchW,O.Y=d,O.Z=0,O.InputText="",O.WrapText="",O.ReduceToFit="",O.TextDirection="",O.BsktFill="",O.BsktSpreadProduct="",O.SnapTo="",O.BsktWallH=0,O.BsktBaseH=0,O.BsktWallThickness=0,O.DSlotStart=0,O.DSlotSpacing=0,O.DGap=0,O.FrontOverHang=0,O.BackOverHang=0,O.SlotDivider="",O.AllowOverLap="N",O.AutoPlacing="N",O.AutoFillPeg="N",O.SlotOrientation="",O.DividerFixed="N",O.LObjID=-1,O.NotchLabelObjID=-1,O.ItemInfo=[],O.FStyle="",O.FSize="",O.FBold="",O.TextImg="",O.TextImgName="",O.TextImgMime="",O.Overhung="N",g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo.push(O));await add_module($v("P25_POG_MODULE"),o,v.H,_,a,i,d,"N","Y",v.VertStart,v.VertSpacing,v.HorzStart,v.HorzSpacing,"Y",r,g_pog_json[g].ModuleInfo.length-1,g);if(g_pog_json[g].NotchW>0&&(g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo[g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo.length-2].X=g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].X-v.W/2,g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo[g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo.length-2].Y=g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].Y,g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo[g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo.length-1].X=g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].X+g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].W/2-g_pog_json[g].NotchW,g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo[g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo.length-1].Y=g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].Y),"Y"==l&&void 0!==s[g].ModuleInfo&&void 0!==s[g_pog_json[g].ModuleInfo.length-1].ModuleInfo[0].ShelfInfo){M=s[g].ModuleInfo,p=0;for(const e of M){if(void 0===e.ParentModule||null==e.ParentModule){if(g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].SubDept=e.SubDept,g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].Remarks=e.Remarks,void 0!==e.Carpark&&e.Carpark.length>0)await create_shelf_edit_pog(0,s[g].ModuleInfo[p].Carpark,o,"Y","Y","D","Y","Y","Y",g,g);await create_shelf_edit_pog(0,s[g].ModuleInfo[p].ShelfInfo,o,"Y","Y","D","N","Y","Y",g,g);break}p+=1}}}else{I.push(u);for(p=0;p<1e3&&wpdSetFixed(m+=u)<=wpdSetFixed(o);p++)I.push(parseFloat(u));S=-1;for(p=0;p<I.length;p++){O={};(v={}).SeqNo=p+1,v.Module=h,v.ParentModule=null,v.ParentModuleIndex="",v.POGModuleName="",v.SubDept=g_pog_json[g].SubDept,v.Remarks="",v.H=parseFloat(t)-g_pog_json[g].BaseH,v.W=I[p],v.D=_,v.Color=n,v.Rotation="",v.NotchW=g_pog_json[g].NotchW,v.NotchStart=g_pog_json[g].NotchStart,v.NotchSpacing=g_pog_json[g].NotchSpacing,v.HorzStart=g_pog_json[g].HorzStart,v.HorzSpacing=g_pog_json[g].HorzSpacing,v.VertStart=g_pog_json[g].VertStart,v.VertSpacing=g_pog_json[g].VertSpacing,v.AllowOverlap=g_pog_json[g].AllowOverlap,v.LNotch="",v.Backboard="",v.RNotch="",v.CompMObjID=void 0!==g_pog_json[g].ModuleInfo[p]?g_pog_json[g].ModuleInfo[p].CompMObjID:"",v.LastCount=0,v.EditFlag="Y",v.Carpark=[],v.ShelfInfo=[],v.ChestInfo=[],g_pog_json[g].ModuleInfo.push(v),g_pog_json[g].NotchW>0&&((O={}).Shelf=get_message("LEFT_NOTCH",h),O.ObjType="NOTCH",O.Desc="",O.MaxMerch=0,O.GrillH=0,O.LOverhang=0,O.ROverhang=0,O.SpacerThick=0,O.HorizGap=0,O.SpreadItem="L",O.Combine="N",O.AllowAutoCrush="N",O.H=v.H,O.W=g_pog_json[g].NotchW,O.D=_,O.Rotation=0,O.Slope=0,O.Color=n,O.LiveImage="",O.HorizSlotStart=0,O.HorizSlotSpacing=0,O.HorizStart=0,O.HorizSpacing=0,O.UOverHang=0,O.LoOverHang=0,O.VertiStart=0,O.VertiSpacing=0,O.X=i-v.W/2,O.Y=d,O.Z=0,O.InputText="",O.WrapText="",O.ReduceToFit="",O.TextDirection="",O.BsktFill="",O.BsktSpreadProduct="",O.SnapTo="",O.BsktWallH=0,O.BsktBaseH=0,O.BsktWallThickness=0,O.DSlotStart=0,O.DSlotSpacing=0,O.DGap=0,O.FrontOverHang=0,O.BackOverHang=0,O.SlotDivider="",O.AllowOverLap="N",O.AutoPlacing="N",O.AutoFillPeg="N",O.SlotOrientation="",O.DividerFixed="N",O.LObjID=-1,O.NotchLabelObjID=-1,O.FStyle="",O.FSize="",O.FBold="",O.TextImg="",O.TextImgName="",O.TextImgMime="",O.ItemInfo=[],O.Overhung="N",g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo.push(O),(O={}).Shelf=get_message("RIGHT_NOTCH",h),O.ObjType="NOTCH",O.Desc="",O.MaxMerch=0,O.GrillH=0,O.LOverhang=0,O.ROverhang=0,O.SpacerThick=0,O.HorizGap=0,O.SpreadItem="L",O.Combine="N",O.AllowAutoCrush="N",O.H=v.H,O.W=g_pog_json[g].NotchW,O.D=_,O.Rotation=0,O.Slope=0,O.Color=n,O.LiveImage="",O.HorizSlotStart=0,O.HorizSlotSpacing=0,O.HorizStart=0,O.HorizSpacing=0,O.UOverHang=0,O.LoOverHang=0,O.VertiStart=0,O.VertiSpacing=0,O.X=i+v.W/2-g_pog_json[g].NotchW,O.Y=d,O.Z=0,O.InputText="",O.WrapText="",O.ReduceToFit="",O.TextDirection="",O.BsktFill="",O.BsktSpreadProduct="",O.SnapTo="",O.BsktWallH=0,O.BsktBaseH=0,O.BsktWallThickness=0,O.DSlotStart=0,O.DSlotSpacing=0,O.DGap=0,O.FrontOverHang=0,O.BackOverHang=0,O.SlotDivider="",O.AllowOverLap="N",O.AutoPlacing="N",O.AutoFillPeg="N",O.SlotOrientation="",O.DividerFixed="N",O.LObjID=-1,O.NotchLabelObjID=-1,O.FStyle="",O.FSize="",O.FBold="",O.TextImg="",O.TextImgName="",O.TextImgMime="",O.ItemInfo=[],O.Overhung="N",g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo.push(O));await add_module(h,I[p],v.H,_,a,i,d,"N","Y",v.VertStart,v.VertSpacing,v.HorzStart,v.HorzSpacing,"Y",r,g_pog_json[g].ModuleInfo.length-1,g);if(g_pog_json[g].NotchW>0&&(g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo[g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo.length-2].X=g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].X-I[p]/2,g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo[g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo.length-2].Y=g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].Y,g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo[g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo.length-1].X=g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].X+I[p]/2-g_pog_json[g].NotchW,g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo[g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].ShelfInfo.length-1].Y=g_pog_json[g].ModuleInfo[g_pog_json[g].ModuleInfo.length-1].Y),"Y"==l&&void 0!==s[g].ModuleInfo[p]&&void 0!==s[g].ModuleInfo[p].ShelfInfo){M=s[g].ModuleInfo,x=0;for(const e of M){if(void 0===e.ParentModule||null==e.ParentModule&&x>S){if(S=x,g_pog_json[g].ModuleInfo[p].SubDept=e.SubDept,g_pog_json[g].ModuleInfo[p].Remarks=e.Remarks,void 0!==e.Carpark&&e.Carpark.length>0)await create_shelf_edit_pog(p,s[g].ModuleInfo[p].Carpark,o,"Y","Y","D","Y","Y","Y",g,g);await create_shelf_edit_pog(p,s[g].ModuleInfo[x].ShelfInfo,I[p],"Y","Y","D","N","Y","Y",g,g);break}x+=1}}if("A"==$v("P25_POG_MODULE_NAME_TYPE"))h=nextLetter(h);else h=g_pog_json[g].ModuleInfo.length+1}}if("Y"==l){p=0;for(const e of s[g].ModuleInfo){var v;if(null!==e.ParentModule&&"undefined"!==e.ParentModule)(v={SeqNo:0}).Module=e.Module,v.ParentModule=e.ParentModule,v.ParentModuleIndex=e.ParentModuleIndex,v.POGModuleName=e.ModuleName,v.SubDept=e.SubDept,v.Remarks=e.Remarks,v.H=e.H,v.W=e.W,v.D=e.D,v.Color=e.Color,v.Rotation=e.Rotation,v.NotchW=e.NotchW,v.NotchStart=e.NotchStart,v.NotchSpacing=e.NotchSpacing,v.HorzStart=e.HorzStart,v.HorzSpacing=e.HorzSpacing,v.VertStart=e.VertStart,v.VertSpacing=e.VertSpacing,v.AllowOverlap=e.AllowOverlap,v.LNotch=e.LNotch,v.Backboard=e.Backboard,v.RNotch=e.RNotch,v.LastCount=0,v.ShelfInfo=e.ShelfInfo,g_pog_json[g].ModuleInfo.push(v);p++}}module_arr=g_pog_json[g].ModuleInfo,module_info_arr=g_pog_json[g].ModuleInfo;p=0;for(const e of module_arr)if(null!==e.ParentModule&&"undefined"!==e.ParentModule){x=0;for(const o of module_info_arr)e.ParentModule==o.Module&&(g_pog_json[g].ModuleInfo[p].ParentModuleIndex=x),x++;p++}add_pog_code_header();var D=get_min_max_xy(g).split("###");set_camera_z(r,parseFloat(D[2]),parseFloat(D[3]),parseFloat(D[0]),parseFloat(D[1]),g_offset_z,parseFloat(D[4]),parseFloat(D[5]),!0,g),render(g),logDebug("function : add_pog","E")}catch(e){error_handling(e)}}function add_pog_base(e,o,t,_,n,a,i,d,l){logDebug("function : add_pog_base; uuid : "+e+"; width : "+o+"; height : "+t+"; depth : "+_+"; color : "+n+"; x : "+a+"; y : "+i+"; p_edit_ind : "+d,"S");try{if("Y"==d){var r=g_scene_objects[l].scene.children[2].getObjectById(g_pog_json[l].BaseObjID);g_scene_objects[l].scene.children[2].remove(r)}g_pog_base=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshStandardMaterial({color:n}));var g=add_wireframe(g_pog_base,2);g_pog_base.position.x=a,g_pog_base.position.y=i,g_pog_base.position.z=0,g_pog_base.uuid=e,g_scene_objects[l].scene.children[2].add(g_pog_base),g_pog_json[l].BaseObjID=g_pog_base.id,g_pog_json[l].BaseX=a,g_pog_json[l].BaseY=i,g_pog_json[l].BaseZ=0,g_pog_json[l].WFrameID=g,logDebug("function : add_pog_base","E")}catch(e){error_handling(e)}}async function add_module(e,o,t,_,n,a,i,d,l,r,g,s,f,p,c,I){try{var u;return logDebug("function : add_module; uuid : "+e+"; width : "+o+"; height : "+t+"; depth : "+_+"; color : "+n+"; x : "+a+"; y : "+i+"; p_edit_ind : "+d+"; pog_flag : "+l+"; vert_start : "+r+"; vert_spacing : "+g+"; horz_start : "+s+"; horz_spacing : "+f+"; recreate : "+p+"; module_ind : "+I,"S"),u=await add_module_lib(e,o,t,_,n,a,i,d,l,r,g,s,f,p,c,I,$v("P25_POGCR_DFT_SPREAD_PRODUCT"),parseFloat($v("P25_PEGB_DFT_HORIZ_SPACING")),parseFloat($v("P25_PEGBOARD_DFT_VERT_SPACING")),parseFloat($v("P25_BASKET_DFT_WALL_THICKNESS")),parseFloat($v("P25_CHEST_DFT_WALL_THICKNESS")),$v("P25_POGCR_PEGB_MAX_ARRANGE"),$v("P25_POGCR_DEFAULT_WRAP_TEXT"),parseInt($v("P25_POGCR_TEXT_DEFAULT_SIZE")),$v("P25_POG_TEXTBOX_DEFAULT_COLOR"),$v("P25_POG_SHELF_DEFAULT_COLOR"),$v("P25_DIV_COLOR"),$v("P25_SLOT_DIVIDER"),$v("P25_SLOT_ORIENTATION"),$("P25_DIVIDER_FIXED"),$v("P25_POG_ITEM_DEFAULT_COLOR"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),g_peg_holes_active,$v("P25_POG_CP_SHELF_DFLT_COLOR"),3,$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_NOTCH_HEAD"),"Y",g_pog_index,$v("P25_POGCR_DFT_BASKET_FILL"),$v("P25_POGCR_DFT_BASKET_SPREAD"),$v("P25_POGCR_MANUAL_CRUSH_ITEM")),$s("P25_MODULE_EDIT_IND","N"),u}catch(e){error_handling(e)}}async function delete_module(e,o,t,_){logDebug("function : delete_module; object_id : "+e+"; mod_index : "+o,"S");try{return new Promise((function(e,n){!async function(){if(g_pog_json[_].ModuleInfo[o].ShelfInfo.length>0)for(const e of g_pog_json[_].ModuleInfo[o].ShelfInfo){var n=g_scene_objects[_].scene.children[2].getObjectById(e.SObjID);if(g_scene_objects[_].scene.children[2].remove(n),void 0!==typeof e.ItemInfo){var a=0;for(const o of e.ItemInfo){n=g_scene_objects[_].scene.children[2].getObjectById(o.ObjID);g_scene_objects[_].scene.children[2].remove(n),a++}}}for(n=g_scene_objects[_].scene.children[2].getObjectById(g_pog_json[_].ModuleInfo[o].MObjID),g_scene_objects[_].scene.children[2].remove(n),a=0;a<=20;a++){n=g_scene_objects[_].scene.children[2].getObjectByProperty("uuid","BASE1");g_scene_objects[_].scene.children[2].remove(n)}var i=get_min_max_xy(_).split("###");if(console.log("details_arr",i),set_camera_z(t,parseFloat(i[2]),parseFloat(i[3]),parseFloat(i[0]),parseFloat(i[1]),g_offset_z,parseFloat(i[4]),parseFloat(i[5]),!0,g_pog_index),render(_),a=0,g_pog_json[_].ModuleInfo[o].ShelfInfo.length>0)for(const e of g_pog_json[_].ModuleInfo[o].ShelfInfo){var d=g_pog_json[_].ModuleInfo[o].ShelfInfo[a].ItemInfo;for(const e of d)g_deletedItems.push(e.ItemID);a+=1}g_pog_json[_].W=g_pog_json[_].W-g_pog_json[_].ModuleInfo[o].W,0==o?g_pog_json[_].ModuleInfo.splice(o,o+1):g_pog_json[_].ModuleInfo.splice(o,1);var l=g_pog_json[_].W,r=0;for(const e of g_pog_json[_].ModuleInfo)null!=e.ParentModule&&"undefined"!=e.ParentModule||r++;var g=0,s=0;for(const e of g_pog_json[_].ModuleInfo)g=Math.max(g,e.H),null!=e.ParentModule&&void 0!==e.ParentModule||(s+=e.W);if(g_pog_json[_].PrevH=g_pog_json[_].H,g_pog_json[_].PrevW=g_pog_json[_].W,g_pog_json[_].H=g+g_pog_json[_].BaseH,g_pog_json[_].W=s,r>0){await deleted_items_log(g_deletedItems,"D",_),await context_create_module("",t,"Y",_,"N");if(g_pog_json[_].BaseH>0){var f=parseInt(g_pog_json[_].Color.replace("#","0x"),16),p=new THREE.Color(f);g_pog_json[_].BaseW=l,g_pog_json[_].BaseX=l/2;add_base("BASE1",l,g_pog_json[_].BaseH,g_pog_json[_].BaseD,p,l/2,g_pog_json[_].BaseY,"Y",_)}i=get_min_max_xy(_).split("###");set_camera_z(t,parseFloat(i[2]),parseFloat(i[3]),parseFloat(i[0]),parseFloat(i[1]),g_offset_z,parseFloat(i[4]),parseFloat(i[5]),!0,g_pog_index),"Y"==g_scene_objects[_].Indicators.LiveImage&&animate_pog(_)}$s("P25_MODULE_DISP",""),e("SUCCESS"),logDebug("function : delete_module","E")}()}))}catch(e){error_handling(e)}}async function delete_shelf(e,o,t,_,n,a,i,d){logDebug("function : delete_shelf; object_id : "+e+"; p_module_index : "+o+"; p_shelf_index : "+t+"; i_item_index : "+_+"; p_object_type : "+n+"; is_divider : "+a+"; context_delete : "+i,"S");try{if("N"==a){if(g_deletedItems=[],g_pog_json[d].ModuleInfo[o].ShelfInfo[t].ItemInfo.length>0){var l=g_pog_json[d].ModuleInfo[o].ShelfInfo[t].ItemInfo;for(const e of l){var r=g_world.getObjectById(e.ObjID);g_deletedItems.push(e.Item),g_scene_objects[d].scene.children[2].remove(r)}g_pog_json[d].ModuleInfo[o].EditFlag="Y"}r=g_scene_objects[d].scene.children[2].getObjectById(e);g_scene_objects[d].scene.children[2].remove(r),render(d),0==t?g_pog_json[d].ModuleInfo[o].ShelfInfo.splice(t,t+1):g_pog_json[d].ModuleInfo[o].ShelfInfo.splice(t,1),g_pog_json[d].ModuleInfo[o].LastCount=g_pog_json[d].ModuleInfo[o].LastCount-1;await deleted_items_log(g_deletedItems,"D",d);if("TEXTBOX"==n){var g=g_pog_json[d].ModuleInfo,s=-1,f=0;for(const o of g){if(o.ObjID==e){s=f;break}f++}-1!==s&&(0==s?g_pog_json[d].ModuleInfo.splice(s,s+1):g_pog_json[d].ModuleInfo.splice(s,1))}}else{r=g_scene_objects[d].scene.children[2].getObjectById(e);g_scene_objects[d].scene.children[2].remove(r),render(d);var p=g_pog_json[d].ModuleInfo[o].ShelfInfo[t].ItemInfo.length;0==_?g_pog_json[d].ModuleInfo[o].ShelfInfo[t].ItemInfo.splice(_,_+1):g_pog_json[d].ModuleInfo[o].ShelfInfo[t].ItemInfo.splice(_,1);var c=-1;f=0;for(const t of g_pog_json[d].ModuleInfo[o].ShelfInfo){if(t.ShelfDivObjID==e){c=f;break}f++}var I=g_pog_json[d].ModuleInfo[o].ShelfInfo[t].SObjID;f=0;0==c?g_pog_json[d].ModuleInfo[o].ShelfInfo.splice(c,c+1):g_pog_json[d].ModuleInfo[o].ShelfInfo.splice(c,1);f=0;for(const e of g_pog_json[d].ModuleInfo[o].ShelfInfo){if(e.SObjID==I){t=f;break}f++}if(reorder_items(o,t,d)){console.log("inside recreate");recreate_all_items(o,t,n,"N",-1,-1,p,"N","N",-1,-1,g_start_canvas,"",d,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")}}logDebug("function : delete_shelf","E")}catch(e){error_handling(e)}}async function delete_item(e,o,t,_,n,a,i){if(logDebug("function : delete_item; object_id : "+e+"; p_module_index : "+o+"; p_shelf_index : "+t+"; i_item_index : "+_+"; action : "+n+"; clearRedo : "+a,"S"),"CUT"==n);else"ITEM_DELETE";try{var d=g_pog_json[i].ModuleInfo[o].ShelfInfo[t].ItemInfo;"REDO"!==g_undoRedoAction&&"undefined"!=typeof g_undoRedoAction?"R":"U";var l={};l.MIndex=o,l.SIndex=t;var r="N"==g_carpark_item_flag?d[_].ItemID:g_pog_json[i].ModuleInfo[o].Carpark[0].ItemInfo[_].ItemID;l.ItemID=r,l.MultiDelete="N",l.CREATED="CREATE_ITEM"!==n?"N":"Y";[].push(l),g_temp_cut_arr.push(JSON.parse(JSON.stringify(g_pog_json[i].ModuleInfo)));var g="N"==g_carpark_item_flag?d[_]:g_pog_json[i].ModuleInfo[o].Carpark[t].ItemInfo[_],s=g_scene_objects[i].scene.children[2].getObjectById(g.ObjID);if(g_scene_objects[i].scene.children[2].remove(s),render(i),void 0!==g.TopObjID&&""!==g.TopObjID||void 0!==g.BottomObjID&&""!==g.BottomObjID)reset_bottom_item(o,t,_,-1,-1,g.X,i);if("N"==g_carpark_item_flag?0==_?d.splice(_,_+1):d.splice(_,1):0==_?g_pog_json[i].ModuleInfo[o].Carpark[t].ItemInfo.splice(_,_+1):g_pog_json[i].ModuleInfo[o].Carpark[t].ItemInfo.splice(_,1),"SHELF"==g_pog_json[i].ModuleInfo[o].ShelfInfo[t].ObjType||"PALLET"==g_pog_json[i].ModuleInfo[o].ShelfInfo[t].ObjType)reset_top_bottom_objects(o,t,"N",i);if("N"==g_carpark_item_flag){if(reset_auto_crush(o,t,-1,i,o,t,i),"F"==g_pog_json[i].ModuleInfo[o].ShelfInfo[t].SpreadItem)for(const e of d)e.W=e.RW;else if("PALLET"==g_pog_json[i].ModuleInfo[o].ShelfInfo[t].ObjType){for(const e of d)e.Exists="E",e.Dragged="N"}if("PALLET"!==g_pog_json[i].ModuleInfo[o].ShelfInfo[t].ObjType&&reorder_items(o,t,i))await recreate_all_items(o,t,g_pog_json[i].ModuleInfo[o].ShelfInfo[t].ObjType,"N",-1,-1,d.length,"N","N",-1,-1,g_start_canvas,"N",i,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")}g_pog_json[i].ModuleInfo[o].EditFlag="Y",g_delete_details.multi_delete_shelf_ind="N",g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_undo_details=[];await recreate_compare_views(g_compare_view,"N"),await calculateFixelAndSupplyDays("N",i);if(void 0!==s)await deleted_items_log([s.ItemID],"D",i);logDebug("function : delete_item","E")}catch(e){error_handling(e)}}function delete_pog(){logDebug("function : delete_pog","S");for(var e=g_scene_objects[g_pog_index].scene.children[2].children.length-1;e>=0;e--)obj=g_scene_objects[g_pog_index].scene.children[2].children[e],g_scene_objects[g_pog_index].scene.children[2].remove(obj);sessionStorage.setItem("POGExists","N"),logDebug("function : delete_pog","E")}function clear_search_fields(){logDebug("function : clear_search_fields","S"),$s("P25_ITEM",""),$s("P25_SUPP_NAME",""),$s("P25_SUPPLIER_CODE",""),$s("P25_MAIN_BRAND",""),$s("P25_ITEM_DESCRIPTION",""),$s("P25_DESCRIPTION_SEC",""),$s("P25_GROUP",""),$s("P25_DEPARTMENT",""),$s("P25_ITEM_BRAND",""),$s("P25_ITEM_WITHOUT_DIM","N"),$s("P25_USED_ITEM","A"),$s("P25_CLASS",""),$s("P25_SUB_CLASS",""),logDebug("function : clear_search_fields","E")}async function create_item_list(e,o,t,_,n,a){logDebug("function : create_item_list ; x : "+o+"; y : "+t,"S");try{var i=apex.region("draggable_table").widget().interactiveGrid("getViews","grid").model;render(a);var d=n.width,l=n.height,r=2*o/d-1,g=1-2*t/l,s=[],f=[],p=[],c=[],I=[],u=[],m=[],h=[],S=[];if(g_raycaster.setFromCamera(new THREE.Vector2(r,g),_),g_intersects=g_raycaster.intersectObjects(g_world.children),0==g_intersects.length||"drag_object"==g_intersects[0].object.uuid){if(g_intersects=g_raycaster.intersectObject(g_targetForDragging),0===g_intersects.length)return;var O=g_intersects[0];g_objectHit=O.object,g_objecthit_id=g_objectHit.id,P=O.point.x,j=O.point.y;var M=100,x=0,v="N";g_shelf_edit_flag="N",g_shelf_index="",g_item_index="",shelf_obj_type="",g_item_edit_flag="N",g_module_index=-1;var D=0;for(const e of g_pog_json[a].ModuleInfo){if("Y"==g_shelf_edit_flag)break;if(null==e.ParentModule){var E=0;for(const o of e.ShelfInfo){if(o.Rotation>0||o.Rotation<0)var C=o.X+o.ShelfRotateWidth/2,b=o.X-o.ShelfRotateWidth/2;else C=o.X+o.W/2,b=o.X-o.W/2;"BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType&&parseFloat(o.Y)<parseFloat(j)&&C>P&&b<P&&M>parseFloat(j)-parseFloat(o.Y)&&(M=parseFloat(j)-parseFloat(o.Y),o.Shelf,shelf_obj_type=o.ObjType,g_shelf_index=E,g_module_index=D),E++}}D++}}else{O=g_intersects[0];g_objectHit=O.object;var T=g_objectHit.id,P=(x=0,v="N",O.point.x),j=O.point.y;g_shelf_edit_flag="N",g_shelf_index="",g_item_index="",shelf_obj_type="",g_item_edit_flag="N",g_module_index=-1;var N=!1;for(const e of g_pog_json[a].ModuleInfo){if(null==e.ParentModule)for(const o of e.ShelfInfo)if(o.SObjID==T&&"TEXTBOX"==o.ObjType){N=!0;break}if(N)break}if(N){if(g_intersects=g_raycaster.intersectObject(g_targetForDragging),0===g_intersects.length)return;O=g_intersects[0],g_objectHit=O.object,g_objecthit_id=g_objectHit.id,P=O.point.x,j=O.point.y;M=100,x=0,v="N";g_shelf_edit_flag="N",g_shelf_index="",g_item_index="",shelf_obj_type="",g_item_edit_flag="N",g_module_index=-1;D=0;for(const e of g_pog_json[a].ModuleInfo){if("Y"==g_shelf_edit_flag)break;if(null==e.ParentModule){E=0;for(const o of e.ShelfInfo){if(o.Rotation>0||o.Rotation<0)C=o.X+o.ShelfRotateWidth/2,b=o.X-o.ShelfRotateWidth/2;else C=o.X+o.W/2,b=o.X-o.W/2;"BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType&&parseFloat(o.Y)<parseFloat(j)&&C>P&&b<P&&M>parseFloat(j)-parseFloat(o.Y)&&(M=parseFloat(j)-parseFloat(o.Y),o.Shelf,shelf_obj_type=o.ObjType,g_shelf_index=E,g_module_index=D),E++}}D++}}else{E=0;for(const e of g_pog_json[a].ModuleInfo){if(e.MObjID==T&&null==e.ParentModule){g_module_index=E,v="Y";break}v="N",E++}if("N"==v){D=0;for(const e of g_pog_json[a].ModuleInfo){if("Y"==g_shelf_edit_flag)break;if(null==e.ParentModule){E=0;for(const o of e.ShelfInfo){if(o.SObjID==T){g_module_index=D,g_shelf_index=E,g_shelf_max_merch=o.MaxMerch,g_shelf_edit_flag="Y",shelf_width=o.W,shelf_height=o.H,shelf_obj_type=o.ObjType;break}g_shelf_edit_flag="N",E++}}D++}}if("N"==g_shelf_edit_flag){var F=0;for(const e of g_pog_json[a].ModuleInfo){if("Y"==g_shelf_edit_flag)break;if(null==e.ParentModule){E=0;for(const o of e.ShelfInfo){if("Y"==g_item_edit_flag)break;D=0;for(const e of o.ItemInfo){if(e.ObjID==T){g_module_index=F,g_shelf_index=E,g_item_index=D,g_item_edit_flag="Y",shelf_obj_type=o.ObjType;break}g_item_edit_flag="N",D++}E++}}F++}}if(-1!==g_module_index){M=100,E=0;for(const e of g_pog_json[a].ModuleInfo[g_module_index].ShelfInfo)parseFloat(j)>parseFloat(e.Y)-e.H/2&&parseFloat(j)<parseFloat(e.Y)+e.H/2&&parseFloat(P)>parseFloat(e.X)-e.W/2&&parseFloat(P)<parseFloat(e.X)+e.W/2?(e.Shelf,shelf_obj_type=e.ObjType,g_shelf_index=E):"BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&parseFloat(e.Y)<parseFloat(j)&&parseFloat(P)>parseFloat(e.X)-e.W/2&&parseFloat(P)<parseFloat(e.X)+e.W/2&&M>parseFloat(j)-parseFloat(e.Y)&&(M=parseFloat(j)-parseFloat(e.Y),e.Shelf,shelf_obj_type=e.ObjType,g_shelf_index=E),E++}}}if(void 0!==typeof g_shelf_index&&""!==g_shelf_index){g_pog_index=a,set_select_canvas(a),g_all_pog_flag="N";var R=g_pog_json[a].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index],H=[];for(E=0;E<e.length;E++){var w=i.getRecord(e[E].innerText),y=i.getValue(w,"DIM_TYPE"),A=parseFloat(i.getValue(w,"ITEM_WIDTH"))/100,L=parseFloat(i.getValue(w,"ITEM_HEIGHT"))/100,Y=parseFloat(i.getValue(w,"ITEM_DEPTH"))/100,B=i.getValue(w,"ORIENTATION"),W=i.getValue(w,"ORIENTATION_DESC");null!=y&&null!=typeof y||(y="U"),(isNaN(A)||0==A)&&(A=parseFloat($v("P25_POG_ITEM_DEFAULT_WIDTH"))/100),(isNaN(L)||0==L)&&(L=parseFloat($v("P25_POG_ITEM_DEFAULT_HEIGHT"))/100),(isNaN(Y)||0==Y)&&(Y=parseFloat($v("P25_POG_ITEM_DEFAULT_DEPTH"))/100),S.push(Y),h.push(L),m.push(A);var G,[k,V]=get_item_exists_orientation(e[E].innerText,0);if(void 0!==k&&"0"==B)B=k,(G={}).NewOrient=k,G.NewDesc=V,H.push(G);else(G={}).NewOrient=null==B?"":B,G.NewDesc=null==B?"":W,H.push(G);var[A,L,Y,U,X,z]=get_new_orientation_dim(B,A,L,Y);I.push(e[E].innerText),s.push(y),f.push(parseFloat(Y)),p.push(parseFloat(L)),c.push(parseFloat(A))}var K,J=R.ItemInfo,Z=[],q=[],Q=[],ee=R.SpreadItem,oe=JSON.parse(JSON.stringify(R)),te=JSON.parse(JSON.stringify(R.SObjID));if(undoObjectsInfo=[],undoObjectsInfo.push(oe),undoObjectsInfo.moduleIndex=g_module_index,undoObjectsInfo.moduleObjectID=g_pog_json[a].ModuleInfo[g_module_index].MObjID,undoObjectsInfo.module=g_pog_json[a].ModuleInfo[g_module_index].Module,undoObjectsInfo.shelfIndex=g_shelf_index,undoObjectsInfo.actionType="ITEM_DELETE",undoObjectsInfo.startCanvas=a,undoObjectsInfo.objectID=te,undoObjectsInfo.itemColorFlag="R","R"==ee){E=0;for(const e of J)R.ItemInfo[E].Exists="E",e.X>P&&(Z.push(e.X-parseFloat(P)),q.push(E)),E++}else{E=0;for(const e of J)R.ItemInfo[E].Exists="E",e.X<P&&(Z.push(parseFloat(P)-e.X),q.push(E)),E++}K=Math.min.apply(Math,Z);var _e=q[Z.findIndex((function(e){return e==K}))],ne=0;for(E=0;E<c.length;E++){0==E?ne=_e:ne+=1;var ae=Math.floor(16777216*Math.random()),ie=set_item_values(I[E],c[E],p[E],f[E],s[E],0,"N",-1,"",ne,{},a,H[E].NewOrient,H[E].NewDesc,ae);u.push(ie),Q.push(ae),R.ItemInfo[ie].OW=m[E],R.ItemInfo[ie].OH=h[E],R.ItemInfo[ie].OD=S[E]}var de=R.HorizGap,le=de,re=(ee=R.SpreadItem,R.ItemInfo.length),ge=R.AllowAutoCrush;for(ie="N",E=0;E<u.length;E++){if("SHELF"==shelf_obj_type||"CHEST"==shelf_obj_type&&"N"==g_chest_as_pegboard||"BASKET"==shelf_obj_type||"PALLET"==shelf_obj_type)x=parseFloat(R.Y)+parseFloat(R.H)/2+R.ItemInfo[u[E]].H/2;else if("PEGBOARD"==shelf_obj_type||"CHEST"==shelf_obj_type&&"Y"==g_chest_as_pegboard){x=get_closest_peg(p[E],g_module_index,g_shelf_index,j,a)-parseFloat(p[E])/2,R.ItemInfo[u[E]].FromProductList="Y",R.ItemInfo[u[E]].Exists="N","Y"==g_pegbrd_auto_placing&&(R.ItemInfo[u[E]].Edited="Y")}else"HANGINGBAR"==shelf_obj_type?x=parseFloat(R.Y)-R.ItemInfo[u[E]].H/2:"ROD"==shelf_obj_type&&(x=parseFloat(R.Y)-R.H/2-R.ItemInfo[u[E]].H/2);R.ItemInfo[u[E]].Y=x,R.ItemInfo[u[E]].Exists="N",R.ItemInfo[u[E]].DropY=j}if(u.length>1){if("PEGBOARD"==shelf_obj_type||"CHEST"==shelf_obj_type&&"Y"==g_chest_as_pegboard){var se=-9999;for(E=0;E<u.length;E++)se=Math.max(se,j+R.ItemInfo[u[E]].H/2);if("Y"==g_pegbrd_auto_placing)for(E=0;E<u.length;E++)R.ItemInfo[u[E]].Y=se-R.ItemInfo[u[E]].H/2,R.ItemInfo[u[E]].DropY=R.ItemInfo[u[E]].Y;else{var fe=0;for(E=0;E<u.length;E++)0==E&&(fe=R.ItemInfo[u[E]].Y+R.ItemInfo[u[E]].H/2),fe<R.ItemInfo[u[E]].Y+R.ItemInfo[u[E]].H/2&&(fe=R.ItemInfo[u[E]].Y+R.ItemInfo[u[E]].H/2);for(E=0;E<u.length;E++)R.ItemInfo[u[E]].Y=fe-R.ItemInfo[u[E]].H/2}}var pe=0,ce=R.ItemInfo;E=0;for(const e of ce)-1!==u.indexOf(E)&&(pe+=e.W,e.Exists="N"),E++;var Ie=P-pe/2;E=0;for(const e of ce)-1!==u.indexOf(E)&&(R.ItemInfo[E].X=Ie+e.W/2,Ie+=e.W),E++}else R.ItemInfo[u[0]].X=P,"Y"==g_pegbrd_auto_placing&&"PEGBOARD"==shelf_obj_type&&(R.ItemInfo[u[0]].Y=j);if("F"==R.SpreadItem){E=0;for(const e of R.ItemInfo)-1==u.indexOf(E)&&(e.W=e.RW),E++}if("SHELF"==shelf_obj_type||"CHEST"==shelf_obj_type&&"N"==g_chest_as_pegboard||"PALLET"==shelf_obj_type||"HANGINGBAR"==shelf_obj_type){var ue=0,[me,he]=(E=0,getCombinationShelf(a,R.Shelf));if(-1!==me&&-1!==he&&await setCombinedShelfItems(a,me,he,P,"Y","N",-1,ne,[]),reorder_items(g_module_index,g_shelf_index,a))for(const e of R.ItemInfo){if(ue=get_item_xaxis(e.W,e.H,e.D,e.CType,P,le,ee,de,g_module_index,g_shelf_index,E,"Y",re,"N",a),-1!==Q.indexOf(e.RandomID))u[Q.indexOf(e.RandomID)]=E;if(-1!==u.indexOf(E)){if(await set_auto_facings(g_module_index,g_shelf_index,E,e,"D","I","A",a),"N"!=(ie=item_height_validation(e.H,g_module_index,g_shelf_index,E,"Y",ue,ge,e.CrushVert,e.Fixed,"Y",e.D,"N",a,"Y")))break;R.ItemInfo[E].X=ue,"PALLET"==shelf_obj_type?R.ItemInfo[E].Z=0:R.ItemInfo[E].Exists="E"}E++}}var Se=0;for(const e of R.ItemInfo)-1!==u.indexOf(Se)&&await set_item_capping(a,g_module_index,g_shelf_index,Se,"N","Y"),Se++;if("N"==ie&&validate_items(c,p,f,u,shelf_obj_type,g_module_index,g_shelf_index,-1,"N",0,0,0,P,"N","N","Y","N","N",[],"Y","Y","Y",a)){g_pog_edited_ind="Y";var Oe=[],Me=[];ce=R.ItemInfo,g_pog_json[a].ModuleInfo[g_module_index],E=0;for(const e of ce)("PEGBOARD"==shelf_obj_type||"CHEST"==shelf_obj_type&&"Y"==g_chest_as_pegboard)&&(e.Exists="E"),-1!==u.indexOf(E)&&(Oe.push(e),Me.push(E),await set_auto_facings(g_module_index,g_shelf_index,E,e,"B","I","A",a)),E++;if($(".live_image").css("color","#c7c7c7").css("cursor","auto"),$(".open_pdf").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".open_pdf_online").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),"DB"==$v("P25_POGCR_LOAD_IMG_FROM"))ie=await get_images(g_module_index,g_shelf_index,Oe,Me,parseFloat($v("P25_POGCR_IMG_MAX_WIDTH")),parseFloat($v("P25_POGCR_IMG_MAX_HEIGHT")),parseFloat($v("P25_IMAGE_COMPRESS_RATIO")));if("F"==R.SpreadItem){E=0;for(const e of R.ItemInfo)-1==u.indexOf(E)&&(e.W=e.RW),E++}if(reorder_items(g_module_index,g_shelf_index,a)){"SHELF"!=shelf_obj_type||"L"!=R.SpreadItem&&"R"!=R.SpreadItem||(l_edited_item_index=mergeAdjacentItems(a,g_module_index,g_shelf_index,Me[0]));ie=await recreate_all_items(g_module_index,g_shelf_index,shelf_obj_type,"N",P,-1,c.length,"Y","N",-1,-1,g_start_canvas,"",a,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")}g_pog_json[a].ModuleInfo[g_module_index].EditFlag="Y","CHEST"==g_pog_json[a].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType&&"Y"==g_chest_as_pegboard&&(g_pog_json[a].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ChestEdit="Y");ce=R.ItemInfo;g_undo_details=[],g_undo_obj_arr=[],g_undo_supp_obj_arr=[];E=0;for(const e of ce)-1!==Q.indexOf(e.RandomID)&&(g_deletedItems.push(e.Item),e.Exists="E"),E++;g_keyCode=0,undoObjectsInfo.g_deletedItems=g_deletedItems,g_allUndoObjectsInfo.push(undoObjectsInfo),logFinalUndoObjectsInfo("ITEM_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","Y"),g_allUndoObjectsInfo=[],async function(){await recreate_compare_views(g_compare_view,"N")}(),$(".live_image").css("color","white").css("cursor","pointer"),$(".open_pdf").css("color","black").css("cursor","pointer"),$(".open_pdf_online").css("color","black").css("cursor","pointer");await calculateFixelAndSupplyDays("N",a);await deleted_items_log(g_deletedItems,"A",g_pog_index)}else{for(E=u.length-1;E>=0;E--)0==u[E]?R.ItemInfo.splice(u[E],u[E]+1):R.ItemInfo.splice(u[E],1);var[me,he]=getCombinationShelf(a,R.Shelf);-1!==me&&-1!==he&&await setCombinedShelfItems(a,me,he,P,"Y","N",-1,ne,[]),logDebug("function : create_item_list","E")}}g_objecthit_id="",render(a),g_product_list_drag="N"}catch(e){error_handling(e)}}async function compress_image_data(e,o,t,_){logDebug("function : compress_image_data","S");var n=document.createElement("canvas");return n.width=o,n.height=t,n.getContext("2d").drawImage(e,0,0,o,t),logDebug("function : compress_image_data","E"),n.toDataURL("image/jpeg",_)}function get_select_dim(e){logDebug("function : get_select_dim","S");var o=select_height=select_depth=0;return"0"==e.MerchStyle?(o=e.OrgUW>0?e.OrgUW:e.W,select_height=e.OrgUH>0?e.OrgUH:e.H,select_depth=e.OrgUD>0?e.OrgUD:e.D):"1"==e.MerchStyle?(o=e.OrgTW>0?e.OrgTW:e.W,select_height=e.OrgTH>0?e.OrgTH:e.W,select_depth=e.OrgTD>0?e.OrgTD:e.W):"2"==e.MerchStyle?(o=e.OrgCW>0?e.OrgCW:e.W,select_height=e.OrgCH>0?e.OrgCH:e.W,select_depth=e.OrgCD>0?e.OrgCD:e.W):"3"==e.MerchStyle&&(o=e.OrgDW>0?e.OrgDW:e.W,select_height=e.OrgDH>0?e.OrgDH:e.W,select_depth=e.OrgDD>0?e.OrgDD:e.W),logDebug("function : get_select_dim","E"),[o,select_height,select_depth]}function check_dim_difference(e,o,t,_){logDebug("function : check_dim_difference; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+t,"S");var n=g_pog_json[_].ModuleInfo[e].ShelfInfo[o].ItemInfo[t],a="N";return("0"!=n.MerchStyle||wpdSetFixed(n.UW||0)===wpdSetFixed(n.OrgUW||0)&&wpdSetFixed(n.UH||0)===wpdSetFixed(n.OrgUH||0)&&wpdSetFixed(n.UD||0)===wpdSetFixed(n.OrgUD||0))&&("1"!=n.MerchStyle||wpdSetFixed(n.TW||0)===wpdSetFixed(n.OrgTW||0)&&wpdSetFixed(n.TH||0)===wpdSetFixed(n.OrgTH||0)&&wpdSetFixed(n.TD||0)===wpdSetFixed(n.OrgTD||0))&&("2"!=n.MerchStyle||wpdSetFixed(n.CW||0)===wpdSetFixed(n.OrgCW||0)&&wpdSetFixed(n.CH||0)===wpdSetFixed(n.OrgCH||0)&&wpdSetFixed(n.CD||0)===wpdSetFixed(n.OrgCD||0))&&("3"!=n.MerchStyle||wpdSetFixed(n.DW||0)===wpdSetFixed(n.OrgDW||0)&&wpdSetFixed(n.DH||0)===wpdSetFixed(n.OrgDH||0)&&wpdSetFixed(n.DD||0)===wpdSetFixed(n.OrgDD||0))||(a="Y"),wpdSetFixed(n.NW||0)===wpdSetFixed(n.OrgNW||0)&&wpdSetFixed(n.NH||0)===wpdSetFixed(n.OrgNH||0)&&wpdSetFixed(n.ND||0)===wpdSetFixed(n.OrgND||0)||(a="Y"),wpdSetFixed(n.CWPerc||0)===wpdSetFixed(n.OrgCWPerc||0)&&wpdSetFixed(n.CHPerc||0)===wpdSetFixed(n.OrgCHPerc||0)&&wpdSetFixed(n.CDPerc||0)===wpdSetFixed(n.OrgCDPerc||0)||(a="Y"),wpdSetFixed(n.CnW||0)===wpdSetFixed(n.OrgCnW||0)&&wpdSetFixed(n.CnH||0)===wpdSetFixed(n.OrgCnH||0)&&wpdSetFixed(n.CnD||0)===wpdSetFixed(n.OrgCnD||0)||(a="Y"),logDebug("function : check_dim_difference","E"),"Y"==a}async function org_dim_update_shelf(e,o,t,_,n,a,i){var d=0,l="N",r=g_pog_json[i].ModuleInfo[e].ShelfInfo[o];""!==_.ItemNesting&&("W"==_.ItemNesting?d=_.OrgNW:"H"==_.ItemNesting?d=_.OrgNH:"D"==_.ItemNesting&&(d=_.OrgND));var[g,s,f]=get_select_dim(_);if(_.WChanged="N",_.HChanged="N",_.DChanged="N",g>0)var[p,c,I,u,m,h]=set_dim_validate_item(e,o,t,g,s,f,_.ItemNesting,d,_.BHoriz,_.BVert,_.BaseD,_.Orientation,_.OrgCWPerc,_.OrgCHPerc,_.OrgCDPerc,"N","Y","N",i);else var p=_.W,c=_.H,I=_.D,u=_.RW,m=_.RH,h=_.RD,g=_.OW,s=_.OH,f=_.OD;if("ERROR"!==p){l="Y",g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].DimUpdate="Y",g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OW=g,g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OH=s,g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OD=f,update_item_org_dim(e,o,t,p,c,I,u,m,h,i);var[S,O]=get_item_xy(r,_,p,c,i);"BASKET"==g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ObjType&&"DIVIDER"==g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].Item?console.log("Divider"):g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].Y=O}if("Y"!=l){var M=g_scene_objects[i].scene.children[2].getObjectById(_.ObjID);M.WireframeObj.material.color.setHex(g_dim_error_color),g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].DimUpdate="E",M.DimUpdate="E",M.BorderColour=g_dim_error_color}return logDebug("function : after  color  "+n,"E"),l}async function org_dim_update_items(e,o,t,_,n,a){logDebug("function : org_dim_update_items; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+t+"; item_code : "+_+"; exclude_item : "+n,"S");try{var i=0,d="Y",l=g_pog_json[a].ModuleInfo;for(const t of l){if(void 0===t.ParentModule||null==t.ParentModule){var r=t.ShelfInfo,g=0;for(const t of r){if("BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&"TEXTBOX"!==t.ObjType&&t.ItemInfo.length>0){var s=t.ItemInfo,f=0,p="Y",c="N";for(const l of s){if(i==e&&g==o&&"Y"==n&&(p="N"),"DIVIDER"!==l.Item&&l.Item==_){"Y";var I=0;""!==l.ItemNesting&&("W"==l.ItemNesting?I=l.OrgNW:"H"==l.ItemNesting?I=l.OrgNH:"D"==l.ItemNesting&&(I=l.OrgND));var[u,m,h]=get_select_dim(l);if(l.WChanged="N",l.HChanged="N",l.DChanged="N",u>0)var[S,O,M,x,v,D]=set_dim_validate_item(i,g,f,u,m,h,l.ItemNesting,I,l.BHoriz,l.BVert,l.BaseD,l.Orientation,l.OrgCWPerc,l.OrgCHPerc,l.OrgCDPerc,"N","Y","N",a);else var S=l.W,O=l.H,M=l.D,x=l.RW,v=l.RH,D=l.RD,u=l.OW,m=l.OH,h=l.OD;if("ERROR"!==S){c="Y",g_pog_json[a].ModuleInfo[i].ShelfInfo[g].ItemInfo[f].DimUpdate="Y",g_pog_json[a].ModuleInfo[i].ShelfInfo[g].ItemInfo[f].OW=u,g_pog_json[a].ModuleInfo[i].ShelfInfo[g].ItemInfo[f].OH=m,g_pog_json[a].ModuleInfo[i].ShelfInfo[g].ItemInfo[f].OD=h,update_item_org_dim(i,g,f,S,O,M,x,v,D,a);var[E,C]=get_item_xy(t,l,S,O,a);g_pog_json[a].ModuleInfo[i].ShelfInfo[g].ItemInfo[f].Y=C}else{var b=g_world.getObjectById(l.ObjID);b.WireframeObj.material.color.setHex(g_dim_error_color),g_pog_json[a].ModuleInfo[i].ShelfInfo[g].ItemInfo[f].DimUpdate="E",b.DimUpdate="E",b.BorderColour=g_dim_error_color,d="N"}}f+=1}if("Y"==p&&"Y"==c&&reorder_items(i,g,a))await recreate_all_items(i,g,t.ObjType,"Y",-1,-1,t.ItemInfo.length,"Y","N",-1,-1,g_start_canvas,"N",a,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")}g+=1}}i+=1}return render(a),logDebug("function : org_dim_update_items","E"),d}catch(e){error_handling(e)}}function update_item_org_dim(e,o,t,_,n,a,i,d,l,r){logDebug("function : update_item_org_dim; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+t+"; item_width : "+_+"; item_height : "+n+"; item_depth : "+a+"; real_width : "+i+"; real_height : "+d+"; real_depth : "+l,"S"),g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].UW=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgUW,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].UH=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgUH,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].UD=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgUD,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].CW=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgCW,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].CH=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgCH,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].CD=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgCD,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].TW=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgTW,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].TH=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgTH,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].TD=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgTD,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].DW=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgDW,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].DH=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgDH,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].DD=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgDD,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].CWPerc=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgCWPerc,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].CHPerc=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgCHPerc,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].CDPerc=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgCDPerc,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].NW=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgNW,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].NH=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgNH,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].ND=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgND,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].CnW=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgCnW,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].CnH=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgCnH,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].CnD=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgCnD,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OldNW=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgNW,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OldNH=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgNH,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OldND=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgND,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OldCnW=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgCnW,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OldCnH=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgCnH,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OldCnD=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OrgCnD,_>0&&n>0&&(g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].W=_,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].H=n,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].D=a,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].RW=i,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].RH=d,g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].RD=l),logDebug("function : update_item_org_dim","E")}function update_carpark_item_values(e,o,t){logDebug("function : update_carpark_item_values; p_module_index : "+e+"; i_item_index : "+o,"S");var _=null!==sessionStorage.getItem("items_details")?JSON.parse(sessionStorage.getItem("items_details")):{},n=g_pog_json[t].ModuleInfo[e].Carpark[0].ItemInfo[o];return n.W=_.OrgUW,n.RW=_.RW,n.OW=_.RW,n.UW=_.UW,n.H=_.OrgUH,n.RH=_.RH,n.OH=_.OH,n.UH=_.UH,n.D=_.OrgUD,n.RD=_.RD,n.OD=_.OD,n.UD=_.UD,n.Color=_.Color,n.PegID=_.PegID,n.LocID=_.LocID,n.PegSpread=_.PegSpread,n.PegPerFacing=_.PegPerFacing,n.BsktFactor=_.BsktFactor,n.OverHang=_.OverHang,n.HorizGap=_.HorizGap,n.VertGap=_.VertGap,n.Price=_.Price,n.Cost=_.Cost,n.RegMovement=_.RegMovement,n.AvgSales=_.AvgSales,n.ItemStatus=_.ItemStatus,n.CDTLvl1=_.CDTLvl1,n.CDTLvl2=_.CDTLvl2,n.CDTLvl3=_.CDTLvl3,n.StoreCnt=_.StoreCnt,n.WeeksOfInventory=_.WeeksOfInventory,n.MoveBasis=_.MoveBasis,n.Orientation=_.Orientation,n.OrientationDesc=_.OrientationDesc,n.ItemCondition=_.ItemCondition,n.AUR=_.AUR,n.ItemRanking=_.ItemRanking,n.WeeklySales=_.WeeklySales,n.WeeklyNetMargin=_.WeeklyNetMargin,n.WeeklyQty=_.WeeklyQty,n.NetMarginPercent=_.NetMarginPercent,n.CumulativeNM=_.CumulativeNM,n.TOP80B2=_.TOP80B2,n.ItemBrandC=_.ItemBrandC,n.ItemPOGDept=_.ItemPOGDept,n.ItemRemark=_.ItemRemark,n.RTVStatus=_.RTVStatus,n.Pusher=_.Pusher,n.Divider=_.Divider,n.BackSupport=_.BackSupport,n.OOSPerc=_.OOSPerc,ItemsInfo.InitialItemDesc=_.InitialItemDesc,ItemsInfo.InitialBrand=_.InitialBrand,ItemsInfo.InitialBarcode=_.InitialBarcode,g_pog_json[t].ModuleInfo[e].Carpark[0].ItemInfo[o]=n,logDebug("function : update_carpark_item_values","E"),"SUCCESS"}async function edit_carpark_items(e,o){logDebug("function : edit_carpark_items; i_item_index : "+e,"S");g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[e];var t=parseFloat($v("P25_ITEM_WIDTH"))/100,_=g_pog_json[o].ModuleInfo[g_module_index].Carpark[0],n=0;for(const s of _.ItemInfo){if(n!==e){var[a,i,d,l,r,g]=get_new_orientation_dim(g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].Orientation,s.W,s.H,s.D);t+=a}n++}if(t>_.W)return alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",_.Shelf)),logDebug("function : edit_carpark_items"),!1;update_carpark_item_values(g_module_index,e,o),n=0;for(const t of g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo){var s=g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].Orientation;if(e==n)var[a,i,d,l,r,g]=get_new_orientation_dim(s,t.W,t.H,t.D);else a=t.W,i=t.H,d=t.D;g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].W=a,g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].H=i,g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].D=d,g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].RW=a,g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].RH=i,g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].RD=d,g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].X=0==n?_.X-_.W/2+a/2:g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n-1].X+g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n-1].W/2+a/2,g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].Y=_.Y+_.H/2+i/2;var f=g_scene_objects[o].scene.children[2].getObjectById(t.ObjID);g_scene_objects[o].scene.children[2].remove(f);var p=g_orientation_json[t.Orientation].split("###"),c=await add_carpark_item(t.ItemID,t.W,t.H,t.D,t.Color,t.X,t.Y,t.Z,g_module_index,0,n,"Y","N",g_show_live_image,parseInt(p[1]),o);g_pog_json[o].ModuleInfo[g_module_index].Carpark[0].ItemInfo[n].ObjID=c,n+=1}return render(o),animate_all_pog(),g_dblclick_opened="N",$s("P25_ITEM_EDIT_IND","N"),logDebug("function : edit_carpark_items","E"),!0}function set_dim_change_values(e,o,t){try{logDebug("function : set_dim_change_values dim_details: "+e+"item_code: "+o,"S");var _=g_pog_json[t].ModuleInfo,n=0;if("N"==g_carpark_item_flag)for(const r of _){if(void 0===r.ParentModule||null==r.ParentModule){var a=r.ShelfInfo,i=0;for(const _ of a){if("BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType&&"TEXTBOX"!==_.ObjType&&_.ItemInfo.length>0){var d=_.ItemInfo,l=0;for(const _ of d)"DIVIDER"!==_.Item&&_.Item==o&&(g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].OrgUW=e.U[0],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].OrgUH=e.U[1],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].OrgUD=e.U[2],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].OrgTW=e.T[0],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].OrgTH=e.T[1],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].OrgTD=e.T[2],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].OrgDW=e.D[0],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].OrgDH=e.D[1],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].OrgDD=e.D[2],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].OrgCW=e.C[0],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].OrgCH=e.C[1],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].OrgCD=e.C[2],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].OrgCWPerc=e.R[0],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].OrgCHPerc=e.R[1],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].OrgCDPerc=e.R[2],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].OrgCnW=e.O[0],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].OrgCnH=e.O[1],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].OrgCnD=e.O[2],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].OrgNW=e.N[0],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].OrgNH=e.N[1],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].OrgND=e.N[2],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].CnW=e.O[0],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].CnH=e.O[1],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].CnD=e.O[2],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].NW=e.N[0],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].NH=e.N[1],g_pog_json[t].ModuleInfo[n].ShelfInfo[i].ItemInfo[l].ND=e.N[2]),l+=1}i+=1}}n+=1}else{n=0;for(const a of _){if((void 0===a.ParentModule||null==a.ParentModule)&&void 0!==a.Carpark[0]){var r=a.Carpark[0].ItemInfo;i=0;for(const _ of r)_.Item==o&&(g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].OrgUW=e.U[0],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].OrgUH=e.U[1],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].OrgUD=e.U[2],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].OrgTW=e.T[0],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].OrgTH=e.T[1],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].OrgTD=e.T[2],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].OrgDW=e.D[0],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].OrgDH=e.D[1],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].OrgDD=e.D[2],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].OrgCW=e.C[0],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].OrgCH=e.C[1],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].OrgCD=e.C[2],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].OrgCWPerc=e.R[0],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].OrgCHPerc=e.R[1],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].OrgCDPerc=e.R[2],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].OrgCnW=e.O[0],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].OrgCnH=e.O[1],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].OrgCnD=e.O[2],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].OrgNW=e.N[0],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].OrgNH=e.N[1],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].OrgND=e.N[2],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].CnW=e.O[0],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].CnH=e.O[1],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].CnD=e.O[2],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].NW=e.N[0],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].NH=e.N[1],g_pog_json[t].ModuleInfo[n].Carpark[0].ItemInfo[i].ND=e.N[2]),i+=1}n+=1}}logDebug("function : set_dim_change_values","E")}catch(e){error_handling(e)}}async function get_edit_item_img(e,o,t,_,n,a,i){facing_edit="N";var d=-1,l="N",r=_.Item,g=g_orientation_json[n].split("###"),s=0;for(const e of g_ItemImages){if(r==e.Item&&g[0]==e.Orientation&&a==e.MerchStyle){d=s;break}s++}var f=g_pog_json[i].ModuleInfo;for(modules of f){if("Y"==l)break;if((void 0===modules.ParentModule||null==modules.ParentModule)&&modules.ShelfInfo.length>0){s=0;for(const e of modules.ShelfInfo){if("Y"==l)break;if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){for(const o of e.ItemInfo){if(o.Orientation==g[0]&&o.Item==r&&_.ObjID!==o.ObjID){l="Y";break}0}}s++}}0}if(ItemImageInfo={},-1!==d&&"N"==l)await call_ajax(e,o,t,g[0],d,r,a,parseFloat($v("P25_POGCR_IMG_MAX_WIDTH")),parseFloat($v("P25_POGCR_IMG_MAX_HEIGHT")),parseFloat($v("P25_IMAGE_COMPRESS_RATIO")));else{ItemImageInfo.Item=_.Item,ItemImageInfo.MIndex=e,ItemImageInfo.SIndex=o,ItemImageInfo.IIndex=t,ItemImageInfo.Orientation=g[0],ItemImageInfo.MerchStyle=a,ItemImageInfo.ItemImage=null,g_ItemImages.push(ItemImageInfo);await call_ajax(e,o,t,g[0],g_ItemImages.length-1,r,a,parseFloat($v("P25_POGCR_IMG_MAX_WIDTH")),parseFloat($v("P25_POGCR_IMG_MAX_HEIGHT")),parseFloat($v("P25_IMAGE_COMPRESS_RATIO")))}}async function edit_items(e,o,t){logDebug("function : edit_items; i_item_index : "+e,"S");try{var _=[],n=[],a=[],i=0,d=[],l=0,r=0,g=0,s=0,f=0;dim_not_match="N";var p="N",c="N",I=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index],u=(ee=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e]).pegHeadRoom,m=null!==sessionStorage.getItem("items_details")?JSON.parse(sessionStorage.getItem("items_details")):{};if(console.log("items inside",m,m.Item),void 0!==m.Item){void 0!==m.dim_details.U&&set_dim_change_values(m.dim_details,m.Item,t);var h=m.NestingVal,S=((De=m).D,De.BaseD,l=De.RH,De.CapDepthChanged);De.BVert,De.H;g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CWPerc=De.CWPerc,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CDPerc=De.CDPerc,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CHPerc=De.CHPerc,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CrushD=De.CrushD,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].SqzPer=(void 0!==De.CrushHoriz?De.CrushHoriz:0)+":"+(void 0!==De.CrushVert?De.CrushVert:0)+":"+(void 0!==De.CrushD?De.CrushD:0),g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].UnitperTray=De.UnitperTray,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].UnitperCase=De.UnitperCase,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapDepthChanged=De.CapDepthChanged,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].MPogVertFacings=De.MPogVertFacings,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].MPogHorizFacings=De.MPogHorizFacings,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].MPogDepthFacings=De.MPogDepthFacings;var O=[],M=I.SObjID;O.moduleIndex=g_module_index,O.shelfIndex=g_shelf_index,O.actionType="ITEM_DELETE",O.startCanvas=g_start_canvas,O.objectID=M,O.moduleObjectID=g_pog_json[t].ModuleInfo[g_module_index].MObjID,O.module=g_pog_json[t].ModuleInfo[g_module_index].Module,O.push(JSON.parse(JSON.stringify(I)));JSON.parse(JSON.stringify(I.ItemInfo));g_allUndoObjectsInfo.push(O),logFinalUndoObjectsInfo("ITEM_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","N"),g_allUndoObjectsInfo=[],"0"==De.MerchStyle?wpdSetFixed(De.UW)!==wpdSetFixed(De.OrgUW)||wpdSetFixed(De.UH)!==wpdSetFixed(De.OrgUH)||wpdSetFixed(De.UD)!==wpdSetFixed(De.OrgUD)?(i=De.OrgUW,l=De.OrgUH,r=De.OrgUD,dim_not_match="Y"):(i=De.UW,l=De.UH,r=De.UD):"2"==De.MerchStyle?wpdSetFixed(De.CW)!==wpdSetFixed(De.OrgCW)||wpdSetFixed(De.CH)!==wpdSetFixed(De.OrgCH)||wpdSetFixed(De.CD)!==wpdSetFixed(De.OrgCD)?(i=De.OrgCW,l=De.OrgCH,r=De.OrgCD,dim_not_match="Y"):(i=De.CW,l=De.CH,r=De.CD):"1"==De.MerchStyle?wpdSetFixed(De.TW)!==wpdSetFixed(De.OrgTW)||wpdSetFixed(De.TH)!==wpdSetFixed(De.OrgTH)||wpdSetFixed(De.TD)!==wpdSetFixed(De.OrgTD)?(i=De.OrgTW,l=De.OrgTH,r=De.OrgTD,dim_not_match="Y"):(i=De.TW,l=De.TH,r=De.TD):"3"==De.MerchStyle&&(wpdSetFixed(De.DW)!==wpdSetFixed(De.OrgDW)||wpdSetFixed(De.DH)!==wpdSetFixed(De.OrgDH)||wpdSetFixed(De.DD)!==wpdSetFixed(De.OrgDD)?(i=De.OrgDW,l=De.OrgDH,r=De.OrgDD,dim_not_match="Y"):(i=De.DW,l=De.DH,r=De.DD)),check_dim_difference(g_module_index,g_shelf_index,e,t)&&(dim_not_match="Y"),"Y"==dim_not_match?await org_dim_update_items(g_module_index,g_shelf_index,e,De.Item,"Y",t):(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].DimUpdate="N",console.log("items edit",De),void 0===De.OrgTW||wpdSetFixed(De.TW)===wpdSetFixed(De.OrgTW)&&wpdSetFixed(De.TH)===wpdSetFixed(De.OrgTH)&&wpdSetFixed(De.TD)===wpdSetFixed(De.OrgTD)?wpdSetFixed(De.CW)!==wpdSetFixed(De.OrgCW)||wpdSetFixed(De.CH)!==wpdSetFixed(De.OrgCH)||wpdSetFixed(De.CD)!==wpdSetFixed(De.OrgCD)?(De.CW=De.OrgCW,De.CH=De.OrgCH,De.CD=De.OrgCD):wpdSetFixed(De.DW)===wpdSetFixed(De.OrgDW)&&wpdSetFixed(De.DH)===wpdSetFixed(De.OrgDH)&&wpdSetFixed(De.DD)===wpdSetFixed(De.OrgDD)||(De.DW=De.OrgDW,De.DH=De.OrgDH,De.DD=De.OrgDD):(De.TW=De.OrgTW,De.TH=De.OrgTH,De.TD=De.OrgTD));var x=JSON.parse(JSON.stringify(ee));g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].OW=i,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].OH=l,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].OD=r;var v=I.ObjType,D=I.SpreadItem,E=I.HorizGap,C=ee.HorizGap,[i,l,r,b,T,P]=get_new_orientation_dim(De.Orientation,i,l,r);if(x.BHoriz===De.BHoriz&&x.BVert===De.BVert&&x.BaseD===De.BaseD||x.W!=De.W||x.H!=De.H||x.D!=De.D||("CHEST"==v&&"Y"==g_chest_as_pegboard&&(c="Y"),p="Y"),x.CrushHoriz===De.CrushHoriz&&x.CrushVert===De.CrushVert&&x.CrushD===De.CrushD||"CHEST"==v&&"Y"==g_chest_as_pegboard&&(c="Y"),g=i*De.BHoriz+De.HorizGap/100*(De.BHoriz-1),s=l*De.BVert+De.VertGap/100*(De.BVert-1),f=r*De.BaseD,"F"!==D&&0==E&&0==C&&0!==h){if(h<0&&(h*=-1),"H"==De.ItemNesting)l+=(De.BVert-1)*h,i*=De.BHoriz,r*=De.BaseD;else if("W"==De.ItemNesting){i+=(De.BHoriz-1)*h,l*=De.BVert,r*=De.BaseD}else"D"==De.ItemNesting&&(r+=(De.BaseD-1)*h,i*=De.BHoriz,l*=De.BVert);g=i+De.HorizGap/100*(De.BHoriz-1),s=l+De.VertGap/100*(De.BVert-1),f=r}else{if("1"==De.CapStyle||"2"==De.CapStyle||"3"==De.CapStyle){var j=De.CapMerch;De.CapOrientaion;ee.CapOrientaion===De.CapOrientaion&&ee.CapMerch===De.CapMerch&&"Y"!=De.ProdImgUpload||await get_edit_item_img(g_module_index,g_shelf_index,e,De,De.CapOrientaion,De.CapMerch,t)}if(ee.Orientation===De.Orientation&&ee.MerchStyle===De.MerchStyle&&"Y"!=De.ProdImgUpload||await get_edit_item_img(g_module_index,g_shelf_index,e,De,De.Orientation,De.MerchStyle,t),g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].MerchStyle=De.MerchStyle,"1"==De.CapStyle||"2"==De.CapStyle||"3"==De.CapStyle){var N=g_pog_json[t].ModuleInfo[g_module_index],F=I,R=get_cap_max_merch(g_module_index,g_shelf_index,N,F,t,g_dft_max_merch),H=-1,w=l,y=De.CapMaxH,A=l*De.BVert+De.VertGap/100*(De.BVert-1),L=r*De.BaseD,Y=0,B=0,W=0,G=(j=""==De.CapMerch?"0":De.CapMerch,""==De.CapOrientaion?"4":De.CapOrientaion);"0"==j?wpdSetFixed(De.UW)!==wpdSetFixed(De.OrgUW)||wpdSetFixed(De.UH)!==wpdSetFixed(De.OrgUH)||wpdSetFixed(De.UD)!==wpdSetFixed(De.OrgUD)?(Y=De.OrgUW,B=De.OrgUH,W=De.OrgUD):(Y=De.UW,B=De.UH,W=De.UD):"2"==j?wpdSetFixed(De.CW)!==wpdSetFixed(De.OrgCW)||wpdSetFixed(De.CH)!==wpdSetFixed(De.OrgCH)||wpdSetFixed(De.CD)!==wpdSetFixed(De.OrgCD)?(Y=De.OrgCW,B=De.OrgCH,W=De.OrgCD):(Y=De.CW,B=De.CH,W=De.CD):"1"==j?wpdSetFixed(De.TW)!==wpdSetFixed(De.OrgTW)||wpdSetFixed(De.TH)!==wpdSetFixed(De.OrgTH)||wpdSetFixed(De.TD)!==wpdSetFixed(De.OrgTD)?(Y=De.OrgTW,B=De.OrgTH,W=De.OrgTD):(Y=De.TW,B=De.TH,W=De.TD):"3"==j&&(wpdSetFixed(De.DW)!==wpdSetFixed(De.OrgDW)||wpdSetFixed(De.DH)!==wpdSetFixed(De.OrgDH)||wpdSetFixed(De.DD)!==wpdSetFixed(De.OrgDD)?(Y=De.OrgDW,B=De.OrgDH,W=De.OrgDD):(Y=De.DW,B=De.DH,W=De.DD));var[$,k,V,U,X,z]=get_new_orientation_dim(G,Y,B,W),K=B,J=""!==De.CapDepth&&De.CapDepth>1?parseInt(De.CapDepth):1;K*J>L&&(De.CapDepth=Math.trunc(f/V)),B="W"==U?Y:W;var Z=""!==De.CapFacing&&De.CapFacing>0&&De.CapFacing>y&&y>0?parseInt(y):parseInt(De.CapFacing);if("1"==De.CapStyle?(R-=A,H=Math.trunc(R/B),f<V&&(H=0),H>0&&(l=A+B*(H=1))):"2"==De.CapStyle?(R-=A,H=Math.trunc(R/B),"2"==De.MaxHCapStyle&&H>y&&y>0&&(H=y),H="Y"==De.MCapTopFacing&&Z>0?Z:H,f<V&&(H=0),H>0&&(l=A+B*H)):"3"==De.CapStyle&&(R-=w,H=Math.trunc(R/B),"3"==De.MaxHCapStyle&&H>y&&y>0&&(H=y),H="Y"==De.MCapTopFacing&&Z>0?Z:H,f<V&&(H=0),H>0&&(s=l,l+=B*H,$s("P25_ITEM_BASE_VERT",1),De.BVert=1)),H>0){var q=De.BHoriz,Q=H*q*J;g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapFacing=H,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapMerch=j,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapOrientaion=G,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapHeight=B,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].MCapTopFacing=De.MCapTopFacing,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapDepth="N"==S||void 0===S?Math.trunc(f/V):J,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapCount=H,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapHorz=q,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapTotalCount=Q}else g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapFacing=0,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapHeight=0,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].MCapTopFacing="N",g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapCount=0,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapHorz=0,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapDepth=0,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapTotalCount=0,l=l*De.BVert+De.VertGap/100*(De.BVert-1);De.CapCount=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapCount,De.CapFacing=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapFacing,De.CapMerch=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapMerch,De.CapOrientaion=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapOrientaion,De.CapHeight=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapHeight,De.CapHorz=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapHorz,De.CapDepth=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapDepth,De.CapTotalCount=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].CapTotalCount,i=i*De.BHoriz+De.HorizGap/100*(De.BHoriz-1),r*=De.BaseD}else $s("P25_CAP_STYLE","0"),i=i*De.BHoriz+De.HorizGap/100*(De.BHoriz-1),l=l*De.BVert+De.VertGap/100*(De.BVert-1),r*=De.BaseD}var ee,oe=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].DimT,te=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].Z-g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].D/2,_e=set_item_values(De.Item,i,l,r,oe,0,"Y",e,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e].X,-1,De,t,"");d.push(_e),(ee=(I=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index]).ItemInfo[e]).RW=g,ee.RH=s,ee.RD=f,ee.Z=te+r/2;var ne="N";if(g_combinedShelfs.length>0){var[ae,ie]=getCombinationShelf(t,g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Shelf);if(-1!==ae){ne="Y",g_combinedShelfs[ae][0].AllowAutoCrush=void 0===De.ShelfAutoCrush?"N":De.ShelfAutoCrush,g_pog_json[t].ModuleInfo[g_combinedShelfs[ae][0].MIndex].ShelfInfo[g_combinedShelfs[ae][0].SIndex].AllowAutoCrush=De.ShelfAutoCrush;var de=0;for(const e of g_combinedShelfs[ae].ItemInfo){if(ee.ObjID==e.ObjID){console.log(e),g_combinedShelfs[ae].ItemInfo[de]=ee;break}de++}}}if("N"==ne&&(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].AllowAutoCrush=De.ShelfAutoCrush),"Y"==I.ManualCrush&&"CHEST"==I.ObjType&&"Y"==g_chest_as_pegboard||"CHEST"!=I.ObjType||"Y"!=g_chest_as_pegboard){if("Y"==ee.MVertCrushed){var le=await crushItem(t,g_module_index,g_shelf_index,_e,b,"Y",_,d);"Y"==le&&(c="Y")}if("Y"==ee.MHorizCrushed){await crushItem(t,g_module_index,g_shelf_index,_e,T,"Y",_,d);"Y"==le&&(c="Y")}if("Y"==ee.MDepthCrushed){await crushItem(t,g_module_index,g_shelf_index,_e,P,"Y",_,d);"Y"==le&&(c="Y")}}else"Y"==ee.MVertCrushed&&(ee.CrushVert=0),"Y"==ee.MHorizCrushed&&(ee.CrushHoriz=0),"Y"==ee.MDepthCrushed&&(ee.CrushDepth=0);_e="N";var re=I.HorizGap,ge=re,se=I.ItemInfo.length,fe=I.AllowAutoCrush,pe="Y"==ee.MVertCrushed?ee.CrushVert:ee.CHPerc,ce="Y"==ee.MHorizCrushed?ee.CrushHoriz:ee.CWPerc,Ie="Y"==ee.MDepthCrushed?ee.CrushD:ee.CDPerc,ue=ee.Fixed,me=ee.ObjID,he=ee.TopObjID,Se=ee.BottomObjID,Oe=-1;l=ee.H,"SHELF"==v||"CHEST"==v&&"N"==g_chest_as_pegboard||"BASKET"==v||"PALLET"==v?Oe=wpdSetFixed(I.Y+I.H/2+l/2):"HANGINGBAR"==v?Oe=wpdSetFixed(I.Y-l/2):"ROD"==v&&(Oe=wpdSetFixed(I.Y-I.H/2-l/2));var Me="N";if(void 0!==Se&&""!==Se||void 0!==he&&""!==he){var xe=ee;ee.Y=Oe,update_top_bottom_xy(g_module_index,g_shelf_index,e,xe,t),Me="Y"}else"CHEST"==v&&"Y"==g_chest_as_pegboard||"PEGBOARD"==v||(ee.Y=Oe);if("Y"==dim_not_match&&(update_item_org_dim(g_module_index,g_shelf_index,d[0],0,0,0,0,0,0,t),I.ItemInfo[d[0]].DimUpdate="Y"),reorder_items(g_module_index,g_shelf_index,t)){var ve=0;for(const o of I.ItemInfo){if(o.ObjID==me){e=ve;break}ve++}var De=ee;F=I;if("N"==p&&await set_auto_facings(g_module_index,g_shelf_index,e,De,"B","I","D",t),ee.Exists="N","PEGBOARD"==v||"CHEST"==v&&"Y"==g_chest_as_pegboard){if("Y"==c){var[Ee,Ce]=get_item_xy(F,De,De.W,De.H,t);ee.X=Ee,ee.Y=Ce}}else if("N"==c){var Ee=get_item_xaxis(i,l,r,v,ee.X,ge,D,re,g_module_index,g_shelf_index,e,"Y",se,"N",t);"N"==(_e=await item_height_validation(l,g_module_index,g_shelf_index,e,"Y",Ee,fe,pe,ue,"Y",r,p,g_pog_index))&&(ee.X=Ee),ee.Exists="N"}}a.push(wpdSetFixed(ee.W)),n.push(wpdSetFixed(ee.H)),_.push(wpdSetFixed(ee.D));if("Y"==$v("P25_AUTO_CALC_DEPTH_FACING_ON_SAVE")&&await maximizeItemDepthFacings("D",g_module_index,g_shelf_index,e,t),"N"==_e&&validate_items(a,n,_,d,g_shelf_object_type,g_module_index,g_shelf_index,e,"Y",ce,pe,Ie,ee.X,$v("P25_ITEM_FIXED"),"N","N",Me,p,[],"Y","Y","Y",t)){if(g_pog_edited_ind="Y",ee.pegHeadRoom=u,"Y"==dim_not_match&&(update_item_org_dim(g_module_index,g_shelf_index,d[0],0,0,0,0,0,0,t),I.ItemInfo[d[0]].DimUpdate="Y"),reorder_items(g_module_index,g_shelf_index,t))await recreate_all_items(g_module_index,g_shelf_index,g_shelf_object_type,"Y",-1,-1,I.ItemInfo.length,"N","N",-1,-1,g_start_canvas,"N",t,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y");update_item_distance(g_module_index,g_shelf_index,t),async function(){await recreate_compare_views(g_compare_view,"N")}(),g_pog_json[t].ModuleInfo[g_module_index].EditFlag="Y","CHEST"==g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType&&"Y"==g_chest_as_pegboard&&(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ChestEdit="Y");await calculateFixelAndSupplyDays("N",t)}else{var be=I.ItemInfo[d[0]].DimUpdate;if(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[e]=x,ee.DimUpdate=be,"Y"==dim_not_match){var Te=g_world.getObjectById(I.ItemInfo[d[0]].ObjID);Te.WireframeObj.material.color.setHex(g_dim_error_color),ee.DimUpdate="E",Te.DimUpdate="E",Te.BorderColour=g_dim_error_color,render(t)}}if(g_dblclick_opened="N",$s("P25_ITEM_EDIT_IND","N"),g_ItemImages.length>0&&"N"==img_exists)_e=await save_image_to_coll(g_ItemImages,"1");animate_all_pog(),logDebug("function : edit_items","E")}return"Yes"}catch(e){error_handling(e)}}function set_item_values(e,o,t,_,n,a,i,d,l,r,g,s,f,p,c){logDebug("function : set_item_values; item_code : "+e+"; item_width : "+o+"; item_height : "+t+"; item_depth : "+_+"; item_dim_type : "+n+"; item_Y : "+a+"; edited_ind : "+i+"; i_item_index : "+d+"; item_x : "+l+"; min_index : "+r,"S");var I={},u=g_pog_json[s].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index],m=u.ItemInfo[d],h=-1;if("N"==i){var S=apex.region("draggable_table").widget().interactiveGrid("getViews","grid").model,O=S.getRecord(e);item_description=S.getValue(O,"DESCRIPTION"),barcode=S.getValue(O,"PRIM_BARCODE"),supplier_name=S.getValue(O,"SUPPLIER_NAME"),brand_name=S.getValue(O,"BRAND_SHOW"),group_no=S.getValue(O,"GROUP_NO"),dept=S.getValue(O,"DEPARTMENT"),item_class=S.getValue(O,"CLASS"),subclass=S.getValue(O,"SUBCLASS"),std_uom=S.getValue(O,"STANDARD_UOM"),item_size_desc=S.getValue(O,"ITEM_SIZE_DESC"),img_exists=S.getValue(O,"IMG_EXISTS"),GoGreen=S.getValue(O,"GO_GREEN"),LiveNewItem=S.getValue(O,"LIVE_NEW_ITEM"),ItmDescChi=S.getValue(O,"BRAND_CN"),org_u_width=u_width=parseFloat(S.getValue(O,"ITEM_WIDTH"))/100,org_u_height=u_height=parseFloat(S.getValue(O,"ITEM_HEIGHT"))/100,org_u_depth=u_depth=parseFloat(S.getValue(O,"ITEM_DEPTH"))/100,org_c_width=c_width=parseFloat(S.getValue(O,"C_WIDTH"))/100,org_c_height=c_height=parseFloat(S.getValue(O,"C_HEIGHT"))/100,org_c_depth=c_depth=parseFloat(S.getValue(O,"C_DEPTH"))/100,org_t_width=t_width=parseFloat(S.getValue(O,"T_WIDTH"))/100,org_t_height=t_height=parseFloat(S.getValue(O,"T_HEIGHT"))/100,org_t_depth=t_depth=parseFloat(S.getValue(O,"T_DEPTH"))/100,org_d_width=d_width=parseFloat(S.getValue(O,"D_WIDTH"))/100,org_d_height=d_height=parseFloat(S.getValue(O,"D_HEIGHT"))/100,org_d_depth=d_depth=parseFloat(S.getValue(O,"D_DEPTH"))/100,org_crush_width_perc=crush_width_perc=parseFloat(S.getValue(O,"R_WIDTH")),org_crush_height_perc=crush_height_perc=parseFloat(S.getValue(O,"R_HEIGHT")),org_crush_depth_perc=crush_depth_perc=parseFloat(S.getValue(O,"R_DEPTH")),org_o_width=o_width=parseFloat(S.getValue(O,"O_WIDTH"))/100,org_o_height=o_height=parseFloat(S.getValue(O,"O_HEIGHT"))/100,org_o_depth=o_depth=parseFloat(S.getValue(O,"O_DEPTH"))/100,org_n_width=n_width=parseFloat(S.getValue(O,"N_WIDTH"))/100,org_n_height=n_height=parseFloat(S.getValue(O,"N_HEIGHT"))/100,org_n_depth=n_depth=parseFloat(S.getValue(O,"N_DEPTH"))/100,selling_price=parseFloat(nvl(S.getValue(O,"SELLING_PRICE"))),DaysOfSupply=S.getValue(O,"DAYS_OF_SUPPLY"),sales_unit=parseFloat(nvl(S.getValue(O,"SALES_UNIT"))),net_sales=parseFloat(nvl(S.getValue(O,"NET_SALES"))),profit=parseFloat(nvl(S.getValue(O,"PROFIT"))),total_margin=parseFloat(nvl(S.getValue(O,"TOTAL_MARGIN"))),newItemYN=S.getValue(O,"NEW_ITEMYN"),item_status=S.getValue(O,"ITEM_STATUS"),item_price=S.getValue(O,"ITEM_PRICE"),item_cost=S.getValue(O,"ITEM_COST"),max_h_facings=parseInt(S.getValue(O,"MAX_H_FACINGS")),max_v_facings=parseInt(S.getValue(O,"MAX_V_FACINGS")),max_d_facings=parseInt(S.getValue(O,"MAX_D_FACINGS")),CogsAdj=parseInt(S.getValue(O,"COGS_ADJ")),GrossProfit=parseInt(S.getValue(O,"GROSS_PROFIT")),reg_mov=parseFloat(S.getValue(O,"REG_MOV")),avg_sales=parseFloat(S.getValue(O,"AVG_SALES")),item_status_desc=S.getValue(O,"ITEM_STATUS_DESC"),WeeksCount=parseInt(S.getValue(O,"WEEKS_COUNT")),MovingItem=S.getValue(O,"MOVING_ITEM"),max_v_facings=parseInt(S.getValue(O,"MAX_V_FACINGS")),max_d_facings=parseInt(S.getValue(O,"MAX_D_FACINGS")),store_count=S.getValue(O,"STORE_COUNT"),DescSecond=S.getValue(O,"DESC_SECOND"),cdt_lvl1=S.getValue(O,"CDT_LVL1"),cdt_lvl2=S.getValue(O,"CDT_LVL2"),cdt_lvl3=S.getValue(O,"CDT_LVL3"),brad_category=S.getValue(O,"BRAND_CATEGORY"),uda_item_status=S.getValue(O,"UDA_ITEM_STATUS"),gobe_co_brand=S.getValue(O,"GOBE_CO_BRAND"),internet=S.getValue(O,"INTERNET"),COO=S.getValue(O,"COO"),SplrLbl=S.getValue(O,"SUPP_LABEL"),LoGrp=S.getValue(O,"LAYOUT_GROUP"),InternationalRng=S.getValue(O,"INTERNATIONAL_RANGE"),ActualDPP=S.getValue(O,"ACTUAL_DPP"),DPPLoc=S.getValue(O,"DPP_PER_LOC"),StoreSOH=S.getValue(O,"STORE_SOH"),StoreNo=S.getValue(O,"STORE_NUMBER"),WeeksOfInventory=S.getValue(O,"WEEK_OF_INVENTORY"),NewItem=S.getValue(O,"NEW_ITEM"),ItemSize=S.getValue(O,"ITEM_SIZE"),EDLP=S.getValue(O,"EDLP"),unitpercase=S.getValue(O,"UNIT_PER_CASE"),unitpertray=S.getValue(O,"UNIT_PER_TRAY"),Categ=S.getValue(O,"CAT"),uda751=S.getValue(O,"UDA751"),uda755=S.getValue(O,"UDA755"),cap_style=S.getValue(O,"CAPSTYLE"),cap_merch_style=S.getValue(O,"CAP_MERCH_STYLE"),cap_orientation=S.getValue(O,"CAP_ORIENTATION"),base_horiz=1,base_vert=1,base_depth=1,color=$v("P25_POG_ITEM_DEFAULT_COLOR"),crush_horiz=0,crush_vert=0,crush_depth=0,itemobjid="",random_id=c,item_fixed="N",location_id="",item_orientation=f;var M=item_size_desc.split("*");merch_style="0",rotation=0,Cap_max_high=0,max_high_cap_style="3",nesting="",contain="",contain_val=0,nesting_val=0,peg_id="",item_overhang=0,item_gap=0,vert_gap=0,item_qty=1,cap_count=0,cap_facing=0,cap_merch="",cap_height=0,cap_horz=0,cap_depth=0,item_y=a,bottom_id="",top_id="",second_tier="",pegboard_x="",pegboard_y="",delist_ind="N",daysOfSupplyID=-1,cap_total_count="",CDTLvl1="N",CDTLvl2="N",CDTLvl3="N",brandtype=S.getValue(O,"LABEL_TYPE"),PkSiz=M[1],ItmDescEng=brand_name+" "+item_description+" "+M[0]/M[1]+"*"+M[1]+"*"+M[2],MPogVertFacings="",MPogHorizFacings="",MPogDepthFacings="",item_condition=S.getValue(O,"ITEM_CONDITION"),aur=S.getValue(O,"AUR"),item_ranking=S.getValue(O,"ITEM_RANKING"),weekly_sales=S.getValue(O,"WEEKLY_SALES"),weekly_net_margin=S.getValue(O,"WEEKLY_NET_MARGIN"),weekly_qty=S.getValue(O,"WEEKLY_QTY"),net_margin_percent=""!==S.getValue(O,"NET_MARGIN_PERCENT")?Math.round(100*S.getValue(O,"NET_MARGIN_PERCENT"))/100:"",cumulative_nm=S.getValue(O,"CUMULATIVE_NM"),top80_b2=S.getValue(O,"TOP80_B2"),item_brand_c="",item_pog_dept=S.getValue(O,"ITEM_POG_DEPT"),item_remark=S.getValue(O,"ITEM_REMARK"),shelf_price=S.getValue(O,"SHELF_PRICE"),promo_price=S.getValue(O,"PROMO_PRICE"),discount_rate=S.getValue(O,"DISCOUNT_RATE"),price_change_date=S.getValue(O,"PRICE_CHANGE_DATE"),Weeks_In_Rotation=S.getValue(O,"WEEKS_IN_ROTATION"),qty=S.getValue(O,"QTY"),wh_stock=S.getValue(O,"WH_STOCK"),store_stock=S.getValue(O,"STORE_STOCK"),stock_intransit=S.getValue(O,"STOCK_INTRANSIT"),rtv_status=S.getValue(O,"RTV_STATUS"),pusher=S.getValue(O,"PUSHER"),divider=S.getValue(O,"DIVIDER"),back_support=S.getValue(O,"BACK_SUPPORT"),oos_perc=parseInt(S.getValue(O,"STORE_NUMBER")||0)>0?parseFloat(S.getValue(O,"STORE_NO_STOCK")).toFixed(2):"",initial_item_desc=S.getValue(O,"INITIAL_ITEM_DESC"),initial_brand=S.getValue(O,"INITIAL_BRAND"),initial_barcode=S.getValue(O,"INITIAL_BARCODE")}else{item_description=g.Desc,barcode=g.Barcode,supplier_name=g.Supplier,brand_name=g.Brand,group_no=g.Group,dept=g.Dept,item_class=g.Class,subclass=g.SubClass,std_uom=g.StdUOM;M=g.SizeDesc.split("*");item_size_desc=g.SizeDesc,u_width=g.UW,u_height=g.UH,u_depth=g.UD,c_width=g.CW,c_height=g.CH,c_depth=g.CD,t_width=g.TW,t_height=g.TH,t_depth=g.TD,d_width=g.DW,d_height=g.DH,d_depth=g.DD,nesting=g.ItemNesting,p=g.OrientationDesc,store_count=g.StoreCnt,nesting_val=g.NestingVal,contain=g.ItemContain,contain_val=g.ContainVal,org_n_width=n_width=g.NW,org_n_height=n_height=g.NH,org_n_depth=n_depth=g.ND,org_o_width=o_width=g.CnW,org_o_height=o_height=g.CnH,org_o_depth=o_depth=g.CnD,org_u_width=g.OrgUW,org_u_height=g.OrgUH,org_u_depth=g.OrgUD,org_c_width=g.OrgCW,org_c_height=g.OrgCH,org_c_depth=g.OrgCD,org_t_width=g.OrgTW,org_t_height=g.OrgTH,org_t_depth=g.OrgTD,org_d_width=g.OrgDW,org_d_height=g.OrgDH,org_d_depth=g.OrgDD,org_crush_width_perc=g.OrgCWPerc,org_crush_height_perc=g.OrgCHPerc,org_crush_depth_perc=g.OrgCDPerc,selling_price=g.SellingPrice,sales_unit=g.SalesUnit,net_sales=g.NetSales,CogsAdj=g.CogsAdj,GrossProfit=g.GrossProfit,WeeksCount=g.WeeksCount,MovingItem=g.MovingItem,reg_mov=g.RegMovement,avg_sales=g.AvgSales,item_status_desc=g.ItemStatus,cdt_lvl1=g.CDTLvl1,cdt_lvl2=g.CDTLvl2,cdt_lvl3=g.CDTLvl3,profit=g.Profit,total_margin=g.TotalMargin,newItemYN=g.NewYN,item_status=g.Status,item_price=g.Price,item_cost=g.Cost,DaysOfSupply=g.DaysOfSupply,delist_ind=g.Delist,max_h_facings=g.MHorizFacings,max_v_facings=g.MVertFacings,max_d_facings=g.MDepthFacings,DescSecond=g.DescSecond,weeks_of_inventory=g.WeeksOfInventory,random_id="",base_horiz=g.BHoriz,base_vert=g.BVert,"BASKET"==m.CType?base_depth=g.Quantity:base_depth=g.BaseD,color=g.Color,crush_horiz=g.CrushHoriz,crush_vert=g.CrushVert,crush_depth=g.CrushD,crush_height_perc=g.CHPerc,crush_width_perc=g.CWPerc,crush_depth_perc=g.CDPerc,item_fixed=g.Fixed,location_id=g.LocID,item_orientation=g.Orientation,merch_style=g.MerchStyle,rotation=g.Rotation,cap_style=g.CapStyle,cap_merch_style=g.CapMerch,cap_orientation=g.CapOrientaion,Cap_max_high=g.CapMaxH,max_high_cap_style=g.MaxHCapStyle,peg_id=g.PegID,item_overhang=g.OverHang,item_gap=g.HorizGap,vert_gap=g.VertGap,item_qty=g.Quantity,I.MHorizCrushed=g.MHorizCrushed,I.MVertCrushed=g.MVertCrushed,I.MDepthCrushed=g.MDepthCrushed,I.MCapTopFacing=void 0!==m.MCapTopFacing?m.MCapTopFacing:"N",img_exists=m.ImgExists,itemobjid=g.ObjID,cap_count=g.CapCount,cap_facing=g.CapFacing,cap_height=g.CapHeight,cap_horz=g.CapHorz,cap_depth=g.CapDepth,cap_total_count=g.CapTotalCount,item_exists=g.Exists,item_y=g.Y,bottom_id=m.BottomObjID,top_id=m.TopObjID,second_tier=m.SecondTier,pegboard_x=m.PegBoardX,pegboard_y=m.PegBoardY,daysOfSupplyID=m.daysOfSupplyID,brad_category=void 0!==m.Brand_Category?m.Brand_Category:"",uda_item_status=void 0!==m.Uda_item_status?m.Uda_item_status:"",gobe_co_brand=void 0!==m.Gobecobrand?m.Gobecobrand:"",internet=void 0!==m.Internet?m.Internet:"",Categ=void 0!==m.Categ?m.Categ:"",COO=void 0!==m.COO?m.COO:"",ItmeSize=void 0!==m.ItmeSize?m.ItmeSize:"",SplrLbl=void 0!==m.SplrLbl?m.SplrLbl:"",EDLP=void 0!==m.EDLP?m.EDLP:"",LoGrp=void 0!==m.LoGrp?m.LoGrp:"",InternationalRng=void 0!==m.InternationalRng?m.InternationalRng:"",ActualDPP=void 0!==m.ActualDPP?m.ActualDPP:"",DPPLoc=m.DPPLoc,StoreSOH=void 0!==m.StoreSOH?m.StoreSOH:"",StoreNo=void 0!==m.StoreNo?m.StoreNo:"",WeeksOfInventory=void 0!==m.WeeksOfInventory?m.WeeksOfInventory:"",NewItem=void 0!==m.NewItem?m.NewItem:"",LiveNewItem=void 0!==m.LiveNewItem?m.LiveNewItem:"",GoGreen=void 0!==m.GoGreen?m.GoGreen:"",unitpercase=void 0!==m.UnitperCase?m.UnitperCase:1,unitpertray=void 0!==m.UnitperTray?m.UnitperTray:1,brandtype=m.BrandType,PkSiz=m.PkSiz,ItemSize=m.ItemSize,ItmDescChi=m.ItmDescChi,ItmDescEng=m.ItmDescEng,MPogVertFacings=void 0!==m.MPogVertFacings?m.MPogVertFacings:"",MPogHorizFacings=void 0!==m.MPogHorizFacings?m.MPogHorizFacings:"",MPogDepthFacings=void 0!==m.MPogDepthFacings?m.MPogDepthFacings:"",uda751=void 0!==m.UDA751?m.UDA751:"",uda755=void 0!==m.UDA755?m.UDA755:"",item_condition=g.ItemCondition,aur=g.AUR,item_ranking=g.ItemRanking,weekly_sales=g.WeeklySales,weekly_net_margin=g.WeeklyNetMargin,weekly_qty=g.WeeklyQty,net_margin_percent=g.NetMarginPercent,cumulative_nm=g.CumulativeNM,top80_b2=g.TOP80B2,item_brand_c=g.ItemBrandC,item_pog_dept=g.ItemPOGDept,item_remark=g.ItemRemark,rtv_status=g.RTVStatus,pusher=g.Pusher,divider=g.Divider,back_support=g.BackSupport,oos_perc=g.OOSPerc,initial_item_desc=g.InitialItemDesc,initial_brand=g.InitialBrand,initial_barcode=g.InitialBarcode,shelf_price=g.ShelfPrice,promo_price=g.PromoPrice,discount_rate=g.DiscountRate,price_change_date=g.PriceChangeDate,Weeks_In_Rotation=g.WeeksOfInventory,qty=g.Qty,wh_stock=g.WhStock,store_stock=g.StoreStock,stock_intransit=g.StockIntransit}if("undefined"!=typeof dept&&""!==dept&&null!==dept)var x=dept.split("-");else x="";if("undefined"!=typeof item_class&&""!==item_class&&null!==item_class)var v=item_class.split("-");else v="";if("undefined"!=typeof subclass&&""!==subclass&&null!==subclass)var D=subclass.split("-");else D="";if(I.ClassName=x[0]+"/"+v[0]+"/"+D[0],I.Edited=i,I.ItemID=e,I.Item=e,I.W=o,I.H=t,I.D=_,I.Color=color,I.ShowColorBackup=color,I.DimT=n,I.Desc=item_description,I.Barcode=barcode,I.LocID=location_id,I.PegID=peg_id,I.PegSpread="Y"==i?g.PegSpread:"",I.PegPerFacing="Y"==i?g.PegPerFacing:"",I.BrandType=brandtype,I.Fixed=item_fixed,I.CapStyle=cap_style,I.CapMerch=cap_merch_style,I.CapOrientaion=cap_orientation,I.CapMaxH=Cap_max_high,I.MaxHCapStyle=max_high_cap_style,I.Rotation=rotation,I.BHoriz=base_horiz,I.BVert=base_vert,I.BaseD=base_depth,I.CrushHoriz=crush_horiz,I.CrushVert=crush_vert,I.CrushD=crush_depth,I.Orientation=item_orientation,I.MerchStyle=merch_style,I.Supplier=supplier_name,"undefined"!=typeof supplier_name&&""!==supplier_name&&null!==supplier_name){var E=supplier_name.split("-");void 0!==E[1]?I.SupplierName=E[1]:I.SupplierName=E[0]}else I.SupplierName="";if(I.Brand=brand_name,I.Group=group_no,I.Dept=dept,I.Class=item_class,I.SubClass=subclass,I.StdUOM=std_uom,I.SizeDesc=item_size_desc,I.Price=$v("P25_PRICE"),I.Cost=$v("P25_COST"),I.DaysOfSupply="Y"==i?g.DaysOfSupply:DaysOfSupply,I.RegMovement="Y"==i?g.RegMovement:"",I.AvgSales="Y"==i?g.AvgSales:"",I.ItemStatus="Y"==i?g.ItemStatus:"",I.MoveBasis="Y"==i?g.MoveBasis:"",I.PegBoardX=pegboard_x,I.PegBoardY=pegboard_y,I.CHPerc=crush_height_perc,I.CWPerc=crush_width_perc,I.CDPerc=crush_depth_perc,I.CnW=o_width,I.CnH=o_height,I.CnD=o_depth,I.NW=n_width,I.NH=n_height,I.ND=n_depth,I.OldCnW=o_width,I.OldCnH=o_height,I.OldCnD=o_depth,I.OldNW=n_width,I.OldNH=n_height,I.OldND=n_depth,I.OrgUW=org_u_width,I.OrgUH=org_u_height,I.OrgUD=org_u_depth,I.OrgCW=org_c_width,I.OrgCH=org_c_height,I.OrgCD=org_c_depth,I.OrgTW=org_t_width,I.OrgTH=org_t_height,I.OrgTD=org_t_depth,I.OrgDW=org_d_width,I.OrgDH=org_d_height,I.OrgDD=org_d_depth,I.OrgCHPerc=org_crush_height_perc,I.OrgCWPerc=org_crush_width_perc,I.OrgCDPerc=crush_depth_perc,I.OrgCnW=org_o_width,I.OrgCnH=org_o_height,I.OrgCnD=org_o_depth,I.OrgNW=org_n_width,I.OrgNH=org_n_height,I.OrgND=org_n_depth,I.ItemNesting=nesting,I.NVal=nesting_val,I.ItemContain=contain,I.CnVal=contain_val,I.IsContainer="Y"==i?g.IsContainer:"N",I.BsktFactor="Y"==i?g.BsktFactor:0,I.OverHang=item_overhang,I.HorizGap=item_gap,I.VertGap=vert_gap,I.UW=u_width,I.UH=u_height,I.UD=u_depth,I.CW=c_width,I.CH=c_height,I.CD=c_depth,I.TW=t_width,I.TH=t_height,I.TD=t_depth,I.DW=d_width,I.DH=d_height,I.DD=d_depth,I.SIndex=g_shelf_index,I.Dragged="N",I.Quantity=item_qty,I.Y=item_y,I.X=l,I.SlotDivider="",I.WChanged="",I.ObjID=itemobjid,I.ImgExists=img_exists,I.CapCount=cap_count,I.CapFacing=cap_facing,I.CapHeight=cap_height,I.CapHorz=cap_horz,I.CapDepth=cap_depth,I.CapTotalCount=cap_total_count,I.TopObjID=top_id,I.BottomObjID=bottom_id,I.SecondTier=second_tier,I.SellingPrice=selling_price,I.SalesUnit=sales_unit,I.NetSales="undefined"!=typeof net_sales?net_sales:0,I.CogsAdj=CogsAdj,I.GrossProfit="undefined"!=typeof GrossProfit?GrossProfit:0,I.WeeksCount=WeeksCount,I.MovingItem=MovingItem,I.Profit=profit,I.RegMovement=isNaN(reg_mov)?0:reg_mov,I.AvgSales=isNaN(avg_sales)?0:avg_sales,I.ItemStatus=item_status_desc,I.TotalMargin=total_margin,I.Status=item_status,I.CDTLvl1=cdt_lvl1,I.CDTLvl2=cdt_lvl2,I.CDTLvl3=cdt_lvl3,I.Price=item_price,I.Cost=item_cost,I.DaysOfSupply=DaysOfSupply,I.OrientationDesc=p,I.StoreCnt=store_count,I.NewYN=newItemYN,I.Delist=delist_ind,I.MHorizFacings=max_h_facings,I.MVertFacings=max_v_facings,I.MDepthFacings=max_d_facings,I.daysOfSupplyID=daysOfSupplyID,I.DescSecond=DescSecond,I.UnitperCase=unitpercase,I.UnitperTray=unitpertray,I.Brand_Category="undefined"!=typeof brad_category?brad_category:"",I.Uda_item_status="undefined"!=typeof uda_item_status?uda_item_status:"",I.Gobecobrand="undefined"!=typeof gobe_co_brand?gobe_co_brand:"",I.Internet="undefined"!=typeof internet?internet:"",I.Categ="undefined"!=typeof Categ?Categ:"",I.COO="undefined"!=typeof COO?COO:"",I.ItemSize="undefined"!=typeof ItemSize?ItemSize:"",I.SplrLbl="undefined"!=typeof SplrLbl?SplrLbl:"",I.EDLP="undefined"!=typeof EDLP?EDLP:"",I.GoGreen="undefined"!=typeof GoGreen?GoGreen:"",I.LoGrp="undefined"!=typeof LoGrp?LoGrp:"",I.InternationalRng="undefined"!=typeof InternationalRng?InternationalRng:"",I.ActualDPP="undefined"!=typeof ActualDPP?ActualDPP:"",I.DPPLoc=DPPLoc,I.StoreCnt="undefined"!=typeof StoreCnt?StoreCnt:"",I.StoreNo="undefined"!=typeof StoreNo?StoreNo:"",I.WeeksOfInventory="undefined"!=typeof WeeksOfInventory?WeeksOfInventory:"",I.StoreSOH="undefined"!=typeof StoreSOH?StoreSOH:"",I.NewItem="undefined"!=typeof NewItem?NewItem:"",I.LiveNewItem=LiveNewItem,I.ItemSize=ItemSize,I.ItmDescChi=ItmDescChi,I.ItmDescEng=ItmDescEng,I.PkSiz=PkSiz,I.SIndex=g_shelf_index,I.MIndex=g_module_index,I.MPogVertFacings="undefined"!=typeof MPogVertFacings?MPogVertFacings:"",I.MPogHorizFacings="undefined"!=typeof MPogHorizFacings?MPogHorizFacings:"",I.MPogDepthFacings="undefined"!=typeof MPogDepthFacings?MPogDepthFacings:"",I.UDA751=uda751,I.UDA755=uda755,I.ItemCondition=item_condition,I.AUR=aur,I.ItemRanking=item_ranking,I.WeeklySales=weekly_sales,I.WeeklyNetMargin=weekly_net_margin,I.WeeklyQty=weekly_qty,I.NetMarginPercent=net_margin_percent,I.CumulativeNM=cumulative_nm,I.TOP80B2=top80_b2,I.ItemBrandC=item_brand_c,I.ItemPOGDept=item_pog_dept,I.ItemRemark=item_remark,I.RTVStatus=rtv_status,I.Pusher=pusher,I.Divider=divider,I.BackSupport=back_support,I.OOSPerc=oos_perc,I.InitialItemDesc=initial_item_desc,I.InitialBrand=initial_brand,I.InitialBarcode=initial_barcode,I.ShelfPrice=shelf_price,I.PromoPrice=promo_price,I.DiscountRate=discount_rate,I.PriceChangeDate=price_change_date,I.WeeksOfInventory=Weeks_In_Rotation,I.Qty=qty,I.WhStock=wh_stock,I.StoreStock=store_stock,I.StockIntransit=stock_intransit,"N"==i?(I.OW=o,I.OH=t,I.OD=_,I.SpreadItem=0,I.MHorizCrushed="N",I.MVertCrushed="N",I.MDepthCrushed="N",I.MCapTopFacing="N",I.RW=o,I.RH=t,I.RD=_,I.LObjID=-1,I.SubLblObjID=-1,I.DimUpdate="N",I.RandomID=random_id,"PEGBOARD"==u.ObjType||"CHEST"==u.ObjType&&"Y"==g_chest_as_pegboard?(u.ItemInfo.push(I),h=u.ItemInfo.length-1):r>-1?"R"==u.SpreadItem?(u.ItemInfo.splice(r,0,I),h=r):(u.ItemInfo.splice(r+1,0,I),h=u.ItemInfo.length-1==r?r:r+1):d>-1?(u.ItemInfo.splice(d,0,I),h=d):(u.ItemInfo.push(I),h=u.ItemInfo.length-1)):(I.OW=m.OW,I.OH=m.OH,I.OD=m.OD,I.Exists=item_exists,I.DimUpdate=m.DimUpdate,u.ItemInfo[d]=I,h=d),void 0!==g_pog_json[g_pog_index].DeleteItems)if(g_pog_json[g_pog_index].DeleteItems.length>0){var C=0;for(var m of g_pog_json[g_pog_index].DeleteItems)m.Item==e&&g_pog_json[g_pog_index].DeleteItems.splice(C,1),C++}else g_pog_json[g_pog_index].DeleteItems.splice(g_pog_json[g_pog_index].DeleteItems.length-1,1);return logDebug("function : set_item_values","S"),h}function get_spread_gap(e,o,t){logDebug("function : get_spread_gap; spread_product : "+e+"; p_module_index : "+o+"; p_shelf_index : "+t,"S");var _=g_pog_json[p_pog_index].ModuleInfo[o].ShelfInfo[t],n=_.HorizGap,a=(e=_.SpreadItem,0),i=0,d=0,l=[],r=0;if(n>0)i=n;else if("E"==e){for(const e of _.ItemInfo)a+=e.W,d+=1,_.ItemInfo[r].W=_.ItemInfo[r].OW*e.BHoriz,r++;i=(_.W+_.LOverhang+_.ROverhang-a)/(d-1)}else if("F"==e){l=_.ItemInfo,r=0;for(const e of l)a+=e.OW*e.BHoriz,d+=e.BHoriz,r++;i=(_.W+_.LOverhang+_.ROverhang-a)/(d-1);r=0;for(const e of l)e.BHoriz>1&&(_.ItemInfo[r].W=_.ItemInfo[r].OW*e.BHoriz+i*(e.BHoriz-1)),r++}return logDebug("function : get_spread_gap","E"),i}async function recreate_multi_items(e,o,t,_,n,a,i,d,l,r,g){logDebug("function : recreate_multi_items; p_module_index : "+e+"; p_shelf_index : "+o+"; shelf_obj_type : "+t+"; p_edit_ind : "+_+"; locationX : "+n+"; edit_item_index : "+a+"; item_length : "+i+"; shelf_edit : "+l,"S");try{var s=g_pog_json[g].ModuleInfo[e].ShelfInfo[o],f=s.HorizGap,p=f,c=s.SpreadItem,I=(s.Combine,s.Rotation,s.X-s.W/2),u=s.Y-s.H/2,m=[],h=0;if(void 0!==r)m=r;else m=s.ItemInfo;var S=m.length,O=0;for(const e of m){var M=g_world.getObjectById(e.ObjID);g_world.remove(M),e.W,O++}if("SHELF"==t&&(s.AvlSpace=wpdSetFixed(s.W+s.LOverhang+s.ROverhang)),render(g),"R"==c)for(O=(m=s.ItemInfo).length-1;O>=0;O--){if(S-=1,h=get_item_xaxis(m[O].W,m[O].H,m[O].D,t,n,p,c,f,e,o,S,_,s.ItemInfo.length,l,g),"DIVIDER"==m[O].Item){var x=g_pog_json[g].ModuleInfo[e].ShelfInfo,v=-1,D=0;for(const e of x)e.Shelf==m[O].ItemID&&"DIVIDER"==e.ObjType&&(v=D),D++;g_pog_json[g].ModuleInfo[e].ShelfInfo[v].X=h}s.ItemInfo[S].Distance=h-m[O].W/2-I,"PEGBOARD"==s.ObjType&&(s.ItemInfo[S].PegBoardX=h-m[O].W/2-I,s.ItemInfo[S].PegBoardY=s.ItemInfo[S].Y-m[O].H/2-u,s.ItemInfo[S].FromProductList="N"),s.ItemInfo[S].OldObjID=m[O].ObjID;var E=m[O].ObjID;if("Y"==g_show_live_image&&"DIVIDER"!==m[O].Item)var C=g_orientation_json[s.ItemInfo[S].Orientation].split("###"),b=await add_items_with_image(m[O].ItemID,m[O].W,m[O].H,m[O].D,m[O].Color,h,m[O].Y,"",e,o,O,m[O].BHoriz,m[O].BVert,m[O].Item,parseInt(C[0]),parseInt(C[1]),"N",d,$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),g);else if("DIVIDER"==m[O].Item)b=add_items(m[O].ItemID,m[O].W,m[O].H,m[O].D,m[O].Color,h,m[O].Y,"",e,o,O,m[O].Rotation,g);else b=await add_items_prom(m[O].ItemID,m[O].W,m[O].H,m[O].D,m[O].Color,h,m[O].Y,"",e,o,O,"N",d,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),g);if("E"==m[O].DimUpdate)(M=g_world.getObjectById(b)).WireframeObj.material.color.setHex(16711680);var T=0;if(T="PEGBOARD"==s.ObjType?s.Z+s.D/2+m[O].D/2:.001+s.D/1e3,s.ItemInfo[O].X=h,s.ItemInfo[O].Z=T,s.ItemInfo[O].ObjID=b,s.ItemInfo[O].CType=s.ObjType,void 0!==m[O].TopObjID&&""!==m[O].TopObjID||void 0!==m[O].BottomObjID&&""!==m[O].BottomObjID){P=""!==m[O].TopObjID&&void 0!==m[O].TopObjID?"BOTTOM":"TOP";reset_top_bottom_obj_id(P,E,b,h,"N",g)}"DIVIDER"==m[O].Item&&(g_pog_json[g].ModuleInfo[e].ShelfInfo[v].ShelfDivObjID=b)}else{O=0,m=s.ItemInfo;for(const a of m){if(h=get_item_xaxis(a.W,a.H,a.D,t,n,p,c,f,e,o,O,_,s.ItemInfo.length,l,g),"DIVIDER"==a.Item){x=g_pog_json[g].ModuleInfo[e].ShelfInfo,v=-1,D=0;for(const e of x)e.Shelf==a.ItemID&&"DIVIDER"==e.ObjType&&(v=D),D++;g_pog_json[g].ModuleInfo[e].ShelfInfo[v].X=h}s.ItemInfo[O].Distance=h-a.W/2-I,"PEGBOARD"==s.ObjType&&(s.ItemInfo[O].PegBoardX=h-a.W/2-I,s.ItemInfo[O].PegBoardY=s.ItemInfo[O].Y-a.H/2-u,s.ItemInfo[O].FromProductList="N"),s.ItemInfo[O].OldObjID=a.ObjID;E=a.ObjID;if("Y"==g_show_live_image&&"DIVIDER"!==a.Item)C=g_orientation_json[s.ItemInfo[O].Orientation].split("###"),b=await add_items_with_image(a.ItemID,a.W,a.H,a.D,a.Color,h,s.ItemInfo[O].Y,"",e,o,O,a.BHoriz,a.BVert,a.Item,parseInt(C[0]),parseInt(C[1]),"N",d,$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),g);else if("DIVIDER"==a.Item)b=add_items(a.ItemID,a.W,a.H,a.D,a.Color,h,a.Y,"",e,o,O,a.Rotation,g);else b=await add_items_prom(a.ItemID,a.W,a.H,a.D,a.Color,h,s.ItemInfo[O].Y,"",e,o,O,"N",d,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),g);if("E"==a.DimUpdate)(M=g_world.getObjectById(b)).WireframeObj.material.color.setHex(16711680);if(T="PEGBOARD"==s.ObjType?s.Z+s.D/2+a.D/2:.001+s.D/1e3,s.ItemInfo[O].X=h,s.ItemInfo[O].Z=T,s.ItemInfo[O].ObjID=b,s.ItemInfo[O].CType=s.ObjType,void 0!==a.TopObjID&&""!==a.TopObjID||void 0!==a.BottomObjID&&""!==a.BottomObjID){P=""!==a.TopObjID&&void 0!==a.TopObjID?"BOTTOM":"TOP";reset_top_bottom_obj_id(P,E,b,h,"N",g)}"DIVIDER"==a.Item&&(g_pog_json[g].ModuleInfo[e].ShelfInfo[v].ShelfDivObjID=b),O+=1}}!async function(){await update_undo_redo_objID(g_pog_json)}();m=s.ItemInfo;O=0;for(const e of m){if(void 0!==e.TopObjID&&""!==e.TopObjID||void 0!==e.BottomObjID&&""!==e.BottomObjID){var P;P=""!==e.TopObjID&&void 0!==e.TopObjID?"BOTTOM":"TOP";reset_top_bottom_obj_id(P,e.OldObjID,e.ObjID,e.X,"Y",g)}O+=1}if("SHELF"==s.ObjType||"PALLET"==s.ObjType)reset_top_bottom_objects(e,o,"N",g);return render(g),g_item_edit_flag="",g_item_index="",logDebug("function : recreate_multi_items","E"),h}catch(e){error_handling(e)}}function get_max_merch(e,o,t,_,n,a){logDebug("function : get_max_merch; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+t+"; p_edit_ind : "+_+"; locationX : "+n,"S");try{var i=0,d=0,l=0,r=0,g=g_pog_json[a].ModuleInfo[e].ShelfInfo[o],s=g.ObjType,f=g.Rotation,p=g.Slope;if(-1!==t)var c=wpdSetFixed(g.D-g.ItemInfo[t].RD/g.ItemInfo[t].BaseD);else c=wpdSetFixed(g.D+2);if(0!==f||0!==p)var I=wpdSetFixed(g.X-g.ShelfRotateWidth/2),u=wpdSetFixed(g.X+g.ShelfRotateWidth/2);else I=wpdSetFixed(g.X-g.W/2),u=wpdSetFixed(g.X+g.W/2);0!==g.MaxMerch&&"HANGINGBAR"!==s&&(l=g.MaxMerch);var m=wpdSetFixed(g.Y+g.H/2),h=[];i=0;if("CHEST"!=s&&"BASKET"!=s||(d=g.BsktWallH),-1!==t&&-1!==n)var S=wpdSetFixed(n-g.ItemInfo[t].W/2),O=wpdSetFixed(n+g.ItemInfo[t].W/2);if(g_pog_json[a].ModuleInfo[e].ShelfInfo.length>1){if("PEGBOARD"==s)h.push(g.H+g.LOverhang);else if("HANGINGBAR"==s){m=g.Y;var M=0;for(const t of g_pog_json[a].ModuleInfo[e].ShelfInfo){if(0!==t.Rotation||0!==t.Slope)var x=wpdSetFixed(t.X+t.ShelfRotateWidth/2),v=wpdSetFixed(t.X-t.ShelfRotateWidth/2);else x=wpdSetFixed(t.X+t.W/2),v=wpdSetFixed(t.X-t.W/2);"BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&"TEXTBOX"!==t.ObjType&&((S>=v&&S<x||O<=x&&O>v)&&-1!==n||-1==n)&&o!==M&&t.Y+t.H/2<m&&(x>I&&v<=I||v<u&&v>=I)&&(0!==t.Rotation||0!==t.Slope?h.push(wpdSetFixed(m-(t.Y+t.ShelfRotateHeight))):h.push(wpdSetFixed(m-(t.Y+t.H/2)))),M++}}else{M=0;for(const t of g_pog_json[a].ModuleInfo[e].ShelfInfo){if("BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&"TEXTBOX"!==t.ObjType){if(0!==t.Rotation||0!==t.Slope)x=wpdSetFixed(t.X+t.ShelfRotateWidth/2),v=wpdSetFixed(t.X-t.ShelfRotateWidth/2);else x=wpdSetFixed(t.X+t.W/2),v=wpdSetFixed(t.X-t.W/2);((S>=v&&S<x||O<=x&&O>v)&&-1!==n||-1==n)&&o!==M&&t.Y-t.H/2>=m&&(x>I&&v<=I||v<u&&v>=I)&&t.D>c&&(0!==t.Rotation||0!==t.Slope?h.push(wpdSetFixed(t.Y-t.ShelfRotateHeight/2-m)):h.push(wpdSetFixed(t.Y-t.H/2-m)))}M++}}i=0==h.length?g_pog_json[a].ModuleInfo[e].H+g_pog_json[a].BaseH-m+5:Math.min.apply(Math,h)}else i=g_pog_json[a].ModuleInfo[e].H-m+5;if("CHEST"==s||"BASKET"==s){var D=g_pog_json[a].ModuleInfo[e].ShelfInfo[o].ItemInfo,E=g_pog_json[a].ModuleInfo[e].ShelfInfo[o].Y+g_pog_json[a].ModuleInfo[e].ShelfInfo[o].H/2,C=0,b="N";for(var T of D)"DIVIDER"==T.Item&&(C=T.Y-T.H/2-E,b="Y");r=i<d&&d>0||0==d?i:d,"Y"==b&&C>0&&(r=C)}else r=i<l&&l>0||0==l?i:l;return logDebug("function : get_max_merch; p_module_index","E"),wpdSetFixed(r)}catch(e){error_handling(e)}}function validate_shelf_min_distance(e,o,t,_,n,a,i,d,l,r,g="N"){logDebug("function : validate_shelf_min_distance; curr_module : "+e+"; p_shelf_index : "+o+"; shelf_y : "+t+"; allow_crush : "+n+"; p_module_index : "+a+"; shelf_x : "+i+"; alert_ind : "+d,"S");try{var s=l.ObjType,f=l.Rotation,p=l.Slope,c=l.H,I=l.W,u=l.SObjID;if(0!==f||0!==p){var m=wpdSetFixed(i-l.ShelfRotateWidth/2),h=wpdSetFixed(i+l.ShelfRotateWidth/2),S=wpdSetFixed(t+l.ShelfRotateHeight/2),O=wpdSetFixed(t-l.ShelfRotateHeight/2);I=l.ShelfRotateWidth,c=l.ShelfRotateHeight}else m=wpdSetFixed(i-l.W/2),h=wpdSetFixed(i+l.W/2),S=wpdSetFixed(t+l.H/2),O=wpdSetFixed(t-l.H/2);var M=0,x=0,v="Y",D=[],E=[],C=[],b=[],T=[],P=[],j=[],N="N",F="N",R=0,H=[],[w,y]=getCombinationShelf(r,l.Shelf);-1!==w&&-1!==y&&(H=g_combinedShelfs[w]);var A="N";if("Y"==$v("P25_POGCR_DRAG_SHELF_IN_PEGBOARD")&&"SHELF"==l.ObjType){var L=g_pog_json[r].ModuleInfo[e].ShelfInfo,Y=0,B="Y";for(const e of L){if("PEGBOARD"==e.ObjType&&"SHELF"==s){var W=wpdSetFixed(e.Y+e.H/2),G=wpdSetFixed(e.Y-e.H/2),k=wpdSetFixed(e.X-e.W/2),V=wpdSetFixed(e.X+e.W/2);if(W>=S&&O>=G&&m>=k&&V>=h){if(A="Y","Y"==(B=validate_shelf_inside_pegboard(a,o,r,i,t,e)))break}else v="N"}else if("PEGBOARD"==e.ObjType&&"PEGBOARD"==s){W=wpdSetFixed(e.Y+e.H/2),G=wpdSetFixed(e.Y-e.H/2),k=wpdSetFixed(e.X-e.W/2),V=wpdSetFixed(e.X+e.W/2);if(W>=S&&O>=G&&m>=k&&V>=h){A="Y",v="N",B="N";break}B="Y"}Y++}"Y"==B?v="Y":(v="N",alert(get_message("ITEM_POSITION_OVERLAP",l.Shelf)))}else"Y"==$v("P25_POGCR_DRAG_SHELF_IN_PEGBOARD")&&"PEGBOARD"==l.ObjType?(v="Y",A="Y"):v="N";if("N"==A){for(const _ of g_pog_json[r].ModuleInfo){if("Y"==F)break;if(null==_.ParentModule||"undefined"==_.ParentModule){var U=0;for(const n of _.ShelfInfo){if("Y"==F)break;if(void 0!==n&&"TEXTBOX"!==n.ObjType&&"BASE"!==n.ObjType&&"NOTCH"!==n.ObjType&&"DIVIDER"!==n.ObjType&&u!==n.SObjID&&"CHEST"!==n.ObjType&&(e==a&&U!==o||e!==a)){var X="N";if(H.length>1)for(Y=0;Y<H.length-1;Y++)if(n.Shelf==H[Y].Shelf){X="Y";break}if("N"==X)if("HANGINGBAR"==s&&"HANGINGBAR"==n.ObjType){if(n.ItemInfo.length>0){for(const e of n.ItemInfo){if("Y"==F)break;var z=wpdSetFixed(e.X-e.W/2),K=wpdSetFixed(e.X+e.W/2),J=wpdSetFixed(e.Y+e.H/2),Z=wpdSetFixed(e.Y-e.H/2);for(const e of l.ItemInfo){"BASKET"==l.ObjType&&"BT"==l.BsktSpreadProduct?(te=i-l.W/2+e.W/2,_e=e.Y):"HANGINGBAR"==l.ObjType?(te=i-l.W/2+e.Distance+e.W/2,_e=t-e.H/2):"PEGBOARD"==l.ObjType||"CHEST"==l.ObjType&&"Y"==g_chest_as_pegboard?(te=i-l.W/2+e.PegBoardX+e.W/2,_e=e.Y):(te=i-l.W/2+e.Distance+e.W/2,_e=t+l.H/2+e.H/2);var q=wpdSetFixed(te-e.W/2),Q=wpdSetFixed(te+e.W/2),ee=wpdSetFixed(_e+e.H/2),oe=wpdSetFixed(_e-e.H/2);if((q<K&&q>=z||Q>z&&Q<=K)&&(oe<J&&oe>=Z||ee<=J&&ee>Z)||(z<q&&K>q||z<Q&&K>=Q)&&J<=ee&&Z>=oe||(q<=z&&Q>=K||q>=z&&Q<=K)&&(ee>=J&&Z>=oe||ee>=J&&oe<=Z||ee>J&&oe<=J)||z<q&&K>=Q&&J<=ee&&J>oe&&Z<=oe||z>q&&K<=Q&&J>=ee&&Z<ee&&Z<=oe||z<q&&K>=Q&&J<=ee&&Z>=oe||z<q&&K>=Q&&J<ee&&J>oe||z>=q&&z<Q&&Z>=oe&&Z<ee){F="Y";break}0}0}}}else if(n.ItemInfo.length>0&&"DIVIDER"!==n.ObjType){for(const e of n.ItemInfo){if("Y"==F)break;z=wpdSetFixed(e.X-e.W/2),K=wpdSetFixed(e.X+e.W/2),J=wpdSetFixed(e.Y+e.H/2),Z=wpdSetFixed(e.Y-e.H/2);if(t<e.Y+e.H/2&&t>e.Y-e.H/2&&(m>z&&m<K||h>z&&h<K||z>m&&K<h)){F="Y";break}for(const e of l.ItemInfo){var te,_e;"BASKET"==l.ObjType&&"BT"==l.BsktSpreadProduct?(te=i-l.W/2+e.W/2,_e=e.Y):"HANGINGBAR"==l.ObjType?(te=i-l.W/2+e.Distance+e.W/2,_e=t-e.H/2):"PEGBOARD"==l.ObjType||"CHEST"==l.ObjType&&"Y"==g_chest_as_pegboard?(te=i-l.W/2+e.PegBoardX+e.W/2,_e=e.Y):(te=i-l.W/2+e.Distance+e.W/2,_e=t+l.H/2+e.H/2);q=wpdSetFixed(te-e.W/2),Q=wpdSetFixed(te+e.W/2),ee=wpdSetFixed(_e+e.H/2),oe=wpdSetFixed(_e-e.H/2);if((q<K&&q>=z||Q>z&&Q<=K)&&(oe<J&&oe>=Z||ee<=J&&ee>Z)||(z<q&&K>q||z<Q&&K>=Q)&&J<=ee&&Z>=oe||(q<=z&&Q>=K||q>=z&&Q<=K)&&(ee>=J&&Z>=oe||ee>=J&&oe<=Z||ee>J&&oe<=J)||z<q&&K>=Q&&J<=ee&&J>oe&&Z<=oe||z>q&&K<=Q&&J>=ee&&Z<ee&&Z<=oe||z<q&&K>=Q&&J<=ee&&Z>=oe||z<q&&K>=Q&&J<ee&&J>oe||z>=q&&z<Q&&Z>=oe&&Z<ee){F="Y";break}0}0}}}U++}}R++}if("Y"==F)return"N"!=g||"Y"!=g_overhung_shelf_active||"SHELF"!=s&&"HANGINGBAR"!=s||"Y"===g_overhung_validation?("Y"==d&&alert(get_message("LOST_FROM_SHELF_ERR_VERT",l.Shelf)),v="N"):(l.Overhung="Y",v="Y"),v;Y=0;for(const _ of g_pog_json[r].ModuleInfo[e].ShelfInfo){if("BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType&&"TEXTBOX"!==_.ObjType&&"CHEST"!==_.ObjType&&(e==a&&Y!==o||e!==a)){if(0!==_.Rotation||0!==_.Slope)var ne=wpdSetFixed(_.X+_.ShelfRotateWidth/2),ae=wpdSetFixed(_.X-_.ShelfRotateWidth/2),ie=wpdSetFixed(_.ShelfRotateHeight),de=wpdSetFixed(_.ShelfRotateWidth);else ne=wpdSetFixed(_.X+_.W/2),ae=wpdSetFixed(_.X-_.W/2),ie=wpdSetFixed(_.H),de=wpdSetFixed(_.W);if(("SHELF"==s||"HANGINGBAR"==s)&&l.D==_.D&&isShelfOverlapShelf(i,t,I,c,_.X,_.Y,de,ie))return"Y"==d&&alert(get_message("LOST_FROM_SHELF_ERR_VERT",l.Shelf)),"N";_.Y>=t&&"HANGINGBAR"!==s&&(ne>m&&ae<=m||ae<h&&ae>=m)?(D.push(wpdSetFixed(_.Y-ie/2-(t+c/2))),T.push(Y)):_.Y<=t&&"HANGINGBAR"==s&&(ne>m&&ae<=m||ae<h&&ae>=m)&&(D.push(wpdSetFixed(t-c/2-(_.Y+ie/2))),T.push(Y)),_.Y<=t&&"HANGINGBAR"!==s&&(ne>m&&ae<=m||ae<h&&ae>=m)?(E.push(wpdSetFixed(t-c/2-(_.Y+ie/2))),P.push(Y)):_.Y>=t&&"HANGINGBAR"==s&&(ne>m&&ae<=m||ae<h&&ae>=m)&&(E.push(wpdSetFixed(_.Y-ie/2-(t+c/2))),P.push(Y))}Y++}if(E.length>0&&(x=Math.min.apply(Math,E)),0!==x){var le=E.findIndex((function(e){return e==x}));if("HANGINGBAR"!==s&&"PEGBOARD"!==g_pog_json[r].ModuleInfo[e].ShelfInfo[P[le]].ObjType&&"PEGBOARD"!==s&&"HANGINGBAR"!==g_pog_json[r].ModuleInfo[e].ShelfInfo[P[le]].ObjType&&"ROD"!==g_pog_json[r].ModuleInfo[e].ShelfInfo[P[le]].ObjType&&"CHEST"!==s){ue=g_pog_json[r].ModuleInfo[e].ShelfInfo[P[le]].ItemInfo;Y=0;for(const o of ue){if(0!==g_pog_json[r].ModuleInfo[e].ShelfInfo[P[le]].Rotation||0!==g_pog_json[r].ModuleInfo[e].ShelfInfo[P[le]].Slope)var re=o.ItemRotateWorldX;else re=o.X;var ge=0;if(void 0!==o.TopObjID&&""!==o.TopObjID){J=o.H;$.each(ue,(function(e,t){wpdSetFixed(o.X)==wpdSetFixed(t.X)&&e!==Y&&(J+=t.H)})),ge=J}else ge=o.H;ge>x&&(h>wpdSetFixed(re-o.W/2)&&m<=wpdSetFixed(re-o.W/2)||m<wpdSetFixed(re+o.W/2)&&m>=wpdSetFixed(re-o.W/2))&&(C.push(wpdSetFixed(ge)),b.push(Y),(o.CrushVert>0||o.CHPerc>0)&&(N="Y")),Y++}}else if("HANGINGBAR"==g_pog_json[r].ModuleInfo[e].ShelfInfo[P[le]].ObjType){ue=g_pog_json[r].ModuleInfo[e].ShelfInfo[P[le]].ItemInfo;var se="N";Y=0;for(const e of ue){if(O>wpdSetFixed(e.Y-e.H/2)){q=wpdSetFixed(e.X-e.W/2),Q=wpdSetFixed(e.X+e.W/2),ee=wpdSetFixed(e.Y+e.H/2),oe=wpdSetFixed(e.Y-e.H/2),R=0;for(const e of _){J=wpdSetFixed(e.Y+e.H/2),Z=wpdSetFixed(e.Y-e.H/2),z=wpdSetFixed(e.X-e.W/2),K=wpdSetFixed(e.X+e.W/2);(q>z&&q<K&&Q>K||Q>z&&Q<K&&q<z||q>z&&q<K&&Q>z&&Q<K||q<z&&Q>K)&&oe<J&&(se="Y"),R++}}Y++}le="Y"==se?0:-1}else le=-1}else le=-1;if("HANGINGBAR"!==s&&"PEGBOARD"!==s&&"CHEST"!==s)le=C.findIndex((function(e){return e>x}));if(-1==le)if(C=[],0==D.length)M=wpdSetFixed(g_pog_json[r].ModuleInfo[e].H+g_pog_json[r].BaseH-t+5);else{M=Math.min.apply(Math,D);le=D.findIndex((function(e){return e==M}));if("HANGINGBAR"!==s&&"PEGBOARD"!==g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].ObjType&&"PEGBOARD"!==s&&"CHEST"!==g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].ObjType&&"CHEST"!==s){var fe=wpdSetFixed(g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].X-g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].W/2),pe=wpdSetFixed(g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].X+g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].W/2);Y=0;for(const e of _){if(0!==l.Rotation||0!==l.Slope)re=e.ItemRotateWorldX;else re=e.X;ge=0;if(void 0!==e.TopObjID&&""!==e.TopObjID){J=e.H,R=0;for(const o of _)wpdSetFixed(e.X)==wpdSetFixed(o.X)&&R!==Y&&(J+=o.H),R++;ge=J}else ge=e.H;ge>M&&(pe>re-e.W/2&&fe<=re-e.W/2||fe<re+e.W/2&&fe>=re-e.W/2)&&(C.push(wpdSetFixed(ge)),b.push(Y),(e.CrushVert>0||e.CHPerc>0)&&(N="Y")),Y++}le=C.findIndex((function(e){return e>M}))}else if("HANGINGBAR"!==g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].ObjType&&"PEGBOARD"!==s&&"CHEST"!==s){var ce=wpdSetFixed(l.H/2),Ie=0;Y=0;for(const e of _)wpdSetFixed(e.H-ce)>Ie&&(Ie=wpdSetFixed(e.H-ce)),Y++;M-=Ie;var ue=g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].ItemInfo;fe=wpdSetFixed(l.X-l.W/2),pe=wpdSetFixed(l.X+l.W/2),Y=0;for(const o of ue){if(0!==g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].Rotation||0!==g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].Slope)re=o.ItemRotateWorldX;else re=o.X;ge=0;if(void 0!==o.TopObjID&&""!==o.TopObjID){J=o.H;$.each(ue,(function(e,t){wpdSetFixed(o.X)==wpdSetFixed(t.X)&&e!==Y&&(J+=t.H)})),ge=J}else ge=o.H;ge>M&&(pe>wpdSetFixed(re-o.W/2)&&fe<=wpdSetFixed(re-o.W/2)||fe<wpdSetFixed(re+o.W/2)&&fe>=wpdSetFixed(re-o.W/2))&&(C.push(wpdSetFixed(ge)),b.push(Y),(o.CrushVert>0||o.CHPerc>0)&&(N="Y")),Y++}le=C.findIndex((function(e){return e>M}))}else if("PEGBOARD"!==s&&"CHEST"!==s){ue=g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].ItemInfo,se="N",Y=0;for(const o of _){if(g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].Y-g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].H/2>o.Y-o.H/2){q=wpdSetFixed(o.X-o.W/2),Q=wpdSetFixed(o.X+o.W/2),ee=wpdSetFixed(o.Y+o.H/2),oe=wpdSetFixed(o.Y-o.H/2),R=0;for(const e of ue){J=wpdSetFixed(e.Y+e.H/2),Z=wpdSetFixed(e.Y-e.H/2),z=wpdSetFixed(e.X-e.W/2),K=wpdSetFixed(e.X+e.W/2);(q>z&&q<K&&Q>K||Q>z&&Q<K&&q<z||q>z&&q<K&&Q>z&&Q<K||q<z&&Q>K)&&oe<J&&(se="Y"),R++}}Y++}le="Y"==se?0:-1}else le=-1}if(-1==le&&(D.length>0||E.length>0)){M=0,x=0;var me="N",he=-1;if(D.length>0&&(M=Math.min.apply(Math,D)),E.length>0&&(x=Math.min.apply(Math,E)),D.length>0&&E.length>0){if(x<M){le=E.findIndex((function(e){return e==x}));T=P}else if(M<x)le=D.findIndex((function(e){return e==M}));else if(M==x){me="Y";le=D.findIndex((function(e){return e==M}));he=E.findIndex((function(e){return e==x}))}}else if(D.length>0)le=D.findIndex((function(e){return e==M}));else{le=E.findIndex((function(e){return e==x}));T=P}var Se="N";if("Y"==me){if(0!==g_pog_json[r].ModuleInfo[e].ShelfInfo[P[he]].Rotation||0!==g_pog_json[r].ModuleInfo[e].ShelfInfo[P[he]].Slope)var Oe=wpdSetFixed(g_pog_json[r].ModuleInfo[e].ShelfInfo[P[he]].Y+g_pog_json[r].ModuleInfo[e].ShelfInfo[P[he]].ShelfRotateHeight/2),Me=wpdSetFixed(g_pog_json[r].ModuleInfo[e].ShelfInfo[P[he]].Y-g_pog_json[r].ModuleInfo[e].ShelfInfo[P[he]].ShelfRotateHeight/2);else Oe=wpdSetFixed(g_pog_json[r].ModuleInfo[e].ShelfInfo[P[he]].Y+g_pog_json[r].ModuleInfo[e].ShelfInfo[P[he]].H/2),Me=wpdSetFixed(g_pog_json[r].ModuleInfo[e].ShelfInfo[P[he]].Y-g_pog_json[r].ModuleInfo[e].ShelfInfo[P[he]].H/2);(Oe>=S&&Me<=S||Oe>=O&&Oe<=S)&&(Se="Y")}if("N"==Se){if(0!==g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].Rotation||0!==g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].Slope)Oe=wpdSetFixed(g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].Y+g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].ShelfRotateHeight/2),Me=wpdSetFixed(g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].Y-g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].ShelfRotateHeight/2);else Oe=wpdSetFixed(g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].Y+g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].H/2),Me=wpdSetFixed(g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].Y-g_pog_json[r].ModuleInfo[e].ShelfInfo[T[le]].H/2);Oe>=S&&Me<=S||Oe>=O&&Oe<=S?(le=0,n="N"):le=-1}else le=0,n="N"}if(-1===le||"Y"!=g_overhung_shelf_active||"SHELF"!=s&&"HANGINGBAR"!=s||"Y"===g_overhung_validation||(l.Overhung="Y",v="Y"),"N"==n&&-1!==le||"Y"==n&&-1!==le&&"N"==N)"Y"==d&&(g_validationAlert="Y",alert(get_message("LOST_FROM_SHELF_ERR_VERT",l.Shelf))),v="N";else if("Y"==n&&-1!==le&&"Y"==N){ge=0,Y=0;for(const t of _){var xe=t.CrushVert>0?t.CrushVert:t.CHPerc;if(t.H>M&&xe>0)"Y"==crushItem(r,e,o,Y,"H","Y",-1,-1)&&j.push(Y);Y++}if(C.length>j.length)"Y"==d&&alert(get_message("LOST_FROM_SHELF_ERR_VERT",l.Shelf)),v="N";else{Y=0;for(const t of _){xe=t.CrushVert>0?t.CrushVert:t.CHPerc;if(t.H>M&&xe>0)crushItem(r,e,o,Y,"H","Y",-1,-1);Y++}v="R"}}else v="Y";logDebug("function : validate_shelf_min_distance","E")}return v}catch(e){error_handling(e)}}function item_height_validation(e,o,t,_,n,a,i,d,l,r,g,s,f,p="N",c="N"){logDebug("function : item_height_validation; item_height : "+e+"; p_module_index : "+o+"; p_shelf_index : "+t+"; i_item_index : "+_+"; p_edit_ind : "+n+"; i_final_x : "+a+"; allow_crush : "+i+"; crush_height : "+d+"; item_fixed : "+l+"; alert_ind : "+r+"; item_depth : "+g+"; facing_edit : "+s,"S");try{var I=g_pog_json[f].ModuleInfo[o].ShelfInfo[t],u=I.ItemInfo[_],m=g_pog_json[f].ModuleInfo[o];u.Orientation;0==d&&(d=u.CHPerc),l_max_merch=get_cap_max_merch(o,t,m,I,f,g_dft_max_merch,"N",p,_);get_module_max_merch(o,t,f,p,_);if("Y"!==I.Topmerch){var h=get_cap_max_merch(o,t,m,I,f,g_dft_max_merch,"Y",p,_);l_max_merch=h<l_max_merch?h:l_max_merch}var S=0;u.HChanged="N";var O=u,M=I.MaxMerch,x=I.ItemInfo;if(void 0!==O.TopObjID&&""!==O.TopObjID||void 0!==O.BottomObjID&&""!==O.BottomObjID){var v=e,D=0;for(const e of x)wpdSetFixed(O.X)==wpdSetFixed(e.X)&&D!==_&&(v+=e.H),D++;e=v}if("Y"==g_overhung_shelf_active&&("SHELF"==I.ObjType||"HANGINGBAR"==I.ObjType)&&"Y"!==g_overhung_validation&&!(void 0!==O.TopObjID&&""!=O.TopObjID||void 0!==O.BottomObjID&&""!=O.BottomObjID)){if(e>l_max_merch&&(I.Overhung="Y"),"Y"==i){var E=0;for(var C of I.ItemInfo){crushItem(f,o,t,E,"H","Y",-1,-1);E++}}return"N"}var b=void 0===O.MVertCrushed||"N"==O.MVertCrushed?"N":"Y";if((e>l_max_merch||"Y"==b)&&"Y"==n&&"Y"==i&&d>0&&"N"==l){if("N"==crushItem(f,o,t,_,"H","Y",-1,-1)){if(O.BVert>1&&("N"==s||"Y"==s&&"Y"==c)){var T=0;if(0==(T=Math.floor(100*l_max_merch/(O.RH/O.BVert*100)))&&(T=1),T=(W=nvl(O.MPogVertFacings)>0?O.MPogVertFacings:O.MVertFacings)<T&&W>-1?W:T,(S=O.RH/O.BVert*T)>l_max_merch)return"Y"==r&&alert(get_message("LOST_FROM_SHELF_ERR_VERT",I.Shelf)),g_error_category="H","Y";u.H=S;var P=I,[j,N]=get_item_xy(P,O,O.W,O.H,f);return"BASKET"==I.ObjType&&"DIVIDER"==O.Item?console.log("no validation"):u.Y=N,u.BVert=T,u.HChanged="Y",g_error_category="",logDebug("function : item_height_validation","E"),"N"}return"Y"==r&&alert(get_message("LOST_FROM_SHELF_ERR_VERT",I.Shelf)),g_error_category="H","Y"}return logDebug("function : item_height_validation","E"),"N"}if(wpdSetFixed(e)>l_max_merch&&0==M){var F=I.Y+I.H/2,R=I.ObjType,H=g_pog_json[f].ModuleInfo[o].ShelfInfo,w=[],y=[],A=-1,L=0;for(const e of H)"BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&L!==t&&(e.Y>F&&"HANGINGBAR"!==R&&L!==t?(w.push(e.Y-parseFloat(F)),y.push(L)):e.Y<F&&L!==t&&(w.push(parseFloat(F)-e.Y),y.push(L))),L++;if(w.length>0){var Y=Math.min.apply(Math,w);A=y[w.findIndex((function(e){return e==Y}))]}var B=-1;if(-1!==A){B=wpdSetFixed(I.D-g_pog_json[f].ModuleInfo[o].ShelfInfo[A].D);g=wpdSetFixed(g)}return e>l_max_merch?("Y"==r&&alert(get_message("LOST_FROM_SHELF_ERR_VERT",I.Shelf)),g_error_category="H","Y"):g>B?("Y"==r&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",I.Shelf)),g_error_category="D","Y"):"N"}if(wpdSetFixed(e)>l_max_merch&&M>0){if(O.BVert>1&&("N"==s||"Y"==s&&"Y"==c)){var W;T=0;if(0==(T=Math.floor(100*l_max_merch/(O.RH/O.BVert*100)))&&(T=1),T=(W=nvl(O.MPogVertFacings)>0?O.MPogVertFacings:O.MVertFacings)<T&&W>-1?W:T,(S=O.RH/O.BVert*T)>l_max_merch)return"Y"==r&&alert(get_message("LOST_FROM_SHELF_ERR_VERT",I.Shelf)),g_error_category="H","Y";u.H=S;P=I;var[j,N]=get_item_xy(P,O,O.W,O.H,f);return"BASKET"==I.ObjType&&"DIVIDER"==O.Item?console.log("no validation"):u.Y=N,u.BVert=T,u.HChanged="Y",g_error_category="",logDebug("function : item_height_validation","E"),"N"}return"Y"==r&&alert(get_message("LOST_FROM_SHELF_ERR_VERT",I.Shelf)),g_error_category="H","Y"}if("Y"==n&&"Y"==i&&d>0&&"N"==l&&(void 0===O.TopObjID||""==O.TopObjID)&&(void 0===O.BottomObjID||""==O.BottomObjID))crushItem(f,o,t,_,"H","Y",-1,-1);return g_error_category="",logDebug("function : item_height_validation","E"),"N"}catch(e){error_handling(e)}}function validate_items(e,o,t,_,n,a,i,d,l,r,g,s,f,p,c,I,u,m,h,S,O,M,x,v="N",D="N",E="N"){logDebug("function : validate_items; shelf_obj_type : "+n+"; p_module_index : "+a+"; p_shelf_index : "+i+"; i_item_index : "+d+"; p_edit_ind : "+l+"; crush_width : "+r+"; crush_height : "+g+"; crush_depth : "+s+"; i_final_x : "+f+"; item_fixed : "+p+"; valid_height : "+c+"; alert_ind : "+I+"; valid_bottom : "+u+"; facing_edit : "+m+"; crush_item : "+S+"; valid_width : "+O+"; valid_depth : "+M,"S");try{var C=g_pog_json[x].ModuleInfo[a].ShelfInfo[i];if(C.ItemInfo.length>0){var b=0,T=C.SpreadItem;[currCombinationIndex,currShelfCombIndx]=getCombinationShelf(x,C.Shelf),-1!==currCombinationIndex&&-1!==currShelfCombIndx&&(T=g_combinedShelfs[currCombinationIndex].SpreadItem);var P=C.AllowAutoCrush,j=C.peg_vert_values,N=(C.peg_horiz_values,0),F=0,R=wpdSetFixed(C.X-C.W/2),H=wpdSetFixed(C.X+C.W/2),w=wpdSetFixed(C.Y-C.H/2),y=wpdSetFixed(C.Y+C.H/2);for(Q=0;Q<_.length;Q++)void 0!==C.ItemInfo[_[Q]]&&(C.ItemInfo[_[Q]].WChanged="N",C.ItemInfo[_[Q]].DChanged="N");if(-1!==d&&void 0!==C.ItemInfo[d]&&(C.ItemInfo[d].WChanged="N",C.ItemInfo[d].DChanged="N"),"PEGBOARD"==n)var A=C.VertiSpacing;else A=C.HorizGap;var L=C.DGap;p="N";N=A>0?A:0;valid_values=["SHELF","CHEST","PALLET","HANGINGBAR","PEGBOARD","ROD"];var Y=!1;if(-1!==valid_values.indexOf(n)){if(C.Overhung="N","PEGBOARD"==n||"Y"==g_chest_as_pegboard&&"CHEST"==n&&void 0!==j){if(validate_peg="Y",C.ItemInfo.length>0)for("Y"==g_chest_as_pegboard&&"CHEST"==n||(w=wpdSetFixed(w-C.LoOverHang),y=wpdSetFixed(y+C.UOverHang),R=wpdSetFixed(R-C.LOverhang),H=wpdSetFixed(H+C.ROverhang)),Q=0;Q<_.length;Q++){var B=C.ItemInfo[_[Q]].X,W=wpdSetFixed(C.ItemInfo[_[Q]].X-C.ItemInfo[_[Q]].W/2),G=wpdSetFixed(C.ItemInfo[_[Q]].X+C.ItemInfo[_[Q]].W/2),k=wpdSetFixed(C.ItemInfo[_[Q]].Y+C.ItemInfo[_[Q]].H/2),V=wpdSetFixed(C.ItemInfo[_[Q]].Y-C.ItemInfo[_[Q]].H/2),U=C.ItemInfo[_[Q]].Y;if("Y"!=g_chest_as_pegboard||"CHEST"!=n){if(parseFloat(W)<parseFloat(R)||parseFloat(G)>parseFloat(H)||parseFloat(V)<parseFloat(w)||parseFloat(k)>parseFloat(y)){validate_peg="H";break}}else if("Y"==D&&(parseFloat(W)<parseFloat(R)||parseFloat(G)>parseFloat(H)||parseFloat(V)<parseFloat(w)||parseFloat(k)>parseFloat(y))&&"Y"==C.AutoPlacing){if(C.AutoPlacing="Y","N"==(X=find_pegboard_gap(e[Q],o[Q],B,U,A,a,i,_[Q],_[Q],"Y",x,"Y",g_auto_x_space,g_auto_y_space))){validate_peg="H";break}validate_peg="Y"}else{console.log("validate item start ",_[Q],C.ItemInfo[_[Q]].Item,C.ItemInfo[_[Q]].X,C.ItemInfo[_[Q]].Y);var X=find_pegboard_gap(e[Q],o[Q],B,U,A,a,i,_[Q],_[Q],"Y",x,"Y",g_auto_x_space,g_auto_y_space);if(console.log(" find pegboard return ",X,C.ItemInfo[_[Q]].Item),"N"==X&&"Y"==g_chest_as_pegboard&&"CHEST"==n&&void 0!==j)if(console.log(" valid failure ",X,C.ItemInfo[_[Q]].Item,C.ItemInfo[_[Q]]),"Y"==C.AllowAutoCrush)"Y"==(_e=crushItem(x,a,i,_[Q],"A","Y",t,_))&&(X="Y");if(console.log("validate items after ",X),C.ItemInfo[_[Q]].D>C.BsktWallH&&"CHEST"==n&&"Y"==M){var z=1,K=C.ItemInfo[_[Q]];z=Math.floor(100*C.BsktWallH/(K.RD/K.BaseD*100)),z=0==(z=(ze=nvl(K.MPogDepthFacings)>0?K.MPogDepthFacings:K.MDepthFacings)<z&&ze>-1?ze:z)?1:z;var J=0;if(J=K.RD/K.BaseD*z,C.BsktWallH<J){validate_peg="D";break}C.ItemInfo[_[Q]].D=J,C.ItemInfo[_[Q]].RD=J,C.ItemInfo[_[Q]].BaseD=z,C.ItemInfo[_[Q]].DChanged="Y"}if("N"==X&&("Y"==O||"Y"==c)){validate_peg="N";break}if("D"==X){validate_peg="D";break}}}if("N"==validate_peg)return"Y"==I&&("Y"==g_chest_as_pegboard&&"CHEST"==n?alert(get_message("POGC_CHEST_SPACE_VALID",C.Shelf)):alert(get_message("ITEM_POSITION_OVERLAP",C.Shelf))),g_error_category="D",!1;if("H"==validate_peg)return"Y"==I&&alert(get_message("ITEM_OUTSIDE_PEGBOARD",C.Shelf)),g_error_category="D",!1;if("D"==validate_peg)return"Y"==I&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",C.Shelf)),g_error_category="D",!1;if("W"==validate_peg)"Y"==I&&confirm(get_message("POGCR_REDUCE_DEPTH_TO_ONE"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){return g_error_category="",!0}),(function(){return g_error_category="D",!1}));else if("Y"==validate_peg){for(Q=0;Q<_.length;Q++)console.log(" valid success ",C.ItemInfo[_[Q]].Item,C.ItemInfo[_[Q]]);return g_error_category="",!0}if(void 0!==C.AutoFillPeg&&"Y"==C.AutoFillPeg&&-1!==f)if(-1!==d){if(C.MaxMerch<C.ItemInfo[d].D&&C.MaxMerch>0||C.ItemInfo[d].D>g_pegboard_dft_item_depth&&0==C.MaxMerch&&g_pegboard_dft_item_depth>0)return"Y"==I&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",C.Shelf)),g_error_category="D",!1}else{var Z=C.ItemInfo,q="N",Q=0;for(const e of Z)-1!==_.indexOf(Q)&&(C.MaxMerch>0&&e.D>C.MaxMerch||e.D>g_pegboard_dft_item_depth&&0==C.MaxMerch&&g_pegboard_dft_item_depth>0)&&(q="Y"),Q++;if("Y"==q)return"Y"==I&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",C.Shelf)),g_error_category="D",!1}}else if("PALLET"==n&&"Y"==v){var ee=0,oe=0;Z=C.ItemInfo;ee=e.reduce(((e,o)=>e+o),0),ee+=N*(parseFloat(e.length)-1);Q=0;for(const e of Z)-1==_.indexOf(Q)&&(A>0?oe+=e.W+A:oe=wpdSetFixed(oe+e.W)),Q++;if((F=(100*C.W+100*C.LOverhang+100*C.ROverhang-100*oe)/100)<ee)return"Y"==I&&(g_validationFlag="N",alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",C.Shelf))),g_error_category="W",!1}else if("ROD"!==n){if("Y"==c){if(b=get_max_merch(a,i,d,l,f,x),-1!==(ke=o.findIndex((function(e){return e>b})))&&"Y"==g_overhung_shelf_active&&("SHELF"==n||"HANGINGBAR"==n)&&"Y"!==g_overhung_validation)if(-1==d){var te=!1;for(Q=0;Q<_.length;Q++){"N"==(_e=crushItem(x,a,i,_[Q],"H","Y",-1,-1))&&(C.Overhung="Y",te=!0)}te&&(g_error_category="H",Y=!0)}else{"N"==(_e=crushItem(x,a,i,d,"H","Y",-1,-1))&&(C.Overhung="Y",g_error_category="H",Y=!0)}if(!Y)if(-1!==ke&&"Y"==l&&"Y"==P&&g>0&&"N"==p&&"Y"==S){if(o[ke]=o[ke]-o[ke]*(g/100),-1!==o.findIndex((function(e){return e>b})))return"Y"==I&&alert(get_message("LOST_FROM_SHELF_ERR_VERT",C.Shelf)),g_error_category="H",!1;C.ItemInfo[_[ke]].H=o[ke]}else if(-1!==ke){var _e="Y";for(Q=0;Q<_.length;Q++){if("N"==(_e=crushItem(x,a,i,_[Q],"H","Y",-1,-1))){"Y"==I&&alert(get_message("LOST_FROM_SHELF_ERR_VERT",C.Shelf));break}}if("N"==_e)return g_error_category="H",!1}}if("Y"==O&&"PALLET"!==n){ee=0,oe=0,Z=C.ItemInfo;var ne="N",ae=-1;ee=e.reduce(((e,o)=>e+o),0),ee+=N*(parseFloat(e.length)-1);var ie=Z.some((e=>"Y"===e.Fixed)),de=!1;if(C.ItemInfo.length>0){if("M"==T&&-1!=d){var le=C.ItemInfo[d],re=wpdSetFixed(le.X-le.W/2),ge=wpdSetFixed(le.X+le.W/2),se=wpdSetFixed(le.Y+le.H/2),fe=wpdSetFixed(le.Y-le.H/2),pe="Y";if(re<R&&ge>H&&"N"==g_overhung_shelf_active)return alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",C.Shelf)),g_error_category="W",!1;if(Z.length>0){var ce=0;for(const e of Z){if(ce!==d&&(div_start=wpdSetFixed(e.X-e.W/2),div_end=wpdSetFixed(e.X+e.W/2),div_top=wpdSetFixed(e.Y+e.H/2),div_bottom=wpdSetFixed(e.Y-e.H/2),(div_start<ge&&div_start>=re||div_end>re&&div_end<=ge)&&(div_bottom<se&&div_bottom>=fe||div_top<=se&&div_top>fe)||(re<div_start&&ge>div_start||re<div_end&&ge>=div_end)&&se<=div_top&&fe>=div_bottom||(div_start<=re&&div_end>=ge||div_start>=re&&div_end<=ge)&&(div_top>=se&&fe>=div_bottom||div_top>=se&&div_bottom<=fe||div_top>se&&div_bottom<=se)||re<div_start&&ge>=div_end&&se<=div_top&&se>div_bottom&&fe<=div_bottom||re>div_start&&ge<=div_end&&se>=div_top&&fe<div_top&&fe<=div_bottom||re<div_start&&ge>=div_end&&se<=div_top&&fe>=div_bottom||re<div_start&&ge>=div_end&&se<div_top&&se>div_bottom||re>=div_start&&re<div_end&&fe>=div_bottom&&fe<div_top)){pe="N";break}ce++}}if("N"==pe){if(!(d>-1&&"Y"==P))return alert(get_message("ITEM_POSITION_OVERLAP_SHELF_HANG",C.Shelf)),g_error_category="W",!1;if("N"==(_e=crushItem(x,a,i,d,"W","Y",-1,-1)))return alert(get_message("ITEM_POSITION_OVERLAP_SHELF_HANG",C.Shelf)),g_error_category="W",!1;Y=!0}}if(Y||"M"===T||!ie||"HANGINGBAR"!=n&&"SHELF"!=n||(de=validateShelfWithFixedItem(C,T,A,Z)),!Y){if("Y"==l){bookend_array=[];Q=0;for(const e of Z)(!ie&&Q<d&&"B"==e.Fixed&&"R"!==T&&(h.length>0&&-1==h.indexOf(e.ObjID)||0==h.length)||!ie&&Q>d&&"B"==e.Fixed&&"R"==T&&(h.length>0&&-1==h.indexOf(e.ObjID)||0==h.length))&&(ne="Y",bookend_array.push(Q)),Q++;if("R"!==T)ae=Math.max.apply(Math,bookend_array);else ae=Math.min.apply(Math,bookend_array);if("N"==ne){Q=0;for(const e of Z)"SHELF"==n?Q===d||void 0!==e.BottomObjID&&""!=e.BottomObjID||(A>0?oe+=wpdSetFixed(e.W+A):oe=wpdSetFixed(oe+e.W)):Q!==d&&(A>0?oe+=wpdSetFixed(e.W+A):oe=wpdSetFixed(oe+e.W)),Q++}else{Q=0;for(const e of Z)(Q>ae&&Q<d&&"R"!==T&&Q!==_[0]||Q<ae&&Q>d&&"R"==T&&Q!==_[0])&&(A>0?oe+=wpdSetFixed(e.W+A):oe=wpdSetFixed(oe+e.W)),Q++}}else{var Ie=Math.min.apply(Math,_),ue=Math.max.apply(Math,_);bookend_array=[];Q=0;for(const e of Z)"R"!==T?Q<Ie&&"B"==e.Fixed&&(ne="Y",bookend_array.push(Q)):"R"==T&&Q>ue&&"B"==e.Fixed&&(ne="Y",bookend_array.push(Q)),Q++;if("R"!==T)ae=Math.max.apply(Math,bookend_array);else ae=Math.min.apply(Math,bookend_array);if("N"==ne){Q=0;for(const e of Z)"SHELF"==n?-1!=_.indexOf(Q)||void 0!==e.BottomObjID&&""!=e.BottomObjID||(A>0?oe+=wpdSetFixed(e.W+A):oe=wpdSetFixed(oe+e.W)):-1==_.indexOf(Q)&&(A>0?oe+=wpdSetFixed(e.W+A):oe=wpdSetFixed(oe+e.W)),Q++}else{Q=0;for(const e of Z)(Q>ae&&"R"!==T&&Q!==_[0]||Q<ae&&"R"==T&&Q!==_[0])&&(A>0?oe+=wpdSetFixed(e.W+A):oe=wpdSetFixed(oe+e.W)),Q++}}F="N"==ne?wpdSetFixed((100*C.W+100*C.LOverhang+100*C.ROverhang-100*oe)/100):"R"!==T?wpdSetFixed(H-(C.ItemInfo[ae].X+C.ItemInfo[ae].W/2)-oe):wpdSetFixed(C.ItemInfo[ae].X-C.ItemInfo[ae].W/2-R-oe)}}else F=wpdSetFixed((100*C.W+100*C.LOverhang+100*C.ROverhang)/100);if(!Y&&!ie&&g_combinedShelfs.length>0){var[me,he]=getCombinationShelf(x,C.Shelf);if(-1!==currShelfCombIndx&&void 0!==g_pog_json[x].ModuleInfo[g_combinedShelfs[me][g_combinedShelfs[me].length-1].MIndex]){var Se=g_combinedShelfs[me].ItemInfo;P=g_combinedShelfs[me].AllowAutoCrush;var Oe=0,Me=0;Q=0;for(var xe of g_combinedShelfs[me])Oe+=xe.W,Q++;var ve=0;for(var De of Se)Me+=De.RW,ve++;Me-=ee,F=(100*Oe+100*g_pog_json[x].ModuleInfo[g_combinedShelfs[me][0].MIndex].ShelfInfo[g_combinedShelfs[me][0].SIndex].LOverhang+100*g_pog_json[x].ModuleInfo[g_combinedShelfs[me][g_combinedShelfs[me].length-1].MIndex].ShelfInfo[g_combinedShelfs[me][g_combinedShelfs[me].length-1].SIndex].ROverhang-100*Me)/100}}if("Y"==g_overhung_shelf_active&&("SHELF"==n||"HANGINGBAR"==n)&&-1!==d)if(F<ee){_e="N";"Y"==P&&(_e=crushItem(x,a,i,d,"W","Y",-1,-1)),Ee=void 0===C.ItemInfo[d].MHorizCrushed||"N"==C.ItemInfo[d].MHorizCrushed?"N":"Y",C.Overhung="Y",g_error_category="W",Y=!0}else-1!==currShelfCombIndx&&F>=ee&&"Y"==P&&("N"==(_e=crushItem(x,a,i,d,"W","Y",-1,-1))&&(C.Overhung="Y",g_error_category="W"),Y=!0);if(!Y){var Ee="N";if(-1!==d&&void 0!==C.ItemInfo[d].Orientation){var Ce=C.ItemInfo[d].Orientation,[be,Te,Pe,je,Ne,Fe]=get_new_orientation_dim(Ce,0,0,0);"H"==Ne?Ee=void 0===C.ItemInfo[d].MVertCrushed||"N"==C.ItemInfo[d].MVertCrushed?"N":"Y":"W"==Ne?Ee=void 0===C.ItemInfo[d].MHorizCrushed||"N"==C.ItemInfo[d].MHorizCrushed?"N":"Y":"D"==Ne&&(Ee=void 0===C.ItemInfo[d].MDepthCrushed||"N"==C.ItemInfo[d].MDepthCrushed?"N":"Y")}if((F<ee||de||"Y"==Ee)&&"Y"==P&&"N"==u&&"Y"==S){if(-1!==d&&(C.ItemInfo[d].AvlSpace=F),"N"==(_e=crushItem(x,a,i,d,"W","Y",-1,-1))&&(F<ee||de))return"Y"!=g_overhung_shelf_active||"SHELF"!=n&&"HANGINGBAR"!=n?("Y"==I&&(g_validationFlag="N",alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",C.Shelf))),"Y"==E?(g_error_category="",!0):(g_error_category="W",!1)):(C.Overhung="Y",g_error_category="",!0);if("F"==_e){if(-1===d||"N"!=m&&("Y"!=m||"Y"!=E))return"Y"==I&&(g_validationFlag="N",alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",C.Shelf))),g_error_category="W",!1;if(!((Le=C.ItemInfo[d]).BHoriz>1))return"Y"==E?(g_error_category="",!0):("Y"==I&&(g_validationFlag="N",alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",C.Shelf))),g_error_category="W",!1);var Re=1;Re=0==(Re=Math.floor(100*F/(Le.RW/Le.BHoriz*100)))||Re<0?1:Re;var He=0;if(F<(He=wpdSetFixed(Le.RW/Le.BHoriz*Re+N*(e.length-1))))return"Y"==I&&(g_validationFlag="N",alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",C.Shelf))),g_error_category="W",!1;var we="N";wpdSetFixed(Le.X+Le.W/2)>wpdSetFixed(C.X+C.W/2)&&"N"==g_overhung_shelf_active&&("SHELF"==C.ObjType||"HANGINGBAR"==C.ObjType)&&(we="Y"),"N"==we?(Le.W=He,Le.BHoriz=Re,Le.WChanged="Y"):"Y"==I&&(g_validationFlag="N",alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",C.Shelf)))}else g_error_category="",Y=!0}else if((F<ee||de)&&"N"==u&&("N"==g_overhung_shelf_active&&("SHELF"==n||"HANGINGBAR"==n)||"SHELF"!==n&&"HANGINGBAR"!==n)){if(-1!==d&&(C.ItemInfo[d].AvlSpace=F),-1===d||"N"!=m&&("Y"!=m||"Y"!=E))return"Y"==I&&(g_validationFlag="N",alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",C.Shelf))),g_error_category="W",!1;if(!((Le=C.ItemInfo[d]).BHoriz>1))return"Y"==E?(g_error_category="",!0):("Y"==I&&(g_validationFlag="N",alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",C.Shelf))),g_error_category="W",!1);Re=1;Re=0==(Re=Math.floor(100*F/(Le.RW/Le.BHoriz*100)))?1:Re;He=0;if(F<(He=Le.RW/Le.BHoriz*Re+N*(parseFloat(e.length)-1))||de)return"Y"==I&&(g_validationFlag="N",alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",C.Shelf))),g_error_category="W",!1;we="N";Le.X+Le.W/2>C.X+C.W/2&&"N"==g_overhung_shelf_active&&("SHELF"==C.ObjType||"HANGINGBAR"==C.ObjType)&&(we="Y"),"N"==we?(Le.W=He,Le.BHoriz=Re,Le.WChanged="Y"):"Y"==I&&(g_validationFlag="N",alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",C.Shelf)))}else if("Y"==P&&"N"==u&&"Y"==S)_e=crushItem(x,a,i,d,"W","Y",-1,-1)}}}if("PEGBOARD"!==n&&"HANGINGBAR"!==n&&"Y"==M&&("CHEST"!=n||"Y"!=g_chest_as_pegboard)){min_distance_arr=[],min_index_arr=[];var ye,Ae=0;for(itemindex of _){var Le=C.ItemInfo[itemindex],Ye=(re=wpdSetFixed(Le.X-Le.W/2),ge=wpdSetFixed(Le.X+Le.W/2),0),Be=null;for(shelfs of g_pog_json[x].ModuleInfo[a].ShelfInfo){var We=shelfs.D;if("TEXTBOX"!==shelfs.ObjType&&"DIVIDER"!==shelfs.ObjType&&"NOTCH"!==shelfs.ObjType&&"BASE"!==shelfs.ObjType&&Be!==We&&"CHEST"!==shelfs.ObjType){var Ge=wpdSetFixed(shelfs.X+shelfs.W/2),$e=wpdSetFixed(shelfs.X-shelfs.W/2);wpdSetFixed(shelfs.Y)<wpdSetFixed(Le.Y+Le.H/2)&&Ye>i&&(re>=$e&&re<Ge||ge<=Ge&&ge>$e)&&"DIVIDER"!==shelfs.ObjType&&"NOTCH"!==shelfs.ObjType&&(min_distance_arr.push(Math.abs(Le.Y-Le.H/2-shelfs.Y)),min_index_arr.push(Ye))}Be=We,Ye++}}min_distance=Math.min.apply(Math,min_distance_arr);var ke=min_distance_arr.findIndex((function(e){return e==min_distance}));if(-1!==(ye=min_index_arr[ke])&&void 0!==ye&&(Ae=g_pog_json[x].ModuleInfo[a].ShelfInfo[ye].D),-1!==(ke=t.findIndex((function(e){return e>wpdSetFixed(C.D-Ae)})))&&"Y"==g_overhung_shelf_active&&("SHELF"==n||"HANGINGBAR"==n)&&"Y"!==g_overhung_validation){if(-1==d){for(te=!1,Q=0;Q<_.length;Q++){"N"==(_e=crushItem(x,a,i,_[Q],"D","Y",t,_))&&(C.Overhung="Y",te=!0)}te&&(g_error_category="D")}else{"N"==(_e=crushItem(x,a,i,d,"D","Y",t,_))&&(C.Overhung="Y",g_error_category="D")}Y=!0}if(!Y){var Ve="N";if(-1!==d&&void 0!==C.ItemInfo[d].Orientation&&(Ve=C.ItemInfo[d].MDepthCrushed),-1===ke&&"Y"!=Ve||"Y"!=P||"N"!=p||"Y"!=S||-1===d)if(-1!==ke)if(-1!==d&&("N"==m||"Y"==m&&"Y"==E)){if(!((Le=C.ItemInfo[d]).BaseD>1))return"Y"==E?(g_error_category="",!0):("Y"==I&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",C.Shelf)),g_error_category="D",!1);z=1;z=Math.floor(100*C.D/(Le.RD/Le.BaseD*100)),z=0==(z=(ze=nvl(Le.MPogDepthFacings)>0?Le.MPogDepthFacings:Le.MDepthFacings)<z&&ze>-1?ze:z)?1:z;J=0;if(J=Le.RD/Le.BaseD*z,C.D<J)return"Y"==I&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",C.Shelf)),g_error_category="D",!1;C.ItemInfo[d].D=J,C.ItemInfo[d].BaseD=z,C.ItemInfo[d].DChanged="Y"}else{for(Q=0;Q<_.length;Q++){if("N"==(_e=crushItem(x,a,i,_[Q],"D","Y",t,_))){"Y"==I&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",C.Shelf));break}}if("Y"==E)return g_error_category="",!0;if("N"==_e)return g_error_category="D",!1}else{if(-1!==d)_e=crushItem(x,a,i,d,"D","Y",t,_);if("SHELF"==n&&"Y"==u)for(ve=0;ve<_.length;ve++){if(void 0!==(Le=C.ItemInfo[_[ve]]).BottomObjID&&""!==Le.BottomObjID){var Ue=get_shelf_item_ind(a,i,Le.BottomObjID,x);if(t[ve]>C.ItemInfo[Ue].D)return"Y"==I&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",C.Shelf)),g_error_category="D",!1}else if(void 0!==Le.TopObjID&&""!==Le.TopObjID){var Xe=get_shelf_item_ind(a,i,Le.TopObjID,x);if(t[ve]<C.ItemInfo[Xe].D)return"Y"==I&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",C.Shelf)),g_error_category="D",!1}}}else{if("N"==(_e=crushItem(x,a,i,d,"D","Y",t,_)))return"Y"==I&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",C.Shelf)),"Y"==E?(g_error_category="",!0):(g_error_category="D",!1);if("F"==_e){if(-1===d||"N"!=m&&("Y"!=m||"Y"!=E))return"Y"==I&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",C.Shelf)),g_error_category="D",!1;if(!((Le=C.ItemInfo[d]).BaseD>1))return"Y"==E?(g_error_category="",!0):("Y"==I&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",C.Shelf)),g_error_category="D",!1);var ze,z=1;z=Math.floor(100*C.D/(Le.RD/Le.BaseD*100)),z=0==(z=(ze=nvl(Le.MPogDepthFacings)>0?Le.MPogDepthFacings:Le.MDepthFacings)<z&&ze>-1?ze:z)?1:z;var J=0;if(J=Le.RD/Le.BaseD*z,C.D<J)return"Y"==I&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",C.Shelf)),g_error_category="D",!1;C.ItemInfo[d].D=J,C.ItemInfo[d].BaseD=z,C.ItemInfo[d].DChanged="Y"}}}}}}if("CHEST"!=n&&"PALLET"!=n||-1===f){if("HANGINGBAR"==n&&-1!==f){if(-1!==d)return!(C.ItemInfo[d].D>C.MaxMerch&&C.MaxMerch>0||C.ItemInfo[d].D>g_hangbar_dft_maxmerch&&0==C.MaxMerch&&g_hangbar_dft_maxmerch>0)||("Y"!==g_overhung_validation?("Y"==g_overhung_shelf_active&&(C.Overhung="Y"),!0):("Y"==I&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",C.Shelf)),g_error_category="D",!1));Z=C.ItemInfo,q="N",Q=0;for(const e of Z)-1!==_.indexOf(Q)&&(C.MaxMerch>0&&e.D>C.MaxMerch||e.D>g_hangbar_dft_maxmerch&&0==C.MaxMerch&&g_hangbar_dft_maxmerch>0)&&(q="Y"),Q++;return"Y"==q?("Y"==I&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",C.Shelf)),g_error_category="D",!1):("Y"!==g_overhung_validation&&"Y"==g_overhung_shelf_active&&(C.Overhung="Y"),!0)}if("ROD"==n){var Ke=0;return C.ItemInfo.length>0&&$.each(C.ItemInfo,(function(e,o){Ke+=o.D+L})),Ke>C.D?("Y"==I&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",C.Shelf)),g_error_category="D",!1):(g_error_category="",logDebug("function : validate_items","E"),!0)}return g_error_category="",logDebug("function : validate_items","E"),!0}if("PALLET"!=n||"Y"!=u){var Z=C.ItemInfo,q="N",Q=0;for(const e of Z){if(-1!==_.indexOf(Q)){re=wpdSetFixed(f-C.ItemInfo[Q].W/2),ge=wpdSetFixed(f+C.ItemInfo[Q].W/2);re<wpdSetFixed(C.X-C.W/2-C.LOverhang)||wpdSetFixed(C.X+C.W/2+C.ROverhang)}Q++}return"Y"!=q||("Y"==I&&alert(get_message("LOST_FROM_FIXTURE_AREA",C.Shelf)),g_error_category="W",!1)}for(ve=0;ve<_.length;ve++){if(void 0!==(Le=C.ItemInfo[_[ve]]).BottomObjID&&""!==Le.BottomObjID){Ue=get_shelf_item_ind(a,i,Le.BottomObjID,x);if(t[ve]>C.ItemInfo[Ue].D)return"Y"==I&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",C.Shelf)),g_error_category="D",!1}else if(void 0!==Le.TopObjID&&""!==Le.TopObjID){Xe=get_shelf_item_ind(a,i,Le.TopObjID,x);if(t[ve]<C.ItemInfo[Xe].D)return"Y"==I&&alert(get_message("LOST_FROM_SHELF_ERR_DEPTH",C.Shelf)),g_error_category="D",!1}}}catch(e){error_handling(e)}}function find_prev_ind(e,o,t,_){logDebug("function : find_prev_ind; i_item_index : "+o+"; item_bottom : "+t+"; spread_product : "+_,"S");var n=-1;return o>0&&("R"!==_?$.each(e,(function(e,_){e<o&&t==wpdSetFixed(_.Y+_.H/2)&&(n=Math.max(n,e))})):$.each(e,(function(e,_){e>o&&t==wpdSetFixed(_.Y+_.H/2)&&(n=-1!==n?Math.min(n,e):e)}))),-1==n&&("R"!==_?$.each(e,(function(e,_){e>o&&t==wpdSetFixed(_.Y+_.H/2)&&(n=-1!==n?Math.min(n,e):e)})):$.each(e,(function(e,_){e<o&&t==wpdSetFixed(_.Y+_.H/2)&&(n=Math.max(n,e))}))),logDebug("function : find_prev_ind","E"),n}function get_item_index(e,o,t){logDebug("function : get_item_index; obj_id : "+e+"; check_type : "+o,"S");var _=g_shelf_index=l_item_index=-1,n=g_pog_json[t].ModuleInfo,a=0;for(const t of n){if(l_item_index>-1)break;if(null==t.ParentModule||"undefined"==t.ParentModule){var i=0;for(const n of t.ShelfInfo){if(l_item_index>-1)break;if(void 0!==n&&"BASE"!==n.ObjType&&"NOTCH"!==n.ObjType&&"DIVIDER"!==n.ObjType&&"TEXTBOX"!==n.ObjType&&n.ItemInfo.length>0){var d=0;for(const t of n.ItemInfo){if(("C"==o?t.CompItemObjID:t.ObjID)==e){_=a,g_shelf_index=i,l_item_index=d;break}d++}}i++}}a++}return logDebug("function : get_item_index","E"),[_,g_shelf_index,l_item_index]}function get_shelf_item_ind(e,o,t,_){logDebug("function : get_shelf_item_ind; p_module_index : "+e+"; p_shelf_index : "+o+"; obj_id : "+t,"S");var n=g_pog_json[_].ModuleInfo[e].ShelfInfo[o].ItemInfo,a=-1,i=0;for(const e of n){if(e.ObjID==t){a=i;break}i++}return logDebug("function : get_shelf_item_ind","E"),a}function get_basket_fill_count(e,o,t,_,n,a,d,l){logDebug("function : get_basket_fill_count; p_module_index : "+e+"; p_shelf_index : "+o+"; basket_spread : "+t+"; basket_fill : "+_+"; shelf_width : "+n+"; max_merch : "+a+"; shelf_depth : "+d,"S");var r=g_pog_json[l].ModuleInfo[e].ShelfInfo[o].ItemInfo,g=2*g_pog_json[l].ModuleInfo[e].ShelfInfo[o].BsktWallThickness,s=wpdSetFixed(d-g),f=0,p=0;for(const e of r)"DIVIDER"!==e.Item&&(f+=e.D,console.log("items.D",e,e.D,f));if("F"==_)if("LR"==t){for(i=1;i<1e3;i++)if(f*i>n){p=i-1;break}}else if("BT"==t){for(i=1;i<1e3;i++)if(f*i>a){p=i-1;break}}else if("FB"==t)for(i=1;i<1e3;i++)if(f*i>s){p=i-1;break}return 0==p&&(p=1),logDebug("function : get_basket_fill_count","E"),p}function get_min_shelf(e,o,t){logDebug("function : get_min_shelf; p_module_index : "+e+"; p_final_y : "+o,"S");var _=g_pog_json[t].ModuleInfo[e].ShelfInfo,n=[],a=[],i=0;for(const e of _)"BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.Y<o&&(n.push(parseFloat(o)-e.Y),a.push(i)),i++;if(n.length>0){var d=Math.min.apply(Math,n),l=n.findIndex((function(e){return e==d}));div_shelf_index=a[l],shelf_found="Y"}else div_shelf_index=0,shelf_found="N";return logDebug("function : get_min_shelf","E"),div_shelf_index+","+shelf_found}async function reset_auto_crush(e,o,t,_,n,a,i){logDebug("function : reset_auto_crush; p_module_index : "+e+"; p_shelf_index : "+o+"; edit_item_index : "+t,"S");var d=g_pog_json[_].ModuleInfo[e].ShelfInfo[o],l=g_pog_json[i].ModuleInfo[n].ShelfInfo[a],r=d.ItemInfo,g=[],s="N",f=0,p=0,c=0,I=d.HorizGap,[u,m]=getCombinationShelf(_,d.Shelf);if(-1==u&&-1==m)if("PEGBOARD"===d.ObjType||"Y"==g_chest_as_pegboard&&"CHEST"==d.ObjType&&void 0!==d.peg_vert_values){if("Y"==g_chest_as_pegboard&&("CHEST"==d.ObjType||"CHEST"==l.ObjType)){if(void 0!==l.ItemInfo[t])var h=l.ItemInfo[t];else h=d.ItemInfo[t];if(-1!==t&&void 0!==h){E=void 0===h?-1:h.Orientation;var[S,O,M,x,v,D]=get_new_orientation_dim(E,0,0,0);"N"==h.MHorizCrushed&&(h.W=h.RW,"W"==v?h.CrushHoriz=0:"H"==v?h.CrushVert=0:"D"==v&&(h.CrushD=0)),"N"==h.MVertCrushed&&(h.H=h.RH,"H"==x?h.CrushVert=0:"W"==x?h.CrushHoriz=0:"D"==x&&(h.CrushD=0)),"N"==h.MDepthCrushed&&(h.D=h.RD,"W"==D?h.CrushHoriz=0:"H"==D?h.CrushVert=0:"D"==D&&(h.CrushD=0))}}}else{if("Y"==g_overhung_shelf_active&&"N"==d.AllowAutoCrush){c=0;for(const e of r)"0"!=d.ItemInfo[c].CapFacing&&""!=d.ItemInfo[c].CapFacing||0!=d.ItemInfo[c].NVal||(d.ItemInfo[c].W=e.RW,d.ItemInfo[c].H=e.RH,d.ItemInfo[c].D=e.RD),d.ItemInfo[c].CrushHoriz=0,d.ItemInfo[c].CrushVert=0,d.ItemInfo[c].CrushD=0,d.ItemInfo[c].MHorizCrushed="N",d.ItemInfo[c].MVertCrushed="N",d.ItemInfo[c].MDepthCrushed="N",c++}else{p=0;for(const e of r)"N"==e.Fixed&&e.CWPerc>0&&("Y"==d.AllowAutoCrush&&"N"==e.MHorizCrushed||"N"==d.AllowAutoCrush)&&(s="Y",g.push(p)),p++;if("Y"==s){s="N";c=0;for(const e of r)t!==c&&("Y"==d.AllowAutoCrush&&"Y"==e.MHorizCrushed?f+=e.W:f+=e.RW,I>0&&(f+=e.SpreadItem)),c++;if(f<=d.W){c=0;for(const e of r){if(-1!==g.indexOf(c)&&c!==t&&("Y"==d.AllowAutoCrush&&"N"==e.MHorizCrushed||"N"==d.AllowAutoCrush)){var E=void 0===e?-1:e.Orientation,[S,O,M,x,v,D]=get_new_orientation_dim(E,0,0,0);d.ItemInfo[c].W=e.RW,"W"==v?d.ItemInfo[c].CrushHoriz=0:"H"==v?d.ItemInfo[c].CrushVert=0:"D"==v&&(d.ItemInfo[c].CrushD=0),"N"==d.AllowAutoCrush&&(d.ItemInfo[c].MHorizCrushed="N")}c++}}else if("Y"==d.AllowAutoCrush){c=0;for(const n of r)t!==c&&await crushItem(_,e,o,c,"W","Y",-1,-1),c++}reorder_items(e,o,_)&&console.log("reorderedin crush")}}if("SHELF"==d.ObjType){var C=0;for(const e of r){if(C==t&&"N"==e.MVertCrushed){var E=void 0===e?-1:e.Orientation,[S,O,M,x,v,D]=get_new_orientation_dim(E,0,0,0);if(e.CrushVert>0&&("0"==e.CapFacing||""==e.CapFacing)&&0==e.NVal){e.H=e.RH,d.ItemInfo[C].H=e.RH;var[b,T]=get_item_xy(d,e,e.W,e.H,_);d.ItemInfo[C].Y=T,"N"==e.MVertCrushed&&("H"==x?d.ItemInfo[C].CrushVert=0:"W"==x?d.ItemInfo[C].CrushHoriz=0:"D"==x&&(d.ItemInfo[C].CrushD=0))}e.CrushD>0&&(e.D=e.RD,d.ItemInfo[C].D=e.RD,"N"==e.MDepthCrushed&&("H"==D?d.ItemInfo[C].CrushVert=0:"W"==D?d.ItemInfo[C].CrushHoriz=0:"D"==D&&(d.ItemInfo[C].CrushD=0)))}C++}}}else{l_allow_comb_crush=g_combinedShelfs[u][0].AllowAutoCrush;r=g_combinedShelfs[u].ItemInfo;if("N"==l_allow_comb_crush)for(const e of r)g_pog_json[_].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].W=g_pog_json[_].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].RW,g_pog_json[_].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].H=g_pog_json[_].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].RH,g_pog_json[_].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].D=g_pog_json[_].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].RD,g_pog_json[_].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].CrushHoriz=0,g_pog_json[_].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].CrushVert=0,g_pog_json[_].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].CrushD=0,g_pog_json[_].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].MHorizCrushed="N",g_pog_json[_].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].MVertCrushed="N",g_pog_json[_].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].MDepthCrushed="N";else"Y"==l_allow_comb_crush&&await crushItem(_,g_combinedShelfs[u][0].MIndex,g_combinedShelfs[u][0].SIndex,-1,"W","Y",-1,-1)}return logDebug("function : reset_auto_crush","E"),"SUCCESS"}async function find_select_module(e){logDebug("function : get_multiselect_obj","S");try{for(const e of g_pog_json[0].ModuleInfo)void 0!==e.ParentModule&&null!=e.ParentModule||0;var o=[];if("undefined"!=typeof g_pog_json&&g_pog_json.length>0){var t=g_pog_json[e].ModuleInfo,_=0;for(const e of t){if(null==e.ParentModule||"undefined"==e.ParentModule){var n=get_actual_mod_xy(e,e.W,e.H,e.X-e.W/2);detail_arr=n.split("###");var a=detail_arr[4],i=detail_arr[6],d=detail_arr[5],l=detail_arr[7];g_DragMouseStart.x<=g_DragMouseEnd.x&&g_DragMouseStart.y>=g_DragMouseEnd.y?a>=g_DragMouseStart.x&&i>=g_DragMouseStart.x&&d<=g_DragMouseStart.y&&l<=g_DragMouseStart.y&&a<=g_DragMouseEnd.x&&i<=g_DragMouseEnd.x&&d>=g_DragMouseEnd.y&&l>=g_DragMouseEnd.y&&o.push(_):g_DragMouseStart.x>=g_DragMouseEnd.x&&g_DragMouseStart.y>=g_DragMouseEnd.y?a>=g_DragMouseEnd.x&&i>=g_DragMouseEnd.x&&d>=g_DragMouseEnd.y&&l>=g_DragMouseEnd.y&&a<=g_DragMouseStart.x&&i<=g_DragMouseStart.x&&d<=g_DragMouseStart.y&&l<=g_DragMouseStart.y&&o.push(_):g_DragMouseStart.x<=g_DragMouseEnd.x&&g_DragMouseStart.y<=g_DragMouseEnd.y?a>=g_DragMouseStart.x&&i>=g_DragMouseStart.x&&d>=g_DragMouseStart.y&&l>=g_DragMouseStart.y&&a<=g_DragMouseEnd.x&&i<=g_DragMouseEnd.x&&d<=g_DragMouseEnd.y&&l<=g_DragMouseEnd.y&&o.push(_):g_DragMouseStart.x>=g_DragMouseEnd.x&&g_DragMouseStart.y<=g_DragMouseEnd.y&&a<=g_DragMouseStart.x&&i<=g_DragMouseStart.x&&d>=g_DragMouseStart.y&&l>=g_DragMouseStart.y&&a>=g_DragMouseEnd.x&&i>=g_DragMouseEnd.x&&d<=g_DragMouseEnd.y&&l<=g_DragMouseEnd.y&&o.push(_)}_++}}return console.log("mod_list",o),o}catch(e){error_handling(e)}}async function duplicate_drag_obj(e,o,t,_,n,a,i,d,l,r="Y"){logDebug("function : duplicate_drag_obj; i_final_x : "+e+"; p_final_y : "+o+"; pModIndex : "+t+"; pShelfIndex : "+_+"; i_shelf_edit_flag : "+n+"; i_module_edit_flag : "+a,"S");try{var g=-1,s=g_pog_json[d].ModuleInfo[t].ShelfInfo[_];if(g_dup_mod_list.length>0){var f=0;for(const j of g_pog_json[0].ModuleInfo){if((void 0===j.ParentModule||null==j.ParentModule)&&void 0!==g_dup_mod_list.find((e=>e==f))){g_module_edit_flag="Y",g_module_index=f,g_multiItemCopy="N",context_copy("S",d),g_cut_action_done="N",g_copy_action_done="N",g_dup_action_done="Y",g_delete_action_done="N",g_multi_delete_done="N",g_multi_copy_done="N";await context_paste("COPY",i,"Y",r,l,d);(T={}).MIndex=g_pog_json[l].ModuleInfo.length-1,T.MObjID=g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].MObjID,T.SIndex="",T.SObjID="",T.ObjType=""}f++}g_dup_mod_list=[]}else if("Y"==n){var p=JSON.parse(JSON.stringify(s));p.ItemInfo=[];var c=s.AllowAutoCrush;if("TEXTBOX"==p.ObjType){var I=g_cut_copy_arr[0].X,u=g_cut_copy_arr[0].Y;for(let N=0;N<g_cut_copy_arr.length;N++){var m=g_cut_copy_arr[N].X-I,h=g_cut_copy_arr[N].Y-u;g_cut_copy_arr[N].X=e+m,g_cut_copy_arr[N].Y=o+h}}else g_cut_copy_arr[0].X=e,g_cut_copy_arr[0].Y=o;console.log("final x and y ",g_cut_copy_arr[0].X,g_cut_copy_arr[0].Y);var S="TEXTBOX"==p.ObjType?"N":"Y",[g,O,M,x]=get_curr_module(e,o,n,t,_,p,l),v=validate_shelf_min_distance(g,_,o,[],c,t,e,S,p,l);if("Y"==v||"R"==v||"TEXTBOX"==p.ObjType&&"N"==v){g_cut_action_done="N",g_copy_action_done="N",g_dup_action_done="Y",g_delete_action_done="N",g_multi_delete_done="N",g_multi_copy_done="N";f=0;for(const F of g_pog_json[l].ModuleInfo){if(parseFloat(e)>parseFloat(F.X)-F.W/2&&parseFloat(e)<parseFloat(F.X)+F.W/2&&parseFloat(o)>parseFloat(F.Y)-F.H/2&&parseFloat(o)<parseFloat(F.Y)+F.H/2&&(null==F.ParentModule||void 0===F.ParentModule)){g=f;break}f++}if(-1==g){f=0;for(const R of g_pog_json[l].ModuleInfo){if(null==R.ParentModule||void 0===R.ParentModule){g=f;break}f++}}"TEXTBOX"==g_cut_loc_arr[0].ShelfObjType&&g_cut_support_obj_arr.length>0&&g_pog_json[l].ModuleInfo.push(g_cut_support_obj_arr[0]),t=g;for(let H=0;H<g_cut_copy_arr.length;H++){let w=g_cut_copy_arr[H];w.Shelf=g_pog_json[l].ModuleInfo[t].Module+(g_pog_json[l].ModuleInfo[t].ShelfInfo.length+1),g_pog_json[l].ModuleInfo[t].ShelfInfo.push(w),_=g_pog_json[l].ModuleInfo[t].ShelfInfo.length-1,w.ItemInfo=[];var[D,E,C]=await context_create_shelfs(w,-1,-1,t,_,"N","Y",i,"Y","","Y",l)}async function b(){var e={};e.MIndex=t,e.MObjID=g_pog_json[l].ModuleInfo[t].MObjID,e.SIndex=_,e.SObjID=s.SObjID,e.ObjType=s.ObjType;var o=[],n=E;o.moduleIndex=t,o.shelfIndex=_,o.actionType="DUPLICATE_SHELF",o.startCanvas=l,o.g_present_canvas=g_start_canvas,o.objectID=n,o.moduleObjectID=g_pog_json[l].ModuleInfo[t].MObjID,o.module=g_pog_json[l].ModuleInfo[t].Module,o.push(JSON.parse(JSON.stringify(s)));JSON.parse(JSON.stringify(s.ItemInfo));g_allUndoObjectsInfo.push(o),logFinalUndoObjectsInfo("SHELF_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","N"),g_allUndoObjectsInfo=[];var a=g_pog_json[l].ModuleInfo[t].ShelfInfo;a.sort(((e,o)=>e.Y>o.Y&&"NOTCH"!==e.ObjType&&"BASE"!==e.ObjType?1:-1)),a.sort(((e,o)=>e.Y>o.Y&&"NOTCH"!==e.ObjType&&"BASE"!==e.ObjType?1:-1));await calculateFixelAndSupplyDays("N",l)}if(b(),"N"==g_manual_zoom_ind){var T,P=(T=get_min_max_xy(l)).split("###");set_camera_z(i,parseFloat(P[2]),parseFloat(P[3]),parseFloat(P[0]),parseFloat(P[1]),g_offset_z,parseFloat(P[4]),parseFloat(P[5]),!0,g_pog_index)}}}else if("Y"==a){async function b(){await context_paste("COPY",i,"Y",r,l,d);var e={};e.MIndex=g_pog_json[l].ModuleInfo.length-1,e.MObjID=g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].MObjID,e.SIndex="",e.SObjID="",e.ObjType=""}g_cut_action_done="N",g_copy_action_done="N",g_dup_action_done="Y",g_delete_action_done="N",g_multi_delete_done="N",g_multi_copy_done="N",res=await b()}else if("Y"==g_item_edit_flag){async function b(){var[a,g,s,f]=get_curr_module(e,o,n,t,_,p,l);t=a;await context_paste("COPY",i,"Y",r,l,d);var c={};c.MIndex=g_pog_json[l].ModuleInfo.length-1,c.MObjID=g_pog_json[l].ModuleInfo[g_pog_json[l].ModuleInfo.length-1].MObjID,c.SIndex="",c.SObjID="",c.ObjType=""}g_cut_action_done="N",g_copy_action_done="N",g_dup_action_done="Y",g_delete_action_done="N",g_multi_delete_done="N",g_multi_copy_done="N",console.log("g_multi_copy_done",g_multi_copy_done),res=await b(),async function(){await recreate_compare_views(g_compare_view,"N")}(),g_cut_copy_arr=[],g_cut_support_obj_arr=[],g_cut_loc_arr=[],loc_details={},g_undo_details=[],g_duplicating="N",g_drag_inprogress="N"}logDebug("function : duplicate_drag_obj","E")}catch(y){error_handling(y)}}function get_curr_module(e,o,t,_,n,a,i){logDebug("function : get_curr_module; i_final_x : "+e+"; p_final_y : "+o+"; i_shelf_edit_flag : "+t+"; p_module_index : "+_+"; p_shelf_index : "+n,"S");try{var d="N",l=-1,r=0,g=0,s=0,f="N",p="N";if(mod_top=0,-1==l){$.each(g_pog_json[i].ModuleInfo,(function(t,_){null!=_.ParentModule&&void 0!==_.ParentModule||$.each(_.ShelfInfo,(function(_,n){if("CHEST"==n.ObjType&&parseFloat(e)>parseFloat(n.X)-n.W/2&&parseFloat(e)<parseFloat(n.X)+n.W/2&&parseFloat(o)>parseFloat(n.Y)-n.H/2&&parseFloat(o)<parseFloat(n.Y)+n.H/2)return l=t,d="N",p="Y",!1}))}))}if("N"==p){for(let t=0;t<g_pog_json[i].ModuleInfo.length;t++){let _=g_pog_json[i].ModuleInfo[t];if(parseFloat(e)>parseFloat(_.X)-_.W/2&&parseFloat(e)<parseFloat(_.X)+_.W/2&&parseFloat(o)>parseFloat(_.Y)-_.H/2&&parseFloat(o)<parseFloat(_.Y)+_.H/2&&(null==_.ParentModule||void 0===_.ParentModule)){d="Y",l=t;break}{let t=-1,_=Number.MAX_VALUE;for(let n=0;n<g_pog_json[i].ModuleInfo.length;n++){let a=g_pog_json[i].ModuleInfo[n];if(null==a.ParentModule||void 0===a.ParentModule){let i=parseFloat(e)-parseFloat(a.X),d=parseFloat(o)-parseFloat(a.Y),l=Math.sqrt(i*i+d*d);l<_&&(_=l,t=n)}-1!==t&&(l=t,d="N")}if(-1==l)for(let e=0;e<g_pog_json[i].ModuleInfo.length;e++){let o=g_pog_json[i].ModuleInfo[e];if(null==o.ParentModule||void 0===o.ParentModule){l=e,d="N";break}}}}"Y"==t&&(0===a.Rotation&&0===a.Slope||($.each(g_pog_json[i].ModuleInfo,(function(e,o){null!=o.ParentModule&&void 0!==o.ParentModule||(r=Math.min(r,parseFloat(o.X)-o.W/2),g=Math.max(g,parseFloat(o.X)+o.W/2),mod_top=Math.max(mod_top,parseFloat(o.Y)+o.H/2),s=Math.min(s,parseFloat(o.Y)-o.H/2))})),e+a.ShelfRotateWidth/2>r&&e-a.ShelfRotateWidth/2<g&&o-a.ShelfRotateHeight/2<mod_top&&o+a.ShelfRotateHeight/2>s&&"TEXTBOX"!==a.ObjType&&0!==a.Rotation&&0==a.Slope?f="Y":($.each(g_pog_json[i].ModuleInfo,(function(o,t){if((null==t.ParentModule||void 0===t.ParentModule)&&parseFloat(e)>parseFloat(t.X)-t.W/2&&parseFloat(e)<parseFloat(t.X)+t.W/2)return l=o,d="N",!1})),-1==l&&$.each(g_pog_json[i].ModuleInfo,(function(e,o){if(null==o.ParentModule||void 0===o.ParentModule)return l=e,d="N",!1})))))}return logDebug("function : get_curr_module","E"),console.log("values",l,d,f,-1),[l,d,f,-1]}catch(e){error_handling(e)}}class DisclosureNav{constructor(e){this.rootNode=e,this.controlledNodes=[],this.openIndex=null,this.useArrowKeys=!0,this.topLevelNodes=[...this.rootNode.querySelectorAll(".main-link, button[aria-expanded][aria-controls]")],this.topLevelNodes.forEach((e=>{if("button"===e.tagName.toLowerCase()&&e.hasAttribute("aria-controls")){const o=e.parentNode.querySelector("ul");o&&(this.controlledNodes.push(o),e.setAttribute("aria-expanded","false"),this.toggleMenu(o,!1),o.addEventListener("keydown",this.onMenuKeyDown.bind(this)),e.addEventListener("click",this.onButtonClick.bind(this)),e.addEventListener("keydown",this.onButtonKeyDown.bind(this)))}else this.controlledNodes.push(null),e.addEventListener("keydown",this.onLinkKeyDown.bind(this))})),this.rootNode.addEventListener("focusout",this.onBlur.bind(this))}controlFocusByKey(e,o,t){switch(e.key){case"ArrowUp":case"ArrowLeft":if(e.preventDefault(),t>-1)o[Math.max(0,t-1)].focus();break;case"ArrowDown":case"ArrowRight":if(e.preventDefault(),t>-1)o[Math.min(o.length-1,t+1)].focus();break;case"Home":e.preventDefault(),o[0].focus();break;case"End":e.preventDefault(),o[o.length-1].focus()}}close(){this.toggleExpand(this.openIndex,!1)}onBlur(e){this.rootNode.contains(e.relatedTarget)||null===this.openIndex||this.toggleExpand(this.openIndex,!1)}onButtonClick(e){var o=e.target,t=this.topLevelNodes.indexOf(o),_="true"===o.getAttribute("aria-expanded");this.toggleExpand(t,!_)}onButtonKeyDown(e){var o=this.topLevelNodes.indexOf(document.activeElement);"Escape"===e.key?this.toggleExpand(this.openIndex,!1):this.useArrowKeys&&this.openIndex===o&&"ArrowDown"===e.key?(e.preventDefault(),this.controlledNodes[this.openIndex].querySelector("a").focus()):this.useArrowKeys&&this.controlFocusByKey(e,this.topLevelNodes,o)}onLinkKeyDown(e){var o=this.topLevelNodes.indexOf(document.activeElement);this.useArrowKeys&&this.controlFocusByKey(e,this.topLevelNodes,o)}onMenuKeyDown(e){if(null!==this.openIndex){var o=Array.prototype.slice.call(this.controlledNodes[this.openIndex].querySelectorAll("a")),t=o.indexOf(document.activeElement);"Escape"===e.key?(this.topLevelNodes[this.openIndex].focus(),this.toggleExpand(this.openIndex,!1)):this.useArrowKeys&&this.controlFocusByKey(e,o,t)}}toggleExpand(e,o){this.openIndex!==e&&this.toggleExpand(this.openIndex,!1),this.topLevelNodes[e]&&(this.openIndex=o?e:null,this.topLevelNodes[e].setAttribute("aria-expanded",o),this.toggleMenu(this.controlledNodes[e],o))}toggleMenu(e,o){e&&(e.style.display=o?"block":"none")}updateKeyControls(e){this.useArrowKeys=e}}function replaceMenuKey(e,o,t){var _=e.trim(),n=_,a=n.toUpperCase().indexOf(t.toUpperCase());n=-1!=a?n.replace(n.charAt(a),"<b><u>"+n.charAt(a)+"</u></b>"):n+"(<b><u>"+t.toUpperCase()+"</u></b>)";var i=o;return i=i.replace(_,n)}function underlineMenuKey(){var e=$('[accesskey][accesskey!=""]'),o=0;for(const _ of e){var t=$("[accesskey="+e[o].accessKey+"]").parent();t.length>0&&(t[0].innerHTML=replaceMenuKey(t[0].innerText,t[0].innerHTML,e[o].accessKey)),o++}var _,n=apex.actions.listShortcuts();for(o=0;o<n.length;o++)if("Alt"==(_=n[o].shortcut).substr(0,3)&&$('a[href$="#action$'+n[o].actionName+'"]:first').length>0){var a=$('a[href$="#action$'+n[o].actionName+'"]:first')[0].innerText.trim(),i=a,d=i.toUpperCase().indexOf(_.substr(-1).toUpperCase());i=-1!=d?i.replace(i.charAt(d),"<b><u>"+i.charAt(d)+"</u></b>"):i+"(<b><u>"+_.substr(-1).toUpperCase()+"</u></b>)";var l=$('a[href$="#action$'+n[o].actionName+'"]:first')[0].innerHTML;l=l.replace(a,i),$('a[href$="#action$'+n[o].actionName+'"]:first')[0].innerHTML=replaceMenuKey($('a[href$="#action$'+n[o].actionName+'"]:first')[0].innerText,$('a[href$="#action$'+n[o].actionName+'"]:first')[0].innerHTML,_.substr(-1))}}async function Show_swap_module(e,o,t,_,n){logDebug("function : Show_swap_module","S");JSON.parse(JSON.stringify(g_pog_json[n]));var a=[];if(t.length>0){var i=0;for(var d of t){var l=0;for(var r of g_pog_json[n].ModuleInfo)r.Module==d.MainMod&&(d.MainIndex=l),r.Module==d.SwapMod&&(d.SwapIndex=l),l++;if("Y"==_){var g=1;for(var r of g_pog_json[n].ModuleInfo)void 0!==r.ParentModule&&""!=r.ParentModule&&null!=r.ParentModule||(r.Module==d.MainMod&&(d.MainModSeq=g),r.Module==d.SwapMod&&(d.SwapModSeq=g),g++)}}a=JSON.parse(JSON.stringify(t));i=0;for(d of t)a[i].MainMod!==t[i].MainMod.toUpperCase()?a[i].MainMod=a[i].MainMod.toUpperCase():a[i].MainMod=a[i].MainMod.toLowerCase(),a[i].SwapMod!==t[i].SwapMod.toUpperCase()?a[i].SwapMod=a[i].SwapMod.toUpperCase():a[i].SwapMod=a[i].SwapMod.toLowerCase(),i++;l=0;for(var d of a){for(var s of g_pog_json[n].ModuleInfo[d.MainIndex].ShelfInfo){var f=new RegExp("^["+d.MainMod+"]"),p="",c="";if("TEXTBOX"==s.ObjType)f=new RegExp(" ["+d.MainMod+"]$"),c=s.Shelf.replace(f," "+d.SwapMod),s.Shelf=c,f=new RegExp("_["+d.MainMod+"]$"),c=s.Shelf.replace(f,"_"+d.SwapMod),s.Shelf=c,f=new RegExp("["+d.MainMod+"]$"),c=s.Shelf.replace(f,d.SwapMod),s.Shelf=c;else{p=s.Shelf.replace(f,d.SwapMod);s.Shelf=p,p=s.Desc.replace(f,d.SwapMod),s.Desc=p,"Y"==_&&(f=new RegExp("["+d.MainModSeq+"]/"),p=s.Desc.replace(f,d.SwapModSeq+"/"),c=s.Shelf.replace(f,d.SwapModSeq+"/"),s.Desc=p,s.Shelf=c)}}for(var s of g_pog_json[n].ModuleInfo[d.SwapIndex].ShelfInfo){f=new RegExp("^["+d.SwapMod+"]"),p="";if("TEXTBOX"==s.ObjType)f=new RegExp(" ["+d.SwapMod+"]$"),c=s.Shelf.replace(f," "+d.MainMod),s.Shelf=c,f=new RegExp("_["+d.SwapMod+"]$"),c=s.Shelf.replace(f,"_"+d.MainMod),s.Shelf=c,f=new RegExp("["+d.SwapMod+"]$"),c=s.Shelf.replace(f,d.MainMod),s.Shelf=c;else{p=s.Shelf.replace(f,d.MainMod);s.Shelf=p,p=s.Desc.replace(f,d.MainMod),s.Desc=p,"Y"==_&&(f=new RegExp("["+d.SwapModSeq+"]/"),p=s.Desc.replace(f,d.MainModSeq+"/"),c=s.Shelf.replace(f,d.MainModSeq+"/"),s.Desc=p,s.Shelf=c)}}g=0;for(const e of g_pog_json[n].ModuleInfo){if(void 0!==e.ParentModule&&""!==e.ParentModule&&null!==e.ParentModule&&(g==d.MainIndex&&(e.SwapToIndex=d.SwapIndex),g==d.SwapIndex&&(e.SwapToIndex=d.MainIndex),g!==d.MainIndex&&g!==d.SwapIndex)){const o=e.Module;f=new RegExp(" ["+d.MainMod+"]$");var I=e.Module.replace(f," "+d.SwapMod);e.Module=I!==o?I:e.Module;f=new RegExp("_["+d.MainMod+"]$"),I=e.Module.replace(f,"_"+d.SwapMod);e.Module=I!==o?I:e.Module;f=new RegExp("["+d.MainMod+"]$"),I=e.Module.replace(f,d.SwapMod);e.Module=I!==o?I:e.Module;f=new RegExp(" ["+d.SwapMod+"]$"),I=e.Module.replace(f," "+d.MainMod);e.Module=I!==o?I:e.Module;f=new RegExp("_["+d.SwapMod+"]$"),I=e.Module.replace(f,"_"+d.MainMod);e.Module=I!==o?I:e.Module;f=new RegExp("["+d.SwapMod+"]$"),I=e.Module.replace(f,d.MainMod);for(var s of(e.Module=I!==o?I:e.Module,e.ShelfInfo))if(void 0===s.EditInd||"Y"!==s.EditInd){f=new RegExp("^["+d.SwapMod+"]"),p="";var u=s.Shelf;if("TEXTBOX"==s.ObjType)f=new RegExp(" ["+d.SwapMod+"]$"),c=s.Shelf.replace(f," "+d.MainMod),s.Shelf=u!==c?c:s.Shelf,f=new RegExp("_["+d.SwapMod+"]$"),c=s.Shelf.replace(f,"_"+d.MainMod),s.Shelf=u!==c?c:s.Shelf,f=new RegExp("["+d.SwapMod+"]$"),c=s.Shelf.replace(f,d.MainMod),s.Shelf=u!==c?c:s.Shelf;else{c=s.Shelf.replace(f,d.MainMod);s.Shelf=c}if(s.Shelf==u){f=new RegExp("^["+d.MainMod+"]"),p="";if("TEXTBOX"==s.ObjType)f=new RegExp(" ["+d.MainMod+"]$"),c=s.Shelf.replace(f," "+d.SwapMod),s.Shelf=c,f=new RegExp("_["+d.MainMod+"]$"),c=s.Shelf.replace(f,"_"+d.SwapMod),s.Shelf=c,f=new RegExp("["+d.MainMod+"]$"),c=s.Shelf.replace(f,d.SwapMod),s.Shelf=c;else{c=s.Shelf.replace(f,d.SwapMod);s.Shelf=c}}}e.ParentModule==d.SwapMod?e.ParentModule=d.MainMod:e.ParentModule==d.MainMod&&(e.ParentModule=d.SwapMod)}g++}l++}l=0;for(var d of t){for(var s of g_pog_json[n].ModuleInfo[d.MainIndex].ShelfInfo){f=new RegExp("^["+d.MainMod+"]"),p="",c="";if("TEXTBOX"==s.ObjType)f=new RegExp(" ["+d.MainMod+"]$"),c=s.Shelf.replace(f," "+d.SwapMod),s.Shelf=c,f=new RegExp("_["+d.MainMod+"]$"),c=s.Shelf.replace(f,"_"+d.SwapMod),s.Shelf=c,f=new RegExp("["+d.MainMod+"]$"),c=s.Shelf.replace(f,d.SwapMod),s.Shelf=c;else{p=s.Shelf.replace(f,d.SwapMod);s.Shelf=p,p=s.Desc.replace(f,d.SwapMod),s.Desc=p,"Y"==_&&(f=new RegExp("["+d.MainModSeq+"]/"),p=s.Desc.replace(f,d.SwapModSeq+"/"),c=s.Shelf.replace(f,d.SwapModSeq+"/"),s.Desc=p,s.Shelf=c)}}for(var s of g_pog_json[n].ModuleInfo[d.SwapIndex].ShelfInfo){f=new RegExp("^["+d.SwapMod+"]"),p="";if("TEXTBOX"==s.ObjType)f=new RegExp(" ["+d.SwapMod+"]$"),c=s.Shelf.replace(f," "+d.MainMod),s.Shelf=c,f=new RegExp("_["+d.SwapMod+"]$"),c=s.Shelf.replace(f,"_"+d.MainMod),s.Shelf=c,f=new RegExp("["+d.SwapMod+"]$"),c=s.Shelf.replace(f,d.MainMod),s.Shelf=c;else{p=s.Shelf.replace(f,d.MainMod);s.Shelf=p,p=s.Desc.replace(f,d.MainMod),s.Desc=p,"Y"==_&&(f=new RegExp("["+d.SwapModSeq+"]/"),p=s.Desc.replace(f,d.MainModSeq+"/"),c=s.Shelf.replace(f,d.MainModSeq+"/"),s.Desc=p,s.Shelf=c)}}g=0;for(const e of g_pog_json[n].ModuleInfo){if(void 0!==e.ParentModule&&""!==e.ParentModule&&null!==e.ParentModule&&(g==d.MainIndex&&(e.SwapToIndex=d.SwapIndex),g==d.SwapIndex&&(e.SwapToIndex=d.MainIndex),g!==d.MainIndex&&g!==d.SwapIndex)){const o=e.Module;f=new RegExp(" ["+d.MainMod+"]$"),I=e.Module.replace(f," "+d.SwapMod);e.Module=I!==o?I:e.Module;f=new RegExp("_["+d.MainMod+"]$"),I=e.Module.replace(f,"_"+d.SwapMod);e.Module=I!==o?I:e.Module;f=new RegExp("["+d.MainMod+"]$"),I=e.Module.replace(f,d.SwapMod);e.Module=I!==o?I:e.Module;f=new RegExp(" ["+d.SwapMod+"]$"),I=e.Module.replace(f," "+d.MainMod);e.Module=I!==o?I:e.Module;f=new RegExp("_["+d.SwapMod+"]$"),I=e.Module.replace(f,"_"+d.MainMod);e.Module=I!==o?I:e.Module;f=new RegExp("["+d.SwapMod+"]$"),I=e.Module.replace(f,d.MainMod);e.Module=I!==o?I:e.Module;for(var s of e.ShelfInfo){f=new RegExp("^["+d.SwapMod+"]"),p="",u=s.Shelf;if(void 0===s.EditInd||"Y"!==s.EditInd){if("TEXTBOX"==s.ObjType)f=new RegExp(" ["+d.SwapMod+"]$"),c=s.Shelf.replace(f," "+d.MainMod),s.Shelf=u!==c?c:s.Shelf,f=new RegExp("_["+d.SwapMod+"]$"),c=s.Shelf.replace(f,"_"+d.MainMod),s.Shelf=u!==c?c:s.Shelf,f=new RegExp("["+d.SwapMod+"]$"),c=s.Shelf.replace(f,d.MainMod),s.Shelf=u!==c?c:s.Shelf;else{c=s.Shelf.replace(f,d.MainMod);s.Shelf=c}if(s.Shelf==u){f=new RegExp("^["+d.MainMod+"]"),p="";if("TEXTBOX"==s.ObjType)f=new RegExp(" ["+d.MainMod+"]$"),c=s.Shelf.replace(f," "+d.SwapMod),s.Shelf=c,f=new RegExp("_["+d.MainMod+"]$"),c=s.Shelf.replace(f,"_"+d.SwapMod),s.Shelf=c,f=new RegExp("["+d.MainMod+"]$"),c=s.Shelf.replace(f,d.SwapMod),s.Shelf=c;else{c=s.Shelf.replace(f,d.SwapMod);s.Shelf=c}}}}e.ParentModule==d.SwapMod?e.ParentModule=d.MainMod:e.ParentModule==d.MainMod&&(e.ParentModule=d.SwapMod)}g++}l++;var m=g_pog_json[n].ModuleInfo[d.MainIndex],h=g_pog_json[n].ModuleInfo[d.SwapIndex];const e=m.SeqNo,o=h.SeqNo;m.SeqNo=o,h.SeqNo=e,g_pog_json[n].ModuleInfo[d.SwapIndex]=m,g_pog_json[n].ModuleInfo[d.MainIndex]=h,g_pog_json[n].ModuleInfo[d.SwapIndex].Module=d.SwapMod,g_pog_json[n].ModuleInfo[d.MainIndex].Module=d.MainMod}await context_create_module("",g_camera,"Y",n,"Y"),await enableDisableFlags(n);apex.message.showPageSuccess(g_pog_refresh_msg)}logDebug("function : Show_swap_module","E")}function swapSpecialFixel(e,o,t){var _=new RegExp("["+e+"]/"),n=t.Shelf.replace(_,o);t.Shelf=n}function validate_shelf_inside_pegboard(e,o,t,_,n,a){var i=g_pog_json[t].ModuleInfo[e].ShelfInfo[o].ItemInfo,d=g_pog_json[t].ModuleInfo[e].ShelfInfo[o],l="Y",r=n+d.H/2,g=n-d.H/2,s=_-d.W/2,f=_+d.W/2;if(i.length>0){for(const _ of i){if(item_start=wpdSetFixed(_.X-_.W/2),item_end=wpdSetFixed(_.X+_.W/2),item_top=wpdSetFixed(_.Y+_.H/2),item_bottom=wpdSetFixed(_.Y-_.H/2),a.ItemInfo.length>0)for(const _ of a.ItemInfo){if(div_start=wpdSetFixed(_.X-_.W/2),div_end=wpdSetFixed(_.X+_.W/2),div_top=wpdSetFixed(_.Y+_.H/2),div_bottom=wpdSetFixed(_.Y-_.H/2),(div_start<item_end&&div_start>=item_start||div_end>item_start&&div_end<=item_end)&&(div_bottom<item_top&&div_bottom>=item_bottom||div_top<=item_top&&div_top>item_bottom)||(item_start<=div_start&&item_end>div_start||item_start<div_end&&item_end>=div_end)&&item_top<=div_top&&item_bottom>=div_bottom||(div_start<=item_start&&div_end>=item_end||div_start>=item_start&&div_end<=item_end)&&(div_top>=item_top&&item_bottom>=div_bottom||div_top>=item_top&&div_bottom<=item_bottom||div_top>item_top&&div_bottom<=item_top)||item_start<div_start&&item_end>=div_end&&item_top<=div_top&&item_top>div_bottom&&item_bottom<=div_bottom||item_start>div_start&&item_end<=div_end&&item_top>=div_top&&item_bottom<div_top&&item_bottom<=div_bottom||item_start<div_start&&item_end>=div_end&&item_top<=div_top&&item_bottom>=div_bottom||item_start<div_start&&item_end>=div_end&&item_top<div_top&&item_top>div_bottom||item_start>=div_start&&item_start<div_end&&item_bottom>=div_bottom&&item_bottom<div_top){l="N",g_pog_json[t].ModuleInfo[e].ShelfInfo[o].InsidePegboard="N";break}g_pog_json[t].ModuleInfo[e].ShelfInfo[o].InsidePegboard="Y"}else g_pog_json[t].ModuleInfo[e].ShelfInfo[o].InsidePegboard="Y";0}}else{var p=r,c=g,I=s,u=f;if(a.ItemInfo.length>0)for(const _ of a.ItemInfo){if(div_start=wpdSetFixed(_.X-_.W/2),div_end=wpdSetFixed(_.X+_.W/2),div_top=wpdSetFixed(_.Y+_.H/2),div_bottom=wpdSetFixed(_.Y-_.H/2),(div_start<u&&div_start>=I||div_end>I&&div_end<=u)&&(div_bottom<p&&div_bottom>=c||div_top<=p&&div_top>c)||(I<div_start&&u>div_start||I<div_end&&u>=div_end)&&p<=div_top&&c>=div_bottom||(div_start<=I&&div_end>=u||div_start>=I&&div_end<=u)&&(div_top>=p&&c>=div_bottom||div_top>=p&&div_bottom<=c||div_top>p&&div_bottom<=p)||I<div_start&&u>=div_end&&p<=div_top&&p>div_bottom&&c<=div_bottom||I>div_start&&u<=div_end&&p>=div_top&&c<div_top&&c<=div_bottom||I<div_start&&u>=div_end&&p<=div_top&&c>=div_bottom||I<div_start&&u>=div_end&&p<div_top&&p>div_bottom||I>=div_start&&I<div_end&&c>=div_bottom&&c<div_top){l="N",g_pog_json[t].ModuleInfo[e].ShelfInfo[o].InsidePegboard="N";break}g_pog_json[t].ModuleInfo[e].ShelfInfo[o].InsidePegboard="Y"}else g_pog_json[t].ModuleInfo[e].ShelfInfo[o].InsidePegboard="Y"}for(const e of g_pog_json[t].ModuleInfo)for(const o of e.ShelfInfo)if("Y"==o.InsidePegboard&&o.SObjID!=d.SObjID){var m=wpdSetFixed(o.Y+o.H/2),h=wpdSetFixed(o.Y-o.H/2),S=wpdSetFixed(o.X-o.W/2),O=wpdSetFixed(o.X+o.W/2);if((S<f&&S>=s||O>s&&O<=f)&&(h<r&&h>=g||m<=r&&m>g)||(s<S&&f>S||s<O&&f>=O)&&r<=m&&g>=h||(S<=s&&O>=f||S>=s&&O<=f)&&(m>=r&&g>=h||m>=r&&h<=g||m>r&&h<=r)||s<S&&f>=O&&r<=m&&r>h&&g<=h||s>S&&f<=O&&r>=m&&g<m&&g<=h||s<S&&f>=O&&r<=m&&g>=h||s<S&&f>=O&&r<m&&r>h||s>=S&&s<O&&g>=h&&g<m){l="N";break}if(o.ItemInfo.length>0)for(const e of o.ItemInfo){var M=wpdSetFixed(e.Y+e.H/2),x=wpdSetFixed(e.Y-e.H/2),v=wpdSetFixed(e.X-e.W/2),D=wpdSetFixed(e.X+e.W/2);if((v<f&&v>=s||D>s&&D<=f)&&(x<r&&x>=g||M<=r&&M>g)||(s<v&&f>v||s<D&&f>=D)&&r<=M&&g>=x||(v<=s&&D>=f||v>=s&&D<=f)&&(M>=r&&g>=x||M>=r&&x<=g||M>r&&x<=r)||s<v&&f>=D&&r<=M&&r>x&&g<=x||s>v&&f<=D&&r>=M&&g<M&&g<=x||s<v&&f>=D&&r<=M&&g>=x||s<v&&f>=D&&r<M&&r>x||s>=v&&s<D&&g>=x&&g<M){l="N";break}}if(i.length>0)for(const e of i)if(drag_shelf_item_start=wpdSetFixed(e.X-e.W/2),drag_shelf_item_end=wpdSetFixed(e.X+e.W/2),drag_shelf_item_top=wpdSetFixed(e.Y+e.H/2),drag_shelf_item_bottom=wpdSetFixed(e.Y-e.H/2),o.ItemInfo.length>0)for(const e of o.ItemInfo){M=wpdSetFixed(e.Y+e.H/2),x=wpdSetFixed(e.Y-e.H/2),v=wpdSetFixed(e.X-e.W/2),D=wpdSetFixed(e.X+e.W/2);if((v<drag_shelf_item_end&&v>=drag_shelf_item_start||D>drag_shelf_item_start&&D<=drag_shelf_item_end)&&(x<drag_shelf_item_top&&x>=drag_shelf_item_bottom||M<=drag_shelf_item_top&&M>drag_shelf_item_bottom)||(drag_shelf_item_start<v&&drag_shelf_item_end>v||drag_shelf_item_start<D&&drag_shelf_item_end>=D)&&drag_shelf_item_top<=M&&drag_shelf_item_bottom>=x||(v<=drag_shelf_item_start&&D>=drag_shelf_item_end||v>=drag_shelf_item_start&&D<=drag_shelf_item_end)&&(M>=drag_shelf_item_top&&drag_shelf_item_bottom>=x||M>=drag_shelf_item_top&&x<=drag_shelf_item_bottom||M>drag_shelf_item_top&&x<=drag_shelf_item_top)||drag_shelf_item_start<v&&drag_shelf_item_end>=D&&drag_shelf_item_top<=M&&drag_shelf_item_top>x&&drag_shelf_item_bottom<=x||drag_shelf_item_start>v&&drag_shelf_item_end<=D&&drag_shelf_item_top>=M&&drag_shelf_item_bottom<M&&drag_shelf_item_bottom<=x||drag_shelf_item_start<v&&drag_shelf_item_end>=D&&drag_shelf_item_top<=M&&drag_shelf_item_bottom>=x||drag_shelf_item_start<v&&drag_shelf_item_end>=D&&drag_shelf_item_top<M&&drag_shelf_item_top>x||drag_shelf_item_start>=v&&drag_shelf_item_start<D&&drag_shelf_item_bottom>=x&&drag_shelf_item_bottom<M){l="N";break}}}return l}function makeResizableRow(){const e=$("#t_Body_nav").width(),o=$("#top_bar").height(),t=$("#t_Header").height(),_=$("#resizeLine"),n=$("#canvas-holder .container")[0];var a,i,d,l,r,g,s,f,p=$("#canvas-holder .container .row").length,c=!1,I=-1,u=-1;if(p>1)for(var m=1;m<p;m++){$("#canvas-holder .container .row")[m].addEventListener("mousedown",h)}function h(_){if(!g_dragging&&!c&&(console.log(_.target.className),"row"==_.target.className)){_.preventDefault(),window.addEventListener("mousemove",S),window.addEventListener("mouseup",O),c=!0,a=$("#canvas-holder .container")[0].className.replace("container","").replace("-view","").toUpperCase().trim(),I=parseInt($(_.srcElement).attr("data-row")),u=I-1;var g=(f=n.getBoundingClientRect()).right,s=f.bottom,p=f.left,m=f.top;i=Math.round(p)-e-1+150,l=Math.round(g)-e-1-150,d=Math.round(m)-o-t-1+150,r=Math.round(s)-o-t-1-150}}function S(n){if(c){var p=n.clientX-e,I=n.clientY-o-t;if("H"==a)_.css("width","1px"),_.css("height",f.height+"px"),_.css("top",f.top-o-t-1+"px"),p>i&&p<l&&(g=n.clientX,_.css("left",p+"px"));else{if("V"!=a)return c=!1,window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",O),_.css("width","0px"),_.css("height","0px"),_.css("left","0px"),void _.css("top","0px");_.css("width",f.width+"px"),_.css("height","1px"),_.css("left",f.left-e-1+"px"),I>d&&I<r&&(s=n.clientY,_.css("top",I+"px"))}}}function O(e){if(c&&-1!==typeof I&&-1!==u){var o,t,n,f,p,m,h,x=$("[data-row = "+I+"] .canvas-content"),v=$("[data-row = "+u+"] .canvas-content"),D=$("[data-row="+I+"]")[0].getBoundingClientRect(),E=$("[data-row="+u+"]")[0].getBoundingClientRect();if(window.removeEventListener("mousemove",S),_.css("width","0px"),_.css("height","0px"),_.css("left","0px"),_.css("top","0px"),"H"==a)p=e.clientX>=i&&e.clientX<=l?e.clientX:g,D.left>p&&E.right>p||D.left<p&&E.right<p?(o=D.width+(D.left-p),n=E.width-(E.right-p)):(o=D.width,n=E.width),$("[data-row="+I+"] .canvas-content").css("width",o+"px"),$("[data-row="+u+"] .canvas-content").css("width",n+"px"),t=D.height,f=E.height;else{if("V"!=a)return window.removeEventListener("mouseup",O),void(c=!1);m=e.clientY>=d&&e.clientY<=r?e.clientY:s,D.top>m&&E.bottom>m||D.top<m&&E.bottom<m?(t=D.height+(D.top-m),f=E.height-(E.bottom-m)):(t=D.height,f=E.height),$("[data-row="+I+"] .canvas-content").css("height",t+"px"),$("[data-row="+u+"] .canvas-content").css("height",f+"px"),o=D.width,n=E.width}for(elm of(g_renderer.setPixelRatio(window.devicePixelRatio),x)){var C=$(elm).attr("id"),b=$("#"+C+" .canvasregion").attr("data-indx"),T=$("#"+C+" .canvasregion").attr("id");h=$("#"+C+" .canvas-buttons").height(),M(b,T,$(elm).width(),$(elm).height()-h)}for(elm of v){C=$(elm).attr("id"),b=$("#"+C+" .canvasregion").attr("data-indx"),T=$("#"+C+" .canvasregion").attr("id");h=$("#"+C+" .canvas-buttons").height(),M(b,T,$(elm).width(),$(elm).height()-h)}$("#canvas-holder .container").css("display","block !important"),window.removeEventListener("mouseup",O),c=!1}}function M(e,o,t,_){var n=g_scene_objects[e].scene.children[0],a=get_min_max_xy(e).split("###");g_canvas_objects[e]=document.getElementById(o),g_canvas_objects[e].width=t,g_canvas_objects[e].height=_,$("#"+o).width(t),$("#"+o).height(_),n.aspect=t/_,n.updateProjectionMatrix(),g_scene_objects[e].scene.children[0]=n,set_camera_z(n,parseFloat(a[2]),parseFloat(a[3]),parseFloat(a[0]),parseFloat(a[1]),g_offset_z,parseFloat(a[4]),parseFloat(a[5]),!0,e),context=g_canvas_objects[e].getContext("2d"),g_renderer.setSize(t,_),n.aspect=t/_,g_renderer.render(g_scene_objects[e].scene,n),context.drawImage(g_renderer.domElement,0,0,t,_),n.updateProjectionMatrix(),g_scene_objects[e].scene.children[0]=n,set_camera_z(n,parseFloat(a[2]),parseFloat(a[3]),parseFloat(a[0]),parseFloat(a[1]),g_offset_z,parseFloat(a[4]),parseFloat(a[5]),!0,e)}}function openItemSubLabel(e){try{var o="N";if(g_pog_json.length>0){var t=-1;t="Y"==g_all_pog_flag?0:g_pog_index,""!==e&&(o="Y");var _=g_pog_index;g_delete_details.is_dragging="Y",$("#item_sublbl_sub .items").removeClass("item_sublabel_active"),""==e?($(".item_sublabel").removeClass("item_sublabel_active"),$("#item_sublbl_sub .items").removeClass("item_sublabel_active")):($(".item_sublabel").addClass("item_sublabel_active"),$("#item_sublbl_sub ."+e).addClass("item_sublabel_active"));for(const _ of g_pog_json){if((t!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex)&&(g_renderer=g_scene_objects[t].renderer,g_scene=g_scene_objects[t].scene,g_camera=g_scene_objects[t].scene.children[0],showItemSubLabel(e,o,$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),t),set_indicator_objects(t)),"N"==g_all_pog_flag)break;t++}g_scene_objects.length>0&&(g_renderer=g_scene_objects[_].renderer,g_scene=g_scene_objects[_].scene,g_camera=g_scene_objects[_].scene.children[0]),g_delete_details.is_dragging="N"}}catch(e){error_handling(e)}}function checkChestCrushedItemHit(e,o,t,_,n,a){try{var i=0,d=wpdSetFixed(e-t/2),l=wpdSetFixed(e+t/2),r=wpdSetFixed(o+_/2),g=wpdSetFixed(o-_/2);const I=wpdSetFixed(n.X-n.W/2),u=wpdSetFixed(n.X+n.W/2),m=wpdSetFixed(n.Y-n.H/2),h=wpdSetFixed(n.Y+n.H/2);for(const e of n.ItemInfo){if(i!==a){var s=wpdSetFixed(e.X-e.W/2),f=wpdSetFixed(e.X+e.W/2),p=wpdSetFixed(e.Y+e.H/2),c=wpdSetFixed(e.Y-e.H/2);if(r<c||g>p||l<s||d>f){if(r>h||g<m||d<I||l>u)return"Y"}else if((s<l&&s>=d||f>d&&f<=l)&&(c<r&&c>=g||p<=r&&p>g)||(d<s&&l>s||d<f&&l>=f)&&r<=p&&g>=c||(s<=d&&f>=l||s>=d&&f<=l)&&(p>=r&&g>=c||p>=r&&c<=g||p>r&&c<=r)||d<s&&l>=f&&r<=p&&r>c&&g<=c||d>s&&l<=f&&r>=p&&g<p&&g<=c||d<s&&l>=f&&r<=p&&g>=c||d<s&&l>=f&&r<p&&r>c||d>=s&&d<f&&g>=c&&g<p)return"Y"}i++}return"N"}catch(e){error_handling(e)}}function getChestOverlappedItemDimension(e,o,t,_,n){try{const S=wpdSetFixed(e-t/2),O=wpdSetFixed(e+t/2),M=wpdSetFixed(o+_/2),x=wpdSetFixed(o-_/2);var a,i,d,l,r=0,g=0,s=0,f=0,p=0,c=0,I="N",u="N";"CHEST"==nvl(n.ObjType)?(a=wpdSetFixed(n.Y+n.H/2),i=wpdSetFixed(n.Y-n.H/2),d=wpdSetFixed(n.X-n.W/2),l=wpdSetFixed(n.X+n.W/2),M>a&&(g=p=M-a,u="Y"),x<i&&(g+=c=i-x,u="Y"),S<d&&(r=s=d-S,u="Y"),O>l&&(r+=f=O-l,u="Y")):(a=wpdSetFixed(n.Y+n.H/2),i=wpdSetFixed(n.Y-n.H/2),d=wpdSetFixed(n.X-n.W/2),l=wpdSetFixed(n.X+n.W/2),((d<O&&d>=S||l>S&&l<=O)&&(i<M&&i>=x||a<=M&&a>x)||(S<d&&O>d||S<l&&O>=l)&&M<=a&&x>=i||(d<=S&&l>=O||d>=S&&l<=O)&&(a>=M&&x>=i||a>=M&&i<=x||a>M&&i<=M)||S<d&&O>=l&&M<=a&&M>i&&x<=i||S>d&&O<=l&&M>=a&&x<a&&x<=i||S<d&&O>=l&&M<=a&&x>=i||S<d&&O>=l&&M<a&&M>i||S>=d&&S<l&&x>=i&&x<a)&&(M>i&&i>x&&!(x<a&&a<M)&&(g=p=M-i,I="Y"),x<a&&a<M&&!(M>i&&i>x)&&(g+=c=a-x,I="Y"),S<l&&l<O&&!(O>d&&d>S)&&(r=s=l-S,I="Y"),O>d&&d>S&&!(S<l&&l<O)&&(r+=f=O-d,I="Y")));const v=Math.ceil(r/t*100),D=Math.ceil(g/_*100),E=wpdSetFixed(t*(1-v/100)),C=wpdSetFixed(_*(1-D/100));var m=e,h=o;return 0!==v&&(m=f>s?"Y"==u?l-E/2:d-E/2:"Y"==u?d+E/2:l+E/2),0!==D&&(h=p>c?"Y"==u?a-C/2:i-C/2:"Y"==u?i+C/2:a+C/2),"Y"==I||"Y"==u?0==v&&0!==D?[e,h,t,C,0,D]:0!==v&&0==D?[m,o,E,_,v,0]:0!==v&&0!==D?"Y"==u?[m,h,E,C,v,D]:v>D?[e,h,t,C,0,D]:[m,o,E,_,v,0]:[e,o,t,_,0,0]:[e,o,t,_,0,0]}catch(e){error_handling(e)}}function crushChestItemHW(e,o,t,_,n,a,i,d,l,r){try{var g=0,s=o.RH+nvl(o.CapHeight),f=o.RW,p=o.X,c=o.Y,I=[],u=wpdSetFixed(p-f/2),m=wpdSetFixed(p+f/2),h=wpdSetFixed(c+s/2),S=wpdSetFixed(c-s/2);for(const o of e.ItemInfo){if(g!==t){var O=wpdSetFixed(o.X-o.W/2),M=wpdSetFixed(o.X+o.W/2),x=wpdSetFixed(o.Y+o.H/2);h<wpdSetFixed(o.Y-o.H/2)||S>x||m<O||u>M||I.push(o)}g++}var v=wpdSetFixed(e.X-e.W/2),D=wpdSetFixed(e.X+e.W/2),E=wpdSetFixed(e.Y-e.H/2);(h>wpdSetFixed(e.Y+e.H/2)||S<E||u<v||m>D)&&I.push(e);var C=[];const Y=5040;if(I.length<=7)C=permuteArrayOfArrays(I);else for(var b=0;b<Y;b++){var T=I.slice().sort((()=>Math.random()-.5));C.push(T)}var P=[];for(const e of C){var[j,N,F,R]=[p,c,f,s],H=0,w=0,y=0,A=0;for(const o of e)[j,N,F,R,H,w]=getChestOverlappedItemDimension(j,N,F,R,o),y+=H,A+=w;P.push({ItemW:F,ItemH:R,ItemX:j,ItemY:N,FinalWidthCrushPerc:y,FinalHeightCrush:A,Area:F*R})}var L=getObjectWithHighestValue(P,"Area");j=L.ItemX,N=L.ItemY,F=L.ItemW,R=L.ItemH;y=L.FinalWidthCrushPerc,A=L.FinalHeightCrush;if("Y"==r){if(y<=n&&A<=_&&"N"==a&&"N"==i)return o.W=F,o.X=j,o.WChanged="Y","W"==l?o.CrushHoriz=y:"H"==l?o.CrushVert=y:"D"==l&&(o.CrushD=y),o.H=R,o.Y=N,o.HChanged="Y","H"==d?o.CrushVert=A:"W"==d?o.CrushHoriz=A:"D"==d&&(o.CrushD=A),g_error_category="","Y";if("Y"==a||"Y"==i){const r=wpdSetFixed(f-f*(n/100)),g=wpdSetFixed(s-s*(_/100));return"N"==checkChestCrushedItemHit(o.X,o.Y,"Y"==a?r:f,"Y"==i?g:o.H,e,t)?("Y"==a&&(o.W=r,o.WChanged="Y","W"==l?o.CrushHoriz=n:"H"==l?o.CrushVert=n:"D"==l&&(o.CrushD=n)),"Y"==i&&(o.H=g,o.HChanged="Y","H"==d?o.CrushVert=_:"W"==d?o.CrushHoriz=_:"D"==d&&(o.CrushD=_)),g_error_category="","Y"):(g_error_category="W","N")}return g_error_category="W","N"}return g_error_category="","Y"}catch(e){error_handling(e)}}function downloadImage(e,o){logDebug("function : downloadImage; Start");try{const t=atob(e),_=new Array(t.length);for(let e=0;e<t.length;e++)_[e]=t.charCodeAt(e);const n=new Uint8Array(_),a=new Blob([n],{type:"image/jpeg"}),i=document.createElement("a");i.href=URL.createObjectURL(a),i.download=o,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(i.href),logDebug("function : downloadImage; End")}catch(e){throw console.log("error",e),error_handling(e),e}}async function downloadPOGCombineImage(e,o,t,_,n){try{logDebug("function : downloadPOGCombineImage; Start");var a=[],i=0,d=[],l=0,r=0;g_world=g_scene_objects[o].scene.children[2],animate_pog(o);var g=JSON.parse(JSON.stringify(g_pog_json)),s=JSON.parse(JSON.stringify(g_pog_json)),f=JSON.parse(JSON.stringify([g_pog_json[o]])),p=[],c=0;for(const e of s[o].ModuleInfo){if((void 0===e.ParentModule||null==e.ParentModule)&&(l=Math.max(l,e.H),r=Math.max(r,e.D),"Y"==g_pogcr_pdf_chest_split)){var I=0,u=wpdSetFixed(e.X-e.W/2),m=wpdSetFixed(e.X+e.W/2);for(const t of e.ShelfInfo){if("CHEST"==t.ObjType){var h=wpdSetFixed(t.X-t.W/2),S=wpdSetFixed(t.X+t.W/2);(u>h&&m<S||u>=h&&m<S||u<h&&m<S&&m>h||u>h&&m>S&&u<S)&&(t.MIndex=c,t.SIndex=I,p.push(t),f[0].ModuleInfo[c].ShelfInfo.splice(I,1),g_pog_json[o].ModuleInfo[c].ShelfInfo.splice(I,1))}I++}}c++}if("Y"==g_pogcr_pdf_chest_split){for(chest of p){var O="N",M=wpdSetFixed(chest.X-chest.W/2),x=wpdSetFixed(chest.X+chest.W/2),v=chest.ItemInfo,D=0;for(const e of f[0].ModuleInfo){if(void 0===e.ParentModule||null==e.ParentModule){var E=wpdSetFixed(e.X-e.W/2),C=wpdSetFixed(e.X+e.W/2),b=JSON.parse(JSON.stringify(chest));E>=M&&C<=x?(O="Y",b.W=e.W,b.X=e.X):E<=M&&C<=x&&C>M?(O="Y",b.W=wpdSetFixed(C-M),b.X=wpdSetFixed(M+b.W/2)):E>=M&&C>=x&&E<x&&(O="Y",b.W=wpdSetFixed(x-E),b.X=wpdSetFixed(E+b.W/2));var T=[],P=wpdSetFixed(b.X-b.W/2),j=wpdSetFixed(b.X+b.W/2);for(items of(module_no=chest.MIndex+1,v))items.X>=P&&items.X<=j&&(items.ModuleNo=module_no,T.push(items));"Y"==O&&(b.ItemInfo=T,f[0].ModuleInfo[D].ShelfInfo.push(b),g_pog_json[o].ModuleInfo[D].ShelfInfo.push(b),O="N")}D++}0}}for(const o of e){var N=f[0].ModuleInfo[o];N.MIndex=o,a.push(JSON.parse(JSON.stringify(N))),i+=N.W}var F=0,R=0;for(obj_mod of(await init_pdf(window.innerWidth,window.innerHeight,2,"Y","N"),a)){try{console.log("combine loop",g_world);var H=await clone_combine_pog(obj_mod.MIndex,F,g_show_item_label,t,_,o,R,i);console.log("returnval",H,g_renderer_pdf)}catch(e){throw console.log("error",e),e}R+=obj_mod.W,F++}await timeout(200);var w=[];(y={}).W=i,y.H=g_pog_json[o].H,w.push(y),w[0].ModuleInfo=a,i=0;var y,A=(y=get_min_max_xy_combine(w,0)).split("###");set_camera_z(g_camera_pdf,parseFloat(A[2]),parseFloat(A[3]),parseFloat(A[0]),parseFloat(A[1]),g_offset_z,parseFloat(A[4]),parseFloat(A[5]),!0,0),console.log("combine g_renderer_pdf",g_renderer_pdf,g_scene_pdf,g_camera_pdf),null!==g_renderer_pdf&&g_renderer_pdf.render(g_scene_pdf,g_camera_pdf),animate_pog_pdf(),console.log("inside",f,a,g_camera_pdf,g_scene_pdf.children.length,g_scene_pdf);var L=g_new_canvas.toDataURL("image/jpeg",n);console.log(" after  base64 ",getDateTime());var Y={Module:"COMBINE"};return Y.ImgData=L,d.push(Y),g_temp_desc="N",g_pog_json=g,render(o),d}catch(e){throw console.log("error",e),error_handling(e),e}}async function downloadPOGImage(){try{logDebug("function : downloadPOGImage; Start");var e=[];render(g_pog_index);var o,t=0,_=.5;"Y"==$v("P25_POGCR_ENHANCE_PDF_IMG")&&(_=parseFloat($v("P25_POGCR_PDF_IMG_ENHANCE_RATIO"))),reset_zoom();var n=[];set_pegid(g_pog_index);var a=JSON.parse(JSON.stringify(g_pog_json));if(await get_chest_split_details(g_pogcr_pdf_chest_split,g_pog_index),n=JSON.parse(JSON.stringify(g_pog_json)),"Y"==g_textbox_merge_pdf)n=await merge_textboxes_pdf(n,g_pog_index);var i=[...new Set(g_delete_details.map((e=>e.MIndex)))].sort();if(i.length>1&&"Y"==g_multiselect){for(const e of i)o=void 0===o?g_pog_json[g_pog_index].ModuleInfo[e].Module:o+","+g_pog_json[g_pog_index].ModuleInfo[e].Module;e=await downloadPOGCombineImage(i,g_pog_index,$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),_),g_mselect_drag="N",g_multiselect="N",g_delete_details.StartCanvas=g_pog_index}else if("undefined"!=typeof g_module_index&&-1!=g_module_index){var d=n[g_pog_index].ModuleInfo[g_module_index];if(o=g_pog_json[g_pog_index].ModuleInfo[g_module_index].Module,void 0===d.ParentModule||null==d.ParentModule){var l=$v("P25_POGCR_PDF_CANVAS_SIZE").split(":");await init_pdf(parseInt(l[0]),parseInt(l[1]),3+(.5==_?0:3*_),"N","Y");try{!1;if(t=0,!d.Module.includes(g_nodataModuleName))await create_scene(g_module_index,"Y","Y",1,"Y",$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),t,g_pog_index)}catch(e){error_handling(e)}var r=get_min_max_xy_module(d,0,d.W+t,d.H,d.X+t,n[g_pog_index].W,1).split("###"),[g,s]=set_camera_z_offside(g_camera_pdf,parseFloat(r[2]),parseFloat(r[3]),parseFloat(r[0]),parseFloat(r[1]),g_offset_z,0,parseFloat(r[5]),!0,g_pog_index);if(g_camera_pdf.position.x=parseFloat(r[2]),g_camera_pdf.position.y=parseFloat(r[3]),g_camera_pdf.position.z=g,null!==g_renderer_pdf&&(animate_pog_pdf(),g_renderer_pdf.render(g_scene_pdf,g_camera_pdf)),!d.Module.includes(g_nodataModuleName)){var f=await g_new_canvas.toDataURL("image/jpeg",_);(p={}).Module=d.Module,p.ImgData=f,e.push(p)}}g_pog_json=a}else if(-1==g_module_index){var p;f=(await get_full_canvas(g_pog_index,3)).toDataURL("image/jpeg",.9);(p={Module:"POG"}).ImgData=f,e.push(p)}const c=e[0].ImgData,I=new Image;I.src=c,I.onload=function(){var e=$v("P25_OPEN_POG_CODE");void 0!==o&&(e=e+"_"+o);const t=document.createElement("canvas");t.width=I.width,t.height=I.height;t.getContext("2d").drawImage(I,0,0);const[n,a]=cropCanvasToContent(t);downloadImage(n.toDataURL("image/jpeg",_).match(/,(.*)$/)[1],e+".jpeg"),async function(){const e=await new Promise((e=>function(e,o){const t=document.createElement("canvas");return t.width=e.width*o,t.height=e.height*o,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t}(n,.5).toBlob(e)));await navigator.clipboard.write([new ClipboardItem({"image/png":e})])}()},logDebug("function : downloadPOGImage; End")}catch(e){error_handling(e)}}function isShelfOverlapShelf(e,o,t,_,n,a,i,d){try{const l=Math.abs(wpdSetFixed(e-n))<wpdSetFixed(t/2+i/2),r=Math.abs(wpdSetFixed(o-a))<wpdSetFixed(_/2+d/2);return l&&r}catch(e){error_handling(e)}}function getAutofillModShelf(e,o,t,_,n){try{var a=wpdSetFixed(Math.min(e.x,o.x)),i=wpdSetFixed(Math.max(e.x,o.x)),d=wpdSetFixed(Math.max(e.y,o.y)),l=wpdSetFixed(Math.min(e.y,o.y)),r=[],g=[],s=0,f=0;for(const e of t[_].ModuleInfo){if(null==e.ParentModule){const o=wpdSetFixed(e.X-e.W/2),t=wpdSetFixed(e.X+e.W/2),_=wpdSetFixed(e.Y+e.H/2),n=wpdSetFixed(e.Y-e.H/2),g=Math.max(a,o),p=Math.min(i,t),c=Math.min(d,_),I=Math.max(l,n);if(g<p&&I<c){const a=p-g;a>s&&(s=a,r[0]={moduleInfo:e,dragStart:g,dragEnd:p,dragTop:c,dragBottom:I,modStart:o,modEnd:t,modTop:_,modBottom:n,modIdx:f})}}f++}if(f=0,r.length>0){for(const e of g_mod_block_list){const o=e.BlkModInfo[0];if(o.dragStart<r[0].dragEnd&&o.dragEnd>r[0].dragStart&&e.BlockDim.FinalTop>r[0].dragBottom&&e.BlockDim.FinalBtm<r[0].dragTop){if(o.dragEnd>r[0].dragStart&&o.dragEnd<r[0].dragEnd&&(r[0].dragStart=o.dragEnd),o.dragStart<r[0].dragEnd&&r[0].dragStart<o.dragStart&&(r[0].dragEnd=o.dragStart),r[0].dragStart>=o.dragStart&&r[0].dragEnd<=o.dragEnd)return[r=[],g=[]];g_DragMouseStart.x=r[0].dragStart,g_DragMouseEnd.x=r[0].dragEnd}}for(const e of r[0].moduleInfo.ShelfInfo){if("TEXTBOX"!=e.ObjType&&"DIVIDER"!=e.ObjType&&"BASE"!=e.ObjType&&"DIVIDER"!=e.ObjType){const o=wpdSetFixed(e.X-e.W/2),t=wpdSetFixed(e.X+e.W/2),_=wpdSetFixed(e.Y+e.H/2),n=wpdSetFixed(e.Y-e.H/2);if(a<t&&i>o&&d>n&&l<_){const _=Math.min(i,t)-Math.max(a,o);g.push({ShelfInfo:e,OverlapWidth:_,ShelfIdx:f})}}f++}}else r=[],g=[];return[r,g]}catch(e){error_handling(e)}}async function setAutofillBlock(e,o,t="N"){try{var _={},n=[],a=[],i=[],d=[],l={},r=$v("P25_BLK_NAME")+"_AFP";if("Y"==t){var g=[];for(const e of g_mod_block_list){(S={}).BlkColor=e.BlkColor,S.BlkName=e.BlkName,S.BlkRule=e.BlkRule,S.BlkFilters=e.BlockFilters.join(" AND "),S.OldBlkName=e.BlkName,e.BlkFilters=S.BlkFilters,g.push(S)}closeInlineDialog("block_details");await save_blk_dtl_coll(e,o,g)}d=o==r&&"U"==e?[]:[r],_.BlkName=r,_.BlkColor=$v("P25_BLK_COLOR"),_.BlkRule=$v("P25_BLK_RULE");var s=[],f=[],p=[];if("U"!==e){_.DragMouseStart=g_DragMouseStart,_.DragMouseEnd=g_DragMouseEnd,_.BlkModInfo=g_autofillModInfo,_.BlkShelfInfo=g_autofillShelfInfo;for(const e of g_autofillShelfInfo)e.ShelfInfo.BlkName=r,e.ShelfInfo.MIndex=g_autofillModInfo[0].modIdx,e.ShelfInfo.SIndex=e.ShelfIdx,s.push(e.ShelfInfo);f.push(g_autofillModInfo[0].modIdx),f.sort(),p=s}else{for(const e of g_mod_block_list)if(e.BlkName==o){p=e.g_delete_details,f=e.mod_index,_.DragMouseStart=e.DragMouseStart,_.DragMouseEnd=e.DragMouseEnd,_.BlkModInfo=e.BlkModInfo,_.BlkShelfInfo=e.BlkShelfInfo;break}for(const e of p)e.BlkName=_.BlkName;g_DragMouseStart=_.DragMouseStart,g_DragMouseEnd=_.DragMouseEnd,g_autofillModInfo=_.BlkModInfo,g_autofillShelfInfo=_.BlkShelfInfo}_.g_delete_details=p;var c=apex.region("block_filters").widget().interactiveGrid("getViews","grid").model;c.forEach((function(e){var o="object"==typeof c.getValue(e,"FILTER")?c.getValue(e,"FILTER").v:c.getValue(e,"FILTER"),t=c.getValue(e,"VALUE");if(i.push(o+"#"+t),""!==o){var _=o.split("-");a.push(_[0]),n.push(_[0]+" = "+("C"==_[1]?'"':"")+t+("C"==_[1]?'"':""))}}));for(const e of g_mod_block_list)d.push(e.BlkName);var I=findDuplicates(d),u=findDuplicates(a);if(I.length>0)alert(get_message("POGCR_BLK_DUP"));else if(u.length>0)alert(get_message("POGCR_DUP_REC_FOUND"));else if(!a.includes("SUBCLASS")||a.includes("CLASS")&&a.includes("DEPT"))if(a.includes("CLASS")&&!a.includes("DEPT"))alert(get_message("POGCR_DEPT_MANDATE"));else{_.BlockFilters=n,_.FilterVal=i,_.mod_index=f;let t=-1;if("U"==e){var m=0;for(const e of g_mod_block_list){if(e.BlkName==o){l=JSON.parse(JSON.stringify(e)),t=m;break}m++}}apex.region("block_filters").widget().interactiveGrid("getActions").set("edit",!1),apex.region("block_filters").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("block_filters").refresh(),clear_blinking();var h=await colorAutofillBlock(g_DragMouseStart,g_DragMouseEnd,f,$v("P25_BLK_COLOR"),r,e,l,g_pog_index);if(_.BlockDim=h,"U"==e&&t>-1?g_mod_block_list[t]=_:g_mod_block_list.push(_),closeInlineDialog("block_details"),"U"==e){var S={};g=[];for(const e of g_mod_block_list){if(e.BlkName!==r&&e.BlkName!==o)(S={}).BlkColor=e.BlkColor,S.BlkName=e.BlkName,S.BlkRule=e.BlkRule,S.BlkFilters=e.BlockFilters.join(" AND "),S.OldBlkName=e.BlkName,e.BlkFilters=S.BlkFilters,g.push(S);else if(e.BlkName==o||e.BlkName==r){(S={}).BlkColor=$v("P25_BLK_COLOR"),S.BlkName=r,S.BlkRule=$v("P25_BLK_RULE"),S.BlkFilters=n.join(" AND "),S.OldBlkName=o,e.BlkFilters=S.BlkFilters,g.push(S)}}await save_blk_dtl_coll(e,o,g)}else if("Y"==e){g=[];for(const e of g_mod_block_list){(S={}).BlkColor=e.BlkColor,S.BlkName=e.BlkName,S.BlkRule=e.BlkRule,S.BlkFilters=e.BlockFilters.join(" AND "),e.BlkFilters=S.BlkFilters,g.push(S)}await save_blk_dtl_coll(e,o,g)}else if("A"==e){g=[];for(const e of g_mod_block_list){(S={}).BlkColor=e.BlkColor,S.BlkName=e.BlkName,S.BlkRule=e.BlkRule,S.BlkFilters=e.BlockFilters.join(" AND "),e.BlkFilters=S.BlkFilters,g.push(S)}await save_blk_dtl_coll(e,o,g)}}else alert(get_message("POGCR_DEPT_CLASS_MANDATE"))}catch(e){error_handling(e)}}async function colorAutofillBlock(e,o,t,_,n,a,i,d,l){try{var r=parseInt($v("P25_POGCR_BLK_TXT_SIZE")),g=g_autofillModInfo[0].dragBottom,s=g_autofillModInfo[0].dragTop,f=g_autofillModInfo[0].modTop,p=g_autofillModInfo[0].modBottom,c=g_pog_json[d].ModuleInfo[t[0]].ShelfInfo,I=-1,u=-1;if("U"!==a){I=get_below_shelf(c,t[0],g,d);var m=(u=get_above_shelf(c,t[0],s,f,d))-I,h=g_autofillModInfo[0].dragEnd-g_autofillModInfo[0].dragStart,S=g_autofillModInfo[0].dragStart+(g_autofillModInfo[0].dragEnd-g_autofillModInfo[0].dragStart)/2-g_pog_json[d].ModuleInfo[t[0]].X;if(g_pog_json[d].ModuleInfo[t[0]].Y<I){var O=I-g_pog_json[d].ModuleInfo[t[0]].Y;calc_y=O+m/2}else{O=g_pog_json[d].ModuleInfo[t[0]].Y-I;calc_y=0-O+m/2}}else S=i.BlockDim.CalcX,calc_y=i.BlockDim.CalcY,h=i.BlockDim.BlkWidth,m=i.BlockDim.BlkHeight,u=i.BlockDim.FinalTop,I=i.BlockDim.FinalBtm;var M=parseInt(_.replace("#","0x"),16);new THREE.Color(M);n=n.slice(0,-4),console.log("val",e,o,t[0],_,n),console.log("calc_height",h,m,calc_y,u,f,I,p);let D=dcText(n,r,0,M,h,m,"N","N","Arial","",r,0,-1,4);var x=g_world.getObjectById(g_pog_json[d].ModuleInfo[t[0]].MObjID);x.add(D),D.uuid=n+"_AFP",D.material.opacity=.5,D.position.x=S,D.position.y=calc_y,D.position.z=.009,render(d),g_delete_details=[],g_mselect_drag="N";var v={};if(v.CalcX=S,v.CalcY=calc_y,v.CalcZ=.009,v.BlkWidth=h,v.BlkHeight=m,v.ColorObj=x,v.FinalTop=u,v.FinalBtm=I,"Y"==l){for(shelfs of(g_DragMouseStart.x=e.x,g_DragMouseStart.y=e.y,g_DragMouseEnd.x=o.x,g_DragMouseEnd.y=o.y,await get_multiselect_obj(d),i.g_delete_details=[],g_delete_details))i.g_delete_details.push(shelfs);g_delete_details=[]}return v}catch(e){error_handling(e)}}function validateShelfWithFixedItem(e,o,t,_){try{var n=wpdSetFixed(e.X-e.W/2),a=wpdSetFixed(e.X+e.W/2),i=[],d="N",l=[],r=0;for(const e of _)e.IIndex=r,"Y"==e.Fixed?(l.push(e),0!==r&&(i.push(l),(l=[]).push(e)),d="Y"):(l.push(e),d="N"),r++;for(splitShelfItems of("N"==d&&i.push(l),i)){var g=0,s=n,f=a;for(item of splitShelfItems)"Y"==item.Fixed&&(0==g&&(s=wpdSetFixed(item.X+item.W/2)),g==splitShelfItems.length-1&&(f=wpdSetFixed(item.X-item.W/2))),g++;var p=f-s;for(item of splitShelfItems)"N"!=item.Fixed||void 0!==item.BottomObjID&&""!==item.BottomObjID||(p=item.BHoriz>1&&"F"==o?wpdSetFixed(p-(item.W+t*(item.BHoriz-1))):wpdSetFixed(p-item.W));if(p<0)return!0}return!1}catch(e){error_handling(e)}}window.addEventListener("load",(function(){for(var e=document.querySelectorAll(".disclosure-nav"),o=[],t=0;t<e.length;t++)o[t]=new DisclosureNav(e[t]);var _=document.getElementById("arrow-behavior-switch");_&&_.addEventListener("change",(function(){for(var e=_.checked,t=0;t<o.length;t++)o[t].updateKeyControls(e)})),o.forEach(((o,t)=>{for(var _=e[t].querySelectorAll('[href="#mythical-page-content"]'),n=document.getElementById("mythical-page-heading"),a=0;a<_.length;a++)_[a].href="#mythical-page-content",_[a].addEventListener("click",(e=>{var o=e.target.innerText;n.innerText=o;for(var t=0;t<_.length;t++)_[t].removeAttribute("aria-current");e.target.setAttribute("aria-current","page")}))}))}),!1);