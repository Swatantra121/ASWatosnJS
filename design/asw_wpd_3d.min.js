function add_base_3d(e,o,t,n,i,a,r,s){try{return new Promise((function(l,d){g_pog_base=new THREE.Mesh(new THREE.BoxGeometry(o,t,n),new THREE.MeshStandardMaterial({color:i}));add_wireframe_3d(g_pog_base);g_pog_base.position.x=a,g_pog_base.position.y=r,g_pog_base.position.z=s,g_pog_base.uuid=e,g_world.add(g_pog_base),g_pog_base.castShadow=!0,render(),l("SUCCESS")}))}catch(e){error_handling(e)}}function create_final_module_3d(e,o,t,n,i,a,r,s,l,d,f,g){try{return new Promise((function(h,p){if(g_module=new THREE.Mesh(new THREE.BoxGeometry(o,t,n),new THREE.MeshStandardMaterial({color:i})),s>0||d>0){var _=add_dots_to_object_3d(o-2*g_json[0].ModuleInfo[g].NotchW,t,n,r,s,l,d,g_module,"MODULE","",g);_.position.x=f,_.position.y=a,_.position.z=0,_.uuid=e,g_json[0].ModuleInfo[g].NotchW>0&&add_notches_3d("MODULE"+g+"_NOTCHES",g_json[0].ModuleInfo[g].NotchW,t,n,g_json[0].ModuleInfo[g].NotchStart,g_json[0].ModuleInfo[g].NotchSpacing,i,o,g,_);add_wireframe_3d(_);g_world.add(_),_.castShadow=!0,_.receiveShadow=!0,0==g?g_module_obj_array.splice(g,g+1):g_module_obj_array.splice(g,1),g_module_obj_array.push(_)}else{g_module.position.x=f,g_module.position.y=a,g_module.position.z=0,g_module.uuid=e,g_json[0].ModuleInfo[g].NotchW>0&&add_notches_3d("MODULE"+g+"_NOTCHES",g_json[0].ModuleInfo[g].NotchW,t,n,g_json[0].ModuleInfo[g].NotchStart,g_json[0].ModuleInfo[g].NotchSpacing,i,o,g,g_module);add_wireframe_3d(g_module);g_world.add(g_module),g_module.castShadow=!0,g_module.receiveShadow=!0,0==g?g_module_obj_array.splice(g,g+1):g_module_obj_array.splice(g,1),g_module_obj_array.push(g_module)}render(),h("SUCCESS")}))}catch(e){error_handling(e)}}function add_notches_3d(e,o,t,n,i,a,r,s,l,d){try{g_notches1=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshStandardMaterial({color:r})),g_notches2=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshStandardMaterial({color:r})),add_wireframe_3d(g_notches1),add_wireframe_3d(g_notches2);var f=0-parseFloat(o)/2,g=0-parseFloat(t)/2+parseFloat(i),h=0+parseFloat(o)/2,p=0+parseFloat(t)/2,_=g,m=[];m.push(_);for(var c=0;c<1e3&&(_+=parseFloat(a))<p;c++)m.push(_);var u=[];for(c=0;c<m.length;c++)u.push(new THREE.Vector3(f,m[c],0)),u.push(new THREE.Vector3(h,m[c],0));let n=(new THREE.BufferGeometry).setFromPoints(u);var E=new THREE.LineBasicMaterial({color:0}),I=new THREE.LineSegments(n,E),w=new THREE.LineSegments(n,E);I.position.z=.001,w.position.z=.001,g_notches1.add(I),g_notches2.add(w);var T=0-parseFloat(s)/2+parseFloat(o)/2,R=0-parseFloat(s)/2+(parseFloat(s)-parseFloat(o)/2);g_notches1.position.x=T,g_notches1.position.y=0,g_notches1.position.z=.001,g_notches2.position.x=R,g_notches2.position.y=0,g_notches2.position.z=.001,d.add(g_notches1),d.add(g_notches2),render(),g_notches1.uuid=e+1,g_notches2.uuid=e+2}catch(e){error_handling(e)}}function add_pegboard_3d(e,o,t,n,i,a,r,s,l,d,f,g,h){try{var p;p=parseFloat(g_json[0].ModuleInfo[h].ShelfInfo.length)-1,g_pegboard=new THREE.Mesh(new THREE.BoxGeometry(o,t,n),new THREE.MeshStandardMaterial({color:i}));var _=add_dots_to_object_3d(o,t,n,l,d,f,g,g_pegboard,"PEGBOARD",p,h);_.position.x=a,_.position.y=r,_.position.z=parseFloat(s),g_pegboard.uuid=e;add_wireframe_3d(_);return g_world.add(_),_.castShadow=!0,render(),g_dblclick_opened="N","SUCESS"}catch(e){error_handling(e)}}function dcText(e,o,t,n,a,r,s,l,d,f,g){try{const[g,R]=get_visible_size(.012,a,r,document.getElementById("scenecanvas"),g_camera);var h=document.getElementById("ruler");h.style.fontFamily=d,h.style.fontWeight=f,h.style.fontSize=o+"px",h.style.position="absolute",h.innerHTML=e;h.offsetWidth;var p=o,_=document.createElement("canvas"),m=_.getContext("2d");_.width=g,_.height=R,null==n&&null===n||(m.fillStyle="#"+n.toString(16).padStart(6,"0"),m.fillRect(0,0,g,R)),m.textAlign="center",m.textBaseline="middle",m.fillStyle="#"+t.toString(16).padStart(6,"0"),m.font=f+" "+p+"px "+d;var c=m.measureText(e).width;if("Y"==l&&c>g){var u=50;for(i=50;i>=0;i--){var E=document.createElement("canvas"),I=E.getContext("2d");if(E.width=g,E.height=R,null==n&&null===n||(I.fillStyle="#"+n.toString(16).padStart(6,"0"),I.fillRect(0,0,g,R)),I.textAlign="center",I.textBaseline="middle",I.fillStyle="#"+t.toString(16).padStart(6,"0"),I.font=f+" "+i+"px "+d,I.measureText(e).width+5<=g){u=i;break}}p=u<50?u:p}null==n&&null===n||(m.fillStyle="#"+n.toString(16).padStart(6,"0"),m.fillRect(0,0,g,R)),m.textAlign="center",m.textBaseline="middle",m.fillStyle="#"+t.toString(16).padStart(6,"0"),m.font=f+" "+p+"px "+d;c=m.measureText(e).width,"Y"==s&&c>g?wrapText(m,e,g/2,p,g,25):m.fillText(e,g/2,R/2);var w=new THREE.CanvasTexture(_);w.minFilter=THREE.LinearFilter,geometry=new THREE.PlaneGeometry(a,r);var T=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:w,transparent:!0,opacity:1});return T.map.minFilter=THREE.LinearFilter,new THREE.Mesh(geometry,T)}catch(e){error_handling(e)}}function add_text_box_with_image_3d(e,o,t,n,i,a,r,s,l,d,f,g,h,p,_,m,c,u,E,I,w){try{var T=new Image,R=new THREE.Texture(T);T.onload=()=>{R.needsUpdate=!0},T.src="data:image/png;base64,"+g_json[0].ModuleInfo[d].ShelfInfo[w].TextImg,geometry=new THREE.PlaneGeometry(t,n);var S=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:R,transparent:!0,opacity:1}),H=new THREE.Mesh(geometry,S);0===m&&0===c||(c=c>0?0-c:-c,H.rotateY(m*Math.PI/180),0==m?H.rotateX(c/2*Math.PI/180):H.rotateX(c*Math.PI/180),H.updateMatrix()),H.uuid=e;add_wireframe_3d(H);return g_world.add(H),H.position.x=r,H.position.y=s,H.position.z=parseFloat(l),animate_pog(0),render(),H.id}catch(e){error_handling(e)}}function add_text_box_3d(e,o,t,n,i,a,r,s,l,d,f,g,h,p,_,m,c,u,E,I){try{if(console.log("textbox",e,o,t,n,i,a,r,s,l,d,f,g,h,p,_,m,c,u,E,I),null==hexToRgb(_))var w=parseInt("FF",16),T=parseInt("FF",16),R=parseInt("FF",16);else w=hexToRgb(_).r,T=hexToRgb(_).r,R=hexToRgb(_).g;var S;shelf_cnt=parseFloat(g_json[0].ModuleInfo[d].ShelfInfo.length)-1,S=.299*w+.587*T+.114*R>186?0:16777215,mesh=dcText(f,E,S,g,t,n,h,p,u,I,E),(m>0||c>0||m<0||c<0)&&(c=c>0?0-c:-c,g_slope=c,mesh.rotateY(m*Math.PI/180),mesh.rotateX(c*Math.PI/180)),mesh.position.x=r,mesh.position.y=s,mesh.position.z=parseFloat(l);add_wireframe_3d(mesh);return g_world.add(mesh),mesh.castShadow=!0,console.log("mesh",mesh),animate_pog(0),render(),parseInt(mesh.id)}catch(e){error_handling(e)}}function add_rod_3d(e,o,t,n,i,a,r,s,l,d){try{var f=[],g=[];"undefined"!=typeof g_module_width&&""!=g_module_width||(g_module_width=parseFloat(g_json[0].ModuleInfo[d].W)),parseFloat(g_json[0].ModuleInfo[d].ShelfInfo.length)-1,g_shelf=new THREE.Mesh(new THREE.BoxGeometry(t,n,i),new THREE.MeshStandardMaterial({color:a})),f.push(0-t/2),f.push(t/2),f.push(0-t/2),f.push(t/2),g.push(0-n/2),g.push(n/2),g.push(n/2),g.push(0-n/2);var h=[];h.push(new THREE.Vector3(f[0],g[0],0)),h.push(new THREE.Vector3(f[1],g[1],0)),h.push(new THREE.Vector3(f[2],g[2],0)),h.push(new THREE.Vector3(f[3],g[3],0));let o=(new THREE.BufferGeometry).setFromPoints(h);var p=new THREE.LineBasicMaterial({color:14293787}),_=new THREE.LineSegments(o,p),m=new THREE.LineSegments(o,p);_.position.z=i/2+.001,m.position.z=i/2+.001,g_shelf.add(_),g_shelf.add(m);add_wireframe_3d(g_shelf);return g_shelf.position.x=r,g_shelf.position.y=s,g_shelf.position.z=parseFloat(l),g_shelf.uuid=e,g_world.add(g_shelf),g_shelf.castShadow=!0,render(),"SUCCESS"}catch(e){error_handling(e)}}function add_shelf_3d(e,o,t,n,i,a,r,s,l,d,f,g,h){try{"undefined"!=typeof g_module_width&&""!=g_module_width||(g_module_width=parseFloat(g_json[0].ModuleInfo[d].W)),parseFloat(g_json[0].ModuleInfo[d].ShelfInfo.length)-1,g_shelf=new THREE.Mesh(new THREE.BoxGeometry(t,n,i),new THREE.MeshStandardMaterial({color:a})),(f>0||g>0||f<0||g<0)&&(g=g>0?0-g:-g,g_slope=g,g_shelf.rotateY(f*Math.PI/180),g_shelf.rotateX(g*Math.PI/180));add_wireframe_3d(g_shelf);return g_shelf.position.x=r,g_shelf.position.y=g<0?s+parseFloat(g_json[0].ModuleInfo[d].ShelfInfo[h].ShelfRotateHeight)/2:g>0?s-parseFloat(g_json[0].ModuleInfo[d].ShelfInfo[h].ShelfRotateHeight)/2:s,g_shelf.position.z=parseFloat(l),g_shelf.uuid=e,g_world.add(g_shelf),g_shelf.castShadow=!0,g_shelf.receiveShadow=!0,render(),g_json[0].ModuleInfo[d].ShelfInfo[h].SObjID=g_shelf.id,"SUCCESS"}catch(e){error_handling(e)}}async function add_items_with_image_3d(e,o,t,n,i,a,r,s,l,d,f,g,h,_,m,c,u,E,I,w){try{return console.log("items",e,o,t,n,i,a,r,s,l,d,f,g,h,_,m,c,u,E,I,w),new Promise((function(m,T){var R=g_json[0].ModuleInfo[l].ShelfInfo[d].ItemInfo[f].NVal,S=parseInt(i.replace("#","0x"),16),H=new THREE.Color(S),M=g_json[0].ModuleInfo[l].ShelfInfo[d].Rotation,j=g_json[0].ModuleInfo[l].ShelfInfo[d].Slope,y=g_json[0].ModuleInfo[l].ShelfInfo[d].ItemInfo[f].Orientation,x=g_orientation_json[y],v=x.split("###");console.log("details",x);var F=get_orientation_list(v[0]),b=g_json[0].ModuleInfo[l].ShelfInfo[d].ItemInfo[f],B=g_world.getObjectById(b.ObjID);g_world.remove(B),console.log("rotation",M,j);var O=b.CapStyle,[D,V,z,C,W,P]=get_new_orientation_dim(b.Orientation,b.OW,b.OH,b.OD),N=($v("pFlowId"),$v("pFlowStepId"),$v("pInstance"),(new Date).getTime(),"N"),G=-1,L=-1,X=-1,Y=-1;console.log("g_ItemImages",F);var U=0;if(void 0!==F)for(const e of g_ItemImages)_==e.Item&&v[0]==e.Orientation&&null!==e.ItemImage?(N="Y",G=U):_==e.Item&&F[0]==e.Orientation&&null!==e.ItemImage&&-1==L?L=U:_==e.Item&&F[1]==e.Orientation&&null!==e.ItemImage&&-1==X?X=U:_==e.Item&&F[2]==e.Orientation&&null!==e.ItemImage&&-1==Y&&(Y=U),U++;else for(const e of g_ItemImages)_==e.Item&&v[0]==e.Orientation&&null!==e.ItemImage&&(N="Y",G=U),U++;if(console.log("img_index",G,N),"Y"==N){var A=new Image,Z=new Image,$=new Image,J=new Image,q=new THREE.Texture(A),K=new THREE.Texture(Z),Q=new THREE.Texture($),ee=new THREE.Texture(J);A.onload=()=>{q.needsUpdate=!0},Z.onload=()=>{K.needsUpdate=!0},$.onload=()=>{Q.needsUpdate=!0},J.onload=()=>{ee.needsUpdate=!0},A.src="data:image/png;base64,"+g_ItemImages[G].ItemImage,-1!=L&&(Z.src="data:image/png;base64,"+g_ItemImages[L].ItemImage,console.log("imagel.src",Z.src)),-1!=X&&($.src="data:image/png;base64,"+g_ItemImages[X].ItemImage),-1!=Y&&(J.src="data:image/png;base64,"+g_ItemImages[Y].ItemImage);var oe=new THREE.MeshBasicMaterial({color:H});if(""!=Z.src)var te=new THREE.MeshBasicMaterial({color:16777215,map:K});else te=oe;if(""!=$.src)var ne=new THREE.MeshBasicMaterial({color:16777215,map:Q});else ne=oe;if(""!=J.src){console.log("Imager.src is null");var ie=new THREE.MeshBasicMaterial({color:16777215,map:ee})}else ie=oe;const _=new THREE.MeshBasicMaterial({color:16777215,map:q});if("Y"==w){console.log("borderMaterial",oe);var ae=[te,ne,ie,oe,_,oe]}else ae=[oe,oe,oe,oe,_,oe];var re=new THREE.BoxGeometry(o,t,n);if(0!==nvl(M)||0!==nvl(j)){items=new THREE.Mesh(re,ae),0==R&&(q.wrapS=THREE.RepeatWrapping,q.wrapT=THREE.RepeatWrapping,90==c||270==c?q.repeat.set(h,g):q.repeat.set(g,h),90==c?c=270:270==c&&(c=90),q.rotation=c*Math.PI/180);var se=g_world.getObjectById(g_json[0].ModuleInfo[l].ShelfInfo[d].SObjID);"N"==u&&(a=0-(g_json[0].ModuleInfo[l].ShelfInfo[d].W/2-o/2-g_json[0].ModuleInfo[l].ShelfInfo[d].ItemInfo[f].Distance),r=g_json[0].ModuleInfo[l].ShelfInfo[d].H/2+t/2,s=g_json[0].ModuleInfo[l].ShelfInfo[d].D/2-n/2),items.applyMatrix4((new THREE.Matrix4).makeTranslation(a,r,s)),g_scene.updateMatrixWorld(),items.matrixAutoUpdate=!1,items.applyMatrix4(se.matrix)}else{if(q.wrapS=THREE.RepeatWrapping,q.wrapT=THREE.RepeatWrapping,K.wrapT=THREE.RepeatWrapping,K.wrapS=THREE.RepeatWrapping,Q.wrapT=THREE.RepeatWrapping,Q.wrapS=THREE.RepeatWrapping,ee.wrapT=THREE.RepeatWrapping,ee.wrapS=THREE.RepeatWrapping,0==R&&"0"==O&&(90==c||270==c?q.repeat.set(h,g):(q.repeat.set(g,h),K.repeat.set(E,h),Q.repeat.set(E,h),ee.repeat.set(1,E))),90==c?c=270:270==c&&(c=90),q.rotation=c*Math.PI/180,console.log("cap_style",O),"0"==O||void 0===O)items=new THREE.Mesh(re,ae);else{S=parseInt(i.replace("#","0x"),16),H=new THREE.Color(S);items=new THREE.Mesh(new THREE.BoxGeometry(o,t,n),new THREE.MeshBasicMaterial({color:H}));var le=[],de=0,fe=(b=g_json[0].ModuleInfo[l].ShelfInfo[d].ItemInfo[f],h+g_json[0].ModuleInfo[l].ShelfInfo[d].ItemInfo[f].CapCount),ge=0,he=g_json[0].ModuleInfo[l].ShelfInfo[d].ItemInfo[f].OD,pe=h,_e=n/2+1e-4*g_json[0].ModuleInfo[l].ShelfInfo[d].ItemInfo[f].CapCount;for(p=0;p<fe;p++){de=0;var me=-1;if(0==p)ge=-b.H/2+V,me=-b.H/2+V/2,pe-=1;else if(pe>0)me=ge+V/2,ge+=V,pe-=1;else{var ce=ge+he;me=ce-V/2,ge=ce,_e-=1e-4}for(k=0;k<g;k++){var ue=new THREE.BoxGeometry(D,V,.001),Ee=new THREE.MeshBasicMaterial({map:q,transparent:!0});le.push(new THREE.Mesh(ue,Ee)),items.add(le[le.length-1]),0==k?(de=-b.W/2+D,le[le.length-1].position.x=-b.W/2+D/2):(le[le.length-1].position.x=de+D/2,de+=D),le[le.length-1].position.y=me,le[le.length-1].position.z=_e}}}items.position.x=a,items.position.z=s,items.position.y=r}if(items.uuid=e,items.ImageExists="Y",g_world.add(items),items.castShadow=!0,I==e){g_intersected.push(items);highlightProduct(items,4,o,t,n,s)}animate_pog(0),render(),console.log("imag item",items),m(items.id)}else{S=parseInt(i.replace("#","0x"),16),H=new THREE.Color(S);if(items=new THREE.Mesh(new THREE.BoxGeometry(o,t,n),new THREE.MeshStandardMaterial({color:H})),0!==M||0!==j){se=g_world.getObjectById(g_json[0].ModuleInfo[l].ShelfInfo[d].SObjID);"N"==u&&(a=0-(g_json[0].ModuleInfo[l].ShelfInfo[d].W/2-o/2-g_json[0].ModuleInfo[l].ShelfInfo[d].ItemInfo[f].Distance),r=g_json[0].ModuleInfo[l].ShelfInfo[d].H/2+t/2,s=g_json[0].ModuleInfo[l].ShelfInfo[d].D/2-n/2),items.applyMatrix4((new THREE.Matrix4).makeTranslation(a,r,s)),g_scene.updateMatrixWorld(),items.matrixAutoUpdate=!1,items.applyMatrix4(se.matrix)}else items.position.x=a,items.position.z=s,items.position.y=r;if(items.uuid=e,items.ImageExists="N",I==e){g_intersected.push(items);highlightProduct(items,4,o,t,n,s)}g_world.add(items),items.castShadow=!0,add_item_borders_3d(l,d,f,items,o,t),render(),m(items.id)}}))}catch(e){error_handling(e)}}function add_items_3d(e,o,t,n,i,a,r,s,l,d,f,g){try{var h=parseInt(i.replace("#","0x"),16),p=new THREE.Color(h);items=new THREE.Mesh(new THREE.BoxGeometry(o,t,n),new THREE.MeshStandardMaterial({color:p})),0!==g&&items.rotateY(g*Math.PI/180),items.position.x=a,items.position.z=s,items.position.y=r,items.uuid=e,items.ImageExists="N";add_wireframe_3d(items);return g_world.add(items),render(),items.id}catch(e){error_handling(e)}}function add_items_prom_3d(e,o,t,n,i,a,r,s,l,d,f,g){try{return new Promise((function(h,p){var _=parseInt(i.replace("#","0x"),16),m=new THREE.Color(_),c=g_json[0].ModuleInfo[l].ShelfInfo[d].Rotation,u=g_json[0].ModuleInfo[l].ShelfInfo[d].Slope;if(0!==nvl(c)||0!==nvl(u)){items=new THREE.Mesh(new THREE.BoxGeometry(o,t,n),new THREE.MeshBasicMaterial({color:m}));var E=g_world.getObjectById(g_json[0].ModuleInfo[l].ShelfInfo[d].SObjID);a=0-(g_json[0].ModuleInfo[l].ShelfInfo[d].W/2-o/2-g_json[0].ModuleInfo[l].ShelfInfo[d].ItemInfo[f].Distance),r=g_json[0].ModuleInfo[l].ShelfInfo[d].H/2+t/2,s=g_json[0].ModuleInfo[l].ShelfInfo[d].D/2-n/2,g_json[0].ModuleInfo[l].ShelfInfo[d].ItemInfo[f].RotationX=a,g_json[0].ModuleInfo[l].ShelfInfo[d].ItemInfo[f].RotationY=r,g_json[0].ModuleInfo[l].ShelfInfo[d].ItemInfo[f].RotationZ=s,items.applyMatrix4((new THREE.Matrix4).makeTranslation(a,r,s)),g_scene.updateMatrixWorld(),items.matrixAutoUpdate=!1,items.applyMatrix4(E.matrix)}else items=new THREE.Mesh(new THREE.BoxGeometry(o,t,n),new THREE.MeshStandardMaterial({color:m})),items.position.x=a,items.position.z=s,items.position.y=r;if(items.uuid=e,g==e){g_intersected.push(items);highlightProduct(items,4,o,t,n,s)}else add_wireframe_3d(items);items.ImageExists="N",g_world.add(items),items.castShadow=!0,render(),h(items.id)}))}catch(e){error_handling(e)}}function add_item_borders_3d(e,o,t,n,a,r){try{horiz_facing=g_json[0].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].BHoriz,vert_facing=g_json[0].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].BVert;var s=g_json[0].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].ItemNesting,l=g_json[0].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].NVal,d=g_json[0].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].CapStyle,f=g_json[0].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].CapCount,g=g_json[0].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OH,h=g_json[0].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].OW,p=g_json[0].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].D,_=(g_json[0].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].RH,[]),m=[],c="N",u=0,E=0,I=0,w=0-parseFloat(a)/2,T=0-parseFloat(r)/2,R=0+parseFloat(a)/2,S=0+parseFloat(r)/2,H=(g_json[0].ModuleInfo[e].ShelfInfo[o].D,[]);if(Show_Depthfacing(e,o,t,n,a,r),(l>0||l<0)&&(vert_facing>1||horiz_facing>1)){if(l<0&&(l*=-1,c="Y"),"H"==s){for("N"==c?(E=T+g,_.push(E)):E=T,i=1;i<vert_facing&&(E+=parseFloat(l))<S;i++)_.push(E);for(i=0;i<_.length;i++)H.push(new THREE.Vector3(w,_[i],0)),H.push(new THREE.Vector3(R,_[i],0));if(horiz_facing>1){u=a/horiz_facing;var M=w;for(i=1;i<horiz_facing&&(M+=parseFloat(u))<S;i++)m.push(M);for(i=0;i<m.length;i++)H.push(new THREE.Vector3(m[i],T,0)),H.push(new THREE.Vector3(m[i],S,0))}}else if("W"==s){for("N"==c?(E=w+h,m.push(E)):E=w,i=1;i<horiz_facing&&(E+=parseFloat(l))<R;i++)m.push(E);for(i=0;i<m.length;i++)H.push(new THREE.Vector3(m[i],T,0)),H.push(new THREE.Vector3(m[i],S,0));if(vert_facing>1){for(I=r/vert_facing,E=T,i=1;i<vert_facing&&(E+=parseFloat(I))<S;i++)_.push(E);for(i=0;i<_.length;i++)H.push(new THREE.Vector3(w,_[i],0)),H.push(new THREE.Vector3(R,_[i],0))}}}else if("0"!==d){if("1"==d){for(E=T,i=1;i<=vert_facing&&(E+=parseFloat(g))<S;i++)_.push(E);for(i=0;i<_.length;i++)H.push(new THREE.Vector3(w,_[i],0)),H.push(new THREE.Vector3(R,_[i],0))}else if("2"==d){for(E=T,i=1;i<=vert_facing;i++)E+=g,_.push(E);for(i=1;i<f&&(E+=parseFloat(p))<S;i++)_.push(E);for(i=0;i<_.length;i++)H.push(new THREE.Vector3(w,_[i],0)),H.push(new THREE.Vector3(R,_[i],0))}else if("3"==d){for(E=T+g,_.push(E),i=1;i<f&&(E+=parseFloat(p))<S;i++)_.push(E);for(i=0;i<_.length;i++)H.push(new THREE.Vector3(w,_[i],0)),H.push(new THREE.Vector3(R,_[i],0))}if(horiz_facing>1){u=a/horiz_facing;M=w;for(i=1;i<horiz_facing&&(M+=parseFloat(u))<S;i++)m.push(M);for(i=0;i<m.length;i++)H.push(new THREE.Vector3(m[i],T,0)),H.push(new THREE.Vector3(m[i],S,0))}}else{if(vert_facing>1){for(I=r/vert_facing,E=T,i=1;i<vert_facing;i++)E+=parseFloat(I),_.push(E);for(i=0;i<_.length;i++)H.push(new THREE.Vector3(w,_[i],0)),H.push(new THREE.Vector3(R,_[i],0))}if(horiz_facing>1){u=a/horiz_facing;M=w;for(i=1;i<horiz_facing;i++)M+=parseFloat(u),m.push(M);for(i=0;i<m.length;i++)H.push(new THREE.Vector3(m[i],T,0)),H.push(new THREE.Vector3(m[i],S,0))}}let x=(new THREE.BufferGeometry).setFromPoints(H);var j=new THREE.LineBasicMaterial({color:0}),y=new THREE.LineSegments(x,j);y.position.z=p/2,n.add(y)}catch(e){error_handling(e)}}function get_canvas_camera(e){try{return g_camera}catch(e){error_handling(e)}}async function get_img_indexeddb(){const e=indexedDB.open("myDatabase",2);var o,t;e.onsuccess=n=>{console.log("success 1"),o=e.result,function(){const e=o.transaction("myDatabaseStore","readwrite");e.oncomplete=e=>{console.log("complete")},e.onerror=e=>{console.log("error")};const n=e.objectStore("myDatabaseStore").get("ImageDetail");n.onsuccess=e=>{console.log("success",n.result),t=n.result,g_ItemImages=t.ImgData}}()}}async function recreate_image_items(e,o,t){try{var i=0;console.log("pPOGJSON[0].ModuleInfo",o[0].ModuleInfo);var a=o[0].ModuleInfo;for(const _ of a){if((void 0===_.ParentModule||null==_.ParentModule)&&_.ShelfInfo.length>0){j=0;for(const a of _.ShelfInfo){if("BASE"!==a.ObjType&&"NOTCH"!==a.ObjType&&"DIVIDER"!==a.ObjType&&"TEXTBOX"!==a.ObjType){n=0;for(const d of a.ItemInfo){if("DIVIDER"!==d.Item){var r=t.getObjectById(d.ObjID);if(t.remove(r),"Y"==e&&3!=d.MerchStyle)var s=g_orientation_json[g_json[0].ModuleInfo[i].ShelfInfo[j].ItemInfo[n].Orientation].split("###"),l=await add_items_with_image_3d(d.ItemID,d.W,d.H,d.D,d.Color,d.X,d.Y,d.Z,i,j,n,d.BHoriz,d.BVert,d.Item,parseInt(s[0]),parseInt(s[1]),"N",d.BaseD);else l=await add_items_prom_3d(d.ItemID,d.W,d.H,d.D,d.Color,d.X,d.Y,d.Z,i,j,n);if(o[0].ModuleInfo[i].ShelfInfo[j].ItemInfo[n].ObjID=l,"N"==e){r=t.getObjectById(l);"N"==d.Status?(r.BorderColour=g_status_error_color,r.Status="N",r.WireframeObj.material.color.setHex(r.BorderColour)):r.BorderColour=0}else"N"==d.Status?(r.BorderColour=g_status_error_color,r.Status="N"):void 0!==r&&(r.BorderColour=0)}n+=1}if(animate_pog(0),"SHELF"==a.ObjType)reset_top_bottom_objects(i,j,t,"N",o)}else if(""!==a.TextImg&&void 0!==a.TextImg&&"TEXTBOX"==a.ObjType&&null!==a.TextImg){var d=parseInt(a.Color.replace("#","0x"),16),f=new THREE.Color(d);if("#"==a.Color.charAt(1)&&"TEXTBOX"==a.ObjType)var g=null;else g=d;if("Y"==e&&""!==a.TextImg&&void 0!==a.TextImg&&null!==a.TextImg)var h=await add_text_box_with_image_3d(a.Shelf,"TEXTBOX",a.W,a.H,a.D,f,a.X,a.Y,a.Z,i,a.InputText,g,a.WrapText,a.ReduceToFit,a.Color,a.Rotation,a.Slope,a.FStyle,a.FSize,a.FBold,j);else{g_dblclick_objid=a.SObjID,g_shelf_index=j;h=add_text_box_3d(a.Shelf,"TEXTBOX",a.W,a.H,a.D,f,a.X,a.Y,a.Z,i,a.InputText,d,helfs.WrapText,a.ReduceToFit,a.Color,j,a.Rotation,a.Slope,a.FStyle,a.FSize,a.FBold)}var p=-1;$.each(o[0].ModuleInfo,(function(e,o){null!==o.ParentModule&&o.Module==a.Shelf&&(p=e)})),-1!==p&&(o[0].ModuleInfo[p].ObjID=h)}j+=1}}i+=1}}catch(e){error_handling(e)}}function Show_Depthfacing(e,o,t,n,a,r){var s=[],l=[],d=[],f=0,g=0;curr_height=0,depth=g_json[0].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].D,depth_facing=g_json[0].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].BaseD;g_json[0].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].RH,g_json[0].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].RW,g_json[0].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].BHoriz;var h=g_json[0].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].BVert,p=0-parseFloat(r)/2,_=0+parseFloat(r)/2,m=0-parseFloat(a)/2,c=0+parseFloat(a)/2,u=0-parseFloat(depth)/2,E=0+parseFloat(depth)/2,I=0-parseFloat(a)/2,w=0+parseFloat(a)/2,T=g_json[0].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].CapStyle,R=g_json[0].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].CapHeight,S=g_json[0].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].CapDepth,H=-1,M=-1,j=[],y=new THREE.LineBasicMaterial({color:0});if(0!==T&&(H=_-=R,M=_+R),depth_facing>1){g=depth/depth_facing;var x=u;for(i=1;i<depth_facing;i++)x+=parseFloat(g),j.push(x);for(i=0;i<j.length;i++)s.push(new THREE.Vector3(I,p,j[i])),s.push(new THREE.Vector3(I,_,j[i]));for(i=0;i<j.length;i++)d.push(new THREE.Vector3(w,p,j[i])),d.push(new THREE.Vector3(w,_,j[i]))}var v=(new THREE.BufferGeometry).setFromPoints(s),F=(new THREE.BufferGeometry).setFromPoints(d);if((b=new THREE.LineSegments(v,y)).position.z=5e-4,n.add(b),(B=new THREE.LineSegments(F,y)).position.z=5e-4,n.add(B),s=[],d=[],h>1){for(curr_height=r/h,f=p,i=1;i<h;i++)f+=parseFloat(curr_height),l.push(f);for(i=0;i<l.length;i++)s.push(new THREE.Vector3(I,l[i],u)),s.push(new THREE.Vector3(I,l[i],E));for(i=0;i<l.length;i++)d.push(new THREE.Vector3(w,l[i],u)),d.push(new THREE.Vector3(w,l[i],E))}v=(new THREE.BufferGeometry).setFromPoints(s),F=(new THREE.BufferGeometry).setFromPoints(d);if((b=new THREE.LineSegments(v,y)).position.z=5e-4,n.add(b),(B=new THREE.LineSegments(F,y)).position.z=5e-4,n.add(B),depth_facing>1){g=depth/depth_facing;x=u;for(i=1;i<depth_facing;i++)x+=parseFloat(g),j.push(x);for(i=0;i<j.length;i++)s.push(new THREE.Vector3(m,_,j[i])),s.push(new THREE.Vector3(c,_,j[i]))}F=(new THREE.BufferGeometry).setFromPoints(s);if((B=new THREE.LineSegments(F,y)).position.z=5e-4,n.add(B),s=[],d=[],S>1){g=depth/S;x=u;for(i=1;i<S;i++)x+=parseFloat(g),j.push(x);for(i=0;i<j.length;i++)s.push(new THREE.Vector3(I,H,j[i])),s.push(new THREE.Vector3(I,M,j[i]));for(i=0;i<j.length;i++)d.push(new THREE.Vector3(w,H,j[i])),d.push(new THREE.Vector3(w,M,j[i]))}var b,B;v=(new THREE.BufferGeometry).setFromPoints(s),F=(new THREE.BufferGeometry).setFromPoints(d);(b=new THREE.LineSegments(v,y)).position.z=5e-4,n.add(b),(B=new THREE.LineSegments(F,y)).position.z=5e-4,n.add(B)}