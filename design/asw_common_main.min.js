var g_myVar,g_default_checkbox,g_taskItemInContext1,g_pog_edited_ind,g_edit_ind,g_db,g_fileDownloadCheckTimer,g_trs,g_taskItemInContext,g_mousedown_locx,g_hangbar_dft_maxmerch,g_pegboard_dft_item_depth,g_pogcr_pdf_chest_split,g_nodataModuleName,g_lr_overhung,g_pog_json_comp,g_new_canvas,g_wireframe_id,g_shelf_object_type,g_objectHit_id,g_module_width,g_world_pdf,g_dblclick_objid,g_l_module_dir,g_l_direction,g_l_ignore,g_l_order_type,g_l_start_one_mod,g_l_include_mod_name,g_l_separator,g_l_leading_text,g_l_trailing_text,g_l_start_one_mod_loc,g_l_start_one_fixel,g_show_days_of_supply,g_get_orient_images,g_drag_shelf_notch,g_undoRedoAction,g_status_error_color,g_offset_z,g_temp_POG_arr,g_textbox_merge_pdf,g_auto_hangbar_facings,g_auto_apply_v_facings,g_auto_apply_d_facings,g_windowHeight,g_windowWidth,g_tanFOV,g_drag_x,g_drag_z,g_targetForDragging,g_dim_error_color,g_scene_pdf,g_camera_pdf,g_renderer_pdf,g_pogcr_auto_hlite_non_mv_item,g_raycaster,g_camera_comp,g_world_comp,g_show_desc_no_image,g_notch_label_position,g_overhung_validation,g_canvas,g_canvas_region,g_scene,g_renderer,g_camera,g_initial_camera,g_orientation_json,g_start_pixel_ratio,g_selection,g_world,g_objectHit_uuid,g_intersects,g_start_coorX,g_start_coorY,g_objectHit,g_lastSelectedRow,g_dragItem,g_item_index,g_incre_mod_index,g_incre_shelf_index,g_incre_item_index,g_shelf_max_merch,g_module_X,g_module_cnt,g_show_fixel_space,g_toFixedValue,g_pogcr_enbl_oos_border,g_pogcr_oos_border_color,g_pogcr_enhance_textbox_fontsize,g_context_opened="N",g_area_zoom_ind="N",g_select_zoom_arr=[],g_pogjson_backup=[],g_pogjson_data_backup=[],g_multi_shelf_index=-1,g_multi_shelf_ind="N",g_multi_mod_index="",g_multi_shelf_obj_type="",g_multi_shelf_arr=[],g_multi_delete_shelf_ind="N",g_multi_delete_done="N",g_clearInfoType="N",g_object_hit_ind="O",g_temp_cut_arr=[],g_multiselect="N",g_errored_items=[],g_error_category="",g_auto_position_ind="N",g_pdf_online_clck="N",g_dupShelfDepth=.1,g_auto_fill_active="N",g_mod_block_list=[],g_temp_image_arr=[],g_multiItemCopy="N",g_canvas_drag="N",g_mselect_drag="N",g_start_canvas=1,g_present_canvas=1,g_ctrl_select="N",g_dragging=!1,g_selecting=!1,g_product_list_drag="N",g_item_edit_flag="N",g_dblclick_opened="N",g_minvalue=.01,g_fileUploadFlag="N",g_shelf_index=-1,g_module_index=0,g_final_x=0,g_final_y=0,g_final_z=0,g_isBookend="N",g_movedObjID=-1,g_lines=[],g_peg_holes_active="Y",g_compare_pog_flag="N",g_ComViewIndex=-1,g_ComBaseIndex=-1,g_compare_view="NONE",g_slope=0,g_manual_zoom_ind="N",g_show_fixel_label="N",g_edit_pallet_shelfid=-1,g_show_notch_label="N",g_shelf_edit_flag="N",g_show_item_label="N",g_show_peg_tags="N",g_carpark_item_flag="N",g_ItemImages=[],g_auto_cal_depth_fac="N",g_deletedItems=[],g_keyCode=0,g_cutaway_cam_detail=[],g_prev_undo_action="NONE",g_duplicate_fixel_flag="N",g_shelf_basket_spread="",g_carpark_items=[],g_show_notch_label_comp="N",g_cut_loc_arr=[],g_undo_obj_arr=[],g_undo_supp_obj_arr=[],g_redo_supp_obj_arr=[],g_undo_details=[],g_delete_details=[],g_undo_all_obj_arr=[],g_cut_support_obj_arr=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_redo_all_obj_arr=[],g_multi_copy_done="N",g_redo_final_obj_arr=[],g_curr_canvas=1,g_pog_index=-1,g_auto_fill_reg_open="N",g_comp_view_code="",g_comp_base_code="",g_productselect="N",g_scene_objects_backup=[],g_labelFont=16,g_validationFlag="Y",g_cut_action_done="N",g_copy_action_done="N",g_dup_action_done="N",g_delete_action_done="N",g_labelActualSize=.055,g_pegbrd_auto_placing="N",g_edited_item_index=-1,g_upload_file_flag="N",g_drag_items_arr=[],g_itemDragZ=0,g_allUndoObjectsInfo=[],g_dup_mod_list=[],g_pog_json_data=[],g_dft_max_merch=0,g_undo_final_obj_arr=[],g_rotation=0,g_show_live_image="N",g_show_item_desc="N",g_module_obj_array=[],g_all_pog_flag="N",g_temp_desc="N",g_dbuDebugEnabled=sessionStorage.getItem("g_dbuDebugEnabled"),g_pogBackup=[],g_errorRaisedFlag="N",g_openChooseColor=!1,g_nonMovingItemColor=parseInt("#9F2B68".replace("#","0x"),16),g_show_item_desc_comp="N",g_show_live_image_comp="N",g_caption_text="",g_intersected=[],g_edit_pallet_mod_ind=-1,g_edit_pallet_shelf_ind=-1,g_open_productlist="Y",g_delete_item_json=[],g_combinedShelfs=[],g_combineItemModf=[],g_seqArr=[],g_seqArrDtl={},g_renum_json=[],g_multi_pog_json=[],g_overhung_shelf_active="N",g_ispog_savingerror="N",g_counting=0,g_pog_saving_error_msg="N",g_select_color=0,g_scene_objects=[],g_canvas_objects=[],g_json=[],g_pog_json=[],g_fixel_label="N",g_vert_text_dis=0,g_pog_list=[],g_global_counter=0,g_chest_as_pegboard="N",g_draftPogInd="",g_finalY=-1,g_prevX=0,g_recal_compare="N",g_prevY=0,g_isPogItemsSet="N",g_colorBackup="N",g_imagesShown="N",g_imagesShownComp="N",g_validationAlert="N",g_prevKeyPressed=0,g_max_facing_enabled="N",g_current_div_index="",g_status_bar=[],g_itemDragX=-1,g_drag_inprogress="N",g_module_edit_flag="N",g_carpark_edit_flag="N",g_show_max_merch="N",g_show_item_color="N",g_pog_refresh_msg=get_message("POG_SAVE_SUCCESS_MSG"),g_pog_draft_save_msg=get_message("SAVE_DRAFT_SUCESS_MSG"),g_delete_success_msg=get_message("DELETE_SUCCESS_MSG"),g_pog_success_msg=get_message("SAVE_POG_SUCESS_MSG"),g_atleast_one_pog=get_message("ATLEAST_ONE_POG"),g_expand_all_pog=get_message("POGCR_EXPAND_ALL_POG"),g_msg_na=get_message("POGCR_MSG_NA"),g_msg_h=get_message("POGCR_MSG_H"),g_msg_w=get_message("POGCR_MSG_W"),g_msg_d=get_message("POGCR_MSG_D"),g_msg_Sq=get_message("POGCR_MSG_SQ"),g_msg_unit=get_message("POGCR_MSG_UNIT"),g_msg_dollar=get_message("POGCR_MSG_DOLLAR"),g_itemSubLabelInd="N",g_itemSubLabel="",g_shelf_details=[],g_color_arr=[],g_highlightArr=[],g_duplicating="N",g_autofill_edit="N",g_show_error=!0,g_invalidPosition="N",g_pogcr_live_new_item="N",g_shift_mutli_item_select="N",g_shift_multi_item_first={},g_shift_multi_item_last={},g_multi_select_offset_perc=0,g_hide_show_dos_label="",g_itemInfoFileIndex=0,g_sublabel_type="",g_show_plano_rate="N",g_product_list_blink="N",g_multi_cnvs_drag_conf="N",g_item_stack_valid="Y",g_item_shelf_updated_msg=get_message("POGCR_ITEM_FIXEL_UPD"),g_is_pog_template_open="N",g_autofill_detail={},g_wf_pog_approval_enabled="",g_pogcr_pog_approval_for_new_pog="",g_is_pog_maximize="N",g_textbox_dragged="N",g_edit_textboxZ="",g_autofillModInfo=[],g_autofillShelfInfo=[];g_item_vertical_text_display="Y",g_item_text_center_align="Y";var g_DragMouseStart=new THREE.Vector2,g_DragMouseEnd=new THREE.Vector2,g_mouse=new THREE.Vector2,g_startMouse=new THREE.Vector2,g_prevMouse=new THREE.Vector2,g_nextMouse=new THREE.Vector2,g_allowItemSort="Y";function wpdSetFixed(e){try{return"string"==typeof e&&(e=parseFloat(e)),parseFloat(nvl(e).toFixed(g_toFixedValue))}catch(e){error_handling(e)}}function wpdGetFixed(e){try{g_toFixedValue=e}catch(e){error_handling(e)}}function setUpMouseHander(e,o,t,n,i,r){if(logDebug("function : setUpMouseHander","S"),!e||!o||"function"!=typeof o)throw"Illegal arguments in setUpMouseHander";if("string"==typeof e&&(e=document.getElementById(e)),!e||!e.addEventListener)throw"first argument in setUpMouseHander is not a valid element";var a,l,s,d,_=0,g=$v("P25_POG_DELAY_TIME_IN_MS"),f=!1,p=document.getElementById("t_Body_nav"),c=document.getElementById("side_bar"),I=window.devicePixelRatio;g_start_pixel_ratio=I;p.offsetWidth,c.offsetWidth;r.addEventListener("mousemove",(function(e){if(!f&&t){set_curr_canvas(e);var o=r.getAttribute("id"),n=r,i=n.getAttribute("data-indx"),_=g_camera;"CANVAS"==e.target.nodeName&&void 0!==g_scene_objects[i]?(i=(n=e.target).getAttribute("data-indx"),g_scene_objects.length>0&&(_=g_scene_objects[i].scene.children[0])):(n=e.target,i=0,_=g_camera);var g=n.getBoundingClientRect(),p=(g.height,e.clientX-g.left),c=e.clientY-g.top,I=Math.abs(p-a),m=Math.abs(c-l);if(!g_dragging||I>10||m>10||g_pog_json.length>1){t(p,c,e,g_dragging?s:p,g_dragging?d:c,n,_,o,i)}s=p,d=c}})),r.addEventListener("mouseup",(function(e){if(g_dragging){if(set_curr_canvas(e),n&&g_scene_objects.length>0){var o=r.getBoundingClientRect(),t=e.clientX-o.left,i=e.clientY-o.top;n(t,i,e,s,d,r,g_camera,g_pog_index)}g_dragging=!1}})),r.addEventListener("mousedown",(function(e){if(!g_dragging){var t=Date.now();if(f=t-_<g,_=t,1==window.event.which&&g_scene_objects.length>0&&(set_curr_canvas(e),g_scene_objects.length>0)){var n=r.getBoundingClientRect(),i=(n.left,n.top,e.clientX-n.left),p=e.clientY-n.top;s=a=i,d=l=p,f||(g_dragging=o(i,p,n.left,n.top,e,r,"N",g_pog_index))}}})),r.addEventListener("dblclick",(function(e){if(set_curr_canvas(e),g_scene_objects.length>0){var o=r.getBoundingClientRect(),t=e.clientX-o.left,n=e.clientY-o.top;i(t,n,a,l,e,r,g_camera,g_pog_index)}f=!1})),logDebug("function : setUpMouseHander","E")}function limited_animate(e,o,t){try{if(g_counting<5)if(g_counting+=1,null!==g_renderer&&void 0!==t)if(null!==g_canvas_objects[t].getContext("2d")){var n=g_canvas_objects[t].getContext("2d");g_renderer.setPixelRatio(window.devicePixelRatio);var i=g_canvas_objects[t].width,r=g_canvas_objects[t].height;g_renderer.setSize(i,r),g_scene_objects[t].scene.children[0].aspect=i/r,g_renderer.render(g_scene_objects[t].scene,g_scene_objects[t].scene.children[0]),null!==n&&n.drawImage(g_renderer.domElement,0,0,i,r),requestAnimationFrame((function(){limited_animate(g_scene_objects[t].scene,g_scene_objects[t].scene.children[0],t)}))}else null!==g_renderer&&(g_renderer.render(e,o),requestAnimationFrame((function(){limited_animate(e,o,t)})));else null!==g_renderer&&(g_renderer.render(e,o),requestAnimationFrame((function(){limited_animate(e,o,t)})));else g_counting=0}catch(e){error_handling(e)}}function animate_pog(e){try{void 0!==typeof g_scene_objects&&g_scene_objects.length>0&&requestAnimationFrame((function(){limited_animate(g_scene_objects[e].scene,g_scene_objects[e].scene.children[0],e)}))}catch(e){error_handling(e)}}function animate_pog_pdf(){try{requestAnimationFrame((function(){limited_animate(g_scene_pdf,g_camera_pdf)}))}catch(e){error_handling(e)}}async function load_orientation_json(){return logDebug("function : load_orientation_json"),new Promise((function(e,o){apex.server.process("LOAD_ORIENTATION_JSON",{},{dataType:"text",success:function(o){g_orientation_json=JSON.parse(o),e(g_orientation_json)}})}))}function init_lib(e,o,t,n){try{g_canvas_region=document.getElementById("drawing_region"),g_selection=document.getElementById("selection"),"Y"==e&&(g_renderer=new THREE.WebGLRenderer({canvas:g_canvas,antialias:!0,preserveDrawingBuffer:!0})),g_canvas_objects.push(g_canvas)}catch(e){return void(document.getElementById("canvas-holder").innerHTML="<p><b>Sorry, an error occurred:<br>"+e+"</b></p>")}createWorld(),g_raycaster=new THREE.Raycaster,render(0);var i=window.devicePixelRatio;g_start_pixel_ratio=i;var r=window.innerWidth;g_windowHeight=window.innerHeight,"Y"==o&&setUpMouseHander("maincanvas",doMouseMove,doMouseDown,doMouseUp,g_renderer,n),g_tanFOV=Math.tan(Math.PI/180*g_camera.fov/2),g_initial_windowHeight=window.innerHeight,g_camera.aspect=r/g_windowHeight,g_camera.fov=360/Math.PI*Math.atan(g_tanFOV*(g_windowHeight/g_initial_windowHeight)),g_camera.updateProjectionMatrix(),g_renderer.setSize(r,g_windowHeight),render(0),"Y"==t&&window.addEventListener("resize",onWindowResize_lib,!1),onWindowResize_lib("F")}window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,wpdGetFixed(5);const visibleHeightAtZDepth=(e,o)=>{const t=o.position.z;e<t?e-=t:e+=t;const n=o.fov*Math.PI/180;return 2*Math.tan(n/2)*Math.abs(e)},visibleWidthAtZDepth=(e,o)=>visibleHeightAtZDepth(e,o)*o.aspect;let findDuplicates=e=>e.filter(((o,t)=>e.indexOf(o)!=t));function getDateTime(){var e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+(e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+":"+e.getMilliseconds())}function logDebug(e,o){var t;t="S"==o?"Start":"End","Y"==(g_dbuDebugEnabled="Y")&&console.log(t+" | "+e+" | "+getDateTime())}function timeout(e){try{return new Promise((o=>setTimeout(o,e)))}catch(e){error_handling(e)}}function s2ab(e){for(var o=new ArrayBuffer(e.length),t=new Uint8Array(o),n=0;n!=e.length;++n)t[n]=255&e.charCodeAt(n);return o}function get_avail_heap(){return performance.memory.jsHeapSizeLimit-performance.memory.totalJSHeapSize}function validateDimensions(e,o){try{logDebug("function : validateDimensions","S");var t=o.which?o.which:event.keyCode,n=e.value.split(".");if(46!=t&&t>31&&45!==t&&(t<48||t>57))return!1;if(n.length>1&&46==t)return!1;var i=getSelectionStart(e),r=e.value.indexOf(".");return!(i>r&&r>-1&&n[1].length>1)&&(logDebug("function : validateDimensions","E"),!0)}catch(e){error_handling(e)}}function invertHex(e){try{return(16777215^Number(`0x1${e}`)).toString(16).substr(1).toUpperCase()}catch(e){error_handling(e)}}function hexToRgb(e){try{var o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:null}catch(e){error_handling(e)}}function removeParam(e){try{logDebug("function : removeParam; parameter : "+e,"S");var o=document.location.href;if(o.includes("f?p")){var t=o.split("?"),n="?p="+$v("pFlowId")+":"+$v("pFlowStepId")+":"+$v("pInstance")+":";t.length>=2&&window.history.pushState("",document.title,t[0]+n)}else{var i=o.match(/[?](.*)&s/);if(null!==i&&void 0!==i[1]){var r=o.replace(i[1]+"&","");window.history.pushState("",document.title,r)}}return logDebug("function : removeParam","E"),o}catch(e){logDebug("function : removeParam","E"),error_handling(e)}}function raise_error(e,o="page",t){console.log("error message ",e),apex.message.clearErrors();var n,i=new Error;throw"string"==typeof e?(-1==e.indexOf("ERROR:")&&(n="ERROR:"),i.message=n+e,i.stack=n+e):(-1==(i=e).message.indexOf("ERROR:")&&(n="ERROR:"),i.message=n+i.message,n="",-1==i.stack.indexOf("ERROR:")&&(n="ERROR:"),i.stack=n+i.stack),g_show_error&&(void 0!==t?apex.message.showErrors([{type:"error",location:o,message:e}]):apex.message.showErrors([{type:"error",location:o,pageItem:t,message:e}])),"undefined"!=typeof regionloadWait&&"function"==typeof regionloadWait.remove&&removeLoadingIndicator(regionloadWait),console.log("raise error function: ",e,g_show_error),i}function isPromise(e){return e&&"[object Promise]"===Object.prototype.toString.call(e)}async function error_handling(e){console.log("error ",e);var o=await get_format_error(e);o?"string"==typeof o?raise_error(o):o.then((function(e){raise_error(e)})).catch((function(e){raise_error(e)})):raise_error(e.stack)}async function get_format_error(e){if(logDebug("function : get_format_error","S"),"string"==typeof e)return e;var o,t=e.stack.split("\n"),n=[];for(i=0;i<t.length;i++)if(0==i){o=(r=t[i]).slice(r.lastIndexOf(":")+1,r.length),n.push("Exception Occurred, Reverted to previous action."),n.push(o)}else{var r,a,l=(r=t[i]).slice(0,r.lastIndexOf(":"));a=-1!==r.indexOf(".js")?l.slice(l.lastIndexOf("/")+1,l.lastIndexOf(":")):"Page 25",n.push(l.slice(0,l.indexOf("(")-1)+" | "+a+" | "+l.slice(l.lastIndexOf(":")+1,l.length))}console.log("error",e.stack);revertOnError(g_pogBackup,g_pog_index);return logDebug("function : get_format_error","E"),n.join("<br>")}function set_custom_color(e,o){try{logDebug("function : set_custom_color ; ","S"),$.support.cors=!0;const t=$("#"+e);$(".colorValue"),$(".colorDisplay");$(t).sbxColorChoice({selecionarCor:e=>{$("#"+o).val(e),$("#"+o+"_CONTAINER .apex-item-color-picker-preview").css("background-color",e)},reseteCor:"#FFFFFF",event:event,setfocus:o}),logDebug("function : set_custom_color ; ","E")}catch(e){error_handling(e)}}function backupPog(e,o,t,n){1==g_curr_canvas&&void 0!==g_pog_json&&g_pog_json.length>0&&(g_pogBackup=[],backDetail=[],backDetail.backupType=e,"S"==e?(backDetail.shelfIndex=o,backDetail.moduleIndex=t,backDetail.push(JSON.parse(JSON.stringify(g_pog_json[n].ModuleInfo[t].ShelfInfo[o])))):(backDetail.shelfIndex=-1,backDetail.moduleIndex=-1,backDetail.push(JSON.parse(JSON.stringify(g_pog_json[n])))),g_pogBackup.push(backDetail))}async function revertOnError(e,o){try{lIndex=0,"N"==g_errorRaisedFlag&&(g_errorRaisedFlag="Y",pogBackup=[])}catch(e){console.log("error")}}function get_visible_size(e,o,t,n,i){try{logDebug("function : get_visible_size; objectZ : "+e+"; obj_width : "+o+"; obj_height : "+t,"S");var r=i.position.z-e,a=THREE.MathUtils.degToRad(i.fov),l=2*Math.tan(a/2)*r,s=l*i.aspect,d=n.width/window.devicePixelRatio,_=n.height/window.devicePixelRatio,g=d*(o/s),f=_*(t/l);return logDebug("function : get_visible_size","E"),[g,f]}catch(e){logDebug("function : get_visible_size","E"),error_handling(e)}}function calculateSize(e,o,t){try{logDebug("function : calculateSize; maxWidth : "+o+"; maxHeight : "+t,"E");let n=e.width,i=e.height;return n>i?n>o&&(i=Math.round(i*o/n),n=o):i>t&&(n=Math.round(n*t/i),i=t),logDebug("function : calculateSize","E"),[n,i]}catch(e){logDebug("function : calculateSize","E"),error_handling(e)}}function readableBytes(e){try{logDebug("function : readableBytes; bytes : "+e,"S");const o=Math.floor(Math.log(e)/Math.log(1024)),t=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];return logDebug("function : readableBytes","E"),(e/Math.pow(1024,o)).toFixed(2)+" "+t[o]}catch(e){logDebug("function : readableBytes","E"),error_handling(e)}}function get_visible_text_dim(e,o){try{logDebug("function : get_visible_text_dim; text : "+e+"; textHeight : "+o,"S");var t=document.getElementById("ruler");return t.style.fontSize=o+"px",t.innerHTML=e,width=t.offsetWidth+10,height=t.offsetHeight+5,logDebug("function : get_visible_text_dim","E"),[width,height]}catch(e){logDebug("function : get_visible_text_dim","E"),error_handling(e)}}function clickInsideElement(e,o){var t=e.srcElement||e.target;if(t.classList.contains(o))return t;for(;t=t.parentNode;)if(t.classList&&t.classList.contains(o))return t;return!1}function JsonContains(e,o,t){try{if(null!=e)return Object.keys(e).some((n=>"object"==typeof e[n]?JsonContains(e[n],o,t):n===o&&e[n]===t))}catch(e){error_handling(e)}}function JsonContainsAll(e,o){try{return!!Array.isArray(e)&&e.some((e=>Object.entries(o).every((([o,t])=>e[o]===t))))}catch(e){console.error(e)}return!1}function nextLetter(e){try{return e.replace(/([a-zA-Z])[^a-zA-Z]*$/,(function(e){var o=e.charCodeAt(0);switch(o){case 90:return"A";case 122:return"a";default:return String.fromCharCode(++o)}}))}catch(e){error_handling(e)}}function create3dWorld(){try{g_scene=new THREE.Scene,(g_camera=new THREE.PerspectiveCamera(25,g_canvas.width/g_canvas.height,.1,1e3)).lookAt(new THREE.Vector3(0,0,0)),g_renderer.setPixelRatio(window.devicePixelRatio),g_scene.add(g_camera),g_renderer.setClearColor(16777215),g_renderer.setSize(g_canvas.width,g_canvas.height);var e=new THREE.HemisphereLight(16777215,16777215,.61);e.position.set(0,50,0),g_scene.add(e);var o=new THREE.DirectionalLight(16777215,.54);o.position.set(-8,12,15),o.castShadow=!0,o.shadow.mapSize.width=2048,o.shadow.mapSize.height=2048,g_scene.add(o),g_camera.aspect=g_canvas.width/g_canvas.height,g_camera.updateProjectionMatrix();var t=new THREE.PlaneGeometry(g_json[0].CameraW+1.5,3,1,1),n=new THREE.MeshPhongMaterial({color:10919846,shininess:0});n.flatShading=!0,t.normalsNeedUpdate,t.computeFaceNormals();var i=new THREE.Mesh(t,n);if(i.rotation.x-=Math.PI/2,g_json[0].CameraMinY<0)var r=g_json[0].CameraH/2+(0-g_json[0].CameraMinY);else r=g_json[0].CameraH/2;i.position.y=0-r,g_scene.add(i),i.receiveShadow=!0,g_world=new THREE.Object3D,g_scene.add(g_world),(g_targetForDragging=new THREE.Mesh(new THREE.BoxGeometry(100,100,.01),new THREE.MeshBasicMaterial)).material.visible=!1,g_targetForDragging.material.transparent=!0,g_targetForDragging.material.opacity=.1,g_targetForDragging.uuid="drag_object"}catch(e){error_handling(e)}}function createWorld(){try{g_scene={},g_camera={},g_world={},g_scene=new THREE.Scene,(g_camera=new THREE.PerspectiveCamera(25,g_canvas.width/2/g_canvas.height,.1,1e3)).lookAt(new THREE.Vector3(0,0,0)),(g_renderer&&"function"==typeof g_renderer.setPixelRatio||"undefined"!=typeof THREE&&void 0!==g_canvas&&g_canvas&&"function"==typeof(g_renderer=new THREE.WebGLRenderer({canvas:g_canvas,antialias:!0,preserveDrawingBuffer:!0})).setPixelRatio)&&g_renderer.setPixelRatio(window.devicePixelRatio),g_camera.add(new THREE.PointLight(16777215,.2)),g_scene.add(g_camera),g_renderer&&"function"==typeof g_renderer.setClearColor&&g_renderer.setClearColor(16777215);var e=new THREE.DirectionalLight(16777215,1);e.position.set(-1,2,4).normalize(),g_scene.add(e),g_camera.aspect=g_canvas.width/2/g_canvas.height,g_camera.updateProjectionMatrix(),g_world=new THREE.Object3D,g_scene.add(g_world),(g_targetForDragging=new THREE.Mesh(new THREE.BoxGeometry(100,100,.01),new THREE.MeshBasicMaterial)).material.visible=!1,g_targetForDragging.material.transparent=!0,g_targetForDragging.material.opacity=.1,g_targetForDragging.uuid="drag_object"}catch(e){error_handling(e)}}function get_new_orientation_dim(e,o,t,n){try{if(logDebug("function : get_new_orientation_dim; orientation : "+e+"; item_width : "+o+"; item_height : "+t+"; item_depth : "+n,"S"),width_final=height_final=depth_final=0,"1"==e||"3"==e||"13"==e||"15"==e){var i=o,r=t;height_final=i,width_final=r,depth_final=n;var a="W",l="H",s="D"}else if("4"==e||"6"==e||"16"==e||"18"==e){var d=n;r=t;width_final=o,height_final=d,depth_final=r;a="D",l="W",s="H"}else if("5"==e||"7"==e||"17"==e||"19"==e){d=n,r=t,i=o;height_final=i,width_final=d,depth_final=r;a="W",l="D",s="H"}else if("8"==e||"10"==e||"20"==e||"22"==e){d=n,i=o;width_final=d,height_final=t,depth_final=i;a="H",l="D",s="W"}else if("9"==e||"11"==e||"21"==e||"23"==e){d=n,r=t,i=o;width_final=r,height_final=d,depth_final=i;a="D",l="H",s="W"}else{width_final=o,height_final=t,depth_final=n;a="H",l="W",s="D"}return logDebug("function : get_new_orientation_dim","E"),[width_final,height_final,depth_final,a,l,s]}catch(e){error_handling(e)}}function add_wireframe(e,o){try{logDebug("function : add_wireframe; linewidth : "+o,"S");var t=new THREE.EdgesGeometry(e.geometry),n=new THREE.LineBasicMaterial({color:0,linewidth:o}),i=new THREE.LineSegments(t,n);return i.renderOrder=1,i.uuid="wireframe",e.WireframeObj=i,e.add(i),logDebug("function : add_wireframe","E"),i.id}catch(e){error_handling(e)}}function add_wireframe_3d(e){return add_wireframe(e,2)}function set_camera_z(e,o,t,n,r,a,l,s,d=!0,_){try{console.log("p_pog_index",_),logDebug("function : set_camera_z; x : "+o+"; y : "+t+"; width : "+n+"; height : "+r+"; offset : "+a+"; min_x : "+l+"; min_y : "+s,"S"),o=Number(o)||0,t=Number(t)||0,n=Number(n),(!Number.isFinite(n)||n<=0)&&(n=1),r=Number(r),(!Number.isFinite(r)||r<=0)&&(r=1),a=Number(a),Number.isFinite(a)||(a=0),l=Number(l)||0,s=Number(s)||0,e.position.x=o,e.position.y=t,e.position.z=0,console.log("camera.x",e.position.x,o);var g=.1,f=0,p=0;for(i=0;i<1e3&&(f=visibleHeightAtZDepth(g,e),p=visibleWidthAtZDepth(g,e),!(parseFloat(r)<f&&parseFloat(n)<p));i++)g+=.1;e.position.z=a+g,d&&(g_pog_json[_].CameraX=o,g_pog_json[_].CameraY=t,g_pog_json[_].CameraZ=g,g_pog_json[_].CameraW=n,g_pog_json[_].CameraH=r,g_pog_json[_].CameraMinX=l,g_pog_json[_].CameraMinY=s),logDebug("function : set_camera_z","E")}catch(e){logDebug("function : set_camera_z","E"),error_handling(e)}}function set_camera_z_3d(e,o,t,n,i,r){set_camera_z(e,o,t,n,i,r,0,0,!1,g_pog_index)}function set_camera_z_offside(e,o,t,n,r,a,l,s){try{o=Number(o)||0,t=Number(t)||0,n=Number(n),(!Number.isFinite(n)||n<=0)&&(n=1),r=Number(r),(!Number.isFinite(r)||r<=0)&&(r=1),a=Number(a),Number.isFinite(a)||(a=0),l=Number(l)||0,s=Number(s)||0;var d=.1,_=0,g=0;for(i=0;i<1e3&&(_=visibleHeightAtZDepth(d,e),g=visibleWidthAtZDepth(d,e),!(parseFloat(r)<_&&parseFloat(n)<g));i++)d+=.1;return[a+d,t]}catch(e){error_handling(e)}}function get_min_max_xy_module(e,o,t,n,i,r,a){logDebug("function : get_min_max_xy_module; p_module_index : "+o+"; width : "+t+"; height : "+n+"; moduleX : "+i,"S");try{var l=0,s=0,d=0,_=0,g=0,f=0,p=0,c=-1,I=-1;if(n<=.2){if(l=t,s=0,d=n,_=0,e.ShelfInfo.length>0){var m=0;for(const n of e.ShelfInfo){"BASE"!==n.ObjType&&"NOTCH"!==n.ObjType&&"DIVIDER"!==n.ObjType&&("TEXTBOX"==n.ObjType&&n.W<r||1==a||"TEXTBOX"!==n.ObjType&&a>1)&&"N"==n.SplitChest&&(0!==n.Rotation||0!==n.Slope?(g=n.ShelfRotateWidth,f=n.ShelfRotateHeight):(g=n.W,f=n.H),"TEXTBOX"==n.ObjType&&p<n.H&&(p=n.H,c=o,I=m));var h=n.X-(i-t/2);l=Math.max(l,h+g/2),s=Math.min(s,h-g/2),d=Math.max(d,n.Y+f/2),_=Math.min(_,n.Y-f/2),m++}}if(0!==nvl(e.ChestInfo)&&e.ChestInfo.length>0){m=0;for(const n of e.ChestInfo){0!==n.Rotation||0!==n.Slope?(g=n.ShelfRotateWidth,f=n.ShelfRotateHeight):(g=n.W,f=n.H),"TEXTBOX"==n.ObjType&&p<n.H&&(p=n.H,c=o,I=m);h=n.X-(i-t/2);l=Math.max(l,h+g/2),s=Math.min(s,h-g/2),d=Math.max(d,n.Y+f/2),_=Math.min(_,n.Y-f/2),m++}}var u=parseFloat(l)-parseFloat(s),S=parseFloat(d)-parseFloat(_);if(-1!==c&&-1!==I)var D=e.ShelfInfo[I].X-(i-t/2),b=e.ShelfInfo[I].Y;else D=u/2,b=S/2}else{if(l=t,s=0,d=n,_=0,e.ShelfInfo.length>0){m=0;for(const o of e.ShelfInfo){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&("TEXTBOX"==o.ObjType&&o.W<r||1==a||"TEXTBOX"!==o.ObjType&&a>1)&&"N"==o.SplitChest){0!==o.Rotation||0!==o.Slope?(g=o.ShelfRotateWidth,f=o.ShelfRotateHeight):(g=o.W,f=o.H);h=o.X-(i-t/2);l=Math.max(l,h+g/2),s=Math.min(s,h-g/2),d=Math.max(d,o.Y+f/2),_=Math.min(_,o.Y-f/2);for(const e of o.ItemInfo){var v=e.X-(i-t/2);l=Math.max(l,v+e.W/2),s=Math.min(s,v-e.W/2),d=Math.max(d,e.Y+e.H/2),_=Math.min(_,e.Y-e.H/2)}}m++}}if(0!==nvl(e.ChestInfo)&&e.ChestInfo.length>0){m=0;for(const o of e.ChestInfo){0!==o.Rotation||0!==o.Slope?(g=o.ShelfRotateWidth,f=o.ShelfRotateHeight):(g=o.W,f=o.H);h=o.X-(i-t/2);l=Math.max(l,h+g/2),s=Math.min(s,h-g/2),d=Math.max(d,o.Y+f/2),_=Math.min(_,o.Y-f/2);for(const e of o.ItemInfo){v=e.X-(i-t/2);l=Math.max(l,v+e.W/2),s=Math.min(s,v-e.W/2),d=Math.max(d,e.Y+e.H/2),_=Math.min(_,e.Y-e.H/2)}m++}}s-=1,l+=1,_-=1,d+=1;u=parseFloat(l)-parseFloat(s),S=parseFloat(d)-parseFloat(_),D=parseFloat(s)+u/2,b=parseFloat(_)+S/2}return logDebug("function : get_min_max_xy_module","E"),u+"###"+S+"###"+D+"###"+b+"###"+s+"###"+_+"###"+l+"###"+d}catch(e){error_handling(e)}}function get_actual_mod_xy(e,o,t,n){logDebug("function : get_module_final_xy;   width : "+o+"; height : "+t+"S");try{console.log(e,o,t,n);var i=0,r=0,a=o,l=n,s=t,d=0;if(e.ShelfInfo.length>0){for(const o of e.ShelfInfo){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType){0!==o.Rotation||0!==o.Slope?(i=o.ShelfRotateWidth,r=o.ShelfRotateHeight):(i=o.W,r=o.H);var _=o.X;a=Math.max(a,_+i/2),l=Math.min(l,_-i/2),s=Math.max(s,o.Y+r/2),d=Math.min(d,o.Y-r/2);for(const e of o.ItemInfo){var g=e.X;a=Math.max(a,g+e.W/2),l=Math.min(l,g-e.W/2),s=Math.max(s,e.Y+e.H/2),d=Math.min(d,e.Y-e.H/2)}}0}}var f=parseFloat(a)-parseFloat(l),p=parseFloat(s)-parseFloat(d),c=f/2,I=p/2;return logDebug("function : get_module_final_xy","E"),f+"###"+p+"###"+c+"###"+I+"###"+l+"###"+d+"###"+a+"###"+s}catch(e){error_handling(e)}}function get_min_max_xy_combine(e,o){logDebug("function : get_min_max_xy","S");try{var t=0,n=0,i=0,r=0,a=0,l=0,s=0,d=-1,_=-1;if(void 0!==e&&e.length>0)if(e[0].H<=.2){console.log("if",e[0].H),t=e[0].W,n=0,i=e[0].H,r=0;var g=0;for(const I of e[0].ModuleInfo){if(void 0===I.ParentModule||null==I.ParentModule){if(void 0!==e[0].ModuleInfo[g].Carpark&&null!==e[0].ModuleInfo[g].Carpark&&e[0].ModuleInfo[g].Carpark.length>0){var f=0;for(const e of I.Carpark){0!==e.Rotation||0!==e.Slope?(a=void 0===e.ShelfRotateWidth?e.W:e.ShelfRotateWidth,l=void 0===e.ShelfRotateHeight?e.W:e.ShelfRotateHeight):(a=e.W,l=e.H),"TEXTBOX"==e.ObjType&&s<e.H&&(s=e.H,d=g,_=f),t=Math.max(t,e.X+a/2-o),n=Math.min(n,e.X-a/2-o),i=Math.max(i,e.Y+l/2),r=Math.min(r,e.Y-l/2);var p=0;for(const a of e.ItemInfo)t=Math.max(t,a.X+a.W/2-o),n=Math.min(n,a.X-a.W/2-o),i=Math.max(i,a.Y+a.H/2),r=Math.min(r,a.Y-a.H/2),p=p++;f=f++}}if(console.log("0",0,g),e[0].ModuleInfo[g].ShelfInfo.length>0){var c=0;for(const e of I.ShelfInfo)"BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&(0!==e.Rotation||0!==e.Slope?(a=void 0===e.ShelfRotateWidth?e.W:e.ShelfRotateWidth,l=void 0===e.ShelfRotateHeight?e.W:e.ShelfRotateHeight):(a=e.W,l=e.H),"TEXTBOX"==e.ObjType&&s<e.H&&(s=e.H,d=g,_=c)),t=Math.max(t,e.X+a/2-o),n=Math.min(n,e.X-a/2-o),i=Math.max(i,e.Y+l/2),r=Math.min(r,e.Y-l/2),c++}}g++}var I=parseFloat(t)-parseFloat(n),m=parseFloat(i)-parseFloat(r);if(-1!==d&&-1!==_)var h=e[0].ModuleInfo[d].ShelfInfo[_].X,u=e[0].ModuleInfo[d].ShelfInfo[_].Y;else h=parseFloat(n)+I/2,u=parseFloat(r)+m/2}else{t=e[0].W,n=0,i=e[0].H,r=0;g=0;for(const I of e[0].ModuleInfo){if(void 0===I.ParentModule||null==I.ParentModule){if(void 0!==e[0].ModuleInfo[g].Carpark&&null!==e[0].ModuleInfo[g].Carpark&&e[0].ModuleInfo[g].Carpark.length>0){f=0;for(const e of I.Carpark){0!==e.Rotation||0!==e.Slope?(a=void 0===e.ShelfRotateWidth?e.W:e.ShelfRotateWidth,l=void 0===e.ShelfRotateHeight?e.W:e.ShelfRotateHeight):(a=e.W,l=e.H),"TEXTBOX"==e.ObjType&&s<e.H&&(s=e.H,d=g,_=f),t=Math.max(t,e.X+a/2-o),n=Math.min(n,e.X-a/2-o),i=Math.max(i,e.Y+l/2),r=Math.min(r,e.Y-l/2);p=0;for(const a of e.ItemInfo)t=Math.max(t,a.X+a.W/2-o),n=Math.min(n,a.X-a.W/2-o),i=Math.max(i,a.Y+a.H/2),r=Math.min(r,a.Y-a.H/2),p++;f++}}if(e[0].ModuleInfo[g].ShelfInfo.length>0){c=0;for(const e of I.ShelfInfo){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType){0!==e.Rotation||0!==e.Slope?(a=void 0===e.ShelfRotateWidth?e.W:e.ShelfRotateWidth,l=void 0===e.ShelfRotateHeight?e.W:e.ShelfRotateHeight):(a=e.W,l=e.H),t=Math.max(t,e.X+a/2-o),n=Math.min(n,e.X-a/2-o),i=Math.max(i,e.Y+l/2),r=Math.min(r,e.Y-l/2);p=0;"TEXTBOX"==e.ObjType&&(e.ItemInfo=[]);for(const a of e.ItemInfo)t=Math.max(t,a.X+a.W/2-o),n=Math.min(n,a.X-a.W/2-o),i=Math.max(i,a.Y+a.H/2),r=Math.min(r,a.Y-a.H/2),p++}c++}}}g++}I=parseFloat(t)-parseFloat(n),m=parseFloat(i)-parseFloat(r),h=parseFloat(n)+I/2,u=parseFloat(r)+m/2}return logDebug("function : get_min_max_xy","E"),I+"###"+m+"###"+h+"###"+u+"###"+n+"###"+r}catch(e){error_handling(e)}}function get_min_max_xy(e){logDebug("function : get_min_max_xy","S");try{var o=0,t=0,n=0,i=0,r=0,a=0,l=0,s=-1,d=-1;if(void 0!==g_pog_json&&g_pog_json.length>0)if(g_pog_json[e].H<=.2){console.log("if",g_pog_json[e].H),o=g_pog_json[e].W,t=0,n=g_pog_json[e].H,i=0;var _=0;for(const c of g_pog_json[e].ModuleInfo){if(void 0===c.ParentModule||null==c.ParentModule){if(void 0!==g_pog_json[e].ModuleInfo[_].Carpark&&null!==g_pog_json[e].ModuleInfo[_].Carpark&&g_pog_json[e].ModuleInfo[_].Carpark.length>0){var g=0;for(const e of c.Carpark){0!==e.Rotation||0!==e.Slope?(r=void 0===e.ShelfRotateWidth?e.W:e.ShelfRotateWidth,a=void 0===e.ShelfRotateHeight?e.W:e.ShelfRotateHeight):(r=e.W,a=e.H),"TEXTBOX"==e.ObjType&&l<e.H&&(l=e.H,s=_,d=g),o=Math.max(o,e.X+r/2),t=Math.min(t,e.X-r/2),n=Math.max(n,e.Y+a/2),i=Math.min(i,e.Y-a/2);var f=0;for(const r of e.ItemInfo)o=Math.max(o,r.X+r.W/2),t=Math.min(t,r.X-r.W/2),n=Math.max(n,r.Y+r.H/2),i=Math.min(i,r.Y-r.H/2),f=f++;g=g++}}if(console.log("p_pog_index",e,_),g_pog_json[e].ModuleInfo[_].ShelfInfo.length>0){var p=0;for(const e of c.ShelfInfo)"BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&(0!==e.Rotation||0!==e.Slope?(r=void 0===e.ShelfRotateWidth?e.W:e.ShelfRotateWidth,a=void 0===e.ShelfRotateHeight?e.W:e.ShelfRotateHeight):(r=e.W,a=e.H),"TEXTBOX"==e.ObjType&&l<e.H&&(l=e.H,s=_,d=p)),o=Math.max(o,e.X+r/2),t=Math.min(t,e.X-r/2),n=Math.max(n,e.Y+a/2),i=Math.min(i,e.Y-a/2),p++}}_++}var c=parseFloat(o)-parseFloat(t),I=parseFloat(n)-parseFloat(i);if(-1!==s&&-1!==d)var m=g_pog_json[e].ModuleInfo[s].ShelfInfo[d].X,h=g_pog_json[e].ModuleInfo[s].ShelfInfo[d].Y;else m=parseFloat(t)+c/2,h=parseFloat(i)+I/2}else{o=g_pog_json[e].W,t=0,n=g_pog_json[e].H,i=0;_=0;for(const c of g_pog_json[e].ModuleInfo){if(void 0===c.ParentModule||null==c.ParentModule){if(void 0!==g_pog_json[e].ModuleInfo[_].Carpark&&null!==g_pog_json[e].ModuleInfo[_].Carpark&&g_pog_json[e].ModuleInfo[_].Carpark.length>0){g=0;for(const e of c.Carpark){0!==e.Rotation||0!==e.Slope?(r=void 0===e.ShelfRotateWidth?e.W:e.ShelfRotateWidth,a=void 0===e.ShelfRotateHeight?e.W:e.ShelfRotateHeight):(r=e.W,a=e.H),"TEXTBOX"==e.ObjType&&l<e.H&&(l=e.H,s=_,d=g),o=Math.max(o,e.X+r/2),t=Math.min(t,e.X-r/2),n=Math.max(n,e.Y+a/2),i=Math.min(i,e.Y-a/2);f=0;for(const r of e.ItemInfo)o=Math.max(o,r.X+r.W/2),t=Math.min(t,r.X-r.W/2),n=Math.max(n,r.Y+r.H/2),i=Math.min(i,r.Y-r.H/2),f++;g++}}if(g_pog_json[e].ModuleInfo[_].ShelfInfo.length>0){p=0;for(const e of c.ShelfInfo){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType){0!==e.Rotation||0!==e.Slope?(r=void 0===e.ShelfRotateWidth?e.W:e.ShelfRotateWidth,a=void 0===e.ShelfRotateHeight?e.W:e.ShelfRotateHeight):(r=e.W,a=e.H),o=Math.max(o,e.X+r/2),t=Math.min(t,e.X-r/2),n=Math.max(n,e.Y+a/2),i=Math.min(i,e.Y-a/2);f=0;"TEXTBOX"==e.ObjType&&(e.ItemInfo=[]);for(const r of e.ItemInfo)o=Math.max(o,r.X+r.W/2),t=Math.min(t,r.X-r.W/2),n=Math.max(n,r.Y+r.H/2),i=Math.min(i,r.Y-r.H/2),f++}p++}}}_++}c=parseFloat(o)-parseFloat(t),I=parseFloat(n)-parseFloat(i),m=parseFloat(t)+c/2,h=parseFloat(i)+I/2}return logDebug("function : get_min_max_xy","E"),c+"###"+I+"###"+m+"###"+h+"###"+t+"###"+i}catch(e){error_handling(e)}}async function recreate_image_items(e,o,t,n,i,r,a,l,s,d,_="Y",g="N,0.018",f){logDebug("function : recreate_image_items; show_live_ind : "+e,"S");try{console.log("live image called"),g_world=g_scene_objects[d].scene.children[2];var p=0,c=g_pog_json[d].ModuleInfo;for(const _ of c){if(void 0===_.ParentModule||null==_.ParentModule){if(_.ShelfInfo.length>0){j=0;for(const g of _.ShelfInfo){if("BASE"!==g.ObjType&&"NOTCH"!==g.ObjType&&"DIVIDER"!==g.ObjType&&"TEXTBOX"!==g.ObjType){x=0;for(const s of g.ItemInfo){if("DIVIDER"!==s.Item){var I=g_world.getObjectById(s.ObjID);if(g_world.remove(I),"Y"==e&&3!=s.MerchStyle)var m=g_orientation_json[s.Orientation].split("###"),h=await add_items_with_image(s.ItemID,s.W,s.H,s.D,s.Color,s.X,s.Y,s.Z,p,j,x,s.BHoriz,s.BVert,s.Item,parseInt(m[0]),parseInt(m[1]),"N","N",o,t,n,i,r,a,d);else h=await add_items_prom(s.ItemID,s.W,s.H,s.D,s.Color,s.X,s.Y,s.Z,p,j,x,"N","N",l,i,a,i,r,d);if(g_pog_json[d].ModuleInfo[p].ShelfInfo[j].ItemInfo[x].ObjID=h,"N"==e){I=g_world.getObjectById(h);"E"==s.DimUpdate?(I.BorderColour=g_dim_error_color,I.WireframeObj.material.color.setHex(I.BorderColour)):"N"==s.Status?(I.BorderColour=g_status_error_color,I.Status="N",I.WireframeObj.material.color.setHex(I.BorderColour)):"No"==nvl(s.MovingItem)&&"Y"==g_pogcr_auto_hlite_non_mv_item?(I.BorderColour=g_nonMovingItemColor,I.WireframeObj.material.color.setHex(I.BorderColour)):nvl(s.OOSPerc)>80&&"Y"==g_pogcr_enbl_oos_border?(I.BorderColour=g_pogcr_oos_border_color,I.WireframeObj.material.color.setHex(I.BorderColour)):I.BorderColour=0}else"E"==s.DimUpdate?I.BorderColour=g_dim_error_color:"N"==s.Status&&void 0!==I?(I.BorderColour=g_status_error_color,I.Status="N"):"No"==nvl(s.MovingItem)&&"Y"==g_pogcr_auto_hlite_non_mv_item&&0!==nvl(I)?(I.BorderColour=g_nonMovingItemColor,I.WireframeObj.material.color.setHex(I.BorderColour)):(nvl(s.OOSPerc)>80&&"Y"==g_pogcr_enbl_oos_border?(I.BorderColour=g_pogcr_oos_border_color,I.WireframeObj.material.color.setHex(I.BorderColour)):I.BorderColour=0,void 0!==I&&(I.BorderColour=0))}x++}if("SHELF"==g.ObjType||"PALLET"==g.ObjType)reset_top_bottom_objects(p,j,"N",d)}else if(""!==g.TextImg&&void 0!==g.TextImg&&"TEXTBOX"==g.ObjType&&null!==g.TextImg){var u=parseInt(g.Color.replace("#","0x"),16),S=new THREE.Color(u);if("#"==g.Color.charAt(1)&&"TEXTBOX"==g.ObjType)var D=null;else D=u;if("Y"==e&&""!==g.TextImg&&void 0!==g.TextImg&&null!==g.TextImg)var b=await add_text_box_with_image(g.Shelf,"TEXTBOX",g.W,g.H,g.D,S,g.X,g.Y,g.Z,"Y",p,g.InputText,D,g.WrapText,g.ReduceToFit,g.Color,j,g.Rotation,g.Slope,"N",g.FStyle,g.FSize,g.FBold,s,d);else{g_dblclick_objid=g.SObjID,g_shelf_index=j;b=add_text_box(g.Shelf,"TEXTBOX",g.W,g.H,g.D,S,g.X,g.Y,g.Z,"Y",p,g.InputText,D,g.WrapText,g.ReduceToFit,g.Color,j,g.Rotation,g.Slope,"N",g.FStyle,g.FSize,g.FBold,2,d,g_pogcr_enhance_textbox_fontsize,g.TextDirection)}var v=-1,O=0;for(const e of g_pog_json[d].ModuleInfo)null!==e.ParentModule&&e.Module==g.Shelf&&(v=O),O++;-1!==v&&(g_pog_json[d].ModuleInfo[v].ObjID=b)}j+=1}}if(void 0!==_.Carpark[0]&&_.Carpark[0].ItemInfo.length>0){k=0;for(const o of _.Carpark[0].ItemInfo){I=g_world.getObjectById(o.ObjID);g_world.remove(I);m=g_orientation_json[o.Orientation].split("###"),h=await add_carpark_item(o.ItemID,o.W,o.H,o.D,o.Color,o.X,o.Y,o.Z,p,0,k,"Y","N",e,parseInt(m[1]),d);g_pog_json[d].ModuleInfo[p].Carpark[0].ItemInfo[k].ObjID=h,k+=1}}}p+=1}"Y"==_&&await showHideDaysOfSupplyLabel(g_show_days_of_supply,"N",d,"Y","N",g,f),logDebug("function : recreate_image_items","E")}catch(e){error_handling(e)}}function reset_top_bottom_objects(e,o,t,n){logDebug("function : reset_top_bottom_objects; p_module_index : "+e+"; p_shelf_index : "+o+"; reset_obj : "+t,"S");try{if(void 0!==g_pog_json[n]&&void 0!==g_pog_json[n].ModuleInfo[e]){var i=g_pog_json[n].ModuleInfo[e].ShelfInfo[o];return new Promise((function(r,a){if(void 0!==i){var l=i.ItemInfo,s=[];p=0;var d=i.Y+i.H/2;for(const e of l)i.ItemInfo[p].BottomObjID="",i.ItemInfo[p].TopObjID="",p+=1;var _=0;for(const r of l){var g="N",f=wpdSetFixed(r.X-r.W/2),c=wpdSetFixed(r.X+r.W/2);p=0;for(const e of l){if(wpdSetFixed(e.X)==wpdSetFixed(r.X)&&-1==s.indexOf(wpdSetFixed(r.X))&&_!==p){s.push(wpdSetFixed(r.X)),g="Y";break}p+=1}if("Y"==g){var I=[];p=0;for(const e of l){if("PALLET"!==i.ObjType?wpdSetFixed(e.X)==wpdSetFixed(r.X)||wpdSetFixed(e.X)>f&&wpdSetFixed(e.X)<c:(wpdSetFixed(e.X)==wpdSetFixed(r.X)||wpdSetFixed(e.X)>f&&wpdSetFixed(e.X)<c)&&wpdSetFixed(e.Z)==wpdSetFixed(r.Z)){var m={};m.Y=e.Y,m.Index=p,I.push(m)}p+=1}I.keySort({Y:"asc"}),p=0;for(const r of I){if(0==p&&(i.ItemInfo[I[p].Index].Y=d+i.ItemInfo[I[p].Index].H/2),void 0!==I[p+1]&&void 0!==i.ItemInfo[I[p+1].Index]&&(i.ItemInfo[I[p+1].Index].Y=i.ItemInfo[I[p].Index].Y+i.ItemInfo[I[p].Index].H/2+i.ItemInfo[I[p+1].Index].H/2,i.ItemInfo[I[p+1].Index].BottomObjID=i.ItemInfo[I[p].Index].ObjID,i.ItemInfo[I[p].Index].TopObjID=i.ItemInfo[I[p+1].Index].ObjID,total_height=get_y_distance(e,o,I[p+1].Index,i.ItemInfo[I[p+1].Index].X,i.ItemInfo[I[p+1].Index].Y,n),i.ItemInfo[I[p+1].Index].TotalHeight=total_height,"Y"==t)){var h=g_scene_objects[n].scene.children[2].getObjectById(i.ItemInfo[I[p+1].Index].ObjID);void 0!==h&&(h.position.set(i.ItemInfo[I[p].Index].X,i.ItemInfo[I[p+1].Index].Y,.001+i.D/1e3),"PEGBOARD"==i.ObjType?h.position.z=.016:"PALLET"!==i.ObjType&&(h.position.z=.001+i.D/1e3))}p+=1}}_+=1}}r("SUCCES"),logDebug("function : reset_top_bottom_objects","E")}))}}catch(e){error_handling(e)}}async function create_module_from_json_lib(e,o,t,n,i,r,a,l,s,d,_,g,f,p,c,I,m,h,u,S,D,b,v,x,O,C,j,M,y,H,w,T,F,N,E,B,W,R,P,Y,A,k,z="N",X,L,V,G,U,Z,J,Q,q){try{var K,ee,oe={};if(g_show_live_image="Y"==g_show_item_desc?"N":g_show_live_image,"Y"==a){var te;"N"==f&&(t=e[G].DesignType),null==(ie=e[G].ModuleInfo)&&(e[G].ModuleInfo=[],ie=[]),fe=0;for(const e of ie){if(null!=e.ShelfInfo&&void 0!==e.ShelfInfo||(e.ShelfInfo=[]),null!=e.ChestInfo&&void 0!==e.ChestInfo||(e.ChestInfo=[]),void 0===e.ParentModule||null==e.ParentModule){null!==e.SubDept&&void 0!==e.SubDept&&(te=e.SubDept),ce=0;for(const o of e.ShelfInfo)void 0!==o.ItemInfo&&null!=o.ItemInfo||(o.ItemInfo=[]),ce+=1}fe+=1}if(oe.Action="C",e[G].GenrateCombineS=void 0!==e[G].GenrateCombineS&&null!==e[G].GenrateCombineS?e[G].GenrateCombineS:[],e[G].SubDept=void 0===e[G].SubDept||null==e[G].SubDept?te:e[G].SubDept,oe.Version=""==e[G].Version&&""!==_?_:e[G].Version,"N"==o&&"F"==t){var ne=[],ie=e[G].ModuleInfo;fe=0;for(const e of ie)void 0!==e.ParentModule&&null!=e.ParentModule||ne.push(e.H);if("undefined"==e[G].BaseH||null==e[G].BaseH||0==e[G].BaseH){var re=parseFloat(Math.max.apply(Math,ne)),ae=parseFloat(e[G].H-re);oe.BaseH=wpdSetFixed(ae)}else oe.BaseH=wpdSetFixed(e[G].BaseH);oe.DesignType="D",oe.DraftVersion=e[G].draftVersion,oe.BaseW=wpdSetFixed(e[G].W),oe.BaseD=wpdSetFixed(e[G].D),oe.BaseX=wpdSetFixed(oe.BaseW/2),oe.BaseY=wpdSetFixed(oe.BaseH/2),oe.NewPOG=e[G].NewPOG,void 0===e[G].SubDept?oe.SubDept="":oe.SubDept=e[G].SubDept,oe.BackDepth=.01,oe.TrafficFlow="LR",oe.HorzStart=0,oe.HorzSpacing=0,oe.VertStart=0,oe.VertSpacing=0,oe.AllowOverlap="N","Y"==$v("P25_POG_EFFECTIVE_START_DATE_UPD")?e[G].EffStartDate<l?oe.EffStartDate=l:oe.EffStartDate=e[G].EffStartDate:"Y"==$v("P25_POG_EFF_START_DATE_UPDATE")?e[G].EffStartDate>l+1?oe.EffStartDate=e[G].EffStartDate:oe.EffStartDate=l+1:oe.EffStartDate=moment(e[G].EffStartDate,get_js_date_format()).format("YYYYMMDD")}else oe.DesignType="D",oe.DraftVersion=e[G].draftVersion,oe.SubDept=e[G].SubDept,oe.BackDepth=e[G].BackDepth,oe.TrafficFlow=e[G].TrafficFlow,oe.HorzStart=e[G].HorzStart,oe.HorzSpacing=e[G].HorzSpacing,oe.VertStart=e[G].VertStart,oe.VertSpacing=e[G].VertSpacing,oe.AllowOverlap=e[G].AllowOverlap,oe.BaseH=wpdSetFixed(e[G].BaseH),oe.BaseW=wpdSetFixed(e[G].BaseW),oe.BaseD=wpdSetFixed(e[G].BaseD),oe.BaseX=wpdSetFixed(e[G].BaseX),oe.BaseY=wpdSetFixed(e[G].BaseY),oe.NewPOG=e[G].NewPOG,"Y"==$v("P25_POG_EFFECTIVE_START_DATE_UPD")&&e[G].EffStartDate<l?oe.EffStartDate=l:oe.EffStartDate=e[G].EffStartDate;oe.POGCode=e[G].POGCode,oe.Opened=i,oe.Name=e[G].Name,oe.Division=e[G].Division,oe.Dept=e[G].Dept,oe.Type=e[G].Type,oe.H=wpdSetFixed(e[G].H),oe.W=wpdSetFixed(e[G].W),oe.D=wpdSetFixed(e[G].D),oe.SegmentW=wpdSetFixed(e[G].SegmentW),oe.NotchW=wpdSetFixed(e[G].NotchW);var le=0;le=Z>-1&&0==e[G].NotchStart&&e[G].NotchW>0?Z/100:e[G].NotchStart,oe.NotchStart=le,oe.NotchSpacing=e[G].NotchSpacing,oe.SpecialType=e[G].SpecialType,oe.SpecialTypeDesc=e[G].SpecialTypeDesc,oe.DisplayMeterage=e[G].DisplayMeterage,oe.RPTMeterage=e[G].RPTMeterage,oe.ModuleDIR=e[G].ModuleDIR,oe.Direction=e[G].Direction,oe.OrderType=e[G].OrderType,oe.StartOneFixel=e[G].StartOneFixel,oe.StartOneModuleLoc=e[G].StartOneModuleLoc,oe.Ignore=e[G].Ignore,oe.StartOneModuleFixel=e[G].StartOneModuleFixel,oe.IncludeModName=e[G].IncludeModName,oe.Separator=e[G].Separator,oe.LeadingText=e[G].LeadingText,oe.TrailingText=e[G].TrailingText,oe.BrandGroupID=e[G].BrandGroupID,oe.Remarks=e[G].Remarks,oe.FixtureGeneration=e[G].FixtureGeneration,oe.FixtureFamily=e[G].FixtureFamily,oe.FixtureFamilyHidden=void 0===e[G].FixtureFamilyHidden?e[G].FixtureFamily:e[G].FixtureFamilyHidden,oe.FixtureType=e[G].FixtureType,oe.FixtureTypeDesc=void 0===e[G].FixtureTypeDesc?e[G].FixtureType:e[G].FixtureTypeDesc,oe.FixtureCodes=void 0===e[G].FixtureCodes?"":e[G].FixtureCodes,oe.FixtureCount=void 0===e[G].FixtureCount?"":e[G].FixtureCount,oe.Flex_Text_1=e[G].Flex_Text_1,oe.Flex_Text_2=e[G].Flex_Text_2,oe.Flex_Text_3=e[G].Flex_Text_3,oe.Flex_Text_4=e[G].Flex_Text_4,oe.Flex_Text_11=e[G].Flex_Text_11,oe.Flex_Text_12=e[G].Flex_Text_12,oe.Flex_Text_13=e[G].Flex_Text_13,oe.Flex_Text_14=e[G].Flex_Text_14,oe.Flex_Text_15=void 0!==e[G].Flex_Text_15&&null!==e[G].Flex_Text_15&&""!==e[G].Flex_Text_15?e[G].Flex_Text_15:e[G].FixtureGroup,oe.FixtureGroup=e[G].FixtureGroup,oe.Flex_Lov_1=e[G].Flex_Lov_1,oe.Flex_Lov_2=e[G].Flex_Lov_2,oe.Flex_Lov_3=e[G].Flex_Lov_3,oe.Flex_Lov_4=e[G].Flex_Lov_4,oe.Flex_Lov_5=e[G].Flex_Lov_5,oe.Flex_Lov_6=e[G].Flex_Lov_6,oe.StoreSegment=e[G].StoreSegment,oe.Desc7=e[G].Desc7,oe.Area=e[G].Area,oe.PLNDept=e[G].PLNDept,oe.CompBaseObjID=e[G].CompBaseObjID,oe.CompCamX=e[G].CompCamX,oe.CompCamY=e[G].CompCamY,oe.CompCamWidth=e[G].CompCamWidth,oe.CompCamHeight=e[G].CompCamHeight,void 0===e[G].Color?oe.Color=s:oe.Color=e[G].Color,oe.BaseZ=wpdSetFixed(e[G].BaseZ),oe.p_cameraX=e[G].p_cameraX,oe.p_cameraY=e[G].p_cameraY,oe.p_cameraZ=e[G].p_cameraZ,oe.X=wpdSetFixed(e[G].X),oe.Y=wpdSetFixed(e[G].Y),oe.Category=e[G].Category,oe.SubCategory=e[G].SubCategory,oe.GenrateCombineS=e[G].GenrateCombineS,void 0!==e[G].SalesInfo&&e[G].SalesInfo.length>0?oe.SalesInfo=e[G].SalesInfo:oe.SalesInfo=[],oe.MassUpdate=void 0!==e[G].MassUpdate&&null!==e[G].MassUpdate&&""!==e[G].MassUpdate?e[G].MassUpdate:"N",void 0===e[G].PromStartDt?oe.PromStartDt="":oe.PromStartDt=e[G].PromStartDt,void 0===e[G].PromEndDt?oe.PromEndDt="":oe.PromEndDt=e[G].PromEndDt,void 0===e[G].PromName?oe.PromName="":oe.PromName=e[G].PromName,void 0===e[G].PDFTemplateName?oe.PDFTemplateName="":oe.PDFTemplateName=e[G].PDFTemplateName,void 0===e[G].ComparePogVersion?oe.ComparePogVersion="":oe.ComparePogVersion=e[G].ComparePogVersion,void 0===e[G].StoreFormat?oe.StoreFormat="":oe.StoreFormat=e[G].StoreFormat,oe.SalesRrshDtl=e[G].SalesRrshDtl,void 0!==e[G].PreVersion?oe.PreVersion=e[G].PreVersion:oe.PreVersion="N",oe.ModuleInfo=[],null!=e[G].DeleteItems&&void 0!==e[G].DeleteItems?oe.DeleteItems=e[G].DeleteItems:oe.DeleteItems=[],null!=e[G].MassDelistedItem&&void 0!==e[G].MassDelistedItem?oe.MassDelistedItem=e[G].MassDelistedItem:oe.MassDelistedItem=[],g_pog_json[G]=oe,oe.X=wpdSetFixed(K),oe.Y=wpdSetFixed(ee)}else oe=g_pog_json[G];create_g_combine_shelfs(e,G),K=wpdSetFixed(oe.W/2),ee=wpdSetFixed(oe.H/2+oe.BaseH),oe.H/2,parseFloat(oe.BaseH)/2;var se=parseInt(oe.Color.replace("#","0x"),16),de=new THREE.Color(se);if("Y"==r){var _e=get_min_max_xy(G).split("###");set_camera_z(V,parseFloat(_e[2]),parseFloat(_e[3]),parseFloat(_e[0]),parseFloat(_e[1]),g_offset_z,parseFloat(_e[4]),parseFloat(_e[5]),!0,G)}if(oe.BaseH>0&&"Y"==r)await add_base("BASE1",oe.BaseW,oe.BaseH,oe.BaseD,de,oe.BaseX,oe.BaseY,"N",G);var ge=[];if(g){ge=JSON.parse(JSON.stringify(e));var fe=0,pe=-1;for(const e of ge[G].ModuleInfo){if(void 0===e.ParentModule||null==e.ParentModule){-1==pe?(K=wpdSetFixed(e.W/2),ee=wpdSetFixed(e.H/2+oe.BaseH)):(K=wpdSetFixed(ge[G].ModuleInfo[pe].X+ge[G].ModuleInfo[pe].W/2+e.W/2),ee=wpdSetFixed(e.H/2+oe.BaseH)),ge[G].ModuleInfo[fe].X=K,ge[G].ModuleInfo[fe].Y=ee,pe=fe;var ce=0;if(e.ShelfInfo.sort(((e,o)=>e.Y>o.Y&&"NOTCH"!==e.ObjType&&"BASE"!==e.ObjType?1:-1)),"N"==o&&"F"==t)for(const o of e.ShelfInfo)ge[G].ModuleInfo[fe].ShelfInfo[ce].X=wpdSetFixed(o.X+parseFloat(o.W)/2),ge[G].ModuleInfo[fe].ShelfInfo[ce].Y=wpdSetFixed(o.Y+parseFloat(o.H)/2),ce+=1}fe++}}if(void 0!==e[G].ModuleInfo&&e[G].ModuleInfo.length>0){ie=e[G].ModuleInfo;var Ie={SeqNo:"asc"};if(ie.keySort(Ie),void 0!==g_json&&g_json.length>0){var me=g_json[0].ModuleInfo;me.keySort(Ie);fe=0;for(const e of me)e.ShelfInfo.length>0&&$.each(e.ShelfInfo,(function(e,o){void 0!==o&&"BASE"==o.ObjType&&g_json[0].ModuleInfo[fe].ShelfInfo.splice(e,1)})),fe++}fe=0;var he=-1;for(const n of ie){n.ShelfInfo.length>0&&$.each(n.ShelfInfo,(function(o,t){void 0!==t&&"BASE"==t.ObjType&&e[G].ModuleInfo[fe].ShelfInfo.splice(o,1)}));var ue={};if("Y"==a){"N"==o&&"F"==t?(void 0===n.SubDept?ue.SubDept="":ue.SubDept=n.SubDept,ue.Rotation=0,ue.HorzStart=0,ue.HorzSpacing=0,ue.VertStart=0,ue.VertSpacing=0,ue.AllowOverlap="N",ue.LNotch=0,ue.Backboard=1,ue.RNotch=0,ue.LastCount=0,ue.EditFlag="N",void 0!==n.Carpark&&null!==n.Carpark&&void 0!==n.Carpark[0]?null==n.Carpark[0].ItemInfo?ue.Carpark=[]:void 0!==n.Carpark[0].ItemInfo?n.Carpark[0].ItemInfo.length>0?ue.Carpark=n.Carpark:ue.Carpark=[]:n.Carpark.length>0?ue.Carpark=n.Carpark:ue.Carpark=[]:ue.Carpark=[]):(ue.SubDept=n.SubDept,ue.Rotation=n.Rotation,ue.HorzStart=n.HorzStart,ue.HorzSpacing=n.HorzSpacing,ue.VertStart=n.VertStart,ue.VertSpacing=n.VertSpacing,ue.AllowOverlap=n.AllowOverlap,ue.LNotch=n.LNotch,ue.Backboard=n.Backboard,ue.RNotch=n.RNotch,ue.LastCount=n.LastCount,ue.EditFlag=void 0!==n.EditFlag?n.EditFlag:"N",void 0!==n.Carpark&&null!==n.Carpark&&void 0!==n.Carpark[0]?null==n.Carpark[0].ItemInfo?ue.Carpark=[]:void 0!==n.Carpark[0].ItemInfo?n.Carpark[0].ItemInfo.length>0?ue.Carpark=n.Carpark:ue.Carpark=[]:n.Carpark.length>0?ue.Carpark=n.Carpark:ue.Carpark=[]:ue.Carpark=[]),ue.SeqNo=n.SeqNo,ue.Module=n.Module,void 0===n.ParentModule?ue.ParentModule=null:ue.ParentModule=n.ParentModule,ue.ParentModuleIndex=n.ParentModuleIndex,ue.POGModuleName=n.ModuleName,ue.Remarks=n.Remarks,ue.H=wpdSetFixed(n.H),ue.W=wpdSetFixed(n.W),ue.D=wpdSetFixed(n.D),void 0===n.Color?ue.Color=d:ue.Color=n.Color,ue.NotchW=n.NotchW;le=0;le=Z>-1&&0==n.NotchStart&&n.NotchW>0?Z/100:n.NotchStart,ue.NotchStart=le,ue.NotchSpacing=n.NotchSpacing,ue.CompMObjID=n.CompMObjID,n.NotchW>0&&(g_pog_json[G].NotchW=n.NotchW,g_pog_json[G].NotchStart=n.NotchStart,g_pog_json[G].NotchSpacing=n.NotchSpacing),0==fe?(K=wpdSetFixed(ue.W/2),ee=wpdSetFixed(ue.H/2+g_pog_json[G].BaseH)):(K=wpdSetFixed(g_pog_json[G].ModuleInfo[g_pog_json[G].ModuleInfo.length-1].X+ue.W/2),ee=wpdSetFixed(ue.H/2+g_pog_json[G].BaseH)),ue.X=K,ue.Y=ee,ue.Z=0,ue.ChestInfo=null!==n.ChestInfo&&void 0!==n.ChestInfo&&""!==n.ChestInfo?n.ChestInfo:[],ue.SvnCode=n.SvnCode,ue.EgtCode=n.EgtCode,ue.ShelfInfo=[],g_pog_json[G].ModuleInfo.push(ue),he=g_pog_json[G].ModuleInfo.length-1}else ue=n,K=wpdSetFixed(n.X),ee=wpdSetFixed(n.Y),he=fe;if((void 0===n.ParentModule||null==n.ParentModule)&&"Y"==r){g_pog_json[G].SegmentW=n.W;se=parseInt(ue.Color.replace("#","0x"),16),de=new THREE.Color(se),await add_module_lib(n.Module,n.W,n.H,n.D,de,K,ee,"N","Y",n.VertStart,n.VertSpacing,n.HorzStart,n.HorzSpacing,"Y",V,he,c,I,m,h,u,S,D,b,v,x,O,C,j,M,y,H,w,T,F,N,E,B,W,R,P,Y,A,k,z,G,X,L,J)}if(void 0!==n.Carpark&&null!==n.Carpark&&n.Carpark.length>0){"N";await create_shelf_edit_pog_lib(fe,n.Carpark,n.W,"Y",o,t,"Y",r,a,S,x,O,C,j,M,y,H,T,F,N,E,B,W,R,P,Y,A,k,z,V,G,U,J)}if(e[G].ModuleInfo[fe].ShelfInfo.length>0)await create_shelf_from_json_lib(fe,e,n.W,"Y",o,t,r,a,g,ge,f,p,c,I,m,h,u,S,D,b,v,x,y,H,T,F,N,E,B,W,R,P,Y,A,z,k,X,L,V,G,U,J,Q);fe+=1}mod_details=g_pog_json[G].ModuleInfo,temp_mod_details=g_pog_json[G].ModuleInfo;var Se=0;for(const e of mod_details){if(void 0===e.ParentModule||null==e.ParentModule){fe=0;for(shelfs of e.ShelfInfo){console.log(shelfs.AutoDepthCalc,shelfs.SMassUpdate,"values");ce=0;for(items of shelfs.ItemInfo){if(void 0!==shelfs.AutoDepthCalc&&"Y"==shelfs.AutoDepthCalc){var De=g_auto_cal_depth_fac;g_auto_cal_depth_fac="Y",maximizeItemDepthFacings("D",Se,fe,ce,G),g_auto_cal_depth_fac=De}ce++}if("TEXTBOX"==shelfs.ObjType){ce=0;for(tmp_mod of temp_mod_details)void 0!==tmp_mod.ParentModule&&null!==tmp_mod.ParentModule&&tmp_mod.Module==shelfs.Shelf&&(g_pog_json[G].ModuleInfo[ce].ObjID=shelfs.SObjID),ce++}fe++}}Se+=1}}if("Y"==r){_e=get_min_max_xy(G).split("###");set_camera_z(V,parseFloat(_e[2]),parseFloat(_e[3]),parseFloat(_e[0]),parseFloat(_e[1]),g_offset_z,parseFloat(_e[4]),parseFloat(_e[5]),!0,G)}if("Y"==r&&update_rotate_shelfs(G),g_multi_pog_json[G]=g_pog_json[G],void 0!==g_pog_json&&g_pog_json.length>0&&"Y"==r){var be=0;for(let e=0;e<g_combinedShelfs.length;e++)g_combinedShelfs[e][0].PIndex==G&&(g_combinedShelfs.splice(e,1),e--);var ve=g_pog_json[G].ModuleInfo;for(g_module of ve){var xe=0,Oe=g_pog_json[G].ModuleInfo[be].ShelfInfo;for(shelf_info of Oe)"SHELF"!=shelf_info.ObjType&&"HANGINGBAR"!=shelf_info.ObjType||"N"===shelf_info.Combine||await generateCombinedShelfs(G,be,xe,W,N,E,B,R,A,P,"Y",q,"Y"),xe++;be++}}render(G)}catch(e){error_handling(e)}return"SUCCESS"}function add_base(e,o,t,n,i,r,a,l,s){logDebug("function : add_base; uuid : "+e+"; width : "+o+"; height : "+t+"; depth : "+n+"; color : "+i+"; x : "+r+"; y : "+a+"; p_edit_ind : "+l,"S");try{return new Promise((function(n,d){if("Y"==l){var _=g_scene_objects[s].scene.children[2].getObjectById(g_pog_json[s].BaseObjID);g_scene_objects[s].scene.children[2].remove(_)}var g=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshStandardMaterial({color:i})),f=add_wireframe(g,2);g.position.x=r,g.position.y=a,g.position.z=0,g.uuid=e,g_world.add(g),g_pog_json[s].BaseObjID=g.id,g_pog_json[s].BaseX=r,g_pog_json[s].BaseY=a,g_pog_json[s].BaseZ=0,g_pog_json[s].WFrameID=f,n("SUCCESS"),logDebug("function : add_base","E")}))}catch(e){error_handling(e)}}function add_notches(e,o,t,n,i,r,a,l,s,d,_){try{logDebug("function : add_notches; uuid : "+e+"; width : "+o+"; height : "+t+"; start : "+n+"; spacing : "+i+"; color : "+r+"; p_edit_ind : "+a+"; p_module_width : "+l+"; module_count : "+s,"S");var g=2e-4,f=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshStandardMaterial({color:r})),p=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshStandardMaterial({color:r})),c=(add_wireframe(f,2),add_wireframe(p,2),0-parseFloat(o)/2),I=0-parseFloat(t)/2+parseFloat(n),m=0+parseFloat(o)/2,h=0+parseFloat(t)/2,u=I,S=[];S.push(u);for(var D=0;D<1e3&&(u+=parseFloat(i))<h;D++)S.push(u);var b=[];for(D=0;D<S.length;D++)b.push(new THREE.Vector3(c,S[D],0)),b.push(new THREE.Vector3(m,S[D],0));let M=(new THREE.BufferGeometry).setFromPoints(b);var v=new THREE.LineBasicMaterial({color:0}),x=new THREE.LineSegments(M,v),O=new THREE.LineSegments(M,v);x.position.z=5e-4,O.position.z=5e-4,f.add(x),p.add(O);var C=0-parseFloat(l)/2+parseFloat(o)/2,j=0-parseFloat(l)/2+(parseFloat(l)-parseFloat(o)/2);f.position.x=C,f.position.y=0,f.position.z=g,p.position.x=j,p.position.y=0,p.position.z=g,d.add(f),d.add(p),f.uuid=e+1,p.uuid=e+2,g_pog_json[_].ModuleInfo[s].Notch1X=C,g_pog_json[_].ModuleInfo[s].Notch1Y=0,g_pog_json[_].ModuleInfo[s].Notch1Z=g,g_pog_json[_].ModuleInfo[s].Notch1ObjID=f.id,g_pog_json[_].ModuleInfo[s].Notch2X=j,g_pog_json[_].ModuleInfo[s].Notch2Y=0,g_pog_json[_].ModuleInfo[s].Notch2Z=g,g_pog_json[_].ModuleInfo[s].Notch2ObjID=p.id,logDebug("function : add_notches","E")}catch(e){error_handling(e)}}function add_chest_dots_array(e,o,t,n,i,r,a,l,s){var d=0+e/2-0,_=0-o/2+0,g=[],f=[],p=0+o/2-0,c=0-e/2+0;f.push(p);for(var I=0;I<1e3&&(p-=n)>_;I++)f.push(p);g.push(c);for(I=0;I<1e3&&(c+=parseFloat(r))<d;I++)g.push(c);g_pog_json[s].ModuleInfo[l].ShelfInfo[a].peg_vert_values=f,g_pog_json[s].ModuleInfo[l].ShelfInfo[a].peg_horiz_values=g}function add_dots_to_object(e,o,t,n,i,r,a,l,s,d,_,g,f="N",p){try{logDebug("function : add_dots_to_object","S");var c=.01,I=0+e/2-c,m=0-o/2+c,h=[],u=[],S=0+o/2-n-c,D=0-e/2+r+c;u.push(S);for(var b=0;b<1e3&&(S-=i)>m;b++)u.push(S);h.push(D);for(b=0;b<1e3&&(D+=parseFloat(a))<I;b++)h.push(D);var v=[];for(b=0;b<u.length;b++)for(j=0;j<h.length;j++)v.push(new THREE.Vector3(h[j],u[b],-1e-4));let C=(new THREE.BufferGeometry).setFromPoints(v);var x=new THREE.PointsMaterial({size:.03,color:0}),O=new THREE.Points(C,x);return O.position.z="N"==f?"N"==g?6e-4:t:t/2,l.add(O),"N"==f&&(O.uuid="pegdots","PEGBOARD"==s?(g_pog_json[p].ModuleInfo[_].ShelfInfo[d].peg_vert_values=u,g_pog_json[p].ModuleInfo[_].ShelfInfo[d].peg_horiz_values=h):(g_pog_json[p].ModuleInfo[_].peg_vert_values=u,g_pog_json[p].ModuleInfo[_].peg_horiz_values=h)),logDebug("function : add_dots_to_object","E"),l}catch(e){logDebug("function : add_dots_to_object","E"),error_handling(e)}}function add_dots_to_object_3d(e,o,t,n,i,r,a,l,s,d,_){return add_dots_to_object(e,o,t,n,i,r,a,l,s,d,_,null,null,"Y",g_pog_index)}async function create_shelf_from_json_lib(e,o,t,n,i,r,a,l,s,d,_,g,f,p,c,I,m,h,u,S,D,b,v,x,O,C,j,M,y,H,w,T,F,N,E="N",B,W,R,P,Y,A,k="N",z="N"){logDebug("function : create_shelf_from_json_lib; mod_index : "+e+"; p_module_width : "+t+"; draft_ind : "+n+"; new_pog_ind : "+i+"; pog_type : "+r+"; recreate : "+a,"S");try{var X=0;if(o[Y].ModuleInfo[e].ShelfInfo.length>0&&"N"==n&&"Y"==a){g_pog_json[Y].ModuleInfo[e].ShelfInfo.splice(0);var L=0;for(const t of o[Y].ModuleInfo[e].ShelfInfo){var V=g_world.getObjectById(t.SObjID);g_world.remove(V),L++}}if("Y"==_&&(X=o[Y].TotalModWidth),void 0!==o[Y].ModuleInfo[e].ShelfInfo&&o[Y].ModuleInfo[e].ShelfInfo.length>0){(Ve=o[Y].ModuleInfo[e].ShelfInfo).sort(((e,o)=>e.Y>o.Y?1:-1)),"Y"==s&&(copy_shelf=d[Y].ModuleInfo[e].ShelfInfo,copy_shelf.sort(((e,o)=>e.Y>o.Y?1:-1))),g_json.length>0&&(g_json_shelf=g_json[0].ModuleInfo[e].ShelfInfo,g_json_shelf.sort(((e,o)=>e.Y>o.Y?1:-1)));var G=0;for(const t of Ve)if(("DIVIDER"==t.ObjType&&"N"==i&&"F"==r||"DIVIDER"==t.ObjType&&"T"==i&&"D"==r)&&"Y"==l){var U=o[Y].ModuleInfo[e].ShelfInfo,Z=[],$=[];L=0;for(const e of U){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){if("N"==i&&"F"==r)var J=wpdSetFixed(e.X+e.W/2);else J=wpdSetFixed(e.X);wpdSetFixed(e.Y)<wpdSetFixed(t.Y)&&wpdSetFixed(J-e.W)<=wpdSetFixed(t.X-t.W/2)&&wpdSetFixed(J+e.W)>=wpdSetFixed(t.X+t.W/2)&&(Z.push(wpdSetFixed(t.Y-e.Y)),$.push(L))}L++}if(Z.length>0){var Q=Math.min.apply(Math,Z),q=Z.findIndex((function(e){return e==Q}));div_shelf_index=$[q]}else div_shelf_index=0;if("Y"==s){var K=-1,ee=0;for(const t of copy_shelf){if(t.Shelf==o[Y].ModuleInfo[e].ShelfInfo[div_shelf_index].Shelf){K=ee;break}ee++}}console.log("div_shelf_index,",div_shelf_index,Z,$),(pe={}).ItemID=t.Shelf,pe.Item=t.ObjType,pe.W=wpdSetFixed(t.W),pe.H=wpdSetFixed(t.H),pe.D=wpdSetFixed(t.D),pe.Color=t.Color,pe.DimT="",pe.Desc=t.Desc,pe.Barcode="",pe.LocID="",pe.PegID="",pe.PegSpread="",pe.PegPerFacing="",pe.Fixed="N",pe.CapStyle="",pe.CapFacing="",pe.CapMerch="",pe.CapOrientaion="",pe.CapHeight="",pe.CapHorz="",pe.CapDepth="",pe.CapTotalCount="",pe.Rotation=t.Rotation,pe.BHoriz=1,pe.BVert=1,pe.BaseD=1,pe.CrushHoriz=0,pe.CrushVert=0,pe.CrushD=0,pe.Orientation="0",pe.MerchStyle="0",pe.Supplier="",pe.Brand="",pe.BrandType="",pe.Group="",pe.Dept="",pe.Class="",pe.SubClass="",pe.StdUOM="",pe.SizeDesc="",pe.Price="",pe.Cost="",pe.RegMovement="",pe.RegMovementInd="",pe.DaysOfSupplyInd="",pe.MoveBasis="",pe.AvgSales="",pe.AvgSalesInd="",pe.ItemStatus="",pe.CDTLvl1="",pe.CDTLvl2="",pe.CDTLvl3="",pe.ActualDPP="",pe.StoreSOH="",pe.StoreNo="",pe.WeeksOfInventory="",pe.DPPLoc="",pe.CHPerc=0,pe.CWPerc=0,pe.CDPerc=0,pe.ItemNesting=0,pe.NVal=0,pe.ItemContain=0,pe.CnVal=0,pe.IsContainer="N",pe.BsktFactor=0,pe.OverHang=0,pe.HorizGap=0,pe.VertGap=0,pe.UW=0,pe.UH=0,pe.UD=0,pe.CW=0,pe.CH=0,pe.CD=0,pe.TW=0,pe.TH=0,pe.TD=0,pe.DW=0,pe.DH=0,pe.DD=0,pe.CnW=0,pe.CnH=0,pe.CnD=0,pe.NW=0,pe.NH=0,pe.ND=0,pe.OrgUW=0,pe.OrgUH=0,pe.OrgUD=0,pe.OrgCW=0,pe.OrgCH=0,pe.OrgCD=0,pe.OrgTW=0,pe.OrgTH=0,pe.OrgTD=0,pe.OrgDW=0,pe.OrgDH=0,pe.OrgDD=0,pe.OrgCHPerc=0,pe.OrgCWPerc=0,pe.OrgCDPerc=0,pe.OrgCnW=0,pe.OrgCnH=0,pe.OrgCnD=0,pe.OrgNW=0,pe.OrgNH=0,pe.OrgND=0,pe.SIndex=div_shelf_index,pe.Dragged="N",pe.Quantity=1,pe.X=wpdSetFixed(t.X-o[Y].ModuleInfo[e].ShelfInfo[div_shelf_index].X),pe.Y=wpdSetFixed(t.Y),pe.Z=.001,pe.SlotDivider="N",pe.ImgExists="N",pe.CapCount=0,pe.Exists="E",pe.OW=wpdSetFixed(pe.W),pe.OH=wpdSetFixed(pe.H),pe.OD=wpdSetFixed(pe.D),pe.Distance=wpdSetFixed(t.X-o[Y].ModuleInfo[e].ShelfInfo[div_shelf_index].X),pe.YDistance=wpdSetFixed(t.Y-(o[Y].ModuleInfo[e].ShelfInfo[div_shelf_index].Y+o[Y].ModuleInfo[e].ShelfInfo[div_shelf_index].H/2)),pe.SpreadItem=0,pe.MHorizCrushed="N",pe.MVertCrushed="N",pe.MDepthCrushed="N",pe.MCapTopFacing="N",pe.RW=wpdSetFixed(pe.W),pe.RH=wpdSetFixed(pe.H),pe.RD=wpdSetFixed(pe.D),pe.LObjID=-1,pe.SubLblObjID=-1,pe.DimUpdate="N",pe.TopObjID="",pe.BottomObjID="",pe.SecondTier="",pe.CompItemObjID="",pe.SellingPrice="",pe.ShelfPrice="",pe.PromoPrice="",pe.DiscountRate="",pe.PriceChangeDate="",pe.WeeksOfInventory="",pe.Qty="",pe.WhStock="",pe.StoreStock="",pe.StockIntransit="",pe.SalesUnit="",pe.NetSales="",pe.CogsAdj="",pe.CogsAdjInd="",pe.GrossProfit="",pe.GrossProfitInd="",pe.WeeksCount="",pe.WeeksCountInd="",pe.MovingItem="",pe.Profit="",pe.TotalMargin="",pe.MHorizFacings=-1,pe.MVertFacings=-1,pe.MPogDepthFacings="",pe.MPogHorizFacings="",pe.MPogVertFacings="",pe.MDepthFacings=-1,pe.OrientationDesc="Front 0",pe.StoreCnt="",pe.CapMaxH="",pe.MaxHCapStyle="",pe.NewYN="",pe.Delist="N",pe.DescSecond="",pe.NewPegId="",pe.OverhungItem="N",pe.AutoDiv="N",pe.UDA751="",pe.UDA755="",pe.DivHeight=wpdSetFixed(t.DivHeight),pe.DivWidth=wpdSetFixed(t.DivWidth),pe.DivPst=t.DivPst,pe.DivPed=t.DivPed,pe.DivPbtwFace=t.DivPbtwFace,pe.DivStX=isNaN(t.DivStX)?0:t.DivStX,pe.DivSpaceX=isNaN(t.DivSpaceX)?0:t.DivSpaceX,pe.DivFillCol=t.DivFillCol,pe.NoDivIDShow=t.NoDivIDShow,pe.ItemCondition="",pe.AUR="",pe.ItemRanking="",pe.WeeklySales="",pe.WeeklyNetMargin="",pe.WeeklyQty="",pe.NetMarginPercent="",pe.CumulativeNM="",pe.TOP80B2="",pe.ItemBrandC="",pe.ItemPOGDept="",pe.ItemRemark="",pe.RTVStatus="",pe.Pusher="",pe.Divider="",pe.BackSupport="",pe.OOSPerc="",pe.InitialItemDesc="",pe.InitialBrand="",pe.InitialBarcode="",o[Y].ModuleInfo[e].ShelfInfo[div_shelf_index].ItemInfo.push(pe),"Y"==s&&d[Y].ModuleInfo[e].ShelfInfo[K].ItemInfo.splice(0,0,pe),g_json.length>0&&"BASE"!==g_json[0].ModuleInfo[e].ShelfInfo[div_shelf_index].ObjType&&"NOTCH"!==g_json[0].ModuleInfo[e].ShelfInfo[div_shelf_index].ObjType&&"TEXTBOX"!==g_json[0].ModuleInfo[e].ShelfInfo[div_shelf_index].ObjType&&"DIVIDER"!==g_json[0].ModuleInfo[e].ShelfInfo[div_shelf_index].ObjType&&(null!=g_json[0].ModuleInfo[e].ShelfInfo[div_shelf_index].ItemInfo&&void 0!==g_json[0].ModuleInfo[e].ShelfInfo[div_shelf_index].ItemInfo||(g_json[0].ModuleInfo[e].ShelfInfo[div_shelf_index].ItemInfo=[]),g_json[0].ModuleInfo[e].ShelfInfo[div_shelf_index].ItemInfo.splice(0,0,pe))}}if(void 0!==o[Y].ModuleInfo[e].ShelfInfo&&o[Y].ModuleInfo[e].ShelfInfo.length>0){(Ve=o[Y].ModuleInfo[e].ShelfInfo).sort(((e,o)=>e.Y>o.Y&&"NOTCH"!==e.ObjType&&"BASE"!==e.ObjType?1:-1)),g_json.length>0&&(l_json_shelf_details=g_json[0].ModuleInfo[e].ShelfInfo,l_json_shelf_details.sort(((e,o)=>e.Y>o.Y&&"NOTCH"!==e.ObjType&&"BASE"!==e.ObjType?1:-1))),"Y"==s&&(copy_shelf=d[Y].ModuleInfo[e].ShelfInfo,copy_shelf.sort(((e,o)=>e.Y>o.Y&&"NOTCH"!==e.ObjType&&"BASE"!==e.ObjType?1:-1)));G=0;var oe=-1;for(const t of Ve){if("Y"==s){K=-1,ee=0;for(const e of copy_shelf){if(e.Shelf==t.Shelf){K=ee;break}ee++}}var te={};"Y"==l?("N"==i&&"F"==r?(te.GrillH=0,te.LOverhang=null!==t.LOverhang&&""!==t.LOverhang&&void 0!==t.LOverhang?t.LOverhang:0,te.ROverhang=null!==t.ROverhang&&""!==t.ROverhang&&void 0!==t.ROverhang?t.ROverhang:0,te.SpacerThick=0,te.HorizGap=null!==t.HorizGap&&""!==t.HorizGap&&void 0!==t.HorizGap?t.HorizGap:0,te.SpreadItem=null!==t.SpreadItem&&""!==t.SpreadItem&&void 0!==t.SpreadItem?t.SpreadItem:f,te.Combine=null!==t.Combine&&""!==t.Combine&&void 0!==t.Combine?t.Combine:"N",te.AllowAutoCrush=null!==t.AllowAutoCrush&&""!==t.AllowAutoCrush&&void 0!==t.AllowAutoCrush?t.AllowAutoCrush:"N",te.AutoPlacing=null!==t.AutoPlacing&&""!==t.AutoPlacing&&void 0!==t.AutoPlacing?t.AutoPlacing:h,te.AutoDepthCalc=null!==t.AutoDepthCalc&&""!==t.AutoDepthCalc&&void 0!==t.AutoDepthCalc?t.AutoDepthCalc:"N",te.MSpreadItem=null!==t.MSpreadItem&&""!==t.MSpreadItem&&void 0!==t.MSpreadItem?t.MSpreadItem:"N",te.SMassUpdate=null!==t.SMassUpdate&&""!==t.SMassUpdate&&void 0!==t.SMassUpdate?t.SMassUpdate:"N",te.HorizSlotStart=0,"PEGBOARD"==t.ObjType?(te.HorizSpacing=p,te.VertiSpacing=c):(te.HorizSpacing=0,te.VertiSpacing=0),te.HorizSlotSpacing=0,te.HorizStart=0,te.UOverHang=0,te.LoOverHang=0,te.VertiStart=0,te.BsktFill=W,te.BsktSpreadProduct=R,te.SnapTo="N","BASKET"==t.ObjType||"CHEST"==t.ObjType?(0!==t.BsktWallH&&void 0!==t.BsktWallH?te.BsktWallH=t.BsktWallH:te.BsktWallH=t.MaxMerch,te.BsktBaseH=t.H,"BASKET"==t.ObjType?te.BsktWallThickness=I:te.BsktWallThickness=m):(te.BsktWallH=0,te.BsktBaseH=0,te.BsktWallThickness=0),te.DSlotStart=0,te.DSlotSpacing=0,te.DGap=0,te.FrontOverHang=0,te.BackOverHang=0,te.SlotDivider="N",te.AllowOverLap="N",te.AutoFillPeg=t.AutoFillPeg,te.SlotOrientation="",te.DividerFixed="N",te.AvlSpace=0,te.X=wpdSetFixed("Y"==_?t.X+parseFloat(t.W)/2-X:t.X+parseFloat(t.W)/2),te.Y=wpdSetFixed(t.Y+parseFloat(t.H)/2),te.Z=wpdSetFixed(t.Z+parseFloat(t.D)/2+g_pog_json[Y].BackDepth),te.WrapText=null!==t.WrapText&&""!==t.WrapText?t.WrapText:u,te.ReduceToFit=null!==t.ReduceToFit&&""!==t.ReduceToFit?t.ReduceToFit:"Y",te.TextDirection=null!==t.TextDirection&&""!==t.TextDirection?t.TextDirection:"H",te.FStyle="Arial",te.FSize=null!==t.FSize&&""!==t.FSize&&0!==t.FSize?t.FSize:S,te.FBold=t.Fbold,te.canvasW=null,te.canvasH=null,te.peg_vert_values=[],te.peg_horiz_values=[],te.DivHeight=t.DivHeight,te.DivWidth=t.DivWidth,te.DivPst=t.DivPst,te.DivPed=t.DivPed,te.DivPbtwFace=t.DivPbtwFace,te.DivStX=isNaN(t.DivStX)?0:t.DivStX,te.DivSpaceX=isNaN(t.DivSpaceX)?0:t.DivSpaceX,te.DivFillCol=t.DivFillCol,te.NoDivIDShow=void 0===t.NoDivIDShow&&""!==t.NoDivIDShow?"N":t.NoDivIDShow,te.Overhung=void 0===t.Overhung&&""!==t.Overhung?"N":t.Overhung):(te.X=wpdSetFixed("Y"==_?t.X-X:t.X),te.Y=wpdSetFixed(t.Y),te.Z=wpdSetFixed(t.Z),te.GrillH=t.GrillH,te.LOverhang=t.LOverhang,te.ROverhang=t.ROverhang,te.SpacerThick=t.SpacerThick,te.HorizGap=null!==t.HorizGap&&""!==t.HorizGap&&void 0!==t.HorizGap?t.HorizGap:0,te.SpreadItem=t.SpreadItem,te.Combine=t.Combine,te.AllowAutoCrush=t.AllowAutoCrush,te.HorizSlotStart=t.HorizSlotStart,te.HorizSlotSpacing=t.HorizSlotSpacing,te.HorizStart=t.HorizStart,te.HorizSpacing=t.HorizSpacing,te.UOverHang=t.UOverHang,te.LoOverHang=void 0===t.LoOverHang?0:t.LoOverHang,te.VertiStart=t.VertiStart,te.VertiSpacing=t.VertiSpacing,te.BsktFill=t.BsktFill,te.BsktSpreadProduct=t.BsktSpreadProduct,te.SnapTo=t.SnapTo,te.BsktWallH=t.BsktWallH,te.BsktBaseH=t.BsktBaseH,te.BsktWallThickness=t.BsktWallThickness,te.DSlotStart=t.DSlotStart,te.DSlotSpacing=t.DSlotSpacing,te.DGap=t.DGap,te.FrontOverHang=t.FrontOverHang,te.BackOverHang=t.BackOverHang,te.SlotDivider=t.SlotDivider,te.AllowOverLap=t.AllowOverLap,te.AutoPlacing=void 0!==t.AutoPlacing&&""!==t.AutoPlacing?t.AutoPlacing:"",te.AutoFillPeg=void 0!==t.AutoFillPeg&&""!==t.AutoFillPeg?t.AutoFillPeg:"",te.AvlSpace=t.W+t.LOverhang+t.ROverhang,te.WrapText=t.WrapText,te.ReduceToFit=t.ReduceToFit,te.TextDirection=t.TextDirection,te.SlotOrientation=t.SlotOrientation,te.DividerFixed=t.DividerFixed,te.FStyle=t.FStyle,te.FSize=t.FSize,te.FBold=t.FBold,te.canvasW=t.canvasW,te.canvasH=t.canvasH,te.peg_vert_values=t.peg_vert_values,te.peg_horiz_values=t.peg_horiz_values,te.DivHeight=t.DivHeight,te.DivWidth=t.DivWidth,te.DivPst=t.DivPst,te.DivPed=t.DivPed,te.DivPbtwFace=t.DivPbtwFace,te.DivStX=isNaN(t.DivStX)?0:t.DivStX,te.DivSpaceX=isNaN(t.DivSpaceX)?0:t.DivSpaceX,te.DivFillCol=t.DivFillCol,te.NoDivIDShow=t.NoDivIDShow,te.Overhung=void 0!==t.Overhung&&""!==t.Overhung?t.Overhung:"N"),te.ShelfDivObjID=t.ShelfDivObjID,te.ManualCrush=void 0!==t.ManualCrush&&""!==t.ManualCrush?t.ManualCrush:k,te.SplitChest=void 0!==t.SplitChest&&""!==t.SplitChest?t.SplitChest:"N",te.Shelf=t.Shelf,te.POGCode=g_pog_json[Y].POGCode,te.Version=g_pog_json[Y].Version,te.ObjType=t.ObjType,te.Desc=t.Desc,te.MaxMerch=t.MaxMerch,te.LObjID=t.LObjID,te.OldObjID=t.SObjID,te.NotchNo=t.NotchNo,""==t.TextImg||void 0===t.TextImg||null==t.TextImg?(te.TextImg="",te.TextImgName="",te.TextImgMime=""):(te.TextImg=t.TextImg,te.TextImgName=t.TextImgName,te.TextImgMime=t.TextImgMime),"BASE"==t.ObjType?(te.H=g_pog_json[Y].BaseH,te.W=g_pog_json[Y].BaseW,te.D=g_pog_json[Y].BaseD,te.Color=g_pog_json[Y].Color):"NOTCH"==t.ObjType?(te.H=g_pog_json[Y].ModuleInfo[e].H,te.W=g_pog_json[Y].ModuleInfo[e].NotchW,te.D=g_pog_json[Y].ModuleInfo[e].D,te.Color=g_pog_json[Y].ModuleInfo[e].Color):(te.H=wpdSetFixed(t.H),te.W=wpdSetFixed(t.W),te.D=wpdSetFixed(t.D),null!==t.Color?void 0===t.Color||"#0"==t.Color||"#"==t.Color.charAt(1)?"TEXTBOX"==te.ObjType?te.Color=D:te.Color=b:te.Color="#FFFF"==t.Color?"#FFFFFF":t.Color:"TEXTBOX"==te.ObjType?te.Color=D:te.Color=b),null==t.Rotation||void 0===t.Rotation?te.Rotation=0:te.Rotation=t.Rotation,null==t.Slope||void 0===t.Slope?te.Slope=0:te.Slope=t.Slope,te.LiveImage=t.LiveImage,te.CompShelfObjID=t.CompShelfObjID,te.ManualZupdate=t.ManualZupdate,te.InputText=void 0!==t.InputText&&null!==t.InputText?t.InputText:"",te.ChestEdit=null!==t.ChestEdit&&""!==t.ChestEdit&&void 0!==t.ChestEdit?t.ChestEdit:"N",te.ItemInfo=[],te.InsidePegboard=t.InsidePegboard,g_pog_json[Y].ModuleInfo[e].ShelfInfo.push(te),oe=g_pog_json[Y].ModuleInfo[e].ShelfInfo.length-1):(te=t,oe=G);var ne=0;if(void 0===g_pog_json[Y].ModuleInfo[e].ParentModule||null==g_pog_json[Y].ModuleInfo[e].ParentModule&&"Y"==a){var ie=parseInt(te.Color.replace("#","0x"),16),re=new THREE.Color(ie);if("PEGBOARD"==te.ObjType)var ae=add_pegboard(te.Shelf,te.W,te.H,te.D,re,te.X,te.Y,.004,"N",te.VertiStart,te.VertiSpacing,te.HorizStart,te.HorizSpacing,e,oe,te.Rotation,te.Slope,"N",H,j,M,y,F,N,T,Y);else if("TEXTBOX"==te.ObjType){if("#"==te.Color.charAt(1)&&"TEXTBOX"==te.ObjType)var le=null;else le=ie;if("Y"==g_show_live_image&&""!==te.TextImg&&void 0!==te.TextImg&&null!==te.TextImg)ae=await add_text_box_with_image(te.Shelf,"TEXTBOX",te.W,te.H,te.D,re,te.X,te.Y,te.Z,"N",e,te.InputText,le,te.WrapText,te.ReduceToFit,te.Color,oe,te.Rotation,te.Slope,"N",te.FStyle,te.FSize,te.FBold,B,Y);else ae=add_text_box(te.Shelf,"TEXTBOX",te.W,te.H,te.D,re,te.X,te.Y,te.Z,"N",e,te.InputText,le,te.WrapText,te.ReduceToFit,te.Color,oe,te.Rotation,te.Slope,"N",te.FStyle,te.FSize,te.FBold,C,Y,g_pogcr_enhance_textbox_fontsize,te.TextDirection)}else if("ROD"==te.ObjType)ie=parseInt(te.Color.replace("#","0x"),16),re=new THREE.Color(ie),ae=add_rod(te.Shelf,"SHELF",te.W,te.H,te.D,re,te.X,te.Y,.004,"N",e,oe,Y);else if("BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&(void 0===g_pog_json[Y].ModuleInfo[e].ParentModule||null==g_pog_json[Y].ModuleInfo[e].ParentModule)){"BASKET"==te.ObjType||"CHEST"==te.ObjType?"Y"==g_chest_as_pegboard&&"CHEST"==te.ObjType?(ne=wpdSetFixed(te.D),te.H=wpdSetFixed(te.D)):(ne=wpdSetFixed(te.BsktBaseH),te.H=wpdSetFixed(te.BsktBaseH)):ne=wpdSetFixed(te.H);var[ae,se]=await add_shelf(te.Shelf,"SHELF",te.W,ne,te.D,re,te.X,te.Y,.005,"N",e,te.Rotation,te.Slope,oe,"N","N","Y",-1,O,B,H,j,M,y,F,N,T,Y,o);if("Y"==E)updateObjID(te.OldObjID,ae,"S")}}if("BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&"TEXTBOX"!==t.ObjType&&(void 0===g_pog_json[Y].ModuleInfo[e].ParentModule||null==g_pog_json[Y].ModuleInfo[e].ParentModule)&&void 0!==t.ItemInfo&&null!==t.ItemInfo&&t.ItemInfo.length>0){item_Details=t.ItemInfo;var de={X:"asc",Y:"asc"};item_Details.keySort(de),"Y"==s&&(copy_items=d[Y].ModuleInfo[e].ShelfInfo[K].ItemInfo,copy_items.keySort(de)),g_json.length>0&&(g_json_shelf=g_json[0].ModuleInfo[e].ShelfInfo[G].ItemInfo,g_json_shelf.keySort(de));var _e=te.X-te.W/2,ge=0,fe="N";for(const t of item_Details){if("N"==n){V=g_world.getObjectById(t.ObjID);g_world.remove(V)}var pe={},ce=-1;if("Y"==l){if("N"==i&&"F"==r){if(pe.DimT=t.MerchStyle,pe.PegID="",pe.PegSpread="",pe.PegPerFacing="",pe.Fixed="N",pe.CapStyle=null!==t.CapStyle&&""!==t.CapStyle&&void 0!==t.CapStyle?t.CapStyle:"0",pe.CapFacing=null!==t.CapFacing&&""!==t.CapFacing&&void 0!==t.CapFacing?t.CapFacing:"",pe.CapMerch=null!==t.CapMerch&&""!==t.CapMerch&&void 0!==t.CapMerch?t.CapMerch:"",pe.CapOrientaion=null!==t.CapOrientaion&&""!==t.CapOrientaion&&void 0!==t.CapOrientaion?t.CapOrientaion:"",pe.CapHeight=null!==t.CapHeight&&""!==t.CapHeight&&void 0!==t.CapHeight?t.CapHeight:"",pe.CapHorz=null!==t.CapHorz&&""!==t.CapHorz&&void 0!==t.CapHorz?t.CapHorz:"",pe.CapDepth=null!==t.CapDepth&&""!==t.CapDepth&&void 0!==t.CapDepth?t.CapDepth:"",pe.CapTotalCount=null!==t.CapTotalCount&&""!==t.CapTotalCount&&void 0!==t.CapTotalCount?t.CapTotalCount:"",pe.CapMaxH=null!==t.CapMaxH&&""!==t.CapMaxH&&void 0!==t.CapMaxH?t.CapMaxH:"",pe.CapCount=null!==t.CapCount&&""!==t.CapCount&&void 0!==t.CapCount?t.CapCount:"",pe.CapDepthChanged=null!==t.CapDepthChanged&&""!==t.CapDepthChanged&&void 0!==t.CapDepthChanged?t.CapDepthChanged:"N",pe.MaxHCapStyle="3",pe.Rotation=0,pe.CrushHoriz=null!==t.CrushHoriz&&""!==t.CrushHoriz&&void 0!==t.CrushHoriz?t.CrushHoriz:0,pe.CrushVert=null!==t.CrushVert&&""!==t.CrushVert&&void 0!==t.CrushVert?t.CrushVert:0,pe.CrushD=null!==t.CrushD&&""!==t.CrushD&&void 0!==t.CrushD?t.CrushD:0,pe.Price="",pe.Cost="",pe.RegMovement="",pe.RegMovementInd="",pe.DaysOfSupplyInd="",pe.AvgSales="",pe.ItemStatus="",pe.CDTLvl1="",pe.CDTLvl2="",pe.CDTLvl3="",pe.ActualDPP="",pe.StoreSOH="",pe.StoreNo="",pe.WeeksOfInventory="",pe.ShelfPrice="",pe.PromoPrice="",pe.DiscountRate="",pe.PriceChangeDate="",pe.WeeksOfInventory="",pe.Qty="",pe.WhStock="",pe.StoreStock="",pe.StockIntransit="",pe.DPPLoc="",pe.MoveBasis="",pe.IsContainer="N",pe.BsktFactor=0,pe.OverHang=0,pe.VertGap=0,pe.BHoriz=null==t.BHoriz?1:t.BHoriz,pe.BVert=null==t.BVert?1:t.BVert,pe.BaseD=null==t.BaseD||0==t.BaseD?1:t.BaseD,(g_json.length>0||void 0!==g_json[0])&&"D"==g_json[0].DesignType&&"D"==g_pog_json[Y].DesignType&&"Y"==g_pog_json[Y].MassUpdate)var[Ie,me,he,ue,Se,De]=get_new_orientation_dim("0",t.W,t.H,t.D);else var[Ie,me,he,ue,Se,De]=get_new_orientation_dim(t.Orientation,t.W,t.H,t.D);pe.W=Ie,null!==t.CapCount&&""!==t.CapCount&&void 0!==t.CapCount&&"0"!==t.CapStyle&&void 0!==t.CapStyle&&null!==t.CapStyle?pe.H=wpdSetFixed(me*t.BVert+t.CapHeight*t.CapCount):pe.H=wpdSetFixed(me*t.BVert),pe.D=he,"BASKET"==te.ObjType&&"DIVIDER"!==t.Item?(pe.W=wpdSetFixed(te.W),pe.H=wpdSetFixed(t.D*t.Quantity),pe.D=wpdSetFixed(t.D*pe.BaseD),pe.RW=wpdSetFixed(t.W),pe.RH=wpdSetFixed(t.H),pe.RD=wpdSetFixed(t.D)):(pe.W=pe.W*pe.BHoriz,null!==t.CapCount&&""!==t.CapCount&&void 0!==t.CapCount&&"0"!==t.CapStyle&&void 0!==t.CapStyle&&null!==t.CapStyle?pe.H=wpdSetFixed(me*t.BVert+t.CapHeight*t.CapCount):pe.H=wpdSetFixed(me*t.BVert),pe.D=wpdSetFixed(pe.D*pe.BaseD),pe.RW=wpdSetFixed(pe.W),pe.RH=wpdSetFixed(me*t.BVert),pe.RD=wpdSetFixed(pe.D)),pe.OW=wpdSetFixed(t.W),pe.OH=wpdSetFixed(t.H),pe.OD=wpdSetFixed(t.D),pe.LObjID=t.LObjID,pe.SubLblObjID=t.SubLblObjID,pe.Dragged="N",pe.SpreadItem=void 0!==t.SpreadItem&&null!==t.SpreadItem&&""!==t.SpreadItem?t.SpreadItem:0,pe.MHorizCrushed=null!==t.MHorizCrushed&&""!==t.MHorizCrushed&&void 0!==t.MHorizCrushed?t.MHorizCrushed:"N",pe.MVertCrushed=null!==t.MVertCrushed&&""!==t.MVertCrushed&&void 0!==t.MVertCrushed?t.MVertCrushed:"N",pe.MDepthCrushed=null!==t.MDepthCrushed&&""!==t.MDepthCrushed&&void 0!==t.MDepthCrushed?t.MDepthCrushed:"N",pe.MCapTopFacing="N",pe.X=te.X-te.W/2+t.X+pe.W/2,"PEGBOARD"==te.ObjType?"Y"==o[Y].MassUpdate?pe.Y=wpdSetFixed(t.Y-pe.H/2):pe.Y=wpdSetFixed(t.Y-pe.H/2-g_pog_json[Y].BaseH):"HANGINGBAR"==te.ObjType?pe.Y=wpdSetFixed(te.Y-pe.H/2):"D"==g_pog_json[Y].DesignType&&"Y"==g_pog_json[Y].MassUpdate&&"SHELF"==te.ObjType?pe.Y=wpdSetFixed(te.Y+te.H/2+pe.H/2):pe.Y=wpdSetFixed(t.Y+pe.H/2),pe.SlotDivider="N",pe.Distance=wpdSetFixed(pe.X-pe.W/2-_e),pe.YDistance=wpdSetFixed(pe.Y-te.Y+te.H/2),"PEGBOARD"==te.ObjType&&(pe.PegBoardX=wpdSetFixed(pe.X-pe.W/2-_e),pe.PegBoardY=wpdSetFixed(pe.Y-pe.H/2-(te.Y-te.H/2))),pe.NewPegId="",pe.AutoDiv="N",pe.MassCrushH=void 0!==t.MassCrushH&&null!==t.MassCrushH?t.MassCrushH:"",pe.MassCrushV=void 0!==t.MassCrushV&&null!==t.MassCrushV?t.MassCrushV:"",pe.MassCrushD=void 0!==t.MassCrushD&&null!==t.MassCrushD?t.MassCrushD:"","PALLET"==te.ObjType?pe.Z=wpdSetFixed(t.Z+pe.D/2):pe.Z=0==t.Z?wpdSetFixed(t.Z+t.D/2):wpdSetFixed(t.Z)}else{pe.DimT=t.DimT,pe.PegID=t.PegID,pe.PegSpread=t.PegSpread,pe.PegPerFacing=t.PegPerFacing,pe.Fixed=t.Fixed,pe.CapStyle=t.CapStyle,pe.CapFacing=null!==t.CapFacing&&""!==t.CapFacing&&void 0!==t.CapFacing?t.CapFacing:0,pe.CapMerch=t.CapMerch,pe.CapOrientaion=t.CapOrientaion,pe.CapHeight=t.CapHeight,pe.CapHorz=null!==t.CapHorz&&""!==t.CapHorz&&void 0!==t.CapHorz?t.CapHorz:0,pe.CapDepth=null!==t.CapDepth&&""!==t.CapDepth&&void 0!==t.CapDepth?t.CapDepth:0,pe.CapTotalCount=t.CapTotalCount,pe.CapMaxH=void 0!==t.CapMaxH&&null!==t.CapMaxH?t.CapMaxH:0,pe.MaxHCapStyle=void 0!==t.MaxHCapStyle&&null!==t.MaxHCapStyle?t.MaxHCapStyle:"3",pe.Rotation=t.Rotation,pe.CrushHoriz=t.CrushHoriz,pe.CrushVert=t.CrushVert,pe.CrushD=t.CrushD,pe.Price=t.Price,pe.Cost=t.Cost,pe.RegMovement=t.RegMovement,pe.RegMovementInd=void 0!==t.RegMovementInd?t.RegMovementInd:"",pe.DaysOfSupplyInd=void 0!==t.DaysOfSupplyInd?t.DaysOfSupplyInd:"",pe.AvgSales=void 0!==t.AvgSales&&null!=t.AvgSales&&""!=t.AvgSales?Math.floor(100*t.AvgSales)/100:"",pe.ItemStatus=void 0!==t.ItemStatus?t.ItemStatus:"",pe.CDTLvl1=void 0!==t.CDTLvl1?t.CDTLvl1:"",pe.CDTLvl2=void 0!==t.CDTLvl2?t.CDTLvl2:"",pe.CDTLvl3=void 0!==t.CDTLvl3?t.CDTLvl3:"",pe.ActualDPP=void 0!==t.ActualDPP?t.ActualDPP:"",pe.StoreSOH=void 0!==t.StoreSOH?t.StoreSOH:"",pe.StoreNo=void 0!==t.StoreNo?t.StoreNo:"",pe.DPPLoc=t.DPPLoc,pe.WeeksOfInventory=void 0!==t.WeeksOfInventory?t.WeeksOfInventory:"",pe.ShelfPrice=void 0!==t.ShelfPrice?t.ShelfPrice:"",pe.PromoPrice=void 0!==t.PromoPrice?t.PromoPrice:"",pe.DiscountRate=void 0!==t.DiscountRate?t.DiscountRate:"",pe.PriceChangeDate=void 0!==t.PriceChangeDate?t.PriceChangeDate:"",pe.WeeksOfInventory=void 0!==t.WeeksOfInventory?t.WeeksOfInventory:"",pe.Qty=void 0!==t.Qty?t.Qty:"",pe.WhStock=void 0!==t.WhStock?t.WhStock:"",pe.StoreStock=void 0!==t.StoreStock?t.StoreStock:"",pe.StockIntransit=void 0!==t.StockIntransit?t.StockIntransit:"",pe.MoveBasis=t.MoveBasis,pe.IsContainer=t.IsContainer,pe.BsktFactor=t.BsktFactor,pe.OverHang=t.OverHang,pe.VertGap=t.VertGap,pe.OW=wpdSetFixed(t.OW),pe.OH=wpdSetFixed(t.OH),pe.OD=wpdSetFixed(t.OD),pe.Dragged=t.Dragged,pe.SpreadItem=t.SpreadItem,pe.MHorizCrushed=t.MHorizCrushed,pe.MVertCrushed=t.MVertCrushed,pe.MDepthCrushed=t.MDepthCrushed,pe.MCapTopFacing=t.MCapTopFacing;var[Ie,me,he,ue,Se,De]=get_new_orientation_dim(t.Orientation,t.OW,t.OH,t.OD);pe.RW=wpdSetFixed(Ie*t.BHoriz),pe.RH=wpdSetFixed(me*t.BVert),pe.RD=wpdSetFixed(he*t.BaseD),pe.LObjID=t.LObjID,pe.SubLblObjID=t.SubLblObjID,pe.SlotDivider=t.SlotDivider,pe.CapCount=t.CapCount,pe.X=wpdSetFixed("Y"==_?t.X-X:t.X),pe.Y=wpdSetFixed(t.Y),"HANGINGBAR"==te.ObjType?pe.Y=wpdSetFixed(te.Y-t.H/2):pe.Y=wpdSetFixed(t.Y),pe.BHoriz=t.BHoriz,pe.BVert=t.BVert,pe.BaseD=t.BaseD,pe.W=wpdSetFixed(t.W),pe.H=wpdSetFixed(t.H),pe.D=wpdSetFixed(t.D),pe.Distance=t.Distance,pe.PegBoardX=t.PegBoardX,pe.PegBoardY=t.PegBoardY,pe.NewPegId="",pe.YDistance=void 0!==t.YDistance?t.YDistance:pe.Y-te.Y+te.H/2,pe.MassCrushH="N",pe.MassCrushV="N",pe.MassCrushD="N",pe.AutoDiv=void 0!==t.AutoDiv?t.AutoDiv:"N","PALLET"==te.ObjType?pe.Z=wpdSetFixed(t.Z):pe.Z=0==t.Z?wpdSetFixed(t.Z+t.D/2):wpdSetFixed(t.Z)}if(pe.Quantity=Math.round(100*t.Quantity)/100,pe.ItemID=t.ItemID,pe.Item=t.Item,void 0===t.Color||null==t.Color?pe.Color=v:pe.Color=t.Color,pe.Desc=t.Desc,pe.Barcode=t.Barcode,pe.LocID=t.LocID,pe.Orientation=t.Orientation,pe.MerchStyle=null==t.MerchStyle||void 0===t.MerchStyle||""==t.MerchStyle?"0":t.MerchStyle,pe.Supplier=t.Supplier,void 0!==t.Supplier&&""!==t.Supplier&&null!==t.Supplier?pe.SupplierName=t.Supplier.split("-")[1]:pe.SupplierName="",pe.Brand=t.Brand,pe.BrandType=t.BrandType,pe.Group=t.Group,pe.Dept=t.Dept,pe.SubClass=t.SubClass,void 0!==t.Dept&&""!==t.Dept&&null!==t.Dept)var be=t.Dept.split("-");else be="";if(void 0!==t.Class&&""!==t.Class&&null!==t.Class)var ve=t.Class.split("-");else ve="";if(void 0!==t.SubClass&&""!==t.SubClass&&null!==t.SubClass)var xe=t.SubClass.split("-");else xe="";if(pe.Class=t.Class,pe.ClassName=be[0]+"/"+ve[0]+"/"+xe[0],pe.StdUOM=t.StdUOM,pe.SizeDesc=void 0===t.SizeDesc||null==t.SizeDesc?"":t.SizeDesc,pe.HorizGap=t.HorizGap,pe.UW=wpdSetFixed(t.UW),pe.UH=wpdSetFixed(t.UH),pe.UD=wpdSetFixed(t.UD),pe.CW=wpdSetFixed(t.CW),pe.CH=wpdSetFixed(t.CH),pe.CD=wpdSetFixed(t.CD),pe.TW=wpdSetFixed(t.TW),pe.TH=wpdSetFixed(t.TH),pe.TD=wpdSetFixed(t.TD),pe.DW=wpdSetFixed(t.DW),pe.DH=wpdSetFixed(t.DH),pe.DD=wpdSetFixed(t.DD),pe.CWPerc=t.CWPerc,pe.CHPerc=t.CHPerc,pe.CDPerc=t.CDPerc,pe.TopObjID=t.TopObjID,pe.BottomObjID=t.BottomObjID,pe.SecondTier=t.SecondTier,pe.CompItemObjID=t.CompItemObjID,pe.SellingPrice=Math.round(100*t.SellingPrice)/100,pe.NetSales=void 0!==t.NetSales&&""!==t.NetSales?Math.round(100*t.NetSales)/100:0,pe.CogsAdj=t.CogsAdj,pe.CogsAdjInd=void 0!==t.CogsAdjInd?t.CogsAdjInd:"",pe.RegMovement=t.RegMovement,pe.RegMovementInd=void 0!==t.RegMovementInd?t.RegMovementInd:"",pe.AvgSales=void 0!==t.AvgSales&&null!=t.AvgSales&&""!=t.AvgSales?Math.floor(100*t.AvgSales)/100:"",pe.AvgSalesInd=void 0!==t.AvgSalesInd?t.AvgSalesInd:"",pe.ItemStatus=void 0!==t.ItemStatus?t.ItemStatus:"",pe.CDTLvl1=void 0!==t.CDTLvl1?t.CDTLvl1:"",pe.CDTLvl2=void 0!==t.CDTLvl2?t.CDTLvl2:"",pe.CDTLvl3=void 0!==t.CDTLvl3?t.CDTLvl3:"",pe.MPogVertFacings=void 0!==t.MPogVertFacings?t.MPogVertFacings:"",pe.MPogHorizFacings=void 0!==t.MPogHorizFacings?t.MPogHorizFacings:"",pe.MPogDepthFacings=void 0!==t.MPogDepthFacings?t.MPogDepthFacings:"",pe.ActualDPP=void 0!==t.ActualDPP&&null!=t.ActualDPP&&""!=t.ActualDPP?parseFloat(t.ActualDPP).toFixed(2):"",pe.DPPLoc=t.DPPLoc,pe.StoreSOH=void 0!==t.StoreSOH?t.StoreSOH:"",pe.StoreNo=void 0!==t.StoreNo?t.StoreNo:"",pe.WeeksOfInventory=void 0!==t.WeeksOfInventory?t.WeeksOfInventory:"",pe.ShelfPrice=void 0!==t.ShelfPrice?t.ShelfPrice:"",pe.PromoPrice=void 0!==t.PromoPrice?t.PromoPrice:"",pe.DiscountRate=void 0!==t.DiscountRate?t.DiscountRate:"",pe.PriceChangeDate=void 0!==t.PriceChangeDate?t.PriceChangeDate:"",pe.WeeksOfInventory=void 0!==t.WeeksOfInventory?t.WeeksOfInventory:"",pe.Qty=void 0!==t.Qty?t.Qty:"",pe.WhStock=void 0!==t.WhStock?t.WhStock:"",pe.StoreStock=void 0!==t.StoreStock?t.StoreStock:"",pe.StockIntransit=void 0!==t.StockIntransit?t.StockIntransit:"",pe.GrossProfit=void 0!==t.GrossProfit?t.GrossProfit:0,pe.GrossProfitInd=void 0!==t.GrossProfitInd?t.GrossProfitInd:"",pe.WeeksCount=t.WeeksCount,pe.WeeksCountInd=void 0!==t.WeeksCountInd?t.WeeksCountInd:"",pe.MovingItem=t.MovingItem,pe.Profit=Math.round(100*t.Profit)/100,pe.TotalMargin=t.TotalMargin,pe.Price=t.Price,pe.Cost=t.Cost,pe.MHorizFacings=void 0===t.MHorizFacings||null==t.MHorizFacings?-1:parseInt(t.MHorizFacings),pe.MVertFacings=void 0===t.MVertFacings||null==t.MVertFacings?-1:parseInt(t.MVertFacings),pe.MDepthFacings=void 0===t.MDepthFacings||null==t.MDepthFacings?-1:parseInt(t.MDepthFacings),pe.Status=t.Status,pe.DaysOfSupply=t.DaysOfSupply,pe.DaysOfSupplyInd=void 0!==t.DaysOfSupplyInd?t.DaysOfSupplyInd:"",pe.ShowColorBackup=t.ShowColorBackup,pe.OrientationDesc=t.OrientationDesc,pe.StoreCnt=t.StoreCnt,pe.NewYN="",pe.DescSecond=t.DescSecond,pe.Delist=void 0===t.Delist?"N":t.Delist,pe.OverhungItem=void 0===t.OverhungItem?"N":t.OverhungItem,"Y"==pe.Delist&&(pe.Color=x),void 0===t.CnW?pe.CnW=0:pe.CnW=t.CnW,void 0===t.CnH?pe.CnH=0:pe.CnH=t.CnH,void 0===t.CnD?pe.CnD=0:pe.CnD=t.CnD,void 0===t.NW?pe.NW=0:pe.NW=t.NW,void 0===t.NH?pe.NH=0:pe.NH=t.NH,void 0===t.ND?pe.ND=0:pe.ND=t.ND,pe.ItemNesting=t.ItemNesting,pe.NVal="H"==pe.ItemNesting?t.NH:"W"==pe.ItemNesting?t.NW:"D"==pe.ItemNesting?t.ND:0,pe.ItemContain=t.ItemContain,pe.CnVal="H"==pe.ItemContain?t.CnH:"W"==pe.ItemContain?t.CnW:"D"==pe.ItemContain?t.CnD:0,pe.OldCnW=pe.CnW,pe.OldCnH=pe.CnH,pe.OldCnD=pe.CnD,pe.OldNW=pe.NW,pe.OldNH=pe.NH,pe.OldND=pe.ND,pe.OrgUW=wpdSetFixed(t.OrgUW),pe.OrgUH=wpdSetFixed(t.OrgUH),pe.OrgUD=wpdSetFixed(t.OrgUD),pe.OrgCW=wpdSetFixed(t.OrgCW),pe.OrgCH=wpdSetFixed(t.OrgCH),pe.OrgCD=wpdSetFixed(t.OrgCD),pe.OrgTW=wpdSetFixed(t.OrgTW),pe.OrgTH=wpdSetFixed(t.OrgTH),pe.OrgTD=wpdSetFixed(t.OrgTD),pe.OrgDW=wpdSetFixed(t.OrgDW),pe.OrgDH=wpdSetFixed(t.OrgDH),pe.OrgDD=wpdSetFixed(t.OrgDD),pe.OrgCWPerc=t.OrgCWPerc,pe.OrgCHPerc=t.OrgCHPerc,pe.OrgCDPerc=t.OrgCDPerc,pe.OrgCnW=t.OrgCnW,pe.OrgCnH=t.OrgCnH,pe.OrgCnD=t.OrgCnD,pe.OrgNW=t.OrgNW,pe.OrgNH=t.OrgNH,pe.OrgND=t.OrgND,void 0!==t.SizeDesc&&""!==t.SizeDesc)var Oe=null!==t.SizeDesc?t.SizeDesc.split("*"):[];else Oe=[];var Ce=t.CapFacing*t.CapDepth*t.CapHorz;if(pe.Cpct=t.BHoriz*t.BVert*t.BaseD+(isNaN(Ce)?0:Ce),pe.ImgExists=t.ImgExists,pe.Exists="E",pe.DimUpdate="N",pe.ItemImage=t.ItemImage,pe.Edited="Y",pe.OldObjID=t.ObjID,pe.NewPegId="",pe.DFacing=t.BaseD,pe.UnitperCase=t.UnitperCase,pe.UnitperTray=t.UnitperTray,pe.DfacingUpd="N",pe.TotalUnitsCalc=t.BHoriz*t.BVert*t.BaseD,pe.PkSiz=parseInt(Oe[1]),pe.ItmDescChi=t.ItmDescChi,Oe.length>1?pe.ItmDescEng=t.Brand+" "+t.Desc+" "+parseInt(Oe[0])/parseInt(Oe[1])+"*"+Oe[1]+"*"+Oe[2]:pe.ItmDescEng=t.Brand+" "+t.Desc,pe.Brand_Category=void 0!==t.Brand_Category?t.Brand_Category:"",pe.Uda_item_status=void 0!==t.Uda_item_status?t.Uda_item_status:"",pe.Gobecobrand=void 0!==t.Gobecobrand?t.Gobecobrand:"",pe.Internet=void 0!==t.Internet?t.Internet:"",pe.LiveNewItem=void 0!==t.LiveNewItem?t.LiveNewItem:"",pe.CapDepthChanged="N",pe.Categ=void 0!==t.Categ?t.Categ:"",pe.COO=void 0!==t.COO?t.COO:"",pe.ItemSize=void 0!==t.ItemSize?t.ItemSize:"",pe.SplrLbl=void 0!==t.SplrLbl?t.SplrLbl:"",pe.EDLP=void 0!==t.EDLP?t.EDLP:"",pe.GoGreen=void 0!==t.GoGreen?t.GoGreen:"",pe.LoGrp=void 0!==t.LoGrp?t.LoGrp:"",pe.SqzPer=(void 0!==t.CrushHoriz?t.CrushHoriz:0)+":"+(void 0!==t.CrushVert?t.CrushVert:0)+":"+(void 0!==t.CrushD?t.CrushD:0),pe.InternationalRng=void 0!==t.InternationalRng?t.InternationalRng:"",pe.StoreCnt=void 0!==t.StoreCnt?t.StoreCnt:"",pe.NewItem=void 0!==t.NewItem?t.NewItem:"",void 0!==t.SalesUnit&&null!==t.SalesUnit){var je=t.SalesUnit;pe.SalesUnit=Math.floor(100*je)/100}else pe.SalesUnit="";if(void 0!==typeof t.Remarks?pe.Remarks=t.Remarks:pe.Remarks="",pe.UDA751=void 0!==t.UDA751?t.UDA751:"",pe.UDA755=void 0!==t.UDA755?t.UDA755:"",pe.ItemCondition=0!=nvl(t.ItemCondition)?t.ItemCondition:"",pe.AUR=0!=nvl(t.AUR)?t.AUR:"",pe.ItemRanking=0!=nvl(t.ItemRanking)?t.ItemRanking:"",pe.WeeklySales=0!=nvl(t.WeeklySales)?t.WeeklySales:"",pe.WeeklyNetMargin=0!=nvl(t.WeeklyNetMargin)?t.WeeklyNetMargin:"",pe.WeeklyQty=0!=nvl(t.WeeklyQty)?t.WeeklyQty:"",pe.NetMarginPercent=void 0!==t.NetMarginPercent?t.NetMarginPercent:void 0!==t.NetMarginPerc?t.NetMarginPerc:"",pe.CumulativeNM=0!=nvl(t.CumulativeNM)?t.CumulativeNM:"",pe.TOP80B2=0!=nvl(t.TOP80B2)?t.TOP80B2:"",pe.ItemBrandC=0!=nvl(t.ItemBrandC)?t.ItemBrandC:"",pe.ItemPOGDept=0!=nvl(t.ItemPOGDept)?t.ItemPOGDept:"",pe.ItemRemark=0!=nvl(t.ItemRemark)?t.ItemRemark:"",pe.RTVStatus=0!=nvl(t.RTVStatus)?t.RTVStatus:"",pe.Pusher=0!=nvl(t.Pusher)?t.Pusher:"",pe.Divider=0!=nvl(t.Divider)?t.Divider:"",pe.BackSupport=0!=nvl(t.BackSupport)?t.BackSupport:"",pe.OOSPerc=nvl(t.OOSPerc),pe.InitialItemDesc=void 0!==t.InitialItemDesc?t.InitialItemDesc:"",pe.InitialBrand=void 0!==t.InitialBrand?t.InitialBrand:"",pe.InitialBarcode=void 0!==t.InitialBarcode?t.InitialBarcode:"","Y"==s&&!("Y"!=g_auto_apply_v_facings&&"Y"!=g_auto_apply_d_facings||"SHELF"!=te.ObjType&&"HANGINGBAR"!=te.ObjType||"DIVIDER"===t.Item)){d[Y].ModuleInfo[e].ShelfInfo[K].ItemInfo[ge].ItemX=wpdSetFixed(pe.ItemX),d[Y].ModuleInfo[e].ShelfInfo[K].ItemInfo[ge].ItemY=wpdSetFixed(pe.ItemY);var[Me,ye,He,we,Te,Fe,Ne]=calcMaxFacings(d,e,K,d[Y].ModuleInfo[e].ShelfInfo[K],pe,ge);"Y"==g_auto_apply_v_facings&&0!==nvl(Me)&&("SHELF"==te.ObjType||"HANGINGBAR"==te.ObjType&&"Y"==g_auto_hangbar_facings)&&(pe.H=wpdSetFixed(Me),pe.RH=wpdSetFixed(He),pe.BVert=ye,pe.Y=wpdSetFixed(we)),"Y"==g_auto_apply_d_facings&&0!==nvl(Te)&&("SHELF"==te.ObjType||"HANGINGBAR"==te.ObjType&&"Y"==g_auto_hangbar_facings)&&(pe.BaseD=wpdSetFixed(Fe),pe.D=wpdSetFixed(Te),pe.RD=wpdSetFixed(Ne))}g_pog_json[Y].ModuleInfo[e].ShelfInfo[G].ItemInfo.push(pe),ce=g_pog_json[Y].ModuleInfo[e].ShelfInfo[G].ItemInfo.length-1}else pe=t,ce=ge;if("Y"==a){if((Be=g_pog_json[Y].ModuleInfo[e].ShelfInfo[G].ItemInfo[ce]).MIndex=e,Be.SIndex=G,Be.IIndex=ce,g_json.length>0&&"BASE"!==g_json[0].ModuleInfo[e].ShelfInfo[G].ObjType&&"NOTCH"!==g_json[0].ModuleInfo[e].ShelfInfo[G].ObjType&&"TEXTBOX"!==g_json[0].ModuleInfo[e].ShelfInfo[G].ObjType&&"DIVIDER"!==g_json[0].ModuleInfo[e].ShelfInfo[G].ObjType&&(g_json[0].ModuleInfo[e].ShelfInfo[G].ItemInfo[ce].MIndex=e,g_json[0].ModuleInfo[e].ShelfInfo[G].ItemInfo[ce].SIndex=G,g_json[0].ModuleInfo[e].ShelfInfo[G].ItemInfo[ce].IIndex=ce),"DIVIDER"==Be.Item)var Ee=add_items(Be.ItemID,Be.W,Be.H,Be.D,Be.Color,Be.X,Be.Y,Be.Z,e,G,ge,Be.Rotation,Y);else{if("Y"==z&&"Y"==g_pog_json[Y].MassUpdate){if("1"!=Be.CapStyle&&"2"!=Be.CapStyle&&"3"!=Be.CapStyle||0!=Be.CapCount||await set_item_capping(Y,e,G,ge,"Y","N"),"CHEST"!=te.ObjType||"Y"!=g_chest_as_pegboard){if("Y"==Be.MVertCrushed||"Y"==Be.MassCrushV||"Y"==te.AllowAutoCrush)crushItem(Y,e,G,ge,"H","Y",[Be.D],[ge],"Y");if("Y"==Be.MHorizCrushed||"Y"==Be.MassCrushH||"Y"==te.AllowAutoCrush)fe="Y"==crushItem(Y,e,G,ge,"W","Y",[Be.D],[ge],"Y"==te.DivPed&&te.DivWidth>0?"Y":"N")?"Y":"N";if("Y"==Be.MDepthCrushed||"Y"==Be.MassCrushD||"Y"==te.AllowAutoCrush)crushItem(Y,e,G,ge,"D","Y",[Be.D],[ge],"Y")}"N"==i&&"F"==r&&("DIVIDER"==t.Item?Be.X=wpdSetFixed(t.X+t.W/2):Be.X=wpdSetFixed(te.X-te.W/2+t.X+Be.W/2),"PEGBOARD"==te.ObjType?"Y"==o[Y].MassUpdate?Be.Y=wpdSetFixed(t.Y-Be.H/2):Be.Y=wpdSetFixed(t.Y-Be.H/2-g_pog_json[Y].BaseH):"HANGINGBAR"==te.ObjType?Be.Y=wpdSetFixed(te.Y-Be.H/2):"D"==g_pog_json[Y].DesignType&&"Y"==g_pog_json[Y].MassUpdate&&"SHELF"==te.ObjType?Be.Y=wpdSetFixed(te.Y+te.H/2+Be.H/2):Be.Y=wpdSetFixed(t.Y+Be.H/2),Be.Distance=wpdSetFixed(Be.X-Be.W/2-_e),Be.YDistance=wpdSetFixed(Be.Y-te.Y+te.H/2),"PEGBOARD"==te.ObjType&&(Be.PegBoardX=wpdSetFixed(Be.X-Be.W/2-_e),Be.PegBoardY=wpdSetFixed(Be.Y-Be.H/2-(te.Y-te.H/2))))}var Be=g_pog_json[Y].ModuleInfo[e].ShelfInfo[G].ItemInfo[ce];if("N"==g_show_live_image){var We=g_orientation_json[t.Orientation].split("###");Ee=await add_items_with_image(Be.ItemID,Be.W,Be.H,Be.D,Be.Color,Be.X,Be.Y,Be.Z,e,G,ge,Be.BHoriz,Be.BVert,Be.Item,parseInt(We[0]),parseInt(We[1]),"N","Y",j,M,y,F,N,T,Y)}else Ee=await add_items_prom(Be.ItemID,Be.W,Be.H,Be.D,Be.Color,Be.X,Be.Y,Be.Z,e,G,ge,"N","Y",H,w,T,F,N,Y)}void 0!==(V=g_world.getObjectById(Ee))&&"N"==g_show_live_image&&("N"==Be.Status?(V.BorderColour=g_status_error_color,V.Status="N",V.WireframeObj.material.color.setHex(V.BorderColour)):nvl(t.OOSPerc)>80&&"Y"==g_pogcr_enbl_oos_border?(V.BorderColour=g_pogcr_oos_border_color,V.WireframeObj.material.color.setHex(V.BorderColour)):V.BorderColour=0),"PALLET"==te.ObjType?g_pog_json[Y].ModuleInfo[e].ShelfInfo[G].ItemInfo[ge].Z=wpdSetFixed(Be.Z):g_pog_json[Y].ModuleInfo[e].ShelfInfo[G].ItemInfo[ge].Z=.016,g_pog_json[Y].ModuleInfo[e].ShelfInfo[G].ItemInfo[ge].ObjID=Ee,g_pog_json[Y].ModuleInfo[e].ShelfInfo[G].ItemInfo[ge].CType=te.ObjType}ge+=1}var Re=g_world.getObjectById(g_pog_json[Y].ModuleInfo[e].ShelfInfo[G].SObjID);if(void 0!==Re&&(Re.AvlSpace=wpdSetFixed(100*Re.AvlSpace)),"SHELF"==te.ObjType||"PALLET"==te.ObjType)await reset_top_bottom_objects(e,G,"Y",Y);var Pe=g_pog_json[Y].ModuleInfo[e].ShelfInfo[G];if("N"==Pe.Combine&&"Y"==fe&&("CHEST"!=Pe.ObjType||"Y"!=g_chest_as_pegboard)&&"PEGBOARD"!==Pe.ObjType){var Ye=Pe.HorizGap,Ae=Ye,ke=Pe.SpreadItem,ze=Pe.ItemInfo.length;Pe.AllowAutoCrush;if(reorder_items(e,G,Y)){var Xe=0;for(item_info of Pe.ItemInfo){var Le=get_item_xaxis(item_info.W,item_info.H,item_info.D,item_info.CType,"",Ae,ke,Ye,e,G,Xe,"Y",ze,"N",Y);item_info.X=wpdSetFixed(Le);V=g_world.getObjectById(item_info.ObjID);if(g_world.remove(V),"DIVIDER"==item_info.Item)Ee=add_items(item_info.ItemID,item_info.W,item_info.H,item_info.D,item_info.Color,item_info.X,item_info.Y,item_info.Z,e,G,Xe,item_info.Rotation,Y);else if("Y"==g_show_live_image)We=g_orientation_json[item_info.Orientation].split("###"),Ee=await add_items_with_image(item_info.ItemID,item_info.W,item_info.H,item_info.D,item_info.Color,item_info.X,item_info.Y,item_info.Z,e,G,Xe,item_info.BHoriz,item_info.BVert,item_info.Item,parseInt(We[0]),parseInt(We[1]),"N","Y",j,M,y,F,N,T,Y);else Ee=await add_items_prom(item_info.ItemID,item_info.W,item_info.H,item_info.D,item_info.Color,item_info.X,item_info.Y,item_info.Z,e,G,Xe,"N","Y",H,w,T,F,N,Y);g_pog_json[Y].ModuleInfo[e].ShelfInfo[G].ItemInfo[Xe].ObjID=Ee,Xe++}}}}G+=1}var Ve=g_pog_json[Y].ModuleInfo[e].ShelfInfo;L=0;for(const o of Ve){for(const t of o.ItemInfo){if("DIVIDER"==t.Item){var Ge=0;for(const o of Ve)"DIVIDER"==o.ObjType&&o.Shelf==t.ItemID&&(g_pog_json[Y].ModuleInfo[e].ShelfInfo[Ge].ShelfDivObjID=t.ObjID),Ge++}0}L++}}render(Y),logDebug("function : create_shelf_from_json_lib","E")}catch(e){error_handling(e)}}async function add_module_lib(e,o,t,n,i,r,a,l,s,d,_,g,f,p,c,I,m,h,u,S,D,b,v,x,O,C,j,M,y,H,w,T,F,N,E,B,W,R,P,Y,A,k,z,X,L="N",V,G,U,Z="N"){logDebug("function : add_module_lib; uuid : "+e+"; width : "+o+"; height : "+t+"; depth : "+n+"; color : "+i+"; x : "+r+"; y : "+a+"; p_edit_ind : "+l+"; pog_flag : "+s+"; vert_start : "+d+"; vert_spacing : "+_+"; horz_start : "+g+"; horz_spacing : "+f+"; recreate : "+p+"; module_ind : "+I,"S");try{if(console.log("add_module_lib",g_pog_json,V),-1==I||void 0===I)var J=parseFloat(g_pog_json[V].ModuleInfo.length)-1;else J=I;var Q,q,K=0,ee=[];if("Y"==l){ee=JSON.parse(g_temp_POG_arr);var oe=g_world.getObjectById(g_dblclick_objid);g_world.remove(oe),J=g_module_index;var te=0,ne="N",ie=[],re=[],ae=[];if($.each(g_pog_json[V].ModuleInfo,(function(e,o){null!=o.ParentModule&&"undefined"!=o.ParentModule||(e<g_module_index?te+=o.W:e>g_module_index&&(ne="Y"))})),"Y"==ne){Q=te+o/2,ie.push(Q),re.push(t/2+g_pog_json[V].BaseH),ae.push(J),te+=o,$.each(g_pog_json[V].ModuleInfo,(function(e,o){if((null==o.ParentModule||"undefined"==o.ParentModule)&&e>g_module_index){var t=g_world.getObjectById(o.MObjID);g_world.remove(t),Q=te+o.W/2,ae.push(e),ie.push(Q),re.push(o.H/2+g_pog_json[V].BaseH),te+=o.W}}));var le=0;for(const e of ie){const t=ae[le],n=re[le];var se=parseInt(g_pog_json[V].ModuleInfo[t].Color.replace("#","0x"),16),de=new THREE.Color(se);await create_final_module(g_pog_json[V].ModuleInfo[t].Module,g_pog_json[V].ModuleInfo[t].W,g_pog_json[V].ModuleInfo[t].H,g_pog_json[V].ModuleInfo[t].D,de,n,l,g_pog_json[V].ModuleInfo[t].VertStart,g_pog_json[V].ModuleInfo[t].VertSpacing,g_pog_json[V].ModuleInfo[t].HorzStart,g_pog_json[V].ModuleInfo[t].HorzSpacing,e,t,F,V);if("Y"==l&&void 0!==ee[V].ModuleInfo[t]&&void 0!==ee[V].ModuleInfo[0].ShelfInfo){if(void 0!==ee[V].ModuleInfo[t].Carpark&&ee[V].ModuleInfo[t].Carpark.length>0)await create_shelf_edit_pog_lib(t,ee[V].ModuleInfo[t].Carpark,o,"Y","Y","D","Y","Y","Y",b,C,j,M,y,H,w,T,N,E,B,W,R,P,Y,A,k,z,X,L,c,V,V,Z);if(ee[V].ModuleInfo[0].ShelfInfo.length>0)await create_shelf_from_json_lib(t,ee,g_pog_json[V].ModuleInfo[t].W,"N","Y","D","Y","Y",!1,null,"N",null,m,h,u,S,D,b,v,x,O,C,w,T,N,E,B,W,R,P,Y,A,k,z,L,X,G,U,c,V,V,Z)}le+=1}}else{Q=te+o/2;await create_final_module(g_pog_json[V].ModuleInfo[J].Module,o,t,n,i,a,l,d,_,g,f,Q,J,F,V);if("Y"==l&&void 0!==ee[V].ModuleInfo[J]&&void 0!==ee[V].ModuleInfo[0].ShelfInfo){if(void 0!==ee[V].ModuleInfo[0].Carpark&&ee[V].ModuleInfo[0].Carpark.length>0)await create_shelf_edit_pog_lib(0,ee[V].ModuleInfo[0].Carpark,o,"Y","Y","D","N","Y","Y",b,C,j,M,y,H,w,T,N,E,B,W,R,P,Y,A,k,z,X,L,c,V,V,Z);if(ee[V].ModuleInfo[0].ShelfInfo.length>0)await create_shelf_from_json_lib(J,ee,o,"N","Y","D","Y","Y",!1,[],"N",null,m,h,u,S,D,b,v,x,O,C,w,T,N,E,B,W,R,P,Y,A,k,z,L,X,G,U,c,V,V,Z)}}}else{if(g_pog_json[V].ModuleInfo.length>0){$.each(g_pog_json[V].ModuleInfo,(function(e,o){null!=o.ParentModule&&"undefined"!=o.ParentModule||e<J&&(K+=o.W)}))}Q=o/2+K,q=wpdSetFixed(t/2+g_pog_json[V].BaseH);await create_final_module(e,o,t,n,i,q,l,d,_,g,f,Q,J,F,V)}var _e=g_pog_json[V].W;if(g_pog_json[V].BaseH>0){se=parseInt(g_pog_json[V].Color.replace("#","0x"),16),de=new THREE.Color(se);g_pog_json[V].BaseW=_e,g_pog_json[V].BaseX=_e/2;add_base("BASE1",_e,g_pog_json[V].BaseH,g_pog_json[V].BaseD,de,_e/2,g_pog_json[V].BaseY,"Y",V)}if("N"==p){var ge=get_min_max_xy(V).split("###");set_camera_z(c,parseFloat(ge[2]),parseFloat(ge[3]),parseFloat(ge[0]),parseFloat(ge[1]),g_offset_z,parseFloat(ge[4]),parseFloat(ge[5]),!0,g_pog_index)}if("Y"==L)updateObjID(e,I,"M");return logDebug("function : add_module_lib","E"),"SUCCESS"}catch(e){error_handling(e)}}async function create_shelf_edit_pog_lib(e,o,t,n,i,r,a,l,s,_,g,f,p,c,I,m,h,u,S,D,b,v,x,O,C,j,M,y,H,w,T,F,N="N"){logDebug("function : create_shelf_edit_pog_lib; mod_index : "+e+"; p_module_width : "+t+"; draft_ind : "+n+"; new_pog_ind : "+i+"; pog_type : "+r+"; carpark_ind : "+a+"; recreate : "+l,"S");try{var E=-1;if(void 0!==o){if(o.length>0){var B=[],W=0;for(const e in o){var R=g_world.getObjectById(e.SObjID);g_world.remove(R),W++}var P=o;W=0;for(const e of o){R=g_world.getObjectById(e.SObjID);g_world.remove(R),W++}if(g_pog_json[T].ModuleInfo[e].Carpark.length>0&&void 0!==g_pog_json[T].ModuleInfo[e].Carpark[0]&&void 0!==g_pog_json[T].ModuleInfo[e].Carpark[0].ItemInfo&&g_pog_json[T].ModuleInfo[e].Carpark[0].ItemInfo.length>0)for(d of B=JSON.parse(JSON.stringify(g_pog_json[T].ModuleInfo[e].Carpark[0].ItemInfo))){R=g_world.getObjectById(d.ObjID);g_world.remove(R)}"Y"==s&&(g_pog_json[T].ModuleInfo[e].Carpark=[]);W=0;for(const t of P){var Y=-1;if("NOTCH"!==t.ObjType&&"BASE"!==t.ObjType){var A={};"Y"==s?("N"==a?(A.X=t.X,A.Y=t.Y,A.Z=t.Z,A.GrillH=t.GrillH,A.LOverhang=t.LOverhang,A.ROverhang=t.ROverhang,A.SpacerThick=t.SpacerThick,A.HorizGap=null!==t.HorizGap&&""!==t.HorizGap&&void 0!==t.HorizGap?t.HorizGap:0,A.SpreadItem=t.SpreadItem,A.Combine=t.Combine,A.AllowAutoCrush=t.AllowAutoCrush,A.HorizSlotStart=t.HorizSlotStart,A.HorizSlotSpacing=t.HorizSlotSpacing,A.HorizStart=t.HorizStart,A.HorizSpacing=t.HorizSpacing,A.UOverHang=t.UOverHang,A.LoOverHang=t.LoOverHang,A.VertiStart=t.VertiStart,A.VertiSpacing=t.VertiSpacing,A.BsktFill=t.BsktFill,A.BsktSpreadProduct=t.BsktSpreadProduct,A.SnapTo=t.SnapTo,A.BsktWallH=t.BsktWallH,A.BsktBaseH=t.BsktBaseH,A.BsktWallThickness=t.BsktWallThickness,A.DSlotStart=t.DSlotStart,A.DSlotSpacing=t.DSlotSpacing,A.DGap=t.DGap,A.FrontOverHang=t.FrontOverHang,A.BackOverHang=t.BackOverHang,A.SlotDivider=t.SlotDivider,A.AllowOverLap=t.AllowOverLap,A.AutoPlacing=void 0!==t.AutoPlacing&&""!==t.AutoPlacing?t.AutoPlacing:"",A.AutoFillPeg=void 0!==t.AutoFillPeg&&""!==t.AutoFillPeg?t.AutoFillPeg:"",A.AvlSpace=t.W+t.LOverhang+t.ROverhang,A.WrapText=t.WrapText,A.ReduceToFit=t.ReduceToFit,A.TextDirection=t.TextDirection,A.SlotOrientation=t.SlotOrientation,A.DividerFixed=t.DividerFixed,A.LObjID=t.LObjID,A.NotchLabelObjID=t.NotchLabelObjID,A.Shelf=t.Shelf,A.ObjType=t.ObjType,A.Desc=t.Desc,A.MaxMerch=t.MaxMerch,A.FStyle=t.FStyle,A.FSize=t.FSize,A.FBold=t.FBold,A.TextImg=t.TextImg,A.TextImgName=t.TextImgName,A.TextImgMime=t.TextImgMime,A.NotchNo=t.NotchNo,A.ManualCrush=void 0!==t.ManualCrush&&""!==t.ManualCrush?t.ManualCrush:N,A.Overhung=void 0===t.Overhung&&""!==t.Overhung?"N":t.Overhung,"BASE"==t.ObjType?(A.H=g_pog_json[T].BaseH,A.W=g_pog_json[T].BaseW,A.D=g_pog_json[T].BaseD,A.Color=g_pog_json[T].Color):"NOTCH"==t.ObjType?(A.H=g_pog_json[T].ModuleInfo[e].H,A.W=g_pog_json[T].ModuleInfo[e].NotchW,A.D=g_pog_json[T].ModuleInfo[e].D,A.Color=g_pog_json[T].ModuleInfo[e].Color):(A.H=t.H,A.W=t.W,A.D=t.D,void 0===t.Color||"#0"==t.Color?A.Color=g:A.Color=t.Color),A.Rotation=t.Rotation,A.Slope=t.Slope,A.LiveImage=t.LiveImage,A.InputText=t.InputText,A.CompShelfObjID=t.CompShelfObjID,A.ManualZupdate=t.ManualZupdate,A.OldObjID=t.SObjID,A.DivHeight=t.DivHeight,A.DivWidth=t.DivWidth,A.DivPst=t.DivPst,A.DivPed=t.DivPed,A.DivPbtwFace=t.DivPbtwFace,A.DivStX=isNaN(t.DivStX)?0:t.DivStX,A.DivSpaceX=isNaN(t.DivSpaceX)?0:t.DivSpaceX,A.DivFillCol=t.DivFillCol,A.NoDivIDShow=t.NoDivIDShow,A.ChestEdit=null!==t.ChestEdit&&""!==t.ChestEdit&&void 0!==t.ChestEdit?t.ChestEdit:"N",A.ItemInfo=[]):(A.Shelf=t.Shelf,A.ObjType="SHELF",A.Desc="CARPARK_SHELF",A.MaxMerch=0,A.GrillH=0,A.LOverhang=0,A.ROverhang=0,A.SpacerThick=0,A.HorizGap=0,A.SpreadItem="L",A.Combine="N",A.AllowAutoCrush="N",A.H=t.H,A.W=t.W,A.D=t.D,A.Rotation=0,A.Slope=0,A.Color=f,A.LiveImage="",A.HorizSlotStart=0,A.HorizSlotSpacing=0,A.HorizStart=0,A.HorizSpacing=0,A.UOverHang=0,A.LoOverHang=0,A.VertiStart=0,A.VertiSpacing=0,A.X=t.X,A.Y=t.Y,A.InputText="",A.WrapText="",A.ReduceToFit="",A.TextDirection="",A.BsktFill="",A.BsktSpreadProduct="",A.SnapTo="",A.BsktWallH=0,A.BsktBaseH=0,A.BsktWallThickness=0,A.DSlotStart=0,A.DSlotSpacing=0,A.DGap=0,A.FrontOverHang=0,A.BackOverHang=0,A.SlotDivider=p,A.AllowOverLap="N",A.AutoPlacing="N",A.AutoFillPeg="N",A.SlotOrientation=c,A.DividerFixed=I,A.LObjID=-1,A.NotchLabelObjID=-1,A.FStyle="",A.FSize="",A.FBold="",A.TextImg="",A.TextImgName="",A.TextImgMime="",A.TextImageBlob="",A.ItemInfo=[],A.Overhung="N",A.DivHeight=0,A.DivWidth=0,A.DivPst="N",A.DivPed="N",A.DivPbtwFace="N",A.NoDivIDShow="N",A.DivStX=0,A.DivSpaceX=0,A.DivFillCol=f),"NOTCH"!==t.ObjType&&"BASE"!==t.ObjType&&"N"==a?(g_pog_json[T].ModuleInfo[e].ShelfInfo.push(A),Y=g_pog_json[T].ModuleInfo[e].ShelfInfo.length-1):"Y"==a&&null!==t.ItemInfo&&t.ItemInfo.length>0&&(g_pog_json[T].ModuleInfo[e].Carpark.push(A),Y=0)):(A=t,Y=W);var k=A.X-A.W/2,z=parseInt(A.Color.replace("#","0x"),16),X=new THREE.Color(z),L=0;if(void 0===g_pog_json[T].ModuleInfo[e].ParentModule||null==g_pog_json[T].ModuleInfo[e].ParentModule&&"Y"==l)if("PEGBOARD"==A.ObjType)var V=add_pegboard(A.Shelf,A.W,A.H,A.D,X,A.X,A.Y,.004,"N",A.VertiStart,A.VertiSpacing,A.HorizStart,A.HorizSpacing,e,g_pog_json[T].ModuleInfo[e].ShelfInfo.length-1,A.Rotation,A.Slope,"N",x,D,b,v,j,M,C,T);else if("TEXTBOX"==A.ObjType){if("Y"==g_show_live_image&&""!==A.TextImg&&void 0!==A.TextImg&&null!==A.TextImg)V=await add_text_box_with_image(A.Shelf,"TEXTBOX",A.W,A.H,A.D,X,A.X,A.Y,A.Z,"N",e,A.InputText,z,A.WrapText,A.ReduceToFit,A.Color,g_pog_json[T].ModuleInfo[e].ShelfInfo.length-1,A.Rotation,A.Slope,"N",A.FStyle,A.FSize,A.FBold,y,T);else V=add_text_box(A.Shelf,"TEXTBOX",A.W,A.H,A.D,X,A.X,A.Y,A.Z,"N",e,A.InputText,z,A.WrapText,A.ReduceToFit,A.Color,g_pog_json[T].ModuleInfo[e].ShelfInfo.length-1,A.Rotation,A.Slope,"N",A.FStyle,A.FSize,A.FBold,S,T,g_pogcr_enhance_textbox_fontsize,t.TextDirection);mod_details=g_pog_json[T].ModuleInfo;var G=0;for(const e of mod_details)void 0!==e.ParentModule&&null!==e.ParentModule&&e.Module==A.Shelf&&(g_pog_json[T].ModuleInfo[G].ObjID=V),G+=1}else if("ROD"==A.ObjType)V=add_rod(A.Shelf,"SHELF",A.W,A.H,A.D,X,A.X,A.Y,.004,"N",e,g_pog_json[T].ModuleInfo[e].ShelfInfo.length-1,T);else if("BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&(void 0===g_pog_json[T].ModuleInfo[e].ParentModule||null==g_pog_json[T].ModuleInfo[e].ParentModule)&&("Y"==a&&null!==t.ItemInfo&&t.ItemInfo.length>0||"N"==a)){"BASKET"==A.ObjType||"CHEST"==A.ObjType?"Y"==g_chest_as_pegboard&&"CHEST"==A.ObjType?(L=A.D,A.H=A.D):(L=A.BsktBaseH,A.H=A.BsktBaseH):L=A.H;var[V,U]=await add_shelf(A.Shelf,"SHELF",A.W,L,A.D,X,A.X,A.Y,.004,"N",e,A.Rotation,A.Slope,Y,"N",a,"Y",-1,u,y,x,D,b,v,j,M,C,T,o);if(E=V,"Y"==H)updateObjID(A.OldObjID,V,"S")}if("BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&"TEXTBOX"!==t.ObjType&&(void 0===g_pog_json[T].ModuleInfo[e].ParentModule||null==g_pog_json[T].ModuleInfo[e].ParentModule)&&void 0!==o[W].ItemInfo&&null!==o[W].ItemInfo&&o[W].ItemInfo.length>0){if("Y"==a)Z=B;else var Z=t.ItemInfo;if(Z.sort(((e,o)=>e.X>o.X?1:-1)),"Y"==a){var $=g_pog_json[T].ModuleInfo[e].Carpark[Y].ItemInfo;for(d of $){R=g_world.getObjectById(d.ObjID);g_world.remove(R)}}var J=0;for(items of Z){R=g_world.getObjectById(items.ObjID);g_world.remove(R);var Q={};if("Y"==s){if("Y"!==a){if(Q.DimT=items.DimT,Q.PegID=items.PegID,Q.PegSpread=items.PegSpread,Q.PegPerFacing=items.PegPerFacing,Q.Fixed=items.Fixed,Q.CapStyle=items.CapStyle,Q.CapFacing=items.CapFacing,Q.CapMerch=items.CapMerch,Q.CapOrientaion=items.CapOrientaion,Q.CapHeight=items.CapHeight,Q.CapHorz=items.CapHorz,Q.CapDepth=items.CapDepth,Q.CapTotalCount=items.CapTotalCount,Q.CapMaxH=items.CapMaxH,Q.MaxHCapStyle=items.MaxHCapStyle,Q.Rotation=items.Rotation,Q.BaseD=items.BaseD,Q.CrushHoriz=void 0!==items.CrushHoriz?items.CrushHoriz:"",Q.CrushVert=void 0!==items.CrushVert?items.CrushVert:"",Q.CrushD=void 0!==items.CrushD?items.CrushD:"",Q.Price=items.Price,Q.Cost=items.Cost,Q.RegMovement=items.RegMovement,Q.RegMovementInd=void 0!==items.RegMovementInd?items.RegMovementInd:"",Q.DaysOfSupplyInd=void 0!==items.DaysOfSupplyInd?items.DaysOfSupplyInd:"",Q.AvgSales=void 0!==items.AvgSales?Math.floor(100*items.AvgSales)/100:"",Q.AvgSalesInd=void 0!==items.AvgSalesInd?items.AvgSalesInd:"",Q.ItemStatus=void 0!==items.ItemStatus?items.ItemStatus:"",Q.CDTLvl1=void 0!==items.CDTLvl1?items.CDTLvl1:"",Q.CDTLvl2=void 0!==items.CDTLvl2?items.CDTLvl2:"",Q.CDTLvl3=void 0!==items.CDTLvl3?items.CDTLvl3:"",Q.DPPLoc=items.DPPLoc,Q.ActualDPP=void 0!==items.ActualDPP?items.ActualDPP:"",Q.StoreSOH=void 0!==items.StoreSOH?items.StoreSOH:"",Q.StoreNo=void 0!==items.StoreNo?items.StoreNo:"",Q.WeeksOfInventory=void 0!==items.WeeksOfInventory?items.WeeksOfInventory:"",Q.ShelfPrice=void 0!==items.ShelfPrice?items.ShelfPrice:"",Q.PromoPrice=void 0!==items.PromoPrice?items.PromoPrice:"",Q.DiscountRate=void 0!==items.DiscountRate?items.DiscountRate:"",Q.PriceChangeDate=void 0!==items.PriceChangeDate?items.PriceChangeDate:"",Q.WeeksOfInventory=void 0!==items.WeeksOfInventory?items.WeeksOfInventory:"",Q.Qty=void 0!==items.Qty?items.Qty:"",Q.WhStock=void 0!==items.WhStock?items.WhStock:"",Q.StoreStock=void 0!==items.StoreStock?items.StoreStock:"",Q.StockIntransit=void 0!==items.StockIntransit?items.StockIntransit:"",Q.MoveBasis=items.MoveBasis,Q.ItemNesting=items.ItemNesting,Q.NVal=items.NVal,Q.ItemContain=items.ItemContain,Q.CnVal=items.CnVal,Q.IsContainer=items.IsContainer,Q.BsktFactor=items.BsktFactor,Q.OverHang=items.OverHang,Q.VertGap=items.VertGap,Q.OW=items.OW,Q.OH=items.OH,Q.OD=items.OD,Q.Quantity=items.Quantity,Q.Dragged=items.Dragged,Q.SpreadItem=items.SpreadItem,Q.MHorizCrushed=items.MHorizCrushed,Q.MVertCrushed=items.MVertCrushed,Q.MDepthCrushed=items.MDepthCrushed,Q.MCapTopFacing=items.MCapTopFacing,Q.RW=items.RW,Q.RH=items.RH,Q.RD=items.RD,Q.LObjID=items.LObjID,Q.SubLblObjID=items.SubLblObjID,Q.DimUpdate=items.DimUpdate,Q.SlotDivider=items.SlotDivider,Q.CapCount=items.CapCount,Q.X=items.X,Q.Y=items.Y,Q.Z=items.Z,Q.BHoriz=items.BHoriz,Q.BVert=items.BVert,Q.W=items.W,Q.H=items.H,Q.ItemID=items.ItemID,Q.Item=items.Item,Q.D=items.D,void 0===items.Color||null==items.Color?Q.Color=m:Q.Color=items.Color,Q.Desc=items.Desc,Q.Barcode=items.Barcode,Q.LocID=items.LocID,Q.Orientation=items.Orientation,Q.MerchStyle=items.MerchStyle,Q.Supplier=void 0===items.Supplier||null==items.Supplier?"":items.Supplier.split("-")[1],Q.Brand=items.Brand,Q.BrandType=items.BrandType,Q.Group=items.Group,Q.Dept=items.Dept,Q.Class=items.Class,Q.SubClass=items.SubClass,Q.StdUOM=items.StdUOM,Q.SizeDesc=void 0===items.SizeDesc||null==items.SizeDesc?"":items.SizeDesc,Q.HorizGap=items.HorizGap,Q.UW=items.UW,Q.UH=items.UH,Q.UD=items.UD,Q.CW=items.CW,Q.CH=items.CH,Q.CD=items.CD,Q.TW=items.TW,Q.TH=items.TH,Q.TD=items.TD,Q.DW=items.DW,Q.DH=items.DH,Q.DD=items.DD,Q.CWPerc=items.CWPerc,Q.CHPerc=items.CHPerc,Q.CDPerc=items.CDPerc,Q.CnW=items.CnW,Q.CnH=items.CnH,Q.CnD=items.CnD,Q.NW=items.NW,Q.NH=items.NH,Q.ND=items.ND,Q.OldCnW=items.CnW,Q.OldCnH=items.CnH,Q.OldCnD=items.CnD,Q.OldNW=items.NW,Q.OldNH=items.NH,Q.OldND=items.ND,Q.OrgUW=items.OrgUW,Q.OrgUH=items.OrgUH,Q.OrgUD=items.OrgUD,Q.OrgCW=items.OrgCW,Q.OrgCH=items.OrgCH,Q.OrgCD=items.OrgCD,Q.OrgTW=items.OrgTW,Q.OrgTH=items.OrgTH,Q.OrgTD=items.OrgTD,Q.OrgDW=items.OrgDW,Q.OrgDH=items.OrgDH,Q.OrgDD=items.OrgDD,Q.OrgCWPerc=items.OrgCWPerc,Q.OrgCHPerc=items.OrgCHPerc,Q.OrgCDPerc=items.OrgCDPerc,Q.OrgCnW=items.OrgCnW,Q.OrgCnH=items.OrgCnH,Q.OrgCnD=items.OrgCnD,Q.OrgNW=items.OrgNW,Q.OrgNH=items.OrgNH,Q.OrgND=items.OrgND,Q.TopObjID=items.TopObjID,Q.BottomObjID=items.BottomObjID,Q.SecondTier=items.SecondTier,Q.CompItemObjID=items.CompItemObjID,Q.SellingPrice=parseFloat(nvl(items.SellingPrice)),"undefined"!==items.SalesUnit){var q=parseFloat(nvl(items.SalesUnit));Q.SalesUnit=Math.floor(100*q)/100}else Q.SalesUnit="";Q.NetSales=parseFloat(nvl(items.NetSales)),Q.CogsAdj=items.CogsAdj,Q.CogsAdjInd=void 0!==items.CogsAdjInd?items.CogsAdjInd:"",Q.GrossProfit=items.GrossProfit,Q.GrossProfitInd=void 0!==items.GrossProfitInd?items.GrossProfitInd:"",Q.MovingItem=items.MovingItem,Q.WeeksCount=items.WeeksCount,Q.WeeksCountInd=void 0!==items.WeeksCountInd?items.WeeksCountInd:"",Q.Profit=parseFloat(nvl(items.Profit)),Q.GoGreen=items.GoGreen,Q.TotalMargin=parseFloat(nvl(items.TotalMargin)),Q.MHorizFacings=void 0===items.MHorizFacings||null==items.MHorizFacings?-1:parseInt(items.MHorizFacings),Q.MVertFacings=void 0===items.MVertFacings||null==items.MVertFacings?-1:parseInt(items.MVertFacings),Q.MDepthFacings=void 0===items.MDepthFacings||null==items.MDepthFacings?-1:parseInt(items.MDepthFacings),Q.Status=items.Status,Q.OrientationDesc=items.OrientationDesc,Q.StoreCnt=items.StoreCnt,Q.NewYN="",Q.Delist=items.Delist,Q.ImgExists=items.ImgExists,Q.Exists="E",Q.OldObjID=items.ObjID,Q.DescSecond=items.DescSecond,Q.OverhungItem=void 0===items.OverhungItem?"N":items.OverhungItem,Q.CapDepthChanged="N",Q.Brand=items.Brand,Q.ItmDescChi=items.ItmDescChi,(K=items.SizeDesc.split("*")).length>1?Q.ItmDescEng=items.Brand+" "+items.Desc+" "+parseInt(K[0])/parseInt(K[1])+"*"+K[1]+"*"+K[2]:Q.ItmDescEng=items.Brand+" "+items.Desc,Q.PkSiz=parseInt(K[1]),Q.Brand_Category=void 0!==items.Brand_Category?items.Brand_Category:"",Q.ItemSize=void 0!==items.ItemSize?items.ItemSize:"",Q.Categ=void 0!==items.Categ?items.Categ:"",Q.Uda_item_status=void 0!==items.Uda_item_status?items.Uda_item_status:"",Q.Gobecobrand=void 0!==items.Gobecobrand?items.Gobecobrand:"",Q.InternationalRng=void 0!==items.InternationalRng?items.InternationalRng:"",Q.EDLP=void 0!==items.EDLP?items.EDLP:"",Q.LoGrp=void 0!==items.LoGrp?items.LoGrp:"",Q.COO=void 0!==items.COO?items.COO:"",Q.UDA751=void 0!==items.UDA751?items.UDA751:"",Q.UDA755=void 0!==items.UDA755?items.UDA755:"",Q.MPogDepthFacings=void 0!==items.MPogDepthFacings?items.MPogDepthFacings:"",Q.MPogHorizFacings=void 0!==items.MPogHorizFacings?items.MPogHorizFacings:"",Q.MPogVertFacings=void 0!==items.MPogVertFacings?items.MPogVertFacings:"",Q.ItemCondition=0!=nvl(items.ItemCondition)?items.ItemCondition:"",Q.AUR=0!=nvl(items.AUR)?items.AUR:"",Q.ItemRanking=0!=nvl(items.ItemRanking)?items.ItemRanking:"",Q.WeeklySales=0!=nvl(items.WeeklySales)?items.WeeklySales:"",Q.WeeklyNetMargin=0!=nvl(items.WeeklyNetMargin)?items.WeeklyNetMargin:"",Q.WeeklyQty=0!=nvl(items.WeeklyQty)?items.WeeklyQty:"",Q.NetMarginPercent=void 0!==items.NetMarginPercent?items.NetMarginPercent:void 0!==items.NetMarginPerc?NetMarginPerc:"",Q.CumulativeNM=0!=nvl(items.CumulativeNM)?items.CumulativeNM:"",Q.TOP80B2=0!=nvl(items.TOP80B2)?items.TOP80B2:"",Q.ItemBrandC=0!=nvl(items.ItemBrandC)?items.ItemBrandC:"",Q.ItemPOGDept=0!=nvl(items.ItemPOGDept)?items.ItemPOGDept:"",Q.ItemRemark=0!=nvl(items.ItemRemark)?items.ItemRemark:"",Q.RTVStatus=0!=nvl(items.RTVStatus)?items.RTVStatus:"",Q.Pusher=0!=nvl(items.Pusher)?items.Pusher:"",Q.Divider=0!=nvl(items.Divider)?items.Divider:"",Q.BackSupport=0!=nvl(items.BackSupport)?items.BackSupport:"",Q.OOSPerc=nvl(items.OOSPerc),Q.InitialItemDesc=void 0!==items.InitialItemDesc?items.InitialItemDesc:"",Q.InitialBrand=void 0!==items.InitialBrand?items.InitialBrand:"",Q.InitialBarcode=void 0!==items.InitialBarcode?items.InitialBarcode:"",Q.Distance=wpdSetFixed(nvl(items.Distance))}else{if("N"==i&&"F"==r?(Q.DimT=items.MerchStyle,Q.PegID="",Q.PegSpread="",Q.PegPerFacing="",Q.Fixed="N",Q.CapStyle="0",Q.CapFacing="",Q.CapMerch="",Q.CapOrientaion="",Q.CapHeight="",Q.CapHorz="",Q.CapDepth="",Q.CapTotalCount="",Q.CapMaxH=0,Q.MaxHCapStyle="3",Q.Rotation=0,Q.CrushHoriz=0,Q.CrushVert=0,Q.CrushD=0,Q.Price="",Q.Cost="",Q.RegMovement="",Q.RegMovementInd=void 0!==items.RegMovementInd?items.RegMovementInd:"",Q.DaysOfSupplyInd=void 0!==items.DaysOfSupplyInd?items.DaysOfSupplyInd:"",Q.AvgSales=void 0!==items.AvgSales?Math.floor(100*items.AvgSales)/100:"",Q.ItemStatus=void 0!==items.ItemStatus?items.ItemStatus:"",Q.CDTLvl1="",Q.CDTLvl2="",Q.CDTLvl3="",Q.ActualDPP="",Q.DPPLoc="",Q.StoreSOH="",Q.StoreNo="",Q.WeeksOfInventory="",Q.ShelfPrice="",Q.PromoPrice="",Q.DiscountRate="",Q.PriceChangeDate="",Q.WeeksOfInventory="",Q.Qty="",Q.WhStock="",Q.StoreStock="",Q.StockIntransit="",Q.MoveBasis="",Q.IsContainer="N",Q.BsktFactor=0,Q.OverHang=0,Q.VertGap=0,Q.BHoriz=null==items.BHoriz?1:items.BHoriz,Q.BVert=null==items.BVert?1:items.BVert,Q.BaseD=null==items.BaseD?1:items.BaseD,Q.W=items.W,Q.H=items.H,Q.D=items.D,"BASKET"==A.ObjType?(Q.W=A.W,Q.H=items.D*items.Quantity,Q.D=items.D*Q.BaseD,Q.RW=items.W,Q.RH=items.H,Q.RD=items.D):(Q.W=Q.W*Q.BHoriz,Q.H=Q.H*Q.BVert,Q.D=Q.D*Q.BaseD,Q.RW=Q.W,Q.RH=Q.H,Q.RD=Q.D),Q.OW=items.W,Q.OH=items.H,Q.OD=items.D,Q.LObjID=items.LObjID,Q.SubLblObjID=items.SubLblObjID,Q.Dragged="N",Q.SpreadItem=0,Q.MHorizCrushed="N",Q.MVertCrushed="N",Q.MDepthCrushed="N",Q.MCapTopFacing="N",Q.X=items.X,Q.Y=A.Y+A.H/2+Q.H/2,Q.Z=items.Z,Q.SlotDivider="N",Q.CapCount=0,Q.Distance=Q.X-Q.W/2-k,"PEGBOARD"==A.ObjType&&(Q.PegBoardX=Q.X-Q.W/2-k,Q.PegBoardY=Q.Y-Q.H/2-(A.Y-A.H/2))):(Q.DimT=items.DimT,Q.PegID=items.PegID,Q.PegSpread=items.PegSpread,Q.PegPerFacing=items.PegPerFacing,Q.Fixed=items.Fixed,Q.CapStyle=items.CapStyle,Q.CapFacing=items.CapFacing,Q.CapMerch=items.CapMerch,Q.CapOrientaion=items.CapOrientaion,Q.CapHeight=items.CapHeight,Q.CapHorz=items.CapHorz,Q.CapDepth=items.CapDepth,Q.CapTotalCount=items.CapTotalCount,Q.CapMaxH=void 0!==items.CapMaxH?items.CapMaxH:0,Q.MaxHCapStyle=void 0!==items.MaxHCapStyle?items.MaxHCapStyle:"3",Q.Rotation=items.Rotation,Q.CrushHoriz=items.CrushHoriz,Q.CrushVert=items.CrushVert,Q.CrushD=items.CrushD,Q.Price=items.Price,Q.Cost=items.Cost,Q.RegMovement=items.RegMovement,Q.RegMovementInd=void 0!==items.RegMovementInd?items.RegMovementInd:"",Q.DaysOfSupplyInd=void 0!==items.DaysOfSupplyInd?items.DaysOfSupplyInd:"",Q.AvgSales=void 0!==items.AvgSales?Math.floor(100*items.AvgSales)/100:"",Q.ItemStatus=void 0!==items.ItemStatus?items.ItemStatus:"",Q.CDTLvl1=void 0!==items.CDTLvl1?items.CDTLvl1:"",Q.CDTLvl2=void 0!==items.CDTLvl2?items.CDTLvl2:"",Q.CDTLvl3=void 0!==items.CDTLvl3?items.CDTLvl3:"",Q.ActualDPP=void 0!==items.ActualDPP?items.ActualDPP:"",Q.DPPLoc=items.DPPLoc,Q.StoreSOH=void 0!==items.StoreSOH?items.StoreSOH:"",Q.StoreNo=void 0!==items.StoreNo?items.StoreNo:"",Q.WeeksOfInventory=void 0!==items.WeeksOfInventory?items.WeeksOfInventory:"",Q.ShelfPrice=void 0!==items.ShelfPrice?items.ShelfPrice:"",Q.PromoPrice=void 0!==items.PromoPrice?items.PromoPrice:"",Q.DiscountRate=void 0!==items.DiscountRate?items.DiscountRate:"",Q.PriceChangeDate=void 0!==items.PriceChangeDate?items.PriceChangeDate:"",Q.WeeksOfInventory=void 0!==items.WeeksOfInventory?items.WeeksOfInventory:"",Q.Qty=void 0!==items.Qty?items.Qty:"",Q.WhStock=void 0!==items.WhStock?items.WhStock:"",Q.StoreStock=void 0!==items.StoreStock?items.StoreStock:"",Q.StockIntransit=void 0!==items.StockIntransit?items.StockIntransit:"",Q.MoveBasis=items.MoveBasis,Q.IsContainer=items.IsContainer,Q.BsktFactor=items.BsktFactor,Q.OverHang=items.OverHang,Q.VertGap=items.VertGap,Q.OW=items.OW,Q.OH=items.OH,Q.OD=items.OD,Q.Dragged=items.Dragged,Q.SpreadItem=items.SpreadItem,Q.MHorizCrushed=items.MHorizCrushed,Q.MVertCrushed=items.MVertCrushed,Q.MDepthCrushed=items.MDepthCrushed,Q.MCapTopFacing=items.MCapTopFacing,Q.RW=items.RW,Q.RH=items.RH,Q.RD=items.RD,Q.LObjID=items.LObjID,Q.SubLblObjID=items.SubLblObjID,Q.SlotDivider=items.SlotDivider,Q.CapCount=items.CapCount,Q.X=items.X,Q.Y=items.Y,"HANGINGBAR"==A.ObjType?Q.Y=A.Y-items.H/2:Q.Y=items.Y,Q.BHoriz=items.BHoriz,Q.BVert=items.BVert,Q.BaseD=items.BaseD,Q.W=items.W,Q.H=items.H,Q.D=items.D,Q.Distance=items.Distance,Q.PegBoardX=items.PegBoardX,Q.PegBoardY=items.PegBoardY),Q.Z=0==items.Z?items.Z+items.D/2:items.Z,Q.Quantity=items.Quantity,Q.ItemID=items.ItemID,Q.Item=items.Item,void 0===items.Color||null==items.Color?Q.Color=m:Q.Color=items.Color,Q.Desc=items.Desc,Q.Barcode=items.Barcode,Q.LocID=items.LocID,Q.Orientation=items.Orientation,Q.MerchStyle=null==items.MerchStyle||void 0===items.MerchStyle||""==items.MerchStyle?"0":items.MerchStyle,Q.Supplier=items.Supplier,Q.Brand=items.Brand,Q.BrandType=items.BrandType,Q.Group=items.Group,Q.Dept=items.Dept,Q.Class=items.Class,Q.SubClass=items.SubClass,Q.StdUOM=items.StdUOM,Q.SizeDesc=void 0===items.SizeDesc||null==items.SizeDesc?"":items.SizeDesc,Q.HorizGap=items.HorizGap,Q.UW=items.UW,Q.UH=items.UH,Q.UD=items.UD,Q.CW=items.CW,Q.CH=items.CH,Q.CD=items.CD,Q.TW=items.TW,Q.TH=items.TH,Q.TD=items.TD,Q.DW=items.DW,Q.DH=items.DH,Q.DD=items.DD,Q.CWPerc=items.CWPerc,Q.CHPerc=items.CHPerc,Q.CDPerc=items.CDPerc,Q.TopObjID=items.TopObjID,Q.BottomObjID=items.BottomObjID,Q.SecondTier=items.SecondTier,Q.CompItemObjID=items.CompItemObjID,Q.SellingPrice=parseFloat(nvl(items.SellingPrice)),"undefined"!==items.SalesUnit){q=parseFloat(nvl(items.SalesUnit));Q.SalesUnit=Math.floor(100*q)/100}else Q.SalesUnit="";var K;Q.NetSales=parseFloat(nvl(items.NetSales)),Q.CogsAdj=items.CogsAdj,Q.CogsAdjInd=void 0!==items.CogsAdjInd?items.CogsAdjInd:"",Q.GrossProfit=items.GrossProfit,Q.GrossProfitInd=void 0!==items.GrossProfitInd?items.GrossProfitInd:"",Q.WeeksCount=items.WeeksCount,Q.WeeksCountInd=void 0!==items.WeeksCountInd?items.WeeksCountInd:"",Q.MovingItem=items.MovingItem,Q.RegMovement=items.RegMovement,Q.RegMovementInd=void 0!==items.RegMovementInd?items.RegMovementInd:"",Q.DaysOfSupplyInd=void 0!==items.DaysOfSupplyInd?items.DaysOfSupplyInd:"",Q.AvgSales=void 0!==items.AvgSales?Math.floor(100*items.AvgSales)/100:"",Q.AvgSalesInd=void 0!==items.AvgSalesInd?items.AvgSalesInd:"",Q.ItemStatus=void 0!==items.ItemStatus?items.ItemStatus:"",Q.CDTLvl1=void 0!==items.CDTLvl1?items.CDTLvl1:"",Q.CDTLvl2=void 0!==items.CDTLvl2?items.CDTLvl2:"",Q.CDTLvl3=void 0!==items.CDTLvl3?items.CDTLvl3:"",Q.ActualDPP=void 0!==items.ActualDPP?items.ActualDPP:"",Q.DPPLoc=items.DPPLoc,Q.StoreSOH=void 0!==items.StoreSOH?items.StoreSOH:"",Q.StoreNo=void 0!==items.StoreNo?items.StoreNo:"",Q.WeeksOfInventory=void 0!==items.WeeksOfInventory?items.WeeksOfInventory:"",Q.ShelfPrice=void 0!==items.ShelfPrice?items.ShelfPrice:"",Q.PromoPrice=void 0!==items.PromoPrice?items.PromoPrice:"",Q.DiscountRate=void 0!==items.DiscountRate?items.DiscountRate:"",Q.PriceChangeDate=void 0!==items.PriceChangeDate?items.PriceChangeDate:"",Q.WeeksOfInventory=void 0!==items.WeeksOfInventory?items.WeeksOfInventory:"",Q.Qty=void 0!==items.Qty?items.Qty:"",Q.WhStock=void 0!==items.WhStock?items.WhStock:"",Q.StoreStock=void 0!==items.StoreStock?items.StoreStock:"",Q.StockIntransit=void 0!==items.StockIntransit?items.StockIntransit:"",Q.Profit=parseFloat(nvl(items.Profit)),Q.TotalMargin=parseFloat(nvl(items.TotalMargin)),Q.MHorizFacings=parseInt(items.MHorizFacings),Q.MVertFacings=parseInt(items.MVertFacings),Q.MDepthFacings=parseInt(items.MDepthFacings),Q.Status=items.Status,Q.Cost=items.Cost,Q.Price=items.Price,Q.DaysOfSupply=items.DaysOfSupply,Q.ShowColorBackup=items.ShowColorBackup,Q.OrientationDesc=items.OrientationDesc,Q.StoreCnt=items.StoreCnt,Q.NewYN="",Q.DescSecond=items.DescSecond,Q.Delist=void 0===items.Delist?"N":items.Delist,Q.OverhungItem=void 0===items.OverhungItem?"N":items.OverhungItem,"Y"==Q.Delist&&(Q.Color=h),void 0===items.CnW?Q.CnW=0:Q.CnW=items.CnW,void 0===items.CnH?Q.CnH=0:Q.CnH=items.CnH,void 0===items.CnD?Q.CnD=0:Q.CnD=items.CnD,void 0===items.NW?Q.NW=0:Q.NW=items.NW,void 0===items.NH?Q.NH=0:Q.NH=items.NH,void 0===items.ND?Q.ND=0:Q.ND=items.ND,Q.ItemNesting=items.ItemNesting,Q.NVal="H"==Q.ItemNesting?items.NH:"W"==Q.ItemNesting?items.NW:"D"==Q.ItemNesting?items.ND:0,Q.ItemContain=items.ItemContain,Q.CnVal="H"==Q.ItemContain?items.CnH:"W"==Q.ItemContain?items.CnW:"D"==Q.ItemContain?items.CnD:0,Q.OldCnW=Q.CnW,Q.OldCnH=Q.CnH,Q.OldCnD=Q.CnD,Q.OldNW=Q.NW,Q.OldNH=Q.NH,Q.OldND=Q.ND,Q.OrgUW=items.OrgUW,Q.OrgUH=items.OrgUH,Q.OrgUD=items.OrgUD,Q.OrgCW=items.OrgCW,Q.OrgCH=items.OrgCH,Q.OrgCD=items.OrgCD,Q.OrgTW=items.OrgTW,Q.OrgTH=items.OrgTH,Q.OrgTD=items.OrgTD,Q.OrgDW=items.OrgDW,Q.OrgDH=items.OrgDH,Q.OrgDD=items.OrgDD,Q.OrgCWPerc=items.OrgCWPerc,Q.OrgCHPerc=items.OrgCHPerc,Q.OrgCDPerc=items.OrgCDPerc,Q.OrgCnW=items.OrgCnW,Q.OrgCnH=items.OrgCnH,Q.OrgCnD=items.OrgCnD,Q.OrgNW=items.OrgNW,Q.OrgNH=items.OrgNH,Q.OrgND=items.OrgND,Q.ImgExists=items.ImgExists,Q.Exists="E",Q.DimUpdate="N",Q.ItemImage=items.ItemImage,Q.Edited="Y",Q.OldObjID=items.ObjID,Q.Brand=items.Brand,Q.ItmDescChi=items.ItmDescChi,(K=items.SizeDesc.split("*")).length>1?Q.ItmDescEng=items.Brand+" "+items.Desc+" "+parseInt(K[0])/parseInt(K[1])+"*"+K[1]+"*"+K[2]:Q.ItmDescEng=items.Brand+" "+items.Desc,Q.PkSiz=parseInt(K[1]),Q.Brand_Category=void 0!==items.Brand_Category?items.Brand_Category:"",Q.ItemSize=void 0!==items.ItemSize?items.ItemSize:"",Q.Categ=void 0!==items.Categ?items.Categ:"",Q.Uda_item_status=void 0!==items.Uda_item_status?items.Uda_item_status:"",Q.Gobecobrand=void 0!==items.Gobecobrand?items.Gobecobrand:"",Q.InternationalRng=void 0!==items.InternationalRng?items.InternationalRng:"",Q.EDLP=void 0!==items.EDLP?items.EDLP:"",Q.LoGrp=void 0!==items.LoGrp?items.LoGrp:"",Q.COO=void 0!==items.COO?items.COO:"",Q.UDA751=void 0!==items.UDA751?items.UDA751:"",Q.UDA755=void 0!==items.UDA755?items.UDA755:"",Q.MPogDepthFacings=void 0!==items.MPogDepthFacings?items.MPogDepthFacings:"",Q.MPogHorizFacings=void 0!==items.MPogHorizFacings?items.MPogHorizFacings:"",Q.MPogVertFacings=void 0!==items.MPogVertFacings?items.MPogVertFacings:"",Q.Internet=void 0!==items.Internet?items.Internet:"",Q.SplrLbl=void 0!==items.SplrLbl?items.SplrLbl:"",Q.ItemCondition=0!=nvl(items.ItemCondition)?items.ItemCondition:"",Q.AUR=0!=nvl(items.AUR)?items.AUR:"",Q.ItemRanking=0!=nvl(items.ItemRanking)?items.ItemRanking:"",Q.WeeklySales=0!=nvl(items.WeeklySales)?items.WeeklySales:"",Q.WeeklyNetMargin=0!=nvl(items.WeeklyNetMargin)?items.WeeklyNetMargin:"",Q.WeeklyQty=0!=nvl(items.WeeklyQty)?items.WeeklyQty:"",Q.NetMarginPercent=void 0!==items.NetMarginPercent?items.NetMarginPercent:void 0!==items.NetMarginPerc?items.NetMarginPerc:"",Q.CumulativeNM=0!=nvl(items.CumulativeNM)?items.CumulativeNM:"",Q.TOP80B2=0!=nvl(items.TOP80B2)?items.TOP80B2:"",Q.ItemBrandC=0!=nvl(items.ItemBrandC)?items.ItemBrandC:"",Q.ItemPOGDept=0!=nvl(items.ItemPOGDept)?items.ItemPOGDept:"",Q.ItemRemark=0!=nvl(items.ItemRemark)?items.ItemRemark:"",Q.RTVStatus=0!=nvl(items.RTVStatus)?items.RTVStatus:"",Q.Pusher=0!=nvl(items.Pusher)?items.Pusher:"",Q.Divider=0!=nvl(items.Divider)?items.Divider:"",Q.BackSupport=0!=nvl(items.BackSupport)?items.BackSupport:"",Q.OOSPerc=nvl(items.OOSPerc),Q.InitialItemDesc=void 0!==items.InitialItemDesc?items.InitialItemDesc:"",Q.InitialBrand=void 0!==items.InitialBrand?items.InitialBrand:"",Q.InitialBarcode=void 0!==items.InitialBarcode?items.InitialBarcode:""}"Y"!==a?g_pog_json[T].ModuleInfo[e].ShelfInfo[Y].ItemInfo.push(Q):g_pog_json[T].ModuleInfo[e].Carpark[Y].ItemInfo.push(Q)}else Q=items;if("DIVIDER"==Q.Item&&"Y","Y"==l){if("Y"==a)var ee=await add_carpark_item(Q.ItemID,Q.W,Q.H,Q.D,Q.Color,Q.X,Q.Y,Q.Z,e,Y,J,"Y","N",g_show_live_image,"",T);else if("Y"==g_show_live_image&&3!=items.MerchStyle){var oe=g_orientation_json[items.Orientation].split("###");ee=await add_items_with_image(Q.ItemID,Q.W,Q.H,Q.D,Q.Color,Q.X,Q.Y,Q.Z,e,Y,J,Q.BHoriz,Q.BVert,Q.Item,parseInt(oe[0]),parseInt(oe[1]),"N","N",D,b,v,j,M,C,T)}else ee=await add_items_prom(Q.ItemID,Q.W,Q.H,Q.D,Q.Color,Q.X,Q.Y,Q.Z,e,Y,J,"N","N",x,O,C,j,M,T);if("N"==Q.Status)(R=g_world.getObjectById(ee)).BorderColour=g_status_error_color,R.Status="N",R.WireframeObj.material.color.setHex(R.BorderColour);"N"==a?(g_pog_json[T].ModuleInfo[e].ShelfInfo[Y].ItemInfo[J].Z=.025,g_pog_json[T].ModuleInfo[e].ShelfInfo[Y].ItemInfo[J].ObjID=ee,g_pog_json[T].ModuleInfo[e].ShelfInfo[Y].ItemInfo[J].CType=A.ObjType):(g_pog_json[T].ModuleInfo[e].Carpark[Y].ItemInfo[J].Z=.025,g_pog_json[T].ModuleInfo[e].Carpark[Y].ItemInfo[J].ObjID=ee,g_pog_json[T].ModuleInfo[e].Carpark[Y].ItemInfo[J].CType=A.ObjType)}J+=1}if("N"==a){Z=g_pog_json[T].ModuleInfo[e].ShelfInfo[Y].ItemInfo;for(const e of Z)if(void 0!==e.TopObjID&&""!==e.TopObjID||void 0!==e.BottomObjID&&""!==e.BottomObjID)reset_top_bottom_obj_id(""!==e.TopObjID&&void 0!==e.TopObjID?"BOTTOM":"TOP",e.OldObjID,e.ObjID,e.X,"N",T)}}}W+=1}}return logDebug("function : create_shelf_edit_pog_lib","E"),E}}catch(e){error_handling(e)}}function create_final_module(e,o,t,n,i,r,a,l,s,d,_,g,f,p,c){try{return logDebug("function : create_final_module; uuid : "+e+"; width : "+o+"; height : "+t+"; depth : "+n+"; color : "+i+"; y : "+r+"; p_edit_ind : "+a+"; vert_start : "+l+"; vert_spacing : "+s+"; horz_start : "+d+"; horz_spacing : "+_+"; finalX : "+g+"; edit_module_index : "+f,"S"),new Promise((function(n,I){var m=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshStandardMaterial({color:i}));if(s>0||_>0){var h=add_dots_to_object(o-2*g_pog_json[c].ModuleInfo[f].NotchW,t,7e-4,l,s,d,_,m,"MODULE","",f,p,"N",c);h.position.x=g,h.position.y=r,h.position.z=0,h.uuid=e,g_pog_json[c].ModuleInfo[f].NotchW>0&&add_notches("MODULE"+f+"_NOTCHES",g_pog_json[c].ModuleInfo[f].NotchW,t,g_pog_json[c].ModuleInfo[f].NotchStart,g_pog_json[c].ModuleInfo[f].NotchSpacing,i,a,o,f,h,c);var u=add_wireframe(h,2);h.WFrameID=u,g_world.add(h),"N"==a||(0==f?g_module_obj_array.splice(f,f+1):g_module_obj_array.splice(f,1)),g_module_obj_array.push(h),g_pog_json[c].ModuleInfo[f].MObjID=h.id,g_pog_json[c].ModuleInfo[f].WFrameID=u,h.Module=g_pog_json[c].ModuleInfo[f].Module,h.POGCode=g_pog_json[c].POGCode,h.Version=g_pog_json[c].Version,h.SvnCode=g_pog_json[c].ModuleInfo[f].SvnCode,h.EgtCode=g_pog_json[c].ModuleInfo[f].EgtCode,h.Remarks=null!==g_pog_json[c].ModuleInfo[f].Remarks?g_pog_json[c].ModuleInfo[f].Remarks:""}else{m.position.x=g,m.position.y=r,m.position.z=0,m.uuid=e,g_pog_json[c].ModuleInfo[f].NotchW>0&&add_notches("MODULE"+f+"_NOTCHES",g_pog_json[c].ModuleInfo[f].NotchW,t,g_pog_json[c].ModuleInfo[f].NotchStart,g_pog_json[c].ModuleInfo[f].NotchSpacing,i,a,o,f,m,c);u=add_wireframe(m,2);m.WFrameID=u,g_world.add(m),"N"==a||(0==f?g_module_obj_array.splice(f,f+1):g_module_obj_array.splice(f,1)),g_module_obj_array.push(m),g_pog_json[c].ModuleInfo[f].MObjID=m.id,g_pog_json[c].ModuleInfo[f].WFrameID=u,m.Module=g_pog_json[c].ModuleInfo[f].Module,m.POGCode=g_pog_json[c].POGCode,m.Version=g_pog_json[c].Version,m.Remarks=null!==g_pog_json[c].ModuleInfo[f].Remarks?g_pog_json[c].ModuleInfo[f].Remarks:"",m.SvnCode=g_pog_json[c].ModuleInfo[f].SvnCode,m.EgtCode=g_pog_json[c].ModuleInfo[f].EgtCode}g_pog_json[c].ModuleInfo[f].X=wpdSetFixed(g),g_pog_json[c].ModuleInfo[f].Y=wpdSetFixed(r),g_pog_json[c].ModuleInfo[f].Z=0,n("SUCCESS"),logDebug("function : create_final_module","E")}))}catch(e){error_handling(e)}}function update_module_coords(e,o,t,n){logDebug("function : update_module_coords; height : "+e+"; width : "+o+"; module_ind : "+t,"S");try{var i,r=parseFloat(g_pog_json[n].ModuleInfo.length)-1,a=0,l="N",s=[],d=[],_=[];$.each(g_pog_json[n].ModuleInfo,(function(e,o){null!=o.ParentModule&&"undefined"!=o.ParentModule||(e<t?a+=o.W:e>t&&(l="Y"))})),"Y"==l?(i=a+o/2,s.push(i),d.push(e/2+g_pog_json[n].BaseH),_.push(r),a+=o,$.each(g_pog_json[n].ModuleInfo,(function(e,o){null!=o.ParentModule&&"undefined"!=o.ParentModule||e>t&&(i=a+o.W/2,_.push(e),s.push(i),d.push(o.H/2+g_pog_json[n].BaseH),a+=o.W)})),s.forEach(((e,o)=>{_[o],d[o];g_pog_json[n].ModuleInfo[_[o]].X=e,g_pog_json[n].ModuleInfo[_[o]].Y=d[o]}))):(g_pog_json[n].ModuleInfo[t].X=a+o/2,g_pog_json[n].ModuleInfo[t].Y=e/2+g_pog_json[n].BaseH),logDebug("function : update_module_coords","E")}catch(e){error_handling(e),logDebug("function : update_module_coords","E")}}function getCombinedBoundingBox(e){logDebug("function : getCombinedBoundingBox","S");try{const o=new THREE.Box3;return e.traverse((e=>{e.geometry&&(e.geometry.computeBoundingBox(),o.union(e.geometry.boundingBox))})),logDebug("function : getCombinedBoundingBox","E"),o}catch(e){error_handling(e),logDebug("function : getCombinedBoundingBox","E")}}async function add_shelf(e,o,t,n,i,r,a,l,s,d,_,g,f,p,c,I,m,h,u,S,D,b,v,x,O,C,j,M,y=g_pog_json){logDebug("function : add_shelf; uuid : "+e+"; type : "+o+"; width : "+t+"; height : "+n+"; depth : "+i+"; color : "+r+"; x : "+a+"; y : "+l+"; z : "+s+"; p_edit_ind : "+d+"; mod_index : "+_+"; rotation : "+g+"; slope : "+f+"; shelf_ind : "+p+"; recreate : "+c+"; carpark_ind : "+I+"; shelf_edit : "+m,"S");try{"Y"==I&&(r=u),0!==g||0!==f||(i=.001);var H,w,T=0;if(h=void 0===h?-1:h,void 0!==g_module_width&&""!=g_module_width||(g_module_width=parseFloat(g_pog_json[M].ModuleInfo[_].W)),"Y"==d){var F=g_world.getObjectById(g_dblclick_objid);g_world.remove(F),H=p}else H=-1!==p?p:parseFloat(g_pog_json[M].ModuleInfo[_].ShelfInfo.length)-1;var N=g_pog_json[M].ModuleInfo[_].ShelfInfo[H];if("N"==I?(w=N.ObjType,T=N.AvlSpace):(T=g_pog_json[M].ModuleInfo[_].Carpark[0].AvlSpace,w="SHELF"),0==g&&0==f){g=0,f=0;var E=add_wireframe(W=new THREE.Mesh(new THREE.BoxGeometry(t,n,i),new THREE.MeshStandardMaterial({color:r})),2);if("N"==I)var B=N;else B=g_pog_json[M].ModuleInfo[_].Carpark[H];W.WFrameID=E,W.position.x=a,W.position.y=l,"N"==I&&isShelfOnPegboard(a,l,_,M,B,y)?W.position.z=.004:W.position.z=9e-4,W.uuid=e,W.POGCode=g_pog_json[M].POGCode,W.Version=g_pog_json[M].Version,W.X=wpdSetFixed(100*B.X-100*B.W/2),"Y"==B.EditNotch?W.Y=wpdSetFixed(100*B.EditNotchY):W.Y=wpdSetFixed(100*B.Y-100*B.H/2),W.Z=wpdSetFixed(100*B.Z-100*B.D/2),W.NotchNo=B.NotchNo,W.Desc=B.Desc,W.FixelID=B.Shelf,W.Module=g_pog_json[M].ModuleInfo[_].Module,W.W=B.W,W.H=B.H,W.D=B.D,W.ROverhang=B.ROverhang,W.LOverhang=B.LOverhang,W.Color=B.Color,W.Rotation=g,W.ItemSlope=f,W.RotationFlag=0!==g||0!==f?"Y":"N",W.ImageExists="N","SHELF"==w&&(W.AvlSpace=wpdSetFixed(nvl(T))),g_world.add(W),"N"==I?(N.WFrameID=E,"Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&g_edit_pallet_shelfid==N.SObjID&&(g_pog_json[M].ModuleInfo[0].ShelfInfo[0]=JSON.parse(JSON.stringify(N)),g_pog_json[M].ModuleInfo[0].ShelfInfo[0].PrimeShelfObjID=parseInt(W.id)),N.SObjID=parseInt(W.id)):(g_pog_json[M].ModuleInfo[_].Carpark[H].WFrameID=E,g_pog_json[M].ModuleInfo[_].Carpark[H].SObjID=parseInt(W.id))}else{g_rotation=g,g_slope=f=f>0?0-f:-f;var W;E=add_wireframe(W=new THREE.Mesh(new THREE.BoxGeometry(t,n,i),new THREE.MeshBasicMaterial({color:r})),2);W.WFrameID=E;var R=0;if("Y"==c&&"N"==d){for(const e of g_pog_json[M].ModuleInfo)null==e.ParentModule&&(R=Math.max(R,parseFloat(e.X)+e.W/2));a=R+t/2,l=g_pog_json[M].CameraY}W.uuid=e,W.rotateY(g*Math.PI/180),W.rotateX(f*Math.PI/180),g_world.add(W),W.geometry.computeBoundingBox();W.geometry.boundingBox;var P=(new THREE.Box3).setFromObject(W).getSize(new THREE.Vector3);if(W.position.x=a,W.position.y=l,W.position.y=f<0?l+parseFloat(P.y)/2:l-parseFloat(P.y)/2,W.position.z=i/2+g_pog_json[M].BackDepth,"N"==I)B=N;else B=g_pog_json[M].ModuleInfo[_].Carpark[H];if(W.POGCode=g_pog_json[M].POGCode,W.Version=g_pog_json[M].Version,W.X=wpdSetFixed(100*B.X-100*B.W/2),"Y"==B.EditNotch?W.Y=wpdSetFixed(100*B.EditNotchY):W.Y=wpdSetFixed(100*B.Y-100*B.H/2),W.Z=wpdSetFixed(100*B.Z-100*B.D/2),W.Desc=B.Desc,W.FixelID=B.Shelf,W.Module=g_pog_json[M].ModuleInfo[_].Module,W.W=B.W,W.H=B.H,W.D=B.D,W.ROverhang=B.ROverhang,W.LOverhang=B.LOverhang,W.Color=B.Color,W.Rotation=g,W.ItemSlope=f,W.NotchNo=B.NotchNo,W.Rotation=0!==g||0!==f?"Y":"N",W.ImageExists="N","SHELF"==w&&(W.AvlSpace=wpdSetFixed(nvl(T))),"N"==I&&("Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&g_edit_pallet_shelfid==N.SObjID&&(g_pog_json[M].ModuleInfo[0].ShelfInfo[0]=JSON.parse(JSON.stringify(g_pog_json[M].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index])),g_pog_json[M].ModuleInfo[0].ShelfInfo[0].PrimeShelfObjID=parseInt(W.id)),N.X=a,N.Y=l,N.SObjID=parseInt(W.id),N.Z=i/2+g_pog_json[M].BackDepth,N.WFrameID=E,N.ShelfRotateWidth=parseFloat(P.x),N.ShelfRotateHeight=parseFloat(P.y),N.ShelfRotateDepth=parseFloat(P.z)),"N"==g_manual_zoom_ind){var Y=get_min_max_xy(M).split("###");set_camera_z(g_camera,parseFloat(Y[2]),parseFloat(Y[3]),parseFloat(Y[0]),parseFloat(Y[1]),g_offset_z,parseFloat(Y[4]),parseFloat(Y[5]),!0,g_pog_index)}"Y"==c&&"N"==d&&(a=wpdSetFixed(R+t/2),l=g_pog_json[M].CameraY),W.position.x=a,W.position.y=wpdSetFixed(f<0?l+parseFloat(P.y)/2:l-parseFloat(P.y)/2),0!==g&&(W.quaternion.copy(g_camera.quaternion),W.lookAt(g_pog_json[M].CameraX,g_pog_json[M].CameraY,g_pog_json[M].CameraZ),W.rotateY(g*Math.PI/180),W.rotateX(f*Math.PI/180))}W.BorderColour=0;var A=parseInt(W.id);if("Y"==g_show_fixel_label&&"N"==I){if("BASE"!==w&&"NOTCH"!==w){var k=N.Color;if(null==hexToRgb(k))var z=parseInt("FF",16),X=parseInt("FF",16),L=parseInt("FF",16);else z=hexToRgb(k).r,X=hexToRgb(k).r,L=hexToRgb(k).g;var V=getTextColor(z,X,L);if("Y"==g_fixel_label){var G=get_notch_no(g_pog_json[M].ModuleInfo[_],M,N.Y+N.H/2),U=addlabelText(N.Shelf+" "+N.Desc+" "+parseFloat(100*N.Y-N.H/2*100).toFixed(2)+get_message("POGCR_FIXEL_CM")+" "+G,g_labelFont,g_labelActualSize,V,"center","");W.add(U),U.position.y=-.005;var Z=U.material.map.image.width/U.material.map.image.height*g_labelActualSize/2;U.position.x=0-N.W/2+Z+.01}else{U=addlabelText(N.Shelf,g_labelFont,g_labelActualSize,V,"center","");W.add(U);Z=U.material.map.image.width/U.material.map.image.height*g_labelActualSize/2;U.position.x=0-N.W/2+Z+.01,U.position.y=0}0!==N.Rotation||0!==N.Slope?U.position.z=N.D/2+.005:U.position.z=.001,N.LObjID=U.id}}else if("Y"==I){V="#ffffff",U=addlabelText(g_pog_json[M].ModuleInfo[_].Carpark[H].Shelf,12,g_labelActualSize,V,"center","");W.add(U),U.position.x=0-(g_pog_json[M].ModuleInfo[_].Carpark[H].W/3+.01),U.position.y=0,U.position.z=.005}if("CHEST"==w&&"Y"==g_chest_as_pegboard&&add_chest_dots_array(t,n,0,.01,0,.01,H,_,M),"N"==I)update_single_notch_label("Y",_,H,S,W,M,I);if(W.NotchNo=B.NotchNo,"Y"==c&&reorder_items(_,H,M))await recreate_all_items(_,H,N.ObjType,"Y",-1,-1,N.ItemInfo.length,"Y","N",-1,-1,h,"",M,D,b,v,x,O,C,j,"Y");return void 0!==g_pog_json&&"EDIT_PALLET"==g_compare_view&&(g_pog_json[M].ModuleInfo[0].ShelfInfo[0].PrimeShelfObjID=W.id),logDebug("function : add_shelf","E"),[A,H]}catch(e){error_handling(e)}}function get_notch_no(e,o,t){var n=0;for(k=0;k<100;k++){if(t<g_pog_json[o].BaseH+e.NotchStart/2&&e.NotchStart>0){n=0;break}if(t<=g_pog_json[o].BaseH+e.NotchStart&&e.NotchStart>0){n=1;break}if(t<=g_pog_json[o].BaseH&&0==e.NotchStart){n=0;break}if(wpdSetFixed(t)<wpdSetFixed(g_pog_json[o].BaseH+e.NotchStart+e.NotchSpacing*k)){n=k;break}}return n}async function update_single_notch_label(e,o,t,n,i,r,a){var l=g_pog_json[r].ModuleInfo[o].ShelfInfo[t],s=g_pog_json[r].ModuleInfo[o],d=g_notch_label_position.toUpperCase();if(g_pog_json[r].ModuleInfo[o].NotchW>0&&"BASE"!==l.ObjType&&"NOTCH"!==l.ObjType&&"DIVIDER"!==l.ObjType&&"TEXTBOX"!==l.ObjType){if(""==i)try{i=g_scene_objects[r].scene.children[2].getObjectById(g_pog_json[r].ModuleInfo[o].ShelfInfo[t].SObjID)}catch{return"FAIL"}var _=get_notch_no(s,r,l.Y+l.H/2);if(l.NotchNo=_,i.NotchNo=_,"N"==a&&"Y"==g_show_notch_label)if("Y"==e){if(void 0!==l.NotchLabelObjID&&-1!==l.NotchLabelObjID){var g=i.getObjectById(l.NotchLabelObjID);i.remove(g)}var f,p=l.Color;if(null==hexToRgb(p))var c=parseInt("FF",16),I=parseInt("FF",16),m=parseInt("FF",16);else c=hexToRgb(p).r,I=hexToRgb(p).r,m=hexToRgb(p).g;f="CENTER"==d?getTextColor(c,I,m):"#000000";var h=addlabelText(n+" "+_,g_labelFont,g_labelActualSize,f,"center","");i.add(h),0!==l.Rotation||0!==l.Slope?h.position.z=l.D/2+.005:h.position.z=.005,[posX,posY]=getLabelPosition(l,"S",d),h.position.x=posX,h.position.y=posY,g_pog_json[r].ModuleInfo[o].ShelfInfo[t].NotchLabelObjID=h.id}else if(void 0!==l.NotchLabelObjID&&-1!==l.NotchLabelObjID){g=i.getObjectById(l.NotchLabelObjID);i.remove(g)}}return"SUCCESS"}function add_rod(e,o,t,n,i,r,a,l,s,d,_,g,f){logDebug("function : add_rod; uuid : "+e+"; type : "+o+"; width : "+t+"; height : "+n+"; depth : "+i+"; color : "+r+"; x : "+a+"; y : "+l+"; z : "+s+"; p_edit_ind : "+d+"; mod_index : "+_+"; shelf_ind : "+g,"S");try{var p;i=.001;var c=[],I=[];if(void 0!==g_module_width&&""!=g_module_width||(g_module_width=parseFloat(g_pog_json[f].ModuleInfo[_].W)),"Y"==d){var m=g_world.getObjectById(g_dblclick_objid);g_world.remove(m),p=g_shelf_index}else p=-1!==g?g:parseFloat(g_pog_json[f].ModuleInfo[_].ShelfInfo.length)-1;var h=g_pog_json[f].ModuleInfo[_].ShelfInfo[p],u=h.SObjID,S=new THREE.Mesh(new THREE.BoxGeometry(t,n,i),new THREE.MeshStandardMaterial({color:r}));c.push(0-t/2),c.push(t/2),c.push(0-t/2),c.push(t/2),I.push(0-n/2),I.push(n/2),I.push(n/2),I.push(0-n/2);var D=[];D.push(new THREE.Vector3(c[0],I[0],0)),D.push(new THREE.Vector3(c[1],I[1],0)),D.push(new THREE.Vector3(c[2],I[2],0)),D.push(new THREE.Vector3(c[3],I[3],0));let o=(new THREE.BufferGeometry).setFromPoints(D);var b=new THREE.LineBasicMaterial({color:14293787}),v=new THREE.LineSegments(o,b),x=new THREE.LineSegments(o,b);v.position.z=.001,x.position.z=.001,S.add(v),S.add(x);var O=add_wireframe(S,2);S.WFrameID=O,S.position.x=a,S.position.y=l,S.position.z=.008,S.uuid=e;var C=h;if(S.POGCode=g_pog_json[f].POGCode,S.Version=g_pog_json[f].Version,S.X=wpdSetFixed(100*C.X-100*C.W/2),"Y"==C.EditNotch?S.Y=wpdSetFixed(100*C.EditNotchY):S.Y=wpdSetFixed(100*C.Y-100*C.H/2),S.Z=wpdSetFixed(100*C.Z-100*C.D/2),S.AvlSpace=C.AvlSpace,S.FixelID=C.Shelf,S.Desc=C.Desc,S.Module=g_pog_json[f].ModuleInfo[_].Module,S.W=C.W,S.H=C.H,S.D=C.D,S.Color=C.Color,S.Rotation=0,S.ItemSlope=0,S.Rotation="N",S.ImageExists="N",S.BorderColour=0,g_world.add(S),h.LineVerticesX=c,h.LineVerticesY=I,h.SObjID=parseInt(S.id),h.WFrameID=O,"Y"==g_show_fixel_label&&"BASE"!==u&&"NOTCH"!==u){var j=h.Color;if(null==hexToRgb(j))var M=parseInt("FF",16),y=parseInt("FF",16),H=parseInt("FF",16);else M=hexToRgb(j).r,y=hexToRgb(j).r,H=hexToRgb(j).g;var w=getTextColor(M,y,H),T=addlabelText(h.Shelf,g_labelFont,g_labelActualSize,w,"center","");S.add(T),T.position.x=0-(h.W/2.4+.01),T.position.y=0,T.position.z=.005,h.LObjID=T.id}return logDebug("function : add_rod","E"),parseInt(S.id)}catch(e){error_handling(e)}}function wrapText(e,o,t,n,i,r){logDebug("function : wrapText; text : "+o+"; x : "+t+"; y : "+n+"; maxWidth : "+i+"; lineHeight : "+r,"S");try{var a,l,s=o.split(" "),d="",_=0;for(_=0;_<s.length;_++){for(a=s[_],l=e.measureText(a);l.width>i;)a=a.substring(0,a.length-1),l=e.measureText(a);s[_]!=a&&""!==a&&(s.splice(_+1,0,s[_].substr(a.length)),s[_]=a),a=d+s[_]+" ",(l=e.measureText(a)).width>i&&_>0?(e.fillText(d,t,n),d=s[_]+" ",n+=r):d=a}e.fillText(d,t,n),logDebug("function : wrapText","E")}catch(e){logDebug("function : wrapText","E"),error_handling(e)}}function dcText(e,o,t,n,r,a,l,s,d,_,g,f,p,c,I,m,h){try{if(logDebug("function : dcText; txt : "+e,"S"),-1!==p){var u=g_pog_json[I].ModuleInfo[f].ShelfInfo[p];if(("TEXTBOX"!==u.ObjType||"TEXTBOX"==u.ObjType&&"Y"==m&&"Y"==s)&&(m="N"),void 0!==u.canvasW)if(null!==u.canvasW&&"N"==m)var S=u.canvasW*c,D=u.canvasH*c;else if(g_initial_camera){var[S,D]=get_visible_size(.012,r*c,a*c,g_canvas,g_initial_camera);null==u.canvasW&&(u.canvasW=S/c,u.canvasH=D/c)}else{var[S,D]=get_visible_size(.012,r*c,a*c,g_canvas,g_camera);null==u.canvasW&&(u.canvasW=S/c,u.canvasH=D/c)}else{var[S,D]=get_visible_size(.012,r*c,a*c,g_canvas,g_camera);u.canvasW=S/c,u.canvasH=D/c}}else var[S,D]=get_visible_size(.012,r*c,a*c,g_canvas,g_camera);(!o||""===o&&"V"==h)&&(o=12);var b=document.createElement("DIV");b.style.fontFamily=d,b.style.fontWeight="bold"==_?"bold":"normal",b.style.fontSize=parseInt(o)*c+"pt",b.style.position="absolute",b.style.top="-500px",b.style.left="0",b.innerHTML=e,document.body.appendChild(b);let g={width:b.offsetWidth,height:b.offsetHeight},N=window.getComputedStyle(b,null),E=parseFloat(N.fontSize);document.body.removeChild(b);b.offsetWidth;var v=parseInt(o)*c,x=document.createElement("canvas"),O=x.getContext("2d");if(x.width=S,x.height=D,null==n&&null===n||(O.fillStyle="#"+n.toString(16).padStart(6,"0"),O.fillRect(0,0,S,D)),O.textAlign="center",O.textBaseline="middle",O.fillStyle="#"+t.toString(16).padStart(6,"0"),O.font=_+" "+E+"px "+d,u&&"TEXTBOX"===u.ObjType&&"V"==h){const t=e.split("");let n=parseInt(o)*c,i=1.2*n,r=t.length*i,a=1;"Y"===l&&r>D&&(a=2);let g=Math.ceil(t.length/a);if("Y"===s)for(;g*i>D&&n>6;)n--,i=1.2*n,r=t.length*i,g=Math.ceil(t.length/a);O.font=_+" "+n+"px "+d;let f=(D-i*g)/2+i/2,p=S/2,I=n;for(let e=0;e<a;e++){let o=2===a?p+(0===e?-I/2:I/2):p;for(let n=0;n<g;n++){let r=n+e*g;if(r>=t.length)break;let a=f+n*i;O.fillText(t[r],o,a)}}}else{var C=O.measureText(e);lineGap=g.height-(C.fontBoundingBoxAscent+C.fontBoundingBoxDescent);let o={width:C.width,cssHeight:g.height,cssFontSizePx:E,fontAscent:C.fontBoundingBoxAscent,fontDescent:C.fontBoundingBoxDescent,actualAscent:C.actualBoundingBoxAscent,actualDescent:C.actualBoundingBoxDescent,lineHeight:g.height,lineGap:lineGap,lineGapTop:lineGap/2,lineGapBottom:lineGap/2};C=O.measureText(e).width;if("Y"==s&&C>S&&"N"==l){var j=50;for(i=50;i>=0;i--){var M=document.createElement("canvas"),y=M.getContext("2d");if(M.width=S,M.height=D,null==n&&null===n||(y.fillStyle="#"+n.toString(16).padStart(6,"0"),y.fillRect(0,0,S,D)),y.textAlign="center",y.textBaseline="middle",y.fillStyle="#"+t.toString(16).padStart(6,"0"),y.font=_+" "+i+"px "+d,y.measureText(e).width+5<=S){j=i;break}}v=j<50?j:v}null==n&&null===n||(O.fillStyle="#"+n.toString(16).padStart(6,"0"),O.fillRect(0,0,S,D)),O.textAlign="center",O.textBaseline="middle",O.fillStyle="#"+t.toString(16).padStart(6,"0"),O.font=(_?_+" ":"")+" "+v+"px "+d;var H=o.lineHeight-o.lineGap;"Y"==l&&C>S?wrapText(O,e,S/2,v,S,H):O.fillText(e,S/2,D/2)}var w=new THREE.CanvasTexture(x);w.minFilter=THREE.LinearFilter,geometry=new THREE.PlaneGeometry(r,a);var T=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:w,transparent:!0,opacity:1}),F=new THREE.Mesh(geometry,T);return logDebug("function : dcText","E"),F}catch(e){error_handling(e)}}function add_pegboard(e,o,t,n,i,r,a,l,s,d,_,g,f,p,c,I,m,h,u,S,D,b,v,x,O,C){logDebug("function : add_pegboard; uuid : "+e+"; width : "+o+"; height : "+t+"; depth : "+n+"; color : "+i+"; x : "+r+"; y : "+a+"; z : "+l+"; p_edit_ind : "+s+"; vert_start : "+d+"; vert_spacing : "+_+"; horz_start : "+g+"; horz_spacing : "+f+"; mod_index : "+p+"; shelf_ind : "+c+"; rotation : "+I+"; slope : "+m+"; recreate : "+h,"S");try{var j=0;if("Y"==s){var M=g_world.getObjectById(g_dblclick_objid);g_world.remove(M),j=g_shelf_index}else j=-1!==c?c:parseFloat(g_pog_json[C].ModuleInfo[p].ShelfInfo.length)-1;var y=g_pog_json[C].ModuleInfo[p].ShelfInfo[j];y.SObjID;if(0!==I||0!==m){g_rotation=I,g_slope=m=m>0?0-m:-m;var H=add_dots_to_object(o,t,7e-4,d,_,g,f,new THREE.Mesh(new THREE.BoxGeometry(o,t,.01),new THREE.MeshStandardMaterial({color:i})),"PEGBOARD",j,p,g_peg_holes_active,"N",C),w=0,T=0;if("Y"==h&&"N"==s){for(const e of g_pog_json[C].ModuleInfo)null==e.ParentModule&&(w=Math.max(w,parseFloat(e.X)+e.W/2)),T++;r=w+o/2,a=g_pog_json[C].CameraY}H.position.x=g_pog_json[C].CameraX,H.position.y=a,H.position.z=.00115,H.uuid=e;var F=y;H.POGCode=g_pog_json[C].POGCode,H.Version=g_pog_json[C].Version,H.FixelID=F.Shelf,H.Module=g_pog_json[C].ModuleInfo[p].Module,H.W=F.W,H.H=F.H,H.D=F.D,H.X=wpdSetFixed(100*F.X-100*F.W/2),"Y"==F.EditNotch?H.Y=wpdSetFixed(100*F.EditNotchY):H.Y=wpdSetFixed(100*F.Y-100*F.H/2),H.Z=wpdSetFixed(100*F.Z-100*F.D/2),H.Color=F.Color,H.Rotation=I,H.ItemSlope=m,H.Rotation=0!==I||0!==m?"Y":"N",H.ImageExists="N",H.rotateY(I*Math.PI/180),H.rotateX(m*Math.PI/180);var N=add_wireframe(H,2);H.WFrameID=N,g_world.add(H),H.geometry.computeBoundingBox();H.geometry.boundingBox;var E=(new THREE.Box3).setFromObject(H).getSize(new THREE.Vector3);if(y.WFrameID=N,y.ShelfRotateWidth=parseFloat(E.x),y.ShelfRotateHeight=parseFloat(E.y),y.ShelfRotateDepth=parseFloat(E.z),"N"==g_manual_zoom_ind){var B=get_min_max_xy(C).split("###");set_camera_z(g_camera,parseFloat(B[2]),parseFloat(B[3]),parseFloat(B[0]),parseFloat(B[1]),g_offset_z,parseFloat(B[4]),parseFloat(B[5]),!0,C)}"Y"==h&&"N"==s&&(r=w+o/2,a=g_pog_json[C].CameraY),H.position.x=r,H.position.y=m<0?a+parseFloat(E.y)/2:a-parseFloat(E.y)/2,H.position.z=.00115,0!==I&&(H.quaternion.copy(g_camera.quaternion),H.lookAt(g_pog_json[C].CameraX,g_pog_json[C].CameraY,g_pog_json[C].CameraZ)),H.rotateY(I*Math.PI/180),H.rotateX(m*Math.PI/180),H.updateMatrix()}else{(H=add_dots_to_object(o,t,7e-4,d,_,g,f,new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshStandardMaterial({color:i})),"PEGBOARD",j,p,g_peg_holes_active,"N",C)).position.x=r,H.position.y=a,H.position.z=.00115,H.uuid=e,H.POGCode=g_pog_json[C].POGCode,H.Version=g_pog_json[C].Version;F=y;H.FixelID=F.Shelf,H.Module=g_pog_json[C].ModuleInfo[p].Module,H.W=F.W,H.H=F.H,H.D=F.D,H.X=wpdSetFixed(100*F.X-100*F.W/2),"Y"==F.EditNotch?H.Y=wpdSetFixed(100*F.EditNotchY):H.Y=wpdSetFixed(100*F.Y-100*F.H/2),H.Z=wpdSetFixed(100*F.Z-100*F.D/2),H.Color=F.Color,H.Rotation=I,H.ItemSlope=m,H.Rotation=0!==I||0!==m?"Y":"N",H.ImageExists="N";N=add_wireframe(H,2);H.WFrameID=N,g_world.add(H)}if(y.SObjID=parseInt(H.id),H.BorderColour=0,"Y"==h&&y.ItemInfo.length>0){var W=y.ItemInfo;T=0;for(const e of W)y.ItemInfo[T].Exists="E",T++;return_val=recreate_all_items(p,j,y.ObjType,"Y",-1,-1,y.ItemInfo.length,"N","N",C,[],g_start_canvas,"",C,u,S,D,b,v,x,O,"Y")}if("Y"==g_show_fixel_label){var R=y.Color;if(null==hexToRgb(R))var P=parseInt("FF",16),Y=parseInt("FF",16),A=parseInt("FF",16);else P=hexToRgb(R).r,Y=hexToRgb(R).r,A=hexToRgb(R).g;var k=getTextColor(P,Y,A),z=addlabelText(y.Shelf,g_labelFont,g_labelActualSize,k,"center","");H.add(z);var X=z.material.map.image.width/z.material.map.image.height*g_labelActualSize/2;z.position.x=0-y.W/2+X+.01,z.position.y=0,0!==y.Rotation||0!==y.Slope?z.position.z=y.D/2+.005:z.position.z=.005,y.LObjID=z.id}return y.WFrameID=N,g_dblclick_opened="N",logDebug("function : add_pegboard","E"),parseInt(H.id)}catch(e){logDebug("function : add_pegboard","E"),error_handling(e)}}function add_text_box_with_image(e,o,t,n,i,r,a,l,s,d,_,g,f,p,c,I,m,h,u,S,D,b,v,x,O){logDebug("function : add_text_box_with_image; uuid : "+e+"; type : "+o+"; width : "+t+"; height : "+n+"; depth : "+i+"; color : "+r+"; x : "+a+"; y : "+l+"; z : "+s+"; p_edit_ind : "+d+"; mod_index : "+_+"; input_text : "+g+"; color_hex : "+f+"; wrap_text : "+p+"; reducetofit : "+c+"; hex_color : "+I+"; shelf_ind : "+m+"; rotation : "+h+"; slope : "+u+"; recreate : "+S+"; fontstyle : "+D+"; fontsize : "+b+"; fontbold : "+v,"S");try{return new Promise((function(o,r){var g=-1;if("Y"==d){var f=g_world.getObjectById(g_pog_json[O].ModuleInfo[_].ShelfInfo[m].SObjID);g_world.remove(f),g=m}else g=-1!==m?m:parseFloat(g_pog_json[O].ModuleInfo[_].ShelfInfo.length)-1;var p=g_pog_json[O].ModuleInfo[_].ShelfInfo[g],c=new Image,I=new THREE.Texture(c);c.onload=()=>{I.needsUpdate=!0},c.src="data:image/png;base64,"+p.TextImg,geometry=new THREE.PlaneGeometry(t,n);var S=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:I,transparent:!0,opacity:1}),D=new THREE.Mesh(geometry,S);if(0!==h||0!==u){g_rotation=h,g_slope=u=u>0?0-u:-u,D.position.x=g_pog_json[O].CameraX,D.position.y=l,D.position.z=i/2+g_pog_json[O].BackDepth;var b=p;D.FixelID=b.Shelf,D.POGCode=g_pog_json[O].POGCode,D.Version=g_pog_json[O].Version,D.X=wpdSetFixed(100*b.X-100*b.W/2),"Y"==b.EditNotch?D.Y=wpdSetFixed(100*b.EditNotchY):D.Y=wpdSetFixed(100*b.Y-100*b.H/2),D.Z=wpdSetFixed(100*b.Z),D.Module=g_pog_json[O].ModuleInfo[_].Module,D.W=b.W,D.H=b.H,D.D=b.D,D.Color=b.Color,D.Rotation=h,D.ItemSlope=u,D.Rotation=0!==h||0!==u?"Y":"N",D.ImageExists="Y",D.rotateY(h*Math.PI/180),0==h?D.rotateX(u/2*Math.PI/180):D.rotateX(u*Math.PI/180),g_world.add(D),D.geometry.computeBoundingBox();D.geometry.boundingBox;var v=(new THREE.Box3).setFromObject(D).getSize(new THREE.Vector3);if(p.ShelfRotateWidth=parseFloat(v.x),p.ShelfRotateHeight=parseFloat(v.y),p.ShelfRotateDepth=parseFloat(v.z),"N"==g_manual_zoom_ind){var C=get_min_max_xy(O).split("###");set_camera_z(g_camera,parseFloat(C[2]),parseFloat(C[3]),parseFloat(C[0]),parseFloat(C[1]),g_offset_z,parseFloat(C[4]),parseFloat(C[5]),!0,O)}D.position.x=a,D.position.y=l,D.position.z=i/2+g_pog_json[O].BackDepth,0!==h&&(D.quaternion.copy(g_camera.quaternion),D.lookAt(g_pog_json[O].CameraX,g_pog_json[O].CameraY,g_pog_json[O].CameraZ)),D.rotateY(h*Math.PI/180),0==h?D.rotateX(u/2*Math.PI/180):D.rotateX(u*Math.PI/180),D.updateMatrix()}else D.position.x=a,D.position.y=l,s==g_pog_json[O].BackDepth?D.position.z=.001:D.position.z=s>.0021?.0021:0==s?6e-4:s;D.uuid=e,D.FixelID=p.Shelf,D.Module=g_pog_json[O].ModuleInfo[_].Module,D.POGCode=g_pog_json[O].POGCode,D.Version=g_pog_json[O].Version,D.X=wpdSetFixed(100*p.X-100*p.W/2),"Y"==p.EditNotch?D.Y=wpdSetFixed(100*p.EditNotchY):D.Y=wpdSetFixed(100*p.Y-100*p.H/2),D.Z=wpdSetFixed(100*p.Z);var j=add_wireframe(D,1);if(g_world.add(D),p.WFrameID=j,D.BorderColour=0,"Y"==g_show_fixel_label){var M=p.Color;if(null==hexToRgb(M))var y=parseInt("FF",16),H=parseInt("FF",16),w=parseInt("FF",16);else y=hexToRgb(M).r,H=hexToRgb(M).r,w=hexToRgb(M).g;var T=getTextColor(y,H,w),F=addlabelText(p.Shelf,10,.018,T,"center","");D.add(F),F.position.x=0-(p.W/2.4+.01),F.position.y=0,F.position.z=.005,p.LObjID=F.id}"Y"==g_show_notch_label&&show_notch_labels("Y",x,"N",O),p.SObjID=parseInt(D.id),o(D.id),logDebug("function : add_text_box_with_image","E")}))}catch(e){error_handling(e)}}function get_textbox_z(e,o,t,n,i,r,a){logDebug("function : get_textbox_z; p_module_index : "+e+"; p_shelf_index : "+o+"; x : "+t+"; y : "+n+"; width : "+i+"; height : "+r,"S");var l=t-i/2,s=t+i/2,d=n+r/2,_=n-r/2,g=g_pog_json[a].ModuleInfo,f="N",p=0;for(const e of g){if("Y"==f)break;if(void 0===e.ParentModule||null==e.ParentModule){var c=e.ShelfInfo;for(const e of c){if("Y"==f)break;if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType)if(e.ItemInfo.length>0){var I=e.ItemInfo;for(const o of I){var m=o.X-o.W/2,h=o.X+o.W/2,u=o.Y+o.H/2,S=o.Y-o.H/2;if(l>=m&&l<h&&(d>S&&d<=u||_>=S&&_<u)||s>m&&s<=h&&(d>S&&d<=u||_>=S&&_<u)||l<m&&s>h&&(d>S&&d<=u||_>=S&&_<u)){f="Y",p=g_pog_json[a].BackDepth/2+e.D+.005;break}if(l>=m&&l&&d>u&&_<S||s>m&&s<=h&&d>u&&_<S){f="Y",p=g_pog_json[a].BackDepth/2+e.D+.005;break}1}}else{m=e.X-e.W/2,h=e.X+e.W/2,u=e.Y+e.H/2,S=e.Y-e.H/2;if(l>=m&&l<h&&(d>S&&d<=u||_>=S&&_<u)||s>m&&s<=h&&(d>S&&d<=u||_>=S&&_<u)||l<m&&s>h&&(d>S&&d<=u||_>=S&&_<u)){f="Y",p=g_pog_json[a].BackDepth/2+e.D+.005;break}if(l>=m&&l&&d>u&&_<S||s>m&&s<=h&&d>u&&_<S){f="Y",p=g_pog_json[a].BackDepth/2+e.D+.005;break}}1}}1}if("N"==f)if(g_pog_json&&g_pog_json[a]&&g_pog_json[a].ModuleInfo&&g_pog_json[a].ModuleInfo[e]&&g_pog_json[a].ModuleInfo[e].ShelfInfo&&void 0!==g_pog_json[a].ModuleInfo[e].ShelfInfo[o]){var D=g_pog_json[a].ModuleInfo[e].ShelfInfo[o];p=D.Y-D.H/2<=0?g_pog_json[a].BackDepth/2+.005+g_pog_json[a].BaseD:g_pog_json[a].BackDepth/2+.005}else p=g_pog_json&&g_pog_json[a]?g_pog_json[a].BackDepth/2+.005:.005;return logDebug("function : get_textbox_z","E"),wpdSetFixed(p)}function add_text_box(e,o,t,n,i,r,a,l,s,d,_,g,f,p,c,I,m,h,u,S,D,b,v,x,O,C="N",j="H"){logDebug("function : add_text_box; uuid : "+e+"; type : "+o+"; width : "+t+"; height : "+n+"; depth : "+i+"; color : "+r+"; x : "+a+"; y : "+l+"; z : "+s+"; p_edit_ind : "+d+"; mod_index : "+_+"; input_text : "+g+"; color_hex : "+f+"; wrap_text : "+p+"; reducetofit : "+c+"; hex_color : "+I+"; shelf_ind : "+m+"; rotation : "+h+"; slope : "+u+"; recreate : "+S+"; fontstyle : "+D+"; fontsize : "+b+"; fontbold : "+v,"S");try{if(null==hexToRgb(I))var M=parseInt("FF",16),y=parseInt("FF",16),H=parseInt("FF",16);else M=hexToRgb(I).r,y=hexToRgb(I).r,H=hexToRgb(I).g;if("Y"==d){var w=g_world.getObjectById(g_pog_json[O].ModuleInfo[_].ShelfInfo[m].SObjID);g_world.remove(w),shelf_cnt=m}else shelf_cnt=-1!==m?m:parseFloat(g_pog_json[O].ModuleInfo[_].ShelfInfo.length)-1;var T=g_pog_json[O].ModuleInfo[_].ShelfInfo[shelf_cnt],F=getTextColor(M,y,H);if(F="#000000"==F?0:16777215,mesh=dcText(g,b,F,f,t,n,p,c,D,v,b,_,shelf_cnt,x,O,C,j),0!==h||0!==u){g_rotation=h,g_slope=u=u>0?0-u:-u;var N=add_wireframe(mesh,1),E=0;if("Y"==S&&"N"==d){for(const e of g_pog_json[O].ModuleInfo)null==e.ParentModule&&(E=Math.max(E,parseFloat(e.X)+e.W/2));a=E+t/2,l=g_pog_json[O].CameraY}mesh.position.x=g_pog_json[O].CameraX,mesh.position.y=l,mesh.position.z=i/2+g_pog_json[O].BackDepth,mesh.uuid=e;var B=T;mesh.FixelID=B.Shelf,mesh.POGCode=g_pog_json[O].POGCode,mesh.Version=g_pog_json[O].Version,mesh.X=wpdSetFixed(100*B.X-100*B.W/2),"Y"==B.EditNotch?mesh.Y=wpdSetFixed(100*B.EditNotchY):mesh.Y=wpdSetFixed(100*B.Y-100*B.H/2),mesh.Z=wpdSetFixed(100*B.Z),mesh.NotchNo=B.NotchNo,mesh.Desc=B.Desc,mesh.Module=g_pog_json[O].ModuleInfo[_].Module,mesh.W=B.W,mesh.H=B.H,mesh.D=B.D,mesh.Color=B.Color,mesh.Rotation=h,mesh.ItemSlope=u,mesh.Rotation=0!==h||0!==u?"Y":"N",mesh.ImageExists="N",mesh.rotateY(h*Math.PI/180),0==h?mesh.rotateX(u/2*Math.PI/180):mesh.rotateX(u*Math.PI/180),g_world.add(mesh),mesh.geometry.computeBoundingBox();mesh.geometry.boundingBox;var W=(new THREE.Box3).setFromObject(mesh).getSize(new THREE.Vector3);if(T.WFrameID=N,T.ShelfRotateWidth=parseFloat(W.x),T.ShelfRotateHeight=parseFloat(W.y),T.ShelfRotateDepth=parseFloat(W.z),"N"==g_manual_zoom_ind){var R=get_min_max_xy(O).split("###");set_camera_z(g_camera,parseFloat(R[2]),parseFloat(R[3]),parseFloat(R[0]),parseFloat(R[1]),g_offset_z,parseFloat(R[4]),parseFloat(R[5]),!0,O)}"Y"==S&&"N"==d&&(a=E+t/2,l=g_pog_json[O].CameraY),mesh.position.x=a,mesh.position.y=l,mesh.position.z=i/2+g_pog_json[O].BackDepth,0!==h&&(mesh.quaternion.copy(g_camera.quaternion),mesh.lookAt(g_pog_json[O].CameraX,g_pog_json[O].CameraY,g_pog_json[O].CameraZ)),mesh.rotateY(h*Math.PI/180),0==h?mesh.rotateX(u/2*Math.PI/180):mesh.rotateX(u*Math.PI/180),mesh.updateMatrix()}else{mesh.position.x=a,mesh.position.y=l,s==g_pog_json[O].BackDepth?mesh.position.z=.001:mesh.position.z=s>.0021?.0021:0==s?6e-4:s,mesh.FixelID=T.Shelf,mesh.Module=g_pog_json[O].ModuleInfo[_].Module,mesh.POGCode=g_pog_json[O].POGCode,mesh.Version=g_pog_json[O].Version,mesh.X=wpdSetFixed(100*T.X-100*T.W/2),"Y"==T.EditNotch?mesh.Y=wpdSetFixed(100*T.EditNotchY):mesh.Y=wpdSetFixed(100*T.Y-100*T.H/2),mesh.Z=wpdSetFixed(100*T.Z),mesh.W=T.W,mesh.H=T.H,mesh.D=T.D,mesh.Color=T.Color,mesh.Rotation=h,mesh.ItemSlope=u,mesh.Rotation=0!==h||0!==u?"Y":"N",mesh.ImageExists="N",mesh.NotchNo=T.NotchNo,mesh.Desc=T.Desc;N=add_wireframe(mesh,1);g_world.add(mesh);let e=(new THREE.BufferGeometry).setFromPoints([]);var P=new THREE.LineBasicMaterial({color:0}),Y=new THREE.LineSegments(e,P);Y.position.z=6e-4,mesh.add(Y),T.WFrameID=N}return T.SObjID=parseInt(mesh.id),logDebug("function : add_text_box","E"),parseInt(mesh.id)}catch(e){error_handling(e)}}async function get_images(e,o,t,n,i,r,a){logDebug("function : get_images ; p_module_index : "+e+"; p_shelf_index : "+o,"S");try{var l=0;for(const _ of t){var s="N";if("Y"==_.ImgExists){var d=g_orientation_json[_.Orientation].split("###");for(const e of g_ItemImages){if(_.Item==e.Item&&d[0]==e.Orientation&&_.MerchStyle==e.MerchStyle){s="Y";break}0}if("N"==s){ItemImageInfo={},ItemImageInfo.Item=_.Item,ItemImageInfo.MIndex=e,ItemImageInfo.SIndex=o,ItemImageInfo.IIndex=l,ItemImageInfo.Orientation=d[0],ItemImageInfo.ItemImage=null,ItemImageInfo.MerchStyle=_.MerchStyle,g_ItemImages.push(ItemImageInfo);await call_ajax(e,o,n[l],d[0],g_ItemImages.length-1,_.Item,_.MerchStyle,i,r,a)}}l++}return logDebug("function : get_images","E"),"success"}catch(e){error_handling(e)}}function call_ajax(e,o,t,n,i,r,a,l,s,d){try{return logDebug("function : call_ajax ; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+t+"; item_type : "+n+"; img_index : "+i+"; item_code : "+r,"S"),new Promise((function(e,o){var t;"0"==a?t="U":"1"==a?t="T":"2"==a?t="C":"3"==a&&(t="D"),apex.server.process("ITEM_BASE64",{x01:r,x02:n,x03:t},{dataType:"html"}).done((function(o){if(""!==$.trim(o)){var t;!async function(o){var n=new Image;n.src="data:image/jpeg;base64,"+o,n.onload=function(){!async function(o){t=await resizeImage(o,l,s,d),compress_image=t.split(","),g_ItemImages[i].ItemImage=compress_image[1],logDebug("function : call_ajax","E"),e("success")}(n)}}($.trim(o))}else 0==i?g_ItemImages.splice(i,i+1):g_ItemImages.splice(i,1),logDebug("function : call_ajax","E"),e("success")}))}))}catch(e){error_handling(e)}}async function resizeImage(e,o,t,n){try{logDebug("function : resizeImage ; MaxWidth : "+o+"; MaxHeight : "+t,"S");var i=document.createElement("canvas"),r=e.width,a=e.height,l=o,s=t;return r>a?r>l&&(a=Math.round(a*=l/r),r=l):a>s&&(r=Math.round(r*=s/a),a=s),i.width=r,i.height=a,i.getContext("2d").drawImage(e,0,0,r,a),logDebug("function : resizeImage","E"),i.toDataURL("image/jpeg",n)}catch(e){error_handling(e)}}function base64toBlob(e,o){logDebug("function : base64toBlob ; contentType : "+o,"E"),o=o||"";for(var t=1024,n=atob(e),i=n.length,r=Math.ceil(i/t),a=new Array(r),l=0;l<r;++l){for(var s=l*t,d=Math.min(s+t,i),_=new Array(d-s),g=s,f=0;g<d;++f,++g)_[f]=n[g].charCodeAt(0);a[l]=new Uint8Array(_)}return logDebug("function : base64toBlob","E"),new Blob(a,{type:o})}function add_item_borders(e,o,t,n,r,a,l,s,d){try{if(logDebug("function : add_item_borders; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+t+"; width : "+r+"; height : "+a+"; item_horiz_facing : "+l,"S"),"Y"==d)var _=g_pog_json[s].ModuleInfo[e].ChestInfo[o];else _=g_pog_json[s].ModuleInfo[e].ShelfInfo[o];var g=_.ItemInfo[t];horiz_facing=-1!==l?l:g.BHoriz,vert_facing=g.BVert;var f=g.ItemNesting,p=g.NVal,c=g.CapStyle,I=g.CapCount,[m,h,u,S,D,b]=get_new_orientation_dim(g.Orientation,g.OW,g.OH,g.OD),v=(g.RH,_.Rotation,_.D,_.HorizGap),x=_.SpreadItem,O=[],C=[],j="N",M=0,y=0,H=0,w=0-parseFloat(r)/2,T=0-parseFloat(a)/2,F=0+parseFloat(r)/2,N=0+parseFloat(a)/2,E=[];if(0!==p&&(vert_facing>1||horiz_facing>1)&&0==v&&"F"!==x&&"D"!==f){if(p<0&&(p*=-1,j="Y"),"H"==f){for("N"==j?(y=T+h,O.push(y)):y=T,i=1;i<vert_facing&&(y+=parseFloat(p))<N;i++)O.push(y);for(i=0;i<O.length;i++)E.push(new THREE.Vector3(w,O[i],0)),E.push(new THREE.Vector3(F,O[i],0));if(horiz_facing>1){M=r/horiz_facing;var B=w;for(i=1;i<horiz_facing;i++)B+=parseFloat(M),C.push(B);for(i=0;i<C.length;i++)E.push(new THREE.Vector3(C[i],T,0)),E.push(new THREE.Vector3(C[i],N,0))}}else if("W"==f){for("N"==j?(y=w+m,C.push(y)):y=w,i=1;i<horiz_facing&&(y+=parseFloat(p))<F;i++)C.push(y);for(i=0;i<C.length;i++)E.push(new THREE.Vector3(C[i],T,0)),E.push(new THREE.Vector3(C[i],N,0));if(vert_facing>1){for(H=a/vert_facing,y=T,i=1;i<vert_facing&&(y+=parseFloat(H))<N;i++)O.push(y);for(i=0;i<O.length;i++)E.push(new THREE.Vector3(w,O[i],0)),E.push(new THREE.Vector3(F,O[i],0))}}}else if("0"!==c){if("1"==c){for(y=T,i=1;i<=vert_facing&&(y+=parseFloat(h))<N;i++)O.push(y);for(i=1;i<I&&(y+=parseFloat(g.CapHeight))<N;i++)O.push(y);for(i=0;i<O.length;i++)E.push(new THREE.Vector3(w,O[i],0)),E.push(new THREE.Vector3(F,O[i],0))}else if("2"==c){for(y=T,i=1;i<=vert_facing;i++)y+=h,O.push(y);for(i=1;i<I&&(y+=parseFloat(g.CapHeight))<N;i++)O.push(y);for(i=0;i<O.length;i++)E.push(new THREE.Vector3(w,O[i],0)),E.push(new THREE.Vector3(F,O[i],0))}else if("3"==c){for(y=T+h,O.push(y),i=1;i<I&&(y+=parseFloat(g.CapHeight))<N;i++)O.push(y);for(i=0;i<O.length;i++)E.push(new THREE.Vector3(w,O[i],0)),E.push(new THREE.Vector3(F,O[i],0))}if(horiz_facing>1){M=r/horiz_facing;B=w;for(i=1;i<horiz_facing&&(B+=parseFloat(M))<N;i++)C.push(B);for(i=0;i<C.length;i++)E.push(new THREE.Vector3(C[i],T,0)),E.push(new THREE.Vector3(C[i],N,0))}}else{if(vert_facing>1){for(H=a/vert_facing,y=T,i=1;i<vert_facing;i++)y+=parseFloat(H),O.push(y);for(i=0;i<O.length;i++)E.push(new THREE.Vector3(w,O[i],0)),E.push(new THREE.Vector3(F,O[i],0))}if(horiz_facing>1){M=r/horiz_facing;B=w;for(i=1;i<horiz_facing;i++)B+=parseFloat(M),C.push(B);for(i=0;i<C.length;i++)E.push(new THREE.Vector3(C[i],T,0)),E.push(new THREE.Vector3(C[i],N,0))}}let P=(new THREE.BufferGeometry).setFromPoints(E);var W=new THREE.LineBasicMaterial({color:0}),R=new THREE.LineSegments(P,W);R.position.z=6e-4,n.add(R),logDebug("function : add_item_borders","E")}catch(e){error_handling(e)}}async function add_items_with_image(e,o,t,n,i,r,a,l,s,d,_,g,f,c,I,m,h,u,S,D,b,v,x,O,C){logDebug("function : add_items_with_image; uuid : "+e+"; width : "+o+"; height : "+t+"; depth : "+n+"; color : "+i+"; x : "+r+"; y : "+a+"; z : "+l+"; p_module_index : "+s+"; p_shelf_index : "+d+"; i_item_index : "+_+"; horiz_facing : "+g+"; vert_facing : "+f+"; item_code : "+c+"; item_type : "+I+"; angle : "+m+"; recreate : "+h,"S");try{var j=g_pog_json[C].ModuleInfo[s].ShelfInfo[d],M=g_pog_json[C].ModuleInfo[s].ShelfInfo[d].ItemInfo[_].D;"SHELF"!=g_pog_json[C].ModuleInfo[s].ShelfInfo[d].ObjType&&"HANGINGBAR"!=g_pog_json[C].ModuleInfo[s].ShelfInfo[d].ObjType||(j.AvlSpace=wpdSetFixed(j.AvlSpace-o)),"ROD"==g_pog_json[C].ModuleInfo[s].ShelfInfo[d].ObjType&&(j.AvlSpace=wpdSetFixed(j.D-M));var y=j.SpreadItem,[H,w]=getCombinationShelf(C,j.Shelf);-1!==H&&(y=g_combinedShelfs[H].SpreadItem),f=parseInt(f);var T=j.ItemInfo[_],F=T.CapMerch,N=T.CapOrientaion,E=[],B=g_orientation_json[N];if(void 0!==B){E=B.split("###");var W=g_world.getObjectById(T.ObjID);g_world.remove(W)}var R=T.Orientation,P=g_orientation_json[R],Y=T.CapStyle,A=T.BHoriz;T.CrushHoriz>0&&A>1&&"F"==y&&"0"==T.Orientation&&(o=T.RW*(1-T.CrushHoriz/100)+T.SpreadItem*(A-1));var[k,z,X,L,V,G]=get_new_orientation_dim(T.Orientation,T.OW,T.OH,T.OD,k,z,X,T.Item);T.CrushHoriz>0&&"0"==T.Orientation&&(k=T.W/T.BHoriz),T.CrushVert>0&&"0"==T.Orientation&&(z=T.H/T.BVert),"0"!==T.Orientation&&("H"==V&&T.CrushVert>0&&(k=T.W/T.BHoriz),"W"==L&&T.CrushHoriz>0&&(z=T.H/T.BVert));var U=P.split("###"),Z=T.PegID;return new Promise((function(I,u){var S=(ge=j.ItemInfo[_]).NVal,b=j.Rotation,M=j.Slope;ge.MerchStyle;var H="N",w=-1,T=-1;if("DB"==D){var N=0;for(const e of g_ItemImages){if(c==e.Item&&U[0]==e.Orientation&&null!==e.ItemImage&&e.MerchStyle==ge.MerchStyle){H="Y",T=N;break}N++}N=0;for(const e of g_ItemImages){if(c==e.Item&&E[0]==e.Orientation&&null!==e.ItemImage&&e.MerchStyle==F){w=N;break}N++}}else H="Y";if("Y"==H){if("DB"==D){var B=new Image,W=new THREE.Texture(B);if(W.format=THREE.RGBAFormat,B.onload=()=>{W.needsUpdate=!0},B.src="data:image/jpeg;base64,"+g_ItemImages[T].ItemImage,-1!==w){var R=new Image,P=new THREE.Texture(R);P.format=THREE.RGBAFormat,R.onload=()=>{P.needsUpdate=!0},R.src="data:image/jpeg;base64,"+g_ItemImages[w].ItemImage;var A=new THREE.MeshStandardMaterial({map:P})}}else console.log("Wrong Parameter value for pogcrLoadImgFrom",D);if(0!==b||0!==M){var X=new THREE.BoxBufferGeometry(o,t,n),L=new THREE.MeshBasicMaterial({map:W,transparent:!0});0==S&&(W.wrapS=THREE.RepeatWrapping,W.wrapT=THREE.RepeatWrapping,90==m||270==m?W.repeat.set(f,g):W.repeat.set(g,f),90==m?m=270:270==m&&(m=90),W.rotation=m*Math.PI/180);var V=new THREE.Mesh(X,L),G=g_world.getObjectById(j.SObjID);"N"==h&&(r=wpdSetFixed(0-(j.W/2-o/2-ge.Distance)),a=wpdSetFixed(j.H/2+t/2),l=wpdSetFixed(j.D/2-n/2),ge.RotationX=r,ge.RotationY=a,ge.RotationZ=l),V.applyMatrix4((new THREE.Matrix4).makeTranslation(r,a,l)),g_scene.updateMatrixWorld(),V.matrixAutoUpdate=!1,void 0!==G&&V.applyMatrix4(G.matrix)}else{X=new THREE.BoxGeometry(o,t,.001),L=new THREE.MeshStandardMaterial({map:W});if("F"==y){var $=parseInt(i.replace("#","0x"),16),J=new THREE.Color($);V=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshBasicMaterial({color:J,transparent:!0,opacity:0}));0==S&&"0"==Y&&(90==m||270==m?W.repeat.set(f,1):W.repeat.set(1,f)),W.wrapS=THREE.RepeatWrapping,W.wrapT=THREE.RepeatWrapping,90==m?m=270:270==m&&(m=90),W.rotation=m*Math.PI/180;var Q=[],q=0,K=(ge=ge).SpreadItem;if("0"==Y)for(pe=0;pe<g;pe++){if(f>1)var ee=new THREE.BoxGeometry(k,t,.001);else ee=new THREE.BoxGeometry(k,z,.001);Q.push(new THREE.Mesh(ee,L)),V.add(Q[Q.length-1]),0==pe?(q=-(ge.CrushHoriz>0?o:ge.W)/2+k+K,Q[0].position.x=-(ge.CrushHoriz>0?o:ge.W)/2+k/2):(Q[pe].position.x=q+k/2,q=q+k+K)}else{var oe=f+ge.CapCount,te=0,ne=(ge.OD,ge.CapHeight);console.log(ge.CapHeight,ne);var ie=f,re="facings";for(p=0;p<oe;p++){q=0;var ae=-1;if(0==p)te=-ge.H/2+z,ae=-ge.H/2+z/2,ie-=1;else if(ie>0)ae=te+z/2,te+=z,ie-=1,re="facings";else ae=(le=te+ne)-z/2,te=le,re="cap";for(pe=0;pe<g;pe++){ee=new THREE.BoxGeometry(k,z,.001);Q.push(new THREE.Mesh(ee,L)),Q[Q.length-1].uuid=re,V.add(Q[Q.length-1]),0==pe?(q=-ge.W/2+k+K,Q[Q.length-1].position.x=-ge.W/2+k/2):(Q[Q.length-1].position.x=q+k/2,q=q+k+K),Q[Q.length-1].position.y=ae}}}}else if(0==S&&"0"==Y&&(90==m||270==m?W.repeat.set(f,g):W.repeat.set(g,f)),W.wrapS=THREE.RepeatWrapping,W.wrapT=THREE.RepeatWrapping,90==m?m=270:270==m&&(m=90),W.rotation=m*Math.PI/180,"0"==Y)V=new THREE.Mesh(X,L);else{$=parseInt(i.replace("#","0x"),16),J=new THREE.Color($);V=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshBasicMaterial({color:J,transparent:!1,opacity:1}));Q=[],q=0,oe=f+(ge=ge).CapCount,te=0,ge.OD,ne=ge.CapHeight,ie=f,re="facings";for(p=0;p<oe;p++){var le;q=0,ae=-1;if(0==p)te=-ge.H/2+z,ae=-ge.H/2+z/2,ie-=1;else if(ie>0)ae=te+z/2,te+=z,ie-=1,re="facings";else ae=(le=te+ne)-ne/2,te=le,re="cap";for(pe=0;pe<g;pe++){var se;if(p<f){ee=new THREE.BoxGeometry(k,z,.001);se=L}else{ee=new THREE.BoxGeometry(k,ne,.001);-1!==w&&(P.wrapS=THREE.RepeatWrapping,P.wrapT=THREE.RepeatWrapping,m=E[1],90==E[1]?m=270:270==E[1]&&(m=90),P.rotation=m*Math.PI/180),se=-1!==w?A:L}Q.push(new THREE.Mesh(ee,se)),Q[Q.length-1].uuid=re,V.add(Q[Q.length-1]),0==pe?(q=-ge.W/2+k,Q[Q.length-1].position.x=-ge.W/2+k/2):(Q[Q.length-1].position.x=q+k/2,q+=k),Q[Q.length-1].position.y=ae}}}V.position.x=r,"PEGBOARD"==j.ObjType||isShelfOnPegboard(j.X,j.Y,s,C,j,g_pog_json)?V.position.z=.016:"PALLET"==j.ObjType?V.position.z=.001+j.D/1e3-ge.Z/1e3:V.position.z=.001+j.D/1e3,V.position.y=a}L.transparent=!0,V.uuid=e,g_world.add(V);var de=add_wireframe(V,2);V.WFrameID=de,V.WireframeObj.material.transparent=!0,V.WireframeObj.material.opacity=.0025;update_item_label(s,d,_,V,g_show_item_label,v,x,C,"N");if("Y"===g_item_vertical_text_display)get_canvas_camera("LABEL"),show_single_item_desc(s,d,_,g_pog_json[C].ModuleInfo[s].ShelfInfo[d].ItemInfo[_],V,g_camera,v,O,C);V.ImageExists="Y"}else{$=parseInt(i.replace("#","0x"),16),J=new THREE.Color($);if(0!==b||0!==M){V=new THREE.Mesh(new THREE.BoxGeometry(o,t,n),new THREE.MeshBasicMaterial({color:J})),G=g_world.getObjectById(j.SObjID);"N"==h&&(r=wpdSetFixed(0-(j.W/2-o/2-ge.Distance)),a=wpdSetFixed(j.H/2+t/2),l=wpdSetFixed(j.D/2-n/2),ge.RotationX=r,ge.RotationY=a,ge.RotationZ=l),V.applyMatrix4((new THREE.Matrix4).makeTranslation(r,a,l)),g_scene.updateMatrixWorld(),V.matrixAutoUpdate=!1,void 0!==G&&V.applyMatrix4(G.matrix)}else{if("F"==y&&g>1){V=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshBasicMaterial({color:J,transparent:!0,opacity:0})),Q=[],q=0,L=new THREE.MeshStandardMaterial({color:J}),K=(ge=ge).SpreadItem;for(pe=0;pe<g;pe++){var _e=final_height=0;if(f>1||"0"!==Y){ee=new THREE.BoxGeometry(k,t,.001);_e=k,final_height=t}else{ee=new THREE.BoxGeometry(k,z,.001);_e=k,final_height=z}Q.push(new THREE.Mesh(ee,L));de=add_wireframe(Q[Q.length-1],2);add_item_borders(s,d,_,Q[Q.length-1],_e,final_height,1,C,"N"),V.add(Q[Q.length-1]),0==pe?(q=-(ge.CrushHoriz>0?o:ge.W)/2+k+K,Q[0].position.x=-(ge.CrushHoriz>0?o:ge.W)/2+k/2):(Q[pe].position.x=q+k/2,q=q+k+K)}}else V=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshStandardMaterial({color:J}));V.position.x=r,"PEGBOARD"==j.ObjType||isShelfOnPegboard(j.X,j.Y,s,C,j,g_pog_json)?V.position.z=.016:"PALLET"==j.ObjType?V.position.z=.001+j.D/1e3-ge.Z/1e3:V.position.z=.001+j.D/1e3,V.position.y=a}V.uuid=e,j.AvlSpace=wpdSetFixed(j.AvlSpace-o);de=add_wireframe(V,2);V.WFrameID=de,g_world.add(V),("F"!==y||"F"==y&&1==g)&&add_item_borders(s,d,_,V,o,t,-1,C,"N");update_item_label(s,d,_,V,g_show_item_label,v,x,C,"N"),get_canvas_camera("LABEL"),show_single_item_desc(s,d,_,g_pog_json[C].ModuleInfo[s].ShelfInfo[d].ItemInfo[_],V,g_camera,v,O,C);V.ImageExists="N"}var ge=ge;V.ItemID=ge.Item,V.Description=ge.Desc,V.HorizFacing=ge.BHoriz,V.VertFacing=ge.BVert,V.DFacing=ge.BaseD,V.ClassName=ge.ClassName,V.DimUpdate=ge.DimUpdate,V.SellingPrice=ge.SellingPrice,V.SalesUnit=ge.SalesUnit,V.NetSales=ge.NetSales,V.CogsAdj=ge.CogsAdj,V.RegMovement=ge.RegMovement,V.AvgSales=ge.AvgSales,V.ItemStatus=ge.ItemStatus,V.CDTLvl1=ge.CDTLvl1,V.CDTLvl2=ge.CDTLvl2,V.CDTLvl3=ge.CDTLvl3,V.ActualDPP=ge.ActualDPP,V.StoreSOH=ge.StoreSOH,V.DPPLoc=ge.DPPLoc,V.StoreNo=ge.StoreNo,V.WeeksOfInventory=ge.WeeksOfInventory,V.ShelfPrice=ge.ShelfPrice,V.PromoPrice=ge.PromoPrice,V.DiscountRate=ge.DiscountRate,V.PriceChangeDate=ge.PriceChangeDate,V.WeeksOfInventory=ge.WeeksOfInventory,V.Qty=ge.Qty,V.WhStock=ge.WhStock,V.StoreStock=ge.StoreStock,V.StockIntransit=ge.StockIntransit,V.GrossProfit=ge.GrossProfit,V.WeeksCount=ge.WeeksCount,V.MovingItem=ge.MovingItem,V.Profit=ge.Profit,V.TotalMargin=ge.TotalMargin,V.W=ge.W,V.H=ge.H,V.D=ge.D,V.Color=ge.Color,V.Barcode=ge.Barcode,V.Desc=ge.Desc,V.Brand=ge.Brand,V.BrandType=ge.BrandType,V.Group=ge.Group,V.Dept=ge.Dept,V.Class=ge.Class,V.SubClass=ge.SubClass,V.StdUOM=ge.StdUOM,V.SizeDesc=ge.SizeDesc,V.Supplier=ge.Supplier,V.SupplierName=ge.SupplierName,V.LocID=ge.LocID,V.Supplier=ge.Supplier,V.ItemDim=g_msg_h+": "+(100*ge.OH).toFixed(2)+" ("+g_msg_Sq+" : "+ge.CrushVert+") "+g_msg_w+": "+(100*ge.OW).toFixed(2)+" ("+g_msg_Sq+" : "+ge.CrushHoriz+") "+g_msg_d+": "+(100*ge.OD).toFixed(2)+" ("+g_msg_Sq+" : "+ge.CrushD+")",V.OrientationDesc=ge.OrientationDesc,V.StoreCnt=ge.StoreCnt,V.RotationDegree=b,V.OW=100*ge.OW,V.OH=100*ge.OH,V.OD=100*ge.OD,V.CrushW=ge.CrushHoriz,V.CrushH=ge.CrushVert,V.CrushD=ge.CrushD,V.Shelf=j.Shelf,V.Rotation=0,V.ItemSlope=0,V.UnitperCase=ge.UnitperCase,V.UnitperTray=ge.UnitperTray,V.DescSecond=ge.DescSecond,V.DfacingUpd=ge.DfacingUpd,V.ItmDescChi=ge.ItmDescChi,V.ItmDescEng=ge.ItmDescEng,V.TotalUnitsCalc=ge.BHoriz*ge.BVert*ge.BaseD,V.PkSiz=ge.PkSiz,V.CapFacing=ge.CapFacing,V.CapDepth=ge.CapDepth,V.CapHorz=ge.CapHorz;var fe=ge.CapFacing*ge.CapDepth*ge.CapHorz;if(V.Cpct=ge.BHoriz*ge.BVert*ge.BaseD+(isNaN(fe)?0:fe),V.Brand_Category=ge.Brand_Category,V.Uda_item_status=ge.Uda_item_status,V.Gobecobrand=ge.Gobecobrand,V.Internet=ge.Internet,V.Categ=ge.Categ,void 0!==ge.SizeDesc&&""!==ge.SizeDesc)ge.SizeDesc.split("*");else;if(V.GoGreen=ge.GoGreen,V.ItemSize=ge.ItemSize,V.SplrLbl=ge.SplrLbl,V.COO=ge.COO,V.EDLP=ge.EDLP,V.LoGrp=ge.LoGrp,V.SqzPer=(void 0!==ge.CrushHoriz?ge.CrushHoriz:0)+":"+(void 0!==ge.CrushVert?ge.CrushVert:0)+":"+(void 0!==ge.CrushD?ge.CrushD:0),V.InternationalRng=ge.InternationalRng,V.NewItem=ge.NewItem,V.LiveNewItem=ge.LiveNewItem,V.DaysOfSupply=ge.DaysOfSupply,V.CapDepthChanged=ge.CapDepthChanged,V.Orientation=ge.Orientation,V.MassCrushH=ge.MassCrushH,V.MassCrushV=ge.MassCrushV,V.MassCrushD=ge.MassCrushD,V.UDA751=ge.UDA751,V.UDA755=ge.UDA755,V.MPogDepthFacings=ge.MPogDepthFacings,V.MPogHorizFacings=ge.MPogHorizFacings,V.MPogVertFacings=ge.MPogVertFacings,V.Status=ge.Status,V.MerchStyle=ge.MerchStyle,V.CapMerch=ge.CapMerch,V.ItemCondition=ge.ItemCondition,V.AUR=ge.AUR,V.ItemRanking=ge.ItemRanking,V.WeeklySales=ge.WeeklySales,V.WeeklyNetMargin=ge.WeeklyNetMargin,V.WeeklyQty=ge.WeeklyQty,V.NetMarginPercent=ge.NetMarginPercent,V.CumulativeNM=ge.CumulativeNM,V.TOP80B2=ge.TOP80B2,V.ItemBrandC=ge.ItemBrandC,V.ItemPOGDept=ge.ItemPOGDept,V.ItemRemark=ge.ItemRemark,V.RTVStatus=ge.RTVStatus,V.Pusher=ge.Pusher,V.Divider=ge.Divider,V.BackSupport=ge.BackSupport,V.CWPerc=ge.CWPerc,V.CHPerc=ge.CHPerc,V.CDPerc=ge.CDPerc,V.OOSPerc=ge.OOSPerc,V.InitialItemDesc=ge.InitialItemDesc,V.InitialBrand=ge.InitialBrand,V.InitialBarcode=ge.InitialBarcode,V.RotationFlag=0!==b||0!==M?"Y":"N","SHELF"==j.ObjType){var pe=0,ce=0;for(const e of j.ItemInfo)ce+=e.W,pe++;if("E"!==j.SpreadItem){var Ie=j.HorizGap?j.HorizGap:0;ce+=pe>1?Ie*(pe-1):0}j.AvlSpace=wpdSetFixed(100*(j.W-ce));var me=g_world.getObjectById(j.SObjID);void 0!==me&&"SHELF"==j.ObjType&&(me.AvlSpace=j.AvlSpace)}if("F"==j.SpreadItem&&("SHELF"==j.ObjType||"HANGINGBAR"==j.ObjType)){var he=0;for(const e of j.ItemInfo)he+=e?.CrushHoriz>0?e?.W:e?.RW;j.AvlSpace=wpdSetFixed(100*(j.W-he)),void 0!==me&&"SHELF"==j.ObjType&&(me.AvlSpace=j.AvlSpace)}G=g_world.getObjectById(V.id);"E"==V.DimUpdate&&void 0!==V.DimUpdate?(G.BorderColour=g_dim_error_color,G.WireframeObj.material.color.setHex(G.BorderColour)):"N"==nvl(V.Status)?(G.BorderColour=g_status_error_color,G.Status="N",G.WireframeObj.material.color.setHex(G.BorderColour)):"No"==nvl(V.MovingItem)&&"Y"==g_pogcr_auto_hlite_non_mv_item?(G.BorderColour=g_nonMovingItemColor,G.WireframeObj.material.color.setHex(G.BorderColour)):nvl(V.OOSPerc)>80&&"Y"==g_pogcr_enbl_oos_border?(G.BorderColour=g_pogcr_oos_border_color,G.WireframeObj.material.color.setHex(G.BorderColour)):G.BorderColour=0;G=g_world.getObjectById(V.id);var ue=j.ObjType;if(!(void 0===Z&&""===Z||"Y"!=g_show_peg_tags||"HANGINGBAR"!=ue&&"PEGBOARD"!=ue))show_pegTages("N",ge,G,s,d,_,C);render(C),logDebug("function : add_items_with_image","E"),I(V.id)}))}catch(e){logDebug("function : add_items_with_image","E"),error_handling(e)}}async function add_items_prom(e,o,t,n,i,r,a,l,s,d,_,g,f,p,c,I,m,h,u){logDebug("function : add_items_prom; uuid : "+e+"; width : "+o+"; height : "+t+"; depth : "+n+"; color : "+i+"; x : "+r+"; y : "+a+"; z : "+l+"; p_module_index : "+s+"; p_shelf_index : "+d+"; i_item_index : "+_+"; recreate : "+g);try{var S=g_pog_json[u].ModuleInfo[s].ShelfInfo[d],D=S.SpreadItem,[b,v]=getCombinationShelf(u,S.Shelf);-1!==b&&(D=g_combinedShelfs[b].SpreadItem),i=void 0===i?"#FFFFFF":i,objType=S.ObjType;var x=S.ItemInfo[_],O=x.PegID,C=x.pegHeadRoom,j=x.BHoriz,M=x.BVert,y=x.CapStyle;x.CrushHoriz>0&&j>1&&"F"==D&&"0"==x.Orientation&&(o=x.RW*(1-x.CrushHoriz/100)+x.SpreadItem*(j-1)),"Y"==x.Delist&&(i=p,x.Color=p);var[H,w,T,F,N,E]=get_new_orientation_dim(x.Orientation,x.OW,x.OH,x.OD);x.CrushHoriz>0&&"0"==x.Orientation&&(H=x.W/x.BHoriz),x.CrushVert>0&&"0"==x.Orientation&&(w=x.H/x.BVert),"0"!==x.Orientation&&("H"==N&&x.CrushVert>0&&(H=x.W/x.BHoriz),"W"==F&&x.CrushHoriz>0&&(w=x.H/x.BVert));parseFloat(o),parseFloat(t),parseFloat(o),parseFloat(t);return""!==O&&void 0!==C&&"Y"==g_show_peg_tags&&("HANGINGBAR"!=objType&&"PEGBOARD"!=objType||(t+=C/100,a+=(C/=2)/100)),new Promise((function(p,c){var b=parseInt(i.replace("#","0x"),16),v=new THREE.Color(b),C=S.Rotation,T=S.Slope;if(0!==C||0!==T){x=new THREE.Mesh(new THREE.BoxGeometry(o,t,n),new THREE.MeshStandardMaterial({color:v})),0!==S.ItemInfo[_].Rotation&&"DIVIDER"==S.ItemInfo[_].Item&&x.rotateY(S.ItemInfo[_].Rotation*Math.PI/180);var F=g_scene_objects[u].scene.children[2].getObjectById(S.SObjID);"N"==g&&("PEGBOARD"==S.ObjType?(r=0-S.W/2+(S.ItemInfo[_].PegBoardX+o/2),a=0-S.H/2+(S.ItemInfo[_].PegBoardY+t/2),l=.01+n/2):(r=wpdSetFixed(0-(S.W/2-o/2-S.ItemInfo[_].Distance)),a=wpdSetFixed(S.H/2+t/2),l=wpdSetFixed(S.D/2-n/2)),S.ItemInfo[_].RotationX=r,S.ItemInfo[_].RotationY=a,S.ItemInfo[_].RotationZ=l),x.applyMatrix4((new THREE.Matrix4).makeTranslation(r,a,l)),g_scene.updateMatrixWorld(),x.matrixAutoUpdate=!1,x.applyMatrix4(F.matrix),g_scene_objects[u].scene.children[2].add(x),F.updateMatrix();var N=new THREE.Vector3;N.setFromMatrixPosition(x.matrixWorld),x.geometry.computeBoundingBox();x.geometry.boundingBox;var E=(new THREE.Box3).setFromObject(x).getSize(new THREE.Vector3);S.ItemInfo[_].RotationWidth=parseFloat(E.x),S.ItemInfo[_].RotationHeight=parseFloat(E.y),S.ItemInfo[_].RotationDepth=parseFloat(E.z),S.ItemInfo[_].ItemRotateWorldX=N.x,S.ItemInfo[_].ItemRotateWorldY=N.y,S.ItemInfo[_].ItemRotateWorldZ=N.z}else{if(0!==S.ItemInfo[_].Rotation&&"DIVIDER"==S.ItemInfo[_].Item)(x=new THREE.Mesh(new THREE.BoxGeometry(o,t,n),new THREE.MeshStandardMaterial({color:v}))).rotateY(S.ItemInfo[_].Rotation*Math.PI/180),x.position.z=l+S.D/1e3;else{if("F"==D&&j>1){x=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshBasicMaterial({color:v,transparent:!0,opacity:0}));var B=[],W=0,R=new THREE.MeshStandardMaterial({color:v}),P=(z=S.ItemInfo[_]).SpreadItem;for(V=0;V<j;V++){var Y=final_height=0;if(M>1||"0"!==y){var A=new THREE.BoxGeometry(H,t,.001);Y=H,final_height=t}else{A=new THREE.BoxGeometry(H,w,.001);Y=H,final_height=w}B.push(new THREE.Mesh(A,R)),B[B.length-1].uuid="horiz_facing";var k=add_wireframe(B[B.length-1],2);add_item_borders(s,d,_,B[B.length-1],Y,final_height,1,u,"N"),x.add(B[B.length-1]),0==V?(W=-(z.CrushHoriz>0?o:z.W)/2+H+P,B[0].position.x=-(z.CrushHoriz>0?o:z.W)/2+H/2):(B[V].position.x=W+H/2,W=W+H+P)}}else x=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshStandardMaterial({color:v}));"PEGBOARD"==S.ObjType||isShelfOnPegboard(S.X,S.Y,s,u,S,g_pog_json)?x.position.z=.016:"PALLET"==S.ObjType?x.position.z=.001+S.D/1e3-S.ItemInfo[_].Z/1e3:x.position.z=.001+S.D/1e3}x.position.x=r,x.position.y=a,g_world.add(x)}x.uuid=e;var z=S.ItemInfo[_];x.ItemID=z.Item,x.Description=z.Desc,x.HorizFacing=z.BHoriz,x.VertFacing=z.BVert,x.DFacing=z.BaseD,x.ClassName=z.ClassName,x.DimUpdate=z.DimUpdate,x.SellingPrice=z.SellingPrice,x.SalesUnit=z.SalesUnit,x.NetSales=z.NetSales,x.CogsAdj=z.CogsAdj,x.GrossProfit=z.GrossProfit,x.WeeksCount=z.WeeksCount,x.MovingItem=z.MovingItem,x.RegMovement=z.RegMovement,x.AvgSales=z.AvgSales,x.ItemStatus=z.ItemStatus,x.CDTLvl1=z.CDTLvl1,x.CDTLvl2=z.CDTLvl2,x.CDTLvl3=z.CDTLvl3,x.ActualDPP=z.ActualDPP,x.StoreSOH=z.StoreSOH,x.DPPLoc=z.DPPLoc,x.StoreNo=z.StoreNo,x.WeeksOfInventory=z.WeeksOfInventory,x.ShelfPrice=z.ShelfPrice,x.PromoPrice=z.PromoPrice,x.DiscountRate=z.DiscountRate,x.PriceChangeDate=z.PriceChangeDate,x.WeeksOfInventory=z.WeeksOfInventory,x.Qty=z.Qty,x.WhStock=z.WhStock,x.StoreStock=z.StoreStock,x.StockIntransit=z.StockIntransit,x.Profit=z.Profit,x.TotalMargin=z.TotalMargin,x.W=z.W,x.H=z.H,x.D=z.D,x.Color=z.Color,x.Barcode=z.Barcode,x.Desc=z.Desc,x.Brand=z.Brand,x.BrandType=z.BrandType,x.Group=z.Group,x.Dept=z.Dept,x.Class=z.Class,x.SubClass=z.SubClass,x.StdUOM=z.StdUOM,x.SizeDesc=z.SizeDesc,x.Supplier=z.Supplier,x.SupplierName=z.SupplierName,x.LocID=z.LocID,x.ClassName=z.ClassName,x.ItemDim=g_msg_h+": "+(100*z.OH).toFixed(2)+" ("+g_msg_Sq+" : "+z.CrushVert+") "+g_msg_w+": "+(100*z.OW).toFixed(2)+" ("+g_msg_Sq+" : "+z.CrushHoriz+") "+g_msg_d+": "+(100*z.OD).toFixed(2)+" ("+g_msg_Sq+" : "+z.CrushD+")",x.OrientationDesc=z.OrientationDesc,x.Orientation=z.Orientation,x.StoreCnt=z.StoreCnt,x.RotationDegree=C,x.OW=100*z.OW,x.OH=100*z.OH,x.OD=100*z.OD,x.CrushW=z.CrushHoriz,x.CrushH=z.CrushVert,x.CrushD=z.CrushD,x.DescSecond=z.DescSecond,x.Shelf=S.Shelf,x.Rotation=0,x.ItemSlope=0,x.RotationFlag=0!==C||0!==T?"Y":"N",x.ImageExists="N",x.UnitperCase=z.UnitperCase,x.UnitperTray=z.UnitperTray,x.DfacingUpd=z.DfacingUpd,x.ItmDescChi=z.ItmDescChi,x.ItmDescEng=z.ItmDescEng,x.TotalUnitsCalc=z.BHoriz*z.BVert*z.BaseD,x.PkSiz=z.PkSiz,x.CapFacing=z.CapFacing,x.CapDepth=z.CapDepth,x.CapHorz=z.CapHorz;var X=z.CapFacing*z.CapDepth*z.CapHorz;if(x.Cpct=z.BHoriz*z.BVert*z.BaseD+(isNaN(X)?0:X),x.Brand_Category=z.Brand_Category,x.Uda_item_status=z.Uda_item_status,x.Gobecobrand=z.Gobecobrand,x.Internet=z.Internet,x.GoGreen=z.GoGreen,x.Categ=z.Categ,void 0!==z.SizeDesc&&""!==z.SizeDesc)z.SizeDesc.split("*");else;if(x.ItemSize=z.ItemSize,x.SplrLbl=z.SplrLbl,x.COO=z.COO,x.EDLP=z.EDLP,x.LoGrp=z.LoGrp,x.SqzPer=(void 0!==z.CrushHoriz?z.CrushHoriz:0)+":"+(void 0!==z.CrushVert?z.CrushVert:0)+":"+(void 0!==z.CrushD?z.CrushD:0),x.InternationalRng=z.InternationalRng,x.NewItem=z.NewItem,x.LiveNewItem=z.LiveNewItem,x.DaysOfSupply=z.DaysOfSupply,x.CapDepthChanged=z.CapDepthChanged,x.MassCrushH=z.MassCrushH,x.MassCrushV=z.MassCrushV,x.MassCrushD=z.MassCrushD,x.UDA751=z.UDA751,x.UDA755=z.UDA755,x.MPogDepthFacings=z.MPogDepthFacings,x.MPogHorizFacings=z.MPogHorizFacings,x.MPogVertFacings=z.MPogVertFacings,x.Status=z.Status,x.MerchStyle=z.MerchStyle,x.CapMerch=z.CapMerch,x.ItemCondition=z.ItemCondition,x.AUR=z.AUR,x.ItemRanking=z.ItemRanking,x.WeeklySales=z.WeeklySales,x.WeeklyNetMargin=z.WeeklyNetMargin,x.WeeklyQty=z.WeeklyQty,x.NetMarginPercent=z.NetMarginPercent,x.CumulativeNM=z.CumulativeNM,x.TOP80B2=z.TOP80B2,x.ItemBrandC=z.ItemBrandC,x.ItemPOGDept=z.ItemPOGDept,x.ItemRemark=z.ItemRemark,x.RTVStatus=z.RTVStatus,x.Pusher=z.Pusher,x.Divider=z.Divider,x.BackSupport=z.BackSupport,x.CWPerc=z.CWPerc,x.CHPerc=z.CHPerc,x.CDPerc=z.CDPerc,x.OOSPerc=z.OOSPerc,x.InitialItemDesc=z.InitialItemDesc,x.InitialBrand=z.InitialBrand,x.InitialBarcode=z.InitialBarcode,"SHELF"==S.ObjType||"HANGINGBAR"==S.ObjType&&"Y"==f){var L,V=0,G=0;for(const e of S.ItemInfo)G+=e.W,V++;if("E"!==S.SpreadItem){var U=S.HorizGap?S.HorizGap:0;G+=V>1?U*(V-1):0}S.AvlSpace=wpdSetFixed(100*(S.W-G)),void 0!==(L=g_world.getObjectById(S.SObjID))&&"SHELF"==S.ObjType&&(L.AvlSpace=S.AvlSpace)}if("F"==S.SpreadItem&&("SHELF"==S.ObjType||"HANGINGBAR"==S.ObjType)){var Z=0;for(const e of S.ItemInfo)Z+=e?.CrushHoriz>0?e?.W:e?.RW;S.AvlSpace=wpdSetFixed(100*(S.W-Z)),void 0!==L&&"SHELF"==S.ObjType&&(L.AvlSpace=S.AvlSpace)}"ROD"==S.ObjType&&"Y"==f&&(S.AvlSpace=wpdSetFixed(S.D-z.D),void 0!==(L=g_world.getObjectById(S.SObjID))&&"ROD"==S.ObjType&&(L.AvlSpace=S.AvlSpace));update_item_label(s,d,_,x,g_show_item_label,m,h,u,"N"),k=add_wireframe(x,2);x.WFrameID=k;show_single_item_desc(s,d,_,g_pog_json[u].ModuleInfo[s].ShelfInfo[d].ItemInfo[_],x,g_camera,m,I,u);("F"!==D||"F"==D&&1==j)&&add_item_borders(s,d,_,x,o,t,-1,u,"N");F=g_world.getObjectById(x.id);"E"==x.DimUpdate&&void 0!==x.DimUpdate?(F.BorderColour=g_dim_error_color,F.WireframeObj.material.color.setHex(F.BorderColour)):"N"==nvl(x.Status)?(F.BorderColour=g_status_error_color,F.Status="N",F.WireframeObj.material.color.setHex(F.BorderColour)):"No"==nvl(x.MovingItem)&&"Y"==g_pogcr_auto_hlite_non_mv_item?(F.BorderColour=g_nonMovingItemColor,F.WireframeObj.material.color.setHex(F.BorderColour)):nvl(x.OOSPerc)>80&&"Y"==g_pogcr_enbl_oos_border?(F.BorderColour=g_pogcr_oos_border_color,F.WireframeObj.material.color.setHex(F.BorderColour)):F.BorderColour=0;var $=S.ObjType;if(!(void 0===O&&""===O||"Y"!=g_show_peg_tags||"HANGINGBAR"!=$&&"PEGBOARD"!=$))show_pegTages("N",S.ItemInfo[_],F,s,d,_,u);p(x.id),logDebug("function : add_items_prom","E")}))}catch(e){logDebug("function : add_items_prom","E"),error_handling(e)}}function add_items(e,o,t,n,i,r,a,l,s,d,_,g,f){try{logDebug("function : add_items; uuid : "+e+"; width : "+o+"; height : "+t+"; depth : "+n+"; color : "+i+"; x : "+r+"; y : "+a+"; z : "+l+"; p_module_index : "+s+"; p_shelf_index : "+d+"; i_item_index : "+_+"; rotation : "+g,"S");var p=parseInt(i.replace("#","0x"),16),c=new THREE.Color(p),I=g_pog_json[f].ModuleInfo[s].ShelfInfo[d],m=(g=I.Rotation,I.Slope);if(0!==g||0!==m){items=new THREE.Mesh(new THREE.BoxGeometry(o,t,n),new THREE.MeshStandardMaterial({color:c})),0!==I.ItemInfo[_].Rotation&&"DIVIDER"==I.ItemInfo[_].Item&&items.rotateY(I.ItemInfo[_].Rotation*Math.PI/180);var h=g_world.getObjectById(I.SObjID);"PEGBOARD"==I.ObjType?(r=0-I.W/2+(I.ItemInfo[_].PegBoardX+o/2),a=0-I.H/2+(I.ItemInfo[_].PegBoardY+t/2),l=.01+n/2):(r=wpdSetFixed(0-(I.W/2-o/2-I.ItemInfo[_].Distance)),a=wpdSetFixed(I.H/2+t/2),l=wpdSetFixed(I.D/2-n/2)),I.ItemInfo[_].RotationX=r,I.ItemInfo[_].RotationY=a,I.ItemInfo[_].RotationZ=l,items.applyMatrix4((new THREE.Matrix4).makeTranslation(r,a,l)),g_scene.updateMatrixWorld(),items.matrixAutoUpdate=!1,items.applyMatrix4(h.matrix),items.FixelID=I.ItemInfo[_].ItemID,items.Module=g_pog_json[f].ModuleInfo[s].Module,items.POGCode=g_pog_json[f].POGCode,items.Version=g_pog_json[f].Version,items.X=wpdSetFixed(100*I.ItemInfo[_].X-100*I.ItemInfo[_].W/2),items.Y=wpdSetFixed(100*I.ItemInfo[_].Y-100*I.ItemInfo[_].H/2),items.Z=wpdSetFixed(100*I.ItemInfo[_].Z),items.Desc=I.Desc,g_world.add(items),h.updateMatrix();var u=new THREE.Vector3;u.setFromMatrixPosition(items.matrixWorld),I.ItemInfo[_].ItemRotateWorldX=u.x,I.ItemInfo[_].ItemRotateWorldY=u.y,I.ItemInfo[_].ItemRotateWorldZ=u.z}else{items=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshStandardMaterial({color:c})),items.position.x=r,items.position.z=.001+I.D/1e3,items.position.y=a,items.uuid=e;var S=I.ItemInfo[_];items.FixelID=S.ItemID,items.Module=g_pog_json[f].ModuleInfo[s].Module,items.W=S.W,items.H=S.H,items.D=S.D,items.Color=S.Color,items.Rotation=0,items.ItemSlope=0,items.Rotation=0!==g||0!==m?"Y":"N",items.ImageExists="N",items.POGCode=g_pog_json[f].POGCode,items.Version=g_pog_json[f].Version,items.X=wpdSetFixed(100*I.ItemInfo[_].X-100*I.ItemInfo[_].W/2),items.Y=wpdSetFixed(100*I.ItemInfo[_].Y-100*I.ItemInfo[_].H/2),items.Z=wpdSetFixed(100*I.ItemInfo[_].Z),items.Desc=I.Desc,g_world.add(items)}add_wireframe(items,2);add_item_borders(s,d,_,items,o,t,-1,f,"N");var D=g_pog_json[f].ModuleInfo[s].ShelfInfo,b=0,v="N",x=!1;for(const e of D){if(e.Shelf==I.ItemInfo[_].ItemID){g_pog_json[f].ModuleInfo[s].ShelfInfo[b].ShelfDivObjID=items.id,e.DivHeight>0&&("Y"==e.DivPbtwFace||"Y"==e.DivPed||"Y"==e.DivPst)&&(v="Y",x=!0);break}b++}if(x||I.DivHeight>0&&("Y"==I.DivPbtwFace||"Y"==I.DivPed||"Y"==I.DivPst)&&(v="Y"),show_div_id="undefined"!==I.NoDivIDShow&&"Y"==v?I.NoDivIDShow:"N","Y"==g_show_fixel_label&&"N"==show_div_id){var O=I.ItemInfo[_].Color;if(null==hexToRgb(O))parseInt("FF",16),parseInt("FF",16),parseInt("FF",16);else hexToRgb(O).r,hexToRgb(O).r,hexToRgb(O).g;"#ffffff";var C=addlabelText(I.ItemInfo[_].ItemID,g_labelFont,g_labelActualSize,"#ffffff","center","");items.add(C),C.position.x=0,C.position.y=0,0!==I.Rotation||0!==I.Slope?C.position.z=I.ItemInfo[_].D/2+.005:C.position.z=.005,I.ItemInfo[_].LObjID=C.id;D=g_pog_json[f].ModuleInfo[s].ShelfInfo;$.each(D,(function(e,o){if(o.Shelf==I.ItemInfo[_].ItemID)return g_pog_json[f].ModuleInfo[s].ShelfInfo[e].LObjID=C.id,!1}))}return logDebug("function : add_items","E"),items.id}catch(e){error_handling(e)}}async function update_rotate_shelfs(e){logDebug("function : update_rotate_shelfs","S");try{var o=0;for(const a of g_pog_json[e].ModuleInfo){if(null==a.ParentModule){var t=0;for(const l of a.ShelfInfo){if("BASE"!==l.ObjType&&"NOTCH"!==l.ObjType&&"DIVIDER"!==l.ObjType&&(0!==l.Rotation||0!==l.Slope)){var n=g_world.getObjectById(l.SObjID);if(0!==l.Rotation){n.quaternion.copy(g_camera.quaternion),n.lookAt(g_pog_json[e].CameraX,g_pog_json[e].CameraY,g_pog_json[e].CameraZ),n.rotateY(l.Rotation*Math.PI/180);var i=0;i=l.Slope>0?0-l.Slope:l.Slope<0?-l.Slope:0,n.rotateX(i*Math.PI/180),n.updateMatrix()}if(g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo.length>0){async function r(){await set_all_items(o,t,l.X,l.Y,g_shelf_edit_flag,"N","Y",e,e)}g_scene.updateMatrixWorld(),r()}}t++}}o++}logDebug("function : update_rotate_shelfs","E")}catch(s){error_handling(s)}}async function update_item_distance(e,o,t,n="N"){logDebug("function : update_item_distance; p_module_index : "+e+"; p_shelf_index : "+o,"S");try{if("Y"==n)var i=g_pog_json[t].ModuleInfo[e].ChestInfo[o];else i=g_pog_json[t].ModuleInfo[e].ShelfInfo[o];var r=i.ItemInfo,a=i.ObjType,l=i.X-i.W/2,s=i.Y+i.H/2,d=i.Y-i.H/2,_=i.BsktSpreadProduct;"BASKET"==a&&"BT"==_?$.each(r,(function(e,o){i.ItemInfo[e].Distance=o.Y-o.H/2-s})):"PEGBOARD"==a||"CHEST"==a&&"Y"==g_chest_as_pegboard?$.each(r,(function(e,o){i.ItemInfo[e].PegBoardX=o.X-o.W/2-l,i.ItemInfo[e].PegBoardY=o.Y-o.H/2-d,i.ItemInfo[e].Distance=o.X-o.W/2-l})):$.each(r,(function(e,o){i.ItemInfo[e].Distance=o.X-o.W/2-l,i.ItemInfo[e].YDistance=o.Y-s})),logDebug("function : update_item_distance","E")}catch(e){error_handling(e)}}async function set_all_items(e,o,t,n,i,r,a,l,s,d){logDebug("function : set_all_items; p_module_index : "+e+"; p_shelf_index : "+o+"; a : "+t+"; y : "+n+"; p_shelf_edit_flag : "+i+"; resetType : "+r+"; set_axis : "+a,"S");try{var _=g_pog_json[l].ModuleInfo[e].ShelfInfo[o];if(_.ItemInfo.length>0&&"Y"==i){var g=_.ItemInfo,f=_.W,p=_.H,c=(_.D,_.ObjType),I=(_.SpreadItem,_.BsktSpreadProduct),m=_.Rotation,h=_.Slope,u=0,S=0;if(0!==m&&"N"!==m||0!==h){var D=0,b=g_scene_objects[s].scene.children[2].getObjectById(_.SObjID);for(const e of g){var v=g_scene_objects[s].scene.children[2].getObjectById(e.ObjID),x=e.RotationX,O=(n=e.RotationY,e.RotationZ),C=new THREE.Vector3(x,n,O).applyMatrix4(b.matrixWorld);v.position.x=C.x,v.position.y=C.y,v.position.z=C.z,v.quaternion.copy(b.quaternion),v.updateMatrix();var j=new THREE.Vector3;j.setFromMatrixPosition(v.matrixWorld),isNaN(j.x)||(_.ItemInfo[D].ItemRotateWorldX=j.x,_.ItemInfo[D].ItemRotateWorldY=j.y,_.ItemInfo[D].ItemRotateWorldZ=j.z),D+=1}render(l)}else if("BASKET"==c&&"BT"==I){D=0;for(const e of g){void 0!==(b=g_scene_objects[s].scene.children[2].getObjectById(e.ObjID))&&(u=t-f/2+e.W/2,S=n+p/2+e.Distance+e.H/2,b.position.set(u,S,b.position.z),"Y"==a&&(_.ItemInfo[D].X=u,_.ItemInfo[D].Y=S)),D++}}else if("HANGINGBAR"==c){D=0;for(const e of g){void 0!==(b=g_scene_objects[s].scene.children[2].getObjectById(e.ObjID))&&(u=t-f/2+e.Distance+e.W/2,S=n-e.H/2,b.position.set(u,S,b.position.z),"Y"==a&&(_.ItemInfo[D].X=u,_.ItemInfo[D].Y=S)),D++}}else if("ROD"==g_shelf_object_type){D=0;for(const e of g){void 0!==(b=g_scene_objects[s].scene.children[2].getObjectById(e.ObjID))&&(u=t,S=n-p/2-e.H/2,b.position.set(u,S,b.position.z),"Y"==a&&(_.ItemInfo[D].X=u,_.ItemInfo[D].Y=S)),D++}}else if("PEGBOARD"==g_shelf_object_type||"CHEST"==g_shelf_object_type&&"Y"==g_chest_as_pegboard){D=0;for(const e of g){void 0!==(b=g_scene_objects[s].scene.children[2].getObjectById(e.ObjID))&&(u=t-f/2+e.PegBoardX+e.W/2,S=n-p/2+e.PegBoardY+e.H/2,b.position.set(u,S,.016),"Y"==a&&(_.ItemInfo[D].X=u,_.ItemInfo[D].Y=S)),D++}}else{D=0;for(const e of g){var M=e.OldItemHeight;if("E"==r?null==M&&(M=e.H):M=e.H,void 0!==(b=g_scene_objects[s].scene.children[2].getObjectById(e.ObjID))){if(void 0!==e.BottomObjID&&""!==e.BottomObjID){var y;for(const o of g){if(y=o.OldItemHeight,"E"==r?void 0===y&&(y=o.H):y=o.H,e.BottomObjID==o.ObjID){u=t-f/2+o.Distance+o.W/2,S=n+p/2+e.TotalHeight+e.H/2;break}0}}else u=t-f/2+e.Distance+e.W/2,S=n+p/2+M/2;"BASKET"==c&&"DIVIDER"==e.Item&&(S=n+p/2+e.YDistance+e.H/2,b.position.set(u,S,g_drag_z)),"PALLET"==c?(b.position.x=u,b.position.y=S):"Y"===d?b.position.set(u,S):b.position.set(u,S,g_drag_z),"Y"==a&&(_.ItemInfo[D].X=u,_.ItemInfo[D].Y=S),_.ItemInfo[D].H=M}D++}}}logDebug("function : set_all_items","E")}catch(e){error_handling(e)}}function get_y_distance(e,o,t,n,i,r){logDebug("function : get_y_distance; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+t+"; itemX : "+n+"; itemY : "+i,"S");try{var a=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo,l=0;for(const e of a)wpdSetFixed(n)==wpdSetFixed(e.X)&&wpdSetFixed(e.Y)<wpdSetFixed(i)&&(l+=e.H);return logDebug("function : get_y_distance","E"),l}catch(e){error_handling(e)}}function update_item_label(e,o,t,n,i,r,a,l,s="N"){logDebug("function : update_item_label; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+t+"; g_show_item_label : "+i,"S");try{if("Y"==s)var d=g_pog_json[l].ModuleInfo[e].ChestInfo[o];else d=g_pog_json[l].ModuleInfo[e].ShelfInfo[o];if("Y"==i&&""!==d.ItemInfo[t].LocID&&void 0!==d.ItemInfo[t].LocID){var _,g=r;if(null==hexToRgb(g))var f=parseInt("FF",16),p=parseInt("FF",16),c=parseInt("FF",16);else f=hexToRgb(g).r,p=hexToRgb(g).r,c=hexToRgb(g).g;if(_=getTextColor(f,p,c),"N"==g_fixel_label)var I=addlabelText(d.ItemInfo[t].LocID,g_labelFont,g_labelActualSize,_,"center",g);else{var m=get_type(d.ItemInfo[t].BrandType);I=addlabelText(m=void 0===m||""==m?d.ItemInfo[t].LocID:m+" "+d.ItemInfo[t].LocID,g_labelFont,g_labelActualSize,_,"center",g)}n.add(I),I.position.x=0,I.position.y="CENTER"==a?0:"BOTTOM"==a?0-d.ItemInfo[t].H/2+.0015625*g_labelFont:d.ItemInfo[t].H/2+.0015625*g_labelFont,0!==d.Rotation||0!==d.Slope?I.position.z=d.ItemInfo[t].D/2+.005:I.position.z=.0015,d.ItemInfo[t].LObjID=I.id}return logDebug("function : update_item_label","E"),"success"}catch(e){error_handling(e)}}function show_item_labels(e,o,t,n){try{logDebug("function : show_item_labels; show_label_ind : "+e+"; pogcrItemBackLabelColor : "+o+"; pogcrItemLabelPosition : "+t,"S");var i,r=g_pog_json[n].ModuleInfo,a={};void 0===g_undoRedoAction&&(g_undoRedoAction="REDO"),i="REDO"==g_undoRedoAction?"U":"R";var l,s=0;if("Y"==e)for(const e of r){if(void 0===e.ParentModule||null==e.ParentModule){var d=e.ShelfInfo,_=0;for(const e of d){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.ItemInfo.length>0){var g=e.ItemInfo,f=0;for(const i of g){if("DIVIDER"!==i.Item&&""!==i.LocID&&void 0!==i.LocID){if(void 0!==(b=g_scene_objects[n].scene.children[2].getObjectById(i.ObjID))){if(void 0!==i.LObjID&&-1!==i.LObjID){var p=b.getObjectById(i.LObjID);b.remove(p)}var c=o;if(null==hexToRgb(c))var I=parseInt("FF",16),m=parseInt("FF",16),h=parseInt("FF",16);else I=hexToRgb(c).r,m=hexToRgb(c).r,h=hexToRgb(c).g;var u=getTextColor(I,m,h);if("Y"==g_fixel_label)var S=get_type(i.BrandType),D=addlabelText(S=void 0===S||""==S?i.LocID:S+""+i.LocID,g_labelFont,g_labelActualSize,u,"center",c);else D=addlabelText(i.LocID,g_labelFont,g_labelActualSize,u,"center",c);b.add(D),D.position.x=0,D.position.y="CENTER"==t?0:"BOTTOM"==t?0-i.H/2+.0015625*g_labelFont:i.H/2+.0015625*g_labelFont,0!==e.Rotation||0!==e.Slope?D.position.z=i.D/2+5e-4:D.position.z=.0015,g_pog_json[n].ModuleInfo[s].ShelfInfo[_].ItemInfo[f].LObjID=D.id}}else if("DIVIDER"!==i.Item){if(void 0!==i.LObjID&&-1!==i.LObjID)if(void 0!==(b=g_scene_objects[n].scene.children[2].getObjectById(i.ObjID))){p=b.getObjectById(i.LObjID);b.remove(p)}}f+=1}}_+=1}}s+=1}else{s=0;for(const e of r){if(void 0===e.ParentModule||null==e.ParentModule){d=e.ShelfInfo,_=0;for(const e of d){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.ItemInfo.length>0){g=e.ItemInfo,f=0;for(const e of g){var b;if("DIVIDER"!==e.Item&&""!==e.LocID&&void 0!==e.LocID)if(void 0!==(b=g_scene_objects[n].scene.children[2].getObjectById(e.ObjID))){if(void 0!==e.LObjID&&-1!==e.LObjID){p=b.getObjectById(e.LObjID);b.remove(p)}g_pog_json[n].ModuleInfo[s].ShelfInfo[_].ItemInfo[f].LObjID=-1}f+=1}}_+=1}}s+=1}}l="Y"==e?"N":"Y",a.show_item_labels=l,(g_undo_details=[]).push(a),"U"==i?(g_delete_details.multi_delete_shelf_ind="N",(g_undo_all_obj_arr=[]).push(g_undo_details),g_undo_all_obj_arr.push(g_cut_copy_arr),g_undo_all_obj_arr.previousAction="ITEM_LABEL",g_cut_support_obj_arr.length>0?g_undo_all_obj_arr.hasSupportArr="Y":g_undo_all_obj_arr.hasSupportArr="N",g_undo_all_obj_arr.g_MultiObjects="N",g_undo_all_obj_arr.multi_delete_shelf_ind="N",g_undo_final_obj_arr.push(g_undo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]):(g_delete_details.multi_delete_shelf_ind="N",(g_redo_all_obj_arr=[]).push(g_undo_details),g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.previousAction="ITEM_LABEL",g_cut_support_obj_arr.length>0?g_redo_all_obj_arr.hasSupportArr="Y":g_redo_all_obj_arr.hasSupportArr="N",g_redo_all_obj_arr.g_MultiObjects="N",g_redo_all_obj_arr.multi_delete_shelf_ind="N",g_redo_final_obj_arr.push(g_redo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]),animate_pog(n),render(n),logDebug("function : show_item_labels","E")}catch(e){error_handling(e)}}function update_single_fixel_label(e,o,t,n){var r=-1,a=g_pog_json[o].ModuleInfo[t].ShelfInfo[n],l=g_pog_json[o].ModuleInfo[t];if("DIVIDER"==e.ObjType){var s=g_pog_json[o].ModuleInfo[t].ShelfInfo;$.each(s,(function(o,t){"BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&$.each(t.ItemInfo,(function(t,n){"DIVIDER"==n.Item&&e.ShelfDivObjID==n.ObjID&&(div_mod_index=i,div_shelf_index=o,div_item_index=t,r=n.LObjID)}))}));var d=g_scene_objects[o].scene.children[2].getObjectById(e.ShelfDivObjID)}else{r=e.LObjID;d=g_scene_objects[o].scene.children[2].getObjectById(e.SObjID)}if(void 0!==d){if(void 0!==r&&-1!==r){var _=d.getObjectById(r);d.remove(_)}var g=e.Color;if(null==hexToRgb(g))var f=parseInt("FF",16),p=parseInt("FF",16),c=parseInt("FF",16);else f=hexToRgb(g).r,p=hexToRgb(g).r,c=hexToRgb(g).g;var I=getTextColor(f,p,c);if("Y"==g_fixel_label)var m=get_notch_no(l,o,e.Y+e.H/2),h=addlabelText(e.Shelf+" "+e.Desc+" "+parseFloat(100*e.Y-e.H/2*100).toFixed(2)+get_message("POGCR_FIXEL_CM")+" "+m,g_labelFont,g_labelActualSize,I,"center","");else h=addlabelText(e.Shelf,g_labelFont,g_labelActualSize,I,"center","");d.add(h),h.position.y=-.005,0!==e.Rotation||0!==e.Slope?h.position.z=e.D/2+.005:h.position.z=.005,"DIVIDER"==e.ObjType&&-1!==div_mod_index?(h.position.x=0,g_pog_json[o].ModuleInfo[div_mod_index].ShelfInfo[div_shelf_index].ItemInfo[div_item_index].LObjID=h.id,a.LObjID=h.id):(h.position.x="Y"!==g_fixel_label?0-(e.W/2.4+.01):0-(e.W/2.4-.02),a.LObjID=h.id)}}function show_fixel_labels(e,o){try{logDebug("function : show_fixel_labels; show_label_ind : "+e,"S");var t,n=g_pog_json[o].ModuleInfo,i=-1,r=-1,a=-1,l="N",s={};void 0===g_undoRedoAction&&(g_undoRedoAction="REDO"),t="REDO"==g_undoRedoAction?"U":"R";var d,_=0;if("Y"==e)for(const e of n){if(void 0===e.ParentModule||null==e.ParentModule){var g=e.ShelfInfo,f=0;for(const t of g){if(l="N",console.log("ObjType TextBox",t.ObjType),"BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"TEXTBOX"!==t.ObjType){var p=-1;if("DIVIDER"==t.ObjType){var c=g_pog_json[o].ModuleInfo[_].ShelfInfo;$.each(c,(function(e,o){"BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&$.each(o.ItemInfo,(function(n,s){"DIVIDER"==s.Item&&t.ShelfDivObjID==s.ObjID&&(i=_,r=e,a=n,p=s.LObjID,l=t.DivHeight>0&&("Y"==t.DivPbtwFace||"Y"==t.DivPst||"Y"==t.DivPed)?void 0!==t.NoDivIDShow?t.NoDivIDShow:void 0!==o.NoDivIDShow?o.NoDivIDShow:"N":"N")}))}));var I=g_scene_objects[o].scene.children[2].getObjectById(t.ShelfDivObjID)}else{p=t.LObjID;I=g_scene_objects[o].scene.children[2].getObjectById(t.SObjID)}if(void 0!==I){if(void 0!==p&&-1!==p){var m=I.getObjectById(p);I.remove(m)}var h=t.Color;if(null==hexToRgb(h))var u=parseInt("FF",16),S=parseInt("FF",16),D=parseInt("FF",16);else u=hexToRgb(h).r,S=hexToRgb(h).r,D=hexToRgb(h).g;var b=getTextColor(u,S,D);if("Y"==g_fixel_label){if("N"==l)var v=get_notch_no(e,o,t.Y+t.H/2),x=addlabelText(t.Shelf+" "+t.Desc+" "+parseFloat(100*t.Y-t.H/2*100).toFixed(2)+get_message("POGCR_FIXEL_CM")+" "+v,g_labelFont,g_labelActualSize,b,"center","")}else if("N"==l)x=addlabelText(t.Shelf,g_labelFont,g_labelActualSize,b,"center","");if("N"==l)if(I.add(x),0!==t.Rotation||0!==t.Slope?x.position.z=t.D/2+.005:x.position.z=.005,"DIVIDER"==t.ObjType&&-1!==i)x.position.x=0,g_pog_json[o].ModuleInfo[i].ShelfInfo[r].ItemInfo[a].LObjID=x.id,g_pog_json[o].ModuleInfo[_].ShelfInfo[f].LObjID=x.id;else{if("Y"!==g_fixel_label){var O=x.material.map.image.width/x.material.map.image.height*g_labelActualSize/2;x.position.x=0-t.W/2+O+.01,x.position.y=0}else{O=x.material.map.image.width/x.material.map.image.height*g_labelActualSize/2;x.position.x=0-t.W/2+O+.01,x.position.y=-.005}g_pog_json[o].ModuleInfo[_].ShelfInfo[f].LObjID=x.id}}}f+=1}}_+=1}else{_=0;for(const e of n){if(void 0===e.ParentModule||null==e.ParentModule){g=e.ShelfInfo,f=0;for(const e of g){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType){p=-1;if("DIVIDER"==e.ObjType){c=g_pog_json[o].ModuleInfo[_].ShelfInfo;$.each(c,(function(o,t){"BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&$.each(t.ItemInfo,(function(t,n){"DIVIDER"==n.Item&&e.ShelfDivObjID==n.ObjID&&(i=_,r=o,a=t,p=n.LObjID)}))}));I=g_scene_objects[o].scene.children[2].getObjectById(e.ShelfDivObjID)}else{p=e.LObjID;I=g_scene_objects[o].scene.children[2].getObjectById(e.SObjID)}if(void 0!==p&&-1!==p){m=I.getObjectById(p);I.remove(m)}g_pog_json[o].ModuleInfo[_].ShelfInfo[f].LObjID=-1}f+=1}}_+=1}"Y"==g_fixel_label&&show_notch_labels("N","","Y",o)}d="Y"==e?"N":"Y",s.show_fixel_labels=d,(g_undo_details=[]).push(s),"U"==t?(g_delete_details.multi_delete_shelf_ind="N",(g_undo_all_obj_arr=[]).push(g_undo_details),g_undo_all_obj_arr.push(g_cut_copy_arr),g_undo_all_obj_arr.previousAction="FIXEL_LABEL",g_cut_support_obj_arr.length>0?g_undo_all_obj_arr.hasSupportArr="Y":g_undo_all_obj_arr.hasSupportArr="N",g_undo_all_obj_arr.g_MultiObjects="N",g_undo_all_obj_arr.multi_delete_shelf_ind="N",g_undo_final_obj_arr.push(g_undo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]):(g_delete_details.multi_delete_shelf_ind="N",(g_redo_all_obj_arr=[]).push(g_undo_details),g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.previousAction="FIXEL_LABEL",g_cut_support_obj_arr.length>0?g_redo_all_obj_arr.hasSupportArr="Y":g_redo_all_obj_arr.hasSupportArr="N",g_redo_all_obj_arr.g_MultiObjects="N",g_redo_all_obj_arr.multi_delete_shelf_ind="N",g_redo_final_obj_arr.push(g_redo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]),animate_pog(o),render(o),logDebug("function : show_fixel_labels","E")}catch(e){error_handling(e)}}function show_notch_labels(e,o,t="Y",n){try{logDebug("function : show_notch_labels; show_label_ind : "+e,"S");var i,r,a,l=g_pog_json[n].ModuleInfo,s=g_notch_label_position.toUpperCase(),d={};void 0===g_undoRedoAction&&(g_undoRedoAction="REDO"),i="REDO"==g_undoRedoAction?"U":"R";var _,g=0;if("Y"==e)for(const e of l){if((void 0===e.ParentModule||null==e.ParentModule)&&e.NotchW>0){var f=e.ShelfInfo,p=0;for(const t of f){if("BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&"TEXTBOX"!==t.ObjType){var c=g_scene_objects[n].scene.children[2].getObjectById(t.SObjID);if(void 0!==t.NotchLabelObjID&&-1!==t.NotchLabelObjID){var I=c.getObjectById(t.NotchLabelObjID);c.remove(I)}var m=get_notch_no(e,n,t.Y+t.H/2);t.NotchNo=m;var h,u=t.Color;if(null==hexToRgb(u))var S=parseInt("FF",16),D=parseInt("FF",16),b=parseInt("FF",16);else S=hexToRgb(u).r,D=hexToRgb(u).r,b=hexToRgb(u).g;h="CENTER"==s?getTextColor(S,D,b):"#000000";var v=addlabelText(o+" "+m,g_labelFont,g_labelActualSize,h,"center","");c.add(v),0!==t.Rotation||0!==t.Slope?v.position.z=t.D/2+.005:v.position.z=.005,[r,a]=getLabelPosition(t,"S",s),v.position.x=r,v.position.y=a,g_pog_json[n].ModuleInfo[g].ShelfInfo[p].NotchLabelObjID=v.id}p+=1}}g+=1}else for(const e of l){if(void 0===e.ParentModule||null==e.ParentModule){f=e.ShelfInfo,p=0;for(const e of f){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){c=g_scene_objects[n].scene.children[2].getObjectById(e.SObjID);if(void 0!==e.NotchLabelObjID&&-1!==e.NotchLabelObjID){I=c.getObjectById(e.NotchLabelObjID);c.remove(I)}g_pog_json[n].ModuleInfo[g].ShelfInfo[p].NotchLabelObjID=-1}p+=1}}g+=1}_="Y"==e?"N":"Y",d.show_notch_labels=_,g_undo_details=[],"Y"==t&&g_undo_details.push(d),"Y"==t&&("U"==i?(g_delete_details.multi_delete_shelf_ind="N",g_undo_all_obj_arr=[],"Y"==t&&g_undo_all_obj_arr.push(g_undo_details),"Y"==t&&g_undo_all_obj_arr.push(g_cut_copy_arr),g_undo_all_obj_arr.previousAction="NOTCH_LABEL",g_cut_support_obj_arr.length>0?g_undo_all_obj_arr.hasSupportArr="Y":g_undo_all_obj_arr.hasSupportArr="N",g_undo_all_obj_arr.g_MultiObjects="N",g_undo_all_obj_arr.multi_delete_shelf_ind="N",g_undo_final_obj_arr.push(g_undo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]):(g_delete_details.multi_delete_shelf_ind="N",(g_redo_all_obj_arr=[]).push(g_undo_details),g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.previousAction="NOTCH_LABEL",g_cut_support_obj_arr.length>0?g_redo_all_obj_arr.hasSupportArr="Y":g_redo_all_obj_arr.hasSupportArr="N",g_redo_all_obj_arr.g_MultiObjects="N",g_redo_all_obj_arr.multi_delete_shelf_ind="N",g_redo_final_obj_arr.push(g_redo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[])),render(n),logDebug("function : show_notch_labels","E")}catch(e){error_handling(e)}}function addlabelText(e,o,t,n,i,r){try{logDebug("function : addlabelText; text : "+e+"; textHeight : "+o+"; actualFontSize : "+t+"; font_color : "+n+"; txt_align : "+i+"; back_color : "+r,"S");var a=document.createElement("canvas"),l=a.getContext("2d");l.fillStyle="#000000";l.measureText(e).width;var[s,d]=get_visible_text_dim(e,o);a.width=s,a.height=d,l.font="normal "+o+"px Arial",l.textAlign=i,l.textBaseline="middle",""!==r&&(l.fillStyle=r,l.fillRect(0,0,a.width,a.height)),l.fillStyle=n,l.fillText(e,s/2,d/2);let f=new THREE.CanvasTexture(a);f.minFilter=THREE.LinearFilter;var _=new THREE.SpriteMaterial({map:f});_.map.minFilter=THREE.LinearFilter;var g=new THREE.Sprite(_);return g.scale.set(s/d*t,t,1),logDebug("function : addlabelText","E"),g.uuid=e,g}catch(e){error_handling(e)}}async function clearThree(e){for(;e.children.length>0;)clearThree(e.children[0]),e.remove(e.children[0]);e.geometry&&e.geometry.dispose(),e.material&&(Object.keys(e.material).forEach((o=>{e.material[o]&&null!==e.material[o]&&"function"==typeof e.material[o].dispose&&e.material[o].dispose()})),e.material.dispose()),e.texture&&e.texture.dispose(),e.map&&e.map.dispose()}async function init_pdf(e,o,t,n="N",i="Y"){try{logDebug("function : init_pdf","S"),void 0!==g_scene_pdf&&await clearThree(g_scene_pdf),null!=g_renderer_pdf&&""!==g_renderer_pdf&&(g_renderer_pdf.forceContextLoss(),g_renderer_pdf.dispose()),g_scene_pdf={},g_camera_pdf={},g_new_canvas=document.createElement("canvas"),w=e,h=o,scale=t,g_new_canvas.width=w*scale,g_new_canvas.height=h*scale,g_renderer_pdf=new THREE.WebGLRenderer({canvas:g_new_canvas}),"Y"==i&&(g_renderer_pdf.domElement.style.imageRendering="pixelated"),g_renderer_pdf.domElement.style.width=w*scale+"px",g_renderer_pdf.domElement.style.height=h*scale+"px",g_scene_pdf=new THREE.Scene,(g_camera_pdf=new THREE.PerspectiveCamera(25,g_new_canvas.width/g_new_canvas.height,.1,700)).lookAt(new THREE.Vector3(0,0,0)),"Y"==i?g_renderer_pdf.setPixelRatio(1):g_renderer_pdf.setPixelRatio(window.devicePixelRatio),g_camera_pdf.add(new THREE.PointLight(14473689,.1)),g_scene_pdf.add(g_camera_pdf),g_renderer_pdf.setClearColor(16777215),g_renderer_pdf.setSize(g_new_canvas.width,g_new_canvas.height);var r=new THREE.DirectionalLight(16777215,1);r.position.set(-1,2,4).normalize(),g_scene_pdf.add(r),g_camera_pdf.aspect=g_new_canvas.width/g_new_canvas.height,g_camera_pdf.updateProjectionMatrix(),"Y"==n&&(g_world_pdf=new THREE.Object3D,g_scene_pdf.add(g_world_pdf),g_renderer_pdf.render(g_scene_pdf,g_camera_pdf)),logDebug("function : init_pdf","E")}catch(e){error_handling(e)}}async function create_scene(e,o,t,n,i,r,a,l=0,s){logDebug("function : create_scene; p_module_index : "+e+"; new_item_label : "+o,"S");try{if(void 0===g_pog_json[s].ModuleInfo[e].ParentModule||null==g_pog_json[s].ModuleInfo[e].ParentModule){if(g_pog_json[s].BaseH>0){var d=parseInt(g_pog_json[s].ModuleInfo[e].Color.replace("#","0x"),16),_=new THREE.Color(d),g=new THREE.Mesh(new THREE.BoxGeometry(g_pog_json[s].ModuleInfo[e].W+l,g_pog_json[s].BaseH,.001),new THREE.MeshStandardMaterial({color:_}));add_wireframe(g,2);g.position.x=(g_pog_json[s].ModuleInfo[e].W+l)/2,g.position.y=g_pog_json[s].BaseH/2,g.position.z=0,g_scene_pdf.add(g);var f=g_pog_json[s].ModuleInfo[e].H/2+g_pog_json[s].BaseH}else f=g_pog_json[s].ModuleInfo[e].H/2;var p=(g_world=g_scene_objects[s].scene.children[2]).getObjectById(g_pog_json[s].ModuleInfo[e].MObjID),c=g_pog_json[s].ModuleInfo[e].W/2,I=p.clone(!0);if(I.material=p.material.clone(!0),g_scene_pdf.add(I),I.position.set(c,f,0),g_pog_json[s].ModuleInfo[e].ShelfInfo.length>0){j=0;for(const t of g_pog_json[s].ModuleInfo[e].ShelfInfo){if("BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&"Y"!==t.SplitChest){var m=g_world.getObjectById(t.SObjID),h=-1,u="N";if("TEXTBOX"==t.ObjType){if(t.W<g_pog_json[s].W&&n>1||1==n){(S=new THREE.Mesh(m.geometry,m.material)).material.transparent=!1;add_wireframe(S,12);0===t.Rotation&&0===t.Slope||(t.Slope>0?slope=0-t.Slope:slope=-t.Slope,S.rotateY(t.Rotation*Math.PI/180),0==t.Rotation?S.rotateX(slope/2*Math.PI/180):S.rotateX(slope*Math.PI/180)),u="Y",h=t.X-(g_pog_json[s].ModuleInfo[e].X-g_pog_json[s].ModuleInfo[e].W/2),void 0!==t.MergeTextbox&&"Y"==t.MergeTextbox&&(h=c)}}else if("CHEST"==t.ObjType&&"Y"==g_pogcr_pdf_chest_split){add_wireframe(S=new THREE.Mesh(new THREE.BoxGeometry(t.W,t.H,1e-4),new THREE.MeshStandardMaterial({color:t.Color})),2);S.material=m.material.clone(!0),h=t.X-(g_pog_json[s].ModuleInfo[e].X-g_pog_json[s].ModuleInfo[e].W/2),u="Y"}else{var S=m.clone(!0);h=t.X-(g_pog_json[s].ModuleInfo[e].X-g_pog_json[s].ModuleInfo[e].W/2),S.material=m.material.clone(!0);add_wireframe(S,4);u="Y"}if("Y"==u){g_scene_pdf.add(S);var D=h-t.W/2;g_scene_pdf.updateMatrixWorld();var b=0;b="TEXTBOX"==t.ObjType?g_world.getObjectById(t.SObjID).position.z:"PEGBOARD"==t.ObjType?.003:isShelfOnPegboard(t.X,t.Y,e,s,t,g_pog_json)?.005:g_world.getObjectById(t.SObjID).position.z,S.position.set(h,t.Y,b)}k=0,update_item_distance(e,j,s,"N");for(const n of t.ItemInfo){if(void 0!==(w=g_world.getObjectById(n.ObjID))){var v=new THREE.Mesh(w.geometry,w.material);for(const e of w.children){if("wireframe"!==e.uuid)(T=e.clone(!0)).uuid=e.uuid,"facings"==T.uuid?y=.001:"cap"==T.uuid?y-=1e-4:y="ITEM_DESC"==T.uuid?6e-4:e.position.z,T.position.z=y,v.add(T)}if(g_scene_pdf.updateMatrixWorld(),v.updateMatrixWorld(),0!==t.Rotation||0!==t.Slope){var x=n.RotationX,O=n.RotationY,C=n.RotationZ,M=new THREE.Vector3(x,O,C).applyMatrix4(S.matrixWorld);v.position.x=M.x,v.position.y=M.y,v.position.z=M.z,v.quaternion.copy(S.quaternion),v.updateMatrix()}else{if("PEGBOARD"==t.ObjType)var y=.016;else if(isShelfOnPegboard(t.X,t.Y,e,s,t,g_pog_json))y=.005+t.D/1e3;else y=.001+t.D/1e3;var H=-1;H="BASKET"==t.ObjType&&"BT"==t.BsktSpreadProduct?D+n.W/2:D+n.Distance+n.W/2,v.position.set(H,n.Y,y)}g_scene_pdf.add(v);add_wireframe(v,4);if(add_item_borders(e,j,k,v,n.W,n.H,n.BHoriz,s,"N"),"Y"==o)update_item_label(e,j,k,v,"Y",r,a,s,"N")}k+=1}}j+=1}}if(0!==nvl(g_pog_json[s].ModuleInfo[e].ChestInfo)&&g_pog_json[s].ModuleInfo[e].ChestInfo.length>0){j=0;for(const t of g_pog_json[s].ModuleInfo[e].ChestInfo){m=g_world.getObjectById(t.SObjID),h=-1,u="N";if("CHEST"==t.ObjType&&"Y"==g_pogcr_pdf_chest_split){add_wireframe(S=new THREE.Mesh(new THREE.BoxGeometry(t.W,t.H,1e-4),new THREE.MeshStandardMaterial({color:t.Color})),2);S.material=m.material.clone(!0),h=t.X-(g_pog_json[s].ModuleInfo[e].X-g_pog_json[s].ModuleInfo[e].W/2),u="Y"}if("Y"==u){g_scene_pdf.add(S);D=h-t.W/2;g_scene_pdf.updateMatrixWorld();b=0;b=5e-4,S.position.set(h,t.Y,b)}k=0,update_item_distance(e,j,s,"Y");for(const n of t.ItemInfo){var w;if(void 0!==(w=g_world.getObjectById(n.ObjID))){v=new THREE.Mesh(w.geometry,w.material);for(const e of w.children){var T;if("wireframe"!==e.uuid)(T=e.clone(!0)).uuid=e.uuid,"facings"==T.uuid?y=.001:"cap"==T.uuid?y-=1e-4:y="ITEM_DESC"==T.uuid?6e-4:e.position.z,T.position.z=y,v.add(T)}if(g_scene_pdf.updateMatrixWorld(),v.updateMatrixWorld(),0!==t.Rotation||0!==t.Slope){x=n.RotationX,O=n.RotationY,C=n.RotationZ,M=new THREE.Vector3(x,O,C).applyMatrix4(S.matrixWorld);v.position.x=M.x,v.position.y=M.y,v.position.z=M.z,v.quaternion.copy(S.quaternion),v.updateMatrix()}else{y=.001+t.D/1e3,H=-1;H=D+n.Distance+n.W/2,v.position.set(H,n.Y,y)}g_scene_pdf.add(v);add_wireframe(v,4);if(add_item_borders(e,j,k,v,n.W,n.H,n.BHoriz,s,"Y"),"Y"==o)update_item_label(e,j,k,v,"Y",r,a,s,"Y")}k+=1}j+=1}}null!==g_renderer_pdf&&animate_pog_pdf()}return logDebug("function : create_scene","E"),"success"}catch(e){throw error_handling(e),e}}async function merge_textboxes_pdf(e,o){try{var t=-1;for(const n of e[o].ModuleInfo)if(void 0===n.ParentModule||null==n.ParentModule)for(const e of n.ShelfInfo)"TEXTBOX"==e.ObjType&&(t=Math.max(t,e.Y));l_cnt=0,l_index_arr=[];var n=0;for(const n of e[o].ModuleInfo)if(void 0===n.ParentModule||null==n.ParentModule){var i=0;for(const r of n.ShelfInfo)"TEXTBOX"==r.ObjType&&r.W>n.W&&r.W<e[o].W&&r.Y>=t&&(l_cnt++,l_index_arr.push(i)),i++}if(l_cnt>1){n=0;for(const d of e[o].ModuleInfo){if(void 0===d.ParentModule||null==d.ParentModule){i=0;var r="N";for(const _ of e[o].ModuleInfo){if("Y"==r){r="N";break}if((void 0===_.ParentModule||null==_.ParentModule)&&n!==i){var a=0;for(const i of _.ShelfInfo){if("TEXTBOX"==i.ObjType){var l=i.X-i.W/2,s=i.X+i.W/2;if(d.X-d.W/2+d.W/3>=l&&d.X+d.W/2<=s&&i.Y>=t){i.MergeTextbox="Y",e[o].ModuleInfo[n].ShelfInfo.push(i),r="Y";break}}a++}}i++}}n++}n=0;for(const i of e[o].ModuleInfo){if(void 0===i.ParentModule||null==i.ParentModule){var d=i.X-i.W/2,_=i.X+i.W/2;a=0;for(const r of i.ShelfInfo){if("TEXTBOX"==r.ObjType){l=r.X-r.W/2,s=r.X+r.W/2;(l>d&&l>=_||l<d&&s<=d)&&r.Y>=t&&e[o].ModuleInfo[n].ShelfInfo.splice(a,1)}a++}}n++}}return e}catch(e){throw error_handling(e),e}}function getCanvasBlob(e){return new Promise((function(o,t){e.toBlob((function(e){o(e)}),"image/jpeg",.5)}))}function blobToBase64(e){return new Promise(((o,t)=>{const n=new FileReader;n.onloadend=()=>o(n.result),n.readAsDataURL(e)}))}function send_to_db(e,o){return logDebug("function : send_to_db; pog_code : "+e,"S"),new Promise((function(t,n){apex.server.process("SAVE_MODULE_IMG",{x01:e,p_clob_01:JSON.stringify(o)},{dataType:"html"}).done((function(e){logDebug("function : send_to_db","E"),t("success")}))}))}async function create_pdf(e,o,t,n,i,r,a,l,s,d="Y",_,g,f,p,c,I,m,h,u,S,D="N",b="",v,x="Y",O,C,j,M,y,H,w,T,F,N,E,B,W,R,P,Y,A,k,z,X,L,V,G,U,Z,$){try{logDebug("function : create_pdf; p_pog_details : "+e+"; save_pdf : "+o+"; save_pog : "+t,"S"),"Y"==d&&reset_zoom(_);var J=e.TemplateDetails.split("-"),Q="N",q="N";if(x=(x||"").trim()||"Y","Y"==J[1]&&"N"==g_show_notch_label||"Y"==J[1]&&"Y"==g_show_notch_label||"N"==J[1]&&"Y"==g_show_notch_label?show_notch_labels("Y",s,"Y",_):"N"==J[1]&&show_notch_labels("N",s,"Y",_),"Y"==J[2]&&"N"==g_show_fixel_label||"Y"==J[2]&&"Y"==g_show_fixel_label||"N"==J[2]&&"Y"==g_show_fixel_label?show_fixel_labels("Y",_):"N"==J[2]&&show_fixel_labels("N",_),add_merch("Y",_),add_merch("N",_),"Y"==J[6]&&"N"==g_show_item_desc&&"Y"==x){if("Y"==g_show_live_image){await recreate_image_items("N",p,c,I,m,h,u,S,s,_,"N","",v);Q="N"}await showHideItemDescription("Y",r,l,_)}else if("N"==J[6]&&"Y"==g_show_item_desc&&"Y"==x)await showHideItemDescription("N",r,l,_);var K=g_show_fixel_label,ee=g_show_notch_label,oe=g_show_item_label,te=g_show_item_desc;if("Y"!=o&&"N"!==g_show_live_image||"Y"!==J[7]||"N"!==J[6]||"Y"!==x)if("Y"==g_show_live_image&&"N"==J[7]&&"Y"==x){await recreate_image_items("N",p,c,I,m,h,u,S,s,_,"N","",v);Q="N"}else"Y"==g_show_days_of_supply&&"N"==J[12]&&"Y"==g_show_live_image?(await showHideDaysOfSupplyLabel("Y","N",_,"Y","N","",v),Q=g_show_live_image):"Y"==g_show_days_of_supply&&"Y"==J[12]?(await showHideDaysOfSupplyLabel("N","N",_,"Y","N","",v),Q=g_show_live_image):Q=g_show_live_image;else{await recreate_image_items("Y",p,c,I,m,h,u,S,s,_,"N","",v);Q="Y"}""!==g_sublabel_type&&showItemSubLabel(g_sublabel_type,"Y",m,h,_),animate_pog(_),old_live_iamge="N"==g_show_item_desc?g_show_live_image:"N","Y"==J[3]&&"N"==g_show_item_label?(q="Y",show_item_labels("Y",r,a,_)):"N"==J[3]&&(q="N",show_item_labels("N",r,a,_)),await timeout(200);await set_scene(e,o,ee,K,oe,J[4],t,J[5],q,J[6],i,te,old_live_iamge,Q,_,g,D,b,J[9],J[1],J[2],J[3],O,C,j,r,a,I,p,s,c,l,S,M,y,H,w,T,F,N,E,B,W,R,P,Y,A,k,z,X,L,V,G,U,Z,$);return"SUCCESS"}catch(e){throw error_handling(e),e}}async function set_scene(e,o,t,n,i,r,a,l,s,d,_,g,f,p,c,I,m="N",h="",u,S,D,b,v,x,O,C,j,M,y,H,w,T,F,N,E,B,W,R,P,Y,A,k,z,X,L,V,G,U,Z,$,J,Q,q,K,ee,oe){logDebug("function : set_scene; p_pog_details : "+e+"; save_pdf : "+o+"; notch_label : "+t+"; fixel_label : "+n+"; item_label : "+i+"; pdf_lang : "+r+"; save_pog : "+a+"; mime_type : "+l+"; new_item_label : "+s,"S");var te=[];render(c);var ne=0,ie=.5;if("Y"==v&&(ie=parseFloat(x)),void 0!==u)var re=u.split("###");else re=[];reset_zoom();var ae=[];if("N"==oe&&set_pegid(c),"xlsx"==l)await save_pog_to_json([g_pog_json[c]]);var le=JSON.parse(JSON.stringify(g_pog_json));if(await get_chest_split_details(g_pogcr_pdf_chest_split,c),ae=JSON.parse(JSON.stringify(g_pog_json)),"Y"==g_textbox_merge_pdf)ae=await merge_textboxes_pdf(ae,c);var se=0,de=0;for(const e of ae[c].ModuleInfo)void 0!==e.ParentModule&&null!=e.ParentModule||de++;se=0;for(const e of ae[c].ModuleInfo){if(void 0===e.ParentModule||null==e.ParentModule){var _e=O.split(":");await init_pdf(parseInt(_e[0]),parseInt(_e[1]),3+(.5==ie?0:3*ie),"N","Y");try{!1;var ge=0;ne=0;if(!e.Module.includes(g_nodataModuleName)){var fe=ae[c].ModuleInfo[se].W;for(var pe of ae[c].ModuleInfo){if(e.Module,ge>se&&0==nvl(pe.ParentModule)&&pe.Module.includes(g_nodataModuleName)){var ce=g_world.getObjectById(pe.MObjID),Ie=pe.H/2+g_pog_json[c].BaseH;ne=ne+pe.W+.01,fe=fe+pe.W/2+.01;var me=ce.clone(!0);me.material=ce.material.clone(!0),g_scene_pdf.add(me),me.position.set(fe,Ie,0),fe+=pe.W/2,g_scene_pdf.updateMatrixWorld()}ge++}}await create_scene(se,s,d,de,p,C,j,ne,c)}catch(e){error_handling(e)}var he=get_min_max_xy_module(e,se,e.W+ne,e.H,e.X+ne,ae[c].W,de).split("###"),[ue,Se]=set_camera_z_offside(g_camera_pdf,parseFloat(he[2]),parseFloat(he[3]),parseFloat(he[0]),parseFloat(he[1]),g_offset_z,0,parseFloat(he[5]),!0,c);if(g_camera_pdf.position.x=parseFloat(he[2]),g_camera_pdf.position.y=parseFloat(he[3]),g_camera_pdf.position.z=ue,null!==g_renderer_pdf&&(animate_pog_pdf(),g_renderer_pdf.render(g_scene_pdf,g_camera_pdf)),!e.Module.includes(g_nodataModuleName)){var De=await g_new_canvas.toDataURL("image/jpeg",ie),be={};be.Module=e.Module,be.MIndex=se,be.Bay=(100*e.W).toFixed(2),be.TotalBay=(100*e.H).toFixed(2)+"*"+(100*e.W).toFixed(2),be.ImgData=De.match(/,(.*)$/)[1],te.push(be)}}se++}var ve=0;for(const r of te){const a="data:image/jpeg;base64,"+r.ImgData;console.log(a);const l=new Image;l.src=a,await new Promise((a=>l.onload=async function(){const s=document.createElement("canvas");s.width=l.width,s.height=l.height;if(s.getContext("2d").drawImage(l,0,0),"Y"==re[4]){var[u,v]=cropCanvasToContent(s);ae[c].ModuleInfo[r.MIndex].ScaleToFit=v,0==ve&&(ae[c].PageBreakInit="Y"==v?"Y":"N");var x=u.toDataURL("image/jpeg",ie)}else{var[O,v]=cropCanvasToContent(s);ae[c].ModuleInfo[r.MIndex].ScaleToFit=v;var u;x=(u=cropCanvasToContent_old(s)).toDataURL("image/jpeg",ie)}if(te[ve].ImgData=x.match(/,(.*)$/)[1],++ve==te.length){te.length>0&&(await send_to_db(g_pog_json[c].POGCode,te),te=[]);for(const e of ae[c].ModuleInfo)if(void 0===e.ParentModule||null==e.ParentModule)for(const o of e.ShelfInfo)if("TEXTBOX"==o.ObjType){var ne=g_scene_objects[c].scene.children[2].getObjectById(o.SObjID);void 0!==ne&&(ne.material.transparent=!0)}g_pog_json=le;var se=[];if("Y"==re[3]){var de=0;for(const e of g_pog_json[c].ModuleInfo)void 0!==e.ParentModule&&null!=e.ParentModule||de++;var _e=0;_e=de<=5?de:parseInt(de/2),se=await create_combine_pog(_e,g_show_live_image,"N",N,E,B,W,parseFloat(R),parseFloat(P),parseFloat(Y),parseFloat(A),k,z,parseInt(X),L,V,G,U,Z,$,J,F,y,w,M,C,T,j,H,Q,q,c,S,D,b,ie,C,j,C,T,re[3]);for(const e of se)te.push(e)}else if("Y"==re[0]){if("Y"==re[1]){se=await create_combine_pog(K,"Y","N",N,E,B,W,parseFloat(R),parseFloat(P),parseFloat(Y),parseFloat(A),k,z,parseInt(X),L,V,G,U,Z,$,J,F,y,w,M,C,T,j,H,Q,q,c,S,D,b,ie,C,j,C,T);for(const e of se)te.push(e)}if("N"!==re[2]){se=await create_combine_pog(ee,"N",re[2],N,E,B,W,parseFloat(R),parseFloat(P),parseFloat(Y),parseFloat(A),k,z,parseInt(X),L,V,G,U,Z,$,J,F,y,w,M,C,T,j,H,Q,q,c,S,D,b,ie,C,j,C,T);for(const e of se)te.push(e);p="N",g="N"}}else{var ge=(await get_full_canvas(c,3)).toDataURL("image/jpeg",.9),fe={Module:"POG"};fe.ImgData=ge.match(/,(.*)$/)[1],te.push(fe)}ve=0;for(const r of te){const a="data:image/jpeg;base64,"+r.ImgData;console.log(a);const l=new Image;l.src=a,l.onload=async function(){const r=document.createElement("canvas");r.width=l.width,r.height=l.height;if(r.getContext("2d").drawImage(l,0,0),"Y"==re[3])if("Y"==re[4])var[a,s]=cropCanvasToContent(r),u=a.toDataURL("image/jpeg",ie);else u=(a=cropCanvasToContent_old(r)).toDataURL("image/jpeg",ie);else{var a=cropCanvasToContent_old(r);u=r.toDataURL("image/jpeg",ie)}if(te[ve].ImgData=u.match(/,(.*)$/)[1],++ve==te.length){"Y"!=re[3]&&"Y"!=re[0]||(animate_pog_pdf(),render(c));await send_to_db(ae[c].POGCode,te);"N"==oe?await uploadImage(0):set_pegid(ae,c),await create_item_compare(e.POGCode,e.POGVersion);var S="";if(S=ae[c].Version,"Y"==oe)apex.server.process("DOWNLOAD_PDF",{x01:e.SeqNo,x02:e.POGCode,x03:e.POGVersion,x04:e.Selection_Type,x05:e.Print_Type,x06:e.TemplateId,x07:e.SequenceId,x08:"Y",x09:"",p_clob_01:JSON.stringify(ae)},{dataType:"html"}).done((function(e){return console.log(" download_pdf end",getDateTime()),g_req_count++,removeLoadingIndicator(regionloadWait),"success"})),console.log("after download pdf");else apex.server.process("DOWNLOAD_PDF",{x01:e.SeqNo,x02:ae[c].POGCode,x03:S,x04:e.Selection_Type,x05:"P",x06:e.TemplateId,x07:"Y"==m?h:"",x08:o,x09:_,x10:$v("P25_EXISTING_DRAFT_VER"),x11:$v("P25_DEFAULT_LIVE_VERSION"),x12:$v("P25_PREV_PDF_POG_VERSION"),p_clob_01:JSON.stringify(ae[c])},{dataType:"html"}).done((function(e){g_show_fixel_label="Y"==n?"Y":"N",g_show_item_label="Y"==i?"Y":"N",g_show_notch_label="Y"==t?"Y":"N",g_show_item_desc="Y"==g?"Y":"N",null==S&&(S="");var o="f?p="+$v("pFlowId")+":"+$v("pFlowStepId")+":"+$v("pInstance")+":APPLICATION_PROCESS=OPEN_PDF:NO::AI_RANDOM_STRING,P25_OPEN_POG_CODE,P25_OPEN_POG_VERSION:"+(new Date).getTime()+","+ae[c].POGCode+","+S;try{"undefined"!=typeof regionloadWait&&"function"==typeof regionloadWait.remove&&removeLoadingIndicator(regionloadWait)}catch{console.log("no loading")}logDebug("function : Download PDF","E"),"N"==g_all_pog_flag&&window.open(o,"new data"),async function(){if("N"==f&&"Y"==p&&"N"!=I)await recreate_image_items("N",y,w,M,C,j,T,F,H,c,g_show_days_of_supply,"",g_hide_show_dos_label);else if("Y"==f&&"N"==p&&"N"!=I)await recreate_image_items("Y",y,w,M,C,j,T,F,H,c,g_show_days_of_supply,"",g_hide_show_dos_label);if("Y"==d&&"N"==g)await showHideItemDescription("N",C,T,c);else if("N"==d&&"Y"==g)await showHideItemDescription("Y",C,T,c);"Y"==g_show_notch_label?await show_notch_labels("Y",H,"Y",c):await show_notch_labels("N",H,"Y",c),"Y"==g_show_fixel_label?await show_fixel_labels("Y",c):await show_fixel_labels("N",c),"Y"==g_show_item_label?await show_item_labels("Y",C,j,c):await show_item_labels("N",C,j,c),await showItemSubLabel(g_itemSubLabel,g_itemSubLabelInd,C,j,c)}()}))}}}}a()}))}logDebug("function : set_scene","E")}function cropCanvasToContent_old(e){const o=e.getContext("2d"),t=e.width,n=e.height,i=o.getImageData(0,0,t,n).data;let r=null,a=null,l=null,s=null;for(let e=0;e<n;e++)for(let o=0;o<t;o++){const n=4*(e*t+o);255!==i[n]&&255!==i[n+1]&&255!==i[n+2]&&(null===r&&(r=e),a=e,(null===l||o<l)&&(l=o),(null===s||o>s)&&(s=o))}if(null===r)return e;const d=s-l+1;var _=s-l+40,g=a-r+40,f=t-_,p=n-g;const c=document.createElement("canvas");f>=p?(_=f=t-p,c.width=f,c.height=g):(g=p=n-f,_=s+40,c.width=_,c.height=p);const I=(c.width-d)/2,m=c.getContext("2d");return m.fillStyle="white",m.fillRect(0,0,_,g),m.drawImage(e,l,r,_,g,I,40,_,g),c}function cropCanvasToContent(e){const o=e.getContext("2d"),t=e.width,n=e.height,i=o.getImageData(0,0,t,n).data;let r=null,a=null,l=null,s=null;for(let e=0;e<n;e++)for(let o=0;o<t;o++){const n=4*(e*t+o);255===i[n]&&255===i[n+1]&&255===i[n+2]||(null===r&&(r=e),a=e,(null===l||o<l)&&(l=o),(null===s||o>s)&&(s=o))}if(null===r)return e;const d=s-l+1,_=a-r+1,g=parseFloat((_/d).toFixed(1))>=1.2?"Y":"N";let f=d,p=_;const c=Math.floor((f-d)/2),I=Math.floor((p-_)/2),m=document.createElement("canvas");m.width=f,m.height=p;const h=m.getContext("2d");return h.fillStyle="white",h.fillRect(0,0,f,p),h.drawImage(e,l,r,d,_,c,I,d,_),[m,g]}async function create_item_compare(e,o){var t=g_pog_json[g_pog_index].DraftVersion;$s("P25_DRAFT_VERSION",t);var n=null==t||""===t?"N":"Y";apex.server.process("CREATE_COMPARE_ITEM_COLL",{x01:e,x02:o,x03:g_pdf_online_clck,x04:n},{dataType:"html"})}async function create_combine_pog(e,o,t,n,i,r,a,l,s,d,_,g,f,p,c,I,m,h,u,S,D,b,v,x,O,C,j,M,y,H,w,T,F,N,E,B,W,R,P,Y,A="N"){try{var k=g_show_live_image,z=g_show_item_desc,X=[],L=0,V=0,G=0,U=[],Z=0,$=0,J=0,Q="",q=0;if("Y"==t||"IDVURPCO"==t||"IFEC"==t){await recreate_image_items("N",v,x,O,C,M,j,b,y,T,"N","N,0.018",[]);await showHideItemDescription("Y",P,Y,T);render(T)}else"N"==g_show_live_image&&"Y"==o&&await recreate_image_items("Y",v,x,O,C,M,j,b,y,T,"N","N,0.018",[]);g_world=g_scene_objects[T].scene.children[2],animate_pog(T);var K=JSON.parse(JSON.stringify(g_pog_json)),ee=JSON.parse(JSON.stringify(g_pog_json)),oe=JSON.parse(JSON.stringify([g_pog_json[T]]));console.log("old_pogjson[0].ModuleInfo",ee[0].ModuleInfo),"Y"==o?(g_show_live_image="Y",g_show_item_desc="N"):"Y"!=t&&"IDVURPCO"!=t&&"IFEC"!=t||(g_temp_desc="IDVURPCO"==t||"IFEC"==t?t:"N",g_show_live_image="N",g_show_item_desc="Y"),g_show_notch_label="Y"==F?"Y":"N",g_show_fixel_label="Y"==N?"Y":"N",g_show_item_label="Y"==E?"Y":"N";var te=[],ne=0;for(const e of ee[T].ModuleInfo){if((void 0===e.ParentModule||null==e.ParentModule)&&(q++,Z+=e.W,$=Math.max($,e.H),J=Math.max(J,e.D),"Y"==g_pogcr_pdf_chest_split)){var ie=0,re=wpdSetFixed(e.X-e.W/2),ae=wpdSetFixed(e.X+e.W/2);for(const o of e.ShelfInfo){if("CHEST"==o.ObjType){var le=wpdSetFixed(o.X-o.W/2),se=wpdSetFixed(o.X+o.W/2);(re>le&&ae<se||re>=le&&ae<se||re<le&&ae<se&&ae>le||re>le&&ae>se&&re<se)&&(o.MIndex=ne,o.SIndex=ie,te.push(o),oe[0].ModuleInfo[ne].ShelfInfo.splice(ie,1),g_pog_json[T].ModuleInfo[ne].ShelfInfo.splice(ie,1))}ie++}}ne++}if("Y"==g_pogcr_pdf_chest_split){for(chest of te){var de="N",_e=wpdSetFixed(chest.X-chest.W/2),ge=wpdSetFixed(chest.X+chest.W/2),fe=chest.ItemInfo,pe=0;for(const e of oe[0].ModuleInfo){if(void 0===e.ParentModule||null==e.ParentModule){var ce=wpdSetFixed(e.X-e.W/2),Ie=wpdSetFixed(e.X+e.W/2),me=JSON.parse(JSON.stringify(chest));ce>=_e&&Ie<=ge?(de="Y",me.W=e.W,me.X=e.X):ce<=_e&&Ie<=ge&&Ie>_e?(de="Y",me.W=wpdSetFixed(Ie-_e),me.X=wpdSetFixed(_e+me.W/2)):ce>=_e&&Ie>=ge&&ce<ge&&(de="Y",me.W=wpdSetFixed(ge-ce),me.X=wpdSetFixed(ce+me.W/2));var he=[],ue=wpdSetFixed(me.X-me.W/2),Se=wpdSetFixed(me.X+me.W/2);for(items of(module_no=chest.MIndex+1,fe))items.X>=ue&&items.X<=Se&&(items.ModuleNo=module_no,he.push(items));"Y"==de&&(me.ItemInfo=he,oe[0].ModuleInfo[pe].ShelfInfo.push(me),g_pog_json[T].ModuleInfo[pe].ShelfInfo.push(me),de="N")}pe++}0}}var De=0,be=(L=0,0),ve=0;for(const o of oe[0].ModuleInfo){if(void 0===o.ParentModule||null==o.ParentModule){if(o.MIndex=L,X.push(JSON.parse(JSON.stringify(o))),V++,G+=o.W,console.log("next_mod",V,e),V==e||q==be+1){ve++;var xe=0,Oe=0;for(obj_mod of(await init_pdf(window.innerWidth,window.innerHeight,2,"Y","N"),X)){try{g_world=g_scene_objects[T].scene.children[2],console.log("combine loop",g_world);var Ce=await clone_combine_pog(obj_mod.MIndex,xe,g_show_item_label,W,R,T,Oe,G);console.log("returnval",Ce,g_renderer_pdf)}catch(e){throw console.log("error",e),e}Oe+=obj_mod.W,Q="",xe++}await timeout(200);for(const e of X)e.W,Q=""==Q?(100*e.W).toFixed(2):Q+"|"+(100*e.W).toFixed(2);for(const e of g_pog_json[T].ModuleInfo)if(void 0===e.ParentModule||null==e.ParentModule)for(const o of e.ShelfInfo)if("TEXTBOX"==o.ObjType){var je=g_world.getObjectById(o.SObjID);void 0!==je&&(je.material.transparent=!1)}V=0;var Me=[];(ye={}).W=G,ye.H=g_pog_json[T].H,Me.push(ye),Me[0].ModuleInfo=X;Z=0;ve>1&&(Z=De),De+=G,G=0;var ye,He=(ye=get_min_max_xy_combine(Me,Z)).split("###");set_camera_z(g_camera_pdf,parseFloat(He[2]),parseFloat(He[3]),parseFloat(He[0]),parseFloat(He[1]),g_offset_z,parseFloat(He[4]),parseFloat(He[5]),!0,0),console.log("combine g_renderer_pdf",g_renderer_pdf,g_scene_pdf,g_camera_pdf),null!==g_renderer_pdf&&g_renderer_pdf.render(g_scene_pdf,g_camera_pdf),animate_pog_pdf(),console.log("inside",oe,X,g_camera_pdf,g_scene_pdf.children.length,g_scene_pdf),X=[];var we=g_new_canvas.toDataURL("image/jpeg",B);console.log(" after  base64 ",getDateTime());var Te={Module:"COMBINE"};Te.Bay=Q,Q="",Te.ImgData=we.match(/,(.*)$/)[1],U.push(Te),"Y"==A&&q%2!=0&&q<=be+e+2&&(e+=1)}be++}L++}return g_temp_desc="N",g_show_live_image=k,g_show_item_desc=z,g_pog_json=K,render(T),U}catch(e){throw console.log("error",e),error_handling(e),e}}async function clone_combine_pog(e,o,t,n,i,r,a,l){try{if(logDebug("function : create_scene; p_module_index : "+e+"; new_item_label : "+t,"S"),void 0===g_pog_json[r].ModuleInfo[e].ParentModule||null==g_pog_json[r].ModuleInfo[e].ParentModule){var s;if(g_pog_json[r].BaseH>0){var d=parseInt(g_pog_json[r].ModuleInfo[e].Color.replace("#","0x"),16),_=new THREE.Color(d),g=new THREE.Mesh(new THREE.BoxGeometry(l,g_pog_json[r].BaseH,.001),new THREE.MeshStandardMaterial({color:_}));add_wireframe(g,2);g.position.x=l/2,g.position.y=g_pog_json[r].BaseH/2,g.position.z=0,g_scene_pdf.add(g);var f=g_pog_json[r].ModuleInfo[e].H/2+g_pog_json[r].BaseH}else f=g_pog_json[r].ModuleInfo[e].H/2;if(0==o)var p=g_pog_json[r].ModuleInfo[e].W/2;else p=a+g_pog_json[r].ModuleInfo[e].W/2;s=p-g_pog_json[r].ModuleInfo[e].W/2;var c=g_world.getObjectById(g_pog_json[r].ModuleInfo[e].MObjID),I=c.clone(!0);for(objects of(I.material=c.material.clone(!0),g_scene_pdf.add(I),I.position.set(p,f,0),console.log("module ",I,I.children),I.children))console.log("objects",objects.uuid,objects.position);if(g_pog_json[r].ModuleInfo[e].ShelfInfo.length>0){j=0;for(const o of g_pog_json[r].ModuleInfo[e].ShelfInfo){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType){var m=g_world.getObjectById(o.SObjID),h=-1,u="N";if("TEXTBOX"==o.ObjType){(S=new THREE.Mesh(m.geometry,m.material)).material.transparent=!1;add_wireframe(S,12);0===o.Rotation&&0===o.Slope||(o.Slope>0?slope=0-o.Slope:slope=-o.Slope,S.rotateY(o.Rotation*Math.PI/180),0==o.Rotation?S.rotateX(slope/2*Math.PI/180):S.rotateX(slope*Math.PI/180)),u="Y",h=e>0?s+(o.X-(g_pog_json[r].ModuleInfo[e].X-g_pog_json[r].ModuleInfo[e].W/2)):o.X}else if("CHEST"==o.ObjType&&"Y"==g_pogcr_pdf_chest_split){add_wireframe(S=new THREE.Mesh(new THREE.BoxGeometry(o.W,o.H,1e-4),new THREE.MeshStandardMaterial({color:o.Color})),2);S.material=m.material.clone(!0),h=e>0?s+(o.X-(g_pog_json[r].ModuleInfo[e].X-g_pog_json[r].ModuleInfo[e].W/2)):o.X,u="Y"}else{var S=m.clone(!0);h=e>0?s+(o.X-(g_pog_json[r].ModuleInfo[e].X-g_pog_json[r].ModuleInfo[e].W/2)):o.X,S.material=m.material.clone(!0);add_wireframe(S,4);u="Y"}if("Y"==u){g_scene_pdf.add(S);var D=h-o.W/2;g_scene_pdf.updateMatrixWorld();var b=0;b="TEXTBOX"==o.ObjType?g_world.getObjectById(o.SObjID).position.z+.004:"PEGBOARD"==o.ObjType?.003:isShelfOnPegboard(o.X,o.Y,e,r,o,g_pog_json)?.005:5e-4,S.position.set(h,o.Y,b),console.log("new_shelf ",o.ObjType,o.Shelf,S,h,o.Y,b)}k=0,update_item_distance(e,j,r,"N");for(const a of o.ItemInfo){var v=g_world.getObjectById(a.ObjID);if(void 0!==v){var x=new THREE.Mesh(v.geometry,v.material);for(const e of v.children)if("wireframe"!==e.uuid){var O=e.clone(!0);O.uuid=e.uuid,"facings"==O.uuid?w=.001:"cap"==O.uuid?w-=1e-4:w="ITEM_DESC"==O.uuid?b:e.position.z,O.position.z=w,x.add(O)}if(g_scene_pdf.updateMatrixWorld(),x.updateMatrixWorld(),0!==o.Rotation||0!==o.Slope){var C=a.RotationX,M=a.RotationY,y=a.RotationZ,H=new THREE.Vector3(C,M,y).applyMatrix4(S.matrixWorld);x.position.x=H.x,x.position.y=H.y,x.position.z=H.z,x.quaternion.copy(S.quaternion),x.updateMatrix()}else{if("PEGBOARD"==o.ObjType)var w=.016;else w=.005+o.D/1e3;var T=-1;T="BASKET"==o.ObjType&&"BT"==o.BsktSpreadProduct?D+a.W/2:D+a.Distance+a.W/2,x.position.set(T,a.Y,w)}g_scene_pdf.add(x);add_wireframe(x,4);if(add_item_borders(e,j,k,x,a.W,a.H,a.BHoriz,r,"N"),"Y"==t)update_item_label(e,j,k,x,"Y",n,i,r,"N")}k+=1}}j+=1}}null!==g_renderer_pdf&&animate_pog_pdf()}return logDebug("function : create_scene","E"),"success"}catch(e){throw error_handling(e),e}}function show_labels(e,o,t,n){try{var i=g_pog_json[n].ModuleInfo,r=-1,a=-1,l=-1,s=0;try{if("Y"==e||"Y"==o)for(const b of i){if(void 0===b.ParentModule||null==b.ParentModule){var d=b.ShelfInfo,_=0;for(const i of d){if("BASE"!==i.ObjType&&"NOTCH"!==i.ObjType&&"TEXTBOX"!==i.ObjType&&("Y"==o&&"DIVIDER"!==i.ObjType||"Y"==e)){if("DIVIDER"==i.ObjType){var g=g_pog_json[n].ModuleInfo[s].ShelfInfo;$.each(g,(function(e,o){"BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&$.each(o.ItemInfo,(function(o,t){"DIVIDER"==t.Item&&i.ShelfDivObjID==t.ObjID&&(r=s,a=e,l=o)}))}));var f=g_world.getObjectById(i.ShelfDivObjID)}else f=g_world.getObjectById(i.SObjID);var p=0;if(void 0!==f){if(void 0!==i.LObjID&&-1!==i.LObjID&&"Y"==e){var c=f.getObjectById(i.LObjID);f.remove(c)}else if("Y"==o&&void 0!==i.NotchLabelObjID&&-1!==i.NotchLabelObjID){c=f.getObjectById(i.NotchLabelObjID);f.remove(c);for(k=0;k<100;k++){if(i.Y+i.H/2<=g_pog_json[n].BaseH+b.NotchStart){p=0;break}if(i.Y+i.H/2<=g_pog_json[n].BaseH+b.NotchStart+b.NotchSpacing*k){p=k;break}}}var I=i.Color;if(null==hexToRgb(I))var m=parseInt("FF",16),h=parseInt("FF",16),u=parseInt("FF",16);else m=hexToRgb(I).r,h=hexToRgb(I).r,u=hexToRgb(I).g;var S=getTextColor(m,h,u);if("Y"==o&&"DIVIDER"!==i.ObjType)var D=addlabelText(t+" "+p,g_labelFont,g_labelActualSize,S,"center","");else D=addlabelText(i.Shelf,g_labelFont,g_labelActualSize,S,"center","");void 0!==D&&(f.add(D),D.position.y=-.005,0!==i.Rotation||0!==i.Slope?D.position.z=i.D/2+.005:D.position.z=.005,"DIVIDER"==i.ObjType?(D.position.x=0,g_pog_json[n].ModuleInfo[r].ShelfInfo[a].ItemInfo[l].LObjID=D.id,g_pog_json[n].ModuleInfo[s].ShelfInfo[_].LObjID=D.id):"Y"==o?(D.position.x=0-(i.W/4+.01),g_pog_json[n].ModuleInfo[s].ShelfInfo[_].NotchLabelObjID=D.id):(D.position.x=0-(i.W/2.4+.01),g_pog_json[n].ModuleInfo[s].ShelfInfo[_].LObjID=D.id))}}_+=1}}s+=1}else for(const t of i){if(void 0===t.ParentModule||null==t.ParentModule){d=t.ShelfInfo,_=0;for(const t of d){if("BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&("Y"==o&&"DIVIDER"!==t.ObjType||"Y"==e)){if("DIVIDER"==t.ObjType)f=g_world.getObjectById(t.ShelfDivObjID);else f=g_world.getObjectById(t.SObjID);if(void 0!==t.LObjID&&-1!==t.LObjID&&"Y"==e){c=f.getObjectById(t.LObjID);f.remove(c)}else if("Y"==o&&void 0!==t.NotchLabelObjID&&-1!==t.NotchLabelObjID){c=f.getObjectById(t.NotchLabelObjID);f.remove(c)}g_pog_json[n].ModuleInfo[s].ShelfInfo[_].LObjID=-1}_+=1}}s+=1}}catch(e){error_handling(e)}}catch(e){error_handling(e)}}function get_canvas_json(e){try{return logDebug("function : get_canvas_json; loc : "+e,"S"),g_pog_json}catch(e){error_handling(e)}}function get_canvas_world(e){try{return logDebug("function : get_canvas_world; loc : "+e,"S"),g_world}catch(e){error_handling(e)}}function get_curr_canvas(){try{return logDebug("function : get_curr_canvas","S"),1==g_curr_canvas?(logDebug("function : get_curr_canvas","E"),document.getElementById("maincanvas")):(logDebug("function : get_curr_canvas","E"),document.getElementById("maincanvas1"))}catch(e){error_handling(e)}}function get_curr_renderer(){try{return logDebug("function : get_curr_renderer","S"),g_renderer}catch(e){error_handling(e)}}function get_canvas_camera(e){try{return logDebug("function : get_canvas_camera; loc : "+e,"S"),g_camera}catch(e){error_handling(e)}}function check_cookie_name(e,o){try{logDebug("function : check_cookie_name; name : "+e+"; bu_id : "+o,"S");var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?o==t[2].split("$$$")[0]?(logDebug("function : check_cookie_name","E"),t[2].split("$$$")[1]):(document.cookie=e+"=;  max-age=31536000;",logDebug("function : check_cookie_name","E"),""):(logDebug("function : check_cookie_name","E"),"")}catch(e){error_handling(e)}}function chunkString(e,o){logDebug("function : chunkString; len : "+o,"S");const t=Math.ceil(e.length/o),n=Array(t);let i=0;for(let r=0;r<t;r++)n[r]=e.substr(i,o),i+=o;return logDebug("function : chunkString","E"),n}function base64ToBuffer(e){e=window.atob(e);for(var o=new ArrayBuffer(e.length),t=new Uint8Array(o),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return o}function clob2Array(e,o,t){try{logDebug("function : clob2Array; size : "+o,"S"),loopCount=Math.floor(e.length/o)+1;for(var n=0;n<loopCount;n++)t.push(e.slice(o*n,o*(n+1)));return logDebug("function : clob2Array","E"),t}catch(e){error_handling(e)}}function validate_file_type(e){try{logDebug("function : validate_file_type","S");return/(\.pdf|\.xlsx|\.zip)$/i.exec(e)?(logDebug("function : validate_file_type","E"),!0):(alert(get_message("INVALID_FILE_TYPE",e)),!1)}catch(e){error_handling(e)}}function addItemDescription(e,o,t,n,i,r,a,l,s,d,_,g,f,p){try{logDebug("function : addItemDescription; text : "+e+"; textHeight : "+o+"; actualFontSize : "+t+"; font_color : "+n+"; txt_align : "+i+"; back_color : "+r+"; obj_width : "+a+"; obj_height : "+l+"; wrap_text : "+s+"; item_vertical_text_display : "+g+"; item_text_center_align : "+f,"S"),e=e.replace(/\ - $/,"");var c=document.createElement("DIV");c.style.fontFamily="Arial",c.style.fontWeight="normal",c.style.fontSize=o+"pt",c.style.position="absolute",c.style.top="-500px",c.style.left="0",c.innerHTML=e,document.body.appendChild(c);let _={width:c.offsetWidth,height:c.offsetHeight},N=window.getComputedStyle(c,null),E=parseFloat(N.fontSize);document.body.removeChild(c);var I=document.createElement("canvas").getContext("2d").measureText(e);let B=_.height-(I.fontBoundingBoxAscent+I.fontBoundingBoxDescent||0),W={width:I.width,cssHeight:_.height,cssFontSizePx:E,fontAscent:I.fontBoundingBoxAscent||0,fontDescent:I.fontBoundingBoxDescent||0,actualAscent:I.actualBoundingBoxAscent||0,actualDescent:I.actualBoundingBoxDescent||0,lineHeight:_.height,lineGap:B};if("Y"===g){var m=a,h=l,[u,S]=get_visible_size(.012,10*m,10*h,g_canvas,g_camera),D=(y=document.createElement("canvas")).getContext("2d");y.width=u,y.height=S,D.textAlign="left",D.textBaseline="top",r&&(D.fillStyle=r,D.fillRect(0,0,u,S)),D.fillStyle=n||"#000";let t=o;const i=12,s=e.split("");let d=!1;for(;t>i;){D.font=`${t}px Arial`;const e=Math.floor(S/(1.2*t));if(s.length<=e){d=!0;break}t--}let _=1;if(!d)for(_=2;t>i;){D.font=`${t}px Arial`;const e=Math.floor(S/(1.2*t))*_;if(s.length<=e)break;t--}o=t;let g=1*t;D.font=`${o}px Arial`;const c=Math.floor(S/g),I=Math.max(...s.map((e=>D.measureText(e).width)));let O="Y"===f?(u-(_*I+.4*t*(_-1)))/2:0;const C=Math.min(c,s.length)*g,j="Y"===f?(S-C)/2:0;p%2==0&&d&&(O+=I);let M=0,H=0;for(let e=0;e<s.length;e++){const o=s[e],n=O+M*(I+.4*t)+(I-D.measureText(o).width)/2,i=j+H*g;if(D.fillText(o,n,i),H++,H>=c&&(H=0,M++,M>=_))break}var b=new THREE.CanvasTexture(y);b.minFilter=THREE.LinearFilter,b.matrixAutoUpdate=!0,b.needsUpdate=!0,b.isCanvasTexture=!0;var v=new THREE.PlaneGeometry(m,h),x=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:b,transparent:!0,opacity:1});return(F=new THREE.Mesh(v,x)).uuid="ITEM_DESC",F}{var O=d,C=(a-l)/((a+l)/2)*100;if(C<0&&(C=-C),O>0)if(C>O&&l>a){m=l,h=a;var j=10*l,M=10*a}else m=a,h=l,j=10*a,M=10*l;else j=10*(m=a<l?l:a),M=10*(h=a<l?a:l);_.width,parseInt(o);var y,[u,S]=get_visible_size(.012,j,M,g_canvas,g_camera),[H,w]=get_visible_text_dim(e,o);D=(y=document.createElement("canvas")).getContext("2d");y.width=u,y.height=S,D.textAlign=i,D.textBaseline="top",""!==r&&(D.fillStyle=r,D.fillRect(0,0,y.width,y.height)),D.fillStyle=n;var T=W.lineHeight-W.lineGap;fitText(D,e,u/2,0,u,S,o,T);let t=new THREE.CanvasTexture(y);t.minFilter=THREE.LinearFilter,t.matrixAutoUpdate=!0,t.needsUpdate=!0,t.isCanvasTexture=!0;v=new THREE.PlaneGeometry(m,h);(x=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:t,transparent:!0,opacity:1})).map.minFilter=THREE.LinearFilter;var F=new THREE.Mesh(v,x);return C>O&&l>a&&F.rotateOnAxis(new THREE.Vector3(0,0,1),90*Math.PI/180),F.uuid="ITEM_DESC",logDebug("function : addItemDescription","E"),F}}catch(e){error_handling(e)}}function fitText(e,o,t,n,i,r,a,l){try{if(logDebug("function : fitText; text : "+o+"; x : "+t+"; y : "+n+"; width : "+i+"; height : "+r+"; fontSize : "+a+"; lineHeight : "+l,"S"),void 0!==t&&void 0!==n&&void 0!==i&&void 0!==r&&!isNaN(i)&&!isNaN(r)){if(e.font="normal "+a+"px Arial",(I=e.measureText(o)).width<=i&&0==g_lines.length){var s=t-(i-I.width)/2+2;return void e.fillText(o,s,r/2-a/4)}var d=o.split(" "),_="";g_lines=[];for(var g=0;g<d.length;g++){var f=_+d[g]+" ";(I=e.measureText(f)).width>i&&g>0?(g_lines.push(_),_=d[g]+" "):_=f}if(!((I=e.measureText(_)).width<=i))return fitText(e,o,t,n,i,r,a-1,l);if(g_lines.push(_),g_lines.length>3)return fitText(e,o,t,n,i,r,a-1,l);for(var p=n+a/4,c=0;c<g_lines.length;c++){var I;s=t-(i-(I=e.measureText(g_lines[c])).width)/2+2;e.fillText(g_lines[c],s,p),p+=1.1*a}}logDebug("function : fitText","E")}catch(e){error_handling(e)}}async function showHideItemDescription(e,o,t,n){try{logDebug("function : showHideItemDescription; g_show_item_desc : "+e,"S");var i=g_pog_json[n].ModuleInfo,r=g_camera.position.z,a=o,l=t.split(","),s=parseInt(a.replace("#","0x"),16);new THREE.Color(s);if("N"==e){var d=0;for(const e of i){if(void 0===e.ParentModule||null==e.ParentModule){var _=e.ShelfInfo,g=g_pog_json[n].ModuleInfo[d].Carpark,f=0;for(const e of _){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.ItemInfo.length>0){var p=e.ItemInfo,c=0;for(const e of p){if("DIVIDER"!==e.Item&&""!==e.Desc&&void 0!==e.Desc){var I=g_scene_objects[n].scene.children[2].getObjectById(e.ObjID);if(void 0!==e.DescID&&-1!==e.DescID&&void 0!==I){var m=I.getObjectById(e.DescID);I.remove(m)}g_pog_json[n].ModuleInfo[d].ShelfInfo[f].ItemInfo[c].DescID=-1}c+=1}}f+=1}c=0;if(void 0!==g&&g.length>0)for(const e of g[0].ItemInfo){if("DIVIDER"!==e.Item&&""!==e.Desc&&void 0!==e.Desc){I=g_scene_objects[n].scene.children[2].getObjectById(e.ObjID);if(void 0!==e.DescID&&-1!==e.DescID){m=I.getObjectById(e.DescID);I.remove(m)}g_pog_json[n].ModuleInfo[d].Carpark[0].ItemInfo[c].DescID=-1}c+=1}}d+=1}}else{g_camera.position.z=7;d=0;for(const e of i){if(void 0===e.ParentModule||null==e.ParentModule){_=e.ShelfInfo,g=g_pog_json[n].ModuleInfo[d].Carpark,f=0;for(const e of _){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.ItemInfo.length>0){p=e.ItemInfo,c=0;for(const o of p){if("DIVIDER"!==o.Item&&""!==o.Desc&&void 0!==o.Desc){I=g_scene_objects[n].scene.children[2].getObjectById(o.ObjID);if(null==hexToRgb(x=g_pog_json[n].ModuleInfo[d].ShelfInfo[f].Color))parseInt("FF",16),parseInt("FF",16),parseInt("FF",16);else hexToRgb(x).r,hexToRgb(x).r,hexToRgb(x).g;O="#000000";var h="";if("N"==g_temp_desc)for(q=0;q<l.length;q++)"ITEM"==l[q]?h=h+o.ItemID+" - ":"DESCRIPTION"==l[q]&&(h=h+o.Desc+" - ");else{var u=g_temp_desc.split(""),S=0,D=get_sales_info(n,o.ItemID);for(const e of u){if("I"==e&&(h=h+o.ItemID+" - "),"D"==e&&(h=h+o.Desc+" "+o.DescSecond+" - "),"V"==e&&(h=h+" SV: "+D.SalesPerWeek+" "),"U"==e&&(h=h+"SU "+D.SalesUnitPerWeek+" "),"R"==e&&(h=h+" VRM$: "+D.VRM+" "),"C"==e){var b=o.SizeDesc.split("*");details=o.BHoriz*o.BVert*o.BaseD/parseInt(b[1]),isNaN(details)||!isFinite(details)?temp_text="C: 0":temp_text="C: "+details.toFixed(1),h=h+temp_text+" "}"O"==e&&(details=o.BHoriz*o.BVert*o.BaseD/(D.SalesUnitPerWeek/7),isNaN(details)||!isFinite(details)?temp_text="D: 0":temp_text="D: "+details.toFixed(1),h=h+temp_text+" "),"P"==e&&(h=h+"VRM%: "+D.VRMPer+" "),"F"==e&&(h=h+" "+o.BHoriz+" - "),"E"==e&&(h=h+o.Brand+" "+o.Desc+" "+o.SizeDesc+" - "),S>0&&(h+="\n"),S++}}if(void 0!==o.DescID&&-1!==o.DescID){m=I.getObjectById(o.DescID);I.remove(m)}if(void 0!==I){var v=addItemDescription(h,70,g_labelActualSize,O,"center","",o.W,o.H,"Y",g_vert_text_dis,o.ItemID,g_item_vertical_text_display,g_item_text_center_align,o.BHoriz);I.add(v),v.position.x=0,v.position.y=0,0!==e.Rotation||0!==e.Slope?v.position.z=o.D/2+5e-4:v.position.z=6e-4,I.WireframeObj.material.color.setHex(0),g_pog_json[n].ModuleInfo[d].ShelfInfo[f].ItemInfo[c].DescID=v.id}}c+=1}}f+=1}c=0;if(void 0!==g&&g.length>0)for(const e of g[0].ItemInfo){if("DIVIDER"!==e.Item&&""!==e.Desc&&void 0!==e.Desc){var x,O;I=g_scene_objects[n].scene.children[2].getObjectById(e.ObjID);if(null==hexToRgb(x=g_pog_json[n].ModuleInfo[d].Carpark[0].Color))parseInt("FF",16),parseInt("FF",16),parseInt("FF",16);else hexToRgb(x).r,hexToRgb(x).r,hexToRgb(x).g;O="#000000";h="",v=addItemDescription(h=e.ItemID+"- "+e.Desc,70,g_labelActualSize,O,"center","",e.W,e.H,"Y",g_vert_text_dis,e.ItemID,g_item_vertical_text_display,g_item_text_center_align,e.BHoriz);I.add(v),v.position.x=0,v.position.y=0,v.position.z=.001,g_pog_json[n].ModuleInfo[d].Carpark[0].ItemInfo[c].DescID=v.id}c+=1}}d+=1}g_camera.position.z=r}render(n),logDebug("function : showHideItemDescription","E")}catch(e){error_handling(e)}}function nvl(e){try{return void 0===e||""==e||null==e||"null"==e?0:e}catch(e){error_handling(e)}}async function get_all_images(e,o,t="N",n,i,r){try{var a;if(logDebug("function : get_all_images; ","S"),void 0!==g_pog_json&&g_pog_json.length>0){a="Y"==t?0:e;var l=[];for(pogs of g_pog_json){var s=g_pog_json[a].ModuleInfo,d=0;if(null!==s)for(const e of s){if(void 0===e.ParentModule||null==e.ParentModule){if(void 0!==e.ShelfInfo&&null!==e.ShelfInfo&&e.ShelfInfo.length>0){j=0;for(const t of e.ShelfInfo){if("BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&"TEXTBOX"!==t.ObjType&&void 0!==t.ItemInfo&&null!==t.ItemInfo&&t.ItemInfo.length>0){for(const e of t.ItemInfo){var _=get_orientation_list((h=(u=g_orientation_json[e.Orientation]).split("###"))[0]),g="N";for(const o of g_ItemImages){if(e.Item==o.Item&&h[0]==o.Orientation&&e.MerchStyle==o.MerchStyle){g="Y";break}0}if("1"==e.CapStyle||"2"==e.CapStyle||"3"==e.CapStyle){var f="N",p=void 0!==e.CapMerch&&""!==e.CapMerch?e.CapMerch:"0",c=void 0!==e.CapOrientaion&&""!==e.CapOrientaion?e.CapOrientaion:"0",I=g_orientation_json[c].split("###");for(const o of g_ItemImages){if(e.Item==o.Item&&I[0]==o.Orientation&&p==o.MerchStyle){f="Y";break}0}if("N"==f)"0"==p?m="U":"1"==p?m="T":"2"==p?m="C":"3"==p&&(m="D"),ItemImageInfo={},ItemImageInfo.Item=e.Item,ItemImageInfo.Orientation=I[0],ItemImageInfo.MerchStyle=m,l.push(ItemImageInfo)}if("N"==g)"0"==e.MerchStyle?m="U":"1"==e.MerchStyle?m="T":"2"==e.MerchStyle?m="C":"3"==e.MerchStyle&&(m="D"),ItemImageInfo={},ItemImageInfo.Item=e.Item,ItemImageInfo.Orientation=h[0],ItemImageInfo.MerchStyle=m,l.push(ItemImageInfo),"Y"==o&&(1==h[0]||2==h[0]||3==h[0]||8==h[0])&&(ItemImageInfo={},ItemImageInfo.Item=e.Item,ItemImageInfo.Orientation=_[0],ItemImageInfo.MerchStyle=m,l.push(ItemImageInfo),ItemImageInfo={},ItemImageInfo.Item=e.Item,ItemImageInfo.Orientation=_[1],ItemImageInfo.MerchStyle=m,l.push(ItemImageInfo),ItemImageInfo={},ItemImageInfo.Item=e.Item,ItemImageInfo.Orientation=_[2],ItemImageInfo.MerchStyle=m,l.push(ItemImageInfo));0}}j+=1}}if(null!==e.Carpark&&void 0!==e.Carpark&&void 0!==e.Carpark[0]&&null!==e.Carpark[0].ItemInfo&&e.Carpark[0].ItemInfo.length>0){for(const o of e.Carpark[0].ItemInfo){var m,h=(u=g_orientation_json[o.Orientation]).split("###");g="N";for(const e of g_ItemImages){if(o.Item==e.Item&&h[0]==e.Orientation&&o.MerchStyle==e.MerchStyle){g="Y";break}0}if("N"==g)"0"==o.MerchStyle?m="U":"1"==o.MerchStyle?m="T":"2"==o.MerchStyle?m="C":"3"==o.MerchStyle&&(m="D"),ItemImageInfo={},ItemImageInfo.Item=o.Item,ItemImageInfo.Orientation=h[0],ItemImageInfo.MerchStyle=m,l.push(ItemImageInfo);0}}}d+=1}if("Y"!=t)break;a++}await get_all_image_ajax(l),d=0;for(var u of g_ItemImages){var S=new Image,D="";S.src="data:image/jpeg;base64,"+u.ItemImage,S.onload=function(){(async()=>{D=await async function(e){return(await resizeImage(e,parseFloat(n),parseFloat(i),parseFloat(r))).split(",")[1]}(S),d<=g_ItemImages.length-1&&(g_ItemImages[d].ItemImage=D)})()},d++}}return logDebug("function : get_all_images; ","E"),"SUCCESS"}catch(e){error_handling(e)}}function get_all_image_ajax(e){return new Promise((function(o,t){try{var n=new Date;logDebug("function : get_all_image_ajax; ","S"),apex.server.process("GET_IMAGE_CLOB",{p_clob_01:JSON.stringify(e)},{dataType:"html"}).done((function(e){""!==$.trim(e)?(g_ItemImages=g_ItemImages.concat(JSON.parse($.trim(e))),logDebug("function : get_all_image_ajax; ","E"),o("SUCESS")):(console.log("Image Not Found"),logDebug("function : get_all_image_ajax; ","E"),o("SUCESS"));var t=((new Date).getTime()-n.getTime())/1e3;console.log("Seconds Difference",t)})),logDebug("function : get_all_image_ajax ; ","E")}catch(e){error_handling(e)}}))}function show_single_item_desc(e,o,t,n,i,r,a,l,s){if("DIVIDER"!==n.Item&&""!==n.Desc&&void 0!==n.Desc&&"Y"==g_show_desc_no_image){var d=r.position.z;r.position.z=7;var _=g_pog_json[s].ModuleInfo[e].ShelfInfo[o].Color;if(null==hexToRgb(_))parseInt("FF",16),parseInt("FF",16),parseInt("FF",16);else hexToRgb(_).r,hexToRgb(_).r,hexToRgb(_).g;"#000000";var g=parseInt(a.replace("#","0x"),16),f=(new THREE.Color(g),l.split(",")),p="";if("N"==g_temp_desc)for(q=0;q<f.length;q++)"ITEM"==f[q]?p=p+n.ItemID+" - ":"DESCRIPTION"==f[q]&&(p=p+n.Desc+" - ");else{var c=g_temp_desc.split(""),I=0,m=get_sales_info(s,n.ItemID);for(const e of c){if("I"==e&&(p=p+n.ItemID+" - "),"D"==e&&(p=p+n.Desc+" "+n.DescSecond+" - "),"V"==e&&(p=p+" SV: "+m.SalesPerWeek+" "),"U"==e&&(p=p+"SU "+m.SalesUnitPerWeek+" "),"R"==e&&(p=p+" VRM$: "+m.VRM+" "),"C"==e){var h=n.SizeDesc.split("*");details=n.BHoriz*n.BVert*n.BaseD/parseInt(h[1]),isNaN(details)||!isFinite(details)?temp_text="C: 0":temp_text="C: "+details.toFixed(1),p=p+temp_text+" "}"O"==e&&(details=n.BHoriz*n.BVert*n.BaseD/(m.SalesUnitPerWeek/7),isNaN(details)||!isFinite(details)?temp_text="D: 0":temp_text="D: "+details.toFixed(1),p=p+temp_text+" "),"P"==e&&(p=p+"VRM%: "+m.VRMPer+" "),"F"==e&&(p=p+" "+n.BHoriz+" - "),"E"==e&&(p=p+n.Brand+" "+n.Desc+" "+n.SizeDesc+" - "),I>0&&(p+="\n"),I++}}if(void 0!==n.DescID&&-1!==n.DescID){var u=i.getObjectById(n.DescID);i.remove(u)}var S=addItemDescription(p,70,g_labelActualSize,"#000000","center","",n.W,n.H,"Y",g_vert_text_dis,n.ItemID,g_item_vertical_text_display,g_item_text_center_align,n.BHoriz);i.add(S),S.position.x=0,S.position.y=0,S.position.z=6e-4,i.WireframeObj.material.color.setHex(0),g_pog_json[s].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].DescID=S.id,r.position.z=d}}function setParams(e,o,t,n,i,r,a,l,s,d,_,g,f,p,c){e&&(g_labelFont=parseInt(e),g_labelActualSize=.0034375*e),o&&(g_status_error_color=parseInt(o.replace("#","0x"),16)),t&&(g_offset_z=parseFloat(t)),n&&(g_textbox_merge_pdf=n),i&&(g_auto_hangbar_facings=i),r&&(g_auto_apply_d_facings=r),a&&(g_auto_apply_v_facings=a),l&&(g_show_live_image=l),s&&(g_dim_error_color=parseInt(s.replace("#","0x"),16)),d&&(g_pogcr_auto_hlite_non_mv_item=d),_&&(g_show_desc_no_image=_),g&&(g_notch_label_position=g),f&&(g_fixel_label=f),c&&(g_dft_max_merch=c)}async function showHideDaysOfSupplyLabel(e,o="N",t,n="Y",i="N",r,a){try{if(logDebug("function : showHideDaysOfSupplyLabel; show_label_ind : "+e,"S"),g_pog_json.length>0){var l=g_pog_json[t].ModuleInfo,s=g_scene_objects[t].scene.children[0].position.z;if("N"==e){var d=0;for(const e of l){if(void 0===e.ParentModule||null==e.ParentModule){var _=e.ShelfInfo,g=g_pog_json[t].ModuleInfo[d].Carpark,f=0;for(const e of _){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.ItemInfo.length>0){var p=e.ItemInfo,c=0;for(const e of p){if("DIVIDER"!==e.Item&&""!==e.DaysOfSupply&&void 0!==e.DaysOfSupply){console.log("beforeupdatedos func",g_show_days_of_supply);var I=await updateDaysOfSupply(e,c,f,d,"N",o,t,i),m=g_scene_objects[t].scene.children[2].getObjectById(e.ObjID);if(void 0!==e.daysOfSupplyID&&-1!==e.daysOfSupplyID){var h=m.getObjectById(e.daysOfSupplyID);m.remove(h)}g_pog_json[t].ModuleInfo[d].ShelfInfo[f].ItemInfo[c].daysOfSupplyID=-1}c+=1}}f+=1}c=0;if(void 0!==g&&g.length>0)for(const e of g[0].ItemInfo){if("DIVIDER"!==e.Item&&""!==e.DaysOfSupply&&void 0!==e.DaysOfSupply){I=await updateDaysOfSupply(e,c,f,d,"Y",o,t),m=g_scene_objects[t].scene.children[2].getObjectById(e.ObjID);if(void 0!==e.daysOfSupplyID&&-1!==e.daysOfSupplyID){h=m.getObjectById(e.daysOfSupplyID);m.remove(h)}g_pog_json[t].ModuleInfo[d].Carpark[0].ItemInfo[c].daysOfSupplyID=-1}c+=1}}d+=1}}else{var u=a.split(",");d=0;g_scene_objects[t].scene.children[0].position.z=6;for(const e of l){if(void 0===e.ParentModule||null==e.ParentModule){_=e.ShelfInfo,g=g_pog_json[t].ModuleInfo[d].Carpark,f=0;for(const e of _){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.ItemInfo.length>0){p=e.ItemInfo,c=0;for(const a of p){if(void 0!==(I=await updateDaysOfSupply(a,c,f,d,"N",o,t,i))&&"Y"==n)if("DIVIDER"!==I.Item&&""!==I.DaysOfSupply&&void 0!==I.DaysOfSupply)if(void 0!==(m=g_scene_objects[t].scene.children[2].getObjectById(I.ObjID))){var S="#000000",D="";if(0!==nvl(m)){var b=0;for(const e of u){var v="",x=e.split(":"),O=get_sales_info(t,a.ItemID);if("COS"==x[0]){var C=a.SizeDesc.split("*"),j=a.CapFacing*a.CapDepth*a.CapHorz*parseInt(1==a.CapMerch?a.UnitperTray:1);details=(a.BHoriz*a.BVert*a.BaseD*parseInt(1==a.MerchStyle?a.UnitperTray:2==a.MerchStyle?a.UnitperCase:1)+j)/parseInt(C[1]),v=isNaN(details)||!isFinite(details)?x[1]+": 0":x[1]+": "+details.toFixed(1)}if("DOS"==x[0])v=parseFloat(m.DaysOfSupply).toFixed(1);else if("SALES"==x[0])v=x[1]+": "+O.SalesPerWeek;else if("UNIT"==x[0])v=x[1]+": "+O.SalesUnitPerWeek;else if("VRMS"==x[0])v=x[1]+": "+O.VRMPer;else if("DOS_CAL"==x[0])details=a.BHoriz*a.BVert*a.BaseD*parseInt(1==a.MerchStyle?a.UnitperTray:2==a.MerchStyle?a.UnitperCase:1)/(O.SalesUnitPerWeek/7),v=isNaN(details)||!isFinite(details)?x[1]+": 0":x[1]+": "+details.toFixed(1);else if("AVG_SALES_WK"==x[0])v=x[1]+": "+O.AvgSalesPerWeek;else if("AVG_QTY_WK"==x[0])v=x[1]+": "+O.AvgQtyPerWeek;else if("SALES_PER"==x[0])v=x[1]+"%: "+O.SalesPartPer;else if("QTY_PER"==x[0])v=x[1]+"%: "+O.QtyPartPer;else if("NO_OF_LIST"==x[0])v=x[1]+": "+O.NoOfListing;else if("GP"==x[0])v=x[1]+": "+O.GP;else if("ASP"==x[0])v=x[1]+": "+O.ASP;else if("EDLP"==x[0]){var M=void 0!==a.EDLP&&null!==a.EDLP?a.EDLP:0;v=x[1]+": "+M}D=0==b?v:D+"\n"+v,b++}}if(D.substring(1),0!==nvl(I.daysOfSupplyID)&&-1!==I.daysOfSupplyID){h=m.getObjectById(I.daysOfSupplyID);m.remove(h)}var y=addDaysOfSupply(D,20,g_labelActualSize,S,"center","#ffffff",r,I.W,I.H);m.add(y),y.uuid="days_of_supply",new_x=I.W/2,new_y=I.H/2,y.position.x=0,y.position.y=0,0!==e.Rotation||0!==e.Slope?y.position.z=I.D/2+.005:y.position.z=6e-4,g_pog_json[t].ModuleInfo[d].ShelfInfo[f].ItemInfo[c].daysOfSupplyID=y.id}c+=1}}f+=1}c=0;if(void 0!==g&&g.length>0)for(const e of g[0].ItemInfo){if("DIVIDER"!==e.Item&&""!==e.DaysOfSupply&&void 0!==e.DaysOfSupply){await updateDaysOfSupply(e,c,0,d,"Y",o,t,i);if("Y"==n){m=g_scene_objects[t].scene.children[2].getObjectById(e.ObjID),S="#000000",D="";var H=g_scene_objects[t].scene.children[2].getObjectById(e.ObjID);if(0!==nvl(H)&&(D=H.DaysOfSupply),void 0!==e.daysOfSupplyID&&-1!==e.daysOfSupplyID){h=m.getObjectById(e.daysOfSupplyID);m.remove(h)}y=addDaysOfSupply(D,20,g_labelActualSize,S,"center","#ffffff",r,e.W,e.H);m.add(y),y.uuid="days_of_supply",g_pog_json[t].ModuleInfo[d].Carpark[0].ItemInfo[c].daysOfSupplyID=y.id}}c+=1}}d+=1}g_scene_objects[t].scene.children[0].position.z=s}}render(t),logDebug("function : showHideDaysOfSupplyLabel","E")}catch(e){error_handling(e)}}function addDaysOfSupplySingle(e,o,t,n,i,r,a){try{logDebug("function : addlabelText; text : "+e+"; textHeight : "+o+"; actualFontSize : "+t+"; font_color : "+n+"; txt_align : "+i+"; back_color : "+r,"S");var l=document.createElement("canvas"),s=l.getContext("2d");s.fillStyle="#000000";s.measureText(e).width;if("N"==a.split(",")[0])t=a.split(",")[1];else t=a.split(",")[1];var[d,_]=get_visible_text_dim(e,o);l.width=d,l.height=_,s.font="normal "+o+"px Arial",s.textAlign=i,s.textBaseline="middle",""!==r&&(s.fillStyle=r,s.fillRect(0,0,l.width,l.height)),s.fillStyle=n,s.fillText(e,d/2,_/2);let p=new THREE.CanvasTexture(l);p.minFilter=THREE.LinearFilter;var g=new THREE.SpriteMaterial({map:p});g.map.minFilter=THREE.LinearFilter;var f=new THREE.Sprite(g);return f.scale.set(d/_*t,t,1),f.uuid="days_of_supply",logDebug("function : addlabelText","E"),f}catch(e){error_handling(e)}}function addDaysOfSupply(e,o,t,n,i,r,a,l,s){try{logDebug("function : addlabelText; text : "+e+"; textHeight : "+o+"; actualFontSize : "+t+"; font_color : "+n+"; txt_align : "+i+"; back_color : "+r,"S");var d=e.split("\n"),_=10*l,g=10*s;o=70;var f=document.createElement("canvas"),p=f.getContext("2d");p.fillStyle="#000000";p.measureText(e).width;if("N"==a.split(",")[0])t=a.split(",")[1];else t=a.split(",")[1];t=t/1.5*d.length;var[c,I]=get_visible_size(.012,_,g,g_canvas,g_camera);f.width=c,f.height=I,p.font="bold "+o+"px Arial",p.textAlign=i,p.textBaseline="middle",""!==r&&(p.fillStyle=r,p.fillRect(0,0,f.width,f.height)),p.fillStyle=n;for(var m=0+o/2,h=0;h<d.length;h++){var u=0-(l-p.measureText(d[h]).width)/2+2;p.fillText(d[h],u,m),m+=1.11*o}let v=new THREE.CanvasTexture(f);v.minFilter=THREE.LinearFilter,v.matrixAutoUpdate=!0,v.needsUpdate=!0,v.isCanvasTexture=!0;var S=new THREE.PlaneGeometry(l,s),D=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:v,transparent:!0,opacity:.6});D.map.minFilter=THREE.LinearFilter;var b=new THREE.Mesh(S,D);return b.uuid="days_of_supply",logDebug("function : addlabelText","E"),b}catch(e){error_handling(e)}}async function showFixelAvailableSpace(e,o,t){try{logDebug("function : showFixelAvailableSpace; resetYN : "+e+"; calcShelfSpace : "+o,"S"),o=void 0===o?"N":o,g_labelFont=12;var[n,i]=[-1,-1],r=g_pog_index;if("N"==o){"Y"==(e=void 0===e?"Y":e)&&("N"==g_show_fixel_space?(g_show_fixel_space="Y",$(".fixel_space").addClass("item_label_active")):(g_show_fixel_space="N",$(".fixel_space").removeClass("item_label_active")));var a=[];if(void 0!==t?a.push(g_pog_json[t]):a=g_pog_json,"Y"==g_show_fixel_space){if("N"==g_all_pog_flag)var l=t;else l=0;for(const e of g_pog_json){if(l!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex||l==g_ComViewIndex&&"PREV_VERSION"==g_compare_view){g_scene=g_scene_objects[l].scene,g_camera=g_scene_objects[l].scene.children[0];for(const e of g_pog_json[l].ModuleInfo)if(e&&Array.isArray(e.ShelfInfo)){var s=0;for(const o of e.ShelfInfo){if(void 0===(O=g_scene_objects[l].scene.children[2].getObjectById(o.SObjID))||"SHELF"!=o.ObjType&&"HANGINGBAR"!=o.ObjType||([n,i]=getCombinationShelf(l,o.Shelf)),-1!==n&&-1!==i)calcCombineShelfAvlSpace(l,n);else if(void 0!==O&&("SHELF"==o.ObjType||"HANGINGBAR"==o.ObjType||"ROD"==o.ObjType)){var d=0;if(void 0!==o.ROverhang&&""!=o.ROverhang||(o.ROverhang=0),void 0!==o.LOverhang&&""!=o.LOverhang||(o.LOverhang=0),"Y"==g_lr_overhung)var _=o.W+o.ROverhang+o.LOverhang;else _=o.W;var g=o.D,f=0,p=0,c=Array.isArray(o.ItemInfo)?o.ItemInfo:[];for(const e of c)void 0!==e.BottomObjID&&""!=e.BottomObjID||("SHELF"==o.ObjType||"HANGINGBAR"==o.ObjType?d+=e.W:d+=e.D,p++);if("SHELF"==o.ObjType||"HANGINGBAR"==o.ObjType){if("E"!==o.SpreadItem){var I=o.HorizGap?o.HorizGap:0;d+=p>1?I*(p-1):0}f=wpdSetFixed(100*(_-d))}else f=wpdSetFixed(100*(g-d));if("F"==o.SpreadItem&&("SHELF"==o.ObjType||"HANGINGBAR"==o.ObjType)){var m=0;for(const e of o.ItemInfo)m+=e?.CrushHoriz>0?e?.W:e?.RW;f=wpdSetFixed(100*(_-m))}if(void 0!==o.availableSpaceObjID&&-1!==o.availableSpaceObjID){var h=O.getObjectById(o.availableSpaceObjID);O.remove(h)}var u=o.Color;if(null==hexToRgb(u))var S=parseInt("FF",16),D=parseInt("FF",16),b=parseInt("FF",16);else S=hexToRgb(u).r,D=hexToRgb(u).r,b=hexToRgb(u).g;var v=getTextColor(S,D,b);f<0&&(f=0);var x=addlabelText("Space "+f,g_labelFont,g_labelActualSize,v,"center","");O.add(x),(j=g_scene_objects[l].scene.children[2].getObjectById(o.SObjID)).AvlSpace=f,"ROD"==o.ObjType?x.position.y=-.009:x.position.y=-.005,x.uuid="fixel_space",0!==o.Rotation||0!==o.Slope?x.position.z=o.D/2+.005:x.position.z=.005,"DIVIDER"!==o.ObjType&&("ROD"==o.ObjType?x.position.x=o.W/2.4+.08+0:x.position.x=o.W/2.4-.08+0,e.ShelfInfo[s].availableSpaceObjID=x.id)}s++}0}render(l),set_indicator_objects(l)}if("Y"!=g_all_pog_flag)break;l++}g_scene=g_scene_objects[r].scene,g_camera=g_scene_objects[r].scene.children[0]}else{if("N"==g_all_pog_flag)l=t;else l=0;for(const e of g_pog_json){if(l!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex||l==g_ComViewIndex&&"PREV_VERSION"==g_compare_view){g_renderer=g_scene_objects[l].renderer,g_scene=g_scene_objects[l].scene,g_camera=g_scene_objects[l].scene.children[0];for(const e of g_pog_json[l].ModuleInfo){p=0;for(const o of e.ShelfInfo){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType){var O=g_scene_objects[l].scene.children[2].getObjectById(o.SObjID);if(void 0!==o.availableSpaceObjID&&-1!==o.availableSpaceObjID){var C=O.getObjectById(o.availableSpaceObjID);O.remove(C)}e.ShelfInfo[p].availableSpaceObjID=-1}p++}}render(l)}if("N"==g_all_pog_flag)break;l++}g_renderer=g_scene_objects[r].renderer,g_scene=g_scene_objects[r].scene,g_camera=g_scene_objects[r].scene.children[0]}}else{if("N"==g_all_pog_flag)l=t;else l=0;for(const e of g_pog_json){if(l!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex){g_renderer=g_scene_objects[l].renderer,g_scene=g_scene_objects[l].scene,g_camera=g_scene_objects[l].scene.children[0];for(const e of g_pog_json[l].ModuleInfo){p=0;for(const o of e.ShelfInfo){if(void 0!==(O=g_scene_objects[l].scene.children[2].getObjectById(o.SObjID))&&"SHELF"==o.ObjType){d=0;if(void 0!==o.ROverhang&&""!=o.ROverhang||(o.ROverhang=0),void 0!==o.LOverhang&&""!=o.LOverhang||(o.LOverhang=0),"Y"==g_lr_overhung)_=o.W+o.ROverhang+o.LOverhang;else _=o.W;f=0,s=0;for(const t of e.ShelfInfo[p].ItemInfo)void 0!==t.BottomObjID&&""!=t.BottomObjID||("SHELF"==o.ObjType||"HANGINGBAR"==o.ObjType?d+=t.W:d+=t.D,s++);if("SHELF"==o.ObjType||"HANGINGBAR"==o.ObjType){if("E"!==o.SpreadItem){I=o.HorizGap?o.HorizGap:0;d+=s>1?I*(s-1):0}f=wpdSetFixed(100*(_-d))}else f=wpdSetFixed(100*(g-d));if("F"==o.SpreadItem&&("SHELF"==o.ObjType||"HANGINGBAR"==o.ObjType)){m=0;for(const e of o.ItemInfo)m+=e?.CrushHoriz>0?e?.W:e?.RW;f=wpdSetFixed(100*(_-m))}var j=g_scene_objects[l].scene.children[2].getObjectById(o.SObjID);f<0&&(f=0),j.AvlSpace=f}p++}}render(l)}if("N"==g_all_pog_flag)break;l++}g_renderer=g_scene_objects[r].renderer,g_scene=g_scene_objects[r].scene,g_camera=g_scene_objects[r].scene.children[0]}logDebug("function : showFixelAvailableSpace","E")}catch(e){error_handling(e)}}async function updateDaysOfSupply(e,o,t,n,i,r="N",a,l="N"){try{var s=0,d=0==nvl(e.RegMovement)?1:nvl(e.RegMovement),_=get_similar_items(e.ItemID,"I",a,"Y"),g=[],f=[];for(items of _)s+=items.VertFacing*items.HorizFacing*items.DFacing;var p=g_scene_objects[a].scene.children[2].getObjectById(e.ObjID);if(0!==nvl(p)&&0!==nvl(e.RegMovement)&&"0"!==e.RegMovement?(p.DaysOfSupply=parseFloat(s/d).toFixed(2),"N"==i?g_pog_json[a].ModuleInfo[n].ShelfInfo[t].ItemInfo[o].DaysOfSupply=parseFloat(p.DaysOfSupply).toFixed(2):g_pog_json[a].ModuleInfo[n].Carpark[0].ItemInfo[o].DaysOfSupply=parseFloat(p.DaysOfSupply).toFixed(2)):0!==nvl(p)&&(p.DaysOfSupply="","N"==i?(p.DaysOfSupply="0.00",g_pog_json[a].ModuleInfo[n].ShelfInfo[t].ItemInfo[o].DaysOfSupply="0.00"):g_pog_json[a].ModuleInfo[n].Carpark[0].ItemInfo[o].DaysOfSupply=""),"N"==i){var c=g_pog_json[a].ModuleInfo[n].ShelfInfo[t].ItemInfo[o];"Y"==r&&(g.push(g_pog_json[a].ModuleInfo[n].ShelfInfo[t].ItemInfo[o].ItemID),f.push(g_pog_json[a].ModuleInfo[n].ShelfInfo[t].ItemInfo[o].DaysOfSupply),await updatePOGItemInfoColl(g,f,a))}else c=g_pog_json[a].ModuleInfo[n].Carpark[0].ItemInfo[o];return c}catch(e){error_handling(e)}}function get_similar_items(e,o,t,n="N"){try{logDebug("function : get_similar_items; desc : "+e+"; p_type : "+o,"S");var i=[];if("N"==n){if(g_pog_json.length>0){var r=0;for(const t of g_pog_json){for(const t of g_pog_json[r].ModuleInfo){if(null==t.ParentModule){if(void 0!==t.Carpark&&void 0!==t.Carpark[0]&&t.Carpark[0].ItemInfo.length>0){for(const n of t.Carpark[0].ItemInfo){if("I"==o&&n.Item==e||"D"==o&&0!=nvl(n.Desc)&&-1!==n.Desc.search(e))void 0!==(a=g_scene_objects[r].scene.children[2].getObjectById(n.ObjID))&&i.push(a);0}}for(const n of t.ShelfInfo){if("BASE"!==n.ObjType&&"NOTCH"!==n.ObjType&&"DIVIDER"!==n.ObjType&&"TEXTBOX"!==n.ObjType){for(const t of n.ItemInfo){if("I"==o&&t.Item==e||"D"==o&&0!=nvl(t.Desc)&&-1!==t.Desc.search(e))void 0!==(a=g_scene_objects[r].scene.children[2].getObjectById(t.ObjID))&&i.push(a);0}}0}}0}r++}}}else{for(const n of g_pog_json[t].ModuleInfo){if(null==n.ParentModule){if(void 0!==n.Carpark&&void 0!==n.Carpark[0]&&n.Carpark[0].ItemInfo.length>0){for(const r of n.Carpark[0].ItemInfo){if("I"==o&&r.Item==e||"D"==o&&0!=nvl(r.Desc)&&-1!==r.Desc.search(e))void 0!==(a=g_scene_objects[t].scene.children[2].getObjectById(r.ObjID))&&i.push(a);0}}for(const r of n.ShelfInfo){if("BASE"!==r.ObjType&&"NOTCH"!==r.ObjType&&"DIVIDER"!==r.ObjType&&"TEXTBOX"!==r.ObjType){for(const n of r.ItemInfo){var a;if("I"==o&&n.Item==e||"D"==o&&0!=nvl(n.Desc)&&-1!==n.Desc.search(e))void 0!==(a=g_scene_objects[t].scene.children[2].getObjectById(n.ObjID))&&i.push(a);0}}0}}0}}return logDebug("function : get_similar_items","E"),i}catch(e){error_handling(e)}}function get_orientation_list(e){return 1==e?[2,8,3]:2==e?[1,8,3]:3==e?[1,2,8]:8==e?[1,2,3]:void 0}function getLabelPosition(e,o,t){t=t.toUpperCase();try{var n,i;return"M"==o?(n=-1,i=-1):"S"==o?"CENTER"==t?(n=0-(e.W/4+.01),i="ROD"==e.ObjType?.05:-.005):"TOP"==t?"HANGINGBAR"==e.ObjType?(n=0-(e.W/2.4+.01),i=0-(e.H/2+.012)):"ROD"==e.ObjType?(n=0-(e.W/4+.01),i=.05):(n=0-(e.W/2.4+.01),i=e.H/2+.012+0):"LEFT"==t?"HANGINGBAR"==e.ObjType?(n=0-(e.W/2+.08),i=-.005):"ROD"==e.ObjType?(n=0-(e.W/4+.08),i=.005):(n=0-(e.W/2+.08),i=-.005):"RIGHT"==t?"HANGINGBAR"==e.ObjType?(n=0-(e.W/2+.1),i=-.005):"ROD"==e.ObjType?(n=0-(e.W/4+.01),i=.05):(n=e.W/2+.1+0,i=-.005):"BOTTOM"==t&&("HANGINGBAR"==e.ObjType?(n=0-(e.W/2.4+.01),i=e.H/2+.012+0):"ROD"==e.ObjType?(n=0-(e.W/4+.01),i=.05):(n=0-(e.W/2.4+.01),i=0-(e.H/2+.012))):"I"==o&&(n=-1,i=-1),[n,i]}catch(e){error_handling(e)}}function highlightProduct(e,o,t,n,i,r){try{console.log("highlighting product",e),logDebug("function : add_wireframe; linewidth : "+o,"S");var a=new THREE.BoxGeometry(t+.03,n+.05,0),l=new THREE.EdgesGeometry(a),s=new THREE.LineBasicMaterial({color:16711680,linewidth:3}),d=new THREE.LineSegments(l,s);return e.geometry.computeBoundingBox(),d.position.copy(e.geometry.boundingBox.getCenter(new THREE.Vector3)),d.position.z+=.01,d.BorderColour=16711680,d.uuid="highlight_frame",e.WireframeObj=d,e.add(d),e.WireframeObj=d,logDebug("function : add_wireframe","E"),d.id}catch(e){error_handling(e)}}function render_blink_effect(){clearInterval(g_myVar),g_myVar=setInterval((function(){blink_effect_3d()}),500)}Array.prototype.keySort=function(e){var o=function(e,o){var t,n=0;for(t in e)if(e.hasOwnProperty(t)){if(n==o)return t;n++}return!1},t=function(e,o,t){return t=null!==t?t:1,e==o?0:e>o?1*t:-1*t},n=function(e){var o,t=0;for(o in e)e.hasOwnProperty(o)&&t++;return t}(e=e||{});if(!n)return this.sort(t);for(var i in e)e[i]="desc"==e[i]||-1==e[i]?-1:"skip"==e[i]||0===e[i]?0:1;return this.sort((function(i,r){for(var a=0,l=0;0===a&&l<n;){var s=o(e,l);if(s){var d=e[s];a=t(i[s],r[s],d),l++}}return a})),this},String.prototype.visualLength=function(e){try{var o=document.getElementById(e);return o.style.fontSize="large",o.innerHTML=this,o.offsetWidth}catch(e){error_handling(e)}},String.prototype.visualHeight=function(e){try{var o=document.getElementById(e);return o.style.fontSize="large",o.innerHTML=this,o.offsetHeight}catch(e){error_handling(e)}},window.addEventListener("click",(function(e){void 0!==$(e.path)&&(logo_clicked="N"),void 0!==$(e.target).attr("id")&&"t-Icon fa fa-eyedropper"!==$(e.target).attr("class")?$(e.target).attr("id").startsWith("CUSTOM_COLOR")||$("#co-color-list").slideUp("fast",(function(){$("#co-color-list").css("display","none"),g_openChooseColor=!1})):"t-Icon fa fa-eyedropper"==$(e.target).attr("class")?($("#co-color-list").css("display","block"),g_openChooseColor=!0):$("#co-color-list").slideUp("fast",(function(){$("#co-color-list").css("display","none"),g_openChooseColor=!1}))})),$.fn.sbxColorChoice=function(e){try{const{reseteCor:o,removePallet:t,event:n,setfocus:i,textResetColorButton:r,selecionarCor:a}=e,l=$("#co-color-list"),s=e=>{e.slideUp("fast",(function(){e.css("display","none"),g_openChooseColor=!1,apex.item(i).setFocus()}))},d=(e,o)=>{e.find("ul li").click((function(){const t=$(this).attr("data-color");s(e),a(t,o)}))},_=()=>{""!=t&&null!=t&&$("#co-color-list").find(t).remove()},g=e=>{r&&e.find(".reset-color-button").html(r)},f=e=>{e.slideDown("fast",(function(){e.focus()}))};((e,t)=>{const n=$(t.target),i=n.offset(),r=n.height();n.width(),$(window).height(),$(window).width(),$("#co-color-list").height(),$("#co-color-list").width();let a,l;a=i.top-r;l=i.left-$("#co-color-list").width()/2;e.find("ul.color-reset li").attr("data-color",o),e.css({top:a,left:l}).addClass(["co-color-list--bellow","co-color-list--left"])})(l,n),f(l),d(l,n),_(),g(l),g_openChooseColor=!0}catch(e){error_handling(e)}};var blink_color=16711680;g_intersected=[];function blink_effect_3d(){if(blink_color=16711680==blink_color?65535:16711680,"Y"==g_show_live_image)for(var e=0;e<g_intersected.length;e++)void 0!==g_intersected[e]&&(65535==blink_color?g_intersected[e].WireframeObj.material.color.setHex(16711680):g_intersected[e].WireframeObj.material.color.setHex(65535));else for(e=0;e<g_intersected.length;e++)if(void 0!==g_intersected[e]&&(65535==blink_color?g_intersected[e].material.color.setHex(16711680):g_intersected[e].material.color.setHex(65535),g_intersected[e].children&&g_intersected[e].children.length>0))for(var o=0;o<g_intersected[e].children.length;o++){var t=g_intersected[e].children[o];t.material&&"highlight_frame"!==t.uuid&&"wireframe"!==t.uuid&&"Sprite"!==t.type&&"LineSegments"!==t.type&&(65535==blink_color?t.material.color.setHex(16711680):t.material.color.setHex(65535))}l_highlightStatus=$v("P25_POGCR_HIGHLIGHT_SEARCHED_ITEM"),"Y"==l_highlightStatus&&g_pog_json.length>1?render_all_pog():render(0)}function get_json_data_json(e,o,t,n){try{return new Promise((function(i,r){apex.server.process("GET_JSON_FROM_COLL",{x01:e,x02:o,x03:t,x04:n},{dataType:"html"}).done((function(e){-1==$.trim(e).indexOf("ERROR")?(g_pog_json_data=JSON.parse($.trim(e)),console.log("json",g_pog_json_data),i("SUCESS")):i($.trim(e))}))}))}catch(e){console.log("error 3",return_val)}}function render(e){logDebug("function : render","S");try{if(void 0!==e&&void 0!==g_scene_objects[e]&&void 0!==g_canvas_objects[e]){if(g_scene_objects.length>0){var o=g_canvas_objects[e].getContext("2d");if(null==o)null!=g_renderer&&g_renderer.render(g_scene,g_camera);else{g_renderer.setPixelRatio(window.devicePixelRatio);var t=g_canvas_objects[e].width,n=g_canvas_objects[e].height;g_renderer.setSize(t,n);var i=g_scene_objects[e].scene.children[0];i.aspect=t/n,i.updateProjectionMatrix(),g_renderer.render(g_scene_objects[e].scene,i),o.drawImage(g_renderer.domElement,0,0,t,n)}}}else null!=g_renderer&&g_renderer.render(g_scene,g_camera);logDebug("function : render","E")}catch(e){error_handling(e)}}function getTextColor(e,o,t){var n=[e/255,o/255,t/255].map((e=>e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)));return.2126*n[0]+.7152*n[1]+.0722*n[2]>.179?"#000000":"#FFFFFF"}function get_type(e){return"OwnLabel-Local"==e||"OwnLabel-IB"==e||"OwnLabel-OtherCountry"==e?"W":"Exclusive-SupplieE"==e||"Exclusive-DistributorE"==e?"E":"PrivateLabel-Local"==e||"PrivateLabel-IB"==e?"P":"FRESHKON"==e?"F":"Normal"==e?"N":"A Brand"==e?"A":void 0}async function auto_position_all(e,o,t,n,i){logDebug("function : auto_position_all","");try{if(void 0!==g_pog_json&&g_pog_json.length>0){g_pog_edited_ind="Y";var r=g_world,a=e;if("Y"==g_all_pog_flag)var l=0;else l=o;for(const r of g_pog_json){if(l!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex){void 0===t&&"N"==g_all_pog_flag?t=o:"Y"==g_all_pog_flag&&(t=l),g_world=g_scene_objects[l].scene.children[2],e=g_scene_objects[l].scene.children[0],H=g_pog_json[l].ModuleInfo,f=0;var s=[],d=[];for(const e of H){if((void 0===e.ParentModule||null==e.ParentModule)&&e.H>.1){var _={};_.ModStart=wpdSetFixed(e.X-e.W/2),_.ModEnd=wpdSetFixed(e.X+e.W/2),_.ModBottom=wpdSetFixed(e.Y-e.H/2),_.ModTop=wpdSetFixed(e.Y+e.H/2),_.ModX=e.X,_.ModIndex=f,_.Module=e.Module,_.ModWidth=e.W,_.MObjID=e.MObjID,d.push(_)}f+=1}g_cut_copy_arr=[];for(const e of d){var g=g_pog_json[l].ModuleInfo[e.ModIndex].ShelfInfo,f=0;for(shelfs of g)if("TEXTBOX"!==shelfs.ObjType&&"BASE"!==shelfs.ObjType&&"NOTCH"!==shelfs.ObjType&&"DIVIDER"!==shelfs.ObjType&&"ROD"!==shelfs.ObjType){var p=[];p.moduleIndex=e.ModIndex,p.shelfIndex=f,p.actionType="SHELF_DRAG",p.objectID=shelfs.SObjID,p.push(JSON.parse(JSON.stringify(shelfs))),p.moduleObjectID=e.MObjID,p.startCanvas=g_present_canvas,p.g_present_canvas=g_present_canvas,g_allUndoObjectsInfo.push(p)}f++}g_delete_details.multi_delete_shelf_ind="N",logFinalUndoObjectsInfo("SHELF_DRAG","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","Y"),g_allUndoObjectsInfo=[],f=0;for(const r of d){g=g_pog_json[l].ModuleInfo[r.ModIndex].ShelfInfo;var c=0;for(const a of g){if(a.ItemInfo.length>0&&update_item_distance(r.ModIndex,c,l,"N"),"BASE"!==a.ObjType&&"NOTCH"!==a.ObjType&&"DIVIDER"!==a.ObjType&&"ROD"!==a.ObjType&&("N"==n||"Y"==n)){var I=wpdSetFixed(a.X-a.W/2),m=wpdSetFixed(a.X+a.W/2),h="N";if((a.X>r.ModStart&&a.X<=r.ModEnd||I>=r.ModStart&&I<r.ModEnd||m>r.ModStart&&m<r.ModEnd)&&a.Y>r.ModBottom&&a.Y<r.ModTop||a.X>r.ModStart&&a.X<r.ModEnd&&(a.Y>r.ModTop||a.Y<r.ModBottom)?h="Y":g_pog_json[l].ModuleInfo[r.ModIndex].ShelfInfo[c].ShelfChangeReq="Y","Y"==h){await set_item_xy(a,r.ModIndex,c,o);var[u,S,D]=update_position_loc(a,r,c,r.ModIndex,r.ModIndex,e,l,g_scene_objects[t].scene.children[2],i);g_pog_json[l].ModuleInfo[r.ModIndex].ShelfInfo[c].ShelfChangeReq="N"}if("TEXTBOX"!==a.ObjType)var[b,v]=await set_shelf_after_drag(u,"Y",r.ModIndex,r.ModIndex,c,g_pog_json[l].ModuleInfo[r.ModIndex].ShelfInfo[c].X,g_pog_json[l].ModuleInfo[r.ModIndex].ShelfInfo[c].Y,"N","N","","",l,l,-1,"Y")}c+=1}f+=1}f=0;for(const o of d){var x=0;for(const n of H){if((void 0===n.ParentModule||null==n.ParentModule)&&n.H>.1){g=n.ShelfInfo,c=0;for(const n of g){if("BASE"!==n.ObjType&&"NOTCH"!==n.ObjType&&"DIVIDER"!==n.ObjType&&"ROD"!==n.ObjType&&"Y"==n.ShelfChangeReq&&"TEXTBOX"!==n.ObjType){I=wpdSetFixed(n.X-n.W/2),m=wpdSetFixed(n.X+n.W/2),h="N";var O="",C="",j="";if(f!==x&&I>o.ModStart&&I<o.ModEnd||m>o.ModStart&&m<o.ModEnd){h="Y",O=x,C=o.ModIndex,j=c,o.ModWidth,o.ModX;var[u,S,D]=update_position_loc(n,o,c,o.ModIndex,x,e,l,g_scene_objects[t].scene.children[2],i);"Y"!=u&&"R"!=u||(mod_detail={},mod_detail.MIndex=O,mod_detail.CurrIndex=C,mod_detail.SIndex=j,mod_detail.X=S,mod_detail.Y=D,mod_detail.Shelf=n.Shelf,mod_detail.ObjType=n.ObjType,s.push(mod_detail))}}c+=1}}x+=1}f+=1}if(void 0===s&&null!=s){f=0;for(const e of s){c=0;var M=-1,y=-1,H=g_pog_json[l].ModuleInfo;for(const o of H){if((void 0===o.ParentModule||null==o.ParentModule)&&o.H>.1){g=o.ShelfInfo;var w=0;for(const o of g){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"ROD"!==o.ObjType&&o.Shelf==e.Shelf){M=c,y=w;break}w+=1}}c+=1}if("TEXTBOX"!==e.ObjType)var[b,v]=await set_shelf_after_drag("Y","Y",M,e.CurrIndex,y,e.X,e.Y,"Y","N","","",l,l,-1,"Y");f+=1}}var T=get_min_max_xy(l).split("###");set_camera_z(e,parseFloat(T[2]),parseFloat(T[3]),parseFloat(T[0]),parseFloat(T[1]),g_offset_z,parseFloat(T[4]),parseFloat(T[5]),!0,l),render(l)}if("Y"!=g_all_pog_flag)break;l++}g_world=r,e=a,async function(){await recreate_compare_views(g_compare_view,"N")}()}logDebug("function : auto_position_all","E")}catch(e){error_handling(e)}}function get_closest_peg(e,o,t,n,i){logDebug("function : get_closest_peg; item_height : "+e+"; p_module_index : "+o+"; p_shelf_index : "+t+"; p_final_y : "+n);var r=g_pog_json[i].ModuleInfo[o].ShelfInfo[t].peg_vert_values,a=g_pog_json[i].ModuleInfo[o].ShelfInfo[t].Y,l=[];$.each(r,(function(e,o){l.push(a+r[e])}));var s=n+e/2;if(l.length>0)var d=l.reduce(((e,o)=>Math.abs(o-s)<Math.abs(e-s)?o:e));return logDebug("function : get_closest_peg","E"),d}function reorder_items(e,o,t){logDebug("function : reorder_items; p_module_index : "+e+"; p_shelf_index : "+o,"S");try{var n=g_pog_json[t].ModuleInfo[e].ShelfInfo[o],i=n.ObjType,[r,a]=[-1,-1];items_arr=JSON.parse(JSON.stringify(n.ItemInfo)),items_arr.forEach((e=>e.SpreadItem=0)),temp_item_arr=[];var l=n.SpreadItem,s=n.HorizGap,d=(wpdSetFixed(n.Y+n.H/2),0),_=0,g=n.W;x=wpdSetFixed(n.X-g/2-n.LOverhang),shelf_end=wpdSetFixed(n.X+g/2+n.ROverhang),g=wpdSetFixed(n.W+n.LOverhang+n.ROverhang);var f,p=[],c="N",I=-1,m=0;if("SHELF"!=i&&"HANGINGBAR"!=i||"N"===n.Combine||([r,a]=getCombinationShelf(t,n.Shelf)),l=-1!==r&&-1!==a?g_combinedShelfs[r].SpreadItem:l,-1===r||-1===a||"E"!=l&&"F"!=l){if(n.ItemInfo.length>0&&"ROD"!==i&&"PEGBOARD"!==i&&("CHEST"!=i||"Y"!=g_chest_as_pegboard)){var h=0;if("HANGINGBAR"==i){h=0;for(const i of n.ItemInfo){if("Y"==c)break;var u=wpdSetFixed(i.Y+i.H/2),S=wpdSetFixed(i.Y-i.H/2),D=0;for(const n of g_pog_json[t].ModuleInfo[e].ShelfInfo){if(n.ItemInfo.length>0&&"HANGINGBAR"==n.ObjType&&D!==o&&n.Y<u&&n.Y>S){c="Y",f="B",I=D;break}D++}h++}if("N"==c){var b=n;h=0;for(const n of g_pog_json[t].ModuleInfo[e].ShelfInfo){if("Y"==c)break;if("HANGINGBAR"==n.ObjType&&h!==o){D=0;for(const e of n.ItemInfo){u=wpdSetFixed(e.Y+e.H/2),u=wpdSetFixed(e.Y+e.H/2),S=e.Y-e.H/2;if(b.Y<u&&b.Y>S){c="Y",f="T",I=h;break}D++}}h++}}}if("N"==c||"Y"==c&&"B"==f){if("E"==l||"F"==l||"L"==l)if(!items_arr.some((e=>"Y"===e.Fixed))||"HANGINGBAR"!=i&&"SHELF"!=i){if("E"==l||"F"==l){_=0;items_arr=n.ItemInfo;D=0;for(const e of items_arr)void 0!==e.BottomObjID&&""!==e.BottomObjID&&"HANGINGBAR"!==i||(e.BHoriz>1&&"F"==l?d+=e.CrushHoriz>0?e.W:e.RW:d+=e.W,_+="E"==l?1:e.BHoriz),D++;if(_>0)y=wpdSetFixed((g-d)/(_-1))<0?0:wpdSetFixed((g-d)/(_-1));else y=wpdSetFixed(g-d)<0?0:wpdSetFixed(g-d);$.each(items_arr,(function(e,o){o.SpreadItem=wpdSetFixed(y)}))}}else reorderShelfWithFixedItem(n,x,shelf_end,l,s,items_arr);else if("R"==l){if(!items_arr.some((e=>"Y"===e.Fixed))||"HANGINGBAR"!=i&&"SHELF"!=i){for(h=items_arr.length-1;h>=0;h--)items_arr[h].IIndex=h,items_arr[h].NotFixed="N",p.push(items_arr[h]);n.ItemInfo.splice(0);h=0;for(const e of p)"N"==e.NotFixed&&n.ItemInfo.splice(0,0,e),h++}else reorderShelfWithFixedItem(n,x,shelf_end,l,s,items_arr)}}else{var v=n,x=v.X-v.W/2,O=100;h=0;for(const o of g_pog_json[t].ModuleInfo[e].ShelfInfo[I].ItemInfo){u=wpdSetFixed(o.Y+o.H/2),S=wpdSetFixed(o.Y-o.H/2);v.Y<u&&v.Y>S&&(O=Math.min(O,o.X-o.W/2)),h++}g=O-x;if("E"==l||"F"==l){_=0;items_arr=n.ItemInfo;D=0;for(const e of items_arr)void 0!==e.BottomObjID&&""!==e.BottomObjID&&"HANGINGBAR"!==i||(e.BHoriz>1&&"F"==l?d+=e.W+s*(e.BHoriz-1):d+=e.W,_+="E"==l?1:e.BHoriz),D++;if(_>0)y=wpdSetFixed((g-d)/(_-1))<0?0:wpdSetFixed((g-d)/(_-1));else y=wpdSetFixed(g-d)<0?0:wpdSetFixed(g-d);$.each(items_arr,(function(e,o){o.SpreadItem=y}))}else if("R"==l){items_arr=n.ItemInfo;h=0;for(const e of items_arr)items.ShelfEnd=O,h++}}}}else{var C,j;m=g_combinedShelfs[r].length;s=0,g=0;for(var M=0;M<m;M++){j=g_combinedShelfs[r][M].MIndex,C=g_combinedShelfs[r][M].SIndex,g=g+(n=g_pog_json[t].ModuleInfo[j].ShelfInfo[C]).W+n.LOverhang+n.ROverhang,items_arr=n.ItemInfo;for(const e of items_arr)void 0!==e.BottomObjID&&""!=e.BottomObjID||(d+=e.W,_+="E"==l?1:e.BHoriz)}var y=0;_>1?y=(g-d)/(_-1)<=0?0:(g-d)/(_-1):1!==_&&(y=g-d<0?0:g-d);for(M=0;M<m;M++){j=g_combinedShelfs[r][M].MIndex,C=g_combinedShelfs[r][M].SIndex,n=g_pog_json[t].ModuleInfo[j].ShelfInfo[C],items_arr=n.ItemInfo;for(const e of items_arr)e.SpreadItem=y}}return logDebug("function : reorder_items","E"),!0}catch(e){error_handling(e)}}function get_item_xaxis(e,o,t,n,i,r,a,l,s,d,_,g,f,p,c,I="Y",m="N"){logDebug("function : get_item_xaxis; width : "+e+"; height : "+o+"; depth : "+t+"; shelf_obj_type : "+n+"; locationX : "+i+"; horiz_gap : "+r+"; spread_product : "+a+"; spread_gap : "+l+"; p_module_index : "+s+"; p_shelf_index : "+d+"; i_item_index : "+_+"; p_edit_ind : "+g+"; item_length : "+f+"; shelf_edit : "+p,"S");try{g_invalidPosition="N";var h=0,u=g_pog_json[c].ModuleInfo[s].ShelfInfo[d],S=u.ItemInfo[_].Fixed,D=u.BsktSpreadProduct,b=u.BsktFill,v=u.W,x=u.H,O=u.D,C=u.Y,j=u.ItemInfo[_].BottomObjID,M=u.ItemInfo,y=u.X-u.W/2,H=1,[w,T]=[-1,-1],F=g_pog_json[c].ModuleInfo[s].ShelfInfo[d],N=u.ItemInfo[_].BottomObjID;if("SHELF"!=F.ObjType&&"HANGINGBAR"!=F.ObjType||"N"===F.Combine||([w,T]=getCombinationShelf(c,F.Shelf),-1!==w&&-1!==T&&(H=g_combinedShelfs[w].length)),H>1){const e=g_combinedShelfs[w].Start,o=g_combinedShelfs[w].End;var E=0,B=0;Oe=getLastItemCombinedShelf(g_combinedShelfs[w],a,u.ItemInfo[_].ObjID),$.isEmptyObject(Oe)||(Oe.X,Oe.W,E=Oe.X-Oe.W/2,B=Oe.X+Oe.W/2),"R"==a?h=0!==E?E-u.ItemInfo[_].W/2:o-u.ItemInfo[_].W/2:"L"==a?h=0!==B?B+u.ItemInfo[_].W/2:e+u.ItemInfo[_].W/2:"E"==a||"F"==a?("F"==a&&u.ItemInfo[_].BHoriz>1&&0==u.ItemInfo[_].CrushHoriz?u.ItemInfo[_].W=u.ItemInfo[_].RW+u.ItemInfo[_].SpreadItem*(u.ItemInfo[_].BHoriz-1):"E"==a&&u.ItemInfo[_].BHoriz>1&&r>0&&0==u.ItemInfo[_].CrushHoriz&&(u.ItemInfo[_].W=u.ItemInfo[_].RW+r*(u.ItemInfo[_].BHoriz-1)),h=0!==B?B+u.ItemInfo[_].W/2+u.ItemInfo[_].SpreadItem:e+u.ItemInfo[_].W/2):"M"==a&&(h=u.ItemInfo[_].X)}else if("Y"==p)h=u.ItemInfo[_].X;else if(-1!==["SHELF","HANGINGBAR"].indexOf(n))if("R"==a){var W=u.ItemInfo[_].ObjID,R=u.ItemInfo[_].X,P=u.ItemInfo[_].Fixed;if(_==u.ItemInfo.length-1)if("N"==S||"B"==S){var Y=-1;if(void 0!==j&&""!==j)h=u.ItemInfo[get_shelf_item_ind(s,d,j,c)].X;else{if("HANGINGBAR"==n&&void 0!==u.ItemInfo[_].ShelfEnd)var A=u.ItemInfo[_].ShelfEnd;else A=u.X+u.W/2;h=A-e/2+u.ROverhang}}else h=u.ItemInfo[_].X;else if("N"==S||"B"==S){Y=-1;if(void 0!==j&&""!==j)h=u.ItemInfo[get_shelf_item_ind(s,d,j,c)].X;else{if("SHELF"==n){var k=0;for(const e of M)k>_&&(void 0===e.BottomObjID||""==e.BottomObjID)&&(Y=-1!==Y?Math.min(Y,k):k),k++}else Y=_+1;if(-1==Y){if("HANGINGBAR"==n&&void 0!==u.ItemInfo[_].ShelfEnd)A=u.ItemInfo[_].ShelfEnd;else A=u.X+u.W/2;h=A-e/2+u.ROverhang}else h=u.ItemInfo[Y].X-u.ItemInfo[Y].W/2-parseFloat(e)/2-l}}else h=u.ItemInfo[_].X;if("B"==g_isBookend&&W==g_movedObjID){h=u.ItemInfo[_].X;var z=u.ItemInfo[_].X+u.ItemInfo[_].W/2;if(_<u.ItemInfo.length-1){var X=u.ItemInfo[_+1].X-u.ItemInfo[_+1].W/2;z>X&&(h=X-e/2)}}h>R&&"B"==P&&(h=u.ItemInfo[_].X),h+e/2>L&&"Y"==g_validationFlag&&"N"==g_overhung_shelf_active?g_invalidPosition="Y":g_validationFlag="Y"}else if("L"==a){Y=-1;var L=u.X+u.W/2;W=u.ItemInfo[_].ObjID,P=u.ItemInfo[_].Fixed,R=u.ItemInfo[_].X;if(_>0)if("N"==S||"B"==S){Y=-1;void 0!==j&&""!==j&&(h=u.ItemInfo[get_shelf_item_ind(s,d,N,c)].X),void 0!==j&&""!=j||("SHELF"==n?$.each(M,(function(e,o){e<_&&(void 0===o.BottomObjID||""==o.BottomObjID)&&(Y=Math.max(Y,e))})):Y=_-1,h=-1==Y?y+parseFloat(e)/2-u.LOverhang:u.ItemInfo[Y].X+u.ItemInfo[Y].W/2+parseFloat(e)/2+l)}else h=u.ItemInfo[_].X;else if("N"==S||"B"==S){Y=-1;h=void 0!==j&&""!==j?u.ItemInfo[get_shelf_item_ind(s,d,N,c)].X:y+parseFloat(e)/2-u.LOverhang}else h=u.ItemInfo[_].X;if("B"==g_isBookend&&W==g_movedObjID){h=u.ItemInfo[_].X;var V=u.ItemInfo[_].X-u.ItemInfo[_].W/2;if(_>0){var G=u.ItemInfo[_-1].X+u.ItemInfo[_-1].W/2;V<G&&(h=G+e/2)}}h<R&&"B"==P&&(h=u.ItemInfo[_].X),h+e/2>L&&"Y"==g_validationFlag&&"N"==g_overhung_shelf_active?g_invalidPosition="Y":g_validationFlag="Y"}else if("E"==a||"F"==a){if("F"==a&&u.ItemInfo[_].BHoriz>1&&0==u.ItemInfo[_].CrushHoriz)u.ItemInfo[_].W=u.ItemInfo[_].RW+u.ItemInfo[_].SpreadItem*(u.ItemInfo[_].BHoriz-1);else if("E"==a&&u.ItemInfo[_].BHoriz>1&&r>0&&0==u.ItemInfo[_].CrushHoriz)u.ItemInfo[_].W=u.ItemInfo[_].RW+r*(u.ItemInfo[_].BHoriz-1);else if("F"==a&&u.ItemInfo[_].BHoriz>1&&"0"!==u.ItemInfo[_].Orientation){var U=u.ItemInfo[_],[Z,J,Q,q,K,ee]=get_new_orientation_dim(U.Orientation,U.OW,U.OH,U.OD);("H"==K&&0==U.CrushVert||"D"==K&&0==U.CrushD)&&(u.ItemInfo[_].W=u.ItemInfo[_].RW+u.ItemInfo[_].SpreadItem*(u.ItemInfo[_].BHoriz-1))}if(_>0)if("N"==S||"B"==S){Y=-1;if(void 0!==j&&""!==j)h=u.ItemInfo[get_shelf_item_ind(s,d,N,c)].X;else{if("SHELF"==n){k=0;for(const e of M)k<_&&(void 0===e.BottomObjID||""==e.BottomObjID)&&(Y=Math.max(Y,k)),k++}else Y=_-1;if(-1==Y)h=y+u.ItemInfo[_].W/2-u.LOverhang;else{var oe=u.ItemInfo[_],te=u.ItemInfo[Y],[ne,ie,re,ae,le,se]=get_new_orientation_dim(oe.Orientation,oe.OW,oe.OH,oe.OD),[de,_e,ge,fe,pe,ce]=get_new_orientation_dim(te.Orientation,te.OW,te.OH,te.OD);if(oe.CrushHoriz>0&&"0"==oe.Orientation)var Ie=oe.RW*(1-oe.CrushHoriz/100)+oe.SpreadItem*(oe.BHoriz-1);else if("0"!==oe.Orientation&&"H"==le&&oe.CrushVert>0)Ie=oe.RW*(1-oe.CrushVert/100)+oe.SpreadItem*(oe.BHoriz-1);else if("0"!==oe.Orientation&&"D"==le&&oe.CrushD>0)Ie=oe.RW*(1-oe.CrushD/100)+oe.SpreadItem*(oe.BHoriz-1);else Ie=oe.W;if(te.CrushHoriz>0&&"0"==te.Orientation)var me=te.RW*(1-te.CrushHoriz/100)+te.SpreadItem*(te.BHoriz-1);else if("0"!==te.Orientation&&"H"==pe&&te.CrushVert>0)me=te.RW*(1-te.CrushVert/100)+te.SpreadItem*(te.BHoriz-1);else if("0"!==te.Orientation&&"D"==pe&&te.CrushD>0)me=te.RW*(1-te.CrushD/100)+te.SpreadItem*(te.BHoriz-1);else me=te.W;if(h=wpdSetFixed("F"==a?te.X+me/2+Ie/2+oe.SpreadItem:te.X+te.W/2+oe.W/2+oe.SpreadItem),_==u.ItemInfo.length-1&&"N"==g_overhung_shelf_active){const e=wpdSetFixed(u.X+u.W/2+u.ROverhang);wpdSetFixed(h+Ie/2)>e&&(h=e-Ie/2,"Y"===m&&"HANGINGBAR"===n||(oe.SpreadItem=wpdSetFixed(h-Ie/2-(te.X+me/2))))}}}}else h=u.ItemInfo[_].X;else{var he=0,ue=!1;for(const e of u.ItemInfo)he=wpdSetFixed(he+e.W);if(he>wpdSetFixed(u.W+u.ROverhang+u.LOverhang)&&(ue=!0),0==_&&ue)h=wpdSetFixed(u.ItemInfo[_].W/2+(u.X-he/2)-u.LOverhang);else if("N"==S||"B"==S){Y=-1;if(void 0!==j&&""!==j)h=u.ItemInfo[get_shelf_item_ind(s,d,j,c)].X;else{if(u.ItemInfo[_].CrushHoriz>0&&u.ItemInfo[_].BHoriz>1&&"F"==a&&"0"==u.ItemInfo[_].Orientation)var Se=u.ItemInfo[_].RW*(1-u.ItemInfo[_].CrushHoriz/100)+u.ItemInfo[_].SpreadItem*(u.ItemInfo[_].BHoriz-1);else if(u.ItemInfo[_].BHoriz>1&&"F"==a&&"0"!==u.ItemInfo[_].Orientation){U=u.ItemInfo[_];var[Z,J,Q,q,K,ee]=get_new_orientation_dim(U.Orientation,U.OW,U.OH,U.OD),De="H"==K?U.CrushVert:"D"==K?U.CrushD:U.CrushHoriz;Se=u.ItemInfo[_].RW*(1-De/100)+u.ItemInfo[_].SpreadItem*(u.ItemInfo[_].BHoriz-1)}else Se=u.ItemInfo[_].W;h=wpdSetFixed(y+Se/2-u.LOverhang)}}else h=u.ItemInfo[_].X}}else"M"==a&&(h=u.ItemInfo[_].X);else if("BASKET"==n){var be=get_max_merch(s,d,_,"N",i,c),ve=u.ItemInfo[_].Quantity;if("DIVIDER"!==u.ItemInfo[_].Item){if("LR"==D){if("T"==b||"M"==b)u.ItemInfo[_].W=u.ItemInfo[_].D*ve,u.ItemInfo[_].H=be;else if("F"==b){var xe=get_basket_fill_count(s,d,D,b,v,be,O,c);u.ItemInfo[_].W=u.ItemInfo[_].D*xe,u.ItemInfo[_].H=be,u.ItemInfo[_].Quantity=xe}if(0==_)h=y+parseFloat(u.ItemInfo[_].W)/2,u.ItemInfo[_].Y=C+x/2+u.ItemInfo[_].H/2;else{var Oe=u.ItemInfo[_-1].Item,Ce=_-1;V=y;"DIVIDER"==Oe?void 0!==u.ItemInfo[_-2]&&(Ce=_-2,V=u.ItemInfo[Ce].X+u.ItemInfo[Ce].W/2):V=u.ItemInfo[Ce].X+u.ItemInfo[Ce].W/2,h=V+parseFloat(u.ItemInfo[_].W)/2,u.ItemInfo[_].Y=C+x/2+u.ItemInfo[_].H/2}}else if("BT"==D){if("T"==b)u.ItemInfo[_].W=v,u.ItemInfo[_].H=.02,u.ItemInfo[_].Quantity=1;else if("F"==b){xe=get_basket_fill_count(s,d,D,b,v,be,O,c);u.ItemInfo[_].W=v,u.ItemInfo[_].H=u.ItemInfo[_].OD*xe,u.ItemInfo[_].Quantity=xe}else"M"==b&&(u.ItemInfo[_].W=v,u.ItemInfo[_].H=u.ItemInfo[_].OD*ve,u.ItemInfo[_].Quantity=ve);if(h=y+parseFloat(u.ItemInfo[_].W)/2,0==_)u.ItemInfo[_].Y=C+x/2+u.ItemInfo[_].H/2,h=y+parseFloat(u.ItemInfo[_].W)/2;else h=y+parseFloat(u.ItemInfo[_].W)/2,"DIVIDER"==(Oe=u.ItemInfo[_-1].Item)?void 0!==u.ItemInfo[_-2]?(Ce=_-2,u.ItemInfo[_].Y=u.ItemInfo[Ce].Y+u.ItemInfo[Ce].H/2+parseFloat(u.ItemInfo[_].H)/2):u.ItemInfo[_].Y=C+x/2+u.ItemInfo[_].H/2:u.ItemInfo[_].Y=u.ItemInfo[_-1].Y+u.ItemInfo[_-1].H/2+parseFloat(u.ItemInfo[_].H)/2}else if("FB"==D){if(u.ItemInfo[_].W=v,u.ItemInfo[_].H=be,h=y+parseFloat(u.ItemInfo[_].W)/2,u.ItemInfo[_].Y=C+x/2+u.ItemInfo[_].H/2,"F"==b)xe=get_basket_fill_count(s,d,"FB","F",v,be,O,c);else if(b="M")xe=ve;else xe=1;u.ItemInfo[_].Quantity=xe}}else h=(u.ItemInfo[_].Item,u.ItemInfo[_].X)}else if("CHEST"==n&&"N"==g_chest_as_pegboard||"PALLET"==n){var je=u.ItemInfo[_].Exists,Me=u.ItemInfo[_].Dragged;let o;"PALLET"==n&&void 0!==j&&""!==j&&(o=get_shelf_item_ind(s,d,j,c)),"PALLET"==n&&void 0!==j&&""!==j&&o>=0?h=u.ItemInfo[o].X:"Y"==Me?h=1==f&&"N"==g?y+parseFloat(e)/2-u.LOverhang:f>1&&"N"==g?_>0?u.ItemInfo[_-1].X+u.ItemInfo[_-1].W/2+parseFloat(e)/2+l:y+parseFloat(e)/2-u.LOverhang:i+e/2>u.X+u.W/2?_!==g_edited_item_index?u.ItemInfo[_].X:_>0?u.ItemInfo[_-1].X+u.ItemInfo[_-1].W/2+parseFloat(e)/2+l:y+parseFloat(e)/2-u.LOverhang:u.ItemInfo[_].X:(u.ItemInfo[_].Dragged="Y",h="E"==je?u.ItemInfo[_].X:_>0&&g_edited_item_index!==_?u.ItemInfo[_-1].X+u.ItemInfo[_-1].W/2+parseFloat(e)/2+l:g_edited_item_index!==_&&0==_?y+parseFloat(e)/2+u.LOverhang:g_edited_item_index==_&&"Y"==g?u.ItemInfo[_].X:i)}else h="ROD"==n?u.X:"PEGBOARD"==n||"CHEST"==n&&"Y"==g_chest_as_pegboard?find_pegboard_gap(e,o,u.ItemInfo[_].X,u.ItemInfo[_].Y,r,s,d,_,g_edited_item_index,"N",c,"Y",g_auto_x_space,g_auto_y_space,I):i;return logDebug("function : get_item_xaxis","E"),wpdSetFixed(h)}catch(e){error_handling(e)}}function get_top_y(e,o,t,n,i,r){var a=e-t,l=e+t,s=0,d=-1,_=-1;for(var g of o){if(s<n){var f=g.Y+g.H/2;f<=l&&f>=a&&r.X+r.W/2>g.X+g.W/2&&(d=f,_=s)}s++}return d>-1?d-=i/2:d=e-i/2,[d,_]}function find_pegboard_gap(e,o,t,n,i,r,a,s,d,_,g,f="Y",p,c,I){logDebug("function : find_pegboard_gap; width : "+e+"; height : "+o+"; locationX : "+t+"; locationY : "+n+"; horiz_gap : "+i+"; p_module_index : "+r+"; p_shelf_index : "+a+"; i_item_index : "+s+"; i_edited_item_index : "+d+"; validate : "+_,"S");try{var m=-1,h=g_pog_json[g].ModuleInfo[r].ShelfInfo[a].ItemInfo,u=g_pog_json[g].ModuleInfo[r].ShelfInfo[a],S=(h[s].Item,h.length),D=h[s].Exists,b=(h[s].X,h[s].FromProductList),v=(h[s].SameShelf,h[s].Edited),x=u.AllowOverLap,O=h[s].DropY,C=u.HorizSpacing,j=(u.VertiSpacing,u.HorizStart,u.AutoPlacing),M=u.Y+u.H/2+u.UOverHang,y=u.Y-u.H/2-u.LoOverHang,H=u.X-u.W/2-u.LOverhang,w=u.X+u.W/2+u.ROverhang,T=u.peg_vert_values,F=u.peg_horiz_values,N=u.Y,E=-1!==O?O+o/2+.003:"",B=[],W=[],R=h,P="Y",Y=0,A=0,k="N";void 0===j&&(j="N"),T.length>0&&$.each(T,(function(e,o){B.push(N+T[e])})),F.length>0&&$.each(F,(function(e,o){W.push(g_pog_json[g].ModuleInfo[r].ShelfInfo[a].X+F[e])}));var z=n+h[s].H/2;if(B.length>0)var X=B.reduce(((e,o)=>Math.abs(o-z)<Math.abs(e-z)?o:e));if("E"==D)m=h[s].X;else if("Y"==j&&"Y"==g_chest_as_pegboard&&"CHEST"==u.ObjType){var[m,L]=get_auto_placing_item_loc(r,a,g,s,e,o,p,c);-1!==m&&(h[s].X=m,h[s].Y=L,V="Y")}else if(void 0!==b&&"Y"==b||"Y"==g_pegbrd_auto_placing&&"Y"==v){if(0==s)m=H+e/2+C,"Y"==g_pegbrd_auto_placing&&"Y"==v?(m=t,L="N"==I?n:X-o/2):L=B[0]-o/2,h[s].Y=L,h[s].SecondTier="N",h[s].X=m;else if(S>1&&s>0){for(l=0;l<B.length&&!(m>-1)&&B[l]-o>y;l++)if(console.log("peg_vert_details[l]",B[l],E,v),""!==E&&B[l]<=E&&"Y"==v||"N"==v||""==E){for(Y=0;Y<W.length&&W[Y]+e<w;Y++){"Y"==g_pegbrd_auto_placing&&"Y"==v?("CHEST"!==u.ObjType?(z=wpdSetFixed(t-e/2+.01),oe=wpdSetFixed(t+e/2+.01)):(z=wpdSetFixed(t-e/2),oe=wpdSetFixed(t+e/2)),q=wpdSetFixed(B[l]),K=wpdSetFixed(B[l]-o)):("CHEST"!==u.ObjType?(z=wpdSetFixed(W[Y]+.01),oe=wpdSetFixed(W[Y]+e+.01)):(z=wpdSetFixed(W[Y]),oe=wpdSetFixed(W[Y]+e)),q=wpdSetFixed(B[l]),K=wpdSetFixed(B[l]-o));A=0;var V="Y",G=-1;for(const e of R){if(A<s){if(div_start=wpdSetFixed(e.X-e.W/2),div_end=wpdSetFixed(e.X+e.W/2),Z=wpdSetFixed(e.Y+e.H/2),(q>(J=wpdSetFixed(e.Y-e.H/2))&&Z>q||oe>w)&&"N"==j){V="N",g_prevX=Y,g_prevY=l,G=A;break}if((div_start<oe&&div_start>=z||div_end>z&&div_end<=oe)&&(J<q&&J>=K||Z<=q&&Z>K)||(z<div_start&&oe>div_start||z<div_end&&oe>=div_end)&&q<=Z&&K>=J||(div_start<=z&&div_end>=oe||div_start>=z&&div_end<=oe)&&(Z>=q&&K>=J||Z>=q&&J<=K||Z>q&&J<=q)||z<div_start&&oe>=div_end&&q<=Z&&q>J&&K<=J||z>div_start&&oe<=div_end&&q>=Z&&K<Z&&K<=J||z<div_start&&oe>=div_end&&q<=Z&&K>=J||z<div_start&&oe>=div_end&&q<Z&&q>J||z>=div_start&&z<div_end&&K>=J&&K<Z){V="N",g_prevX=Y,g_prevY=l,G=A;break}}A++}if("Y"==V){if(g_prevX++,g_prevY++,m=z+e/2,"CHEST"!==g_pog_json[g].ModuleInfo[r].ShelfInfo[a].ObjType&&H==z-.02&&(m-=.01),h[s].X=m,"CHEST"==u.ObjType&&"Y"==j){var[L,U]=get_top_y(q,R,.001,s,o,h[s]);h[s].Y=L-c}else h[s].Y="N"==I?n:q-o/2;h[s].SecondTier="Y",k="Y";break}if("Y"==x){var Z=h[G].Y+h[G].H/2,J=h[G].Y-h[G].H/2;if(q=n+h[s].H/2,(K=n-h[s].H/2)<h[G].Y&&Z<K||q>h[G].Y&&q<Z||Z>n&&Z<q||J<n&&Z>q){var Q=h[G].D*h[G].BaseD+h[s].D*h[s].BaseD;if(g_pog_json[g].ModuleInfo[r].ShelfInfo[a].MaxMerch>0){if(Q>g_pog_json[g].ModuleInfo[r].ShelfInfo[a].MaxMerch){P="D";break}P="Y",h[s].X=t,h[s].Y="N"==I?n:X-o/2;break}P="Y",h[s].X=t,h[s].Y="N"==I?n:X-o/2;break}P="Y",h[s].X=t,h[s].Y="N"==I?n:X-o/2;break}}if("Y"==k)break}}}else if("N"==D&&("N"==b||void 0===b)){var q=wpdSetFixed(h[s].Y+o/2),K=wpdSetFixed(h[s].Y-o/2),ee=h[s].X;isNaN(ee)&&(ee=g_final_x);z=wpdSetFixed(ee-e/2);var oe=wpdSetFixed(ee+e/2);h[s].ItemID,V="Y",A=0;for(const e of R){if(A!==s&&(div_start=wpdSetFixed(e.X-e.W/2),div_end=wpdSetFixed(e.X+e.W/2),Z=wpdSetFixed(e.Y+e.H/2),J=wpdSetFixed(e.Y-e.H/2),(div_start<oe&&div_start>=z||div_end>z&&div_end<=oe)&&(J<q&&J>=K||Z<=q&&Z>K)||(z<div_start&&oe>div_start||z<div_end&&oe>=div_end)&&q<=Z&&K>=J||(div_start<=z&&div_end>=oe||div_start>=z&&div_end<=oe)&&(Z>=q&&K>=J||Z>=q&&J<=K||Z>q&&J<=q)||z<div_start&&oe>=div_end&&q<=Z&&q>J&&K<=J||z>div_start&&oe<=div_end&&q>=Z&&K<Z&&K<=J||z<div_start&&oe>=div_end&&q<=Z&&K>=J||z<div_start&&oe>=div_end&&q<Z&&q>J||z>=div_start&&z<div_end&&K>=J&&K<Z)){V="N",G=A,console.log("items",e.Item,e.X,e.W),console.log("div_start ",div_start," div end ",div_end," div top ",Z,"div bottom ",J),console.log("item_start ",z," item end ",oe," item top ",q," item bottom ",K);break}A++}if("Y"==V){if(m="CHEST"!==u.ObjType?z+h[s].W/2+.002:ee,prevX=m,"CHEST"!==g_pog_json[g].ModuleInfo[r].ShelfInfo[a].ObjType){if("N"==g_mselect_drag&&"Y"==f)if("N"==I)L=n;else for(l=0;l<B.length;l++)if(B[l]<g_finalY+o/2){var te=wpdSetFixed(g_pog_json[g].ModuleInfo[r].ShelfInfo[a].X+g_pog_json[g].ModuleInfo[r].ShelfInfo[a].H/2);g_pog_json[g].ModuleInfo[r].ShelfInfo[a].UOverHang>0&&te<g_finalY+o/2&&te>g_finalY-o/2?h[s].Y=wpdSetFixed(B[l]):h[s].Y=wpdSetFixed(B[l])-o/2;break}}else"CHEST"!==u.ObjType&&H==z-.02&&(m-=.01),h[s].X=m,"N"==I&&"CHEST"!==u.ObjType?h[s].Y=n:h[s].Y=q-o/2;h[s].SecondTier="Y"}else if("Y"==x){Z=h[G].Y+h[G].H/2,J=h[G].Y-h[G].H/2;if(q=n+h[s].H/2,(K=n-h[s].H/2)<h[G].Y&&Z<K||q>h[G].Y&&q<Z||Z>n&&Z<q||J<n&&Z>q){Q=h[G].D*h[G].BaseD+h[s].D*h[s].BaseD;g_pog_json[g].ModuleInfo[r].ShelfInfo[a].MaxMerch>0&&Q>g_pog_json[g].ModuleInfo[r].ShelfInfo[a].MaxMerch?P="D":(P="Y",h[s].X=t,h[s].Y="N"==I?n:X-o/2)}else P="Y",h[s].X=t,h[s].Y="N"==I?n:X-o/2}if("Y"==V){q=wpdSetFixed(h[s].Y+o/2),K=wpdSetFixed(h[s].Y-o/2),ee=h[s].X;isNaN(ee)&&(ee=g_final_x);z=wpdSetFixed(ee-e/2),oe=wpdSetFixed(ee+e/2);(z<H||oe<H||oe>w||q>M||K<y)&&(m=-1,V="N")}}return logDebug("function : find_pegboard_gap","E"),"Y"==_&&"D"==P&&"Y"==x?"D":"Y"==_&&"N"==P&&"Y"==x?"N":"Y"==_&&"Y"==P&&"Y"==x?t:"Y"==_&&-1==m?"N":-1==m&&"N"==_?h[s].X:m}catch(e){error_handling(e)}}async function recreate_compare_views(e,o){if(logDebug("function : recreate_compare_views; view_ind : "+e+"; reload : "+o,"S"),"Y"==g_compare_pog_flag&&"PREV_VERSION"!==g_compare_view&&"POG"!==g_compare_view)if("POG"==e&&"Y"==o){var t=JSON.parse(JSON.stringify(g_pog_json));await create_module_from_json([g_pog_json[g_ComViewIndex]],"N","F","N","E","N","N","Y","Y","","Y",g_scene_objects[g_ComViewIndex].scene.children[2],g_scene_objects[g_ComViewIndex].scene,g_ComViewIndex,g_ComViewIndex);var n=JSON.parse(JSON.stringify(g_multi_pog_json));(g_multi_pog_json=JSON.parse(JSON.stringify(t))).push(n[0]),g_pog_json=g_multi_pog_json;var i=get_min_max_xy(g_ComViewIndex).split("###");set_camera_z(g_scene_objects[g_ComViewIndex].scene.children[0],parseFloat(i[2]),parseFloat(i[3]),parseFloat(i[0]),parseFloat(i[1]),g_offset_z,parseFloat(i[4]),parseFloat(i[5]),g_ComViewIndex)}else if("CUTAWAY"==e){var r=g_scene_objects[g_pog_index].scene.children[2].clone(!0);g_scene_objects[g_ComViewIndex].scene.children[2]=r,set_camera_z(g_scene_objects[g_ComViewIndex].scene.children[0],g_cutaway_cam_detail[0].x,g_cutaway_cam_detail[0].y,g_cutaway_cam_detail[0].width,g_cutaway_cam_detail[0].height,g_cutaway_cam_detail[0].offset,g_cutaway_cam_detail[0].x,g_cutaway_cam_detail[0].y,!0,g_ComViewIndex)}else if("POG"!==e&&"N"==o&&"EDIT_PALLET"!==e){console.log("g_ComViewIndex",g_ComViewIndex,e),g_scene_objects.splice(g_ComViewIndex,1),g_canvas_objects.splice(g_ComViewIndex,1),init(g_ComViewIndex);var a={};if(a.scene=g_scene,a.renderer=g_renderer,g_scene_objects.push(a),g_pog_json[g_ComViewIndex].H<.2)await create_compare_pog(e);else{await create_side(e,g_ComBaseIndex,g_ComViewIndex);g_scene_objects[g_ComViewIndex].scene.children[0].updateProjectionMatrix()}}else if("EDIT_PALLET"==e){old_pog_index=g_pog_index,console.log("g_ComBaseIndex",g_ComBaseIndex,g_ComViewIndex);var[l,s]=get_shelf_index(g_edit_pallet_shelfid,g_ComBaseIndex);-1!==l&&-1!==s&&(update_item_distance(l,s,g_ComBaseIndex,"N"),g_pog_json[g_ComViewIndex].ModuleInfo[0].ShelfInfo[0]=JSON.parse(JSON.stringify(g_pog_json[g_ComBaseIndex].ModuleInfo[l].ShelfInfo[s])),g_pog_json[g_ComViewIndex].ModuleInfo[0].ShelfInfo[0].PrimeShelfObjID=g_pog_json[g_ComBaseIndex].ModuleInfo[l].ShelfInfo[s].SObjID),g_pog_json.splice(g_ComViewIndex,1),g_scene_objects.splice(g_ComViewIndex,1),g_canvas_objects.splice(g_ComViewIndex,1),await edit_pallet("N",l,s,g_ComBaseIndex,"N")}logDebug("function : recreate_compare_views","E")}var new_count=0;function animate_all(e){logDebug("function : limited_animate","S"),setTimeout((function(){if(new_count<5){new_count+=1,async function(){await render_all_pog()}(),requestAnimationFrame(animate_all)}else new_count=0;logDebug("function : limited_animate","E")}),50)}function animate_all_pog(){requestAnimationFrame(animate_all)}async function render_all_pog(){var e=0;for(const i of g_scene_objects){var o=g_canvas_objects[e].getContext("2d");g_renderer.setPixelRatio(window.devicePixelRatio);var t=g_canvas_objects[e].width,n=g_canvas_objects[e].height;g_renderer.setSize(t,n),g_scene_objects[e].scene.children[0].aspect=t/n,g_renderer.render(g_scene_objects[e].scene,g_scene_objects[e].scene.children[0]),null!==o&&o.drawImage(g_renderer.domElement,0,0,t,n),e++}}async function add_carpark_item(e,o,t,n,i,r,a,l,s,d,_,g,f,p,c,I){logDebug("function : add_carpark_item; uuid : "+e+"; width : "+o+"; height : "+t+"; depth : "+n+"; color : "+i+"; x : "+r+"; y : "+a+"; z : "+l+"; p_module_index : "+s+"; p_shelf_index : "+d+"; i_item_index : "+_+"; recreate : "+g+"; with_image : "+p+"; angle : "+c,"S");try{console.log("add carpark ",p);var m=g_pog_json[I].ModuleInfo[s].Carpark[d].ItemInfo[_],h=m.NVal,u=m.Orientation,S=m.BVert,D=m.BHoriz,b=g_orientation_json[u].split("###");return new Promise((function(n,l){var _="N",g=-1,f=m.Item,u=0;for(const e of g_ItemImages){if(f==e.Item&&b[0]==e.Orientation&&null!==e.ItemImage){_="Y",g=u;break}u++}if("Y"==_&&"Y"==p){var v=new Image,x=new THREE.Texture(v);v.onload=()=>{x.needsUpdate=!0},v.src="data:image/jpeg;base64,"+g_ItemImages[g].ItemImage;var O=new THREE.BoxGeometry(o,t,.001),C=new THREE.MeshStandardMaterial({map:x});0==h&&(x.wrapS=THREE.RepeatWrapping,x.wrapT=THREE.RepeatWrapping,90==c||270==c?x.repeat.set(S,D):x.repeat.set(D,S),90==c?c=270:270==c&&(c=90),x.rotation=c*Math.PI/180),items=new THREE.Mesh(O,C),items.position.x=r,items.position.z=.001,items.position.y=a}else{var j=parseInt(i.replace("#","0x"),16),M=new THREE.Color(j);items=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshStandardMaterial({color:M})),items.position.z=.001,items.position.x=r,items.position.y=a}g_world.add(items);var y=m;items.uuid=e,items.ItemID=y.Item,items.Description=y.Desc,items.HorizFacing=y.BHoriz,items.VertFacing=y.BVert,items.DFacing=y.BaseD,items.DimUpdate=y.DimUpdate,items.SellingPrice=y.SellingPrice,items.SalesUnit=y.SalesUnit,items.NetSales=y.NetSales,items.CogsAdj=y.CogsAdj,items.RegMovement=y.RegMovement,items.AvgSales=y.AvgSales,items.ItemStatus=y.ItemStatus,items.CDTLvl1=y.CDTLvl1,items.CDTLvl2=y.CDTLvl2,items.CDTLvl3=y.CDTLvl3,items.ActualDPP=y.ActualDPP,items.DPPLoc=y.DPPLoc,items.StoreSOH=y.StoreSOH,items.StoreNo=y.StoreNo,items.WeeksOfInventory=y.WeeksOfInventory,items.ShelfPrice=y.ShelfPrice,items.PromoPrice=y.PromoPrice,items.DiscountRate=y.DiscountRate,items.PriceChangeDate=y.PriceChangeDate,items.WeeksOfInventory=y.WeeksOfInventory,items.Qty=y.Qty,items.WhStock=y.WhStock,items.StoreStock=y.StoreStock,items.StockIntransit=y.StockIntransit,items.GrossProfit=y.GrossProfit,items.WeeksCount=y.WeeksCount,items.MovingItem=y.MovingItem,items.Profit=y.Profit,items.TotalMargin=y.TotalMargin,items.W=y.W,items.H=y.H,items.D=y.D,items.Color=y.Color,items.Barcode=y.Barcode,items.Desc=y.Desc,items.Brand=y.Brand,items.Group=y.Group,items.Dept=y.Dept,items.Class=y.Class,items.SubClass=y.SubClass,items.StdUOM=y.StdUOM,items.SizeDesc=y.SizeDesc,items.Supplier=y.Supplier,items.LocID=y.LocID,items.SupplierName=y.SupplierName,items.ItemDim=g_msg_h+": "+(100*y.OH).toFixed(2)+" ("+g_msg_Sq+" : "+y.CrushVert+") "+g_msg_w+": "+(100*y.OW).toFixed(2)+" ("+g_msg_Sq+" : "+y.CrushHoriz+") "+g_msg_d+": "+(100*y.OD).toFixed(2)+" ("+g_msg_Sq+" : "+y.CrushD+")",items.OrientationDesc=y.OrientationDesc,items.StoreCnt=y.StoreCnt,items.RotationDegree=0,items.OW=100*y.OW,items.OH=100*y.OH,items.OD=100*y.OD,items.CrushW=y.CrushHoriz,items.CrushH=y.CrushVert,items.CrushD=y.CrushD,items.Shelf=g_pog_json[I].ModuleInfo[s].Carpark[d].Shelf,items.Rotation=0,items.ItemSlope=0,items.Rotation="N",items.ImageExists="N",items.DescSecond=y.DescSecond,items.DfacingUpd=y.DfacingUpd,items.ItmDescChi=y.ItmDescChi,items.ItmDescEng=y.ItmDescEng,items.TotalUnitsCalc=y.BHoriz*y.BVert*y.BaseD,items.PkSiz=y.PkSiz;var H=y.CapFacing*y.CapDepth*y.CapHorz;items.Cpct=y.BHoriz*y.BVert*y.BaseD+(isNaN(H)?0:H),items.Brand_Category=y.Brand_Category,items.ClassName=y.ClassName,items.Uda_item_status=y.Uda_item_status,items.Gobecobrand=y.Gobecobrand,items.Internet=y.Internet,items.Categ=y.Categ;y.SizeDesc.split("*");if(items.ItemSize=y.ItemSize,items.SplrLbl=y.SplrLbl,items.COO=y.COO,items.EDLP=y.EDLP,items.LoGrp=y.LoGrp,items.SqzPer=(void 0!==y.CrushHoriz?y.CrushHoriz:0)+":"+(void 0!==y.CrushVert?y.CrushVert:0)+":"+(void 0!==y.CrushD?y.CrushD:0),items.InternationalRng=y.InternationalRng,items.NewItem=y.NewItem,items.DaysOfSupply=y.DaysOfSupply,items.BrandType=y.BrandType,items.LiveNewItem=y.LiveNewItem,items.GoGreen=y.GoGreen,items.UnitperCase=y.UnitperCase,items.Orientation=y.Orientation,items.UnitperTray=y.UnitperTray,void 0!==y.Dept&&""!==y.Dept&&null!==y.Dept)var w=y.Dept.split("-");else w="";if(void 0!==y.Class&&""!==y.Class&&null!==y.Class)var T=y.Class.split("-");else T="";if(void 0!==y.SubClass&&""!==y.SubClass&&null!==y.SubClass)var F=y.SubClass.split("-");else F="";items.ClassName=w[0]+"/"+T[0]+"/"+F[0],items.UDA751=y.UDA751,items.UDA755=y.UDA755,items.Status=y.Status,items.StoreCnt=y.StoreCnt;var N=add_wireframe(items,2);items.WFrameID=N,items.ItemCondition=y.ItemCondition,items.AUR=y.AUR,items.ItemRanking=y.ItemRanking,items.WeeklySales=y.WeeklySales,items.WeeklyNetMargin=y.WeeklyNetMargin,items.WeeklyQty=y.WeeklyQty,items.NetMarginPercent=y.NetMarginPercent,items.CumulativeNM=y.CumulativeNM,items.TOP80B2=y.TOP80B2,items.ItemBrandC=y.ItemBrandC,items.ItemPOGDept=y.ItemPOGDept,items.ItemRemark=y.ItemRemark,items.RTVStatus=y.RTVStatus,items.Pusher=y.Pusher,items.Divider=y.Divider,items.BackSupport=y.BackSupport,items.CWPerc=y.CWPerc,items.CHPerc=y.CHPerc,items.CDPerc=y.CDPerc,items.OOSPerc=y.OOSPerc,items.InitialItemDesc=y.InitialItemDesc,items.InitialBrand=y.InitialBrand,items.InitialBarcode=y.InitialBarcode,n(items.id);var E=g_world.getObjectById(items.id);"E"==items.DimUpdate?(E.BorderColour=g_dim_error_color,E.WireframeObj.material.color.setHex(E.BorderColour)):"N"==items.Status?(E.BorderColour=g_status_error_color,E.Status="N",E.WireframeObj.material.color.setHex(E.BorderColour)):"No"==nvl(items.MovingItem)&&"Y"==g_pogcr_auto_hlite_non_mv_item?(E.BorderColour=g_nonMovingItemColor,E.WireframeObj.material.color.setHex(E.BorderColour)):items.OOSPerc>80&&"Y"==g_pogcr_enbl_oos_border?(E.BorderColour=g_pogcr_oos_border_color,E.WireframeObj.material.color.setHex(E.BorderColour)):E.BorderColour=0,logDebug("function : add_carpark_item","E")}))}catch(e){error_handling(e)}}async function refresh_sales_data(e,o,t,n,i,r,a,l="Y",s,d,_="N",g=g_pog_index,f="N"){return logDebug("function : send_to_db; refresh_sales_data : ","S"),new Promise((function(_,p){console.log("refresh sales ",e,o,t,n,i,r,a,l,"ACTUAL POG",s,"SELECTED POG",d,"N",g=g_pog_index),"Y"==a&&addLoadingIndicator(),apex.server.process("SALES_REFRESH",{x01:s,x02:o,x03:e,x04:d},{dataType:"text"}).done((function(s){if(""!==$.trim(s))if(console.log("refresh_sales_data",s),"Y"==$v("P25_POGCR_SALES_INFO_REFRESH_DTL")?g_pog_json[g].SalesRrshDtl="Date: "+getDateTime():g_pog_json[g].SalesRrshDtl="Date: "+getDateTime()+" | Sales Week: "+e+" | Store: "+o,s.indexOf("Error:")>=0&&"N"==f)"Y"==a&&removeLoadingIndicator(regionloadWait),raise_error(s.substr(6));else if(s.indexOf("Warn:")>=0&&"N"==f)"Y"==a&&removeLoadingIndicator(regionloadWait),alert(s.substr(5)),_("Warning"+s.substr(5));else{try{var d=JSON.parse(s);delete g_pog_json[g].SalesInfo,g_pog_json[g].SalesInfo=d}catch{"Y"==a&&removeLoadingIndicator(regionloadWait),"Y"==l?raise_error(s):_("success")}!async function(){"Y"==i&&await showHideDaysOfSupplyLabel(g_show_days_of_supply,"N",g,"Y","Y",t,n),"Y"==a&&removeLoadingIndicator(regionloadWait)}(),"Y"==r&&(apex.message.showPageSuccess(get_message("POGCR_SALES_REFRESH")),closeInlineDialog("open_refresh_sales")),_("success")}}))}))}function getCombinationShelf(e,o){try{logDebug("function : getCombinationShelf; p_pog_index : "+e+"; pShelfName : "+o,"S");var t=-1,n=-1;if(void 0!==g_combinedShelfs&&g_combinedShelfs.length>0&&g_combinedShelfs.length>0){var i=0;for(combination of g_combinedShelfs){var r=0;for(shelf_info of combination){if(shelf_info.Shelf==o&&shelf_info.PIndex==e){t=i,n=r;break}r++}if(-1!==t&&-1!==n)break;i++}}return[t,n]}catch(e){logDebug("function : getCombinationShelf","E"),error_handling(e)}}function save_pog_to_json(e){return logDebug("function : save_pog_to_json","S"),new Promise((function(o,t){apex.server.process("ADD_JSON_TO_COLL",{x01:"I",p_clob_01:JSON.stringify(e)},{dataType:"text",success:function(e){""!=$.trim(e)?raise_error(e):(logDebug("function : save_pog_to_json","E"),o("SUCESS"))},loadingIndicatorPosition:"page"})}))}function delete_items_coll(){return logDebug("function : delete_items_coll","S"),new Promise((function(e,o){apex.server.process("DELETE_ITEM_COLL",{x01:"I"},{dataType:"text",success:function(o){""!=$.trim(o)?raise_error(o):(logDebug("function : delete_items_coll","E"),e("SUCESS"))}})}))}function blink_effect(){for(var e=0;e<g_intersected.length;e++)if(0==g_intersected[e].blink_color||g_intersected[e].blink_color==g_dim_error_color||g_intersected[e].blink_color==g_status_error_color||g_intersected[e].blink_color==g_pogcr_oos_border_color&&"Y"==g_pogcr_enbl_oos_border)void 0!==g_intersected[e].ItemID?g_intersected[e].blink_color=g_select_item_color_change:g_intersected[e].blink_color=16777215;else for(e=0;e<g_intersected.length;e++)nvl(g_intersected[e].OOSPerc)>80&&"Y"==g_pogcr_enbl_oos_border&&(g_intersected[e].blink_color!=g_dim_error_color||g_intersected[e].blink_color!=g_status_error_color)?g_intersected[e].blink_color=g_pogcr_oos_border_color:g_intersected[e].blink_color=0;for(e=0;e<g_intersected.length;e++)void 0!==g_intersected[e]&&("Y"!=g_intersected[e].ImageExists||"Y"!=g_show_live_image&&"Y"!=g_show_live_image_comp||(g_intersected[e].WireframeObj.material.transparent=!1,g_intersected[e].WireframeObj.material.opacity=1),"E"!=g_intersected[e].DimUpdate&&"N"!=g_intersected[e].Status||0!=g_intersected[e].blink_color?g_intersected[e].WireframeObj.material.color.setHex(g_intersected[e].blink_color):g_intersected[e].WireframeObj.material.color.setHex(g_intersected[e].BorderColour));render_all_pog()}function reset_zoom(){logDebug("function : reset_zoom","S");try{if(void 0!==g_pog_json&&g_pog_json.length>0){if($(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),$("#maincanvas").css("cursor","auto"),$("#maincanvas1").css("cursor","auto"),g_manual_zoom_ind="N",g_area_zoom_ind="N",g_select_zoom_arr=[],"Y"==g_all_pog_flag)var e=0;else e=g_pog_index;for(const t of g_pog_json){if("N"==g_compare_pog_flag||"Y"==g_compare_pog_flag&&"CUTAWAY"!==g_compare_view){var o=get_min_max_xy(e).split("###");console.log("details_arr",o,e),set_camera_z(g_scene_objects[e].scene.children[0],parseFloat(o[2]),parseFloat(o[3]),parseFloat(o[0]),parseFloat(o[1]),g_offset_z,parseFloat(o[4]),parseFloat(o[5]),!0,e)}if(render(e),"Y"!=g_all_pog_flag)break;e++}g_intersected=[],g_mselect_drag="N",g_multiselect="N"}logDebug("function : reset_zoom","E")}catch(e){error_handling(e)}}function reset_indicators(){"Y"==g_show_fixel_label?$(".fixel_label").addClass("fixel_label_active"):$(".fixel_label").removeClass("fixel_label_active"),"Y"==g_show_item_color?$(".item_color").addClass("item_label_active"):$(".item_color").removeClass("item_label_active"),"Y"==g_show_item_label?$(".item_label").addClass("item_label_active"):$(".item_label").removeClass("item_label_active"),"N"==g_itemSubLabelInd?($(".item_sublabel").removeClass("item_sublabel_active"),$("#item_sublbl_sub .items").removeClass("item_sublabel_active")):($(".item_sublabel").addClass("item_sublabel_active"),$("#item_sublbl_sub ."+g_itemSubLabel).addClass("item_sublabel_active")),"Y"==g_show_fixel_space?$(".fixel_space").addClass("item_label_active"):$(".fixel_space").removeClass("item_label_active"),"Y"==g_show_item_desc&&"N"==g_show_live_image?$(".item_desc").addClass("item_label_active"):$(".item_desc").removeClass("item_label_active"),"Y"==g_show_notch_label?$(".notch_label").addClass("notch_label_active"):$(".notch_label").removeClass("notch_label_active"),"Y"==g_show_live_image?$(".live_image").addClass("live_image_active"):$(".live_image").removeClass("live_image_active"),"Y"==g_show_max_merch?$(".fixel_merch").addClass("max_merch_active"):$(".fixel_merch").removeClass("max_merch_active"),"Y"==g_max_facing_enabled?$(".max_facing").addClass("enable_maximize_facings"):$(".max_facing").removeClass("enable_maximize_facings"),"Y"==g_show_days_of_supply?$(".supply_days").addClass("item_label_active"):$(".supply_days").removeClass("item_label_active"),"Y"==g_show_item_color?$(".item_color_legends").css("display","block"):$(".item_color_legends").css("display","none"),"Y"==g_overhung_shelf_active?$(".overhung_shelf").addClass("overhung_shelf_active"):$(".overhung_shelf").removeClass("overhung_shelf_active"),logDebug("function : reset_indicators","E")}function set_multi_blink(e,o){if(logDebug("function : set_multi_blink","S"),void 0!==e&&e.length>0&&g_delete_details.length>0){if(g_intersected)for(var t=0;t<g_intersected.length;t++)g_select_color=g_intersected[t].BorderColour,g_intersected[t].WireframeObj.material.color.setHex(g_intersected[t].BorderColour),"Y"!=g_intersected[t].ImageExists||"Y"!=g_show_live_image&&"Y"!=g_show_live_image_comp||(g_intersected[t].WireframeObj.material.transparent=!0,g_intersected[t].WireframeObj.material.opacity=.0025);g_intersected=[],void 0!==g_delete_details&&($.each(g_delete_details,(function(e,t){var n=g_scene_objects[o].scene.children[2].getObjectById(t.ObjID);g_intersected.push(n)})),render_animate_selected())}logDebug("function : set_multi_blink","E")}function render_animate_selected(){if("Y"==g_product_list_blink){var e=[];for(const o of g_intersected)0!=nvl(o.ItemID)&&e.push(o.ItemID);e=[...new Set(e)],$("#draggable_table .product_list_blink").removeClass("product_list_blink");let o=-1;if($("#draggable_table thead th").each((function(e){if("product"===$(this).text().trim().toLowerCase())return o=e,!1})),-1!==o)for(const t of e)$('#draggable_table [data-id="'+t+'"] td').eq(o).addClass("product_list_blink")}clearInterval(g_myVar),g_myVar=setInterval((function(){blink_effect()}),500)}function download_pog_pdf(e,o){logDebug("function : download_pog_pdf","S");try{var t="f?p="+$v("pFlowId")+":"+$v("pFlowStepId")+":"+$v("pInstance")+":APPLICATION_PROCESS=DOWNLOAD_POG_PDF:NO::AI_RANDOM_STRING,AI_POG_CODE,AI_POG_VERSION:"+(new Date).getTime()+","+e+","+o;const n=document.createElement("a");n.href=t,n.download="",document.body.appendChild(n),n.click(),document.body.removeChild(n),logDebug("function : download_pog_pdf","E")}catch(e){error_handling(e),removeLoadingIndicator(regionloadWait)}}async function get_full_canvas(e,o){try{var t=document.getElementById("t_Header"),n=document.getElementById("top_bar"),i=document.getElementById("t_Body_nav"),r=document.getElementById("side_bar"),a=window.devicePixelRatio,l=null!==t?t.offsetHeight*a:0,s=null!==n?n.offsetHeight*a:0,d=null!==i?i.offsetWidth*a:0,_=null!==r?r.offsetWidth*a:0,g=document.createElement("canvas");g_windowHeight=window.innerHeight-(l+s),windowWidth=window.innerWidth-(d+_),g.width=windowWidth*o,g.height=g_windowHeight*o,g_camera=g_scene_objects[e].scene.children[0],g_scene_objects[e].scene.children[0].aspect=g.width/g.height,g_scene_objects[e].scene.children[0].updateProjectionMatrix();var f=get_min_max_xy(e).split("###");set_camera_z(g_camera,parseFloat(f[2]),parseFloat(f[3]),parseFloat(f[0]),parseFloat(f[1]),g_offset_z,parseFloat(f[4]),parseFloat(f[5]),!0,e);var p=g.getContext("2d");p.imageSmoothingEnabled=!0,g_renderer.setPixelRatio(window.devicePixelRatio);var c=g.width,I=g.height;return g_renderer.setSize(c,I),g_renderer.render(g_scene_objects[e].scene,g_scene_objects[e].scene.children[0]),p.drawImage(g_renderer.domElement,0,0,c,I),g_scene_objects[e].scene.children[0].aspect=g_canvas_objects[e].width/g_canvas_objects[e].height,g_scene_objects[e].scene.children[0].updateProjectionMatrix(),g}catch(e){throw error_handling(e),e}}async function get_chest_split_details(e,o){try{var t=[],n=0;if("Y"==e){for(const e of g_pog_json[o].ModuleInfo){if(void 0===e.ParentModule||null==e.ParentModule){e.ChestInfo=[];var i=0,r=wpdSetFixed(e.X-e.W/2),a=wpdSetFixed(e.X+e.W/2);for(const d of e.ShelfInfo){if(g_pog_json[o].ModuleInfo[n].ShelfInfo[i].SplitChest="N","CHEST"==d.ObjType){var l=wpdSetFixed(d.X-d.W/2),s=wpdSetFixed(d.X+d.W/2);(r>=l&&a<s||r>=l&&a<s||r<=l&&a<s&&a>l||r>=l&&a>s&&r<s)&&(d.MIndex=n,d.SIndex=i,t.push(d),g_pog_json[o].ModuleInfo[n].ShelfInfo[i].SplitChest="Y")}i++}}n++}for(chest of t){var d=wpdSetFixed(chest.X-chest.W/2),_=wpdSetFixed(chest.X+chest.W/2),g=chest.ItemInfo,f=0,p=0;for(const e of g_pog_json[o].ModuleInfo){if(void 0===e.ParentModule||null==e.ParentModule){var c="N",I=wpdSetFixed(e.X-e.W/2),m=wpdSetFixed(e.X+e.W/2),h=JSON.parse(JSON.stringify(chest));I>=d&&m<=_?(c="Y",h.W=e.W,h.X=e.X):I<=d&&m<=_&&m>d?(c="Y",h.W=wpdSetFixed(m-d),h.X=wpdSetFixed(d+h.W/2)):I>=d&&m>=_&&I<_&&(c="Y",h.W=wpdSetFixed(_-I),h.X=wpdSetFixed(I+h.W/2));var u=[],S=wpdSetFixed(h.X-h.W/2),D=wpdSetFixed(h.X+h.W/2);for(items of(p=chest.MIndex+1,g))items.X>=S&&items.X<=D&&(items.ModuleNo=p,u.push(items));"Y"==c&&(u.sort((function(e,o){return parseInt(e.LocID)-parseInt(o.LocID)})),h.ItemInfo=u,h.SplitChest="Y",g_pog_json[o].ModuleInfo[f].ChestInfo.push(h))}f++}0}}return"SUCCESS"}catch(e){throw error_handling(e),e}}function get_sales_info(e,o){try{var t={LeadTime:0,SalesAmt:0,VRM:0,GP:0,BEI:0,MarkDown:0,ShrinkageAmt:0,SalesUnit:0,SalesPerWeek:0,SalesUnitPerWeek:0,NonShrinkageAmt:0,ASP:0,VRMPer:"0%",GPPer:"0%",BEIPer:"0%",MarkDownPer:"0%",ShrinkageAmtPer:"0%",AvgSalesPerWeek:0,AvgQtyPerWeek:0,SalesPartPer:"0%",QtyPartPer:"0%",NoOfListing:0,TotalShrinkageAmtPer:"0%",AUR:0,WeeklySales:0,WeeklyQty:0,NetMarginPercent:"0%",WeeklyNetMargin:"0%"},n=!1;if(void 0!==g_pog_json[e].SalesInfo&&g_pog_json[e].SalesInfo.length>0)for(ItemSales of g_pog_json[e].SalesInfo)if(ItemSales.Item==o){t={LeadTime:ItemSales.LeadTime,SalesAmt:parseFloat(nvl(ItemSales.SalesAmt).toFixed(1)),VRM:parseFloat(nvl(ItemSales.VRM).toFixed(1)),GP:parseFloat(nvl(ItemSales.GP).toFixed(2)),BEI:ItemSales.BEI,MarkDown:ItemSales.MarkDown,ShrinkageAmt:parseFloat(nvl(ItemSales.ShrinkageAmt).toFixed(1)),SalesUnit:ItemSales.SalesUnit,SalesPerWeek:parseFloat(nvl(ItemSales.SalesPerWeek).toFixed(1)),SalesUnitPerWeek:parseFloat(nvl(ItemSales.SalesUnitPerWeek).toFixed(1)),NonShrinkageAmt:parseFloat(nvl(ItemSales.NonShrinkageAmt).toFixed(1)),ASP:void 0!==ItemSales.ASP&&""!==ItemSales.ASP&&null!==ItemSales.ASP&&0!==ItemSales.ASP?parseFloat(nvl(ItemSales.ASP).toFixed(2)):0==ItemSales.SalesUnit?0:parseFloat((nvl(ItemSales.SalesAmt)/nvl(ItemSales.SalesUnit)).toFixed(1)),VRMPer:(0==nvl(ItemSales.SalesAmt)?0:parseFloat((nvl(ItemSales.VRM)/nvl(ItemSales.SalesAmt)*100).toFixed(1)))+"%",GPPer:(0==nvl(ItemSales.SalesAmt)?0:parseFloat((nvl(ItemSales.GP)/nvl(ItemSales.SalesAmt)*100).toFixed(1)))+"%",BEIPer:(0==nvl(ItemSales.SalesAmt)?0:parseFloat((nvl(ItemSales.BEI)/nvl(ItemSales.SalesAmt)*100).toFixed(1)))+"%",MarkDownPer:(0==nvl(ItemSales.SalesAmt)?0:parseFloat((nvl(ItemSales.MarkDown)/nvl(ItemSales.SalesAmt)*100).toFixed(1)))+"%",ShrinkageAmtPer:(0==nvl(ItemSales.SalesAmt)?0:parseFloat((nvl(ItemSales.ShrinkageAmt)/nvl(ItemSales.SalesAmt)*100).toFixed(1)))+"%",AvgSalesPerWeek:parseFloat(nvl(ItemSales.AvgSalesPerWeek).toFixed(1)),AvgQtyPerWeek:parseFloat(nvl(ItemSales.AvgQtyPerWeek).toFixed(1)),SalesPartPer:parseFloat(nvl(ItemSales.SalesPartPer).toFixed(1))+"%",QtyPartPer:parseFloat(nvl(ItemSales.QtyPartPer).toFixed(1))+"%",NoOfListing:parseFloat(nvl(ItemSales.NoOfListing).toFixed(1)),TotalShrinkageAmtPer:(0==nvl(ItemSales.SalesAmt)?0:parseFloat(((nvl(ItemSales.ShrinkageAmt)+nvl(ItemSales.NonShrinkageAmt))/nvl(ItemSales.SalesAmt)*100).toFixed(1)))+"%",AUR:parseFloat(nvl(ItemSales.AUR).toFixed(1)),WeeklySales:parseFloat(nvl(ItemSales.weeklysales).toFixed(1)),WeeklyQty:parseFloat(nvl(ItemSales.weeklyqty).toFixed(1)),NetMarginPercent:parseFloat(nvl(ItemSales.nmper).toFixed(1))+"%",WeeklyNetMargin:parseFloat(nvl(ItemSales.netmarginpercent).toFixed(1))+"%"},n=!0;break}if(!n)for(const i of g_pog_json[e].ModuleInfo)if(void 0===i.ParentModule||null==i.ParentModule)for(const e of i.ShelfInfo)if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.ItemInfo.length>0)for(const i of e.ItemInfo)if("DIVIDER"!==i.Item&&""!==i.Desc&&void 0!==i.Desc&&i.Item==o){t={LeadTime:0,SalesAmt:parseFloat(i.NetSales.toFixed(1)),VRM:0,GP:i.GrossProfit,BEI:0,MarkDown:0,ShrinkageAmt:0,SalesUnit:i.SalesUnit,SalesPerWeek:0,SalesUnitPerWeek:0,NonShrinkageAmt:0,ASP:0==i.SalesUnit?0:parseFloat((i.NetSales/i.SalesUnit).toFixed(1)),VRMPer:"0%",GPPer:(0==i.NetSales?0:parseFloat((i.GrossProfit/i.NetSales*100).toFixed(1)))+"%",BEIPer:"0%",MarkDownPer:"0%",ShrinkageAmtPer:"0%",AvgSalesPerWeek:0,AvgQtyPerWeek:0,SalesPartPer:"0%",QtyPartPer:"0%",NoOfListing:0,TotalShrinkageAmtPer:"0%",AUR:0,WeeklySales:0,WeeklyQty:0,NetMarginPercent:"0%",WeeklyNetMargin:"0%"},n=!0;break}return t}catch(e){throw error_handling(e),e}}function maximizeItemDepthFacings(e,o,t,n,i){try{g_pog_json[i].ModuleInfo[o];var r=g_pog_json[i].ModuleInfo[o].ShelfInfo[t],a=g_pog_json[i].ModuleInfo[o].ShelfInfo[t].ItemInfo[n],l=findNearByShelfMaxDepth(o,t,n,n,-1,i),s=1,d=r.SpreadItem,_=r.HorizGap,g=a.NVal,f=void 0!==a.ItemNesting&&""!==a.ItemNesting?a.ItemNesting:"",p=a.HorizGap;if(("SHELF"==r.ObjType||"HANGINGBAR"==r.ObjType&&"Y"==g_auto_hangbar_facings||"PEGBOARD"==r.ObjType&&"Y"==r.AutoFillPeg||"CHEST"==r.ObjType)&&!(""!==a.TopObjID&&void 0!==a.TopObjID&&""!==a.BottomObjID&&void 0!==a.BottomObjID||"DIVIDER"===a.Item||"Y"!=g_auto_cal_depth_fac||"D"!=e&&"B"!=e)){var c,I=wpdSetFixed(a.RD/a.BaseD);"Y"==a.MDepthCrushed&&a.CrushD>0&&(I-=I*(a.CrushD/100));var m=(c="HANGINGBAR"==r.ObjType?0==r.MaxMerch||""==r.MaxMerch?g_hangbar_dft_maxmerch:r.MaxMerch:"PEGBOARD"==r.ObjType?0==r.MaxMerch||""==r.MaxMerch?g_pegboard_dft_item_depth:r.MaxMerch:"CHEST"==r.ObjType?r.BsktWallH:r.D)-l-I,h=nvl(a.MPogDepthFacings)>0?a.MPogDepthFacings:a.MDepthFacings;if("F"!==d&&0==_&&0==p&&0!==g&&""!==f&&"D"==a.ItemNesting?(s=h<(s=Math.floor(100*m/(100*g))+1)&&h>-1?h:s,g_pog_json[i].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].D=I+(s>0?s:1)*g):(s=h<(s=Math.floor(100*wpdSetFixed(c-l)/(100*I)))&&h>-1?h:s,g_pog_json[i].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].D=I*(s>0?s:1)),g_pog_json[i].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].RD=wpdSetFixed(a.RD/a.BaseD*(s>0?s:1)),"CHEST"==r.ObjType){var u=h<Math.trunc(r.BsktWallH/I)&&h>-1?h:Math.trunc(r.BsktWallH/I);g_pog_json[i].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].BaseD=u}else g_pog_json[i].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].BaseD=s>0?s:1;var S=g_pog_json[i].ModuleInfo[o].ShelfInfo[t].ItemInfo[n],D=""==S.CapOrientaion?"4":S.CapOrientaion,[b,v,x]=get_cap_dim(S),[O,C,j,M,y,H]=get_new_orientation_dim(D,b,v,x);"N"!=S.CapDepthChanged&&void 0!==S.CapDepthChanged||(g_pog_json[i].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapDepth=Math.trunc(a.RD/j))}}catch(e){throw error_handling(e),e}}function findNearByShelfMaxDepth(e,o,t,n,i,r){logDebug("function : findNearByShelfMaxDepth; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+t+"; p_edit_ind : "+n+"; locationX : "+i,"S");try{var a=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].X-g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].W/2,l=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].X+g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].W/2;if("1"!=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].CapStyle&&"2"!=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].CapStyle&&"3"!=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].CapStyle||"SHELF"!=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ObjType)s=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].Y+g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].H/2,d=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].Y-g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].H/2;else var s=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].Y+g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].RH/2,d=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].Y-g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].RH/2;var _=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].Shelf,g=g_pog_json[r].ModuleInfo[e].ShelfInfo[o].ObjType,f=[],p=0;return g_pog_json[r].ModuleInfo[e].ShelfInfo.length>1&&"SHELF"==g&&$.each(g_pog_json[r].ModuleInfo[e].ShelfInfo,(function(e,o){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType){if(0!==o.Rotation||0!==o.Slope)var t=parseFloat((o.X+o.ShelfRotateWidth/2).toFixed(3)),n=parseFloat((o.X-o.ShelfRotateWidth/2).toFixed(3));else t=parseFloat((o.X+o.W/2).toFixed(3)),n=parseFloat((o.X-o.W/2).toFixed(3));var i=o.Y,r=o.Y+o.H/2;(a>=n&&a<t||l<=t&&l>n)&&s>=i&&_!=o.Shelf&&d<r&&f.push(parseFloat(o.D.toFixed(4)))}})),f.length>0&&(p=Math.max.apply(Math,f)),logDebug("function : findNearByShelfMaxDepth","E"),p}catch(e){error_handling(e)}}function onload_findNearByShelfMaxDepth(e,o,t,n,i,r,a){logDebug("function : findNearByShelfMaxDepth; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+t+"; p_edit_ind : "+n+"; locationX : "+i,"S");try{var l=a[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].X-a[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].W/2,s=a[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].X+a[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].W/2,d=a[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].Y+a[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].H/2,_=a[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].Y-a[r].ModuleInfo[e].ShelfInfo[o].ItemInfo[t].H/2,g=a[r].ModuleInfo[e].ShelfInfo[o].Shelf,f=a[r].ModuleInfo[e].ShelfInfo[o].ObjType,p=[],c=0;return a[r].ModuleInfo[e].ShelfInfo.length>1&&"SHELF"==f&&$.each(a[r].ModuleInfo[e].ShelfInfo,(function(e,o){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType){if(0!==o.Rotation||0!==o.Slope)var t=wpdSetFixed(o.X+o.ShelfRotateWidth/2),n=wpdSetFixed(o.X-o.ShelfRotateWidth/2);else t=wpdSetFixed(o.X+o.W/2),n=wpdSetFixed(o.X-o.W/2);var i=o.Y,r=o.Y+o.H/2;(l>=n&&l<t||s<=t&&s>n)&&d>=i&&g!=o.Shelf&&_<r&&p.push(wpdSetFixed(o.D))}})),p.length>0&&(c=Math.max.apply(Math,p)),logDebug("function : findNearByShelfMaxDepth","E"),c}catch(e){throw error_handling(e),e}}function get_cap_dim(e){try{var o=0,t=0,n=0,i=""==e.CapMerch?"0":e.CapMerch;return"0"==i?wpdSetFixed(e.UW)!==wpdSetFixed(e.OrgUW)||wpdSetFixed(e.UH)!==wpdSetFixed(e.OrgUH)||wpdSetFixed(e.UD)!==wpdSetFixed(e.OrgUD)?(o=e.OrgUW,t=e.OrgUH,n=e.OrgUD):(o=e.UW,t=e.UH,n=e.UD):"2"==i?wpdSetFixed(e.CW)!==wpdSetFixed(e.OrgCW)||wpdSetFixed(e.CH)!==wpdSetFixed(e.OrgCH)||wpdSetFixed(e.CD)!==wpdSetFixed(e.OrgCD)?(o=e.OrgCW,t=e.OrgCH,n=e.OrgCD):(o=e.CW,t=e.CH,n=e.CD):"1"==i?wpdSetFixed(e.TW)!==wpdSetFixed(e.OrgTW)||wpdSetFixed(e.TH)!==wpdSetFixed(e.OrgTH)||wpdSetFixed(e.TD)!==wpdSetFixed(e.OrgTD)?(o=e.OrgTW,t=e.OrgTH,n=e.OrgTD):(o=e.TW,t=e.TH,n=e.TD):"3"==i&&(wpdSetFixed(e.DW)!==wpdSetFixed(e.OrgDW)||wpdSetFixed(e.DH)!==wpdSetFixed(e.OrgDH)||wpdSetFixed(e.DD)!==wpdSetFixed(e.OrgDD)?(o=wpdSetFixed(e.OrgDW),t=wpdSetFixed(e.OrgDH),n=wpdSetFixed(e.OrgDD)):(o=wpdSetFixed(e.DW),t=wpdSetFixed(e.DH),n=wpdSetFixed(e.DD))),[o,t,n]}catch(e){throw error_handling(e),e}}function get_shelf_max_merch(e,o,t,n,i,r){logDebug("function : get_shelf_max_merch; p_module_index : "+t+"; p_shelf_index : "+n,"S");try{var a=0;if(o.X>=e.X-e.W/2&&o.X<e.X+e.W/2&&o.Y<=e.H+g_pog_json[i].BaseH&&o.Y>0)a=get_module_max_merch(t,n,i);else if(o.Y<e.H+g_pog_json[i].BaseH&&o.Y>0)a=e.H+g_pog_json[i].BaseH-o.Y;else a=r;return a>o.MaxMerch&&o.MaxMerch>0&&(a=o.MaxMerch),logDebug("function : get_shelf_max_merch","E"),a}catch(e){throw error_handling(e),e}}function get_module_max_merch(e,o,t,n="N",i=0){try{var r=0,a=0,l=0,s=[],d=g_pog_json[t].ModuleInfo[e],_=d.ShelfInfo[o],g=_.ItemInfo[i],f=wpdSetFixed(g?.X-g?.W/2),p=wpdSetFixed(g?.X+g?.W/2),c=_.ObjType;0!==_.MaxMerch&&(l=_.MaxMerch);var I=_.Y+_.H/2,m=wpdSetFixed(_.X-_.W/2),h=wpdSetFixed(_.X+_.W/2),u=wpdSetFixed(_.Z+_.D/2),S=[];r=0;if("CHEST"!=c&&"BASKET"!=c||(a=_.BsktWallH),d.ShelfInfo.length>1){if("PEGBOARD"==c)S.push(_.H+_.LoOverHang),s.push(o);else if("HANGINGBAR"==c){I=_.Y;var D=0;for(const e of d.ShelfInfo){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){var b=wpdSetFixed(e.X-e.W/2),v=wpdSetFixed(e.X+e.W/2);o!==D&&e.Y+e.H/2<I&&(m>=b&&m<=v||h<=b&&h>=v||m>=b&&h<=v||b>=m&&v<=h)&&(S.push(I-(e.Y+e.H/2)),s.push(D))}D++}}else for(D=0;D<d.ShelfInfo.length;D++){const e=d.ShelfInfo[D];if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){v=wpdSetFixed(e.X+e.W/2),b=wpdSetFixed(e.X-e.W/2);if(e.W<d.W&&(f>v||p<b))continue;(u<=wpdSetFixed(e.Z+e.D/2)&&"Y"==n||"N"==n)&&o!==D&&e.Y-e.H/2>I&&e.Y<=d.H+g_pog_json[t].BaseH&&(S.push(e.Y-e.H/2-I),s.push(D))}}if(0==S.length)_.Topmerch="Y",r=d.H+g_pog_json[t].BaseH-I;else{_.Topmerch="N",r=Math.min.apply(Math,S);var x=S.findIndex((function(e){return e==r}));d.ShelfInfo[s[x]].ObjType}}else _.Topmerch="Y",r=d.H+g_pog_json[t].BaseH-I;return wpdSetFixed("CHEST"==c||"BASKET"==c?r<a&&a>0||0==a?r:a:r<l&&l>0||0==l?r:l)}catch(e){throw error_handling(e),e}}function get_onload_max_merch(e,o,t,n,i,r,a){var l=n.X,s=n.Y;if(n.MaxMerch>0)var d=n.MaxMerch;else if(l>=t.X-t.W/2&&l<t.X+t.W/2&&s<=t.H+a[r].BaseH&&s>0)d=get_onload_shelf_max_merch(e,o,r,a);else if(s<t.H+a[r].BaseH&&s>0)d=t.H+a[r].BaseH-s;else d=i;return d}function get_onload_shelf_max_merch(e,o,t,n){try{var i=0,r=0,a=0,l=[],s=n[t].ModuleInfo[e],d=s.ShelfInfo[o],_=d.ObjType;0!==d.MaxMerch&&(a=d.MaxMerch);var g=d.Y+d.H,f=wpdSetFixed(d.X),p=wpdSetFixed(d.X+d.W),c=[];i=0;if("CHEST"!=_&&"BASKET"!=_||(r=d.BsktWallH),s.ShelfInfo.length>1){if("PEGBOARD"==_)c.push(d.H+d.LoOverHang),l.push(o);else if("HANGINGBAR"==_){g=d.Y;var I=0;for(const e of s.ShelfInfo){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){var m=wpdSetFixed(e.X),h=wpdSetFixed(e.X+e.W);o!==I&&e.Y+e.H<g&&(f>=m&&f<=h||p<=m&&p>=h||f>=m&&p<=h||m>=f&&h<=p)&&(c.push(g-(e.Y+e.H)),l.push(I))}I++}}else{I=0;for(const e of s.ShelfInfo){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){h=wpdSetFixed(e.X+e.W),m=wpdSetFixed(e.X);o!==I&&e.Y-e.H>g&&(h>f&&m<=f||m<p&&m>=f)&&e.Y<=s.H+g_pog_json[t].BaseH&&(c.push(e.Y-g),l.push(I))}I++}}if(0==c.length)i=s.H+n[t].BaseH-g;else{i=Math.min.apply(Math,c);var u=c.findIndex((function(e){return e==i}));s.ShelfInfo[l[u]].ObjType}}else i=s.H+n[t].BaseH-g;return wpdSetFixed("CHEST"==_||"BASKET"==_?i<r&&r>0||0==r?i:r:i<a&&a>0||0==a?i:a)}catch(e){throw error_handling(e),e}}function get_item_xy(e,o,t,n,i){logDebug("function : get_item_xy; item_width : "+t+"; item_height : "+n,"S");try{var r=0,a=0;if("BASKET"==e.ObjType&&"BT"==e.BsktSpreadProduct)r=e.X-e.W/2+t/2,a=e.Y+e.H/2+o.Distance+n/2;else if("HANGINGBAR"==e.ObjType)r=e.X-e.W/2+o.Distance+t/2,a=e.Y-n/2;else if("ROD"==e.ObjType)r=e.X,a=e.Y-e.H/2-n/2;else if("PEGBOARD"==e.ObjType||"CHEST"==e.ObjType&&"Y"==g_chest_as_pegboard){var l=e.peg_vert_values,s=[];$.each(l,(function(o,t){s.push(e.Y+l[o])}));var d=o.Y+n/2;if(s.length>0)var _=s.reduce(((e,o)=>Math.abs(o-d)<Math.abs(e-d)?o:e));r=e.X-e.W/2+o.PegBoardX+t/2,a=parseFloat(_)-n/2,a=void 0!==o.PegBoardY&&""!==o.PegBoardY?e.Y-e.H/2+o.PegBoardY+n/2:parseFloat(_)-n/2}else r=e.X-e.W/2+o.Distance+t/2,a=e.Y+e.H/2+n/2;return"DIVIDER"==o.Item&&"BASKET"==e.ObjType&&(a=g_finalY),logDebug("function : get_item_xy","E"),[wpdSetFixed(r),wpdSetFixed(a)]}catch(e){throw error_handling(e),e}}function crushItem(e,o,t,n,i,r,a,l,s="N"){try{var d=[],_=g_pog_json[e].ModuleInfo[o],g=g_pog_json[e].ModuleInfo[o].ShelfInfo[t];if("Y"==s&&void 0!==g_json[0]&&g_json.length>0)if(void 0!==g_json[0].ModuleInfo[o].ShelfInfo[t])var f=g_json[0].ModuleInfo[o].ShelfInfo[t];else f=g_pog_json[e].ModuleInfo[o].ShelfInfo[t];var p=g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n],c=void 0===p?-1:p.Orientation,[I,m,h,u,S,D]=get_new_orientation_dim(c,0,0,0),b="N",v="N",x=0,O=0;if(-1!==n&&void 0!==p&&(p.CrushVert>0&&"0"==p.CapStyle&&0==p.NVal&&("H"==i||"A"==i)&&(p.H=p.RH),p.CrushD>0&&("D"==i||"A"==i)&&(p.D=p.RD),b=void 0===p.MVertCrushed||null==p.MVertCrushed||"N"==p.MVertCrushed?"N":"Y","H"==u?O="N"==b?p.CHPerc:p.CrushVert:"W"==u?O="N"==b?p.CWPerc:p.CrushHoriz:"D"==u&&(O="N"==b?p.CDPerc:p.CrushD),v=void 0===p.MHorizCrushed||null==p.MHorizCrushed||"N"==p.MHorizCrushed?"N":"Y","H"==S?x="Y"==p.MassCrushH?p.CrushHoriz:"N"==v?p.CHPerc:p.CrushVert:"W"==S?x="N"==v?p.CWPerc:p.CrushHoriz:"D"==S&&(x="N"==v?p.CDPerc:p.CrushD)),l.length>0){var C=0;for(idx of l){var j=0;for(obj of g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo)obj.CrushD>0&&("D"==i||"A"==i)&&j==l[C]&&(obj.D=obj.RD),j++;C++}}var M=0;if((M="PEGBOARD"==g.ObjType?g.VertiSpacing:g.HorizGap)>0?M:0,void 0!==p&&"CHEST"==g.ObjType&&"Y"==g_chest_as_pegboard&&("Y"==g.AllowAutoCrush||"Y"==g.ManualCrush)){var y="Y";if("H"!=i&&"A"!=i&&"W"!=i||(y=crushChestItemHW("Y"==s&&void 0!==f?f:g,p,n,O,x,v,b,u,S,r)),"D"==u){var H=p.CrushVert,w=p.CHPerc,T=p.MVertCrushed;ve=(void 0===p.MVertCrushed||"N"==p.MVertCrushed)&&w>0?w:H}else{var F=p.CrushD,N=p.CDPerc;T=p.MDepthCrushed;ve=(void 0===p.MDepthCrushed||"N"==p.MDepthCrushed)&&N>0?N:F}if(("D"==i||"A"==i)&&p.D>g.BsktWallH||"Y"==T){p.D=p.RD;var E=0,B=p.RD,W="N",R=p.D;if(ve>0)if("N"==T){for(X=0;X<=ve;X++)if((R=wpdSetFixed(B-B*X/100))<=g.BsktWallH){E=X,W="Y";break}}else(R=wpdSetFixed(B-B*ve/100))<=g.BsktWallH&&(E=ve,W="Y");"Y"==W&&"Y"==r?(p.D=wpdSetFixed(R),"W"==D?p.CrushHoriz=E:"H"==D?p.CrushVert=E:"D"==D&&(p.CrushD=E),p.DChanged="Y",g_error_category="",y="Y"):("Y"==T&&(p.D=wpdSetFixed(R),"W"==D?p.CrushHoriz=E:"H"==D?p.CrushVert=E:"D"==D&&(p.CrushD=E),p.DChanged="Y"),g_error_category="D",y="N")}return y}if("CHEST"!=g.ObjType||"Y"!=g_chest_as_pegboard){y="Y";if("H"==i||"A"==i){E=0;var P=0,Y=0,A=p.RH;if("Y"==s&&void 0!==g_json[0])var k=get_onload_max_merch(o,t,_,g,g_dft_max_merch,0,g_json);else k=get_cap_max_merch(o,t,_,g,e,g_dft_max_merch);if("1"!=p.CapStyle&&"2"!=p.CapStyle&&"3"!=p.CapStyle||(Y=p.H-p.RH,A=p.RH+nvl(Y)),"N"==b){for(oe=0;oe<=O;oe++)if(k>=(P=A-A*oe/100)){E=oe;break}}else P=A-A*O/100,E=O;if(void 0!==p.TopObjID&&""!==p.TopObjID||void 0!==p.BottomObjID&&""!==p.BottomObjID){var z=p.H,X=0;for(const e of g.ItemInfo)wpdSetFixed(p.X)==wpdSetFixed(e.X)&&X!==n&&(z+=e.H),X++;P=z}if(P>k)g_error_category="H",y="N","N"==b&&("H"==u?p.CrushVert=0:"W"==u?p.CrushHoriz=0:"D"==u&&(p.CrushDepth=0));else{if("Y"==r){p.H=P,"H"==u?p.CrushVert=E:"W"==u?p.CrushHoriz=E:"D"==u&&(p.CrushDepth=E);var[L,V]=get_item_xy(g,p,p.W,p.H,e);"BASKET"==g.ObjType&&"DIVIDER"==p.Item||(p.Y=V),p.HChanged="Y"}g_error_category="",y="Y"}}if("W"==i||"A"==i){var G="N",U=0,Z=[],$=[],J=0,Q="N";E=0;if(g_combinedShelfs.length>0){var[q,K]=getCombinationShelf(e,g.Shelf);if(-1!==q&&(G="Y",g_combinedShelfs[q][0].AllowAutoCrush),"Y"==G){var ee=g_combinedShelfs[q].ItemInfo,oe=0;for(var te of g_combinedShelfs[q])U+=te.W,oe++}}if("Y"==G){oe=0,Q="N",d=[];var ne=[],ie=[],re=[],ae=(Z=[],[]);$=[];for(const e of ee){var le=0,[I,m,h,se,S,de]=(c=e.Orientation,get_new_orientation_dim(c,0,0,0));T=void 0===e.MHorizCrushed||null==e.MHorizCrushed||"N"==e.MHorizCrushed?"N":"Y","W"==S?le="N"==T&&e.CWPerc>0?e.CWPerc:e.CrushHoriz:"H"==S?le="N"==T&&e.CHPerc>0?e.CHPerc:e.CrushVert:"D"==S&&(le="N"==T&&e.CDPerc>0?e.CDPerc:e.CrushD),"N"==e.Fixed&&le>0&&("Y"==T&&oe!==n||"N"==T)&&(Q="Y",d.push(e.IIndex),ie.push(e.SIndex),re.push(e.MIndex),ne.push(e.MIndex+"#"+e.SIndex+"#"+e.IIndex),Z.push(e.W),ae.push(T),$.push(le)),oe++}if("Y"==Q){for(Q="N",oe=0;oe<100;oe++){J=0;var _e=0,ge=(X=0,"N");for(const o of ee){le=0,c=o.Orientation;var[I,m,h,se,S,de]=get_new_orientation_dim(c,0,0,0);if(T=void 0===o.MHorizCrushed||null==o.MHorizCrushed||"N"==o.MHorizCrushed?"N":"Y",void 0===(le=$[ne.indexOf(o.MIndex+"#"+o.SIndex+"#"+o.IIndex)])&&("W"==S?le="N"==T&&o.CWPerc>0?o.CWPerc:o.CrushHoriz:"H"==S?le="N"==T&&o.CHPerc>0?o.CHPerc:o.CrushVert:"D"==S&&(le="N"==T&&o.CDPerc>0?o.CDPerc:o.CrushD)),-1!==ne.indexOf(o.MIndex+"#"+o.SIndex+"#"+o.IIndex)&&oe<=le&&"N"==T)if((_e=wpdSetFixed(o.RW-o.RW*(oe/100)))>=wpdSetFixed(o.RW-o.RW*(le/100))){if(J+=_e,"Y"==r)if(void 0!==g_pog_json[e].ModuleInfo[o.MIndex]&&void 0!==g_pog_json[e].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex]&&void 0!==g_pog_json[e].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex].ItemInfo[o.IIndex])(fe=g_pog_json[e].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex].ItemInfo[o.IIndex]).W=_e,"W"==S?fe.CrushHoriz=oe:"H"==S?fe.CrushVert=oe:"D"==S&&(fe.CrushD=oe);else o.W=_e,"W"==S?o.CrushHoriz=oe:"H"==S?o.CrushVert=oe:"D"==S&&(o.CrushD=oe)}else J+=o.RW;else if("Y"==T){if(ge=le>0?"Y":"N",J+=_e=wpdSetFixed(o.RW-o.RW*(le/100)),"Y"==r)if(void 0!==g_pog_json[e].ModuleInfo[o.MIndex]&&void 0!==g_pog_json[e].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex]&&void 0!==g_pog_json[e].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex].ItemInfo[o.IIndex])(fe=g_pog_json[e].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex].ItemInfo[o.IIndex]).W=_e,"W"==S?fe.CrushHoriz=le:"H"==S?fe.CrushVert=le:"D"==S&&(fe.CrushD=le);else o.W=_e,"W"==S?o.CrushHoriz=le:"H"==S?o.CrushVert=le:"D"==S&&(o.CrushD=le)}else{if(0==le)if(void 0!==g_pog_json[e].ModuleInfo[o.MIndex]&&void 0!==g_pog_json[e].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex]&&void 0!==g_pog_json[e].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex].ItemInfo[o.IIndex]){var fe=g_pog_json[e].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex].ItemInfo[o.IIndex];"W"==S?fe.CrushHoriz=0:"H"==S?fe.CrushVert=0:"D"==S&&(fe.CrushD=0)}else"W"==S?o.CrushHoriz=0:"H"==S?o.CrushVert=0:"D"==S&&(o.CrushD=0);J+=o.W}M>0&&(J+=o.SpreadItem),X++}if(U-J>=0){E=oe,(oe>0||"Y"==ge)&&(Q="Y",-1!==n&&-1!==d.indexOf(n)&&"Y"==r&&(g.ItemInfo[n].WChanged="Y"));break}}if("N"==Q){if(E>0){X=0;for(const o of d)"N"==ae[X]&&void 0!==g_pog_json[e].ModuleInfo[re[X]]&&void 0!==g_pog_json[e].ModuleInfo[re[X]].ShelfInfo[ie[X]]&&void 0!==g_pog_json[e].ModuleInfo[re[X]].ShelfInfo[ie[X]].ItemInfo[d[X]]&&(g_pog_json[e].ModuleInfo[re[X]].ShelfInfo[ie[X]].ItemInfo[d[X]].W=Z[X],g_pog_json[e].ModuleInfo[re[X]].ShelfInfo[ie[X]].ItemInfo[d[X]].CrushHoriz=$[X]),X++}g_error_category="W",y="N"}else g_error_category="",y="Y"}else"Y"==v&&"N"==Q&&void 0!==p?(ce=wpdSetFixed(p.RW-p.RW*(x/100)),"Y"==r&&(p.W=ce,p.WChanged="Y","W"==S?p.CrushHoriz=x:"H"==S?p.CrushVert=x:"D"==S&&(p.CrushD=x))):y="F"}else{ee=g.ItemInfo,oe=0,Q="N",d=[],Z=[],ae=[],$=[];var pe=!1;for(const e of ee){le=0,c=e.Orientation;var[I,m,h,se,S,de]=get_new_orientation_dim(c,0,0,0);T=void 0===e.MHorizCrushed||null==e.MHorizCrushed||"N"==e.MHorizCrushed?"N":"Y","W"==S?le="N"==T&&e.CWPerc>0?e.CWPerc:e.CrushHoriz:"H"==S?le="N"==T&&e.CHPerc>0?e.CHPerc:e.CrushVert:"D"==S&&(le="N"==T&&e.CDPerc>0?e.CDPerc:e.CrushD),"N"==e.Fixed&&le>0?(Q="Y",d.push(oe),Z.push(e.W),ae.push(T),$.push(le)):"Y"==e.Fixed&&(pe=!0),oe++}if("Y"==s)ee=f.ItemInfo;else ee=g.ItemInfo;if("Y"!=Q||pe)if("Y"==Q&&pe)y=widthCrushItemWithFixedDivider(e,o,t,n,r);else if("Y"==v&&"N"==Q){var ce=p.RW-p.RW*(x/100);"Y"==r&&(p.W=ce,p.WChanged="Y",p.CrushHoriz=x)}else y="F";else{for(Q="N",oe=0;oe<100;oe++){J=0;_e=0,X=0,ge="N";for(const e of ee){le=0,c=e.Orientation;var[I,m,h,se,S,de]=get_new_orientation_dim(c,0,0,0);if(T=void 0===e.MHorizCrushed||null==e.MHorizCrushed||"N"==e.MHorizCrushed?"N":"Y","W"==S?le="N"==T&&e.CWPerc>0?e.CWPerc:e.CrushHoriz:"H"==S?le="N"==T&&e.CHPerc>0?e.CHPerc:e.CrushVert:"D"==S&&(le="N"==T&&e.CDPerc>0?e.CDPerc:e.CrushD),-1!==d.indexOf(X)&&oe<=le){var Ie=void 0!==e.RW&&null!==e.RW?e.RW:e.W;"N"==T?(_e=wpdSetFixed(Ie-Ie*(oe/100)))>=wpdSetFixed(Ie-Ie*(le/100))?(J+=_e,"Y"==r&&(g.ItemInfo[X].W=_e,"W"==S?g.ItemInfo[X].CrushHoriz=oe:"H"==S?g.ItemInfo[X].CrushVert=oe:"D"==S&&(g.ItemInfo[X].CrushD=oe))):J+=Ie:"Y"==T&&(ge=le>0?"Y":"N",J+=_e=wpdSetFixed(Ie-Ie*(le/100)),"Y"==r&&(g.ItemInfo[X].W=_e,"W"==S?g.ItemInfo[X].CrushHoriz=le:"H"==S?g.ItemInfo[X].CrushVert=le:"D"==S&&(g.ItemInfo[X].CrushD=le)))}else J+=wpdSetFixed(e.W);M>0&&(J+=e.SpreadItem),X++}if(g.W+g.ROverhang+g.LOverhang-J>=0){E=oe,(oe>0||"Y"==ge)&&(Q="Y",-1!==n&&-1!==d.indexOf(n)&&"Y"==r&&(g.ItemInfo[n].WChanged="Y"));break}}if("N"==Q){X=0;if(E>0)for(const e of d)"N"==ae[X]&&(g.ItemInfo[d[X]].W=Z[X],g.ItemInfo[d[X]].CrushHoriz=$[X]),X++;g_error_category="W",y="N"}else g_error_category="",y="Y"}}}if("D"==i||"A"==i){var me=[],he=[],ue=[],Se=(Q="N","N");if("Y"==s&&void 0!==g_json[0])var De=onload_findNearByShelfMaxDepth(o,t,n,n,-1,0,g_json);else De=findNearByShelfMaxDepth(o,t,n,n,-1,e);for(oe=0;oe<a.length;oe++)Se=void 0===g.ItemInfo[l[oe]].MDepthCrushed||"N"==g.ItemInfo[l[oe]].MDepthCrushed?"N":"Y",(a[oe]>g.D-De||"Y"==Se)&&(me.push(a[oe]),he.push(l[oe]),ue.push(Se));var be=0,ve=0;for(oe=0;oe<me.length;oe++){c=g.ItemInfo[he[oe]].Orientation;var[I,m,h,se,S,de]=get_new_orientation_dim(c,0,0,0);if("W"==de?ve="N"==Se&&g.ItemInfo[he[oe]].CWPerc>0?g.ItemInfo[he[oe]].CWPerc:g.ItemInfo[he[oe]].CrushHoriz:"H"==de?ve="N"==Se&&g.ItemInfo[he[oe]].CHPerc>0?g.ItemInfo[he[oe]].CHPerc:g.ItemInfo[he[oe]].CrushVert:"D"==de&&(ve="N"==Se&&g.ItemInfo[he[oe]].CDPerc>0?g.ItemInfo[he[oe]].CDPerc:g.ItemInfo[he[oe]].CrushD),ve>0&&(a[oe]>g.D-De||"Y"==ue[oe])){R=0,g.ItemInfo[he[oe]].D,g.ItemInfo[he[oe]].BaseD,B=g.ItemInfo[he[oe]].RD;if("N"==ue[oe]){for(X=0;X<=ve;X++)if(R=B-B*X/100,g.D-De>=R){d.push(he[oe]),Q="Y",be=X;break}}else R=B-B*ve/100,d.push(he[oe]),Q="Y",be=ve}}if("N"==Q)for(oe=0;oe<a.length;oe++)if(wpdSetFixed(g.ItemInfo[l[oe]].D)!==wpdSetFixed(g.ItemInfo[l[oe]].RD)){c=g.ItemInfo[l[oe]].Orientation;var[I,m,h,se,S,de]=get_new_orientation_dim(c,0,0,0);"N"==Se&&("W"==de?g.ItemInfo[l[oe]].CrushHoriz=0:"H"==de?g.ItemInfo[l[oe]].CrushVert=0:"D"==de&&(g.ItemInfo[l[oe]].CrushD=0))}if("Y"==Q&&a.length==d.length&&"Y"==r){for(oe=0;oe<d.length;oe++){R=g.ItemInfo[d[oe]].RD-g.ItemInfo[d[oe]].RD*(be/100);g.ItemInfo[d[oe]].D=R,g.ItemInfo[d[oe]].CrushD=be}-1!==n&&(g.ItemInfo[n].DChanged="Y"),g_error_category="",y="Y"}else g_error_category="D",y="N"}return y}}catch(e){throw error_handling(e),e}}async function recreate_all_items(e,o,t,n,i,r,a,l,s,d,_,g,f,p,c,I,m,h,u,S,D,b="Y",v="Y"){logDebug("function : recreate_all_items; p_module_index : "+e+"; p_shelf_index : "+o+"; shelf_obj_type : "+t+"; p_edit_ind : "+n+"; locationX : "+i+"; edit_item_index : "+r+"; item_length : "+a+"; shelf_edit : "+s+"; redoX : "+d+"; create_canvas : "+g,"S");try{var x=(y=g_pog_json[p].ModuleInfo[e].ShelfInfo[o]).SpreadItem,O=1,[C,j]=[-1,-1];C=-1,j=-1,"SHELF"!=y.ObjType&&"HANGINGBAR"!=y.ObjType||"N"===y.Combine||([C,j]=getCombinationShelf(p,y.Shelf)),-1!==C&&-1!==j&&(O=g_combinedShelfs[C].length,await setCombinedShelfItems(p,C,j,i,n,s,d,r,[])),g_world=g_scene_objects[p].scene.children[2];for(var M=0;M<O;M++){-1!==C&&-1!==j&&O>1&&(e=g_combinedShelfs[C][M].MIndex,o=g_combinedShelfs[C][M].SIndex,x=g_combinedShelfs[C].SpreadItem),console.log("recreate all items ",e,o,t,n,i,r,a,l,s,d,_,g,f,p);var y=g_pog_json[p].ModuleInfo[e].ShelfInfo[o],H=g_show_live_image,w=y.HorizGap,T=w,F=(y.Combine,y.Rotation,y.X-y.W/2),N=y.Y-y.H/2,E=[],B=0;if(-1!==_&&""!==_&&void 0!==_)E=_;else E=y.ItemInfo;if("SHELF"==y.ObjType&&("L"==y.SpreadItem||"R"==y.SpreadItem)&&"Y"==b){var W=0;for(item of y.ItemInfo){mergeAdjacentItems(p,e,o,W);W++}}var R=y.ItemInfo.length;W=0;for(const e of E){var P=g_world.getObjectById(e.ObjID);g_world.remove(P),e.W,W++}if(y.AvlSpace=y.W+y.LOverhang+y.ROverhang,"R"==x){E=y.ItemInfo;if("PEGBOARD"!==y.ObjType&&("CHEST"!=y.ObjType||"Y"!=g_chest_as_pegboard)){var Y=E.some((e=>"Y"===e.Fixed));if("R"!=x||!Y||"HANGINGBAR"!=y.ObjType&&"SHELF"!=y.ObjType){var A={X:"asc"};E.keySort(A)}}for(W=E.length-1;W>=0;W--){if(R-=1,B=get_item_xaxis(E[W].W,E[W].H,E[W].D,t,i,T,x,w,e,o,R,n,y.ItemInfo.length,s,p,v),"DIVIDER"==E[W].Item){var k=g_pog_json[p].ModuleInfo[e].ShelfInfo,z=-1,X=0;for(const e of k)e.Shelf==E[W].ItemID&&"DIVIDER"==e.ObjType&&(z=X),X++;z>-1&&(g_pog_json[p].ModuleInfo[e].ShelfInfo[z].X=B)}y.ItemInfo[R].Distance=B-E[W].W/2-F,("PEGBOARD"==y.ObjType||"CHEST"==y.ObjType&&"Y"==g_chest_as_pegboard)&&(y.ItemInfo[R].PegBoardX=B-E[W].W/2-F,y.ItemInfo[R].PegBoardY=y.ItemInfo[R].Y-E[W].H/2-N,y.ItemInfo[R].FromProductList="N"),y.ItemInfo[R].OldObjID=E[W].ObjID;var L=E[W].ObjID;if("Y"==H&&"DIVIDER"!==E[W].Item&&3!=E[W].MerchStyle){var V=g_orientation_json[y.ItemInfo[R].Orientation].split("###");Z=await add_items_with_image(E[W].ItemID,E[W].W,E[W].H,E[W].D,E[W].Color,B,E[W].Y,"",e,o,W,E[W].BHoriz,E[W].BVert,E[W].Item,parseInt(V[0]),parseInt(V[1]),"N",l,I,m,h,u,S,D,p)}else Z="DIVIDER"==E[W].Item?add_items(E[W].ItemID,E[W].W,E[W].H,E[W].D,E[W].Color,B,E[W].Y,"",e,o,W,E[W].Rotation,p):await add_items_prom(E[W].ItemID,E[W].W,E[W].H,E[W].D,E[W].Color,B,E[W].Y,"",e,o,W,"N",l,c,"",D,u,S,p);for(var G=0;G<g_combineItemModf.length;G++)g_combineItemModf[G].NewMIndex==e&&g_combineItemModf[G].NewSIndex==o&&g_combineItemModf[G].OldObjID==L&&(g_combineItemModf[G].NewObjID=Z);P=g_world.getObjectById(Z);"E"==E[W].DimUpdate?(P.BorderColour=g_dim_error_color,P.WireframeObj.material.color.setHex(P.BorderColour)):"N"==E[W].Status?(P.BorderColour=g_status_error_color,P.Status="N",P.WireframeObj.material.color.setHex(P.BorderColour)):"No"==nvl(E[W].MovingItem)&&"Y"==g_pogcr_auto_hlite_non_mv_item?(P.BorderColour=g_nonMovingItemColor,P.WireframeObj.material.color.setHex(P.BorderColour)):nvl(items.OOSPerc)>80&&"Y"==g_pogcr_enbl_oos_border?(P.BorderColour=g_pogcr_oos_border_color,P.WireframeObj.material.color.setHex(P.BorderColour)):P.BorderColour=0;var U=0;if(U="PEGBOARD"==y.ObjType?y.Z+y.D/2+E[W].D/2:"PALLET"==y.ObjType?"N"==y.ItemInfo[W].Edited?+E[W].D/2:y.ItemInfo[W].Z:.001+y.D/1e3,y.ItemInfo[W].X=B,y.ItemInfo[W].Z=U,y.ItemInfo[W].ObjID=Z,y.ItemInfo[W].CType=y.ObjType,void 0!==E[W].TopObjID&&""!==E[W].TopObjID||void 0!==E[W].BottomObjID&&""!==E[W].BottomObjID)reset_top_bottom_obj_id(""!==E[W].TopObjID&&void 0!==E[W].TopObjID?"BOTTOM":"TOP",L,Z,B,"N",p);"DIVIDER"==E[W].Item&&(g_pog_json[p].ModuleInfo[e].ShelfInfo[z].ShelfDivObjID=Z)}}else{W=0,E=y.ItemInfo;if("PEGBOARD"!==y.ObjType&&("CHEST"!=y.ObjType||"Y"!=g_chest_as_pegboard)){Y=E.some((e=>"Y"===e.Fixed));if("L"!=x||!Y||"HANGINGBAR"!=y.ObjType&&"SHELF"!=y.ObjType){A={X:"asc"};"Y"==g_allowItemSort&&E.keySort(A)}}for(const a of E){if(B=-1!==d&&W==r?d:get_item_xaxis(a.W,a.H,a.D,t,i,T,x,w,e,o,W,n,y.ItemInfo.length,s,p,v),"DIVIDER"==a.Item){k=g_pog_json[p].ModuleInfo[e].ShelfInfo,z=-1,X=0;for(const e of k)e.Shelf==a.ItemID&&"DIVIDER"==e.ObjType&&(z=X),X++;z>-1&&(g_pog_json[p].ModuleInfo[e].ShelfInfo[z].X=B)}y.ItemInfo[W].Distance=B-a.W/2-F,("PEGBOARD"==y.ObjType||"CHEST"==y.ObjType&&"Y"==g_chest_as_pegboard)&&(y.ItemInfo[W].PegBoardX=B-a.W/2-F,y.ItemInfo[W].PegBoardY=y.ItemInfo[W].Y-a.H/2-N,y.ItemInfo[W].FromProductList="N"),y.ItemInfo[W].OldObjID=a.ObjID;var Z;L=a.ObjID;if("Y"==H&&"DIVIDER"!==a.Item&&3!=E[W].MerchStyle){V=g_orientation_json[y.ItemInfo[W].Orientation].split("###");Z=await add_items_with_image(a.ItemID,a.W,a.H,a.D,a.Color,B,y.ItemInfo[W].Y,"",e,o,W,a.BHoriz,a.BVert,a.Item,parseInt(V[0]),parseInt(V[1]),"N",l,I,m,h,u,S,D,p)}else Z="DIVIDER"==a.Item?add_items(a.ItemID,a.W,a.H,a.D,a.Color,B,a.Y,"",e,o,W,a.Rotation,p):await add_items_prom(a.ItemID,a.W,a.H,a.D,a.Color,B,y.ItemInfo[W].Y,"",e,o,W,"N",l,c,"",D,u,S,p);for(G=0;G<g_combineItemModf.length;G++)g_combineItemModf[G].NewMIndex==e&&g_combineItemModf[G].NewSIndex==o&&g_combineItemModf[G].OldObjID==L&&(g_combineItemModf[G].NewObjID=Z);P=g_world.getObjectById(Z);if("E"==a.DimUpdate?(P.BorderColour=g_dim_error_color,P.WireframeObj.material.color.setHex(P.BorderColour)):"N"==a.Status?(P.BorderColour=g_status_error_color,P.Status="N",P.WireframeObj.material.color.setHex(P.BorderColour)):"No"==nvl(a.MovingItem)&&"Y"==g_pogcr_auto_hlite_non_mv_item?(P.BorderColour=g_nonMovingItemColor,P.WireframeObj.material.color.setHex(P.BorderColour)):nvl(a.OOSPerc)>80&&"Y"==g_pogcr_enbl_oos_border?(P.BorderColour=g_pogcr_oos_border_color,P.WireframeObj.material.color.setHex(P.BorderColour)):P.BorderColour=0,U="PEGBOARD"==y.ObjType?y.Z+y.D/2+a.D/2:"PALLET"==y.ObjType?"N"!=a.Edited||void 0!==a.TopObjID&&""!=a.TopObjID||void 0!==a.BottomObjID||""!=a.BottomObjID?y.ItemInfo[W].Z:+a.D/2:.001+y.D/1e3,y.ItemInfo[W].X=B,y.ItemInfo[W].Z=U,y.ItemInfo[W].ObjID=Z,y.ItemInfo[W].CType=y.ObjType,void 0!==a.TopObjID&&""!==a.TopObjID||void 0!==a.BottomObjID&&""!==a.BottomObjID)reset_top_bottom_obj_id(""!==a.TopObjID&&void 0!==a.TopObjID?"BOTTOM":"TOP",L,Z,B,"N",p);"DIVIDER"==a.Item&&z>-1&&(g_pog_json[p].ModuleInfo[e].ShelfInfo[z].ShelfDivObjID=Z),W+=1}console.log("finished loop ",e,o,y.Shelf,getDateTime())}E=y.ItemInfo;W=0;for(const e of E){if(void 0!==e.TopObjID&&""!==e.TopObjID||void 0!==e.BottomObjID&&""!==e.BottomObjID)reset_top_bottom_obj_id(""!==e.TopObjID&&void 0!==e.TopObjID?"BOTTOM":"TOP",e.OldObjID,e.ObjID,e.X,"Y",p);W+=1}if("SHELF"==y.ObjType||"PALLET"==y.ObjType)reset_top_bottom_objects(e,o,"N",p);if(""==f)await calculateFixelAndSupplyDays("N",p);"Y"==g_show_live_image&&g_canvas_objects.length>0&&animate_pog(p),g_item_edit_flag="",g_item_index=""}return logDebug("function : recreate_all_items","E"),B}catch(e){console.log("err",e),error_handling(e)}}async function reset_top_bottom_obj_id(e,o,t,n,i,r){logDebug("function : reset_top_bottom_obj_id; tier_ind : "+e+"; old_id : "+o+"; new_id : "+t+"; bottom_x : "+n+"; reset : "+i,"S");var a=g_pog_json[r].ModuleInfo,l=0;for(const _ of a){if(null==_.ParentModule||"undefined"==_.ParentModule){var s=0;for(const a of _.ShelfInfo){if(void 0!==a&&("SHELF"==a.ObjType||"PALLET"==a.ObjType)&&a.ItemInfo.length>0){var d=0;for(const _ of a.ItemInfo)"Y"==i&&"BOTTOM"==e&&_.BottomObjID==t&&(g_pog_json[r].ModuleInfo[l].ShelfInfo[s].ItemInfo[d].X=n,selected_object=g_world.getObjectById(g_pog_json[r].ModuleInfo[l].ShelfInfo[s].ItemInfo[d].ObjID),selected_object.position.set(n,_.Y,.001+g_pog_json[r].ModuleInfo[l].ShelfInfo[s].D/1e3)),"TOP"==e&&_.TopObjID==o&&"N"==i?g_pog_json[r].ModuleInfo[l].ShelfInfo[s].ItemInfo[d].TopObjID=t:"BOTTOM"==e&&_.BottomObjID==o&&(g_pog_json[r].ModuleInfo[l].ShelfInfo[s].ItemInfo[d].BottomObjID=t),d++}s++}}l++}return logDebug("function : reset_top_bottom_obj_id","E"),"SUCCESS"}function get_shelf_index(e,o){logDebug("function : get_shelf_index; obj_id : "+e,"S");var t=l_shelf_index=-1,n=g_pog_json[o].ModuleInfo;return $.each(n,(function(o,n){if(l_shelf_index>-1)return!1;null!=n.ParentModule&&"undefined"!=n.ParentModule||$.each(n.ShelfInfo,(function(n,i){return!(l_shelf_index>-1)&&(void 0!==i&&"BASE"!==i.ObjType&&"NOTCH"!==i.ObjType&&"DIVIDER"!==i.ObjType&&i.SObjID==e?(t=o,l_shelf_index=n,!1):void 0)}))})),logDebug("function : l_shelf_index","E"),[t,l_shelf_index]}async function generateCombinedShelfs(e,o,t,n,i,r,a,l,s,d,_="Y",g="",f,p="N",c="N"){try{logDebug("function : generateCombinedShelfs; p_pog_index : "+e,"S");var I=[],m=g_pog_json[e].ModuleInfo[o].ShelfInfo[t],h=wpdSetFixed(m.X-m.W/2),u=wpdSetFixed(m.X+m.W/2),S=g_pog_json[e].ModuleInfo,D=[],b=[],v=[],x={MIndex:"asc",X:"asc"};if("N"!==m.Combine&&("SHELF"==m.ObjType||"HANGINGBAR"==m.ObjType)){var O=0,C=!1;for(const o of S){if(null==o.ParentModule||"undefined"==o.ParentModule){var j=0;for(const t of o.ShelfInfo){let n="D"==p||wpdSetFixed(m.D)==wpdSetFixed(t.D);if(void 0!==t&&"N"!==t.Combine&&t.ObjType==m.ObjType&&wpdSetFixed(m.Y)==wpdSetFixed(t.Y)&&wpdSetFixed(m.H)==wpdSetFixed(t.H)&&m.Rotation==t.Rotation&&m.Slope==t.Slope&&n){var M,y=-1,H=-1;I.length>0?(M=I[I.length-1],y=wpdSetFixed(I[I.length-1].X-I[I.length-1].W/2),H=wpdSetFixed(I[I.length-1].X+I[I.length-1].W/2)):(M=m,y=h,H=u);var w=wpdSetFixed(t.X-t.W/2),T=wpdSetFixed(t.X+t.W/2);if(("R"!=t.Combine||"B"!=M.Combine&&"L"!=M.Combine||T!=y)&&("L"!=t.Combine||"B"!=M.Combine&&"R"!=M.Combine||w!=H)?("B"==t.Combine&&("R"==M.Combine&&w==H||"L"==M.Combine&&T==y||"B"==M.Combine&&(w==H||T==y))||"B"==t.Combine&&"B"==M.Combine&&"Y"==c&&t.PIndex==M.PIndex)&&(C=!0):C=!0,C)(re={}).PIndex=e,re.MIndex=O,re.SIndex=j,re.Shelf=t.Shelf,re.ObjType=t.ObjType,re.Combine=t.Combine,re.SpreadItem=t.SpreadItem,re.AllowAutoCrush=t.AllowAutoCrush,re.SObjID=t.SObjID,re.MObjID=o.MObjID,re.Module=o.Module,re.X=t.X,re.Y=t.Y,re.W=t.W,re.H=t.H,re.Slope=t.Slope,re.Rotation=t.Rotation,I.push(re),C=!1}j++}}O++}}var F=-1,N=!1;if(0==I.length){var[E,B]=getCombinationShelf(e,m.Shelf);if(-1!==E&&-1!==B){F=E,b=g_combinedShelfs[E],D=JSON.parse(JSON.stringify(b));var W=g_combinedShelfs[E][B];g_pog_json[W.PIndex].ModuleInfo[W.MIndex].ShelfInfo[W.SIndex];if(b.splice(B,1),b.keySort(x),b.length<2)N=!0;else if(b.length>2){g_combinedShelfs.splice(E,1);var R=0;for(obj of b){var P=b[R];if(void 0===(K=b[R+1]))break;var Y=wpdSetFixed(P.X+P.W/2),A=wpdSetFixed(K.X-K.W/2),k=g_pog_json[P.PIndex].ModuleInfo[P.MIndex].ShelfInfo[P.SIndex],z=g_pog_json[K.PIndex].ModuleInfo[K.MIndex].ShelfInfo[K.SIndex];void 0===b[R].CanCombine&&(b[R].CanCombine=!1,b[R+1].CanCombine=!1),Y!=A||("R"!=k.Combine||"B"!=z.Combine&&"L"!=z.Combine)&&("B"!=k.Combine||"L"!=z.Combine&&"B"!=z.Combine)?(b[R].CanCombine=!!b[R].CanCombine&&b[R].CanCombine,b[R].SubCombIndex=b[R].CanCombine?b[R].SubCombIndex:-1,b[R+1].CanCombine=!1,b[R+1].SubCombIndex=-1):void 0!==b[R].CanCombine&&b[R].CanCombine?(b[R+1].CanCombine=!0,b[R+1].SubCombIndex=b[R].SubCombIndex):(b[R].CanCombine=!0,b[R].SubCombIndex=R,b[R+1].CanCombine=!0,b[R+1].SubCombIndex=R),R++}b.keySort({SubCombIndex:"desc"});var X=0,L=-1,V=[],G=[];for(comb of b)L!==b[X].SubCombIndex&&0!==V.length&&(G.push(V),V=[]),b[X].CanCombine&&-1!==b[X].SubCombIndex&&V.push(comb),L=b[X].SubCombIndex,X++;for(currArr of(0!==V.length&&G.push(V),G)){currArr.keySort(x),currArr.SpreadItem=currArr[0].SpreadItem,currArr.AllowAutoCrush=currArr[0].AllowAutoCrush;var U=[],Z=[];for(ce of currArr){w=wpdSetFixed((de=g_pog_json[ce.PIndex].ModuleInfo[ce.MIndex].ShelfInfo[ce.SIndex]).X-de.W/2),T=wpdSetFixed(de.X+de.W/2);for(item of(U.push(w),Z.push(T),de.ItemInfo))item.Fixed="N"}var J=Math.min(...U),Q=Math.max(...Z);currArr.Start=J,currArr.End=Q;var q=g_combinedShelfs.length;for(ce of(g_combinedShelfs.push(currArr),await setCombinedShelfItems(e,q,-1,-1,"N","N",-1,-1,[]),currArr)){if(reorder_items((te=g_pog_json[ce.PIndex].ModuleInfo[ce.MIndex].ShelfInfo[ce.SIndex]).MIndex,te.SIndex,e))await recreate_all_items(te.MIndex,te.SIndex,te.ObjType,"Y",-1,-1,te.ItemInfo.length,"N","N",-1,-1,g_start_canvas,g,e,n,i,r,a,l,s,d,_)}}}else{P=b[0];var K=b[1],ee=(Y=wpdSetFixed(P.X+P.W/2),A=wpdSetFixed(K.X-K.W/2),P.Combine),oe=K.Combine;(Y!=A||("R"!=ee||"B"!=oe&&"L"!=oe)&&("B"!=ee||"L"!=oe&&"B"!=oe))&&(N=!0)}if(N){for(shelfs of g_combinedShelfs[E]){var te;if(reorder_items((te=g_pog_json[shelfs.PIndex].ModuleInfo[shelfs.MIndex].ShelfInfo[shelfs.SIndex]).MIndex,te.SIndex,e)){te.Combine="N";await recreate_all_items(te.MIndex,te.SIndex,te.ObjType,"Y",-1,-1,te.ItemInfo.length,"N","N",-1,-1,g_start_canvas,g,e,n,i,r,a,l,s,d,_)}}g_combinedShelfs.splice(E,1)}}}var[E,B]=getCombinationShelf(e,m.Shelf);if(I.length>0&&-1==E&&-1==B){var ne=[],ie=-1,re={};for(ce of(re.PIndex=e,re.MIndex=o,re.SIndex=t,re.Shelf=m.Shelf,re.ObjType=m.ObjType,re.Combine=m.Combine,re.SpreadItem=m.SpreadItem,re.AllowAutoCrush=m.AllowAutoCrush,re.SObjID=m.SObjID,re.MObjID=g_pog_json[e].ModuleInfo[o].MObjID,re.Module=g_pog_json[e].ModuleInfo[o].Module,re.X=m.X,re.Y=m.Y,re.W=m.W,re.H=m.H,re.Slope=m.Slope,re.Rotation=m.Rotation,I)){var[ae,le]=getCombinationShelf(e,ce.Shelf);-1!==ae&&-1!==le&&ne.push(ae)}if(ne.length>0){var se=ne[0];if(g_combinedShelfs[se].push(re),ne.length>1)for(combIndx of ne)if(combIndx!==se)for(actShelf of g_combinedShelfs[combIndx])g_combinedShelfs[se].push(actShelf),g_combinedShelfs.splice(actShelf,1);g_combinedShelfs[se].keySort(x),g_combinedShelfs[se].SpreadItem=g_combinedShelfs[se][0].SpreadItem,g_combinedShelfs[se].AllowAutoCrush=g_combinedShelfs[se][0].AllowAutoCrush,ie=se}else I.push(re),I=I.filter(((e,o,t)=>t.findIndex((o=>JSON.stringify(o)===JSON.stringify(e)))===o)),I.keySort(x),I.SpreadItem=I[0].SpreadItem,I.AllowAutoCrush=I[0].AllowAutoCrush,g_combinedShelfs.push(I),ie=g_combinedShelfs.length-1;U=[],Z=[];for(ce of g_combinedShelfs[ie]){var de;if(void 0!==(de=g_pog_json&&g_pog_json[ce.PIndex]&&g_pog_json[ce.PIndex].ModuleInfo&&g_pog_json[ce.PIndex].ModuleInfo[ce.MIndex]&&g_pog_json[ce.PIndex].ModuleInfo[ce.MIndex].ShelfInfo?g_pog_json[ce.PIndex].ModuleInfo[ce.MIndex].ShelfInfo[ce.SIndex]:void 0)){w=wpdSetFixed(de.X-de.W/2),T=wpdSetFixed(de.X+de.W/2);if(U.push(w),Z.push(T),Array.isArray(de.ItemInfo))for(item of de.ItemInfo)item.Fixed="N"}else logDebug("Warning: missing shelfDtl in generateCombinedShelfs (newCombinationIndex loop) for shelf: "+JSON.stringify(ce),"W")}J=Math.min(...U),Q=Math.max(...Z);g_combinedShelfs[ie].Start=J,g_combinedShelfs[ie].End=Q,await setCombinedShelfItems(e,ie,-1,-1,"N","N",-1,-1,[])}if(g_combinedShelfs.length>0&&void 0!==ie&&-1!==ie)v=JSON.parse(JSON.stringify(g_combinedShelfs[ie]));else if(b.length>0){v=JSON.parse(JSON.stringify(b));ie=F;N||(g_combinedShelfs[F].Start=wpdSetFixed(g_combinedShelfs[F][0].X-g_combinedShelfs[F][0].W/2),g_combinedShelfs[F].End=wpdSetFixed(g_combinedShelfs[F][g_combinedShelfs[F].length-1].X+g_combinedShelfs[F][g_combinedShelfs[F].length-1].W/2))}if(D.length>0&&v.length>0){if(N||await setCombinedShelfItems(e,ie,-1,-1,"N","N",-1,-1,[]),v.length>1)for(var _e=0;_e<D.length;_e++){P=D[_e],O=0;var ge=!0;for(ce of v)ce.SObjID==P.SObjID&&(ge=!1),O++;if(ge)if([fe,pe]=get_shelf_index(P.SObjID,P.PIndex),-1!==fe)if((ce=g_pog_json[P.PIndex].ModuleInfo[fe].ShelfInfo[pe]).ItemInfo.length>0&&(ce.Combine="N",reorder_items(fe,pe,P.PIndex)))await recreate_all_items(fe,pe,P.ObjType,"Y",-1,-1,ce.ItemInfo.length,"N","N",-1,-1,g_start_canvas,g,P.PIndex,n,i,r,a,l,s,d,_)}else if([fe,pe]=get_shelf_index(v[0].SObjID,v[0].PIndex),-1!==fe)if((ce=g_pog_json[v[0].PIndex].ModuleInfo[fe].ShelfInfo[pe]).ItemInfo.length>0&&reorder_items(fe,pe,v[0].PIndex)){ce.Combine="N";await recreate_all_items(fe,pe,v[0].ObjType,"Y",-1,-1,ce.ItemInfo.length,"N","N",-1,-1,g_start_canvas,g,v[0].PIndex,n,i,r,a,l,s,d,_)}}else{var[E,B]=getCombinationShelf(e,m.Shelf);if(-1!==E&&-1!==B){S=g_pog_json[g_combinedShelfs[E][0].PIndex].ModuleInfo;var fe=-1,pe=-1;if($.each(S,(function(e,o){if(pe>-1)return!1;null!=o.ParentModule&&"undefined"!=o.ParentModule||$.each(o.ShelfInfo,(function(o,t){return!(pe>-1)&&(void 0!==t&&"BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&t.SObjID==g_combinedShelfs[E][0].SObjID?(fe=e,pe=o,!1):void 0)}))})),-1!==fe&&-1!==pe){var ce=g_pog_json[g_combinedShelfs[E][0].PIndex].ModuleInfo[fe].ShelfInfo[pe];g_combinedShelfs[E].SpreadItem=ce.SpreadItem,g_combinedShelfs[E].AllowAutoCrush=ce.AllowAutoCrush,g_combinedShelfs[E][B].SpreadItem=ce.SpreadItem,g_combinedShelfs[E][B].AllowAutoCrush=ce.AllowAutoCrush}}if(reorder_items(o,t,e))await recreate_all_items(o,t,m.ObjType,"Y",-1,-1,m.ItemInfo.length,"N","N",-1,-1,g_start_canvas,g,e,n,i,r,a,l,s,d,_)}"N"!=f&&(g_pog_json[e].GenrateCombineS=get_combine_arr())}catch(e){logDebug("function : generateCombinedShelfs","E"),error_handling(e)}}function updateCombinedItemInfo(e,o,t,n,i){try{logDebug("function : updateCombinedItemInfo; p_pog_index : "+e+"; pModuleIndex : "+o+"; pShelfIndex : "+t+"; pItemX : "+n+"; pCombIndx : "+i,"S");var r,a,l,s,d,_=g_combinedShelfs[i];for(shelf_info of _)if(r=shelf_info.MIndex,a=shelf_info.SIndex,s=(l=g_pog_json[e].ModuleInfo[r].ShelfInfo[a]).X-l.W/2,d=l.X+l.W/2,n>s&&n<=d)return[r,a];return[o,t]}catch(e){logDebug("function : updateCombinedItemInfo","E"),error_handling(e)}}async function setCombinedShelfItems(e,o,t,n,i,r,a,l,s,d="N"){try{logDebug("function : setCombinedShelfItems; p_pog_index : "+e+"; pCombinationIndex : "+o+"; pCurrShelfCombIndx : "+t+"; pLocationX : "+n,"S");const F=g_combinedShelfs[o].SpreadItem;var _=JSON.parse(JSON.stringify(g_combinedShelfs[o]));_.SpreadItem=F;var g,f,p,c,I,m,h=[],u={NewMIndex:"asc",NewSIndex:"asc",OldMIndex:"asc",OldSIndex:"asc",OldIIndex:"asc",X:"asc"};for(obj of g_combineItemModf)obj.TransferItem="N";"R"==F&&(_=_.reverse()),await set_shelf_item_index(e);var S=0;for(combination of g_combinedShelfs){var D=[];for(shelf_info of combination)if(e==shelf_info.PIndex){h=g_pog_json[shelf_info.PIndex].ModuleInfo[shelf_info.MIndex].ShelfInfo[shelf_info.SIndex].ItemInfo;D=D.concat(h)}u={MIndex:"asc",SIndex:"asc",X:"asc"};"N"==d&&D.keySort(u),D.length>0&&(g_combinedShelfs[S].ItemInfo=D),S++}for(shelf_info of _){g=shelf_info.MIndex,f=shelf_info.SIndex,m=(p=g_pog_json[e].ModuleInfo[g].ShelfInfo[f]).HorizGap;var b=(h=g_pog_json[shelf_info.PIndex].ModuleInfo[shelf_info.MIndex].ShelfInfo[shelf_info.SIndex].ItemInfo).length,v=-1;if("R"==F)for(S=h.length-1;S>=0;S--){if(b-=1,v=get_item_xaxis(h[S].W,h[S].H,h[S].D,p.ObjType,n,m,F,m,g,f,b,i,g_pog_json[e].ModuleInfo[g].ShelfInfo[f].ItemInfo.length,r,e),[c,I]=updateCombinedItemInfo(e,g,f,v,o),h[S].OldX=h[S].X,h[S].X=v,c!=g||I!=f)(x={}).NewMIndex=c,x.NewSIndex=I,x.OldMIndex=g,x.OldSIndex=f,x.OldIIndex=S,x.OldObjID=h[S].ObjID,x.TransferItem="Y",g_combineItemModf.push(x)}else{S=0;for(const t of h){var x;if(v=-1!==a&&S==l?a:get_item_xaxis(t.W,t.H,t.D,p.ObjType,n,m,F,m,g,f,S,i,g_pog_json[e].ModuleInfo[g].ShelfInfo[f].ItemInfo.length,r,e),t.OldX=t.X,t.X=v,[c,I]=updateCombinedItemInfo(e,g,f,v,o),c!=g||I!=f)(x={}).NewMIndex=c,x.NewSIndex=I,x.OldMIndex=g,x.OldSIndex=f,x.OldIIndex=S,x.OldObjID=p.ItemInfo[S].ObjID,x.TransferItem="Y",g_combineItemModf.push(x);S++}}}for(modf of(g_combineItemModf.keySort(u),g_combineItemModf))if("Y"==modf.TransferItem){var O=[],C=[],j=[];for(obj of g_pog_json[e].ModuleInfo[modf.OldMIndex].ShelfInfo[modf.OldSIndex].ItemInfo)if(modf.OldObjID==obj.ObjID){j=obj;break}if(void 0!==j){S=0;for(const o of g_pog_json[e].ModuleInfo[modf.NewMIndex].ShelfInfo[modf.NewSIndex].ItemInfo)"R"!==F?o.X<j.X&&(O.push(j.X-o.X),C.push(S)):o.X>j.X&&(O.push(o.X-j.X),C.push(S)),S++;var M=Math.min.apply(Math,O),y=O.findIndex((function(e){return e==M}));if(O.length>0){var H="R"!==F?C[y]+1:C[y]-1;"R"==F&&-1==H&&(H=0)}else H=0;j.MIndex=modf.NewMIndex,j.SIndex=modf.NewSIndex,j.IIndex=H,null!=s&&s.length>0&&s[0].MIndex==modf.OldMIndex&&s[0].SIndex==modf.OldSIndex&&s[0].IIndex==modf.OldIIndex&&s[0].Iobjid==modf.OldObjID&&(s[0].MIndex=modf.NewMIndex,s[0].SIndex=modf.NewSIndex,s[0].IIndex=H),g_pog_json[e].ModuleInfo[modf.NewMIndex].ShelfInfo[modf.NewSIndex].ItemInfo.splice(H,0,j)}}for(modf of g_combineItemModf){var w=modf.OldObjID;if(void 0!==(j=g_pog_json[e].ModuleInfo[modf.OldMIndex].ShelfInfo[modf.OldSIndex].ItemInfo)&&"Y"==modf.TransferItem)for(S=0;S<j.length;S++)w==j[S].ObjID&&j.splice(S,1)}await set_shelf_item_index(e);S=0;for(combination of g_combinedShelfs){D=[];for(shelf_info of combination)if(e==shelf_info.PIndex){h=g_pog_json[shelf_info.PIndex].ModuleInfo[shelf_info.MIndex].ShelfInfo[shelf_info.SIndex].ItemInfo;D=D.concat(h);var T=0;for(const e of h)null!=s&&s.length>0&&s[0].MIndex==e.MIndex&&s[0].SIndex==e.SIndex&&s[0].Iobjid==e.ObjID&&(s[0].MIndex=e.MIndex,s[0].SIndex=e.SIndex,s[0].IIndex=T),T++}u={MIndex:"asc",SIndex:"asc",X:"asc"};"N"==d&&D.keySort(u),D.length>0&&(g_combinedShelfs[S].ItemInfo=D),S++}render()}catch(e){logDebug("function : setCombinedShelfItems","E"),error_handling(e)}}async function set_shelf_item_index(e){return logDebug("function : set_shelf_item_index","S"),new Promise((function(o,t){if(void 0!==g_pog_json&&g_pog_json.length>0&&void 0!==g_pog_json[e]){var n=g_pog_json[e].ModuleInfo;$.each(n,(function(o,t){null!=t.ParentModule&&"undefined"!=t.ParentModule||$.each(t.ShelfInfo,(function(t,n){void 0!==n&&("NOTCH"!==n.ObjType&&"BASE"!==n.ObjType&&(g_pog_json[e].ModuleInfo[o].ShelfInfo[t].PIndex=e,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].SIndex=t,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].MIndex=o),n.ItemInfo.length>0&&$.each(n.ItemInfo,(function(n,i){g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].PIndex=e,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].MIndex=o,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].SIndex=t,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].IIndex=n})))}))}))}o("SUCCESS"),logDebug("function : set_shelf_item_index","E")}))}function getLastItemCombinedShelf(e,o,t){try{logDebug("function : getLastItemCombinedShelf","S");var n=0,i=-1;for(const o of e.ItemInfo){if(o.ObjID==t){i=n;break}n++}var r={};return"R"==o?void 0!==e.ItemInfo[i+1]&&(r.IIndex=i+1,r.X=e.ItemInfo[i+1].X,r.W=e.ItemInfo[i+1].W,r.CurrIndex=i):void 0!==e.ItemInfo[i-1]&&(r.IIndex=i-1,r.X=e.ItemInfo[i-1].X,r.W=e.ItemInfo[i-1].W,r.CurrIndex=i),r}catch(e){logDebug("function : getLastItemCombinedShelf","E"),error_handling(e)}}function create_g_combine_shelfs(e,o){if(e[o].GenrateCombineS.length>0){for(main_obj of(e[o].GenrateCombineS.keySort({SComIndex:"asc",ShelfCombIndx:"asc"}),e[o].GenrateCombineS)){var t,n,i=[],r=[],a=[],l=[];for(obj of main_obj){if("SHELF"==obj.ObjType||"HANGINGBAR"==obj.ObjType){var s={};s.AllowAutoCrush=obj.AllowAutoCrush,s.Combine=obj.Combine,s.H=wpdSetFixed(obj.H),s.MIndex=obj.MIndex,s.Module=obj.Module,s.ObjType=obj.ObjType,s.PIndex=o,s.Rotation=obj.Rotation,s.SIndex=obj.SIndex,s.Shelf=obj.Shelf,s.Slope=obj.Slope,s.SpreadItem=obj.SpreadItem,s.W=wpdSetFixed(obj.SW),s.X=wpdSetFixed(obj.X),s.Y=wpdSetFixed(obj.Y),i.push(s),t=obj.CombAllowCrush,a.push(wpdSetFixed(obj.X-obj.SW/2)),l.push(wpdSetFixed(obj.X+obj.SW/2)),n=obj.CombSpreadItem}if("ITEM"==obj.OBJECT){var d={};d.W=wpdSetFixed(obj.W),d.Item=obj.Item,d.MIndex=obj.MIndex,d.SIndex=obj.SIndex,d.IIndex=obj.IIndex,d.Orientation=obj.Orientation,d.CrushHoriz=obj.CrushHoriz,d.CrushVert=obj.CrushVert,d.CrushD=obj.CrushD,d.MHorizCrushed=obj.MHorizCrushed,d.MVertCrushed=obj.MVertCrushed,d.MDepthCrushed=obj.MDepthCrushed,d.CWPerc=obj.CWPerc,d.CHPerc=obj.CHPerc,d.CDPerc=obj.CDPerc,d.H=wpdSetFixed(obj.H),d.D=wpdSetFixed(obj.D),d.X=wpdSetFixed(obj.X),d.Y=wpdSetFixed(obj.Y),d.Z=wpdSetFixed(obj.Z),d.RW=obj.RW,d.RH=obj.RH,d.RD=obj.RD,d.BHoriz=obj.BHoriz,d.BVert=obj.BVert,d.BaseD=obj.BaseD,d.Fixed=obj.Fixed,d.SpreadItem=obj.SpreadItem,r.push(d)}}i.AllowAutoCrush=t,i.Start=Math.min.apply(Math,a),i.End=Math.max.apply(Math,l),i.SpreadItem=n,i.ItemInfo=r,g_combinedShelfs.push(i)}}}function get_cap_max_merch(e,o,t,n,i,r,a="N",l="N",s=0){if(n.MaxMerch>0&&"N"==a)var d=n.MaxMerch;else if(n.X>=t.X-t.W/2&&n.X<t.X+t.W/2&&n.Y<=t.H+g_pog_json[i].BaseH&&n.Y>0)d=get_module_max_merch(e,o,i,l,s);else if(n.Y<t.H+g_pog_json[i].BaseH&&n.Y>0)d=t.H+g_pog_json[i].BaseH-n.Y;else d=r;return d}function mergeAdjacentItems(e,o,t,n){try{var i=-1,r=!1,a=-1,l=-1,s=g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo.length-1,d=g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n],_=d.ItemID,g=-1,f=-1,p=d.ObjID;if(void 0!==s&&0!==s&&"DIVIDER"!==d.Item&&(0==n?l=n+1:(n==s||(l=n+1),a=n-1),g=-1!==l?g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[l]:-1,f=-1!==a?g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[a]:-1,-1!==g&&_==g.ItemID&&d.BVert==g.BVert&&d.BaseD==g.BaseD?(g.BHoriz=g.BHoriz+d.BHoriz,i=n+1,r=!0):-1!==f&&_==f.ItemID&&d.BVert==f.BVert&&d.BaseD==f.BaseD&&(f.BHoriz=f.BHoriz+d.BHoriz,i=a,r=!0),r)){var c=g_pog_json[e].ModuleInfo[o].ShelfInfo[t],I=g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[i],m=0;g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo.splice(n,1);var h=g_world.getObjectById(p);void 0!==h&&g_world.remove(h);for(const n of g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo){if(n.ObjID==I.ObjID){i=m;break}m++}var[u,S,D]=get_select_dim(I);I.Exists="N";const[r,a,l,s,d,_]=set_dim_validate_item(o,t,i,u,S,D,I.ItemNesting,I.NVal,I.BHoriz,I.BVert,I.BaseD,I.Orientation,I.OrgCWPerc,I.OrgCHPerc,I.OrgCDPerc,"Y","Y","Y",e);if("ERROR"!==r){var[b,v]=get_item_xy(c,I,r,a,e);I.X=b,I.Y=v,I.Exists="E",I.W=r,I.H=a,I.D=l,I.RW=s,I.RH=d,I.RD=_}}return i}catch(e){error_handling(e)}}function get_combine_arr(){var e=[],o=[],t={},n=0;for(combination of g_combinedShelfs){var i={};e=[];var r=0;for(shelf_info of combination)(t={}).SW=shelf_info.W,t.Shelf=shelf_info.Shelf,t.H=shelf_info.H,t.OBJECT="SHELF",t.SComIndex=n,t.ShelfCombIndx=r,t.AllowAutoCrush=shelf_info.AllowAutoCrush,t.Combine=shelf_info.Combine,t.Module=shelf_info.Module,t.ObjType=shelf_info.ObjType,t.PIndex=shelf_info.PIndex,t.MIndex=shelf_info.MIndex,t.SIndex=shelf_info.SIndex,t.Rotation=shelf_info.Rotation,t.Slope=shelf_info.Slope,t.SpreadItem=shelf_info.SpreadItem,t.W=shelf_info.W,t.X=shelf_info.X,t.Y=shelf_info.Y,t.CombSpreadItem=g_combinedShelfs[0].SpreadItem,t.CombAllowCrush=g_combinedShelfs[0].AllowAutoCrush,t.CombStart=g_combinedShelfs[0].Start,t.CombEnd=g_combinedShelfs[0].End,e.push(t),r++;for(items of combination.ItemInfo)(i={}).SW=items.RW,i.Item=items.Item,i.MIndex=items.MIndex,i.SIndex=items.SIndex,i.IIndex=items.IIndex,i.Shelf=g_pog_json[items.PIndex].ModuleInfo[items.MIndex].ShelfInfo[items.SIndex].Shelf,i.Orientation=items.Orientation,i.CrushHoriz=items.CrushHoriz,i.CrushVert=items.CrushVert,i.CrushD=items.CrushD,i.MHorizCrushed=items.MHorizCrushed,i.MVertCrushed=items.MVertCrushed,i.MDepthCrushed=items.MDepthCrushed,i.CWPerc=items.CWPerc,i.CHPerc=items.CHPerc,i.CDPerc=items.CDPerc,i.H=items.H,i.D=items.D,i.X=items.X,i.Y=items.Y,i.Z=items.Z,i.RW=items.RW,i.RH=items.RH,i.RD=items.RD,i.W=items.W,i.SpreadItem=items.SpreadItem,i.Fixed=items.Fixed,i.BHoriz=items.BHoriz,i.BVert=items.BVert,i.BaseD=items.BaseD,i.OBJECT="ITEM",i.IComIndex=n,e.push(i);o.push(e),n++}return o}async function set_item_capping(e,o,t,n,i,r){logDebug("function : set_item_capping; i_item_index : "+n,"S");try{if("Y"==i&&void 0!==g_json[0]&&g_json.length>0)if(void 0!==g_json[0].ModuleInfo[o].ShelfInfo[t])var a=(d=(s=g_json[0].ModuleInfo[o].ShelfInfo[t]).ItemInfo[n]).RH*d.BVert,l=d.RD*d.BaseD;else a=(d=(s=g_pog_json[e].ModuleInfo[o].ShelfInfo[t]).ItemInfo[n]).RH,l=d.RD;else{var s,d;a=(d=(s=g_pog_json[e].ModuleInfo[o].ShelfInfo[t]).ItemInfo[n]).RH,l=d.RD}var _=-1,g=g_pog_json[e].ModuleInfo[o],f=0,p=0,c=0,I="N",m=0,h=0;if(("1"==d.CapStyle||"2"==d.CapStyle||"3"==d.CapStyle)&&"SHELF"==s.ObjType){var u=d.CapMerch;if("Y"==i&&void 0!==g_json[0])var S=get_onload_max_merch(o,t,g,s,g_dft_max_merch,0,g_json);else S=get_cap_max_merch(o,t,g,s,e,g_dft_max_merch);h=S;var D=d.CapMaxH,b=(u=""==d.CapMerch?"0":d.CapMerch,""==d.CapOrientaion?"4":d.CapOrientaion);"0"==u?wpdSetFixed(d.UW)!==wpdSetFixed(d.OrgUW)||wpdSetFixed(d.UH)!==wpdSetFixed(d.OrgUH)||wpdSetFixed(d.UD)!==wpdSetFixed(d.OrgUD)?(p=d.OrgUW,c=d.OrgUH,m=d.OrgUD):(p=d.UW,c=d.UH,m=d.UD):"2"==u?wpdSetFixed(d.CW)!==wpdSetFixed(d.OrgCW)||wpdSetFixed(d.CH)!==wpdSetFixed(d.OrgCH)||wpdSetFixed(d.CD)!==wpdSetFixed(d.OrgCD)?(p=d.OrgCW,c=d.OrgCH,m=d.OrgCD):(p=d.CW,c=d.CH,m=d.CD):"1"==u?wpdSetFixed(d.TW)!==wpdSetFixed(d.OrgTW)||wpdSetFixed(d.TH)!==wpdSetFixed(d.OrgTH)||wpdSetFixed(d.TD)!==wpdSetFixed(d.OrgTD)?(p=d.OrgTW,c=d.OrgTH,m=d.OrgTD):(p=d.TW,c=d.TH,m=d.TD):"3"==u&&(wpdSetFixed(d.DW)!==wpdSetFixed(d.OrgDW)||wpdSetFixed(d.DH)!==wpdSetFixed(d.OrgDH)||wpdSetFixed(d.DD)!==wpdSetFixed(d.OrgDD)?(p=d.OrgDW,c=d.OrgDH,m=d.OrgDD):(p=d.DW,c=d.DH,m=d.DD));var[v,x,O,C,j,M]=get_new_orientation_dim(b,p,c,m),y=c,H=""!==d.CapDepth&&d.CapDepth>1?parseInt(d.CapDepth):1;y*H>l&&(d.CapDepth=Math.trunc(l/O)),c="W"==C?p:m;var w=""!==d.CapFacing&&d.CapFacing>0&&d.CapFacing>D&&D>0?parseInt(D):parseInt(d.CapFacing);"1"==d.CapStyle?(S-=a,_=Math.trunc(S/c),l<O&&(_=0),_>0&&(f=a+c*(_=1))):"2"==d.CapStyle?(S-=a,_=Math.trunc(S/c),"2"==d.MaxHCapStyle&&_>D&&D>0&&(_=D),_=_>0?"Y"==d.MCapTopFacing&&w>0?w:_:0,l<O&&(_=0),_>0&&(f=a+c*_)):"3"==d.CapStyle&&(S-=a/d.BVert,_=Math.trunc(S/c),"3"==d.MaxHCapStyle&&_>D&&D>0&&(_=D),_=_>0?"Y"==d.MCapTopFacing&&w>0?w:_:0,l<O&&(_=0),_>0&&(f=a/d.BVert+c*_,d.BVert=1))}if(0==p&&0==c&&0==m&&"Y"==r)g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapMerch=u,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapOrientaion=b;else if(_>0){var T=d.BHoriz,F=_*T*H;if("Y"==r){g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapFacing=_,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapMerch=u,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapOrientaion=b,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapHeight=c,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].MCapTopFacing=d.MCapTopFacing,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapDepth=Math.trunc(l/O),g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapCount=_,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapHorz=T,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapTotalCount=F,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].H=f;var[N,E]=get_item_xy(s,d,d.W,d.H,e);g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].Y=E}}else if("Y"==r){g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapFacing=0,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapHeight=0,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].MCapTopFacing="N",g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapCount=0,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapHorz=0,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapDepth=0,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapTotalCount=0,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapStyle=d.CapStyle,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].H=a;var[N,E]=get_item_xy(s,d,d.W,d.H,e);g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].Y=E}return h>=f&&(I="Y"),I}catch(e){error_handling(e)}}function checkChestCrushedItemHit(e,o,t,n,i,r){try{var a=0,l=wpdSetFixed(e-t/2),s=wpdSetFixed(e+t/2),d=wpdSetFixed(o+n/2),_=wpdSetFixed(o-n/2);const I=wpdSetFixed(i.X-i.W/2),m=wpdSetFixed(i.X+i.W/2),h=wpdSetFixed(i.Y-i.H/2),u=wpdSetFixed(i.Y+i.H/2);for(const e of i.ItemInfo){if(a!==r){var g=wpdSetFixed(e.X-e.W/2),f=wpdSetFixed(e.X+e.W/2),p=wpdSetFixed(e.Y+e.H/2),c=wpdSetFixed(e.Y-e.H/2);if(d<c||_>p||s<g||l>f){if(d>u||_<h||l<I||s>m)return"Y"}else if(d>c&&c>_&&!(_<p&&p<d)&&(l<f&&f<s||s>g&&g>l)||!(d>c&&c>_)&&_<p&&p<d&&(l<f&&f<s||s>g&&g>l)||(d>c&&c>_||_<p&&p<d)&&!(l<f&&f<s)&&s>g&&g>l||(d>c&&c>_||_<p&&p<d)&&l<f&&f<s&&!(s>g&&g>l))return"Y"}a++}return"N"}catch(e){error_handling(e)}}function getChestOverlappedItemDimension(e,o,t,n,i){try{const S=wpdSetFixed(e-t/2),D=wpdSetFixed(e+t/2),b=wpdSetFixed(o+n/2),v=wpdSetFixed(o-n/2);var r,a,l,s,d=0,_=0,g=0,f=0,p=0,c=0,I="N",m="N";"CHEST"==nvl(i.ObjType)?(r=wpdSetFixed(i.Y+i.H/2),a=wpdSetFixed(i.Y-i.H/2),l=wpdSetFixed(i.X-i.W/2),s=wpdSetFixed(i.X+i.W/2),b>r&&(_=p=b-r,m="Y"),v<a&&(_+=c=a-v,m="Y"),S<l&&(d=g=shelf_start-l,m="Y"),D>s&&(d+=f=D-s,m="Y")):(r=wpdSetFixed(i.Y+i.H/2),a=wpdSetFixed(i.Y-i.H/2),l=wpdSetFixed(i.X-i.W/2),s=wpdSetFixed(i.X+i.W/2),b>a&&a>v&&!(v<r&&r<b)&&(_=p=b-a,I="Y"),v<r&&r<b&&!(b>a&&a>v)&&(_+=c=r-v,I="Y"),S<s&&s<D&&!(D>l&&l>S)&&(d=g=s-S,I="Y"),D>l&&l>S&&!(S<s&&s<D)&&(d+=f=D-l,I="Y"));const x=Math.ceil(d/t*100),O=Math.ceil(_/n*100),C=wpdSetFixed(t*(1-x/100)),j=wpdSetFixed(n*(1-O/100));var h=e,u=o;return 0!==x&&(h=f>g?"Y"==m?s-C/2:l-C/2:"Y"==m?l+C/2:s+C/2),0!==O&&(u=p>c?"Y"==m?r-j/2:a-j/2:"Y"==m?a+j/2:r+j/2),"Y"==I||"Y"==m?0==x&&0!==O?[e,u,t,j,0,O]:0!==x&&0==O?[h,o,C,n,x,0]:0!==x&&0!==O?"Y"==m?[h,u,C,j,x,O]:x>O?[e,u,t,j,0,O]:[h,o,C,n,x,0]:[e,o,t,n,0,0]:[e,o,t,n,0,0]}catch(e){error_handling(e)}}function crushChestItemHW(e,o,t,n,i,r,a,l,s,d){try{var _=0,g=o.RH+nvl(o.CapHeight),f=o.RW,p=o.X,c=o.Y,I=[],m=wpdSetFixed(p-f/2),h=wpdSetFixed(p+f/2),u=wpdSetFixed(c+g/2),S=wpdSetFixed(c-g/2);for(const o of e.ItemInfo)if(_!==t){var D=wpdSetFixed(o.X-o.W/2),b=wpdSetFixed(o.X+o.W/2),v=wpdSetFixed(o.Y+o.H/2);u<wpdSetFixed(o.Y-o.H/2)||S>v||h<D||m>b||I.push(o),_++}var x=wpdSetFixed(e.X-e.W/2),O=wpdSetFixed(e.X+e.W/2),C=wpdSetFixed(e.Y-e.H/2);(u>wpdSetFixed(e.Y+e.H/2)||S<C||m<=x||h>O)&&I.push(e);var[j,M,y,H]=[p,c,f,g],w=0,T=0;for(ovpItem of I)[j,M,y,H,itemWidthCrush,itemHeightCrush]=getChestOverlappedItemDimension(j,M,y,H,ovpItem),w+=itemWidthCrush,T+=itemHeightCrush;if("Y"==d){if(w<=i&&T<=n&&"N"==r&&"N"==a)return o.W=y,o.X=j,o.WChanged="Y","W"==s?o.CrushHoriz=w:"H"==s?o.CrushVert=w:"D"==s&&(o.CrushD=w),o.H=H,o.Y=M,o.HChanged="Y","H"==l?o.CrushVert=T:"W"==l?o.CrushHoriz=T:"D"==l&&(o.CrushD=T),g_error_category="","Y";if("Y"==r||"Y"==a){const d=wpdSetFixed(f-f*(i/100)),_=wpdSetFixed(g-g*(n/100));return"N"==checkChestCrushedItemHit(o.X,o.Y,"Y"==r?d:f,"Y"==a?_:o.H,e,t)?("Y"==r&&(o.W=d,o.WChanged="Y","W"==s?o.CrushHoriz=i:"H"==s?o.CrushVert=i:"D"==s&&(o.CrushD=i)),"Y"==a&&(o.H=_,o.HChanged="Y","H"==l?o.CrushVert=n:"W"==l?o.CrushHoriz=n:"D"==l&&(o.CrushD=n)),g_error_category="","Y"):(g_error_category="W","N")}return g_error_category="","Y"}return g_error_category="","Y"}catch(e){error_handling(e)}}function permuteArrayOfArrays(e){let o=[];return function e(t,n=[]){if(0===t.length)o.push(n);else for(let o=0;o<t.length;o++){let i=t.slice(),r=i.splice(o,1);e(i.slice(),n.concat(r))}}(e),o}function getSafeRandomizedLayout(e,o,t,n,i,r=5e3){let a=null,l=-1/0;for(let s=0;s<r;s++){const r=e.slice().sort((()=>Math.random()-.5)),s=[];let d=o,_=t,g=0,f=0;for(const e of r){let[o,t,r,a,l,p]=getChestOverlappedItemDimension(d,_,n,i,e);const c=.5*n,I=.5*i;r<c&&(r=c),a<I&&(a=I),s.push({item:e,ItemX:d,ItemY:_,ItemW:r,ItemH:a,ItemWidthCrush:l,ItemHeightCrush:p,Area:r*a}),f+=r*a,d+=r,g=Math.max(g,a)}f>l&&(l=f,a=s)}return a}function getObjectWithHighestValue(e,o){return e.reduce(((e,t)=>t[o]>(e[o]||-1/0)?t:e),{})}function showItemSubLabel(e,o,t,n,i){try{var r,a=g_pog_json[i].ModuleInfo,l={};void 0===g_undoRedoAction&&(g_undoRedoAction="REDO"),r="REDO"==g_undoRedoAction?"U":"R";var s=0;if("Y"==o)for(const r of a){if(void 0===r.ParentModule||null==r.ParentModule){var d=r.ShelfInfo,_=0;for(const r of d){if("BASE"!==r.ObjType&&"NOTCH"!==r.ObjType&&"DIVIDER"!==r.ObjType&&"TEXTBOX"!==r.ObjType&&r.ItemInfo.length>0){var g=r.ItemInfo,f=0;for(const a of g){if("DIVIDER"!==a.Item){if(void 0!==(C=g_scene_objects[i].scene.children[2].getObjectById(a.ObjID))){if(void 0!==a.SubLblObjID&&-1!==a.SubLblObjID){var p=C.getObjectById(a.SubLblObjID);C.remove(p)}var c,I,m,h,u=t;null==hexToRgb(u)?(I=parseInt("FF",16),m=parseInt("FF",16),h=parseInt("FF",16)):(I=hexToRgb(u).r,m=hexToRgb(u).r,h=hexToRgb(u).g),c=getTextColor(I,m,h);var S="",D=get_sales_info(i,a.ItemID);if("LPR"==e)S=0!==nvl(a.ItemID)?a.ItemID:"";else if("LQT"==e)S=0!==nvl(a.SalesUnit)?a.SalesUnit:"";else if("LSL"==e){var b=parseFloat(a.AvgSales).toFixed(2);S=0!==nvl(a.AvgSales)?b:""}else if("LST"==e)S=0!==nvl(a.StoreSOH)?a.StoreSOH:"";else if("LDP"==e)S=0!==nvl(a.ActualDPP)?a.ActualDPP:"";else if("LSC"==e)S=0!==nvl(a.StoreCnt)?a.StoreCnt:"";else if("LNP"==e)0!==nvl(a.NewItem)&&"N"!==a.NewItem&&"Y"!==a.LiveNewItem?S=a.NewItem:"N"!==a.LiveNewItem&&"Y"==g_pogcr_live_new_item&&(S=0!==nvl(a.LiveNewItem)&&"Y"==a.LiveNewItem?"New":"");else if("COS"==e){var v=a.SizeDesc.split("*"),x=a.CapFacing*a.CapDepth*a.CapHorz*parseInt(1==a.CapMerch?a.UnitperTray:1);l=(a.BHoriz*a.BVert*a.BaseD*parseInt(1==a.MerchStyle?a.UnitperTray:2==a.MerchStyle?a.UnitperCase:1)+x)/parseInt(v[1]),S=isNaN(l)||!isFinite(l)?"":l.toFixed(1)}else"DOS"==e?(l=a.BHoriz*a.BVert*a.BaseD*parseInt(1==a.MerchStyle?a.UnitperTray:2==a.MerchStyle?a.UnitperCase:1)/(D.SalesUnitPerWeek/7),S=isNaN(l)||!isFinite(l)?"":l.toFixed(1)):"SU"==e?S=0!==nvl(D.SalesUnitPerWeek)?D.SalesUnitPerWeek:"":"SV"==e?S=0!==nvl(D.SalesPerWeek)?D.SalesPerWeek:"":"VRMPer"==e?S=0!==nvl(D.VRMPer)?D.VRMPer:"":"EDLP"==e&&(S=0!==nvl(a.EDLP)?a.EDLP:"");if(console.log("text",nvl(a.LiveNewItem),a.LiveNewItem),""!==S){var O=addlabelText(S,g_labelFont,g_labelActualSize,c,"center",u);C.add(O),O.position.x=0,O.position.y="CENTER"!=n&&"BOTTOM"!=n||"Y"!=o?0-a.H/2+.0015625*g_labelFont:a.H/2+.0015625*g_labelFont,0!==r.Rotation||0!==r.Slope?O.position.z=a.D/2+.0055:O.position.z=.0015,g_pog_json[i].ModuleInfo[s].ShelfInfo[_].ItemInfo[f].SubLblObjID=O.id}}}else if("DIVIDER"!==a.Item){if(void 0!==a.SubLblObjID&&-1!==a.SubLblObjID)if(void 0!==(C=g_scene_objects[i].scene.children[2].getObjectById(a.ObjID))){p=C.getObjectById(a.SubLblObjID);C.remove(p)}}f+=1}}_+=1}}s+=1}else{s=0;for(const e of a){if(void 0===e.ParentModule||null==e.ParentModule){d=e.ShelfInfo,_=0;for(const e of d){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.ItemInfo.length>0){g=e.ItemInfo,f=0;for(const e of g){var C;if("DIVIDER"!==e.Item&&""!==e.LocID&&void 0!==e.LocID)if(void 0!==(C=g_scene_objects[i].scene.children[2].getObjectById(e.ObjID))){if(void 0!==e.SubLblObjID&&-1!==e.SubLblObjID){p=C.getObjectById(e.SubLblObjID);C.remove(p)}g_pog_json[i].ModuleInfo[s].ShelfInfo[_].ItemInfo[f].SubLblObjID=-1}f+=1}}_+=1}}s+=1}}const j=g_itemSubLabelInd,M=g_itemSubLabel;l.item_sale_label_ind=j,l.item_sale_label_type=M,(g_undo_details=[]).push(l),"U"==r?(g_delete_details.multi_delete_shelf_ind="N",(g_undo_all_obj_arr=[]).push(g_undo_details),g_undo_all_obj_arr.push(g_cut_copy_arr),g_undo_all_obj_arr.previousAction="ITEM_SALE_LABEL",g_cut_support_obj_arr.length>0?g_undo_all_obj_arr.hasSupportArr="Y":g_undo_all_obj_arr.hasSupportArr="N",g_undo_all_obj_arr.g_MultiObjects="N",g_undo_all_obj_arr.multi_delete_shelf_ind="N",g_undo_final_obj_arr.push(g_undo_all_obj_arr),"Y"!=g_delete_details.is_dragging&&(g_delete_details=[]),g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]):(g_delete_details.multi_delete_shelf_ind="N",(g_redo_all_obj_arr=[]).push(g_undo_details),g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.previousAction="ITEM_SALE_LABEL",g_cut_support_obj_arr.length>0?g_redo_all_obj_arr.hasSupportArr="Y":g_redo_all_obj_arr.hasSupportArr="N",g_redo_all_obj_arr.g_MultiObjects="N",g_redo_all_obj_arr.multi_delete_shelf_ind="N",g_redo_final_obj_arr.push(g_redo_all_obj_arr),"Y"!=g_delete_details.is_dragging&&(g_delete_details=[]),g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]),g_itemSubLabelInd=o,g_itemSubLabel=e,animate_pog(i),render(i)}catch(e){error_handling(e)}}function add_merch_border(e,o,t,n,i,r,a,l){try{logDebug("function : add_merch_border; width : "+o+"; height : "+t+"; shelf_height : "+n+"; obj_type : "+i+"; rotation : "+r+"; slope : "+a,"S");var s=new THREE.BoxGeometry(o,t-.01,0),d=new THREE.EdgesGeometry(s),_=new THREE.LineBasicMaterial({color:16711680,linewidth:2}),g=new THREE.LineSegments(d,_);g.renderOrder=1,e.add(g),g.uuid="merch_border",e.merchid=g.id,g.position.x=0,0===r&&0===a||(g.rotateY(r*Math.PI/180),g.rotateX(a*Math.PI/180)),"HANGINGBAR"==i?(g.position.y=-(t/2+n/2),"Y"==l.Topmerch&&0==l.MaxMerch?l.Merch=0:"Y"!==l.Topmerch&&0!=l.MaxMerch?l.Merch=l.MaxMerch:l.Merch=wpdSetFixed(-(t/2+n/2))):(g.position.y=t/2+n/2+5e-4,"Y"==l.Topmerch&0==l.MaxMerch?l.Merch=0:"Y"!==l.Topmerch&&0!=l.MaxMerch?l.Merch=l.MaxMerch:l.Merch=wpdSetFixed(t/2+n/2+5e-4)),logDebug("function : add_merch_border","E")}catch(e){error_handling(e)}}async function add_merch(e,o){try{logDebug("function : add_merch; add_ind : "+e,"S");var t,n,i={};if(void 0===g_undoRedoAction&&(g_undoRedoAction="REDO"),t="REDO"==g_undoRedoAction?"U":"R","Y"==e){var r=g_pog_json[o].ModuleInfo;$.each(r,(function(e,t){null!=t.ParentModule&&void 0!==t.ParentModule||$.each(t.ShelfInfo,(function(n,i){if(void 0!==i&&"NOTCH"!==i.ObjType&&"BASE"!==i.ObjType&&"TEXTBOX"!==i.ObjType&&"DIVIDER"!==i.ObjType&&"ROD"!==i.ObjType&&"PEGBOARD"!==i.ObjType){if(i.MaxMerch>0)var r=i.MaxMerch;else if(i.X>=t.X-t.W/2&&i.X<t.X+t.W/2&&i.Y<=t.H+g_pog_json[o].BaseH&&i.Y>0){r=get_module_max_merch(e,n,o);i.TOP="Y"}else if(i.Y<t.H+g_pog_json[o].BaseH&&i.Y>0)r=t.H+g_pog_json[o].BaseH-i.Y;else r=g_default_max_merch;var a,l=g_scene_objects[o].scene.children[2].getObjectById(i.SObjID);if(a=0!==i.Rotation||0!==i.Slope?i.ShelfRotateWidth:i.W,void 0!==(l=g_scene_objects[o].scene.children[2].getObjectById(i.SObjID)).merchid){var s=g_scene_objects[o].scene.children[2].getObjectById(l.merchid);void 0!==s&&l.remove(s)}add_merch_border(l,a,r,i.H,i.ObjType,i.Rotation,i.Slope,i)}}))}))}else{r=g_pog_json[o].ModuleInfo;$.each(r,(function(e,t){null!=t.ParentModule&&void 0!==t.ParentModule||$.each(t.ShelfInfo,(function(e,t){if(void 0!==t&&"NOTCH"!==t.ObjType&&"BASE"!==t.ObjType&&"TEXTBOX"!==t.ObjType&&"DIVIDER"!==t.ObjType&&"ROD"!==t.ObjType&&"PEGBOARD"!==t.ObjType){var n=g_scene_objects[o].scene.children[2].getObjectById(t.SObjID),i=g_scene_objects[o].scene.children[2].getObjectById(n.merchid);n.remove(i)}}))}))}n="Y"==e?"N":"Y",i.g_show_max_merch=n,void 0!==g_scene_objects[o].Indicators&&(g_scene_objects[o].Indicators.MaxMerch=e),(g_undo_details=[]).push(i),"U"==t?(g_delete_details.multi_delete_shelf_ind="N",(g_undo_all_obj_arr=[]).push(g_undo_details),g_undo_all_obj_arr.push(g_cut_copy_arr),g_undo_all_obj_arr.previousAction="MAX_MERCH",g_cut_support_obj_arr.length>0?g_undo_all_obj_arr.hasSupportArr="Y":g_undo_all_obj_arr.hasSupportArr="N",g_undo_all_obj_arr.g_MultiObjects="N",g_undo_all_obj_arr.multi_delete_shelf_ind="N",g_undo_final_obj_arr.push(g_undo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]):(g_delete_details.multi_delete_shelf_ind="N",(g_redo_all_obj_arr=[]).push(g_undo_details),g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.previousAction="MAX_MERCH",g_cut_support_obj_arr.length>0?g_redo_all_obj_arr.hasSupportArr="Y":g_redo_all_obj_arr.hasSupportArr="N",g_redo_all_obj_arr.g_MultiObjects="N",g_redo_all_obj_arr.multi_delete_shelf_ind="N",g_redo_final_obj_arr.push(g_redo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]),render(o),logDebug("function : add_merch","E")}catch(e){error_handling(e)}}function widthCrushItemWithFixedDivider(e,o,t,n,i){try{var r="Y",a=g_pog_json[e].ModuleInfo[o].ShelfInfo[t],l=a.ItemInfo,s=wpdSetFixed(a.X-a.W/2),d=wpdSetFixed(a.X+a.W/2),_=[],g=[],f=[],p=-1,c=-1,I=-1,m=0,h=0,u="N";for(item of l)"Y"==item.Fixed?(0==m?(c=wpdSetFixed(item.X+item.W/2),I=d,g.AvlSpace=I-c):(g.ItemInfo=f,f=[],0==h&&0==_.length?(c=s,I=wpdSetFixed(item.X-item.W/2),g.AvlSpace=I-c,_.push(g),g=[],h++):h>0?(c=l[p].X+l[p].W/2,I=wpdSetFixed(item.X-item.W/2),g.AvlSpace=I-c,_.push(g),g=[],h++):console.log(l,_,g,f)),p=m):(item.IIndex=m,f.push(item)),m==l.length-1&&("Y"!=item.Fixed?(g.ItemInfo=f,c=wpdSetFixed(l[p].X+l[p].W/2),I=d,g.AvlSpace=I-c,_.push(g),g=[],f=[]):0!==nvl(g)&&(I=wpdSetFixed(item.X-item.W/2),g.AvlSpace=I-c,_.push(g))),m++;for(partShelf of _){var S="N",D=[],b=[],v=[],x=0;for(items of partShelf.ItemInfo){var O=0,C=items.Orientation,[j,M,y,H,w,T]=get_new_orientation_dim(C,0,0,0),F=void 0===items.MHorizCrushed||null==items.MHorizCrushed||"N"==items.MHorizCrushed?"N":"Y";"W"==w?O="N"==F&&items.CWPerc>0?items.CWPerc:items.CrushHoriz:"H"==w?O="N"==F&&items.CHPerc>0?items.CHPerc:items.CrushVert:"D"==w&&(O="N"==F&&items.CDPerc>0?items.CDPerc:items.CrushD),"N"==items.Fixed&&O>0&&(S="Y",D.push(items.IIndex),b.push(items.W),v.push(F))}if("Y"==S){S="N";for(var N=0;N<100;N++){var E=0,B=0,W="N";for(items of partShelf.ItemInfo){O=0,C=items.Orientation;var[j,M,y,H,w,T]=get_new_orientation_dim(C,0,0,0);if(F=void 0===items.MHorizCrushed||null==items.MHorizCrushed||"N"==items.MHorizCrushed?"N":"Y","W"==w?O="N"==F&&items.CWPerc>0?items.CWPerc:items.CrushHoriz:"H"==w?O="N"==F&&items.CHPerc>0?items.CHPerc:items.CrushVert:"D"==w&&(O="N"==F&&items.CDPerc>0?items.CDPerc:items.CrushD),-1!==D.indexOf(items.IIndex)&&N<=O){var R=void 0!==items.RW&&null!==items.RW?items.RW:items.W;"N"==F?(B=wpdSetFixed(R-R*(N/100)))>=wpdSetFixed(R-R*(O/100))?(E+=B,"Y"==i&&(a.ItemInfo[items.IIndex].W=B,"W"==w?a.ItemInfo[items.IIndex].CrushHoriz=N:"H"==w?a.ItemInfo[items.IIndex].CrushVert=N:"D"==w&&(a.ItemInfo[items.IIndex].CrushD=N))):E+=R:"Y"==F&&(W=O>0?"Y":"N",E+=B=wpdSetFixed(R-R*(O/100)),"Y"==i&&(a.ItemInfo[items.IIndex].W=B,"W"==w?a.ItemInfo[items.IIndex].CrushHoriz=O:"H"==w?a.ItemInfo[items.IIndex].CrushVert=O:"D"==w&&(a.ItemInfo[items.IIndex].CrushD=O)))}else E+=wpdSetFixed(items.W);a.HorizGap>0&&(E+=items.SpreadItem)}if(partShelf.AvlSpace-E>=0){x=N,(N>0||"Y"==W)&&(S="Y",-1!==n&&-1!==D.indexOf(n)&&"Y"==i&&(a.ItemInfo[n].WChanged="Y"));break}}if("N"==S){var P=0;if(x>0)for(const e of D)"N"==v[P]&&(a.ItemInfo[D[P]].W=b[P],a.ItemInfo[D[P]].CrushHoriz=crush_horiz_arr[P]),P++;"Y"!==u&&(g_error_category="W",r="N")}else g_error_category="",r="Y",u="Y"}0}return r}catch(e){error_handling(e)}}function autoPositionShelfVertically(e,o,t,n,i,r,a,l="N"){try{logDebug("function : autoPositionShelfVertically; pPogIndex:"+e+"; pModuleIndex:"+o+"; pShelfIndex:"+t,"S");var s=g_pog_json[e].ModuleInfo[o],d=g_pog_json[e].ModuleInfo[o].ShelfInfo[t],_=-1,g=-1,f=0,p=!0,c=JSON.parse(JSON.stringify(g_pog_json[e].ModuleInfo));c.keySort({X:"asc"});var I=0;for(const e of c){if(void 0===e.ParentModule||null==e.ParentModule){if(0==f&&s.Module==e.Module)return[i,E];s.Module==e.Module&&(_=g),g=I,f++}I++}if(-1==_&&0==nvl(d))return[i,E];var m=c[_].ShelfInfo,h=c[_].W,u=[],S=0;for(b of m){if(!("SHELF"!=b.ObjType&&"HANGINGBAR"!=b.ObjType||"SHELF"!=d.ObjType&&"HANGINGBAR"!=d.ObjType)&&("Y"==l||"N"==l&&100*wpdSetFixed(b.W/h.W)>=100-parseFloat(a))){var D={};D.Distance=Math.abs(wpdSetFixed(d.Y-b.Y)),D.Indx=S,u.push(D)}S++}var b,v=d.Y;if(0!==u.length){var x=u.reduce(((e,o)=>o.Distance<e.Distance?o:e)).Indx;const e=Math.min(...u.map((e=>e.Distance)));var O=u.filter((o=>o.Distance===e)).length;if(p=!(O>1),1==O){var C=m[x].Y+m[x].H/2;b=m[x],v=wpdSetFixed(C-d.H/2)}}var j="N";if(textboxHit(e,o,t,wpdSetFixed(n-d.W/2),wpdSetFixed(n+d.W/2),wpdSetFixed(v+d.H/2),wpdSetFixed(v-d.H/2),"N")&&(v=i,p=!1,j="Y"),d.ItemInfo.length>0&&"N"==j){var M=[],y="N";for(item of d.ItemInfo){var H,w;if(M.push(wpdSetFixed(v+d.H/2+item.H)),"HANGINGBAR"==r?(H=wpdSetFixed(n-d.W/2+item.Distance+item.W/2),w=wpdSetFixed(v-item.H/2)):(H=wpdSetFixed(n-d.W/2+item.Distance+item.W/2),w=wpdSetFixed(v+d.H/2+item.H/2)),textboxHit(e,o,t,wpdSetFixed(H-item.W/2),wpdSetFixed(H+item.W/2),wpdSetFixed(w+item.H/2),wpdSetFixed(w-item.H/2))){v=i,p=!1,y="Y";break}}if("N"==y){var T=Math.max(...M),F=wpdSetFixed(s.Y+s.H/2),N=wpdSetFixed(v+d.H/2);(T>F&&"SHELF"==d.ObjType||N>F&&"HANGINGBAR"==d.ObjType)&&(v=i,p=!1)}}var E=!1,B=-1;if(p&&(void 0!==b.NotchNo||""!==b.NotchNo)&&g_pog_json[e].ModuleInfo[_].NotchStart==s.NotchStart&&g_pog_json[e].ModuleInfo[_].NotchSpacing==s.NotchSpacing){var W=g_scene_objects[e].scene.children[2].getObjectById(d.SObjID),R=g_scene_objects[e].scene.children[2].getObjectById(b.SObjID);void 0!==W&&void 0!==R&&(W.NotchNo=R.NotchNo),B=b.NotchNo,E=!0}return logDebug("function : autoPositionShelfVertically","E"),[v,E,B]}catch(e){error_handling(e)}}function textboxHit(e,o,t,n,i,r,a,l="Y"){try{var s=0;for(const u of g_pog_json[e].ModuleInfo){if(void 0===u.ParentModule||null==u.ParentModule){for(textbox of u.ShelfInfo)if("TEXTBOX"==textbox.ObjType){var d=wpdSetFixed(textbox.X-textbox.W/2),_=wpdSetFixed(textbox.X+textbox.W/2),g=wpdSetFixed(textbox.Y+textbox.H/2),f=wpdSetFixed(textbox.Y-textbox.H/2);if(!(n<d&&i<d||n>_&&i>_||r>g&&a>g||r<f&&a<f))return!0}if(o==s&&"N"==l){var p=0;for(shelf of u.ShelfInfo){if(p!==t&&"BASE"!==shelf.ObjType&&"NOTCH"!==shelf.ObjType&&"DIVIDER"!==shelf.ObjType&&"TEXTBOX"!==shelf.ObjType){var c=wpdSetFixed(shelf.Y+shelf.H/2),I=wpdSetFixed(shelf.Y-shelf.H/2),m=wpdSetFixed(shelf.X-shelf.W/2),h=wpdSetFixed(shelf.X+shelf.W/2);if(!(r>c&&a>c||r<I&&a<I)&&(n==m&&i==h||n<m&&i<m||n>h&&i>h))return!0}p++}}}s++}return!1}catch(e){error_handling(e)}}function isShelfOnPegboard(e,o,t,n,i,r){try{var a=!1,l=wpdSetFixed(e-i.W/2),s=wpdSetFixed(e+i.W/2),d=wpdSetFixed(o+i.H/2),_=wpdSetFixed(o-i.H/2);if(r[n].ModuleInfo)for(const e of r[n].ModuleInfo[t].ShelfInfo)if("PEGBOARD"==e.ObjType){var g=wpdSetFixed(e.X-e.W/2),f=wpdSetFixed(e.X+e.W/2),p=wpdSetFixed(e.Y+e.H/2),c=wpdSetFixed(e.Y-e.H/2);if(p>=d&&_>=c&&l>=g&&f>=s){a=!0;break}}return a}catch(e){error_handling(e)}}function logFinalUndoObjectsInfo(e,o,t,n,i,r,a,l,s,d,_){logDebug("function : logFinalUndoObjectsInfo; actionType : "+e+"; undoType : "+o+"; p_MultiObjects : "+i+"; multiDelShelfInd : "+r+"; multiSelectDrag : "+a+"; g_multiselect : "+l+"; ctrlSelect : "+s+"; clearRedoLog : "+d+"; isCarpark : "+_,"S"),"U"==o?("Y"==d&&(g_redo_final_obj_arr=[]),g_redo_all_obj_arr=[],(g_undo_all_obj_arr=[]).push(t),g_undo_all_obj_arr.push(n),g_undo_all_obj_arr.previousAction=e,g_undo_all_obj_arr.g_MultiObjects=i,g_undo_all_obj_arr.multi_delete_shelf_ind=r,g_undo_all_obj_arr.CurrCanvas=g_curr_canvas,g_undo_all_obj_arr.IsCarpark=_,g_undo_final_obj_arr.push(g_undo_all_obj_arr),"Y"!==g_context_opened&&("Y"!=g_delete_details.is_dragging&&(g_delete_details=[]),g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[]),g_cut_copy_arr=[],cut_copy_arr1=[],g_undo_details=[],g_mselect_drag=a,g_ctrl_select=s,g_undo_all_obj_arr=[],g_temp_cut_arr=[]):(g_redo_all_obj_arr=[],(g_redo_all_obj_arr=[]).push(t),g_redo_all_obj_arr.push(n),g_redo_all_obj_arr.previousAction=e,g_redo_all_obj_arr.g_MultiObjects=i,g_redo_all_obj_arr.CurrCanvas=g_curr_canvas,g_redo_all_obj_arr.IsCarpark=_,g_redo_all_obj_arr.multi_delete_shelf_ind=r,g_redo_final_obj_arr.push(g_redo_all_obj_arr),"Y"!==g_context_opened&&("Y"!=g_delete_details.is_dragging&&(g_delete_details=[]),g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[]),g_cut_copy_arr=[],cut_copy_arr1=[],g_undo_details=[],g_mselect_drag=a,g_ctrl_select=s,g_undo_all_obj_arr=[],g_temp_cut_arr=[]),logDebug("function : logFinalUndoObjectsInfo","E")}function calcCombineShelfAvlSpace(e,o){try{logDebug("function : calcCombineShelfAvlSpace;","S");var t=0,n=0,i=0;for(combineShelf of g_combinedShelfs[o]){t+=(a=g_pog_json[e].ModuleInfo[combineShelf.MIndex].ShelfInfo[combineShelf.SIndex]).W,"Y"==g_lr_overhung&&(0==i&&(t+=nvl(a.LOverhang)),i==g_combinedShelfs[o].length-1&&(t+=nvl(a.ROverhang)));for(const e of a.ItemInfo)void 0!==e.BottomObjID&&""!=e.BottomObjID||(n+=e.W);i++}var r=wpdSetFixed(100*(t-n));r=r<0?0:r;i=0;for(combineShelf of g_combinedShelfs[o]){var a=g_pog_json[e].ModuleInfo[combineShelf.MIndex].ShelfInfo[combineShelf.SIndex],l=g_scene_objects[e].scene.children[2].getObjectById(a.SObjID);if(void 0!==a.availableSpaceObjID&&-1!==a.availableSpaceObjID){var s=l.getObjectById(a.availableSpaceObjID);l.remove(s)}var d=a.Color;if(null==hexToRgb(d))var _=parseInt("FF",16),g=parseInt("FF",16),f=parseInt("FF",16);else _=hexToRgb(d).r,g=hexToRgb(d).r,f=hexToRgb(d).g;var p=getTextColor(_,g,f),c=addlabelText("Space "+(0==i?r:0),g_labelFont,g_labelActualSize,p,"center","");l.add(c),g_scene_objects[e].scene.children[2].getObjectById(a.SObjID).AvlSpace=r,c.position.y=-.005,c.uuid="fixel_space",0!==a.Rotation||0!==a.Slope?c.position.z=a.D/2+.005:c.position.z=.005,c.position.x=a.W/2.4-.08+0,a.availableSpaceObjID=c.id,i++}logDebug("function : calcCombineShelfAvlSpace;","E")}catch(e){error_handling(e)}}function textboxPriorityPlacing(e,o,t,n="N",i="N"){logDebug("function : textboxPriorityPlacing","S");try{const i=wpdSetFixed(e.ShelfInfo.X-e.ShelfInfo.W/2),c=wpdSetFixed(e.ShelfInfo.X+e.ShelfInfo.W/2),I=wpdSetFixed(e.ShelfInfo.Y+e.ShelfInfo.H/2),m=wpdSetFixed(e.ShelfInfo.Y-e.ShelfInfo.H/2);var r,a=[],l=[],s="N";for(const e of g_pog_json[o].ModuleInfo)if(void 0===e.ParentModule||null==e.ParentModule)for(const o of e.ShelfInfo)if("TEXTBOX"==o.ObjType&&void 0!==g_world.getObjectById(o.SObjID)){const e=wpdSetFixed(o.X-o.W/2),t=wpdSetFixed(o.X+o.W/2),n=wpdSetFixed(o.Y+o.H/2),r=wpdSetFixed(o.Y-o.H/2);i<t&&c>e&&I>r&&m<n&&a.push({shelfInfo:o,txtboxZ:o.Z,txtboxWorldZ:g_world.getObjectById(o.SObjID).position.z})}else if("NOTCH"!=o.ObjType){const e=wpdSetFixed(o.X-o.W/2),t=wpdSetFixed(o.X+o.W/2),n=wpdSetFixed(o.Y+o.H/2),r=wpdSetFixed(o.Y-o.H/2);if(i<t&&c>e&&I>r&&m<n)l.push({shelfInfo:o,shelfD:o.D,shelfZ:o.Z}),s="Y";else for(const e of o.ItemInfo){const t=wpdSetFixed(e.X-e.W/2),n=wpdSetFixed(e.X+e.W/2),r=wpdSetFixed(e.Y+e.H/2),a=wpdSetFixed(e.Y-e.H/2);i<n&&c>t&&I>a&&m<r&&0!=nvl(e.ItemID)&&l.push({shelfInfo:o,shelfD:o.D,shelfZ:o.Z})}}if("Y"==s){let o=a.filter((o=>o.shelfInfo.SObjID!==e.id));(o.length>0?Math.max(...o.map((e=>e.txtboxZ))):-1/0)>=(l.length>0?Math.max(...l.map((e=>e.shelfZ+e.shelfD/2))):-1/0)?s="N":a=[]}if("Y"==n&&"Y"==s&&"undefined"!=t&&1==a.length){const o={shelfD:"desc"};l.keySort(o);r=wpdSetFixed(l[0].shelfZ+l[0].shelfD/2)>e.ShelfInfo.Z?.001:.0021,e.position.z=r}else if("Y"!=n)if(a.length>1&&"N"==s){const o={txtboxZ:"desc",txtboxWorldZ:"desc"};if(a.keySort(o),a[0].shelfInfo.Shelf==e.FixelID&&"Y"==g_textbox_dragged){const o=g_world.getObjectById(e.id),t=Math.max(...a.map((e=>e.txtboxWorldZ))),n=e.ShelfInfo.Z,i=a.filter((o=>o.shelfInfo.SObjID!==e.id)).filter((e=>e.txtboxZ<=n)),r=i.length?Math.max(...i.map((e=>e.txtboxZ))):n;return e.ShelfInfo.Z=r+.01,o.Z=100*(r+1),o.position.z=t+1e-4,o.position.z}var d=a[0].txtboxWorldZ,_=(a[0].txtboxWorldZ,0);const n=a[0].txtboxZ;for(const o of a){const i=g_world.getObjectById(o.shelfInfo.SObjID);if(o.shelfInfo.SObjID==e.id&&"Y"!=o.shelfInfo.ManualZupdate){const t=g_world.getObjectById(o.shelfInfo.SObjID),i=o.shelfInfo.Z;let l=!1;for(const o of a)if(o.shelfInfo.SObjID!==e.id&&o.shelfInfo.Z>=i){l=!0;break}if(!l){r=t.position.z;break}t.Z=100*n+1,o.shelfInfo.Z=n+.01,t.position.z=a[0].txtboxWorldZ+1e-4,r=t.position.z;break}if(o.shelfInfo.SObjID==e.id&&"Y"==o.shelfInfo.ManualZupdate){if(i.Z=void 0===t?i.Z:100*t,o.shelfInfo.Z=void 0===t?o.shelfInfo.Z:t,l.length>0){const e={shelfD:"desc"};l.keySort(e);const o=wpdSetFixed(l[0].shelfZ+l[0].shelfD/2);d=o>t?.001+o/1e3-1e-4:.0021}i.position.z=d,r=d;var g=0;for(const e of a)g>_&&(d-=1e-4,g_world.getObjectById(e.shelfInfo.SObjID).position.z>d?g_world.getObjectById(e.shelfInfo.SObjID).position.z=d:d=g_world.getObjectById(e.shelfInfo.SObjID).position.z),g++;break}_++}}else if(void 0!==t){if(l.length>0){const o={shelfD:"desc"};l.keySort(o);r=wpdSetFixed(l[0].shelfZ+l[0].shelfD/2)>e.ShelfInfo.Z?.001:.0021}else r=.001;e.position.z=r,e.Z=100*t,e.ShelfInfo.Z=t}else if(l.length>0&&"N"==s)r=-1;else if("Y"==s){const o={shelfD:"desc"};l.keySort(o);const t=wpdSetFixed(l[0].shelfZ+l[0].shelfD/2);"Y"!=e.ShelfInfo.ManualZupdate?(e.Z=100*t+1,e.ShelfInfo.Z=t+.01,r=.0021):r=t>e.ShelfInfo.Z?.001:.0021,e.position.z=r}else e.Z=1,e.ShelfInfo.Z=.01,e.position.z=.001,r=.001;else if("Y"==n&&"Y"==e.ShelfInfo.ManualZupdate)if(a.length>1&&"N"==s){const o={txtboxZ:"desc"};if(a.keySort(o),a[0].shelfInfo.Shelf==e.FixelID){const e=g_world.getObjectById(a[0].shelfInfo.SObjID);var f=Math.max(...a.map((e=>e.txtboxWorldZ)));return e.position.z=f+1e-4,f+1e-4}_=0;for(const o of a){const t=g_world.getObjectById(o.shelfInfo.SObjID);f=Math.max(...a.map((e=>100*e.txtboxZ)));var p=Math.max(...a.map((e=>e.txtboxWorldZ)));if(o.shelfInfo.SObjID==e.id&&"Y"==o.shelfInfo.ManualZupdate){if(l.length>0){const e={shelfD:"desc"};l.keySort(e);const t=wpdSetFixed(l[0].shelfZ+l[0].shelfD/2);d=t>o.txtboxZ?.001+t/1e3-1e-4:f==o.txtboxZ?p:f>o.txtboxZ?.002:.0021}else d=f==o.txtboxZ?p:f>o.txtboxZ?p-1e-4:.0021;if(g_world.getObjectById(o.shelfInfo.SObjID),t.position.z=d,r=d,l.length>0){g=0;for(const e of a)g>_?(d-=1e-4,g_world.getObjectById(e.shelfInfo.SObjID).position.z>d?g_world.getObjectById(e.shelfInfo.SObjID).position.z=d:d=g_world.getObjectById(e.shelfInfo.SObjID).position.z):g_world.getObjectById(e.shelfInfo.SObjID).position.z<d&&(g_world.getObjectById(e.shelfInfo.SObjID).position.z=.0021),g++}break}_++}}else if("Y"==s){const o={shelfD:"desc"};l.keySort(o);r=wpdSetFixed(l[0].shelfZ+l[0].shelfD/2)>e.ShelfInfo.Z?.001:.0021,e.position.z=r}return r}catch(e){error_handling(e)}}function reorderShelfWithFixedItem(e,o,t,n,i,r){try{var a=[],l="N",s=[],d=[],_=0,g=0;for(const e of r)e.IIndex=g,e.ShelfSplit="E"==n||"F"==n?_:-1,"Y"==e.Fixed?(e.X-e.W/2<o?e.X=wpdSetFixed(o+e.W/2):e.X+e.W/2>t&&(e.X=wpdSetFixed(t-e.W/2)),"E"==n||"F"==n?(s.push(e),0!==g&&(a.push(s),_++,(s=[]).push(e))):d.push(e),l="Y"):(s.push(e),l="N"),g++;"N"!=l||"E"!=n&&"F"!=n||a.push(s);const j=e.ItemInfo.length-1;if(e.ItemInfo.splice(0),"E"==n||"F"==n){var f="N",p=0;for(splitShelfItems of a){var c=0,I=o,m=t;for(item of splitShelfItems)"Y"==item.Fixed&&(0==c&&(I=wpdSetFixed(item.X-item.W/2),firstItemFixed="Y"),c==splitShelfItems.length-1&&(m=wpdSetFixed(item.X+item.W/2))),c++;var h=m-I,u=0;for(item of splitShelfItems)void 0!==item.BottomObjID&&""!==item.BottomObjID||(h=item.BHoriz>1&&"F"==n?wpdSetFixed(h-(item.W+i*(item.BHoriz-1))):wpdSetFixed(h-item.W),"Y"==f&&0==u&&"Y"==item.Fixed||e.ItemInfo.push(item)),u++;var S=h>=0?wpdSetFixed(h/(splitShelfItems.length-1)):0;splitShelfItems.forEach((e=>{e.ShelfSplit==p&&(e.SpreadItem=S)})),f="Y",p++}}else if("L"==n)for(var D=0,b=0,v=0,x=0;x<=d.length;x++){var O=x!==d.length?d[x]:-1;for(item of(D=0==x?wpdSetFixed(O.X-O.W/2-o):x<d.length?wpdSetFixed(O.X-O.W/2-b):wpdSetFixed(t-b),s))-1==item.ShelfSplit&&((D=wpdSetFixed(D-item.W))>0||-1==O)&&(item.ShelfSplit=0,item.IIndex=v,e.ItemInfo.push(item),v++);-1!==O&&(b=wpdSetFixed(O.X+O.W/2),O.IIndex=v,e.ItemInfo.push(O),v++)}else if("R"==n){D=0;var C=0;for(b=0,v=0,x=d.length-1;x>=-1;x--){O=-1!==x?d[x]:-1;D=x==d.length-1?wpdSetFixed(t-(O.X+O.W/2)):wpdSetFixed(-1==x?C-o:C-(O.X+O.W/2));for(g=s.length-1;g>=0;g--)-1==s[g].ShelfSplit&&((D=wpdSetFixed(D-s[g].W))>0||-1==O)&&(s[g].ShelfSplit=0,s[g].IIndex=j-v,e.ItemInfo.splice(0,0,s[g]),v++);-1!==O&&(b=wpdSetFixed(O.X+O.W/2),C=wpdSetFixed(O.X-O.W/2),O.IIndex=j-v,e.ItemInfo.splice(0,0,O),v++)}}e.ItemInfo.keySort({IIndex:"asc"})}catch(e){error_handling(e)}}function filterAutoFillJsontag(e){const o=["ItemID","Item","Desc"];if(!e||"object"!=typeof e)return{};const t=JSON.parse(JSON.stringify(e)),n=e=>{Array.isArray(e)&&e.forEach((e=>{Object.keys(e).forEach((t=>{o.includes(t)||delete e[t]}))}))};return Array.isArray(t.BlkInfo)&&t.BlkInfo.forEach((e=>{if(e.BlockDim&&e.BlockDim.ColorObj){const o=e.BlockDim.ColorObj.object;e.BlockDim.ColorObj={object:o}}Array.isArray(e.BlkModInfo)&&e.BlkModInfo.forEach((e=>{const o=e?.moduleInfo?.ShelfInfo;Array.isArray(o)?o.forEach((e=>n(e.ItemInfo))):o&&"object"==typeof o&&n(o.ItemInfo)})),Array.isArray(e.BlkShelfInfo)&&e.BlkShelfInfo.forEach((e=>{const o=e?.ShelfInfo;Array.isArray(o)?o.forEach((e=>n(e.ItemInfo))):o&&"object"==typeof o&&n(o.ItemInfo)}))})),t}