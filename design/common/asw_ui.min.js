async function load_orientation_json(){return logDebug("function : load_orientation_json"),new Promise((function(e,o){apex.server.process("LOAD_ORIENTATION_JSON",{},{dataType:"text",success:function(o){g_orientation_json=JSON.parse(o),e(g_orientation_json)}})}))}function set_custom_color(e,o){try{logDebug("function : set_custom_color ; ","S"),$.support.cors=!0;const t=$("#"+e);$(".colorValue"),$(".colorDisplay");$(t).sbxColorChoice({selecionarCor:e=>{$("#"+o).val(e),$("#"+o+"_CONTAINER .apex-item-color-picker-preview").css("background-color",e)},reseteCor:"#FFFFFF",event:event,setfocus:o}),logDebug("function : set_custom_color ; ","E")}catch(e){error_handling(e)}}function get_visible_text_dim(e,o){try{logDebug("function : get_visible_text_dim; text : "+e+"; textHeight : "+o,"S");var t=document.getElementById("ruler");return t.style.fontSize=o+"px",t.innerHTML=e,width=t.offsetWidth+10,height=t.offsetHeight+5,logDebug("function : get_visible_text_dim","E"),[width,height]}catch(e){logDebug("function : get_visible_text_dim","E"),error_handling(e)}}function clickInsideElement(e,o){var t=e.srcElement||e.target;if(t.classList.contains(o))return t;for(;t=t.parentNode;)if(t.classList&&t.classList.contains(o))return t;return!1}async function get_images(e,o,t,a,s,i,n){logDebug("function : get_images ; p_module_index : "+e+"; p_shelf_index : "+o,"S");try{var l=0;for(const c of t){var _="N";if("Y"==c.ImgExists){var r=g_orientation_json[c.Orientation].split("###");for(const e of g_ItemImages){if(c.Item==e.Item&&r[0]==e.Orientation&&c.MerchStyle==e.MerchStyle){_="Y";break}0}if("N"==_){ItemImageInfo={},ItemImageInfo.Item=c.Item,ItemImageInfo.MIndex=e,ItemImageInfo.SIndex=o,ItemImageInfo.IIndex=l,ItemImageInfo.Orientation=r[0],ItemImageInfo.ItemImage=null,ItemImageInfo.MerchStyle=c.MerchStyle,g_ItemImages.push(ItemImageInfo);await call_ajax(e,o,a[l],r[0],g_ItemImages.length-1,c.Item,c.MerchStyle,s,i,n)}}l++}return logDebug("function : get_images","E"),"success"}catch(e){error_handling(e)}}function call_ajax(e,o,t,a,s,i,n,l,_,r){try{return logDebug("function : call_ajax ; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+t+"; item_type : "+a+"; img_index : "+s+"; item_code : "+i,"S"),new Promise((function(e,o){var t;"0"==n?t="U":"1"==n?t="T":"2"==n?t="C":"3"==n&&(t="D"),apex.server.process("ITEM_BASE64",{x01:i,x02:a,x03:t},{dataType:"html"}).done((function(o){if(""!==$.trim(o)){var t;!async function(o){var a=new Image;a.src="data:image/jpeg;base64,"+o,a.onload=function(){!async function(o){t=await resizeImage(o,l,_,r),compress_image=t.split(","),g_ItemImages[s].ItemImage=compress_image[1],logDebug("function : call_ajax","E"),e("success")}(a)}}($.trim(o))}else 0==s?g_ItemImages.splice(s,s+1):g_ItemImages.splice(s,1),logDebug("function : call_ajax","E"),e("success")}))}))}catch(e){error_handling(e)}}async function resizeImage(e,o,t,a){try{logDebug("function : resizeImage ; MaxWidth : "+o+"; MaxHeight : "+t,"S");var s=document.createElement("canvas"),i=e.width,n=e.height,l=o,_=t;return i>n?i>l&&(n=Math.round(n*=l/i),i=l):n>_&&(i=Math.round(i*=_/n),n=_),s.width=i,s.height=n,s.getContext("2d").drawImage(e,0,0,i,n),logDebug("function : resizeImage","E"),s.toDataURL("image/jpeg",a)}catch(e){error_handling(e)}}function base64toBlob(e,o){logDebug("function : base64toBlob ; contentType : "+o,"E"),o=o||"";for(var t=1024,a=atob(e),s=a.length,i=Math.ceil(s/t),n=new Array(i),l=0;l<i;++l){for(var _=l*t,r=Math.min(_+t,s),c=new Array(r-_),g=_,m=0;g<r;++m,++g)c[m]=a[g].charCodeAt(0);n[l]=new Uint8Array(c)}return logDebug("function : base64toBlob","E"),new Blob(n,{type:o})}function send_to_db(e,o){return logDebug("function : send_to_db; pog_code : "+e,"S"),new Promise((function(t,a){apex.server.process("SAVE_MODULE_IMG",{x01:e,p_clob_01:JSON.stringify(o)},{dataType:"html"}).done((function(e){logDebug("function : send_to_db","E"),t("success")}))}))}async function create_item_compare(e,o){var t=g_pog_json[g_pog_index].DraftVersion;$s("P25_DRAFT_VERSION",t);var a=null==t||""===t?"N":"Y";apex.server.process("CREATE_COMPARE_ITEM_COLL",{x01:e,x02:o,x03:g_pdf_online_clck,x04:a},{dataType:"html"})}function validate_file_type(e){try{logDebug("function : validate_file_type","S");return/(\.pdf|\.xlsx|\.zip)$/i.exec(e)?(logDebug("function : validate_file_type","E"),!0):(alert(get_message("INVALID_FILE_TYPE",e)),!1)}catch(e){error_handling(e)}}function get_json_data_json(e,o,t,a){try{return new Promise((function(s,i){apex.server.process("GET_JSON_FROM_COLL",{x01:e,x02:o,x03:t,x04:a},{dataType:"html"}).done((function(e){-1==$.trim(e).indexOf("ERROR")?(g_pog_json_data=JSON.parse($.trim(e)),console.log("json",g_pog_json_data),s("SUCESS")):s($.trim(e))}))}))}catch(e){console.log("error 3",return_val)}}async function refresh_sales_data(e,o,t,a,s,i,n,l="Y",_,r,c="N",g=g_pog_index,m="N"){return logDebug("function : send_to_db; refresh_sales_data : ","S"),new Promise((function(c,d){console.log("refresh sales ",e,o,t,a,s,i,n,l,"ACTUAL POG",_,"SELECTED POG",r,"N",g=g_pog_index),"Y"==n&&addLoadingIndicator(),apex.server.process("SALES_REFRESH",{x01:_,x02:o,x03:e,x04:r},{dataType:"text"}).done((function(_){if(""!==$.trim(_))if(console.log("refresh_sales_data",_),"Y"==$v("P25_POGCR_SALES_INFO_REFRESH_DTL")?g_pog_json[g].SalesRrshDtl="Date: "+getDateTime():g_pog_json[g].SalesRrshDtl="Date: "+getDateTime()+" | Sales Week: "+e+" | Store: "+o,_.indexOf("Error:")>=0&&"N"==m)"Y"==n&&removeLoadingIndicator(regionloadWait),raise_error(_.substr(6));else if(_.indexOf("Warn:")>=0&&"N"==m)"Y"==n&&removeLoadingIndicator(regionloadWait),alert(_.substr(5)),c("Warning"+_.substr(5));else{try{var r=JSON.parse(_);delete g_pog_json[g].SalesInfo,g_pog_json[g].SalesInfo=r}catch{"Y"==n&&removeLoadingIndicator(regionloadWait),"Y"==l?raise_error(_):c("success")}!async function(){"Y"==s&&await showHideDaysOfSupplyLabel(g_show_days_of_supply,"N",g,"Y","Y",t,a),"Y"==n&&removeLoadingIndicator(regionloadWait)}(),"Y"==i&&(apex.message.showPageSuccess(get_message("POGCR_SALES_REFRESH")),closeInlineDialog("open_refresh_sales")),c("success")}}))}))}function save_pog_to_json(e){return logDebug("function : save_pog_to_json","S"),new Promise((function(o,t){apex.server.process("ADD_JSON_TO_COLL",{x01:"I",p_clob_01:JSON.stringify(e)},{dataType:"text",success:function(e){""!=$.trim(e)?raise_error(e):(logDebug("function : save_pog_to_json","E"),o("SUCESS"))},loadingIndicatorPosition:"page"})}))}function delete_items_coll(){return logDebug("function : delete_items_coll","S"),new Promise((function(e,o){apex.server.process("DELETE_ITEM_COLL",{x01:"I"},{dataType:"text",success:function(o){""!=$.trim(o)?raise_error(o):(logDebug("function : delete_items_coll","E"),e("SUCESS"))}})}))}function reset_zoom(){logDebug("function : reset_zoom","S");try{if("undefined"!=typeof g_pog_json&&g_pog_json.length>0){if($(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),$("#maincanvas").css("cursor","auto"),$("#maincanvas1").css("cursor","auto"),g_manual_zoom_ind="N",g_area_zoom_ind="N",g_select_zoom_arr=[],"Y"==g_all_pog_flag)var e=0;else e=g_pog_index;for(const t of g_pog_json){if("N"==g_compare_pog_flag||"Y"==g_compare_pog_flag&&"CUTAWAY"!==g_compare_view){var o=get_min_max_xy(e).split("###");console.log("details_arr",o,e),set_camera_z(g_scene_objects[e].scene.children[0],parseFloat(o[2]),parseFloat(o[3]),parseFloat(o[0]),parseFloat(o[1]),g_offset_z,parseFloat(o[4]),parseFloat(o[5]),!0,e)}if(render(e),"Y"!=g_all_pog_flag)break;e++}g_intersected=[],g_mselect_drag="N",g_multiselect="N"}logDebug("function : reset_zoom","E")}catch(e){error_handling(e)}}function reset_indicators(){"Y"==g_show_fixel_label?$(".fixel_label").addClass("fixel_label_active"):$(".fixel_label").removeClass("fixel_label_active"),"Y"==g_show_item_color?$(".item_color").addClass("item_label_active"):$(".item_color").removeClass("item_label_active"),"Y"==g_show_item_label?$(".item_label").addClass("item_label_active"):$(".item_label").removeClass("item_label_active"),"N"==g_itemSubLabelInd?($(".item_sublabel").removeClass("item_sublabel_active"),$("#item_sublbl_sub .items").removeClass("item_sublabel_active")):($(".item_sublabel").addClass("item_sublabel_active"),$("#item_sublbl_sub ."+g_itemSubLabel).addClass("item_sublabel_active")),"Y"==g_show_fixel_space?$(".fixel_space").addClass("item_label_active"):$(".fixel_space").removeClass("item_label_active"),"Y"==g_show_item_desc&&"N"==g_show_live_image?$(".item_desc").addClass("item_label_active"):$(".item_desc").removeClass("item_label_active"),"Y"==g_show_notch_label?$(".notch_label").addClass("notch_label_active"):$(".notch_label").removeClass("notch_label_active"),"Y"==g_show_live_image?$(".live_image").addClass("live_image_active"):$(".live_image").removeClass("live_image_active"),"Y"==g_show_max_merch?$(".fixel_merch").addClass("max_merch_active"):$(".fixel_merch").removeClass("max_merch_active"),"Y"==g_max_facing_enabled?$(".max_facing").addClass("enable_maximize_facings"):$(".max_facing").removeClass("enable_maximize_facings"),"Y"==g_show_days_of_supply?$(".supply_days").addClass("item_label_active"):$(".supply_days").removeClass("item_label_active"),"Y"==g_show_item_color?$(".item_color_legends").css("display","block"):$(".item_color_legends").css("display","none"),"Y"==g_overhung_shelf_active?$(".overhung_shelf").addClass("overhung_shelf_active"):$(".overhung_shelf").removeClass("overhung_shelf_active"),logDebug("function : reset_indicators","E")}window.addEventListener("click",(function(e){void 0!==$(e.path)&&(logo_clicked="N"),void 0!==$(e.target).attr("id")&&"t-Icon fa fa-eyedropper"!==$(e.target).attr("class")?$(e.target).attr("id").startsWith("CUSTOM_COLOR")||$("#co-color-list").slideUp("fast",(function(){$("#co-color-list").css("display","none"),g_openChooseColor=!1})):"t-Icon fa fa-eyedropper"==$(e.target).attr("class")?($("#co-color-list").css("display","block"),g_openChooseColor=!0):$("#co-color-list").slideUp("fast",(function(){$("#co-color-list").css("display","none"),g_openChooseColor=!1}))})),$.fn.sbxColorChoice=function(e){try{const{reseteCor:o,removePallet:t,event:a,setfocus:s,textResetColorButton:i,selecionarCor:n}=e,l=$("#co-color-list"),_=e=>{e.slideUp("fast",(function(){e.css("display","none"),g_openChooseColor=!1,apex.item(s).setFocus()}))},r=(e,o)=>{e.find("ul li").click((function(){const t=$(this).attr("data-color");_(e),n(t,o)}))},c=()=>{""!=t&&null!=t&&$("#co-color-list").find(t).remove()},g=e=>{i&&e.find(".reset-color-button").html(i)},m=e=>{e.slideDown("fast",(function(){e.focus()}))};((e,t)=>{const a=$(t.target),s=a.offset(),i=a.height();a.width(),$(window).height(),$(window).width(),$("#co-color-list").height(),$("#co-color-list").width();let n,l;n=s.top-i;l=s.left-$("#co-color-list").width()/2;e.find("ul.color-reset li").attr("data-color",o),e.css({top:n,left:l}).addClass(["co-color-list--bellow","co-color-list--left"])})(l,a),m(l),r(l,a),c(),g(l),g_openChooseColor=!0}catch(e){error_handling(e)}};