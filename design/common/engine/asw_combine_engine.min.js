function getCombinationShelf(e,o){try{logDebug("function : getCombinationShelf; p_pog_index : "+e+"; pShelfName : "+o,"S");var n=-1,d=-1;if("undefined"!=typeof g_combinedShelfs&&g_combinedShelfs.length>0&&g_combinedShelfs.length>0){var t=0;for(combination of g_combinedShelfs){var i=0;for(shelf_info of combination){if(shelf_info.Shelf==o&&shelf_info.PIndex==e){n=t,d=i;break}i++}if(-1!==n&&-1!==d)break;t++}}return[n,d]}catch(e){logDebug("function : getCombinationShelf","E"),error_handling(e)}}async function generateCombinedShelfs(e,o,n,d,t,i,f,l,I,r,m="Y",s="",S,h="N",b="N"){try{logDebug("function : generateCombinedShelfs; p_pog_index : "+e,"S");var a=[],g=g_pog_json[e].ModuleInfo[o].ShelfInfo[n],x=wpdSetFixed(g.X-g.W/2),p=wpdSetFixed(g.X+g.W/2),_=g_pog_json[e].ModuleInfo,c=[],u=[],C=[],j={MIndex:"asc",X:"asc"};if("N"!==g.Combine&&("SHELF"==g.ObjType||"HANGINGBAR"==g.ObjType)){var M=0,O=!1;for(const o of _){if(null==o.ParentModule||"undefined"==o.ParentModule){var v=0;for(const n of o.ShelfInfo){let d="D"==h||wpdSetFixed(g.D)==wpdSetFixed(n.D);if(void 0!==n&&"N"!==n.Combine&&n.ObjType==g.ObjType&&wpdSetFixed(g.Y)==wpdSetFixed(n.Y)&&wpdSetFixed(g.H)==wpdSetFixed(n.H)&&g.Rotation==n.Rotation&&g.Slope==n.Slope&&d){var w,D=-1,F=-1;a.length>0?(w=a[a.length-1],D=wpdSetFixed(a[a.length-1].X-a[a.length-1].W/2),F=wpdSetFixed(a[a.length-1].X+a[a.length-1].W/2)):(w=g,D=x,F=p);var W=wpdSetFixed(n.X-n.W/2),X=wpdSetFixed(n.X+n.W/2);if(("R"!=n.Combine||"B"!=w.Combine&&"L"!=w.Combine||X!=D)&&("L"!=n.Combine||"B"!=w.Combine&&"R"!=w.Combine||W!=F)?("B"==n.Combine&&("R"==w.Combine&&W==F||"L"==w.Combine&&X==D||"B"==w.Combine&&(W==F||X==D))||"B"==n.Combine&&"B"==w.Combine&&"Y"==b&&n.PIndex==w.PIndex)&&(O=!0):O=!0,O)(fe={}).PIndex=e,fe.MIndex=M,fe.SIndex=v,fe.Shelf=n.Shelf,fe.ObjType=n.ObjType,fe.Combine=n.Combine,fe.SpreadItem=n.SpreadItem,fe.AllowAutoCrush=n.AllowAutoCrush,fe.SObjID=n.SObjID,fe.MObjID=o.MObjID,fe.Module=o.Module,fe.X=n.X,fe.Y=n.Y,fe.W=n.W,fe.H=n.H,fe.Slope=n.Slope,fe.Rotation=n.Rotation,a.push(fe),O=!1}v++}}M++}}var A=-1,N=!1;if(0==a.length){var[y,P]=getCombinationShelf(e,g.Shelf);if(-1!==y&&-1!==P){A=y,u=g_combinedShelfs[y],c=JSON.parse(JSON.stringify(u));var H=g_combinedShelfs[y][P];g_pog_json[H.PIndex].ModuleInfo[H.MIndex].ShelfInfo[H.SIndex];if(u.splice(P,1),u.keySort(j),u.length<2)N=!0;else if(u.length>2){g_combinedShelfs.splice(y,1);var R=0;for(obj of u){var T=u[R];if(void 0===(oe=u[R+1]))break;var B=wpdSetFixed(T.X+T.W/2),Y=wpdSetFixed(oe.X-oe.W/2),E=g_pog_json[T.PIndex].ModuleInfo[T.MIndex].ShelfInfo[T.SIndex],z=g_pog_json[oe.PIndex].ModuleInfo[oe.MIndex].ShelfInfo[oe.SIndex];void 0===u[R].CanCombine&&(u[R].CanCombine=!1,u[R+1].CanCombine=!1),B!=Y||("R"!=E.Combine||"B"!=z.Combine&&"L"!=z.Combine)&&("B"!=E.Combine||"L"!=z.Combine&&"B"!=z.Combine)?(u[R].CanCombine=!!u[R].CanCombine&&u[R].CanCombine,u[R].SubCombIndex=u[R].CanCombine?u[R].SubCombIndex:-1,u[R+1].CanCombine=!1,u[R+1].SubCombIndex=-1):void 0!==u[R].CanCombine&&u[R].CanCombine?(u[R+1].CanCombine=!0,u[R+1].SubCombIndex=u[R].SubCombIndex):(u[R].CanCombine=!0,u[R].SubCombIndex=R,u[R+1].CanCombine=!0,u[R+1].SubCombIndex=R),R++}u.keySort({SubCombIndex:"desc"});var L=0,k=-1,J=[],V=[];for(comb of u)k!==u[L].SubCombIndex&&0!==J.length&&(V.push(J),J=[]),u[L].CanCombine&&-1!==u[L].SubCombIndex&&J.push(comb),k=u[L].SubCombIndex,L++;for(currArr of(0!==J.length&&V.push(J),V)){currArr.keySort(j),currArr.SpreadItem=currArr[0].SpreadItem,currArr.AllowAutoCrush=currArr[0].AllowAutoCrush;var G=[],Z=[];for(be of currArr){var q=g_pog_json[be.PIndex].ModuleInfo[be.MIndex].ShelfInfo[be.SIndex];W=wpdSetFixed(q.X-q.W/2),X=wpdSetFixed(q.X+q.W/2);for(item of(G.push(W),Z.push(X),q.ItemInfo))item.Fixed="N"}var K=Math.min(...G),Q=Math.max(...Z);currArr.Start=K,currArr.End=Q;var U=g_combinedShelfs.length;for(be of(g_combinedShelfs.push(currArr),await setCombinedShelfItems(e,U,-1,-1,"N","N",-1,-1,[]),currArr)){var ee=g_pog_json[be.PIndex].ModuleInfo[be.MIndex].ShelfInfo[be.SIndex];if(reorder_items(ee.MIndex,ee.SIndex,e))await recreate_all_items(ee.MIndex,ee.SIndex,ee.ObjType,"Y",-1,-1,ee.ItemInfo.length,"N","N",-1,-1,g_start_canvas,s,e,d,t,i,f,l,I,r,m)}}}else{T=u[0];var oe=u[1],ne=(B=wpdSetFixed(T.X+T.W/2),Y=wpdSetFixed(oe.X-oe.W/2),T.Combine),de=oe.Combine;(B!=Y||("R"!=ne||"B"!=de&&"L"!=de)&&("B"!=ne||"L"!=de&&"B"!=de))&&(N=!0)}if(N){for(shelfs of g_combinedShelfs[y]){ee=g_pog_json[shelfs.PIndex].ModuleInfo[shelfs.MIndex].ShelfInfo[shelfs.SIndex];if(reorder_items(ee.MIndex,ee.SIndex,e)){ee.Combine="N";await recreate_all_items(ee.MIndex,ee.SIndex,ee.ObjType,"Y",-1,-1,ee.ItemInfo.length,"N","N",-1,-1,g_start_canvas,s,e,d,t,i,f,l,I,r,m)}}g_combinedShelfs.splice(y,1)}}}var[y,P]=getCombinationShelf(e,g.Shelf);if(a.length>0&&-1==y&&-1==P){var te=[],ie=-1,fe={};for(be of(fe.PIndex=e,fe.MIndex=o,fe.SIndex=n,fe.Shelf=g.Shelf,fe.ObjType=g.ObjType,fe.Combine=g.Combine,fe.SpreadItem=g.SpreadItem,fe.AllowAutoCrush=g.AllowAutoCrush,fe.SObjID=g.SObjID,fe.MObjID=g_pog_json[e].ModuleInfo[o].MObjID,fe.Module=g_pog_json[e].ModuleInfo[o].Module,fe.X=g.X,fe.Y=g.Y,fe.W=g.W,fe.H=g.H,fe.Slope=g.Slope,fe.Rotation=g.Rotation,a)){var[le,Ie]=getCombinationShelf(e,be.Shelf);-1!==le&&-1!==Ie&&te.push(le)}if(te.length>0){var re=te[0];if(g_combinedShelfs[re].push(fe),te.length>1)for(combIndx of te)if(combIndx!==re)for(actShelf of g_combinedShelfs[combIndx])g_combinedShelfs[re].push(actShelf),g_combinedShelfs.splice(actShelf,1);g_combinedShelfs[re].keySort(j),g_combinedShelfs[re].SpreadItem=g_combinedShelfs[re][0].SpreadItem,g_combinedShelfs[re].AllowAutoCrush=g_combinedShelfs[re][0].AllowAutoCrush,ie=re}else a.push(fe),a=a.filter(((e,o,n)=>n.findIndex((o=>JSON.stringify(o)===JSON.stringify(e)))===o)),a.keySort(j),a.SpreadItem=a[0].SpreadItem,a.AllowAutoCrush=a[0].AllowAutoCrush,g_combinedShelfs.push(a),ie=g_combinedShelfs.length-1;G=[],Z=[];for(be of g_combinedShelfs[ie]){if(void 0!==(q=g_pog_json&&g_pog_json[be.PIndex]&&g_pog_json[be.PIndex].ModuleInfo&&g_pog_json[be.PIndex].ModuleInfo[be.MIndex]&&g_pog_json[be.PIndex].ModuleInfo[be.MIndex].ShelfInfo?g_pog_json[be.PIndex].ModuleInfo[be.MIndex].ShelfInfo[be.SIndex]:void 0)){W=wpdSetFixed(q.X-q.W/2),X=wpdSetFixed(q.X+q.W/2);if(G.push(W),Z.push(X),Array.isArray(q.ItemInfo))for(item of q.ItemInfo)item.Fixed="N"}else logDebug("Warning: missing shelfDtl in generateCombinedShelfs (newCombinationIndex loop) for shelf: "+JSON.stringify(be),"W")}K=Math.min(...G),Q=Math.max(...Z);g_combinedShelfs[ie].Start=K,g_combinedShelfs[ie].End=Q,await setCombinedShelfItems(e,ie,-1,-1,"N","N",-1,-1,[])}if(g_combinedShelfs.length>0&&void 0!==ie&&-1!==ie)C=JSON.parse(JSON.stringify(g_combinedShelfs[ie]));else if(u.length>0){C=JSON.parse(JSON.stringify(u));ie=A;N||(g_combinedShelfs[A].Start=wpdSetFixed(g_combinedShelfs[A][0].X-g_combinedShelfs[A][0].W/2),g_combinedShelfs[A].End=wpdSetFixed(g_combinedShelfs[A][g_combinedShelfs[A].length-1].X+g_combinedShelfs[A][g_combinedShelfs[A].length-1].W/2))}if(c.length>0&&C.length>0){if(N||await setCombinedShelfItems(e,ie,-1,-1,"N","N",-1,-1,[]),C.length>1)for(var me=0;me<c.length;me++){T=c[me],M=0;var se=!0;for(be of C)be.SObjID==T.SObjID&&(se=!1),M++;if(se)if([Se,he]=get_shelf_index(T.SObjID,T.PIndex),-1!==Se)if((be=g_pog_json[T.PIndex].ModuleInfo[Se].ShelfInfo[he]).ItemInfo.length>0&&(be.Combine="N",reorder_items(Se,he,T.PIndex)))await recreate_all_items(Se,he,T.ObjType,"Y",-1,-1,be.ItemInfo.length,"N","N",-1,-1,g_start_canvas,s,T.PIndex,d,t,i,f,l,I,r,m)}else if([Se,he]=get_shelf_index(C[0].SObjID,C[0].PIndex),-1!==Se)if((be=g_pog_json[C[0].PIndex].ModuleInfo[Se].ShelfInfo[he]).ItemInfo.length>0&&reorder_items(Se,he,C[0].PIndex)){be.Combine="N";await recreate_all_items(Se,he,C[0].ObjType,"Y",-1,-1,be.ItemInfo.length,"N","N",-1,-1,g_start_canvas,s,C[0].PIndex,d,t,i,f,l,I,r,m)}}else{var[y,P]=getCombinationShelf(e,g.Shelf);if(-1!==y&&-1!==P){_=g_pog_json[g_combinedShelfs[y][0].PIndex].ModuleInfo;var Se=-1,he=-1;if($.each(_,(function(e,o){if(he>-1)return!1;null!=o.ParentModule&&"undefined"!=o.ParentModule||$.each(o.ShelfInfo,(function(o,n){return!(he>-1)&&(void 0!==n&&"BASE"!==n.ObjType&&"NOTCH"!==n.ObjType&&"DIVIDER"!==n.ObjType&&n.SObjID==g_combinedShelfs[y][0].SObjID?(Se=e,he=o,!1):void 0)}))})),-1!==Se&&-1!==he){var be=g_pog_json[g_combinedShelfs[y][0].PIndex].ModuleInfo[Se].ShelfInfo[he];g_combinedShelfs[y].SpreadItem=be.SpreadItem,g_combinedShelfs[y].AllowAutoCrush=be.AllowAutoCrush,g_combinedShelfs[y][P].SpreadItem=be.SpreadItem,g_combinedShelfs[y][P].AllowAutoCrush=be.AllowAutoCrush}}if(reorder_items(o,n,e))await recreate_all_items(o,n,g.ObjType,"Y",-1,-1,g.ItemInfo.length,"N","N",-1,-1,g_start_canvas,s,e,d,t,i,f,l,I,r,m)}"N"!=S&&(g_pog_json[e].GenrateCombineS=get_combine_arr())}catch(e){logDebug("function : generateCombinedShelfs","E"),error_handling(e)}}function updateCombinedItemInfo(e,o,n,d,t){try{logDebug("function : updateCombinedItemInfo; p_pog_index : "+e+"; pModuleIndex : "+o+"; pShelfIndex : "+n+"; pItemX : "+d+"; pCombIndx : "+t,"S");var i,f,l,I,r,m=g_combinedShelfs[t];for(shelf_info of m)if(i=shelf_info.MIndex,f=shelf_info.SIndex,I=(l=g_pog_json[e].ModuleInfo[i].ShelfInfo[f]).X-l.W/2,r=l.X+l.W/2,d>I&&d<=r)return[i,f];return[o,n]}catch(e){logDebug("function : updateCombinedItemInfo","E"),error_handling(e)}}async function setCombinedShelfItems(e,o,n,d,t,i,f,l,I,r="N"){try{logDebug("function : setCombinedShelfItems; p_pog_index : "+e+"; pCombinationIndex : "+o+"; pCurrShelfCombIndx : "+n+"; pLocationX : "+d,"S");const A=g_combinedShelfs[o].SpreadItem;var m=JSON.parse(JSON.stringify(g_combinedShelfs[o]));m.SpreadItem=A;var s,S,h,b,a,g,x=[],p={NewMIndex:"asc",NewSIndex:"asc",OldMIndex:"asc",OldSIndex:"asc",OldIIndex:"asc",X:"asc"};for(obj of g_combineItemModf)obj.TransferItem="N";"R"==A&&(m=m.reverse()),await set_shelf_item_index(e);var _=0;for(combination of g_combinedShelfs){var c=[];for(shelf_info of combination)if(e==shelf_info.PIndex){x=g_pog_json[shelf_info.PIndex].ModuleInfo[shelf_info.MIndex].ShelfInfo[shelf_info.SIndex].ItemInfo;c=c.concat(x)}p={MIndex:"asc",SIndex:"asc",X:"asc"};"N"==r&&c.keySort(p),c.length>0&&(g_combinedShelfs[_].ItemInfo=c),_++}for(shelf_info of m){s=shelf_info.MIndex,S=shelf_info.SIndex,g=(h=g_pog_json[e].ModuleInfo[s].ShelfInfo[S]).HorizGap;var u=(x=g_pog_json[shelf_info.PIndex].ModuleInfo[shelf_info.MIndex].ShelfInfo[shelf_info.SIndex].ItemInfo).length,C=-1;if("R"==A)for(_=x.length-1;_>=0;_--){if(u-=1,C=get_item_xaxis(x[_].W,x[_].H,x[_].D,h.ObjType,d,g,A,g,s,S,u,t,g_pog_json[e].ModuleInfo[s].ShelfInfo[S].ItemInfo.length,i,e),[b,a]=updateCombinedItemInfo(e,s,S,C,o),x[_].OldX=x[_].X,x[_].X=C,b!=s||a!=S)(j={}).NewMIndex=b,j.NewSIndex=a,j.OldMIndex=s,j.OldSIndex=S,j.OldIIndex=_,j.OldObjID=x[_].ObjID,j.TransferItem="Y",g_combineItemModf.push(j)}else{_=0;for(const n of x){var j;if(C=-1!==f&&_==l?f:get_item_xaxis(n.W,n.H,n.D,h.ObjType,d,g,A,g,s,S,_,t,g_pog_json[e].ModuleInfo[s].ShelfInfo[S].ItemInfo.length,i,e),n.OldX=n.X,n.X=C,[b,a]=updateCombinedItemInfo(e,s,S,C,o),b!=s||a!=S)(j={}).NewMIndex=b,j.NewSIndex=a,j.OldMIndex=s,j.OldSIndex=S,j.OldIIndex=_,j.OldObjID=h.ItemInfo[_].ObjID,j.TransferItem="Y",g_combineItemModf.push(j);_++}}}for(modf of(g_combineItemModf.keySort(p),g_combineItemModf))if("Y"==modf.TransferItem){var M=[],O=[],v=[];for(obj of g_pog_json[e].ModuleInfo[modf.OldMIndex].ShelfInfo[modf.OldSIndex].ItemInfo)if(modf.OldObjID==obj.ObjID){v=obj;break}if(void 0!==v){_=0;for(const o of g_pog_json[e].ModuleInfo[modf.NewMIndex].ShelfInfo[modf.NewSIndex].ItemInfo)"R"!==A?o.X<v.X&&(M.push(v.X-o.X),O.push(_)):o.X>v.X&&(M.push(o.X-v.X),O.push(_)),_++;var w=Math.min.apply(Math,M),D=M.findIndex((function(e){return e==w}));if(M.length>0){var F="R"!==A?O[D]+1:O[D]-1;"R"==A&&-1==F&&(F=0)}else F=0;v.MIndex=modf.NewMIndex,v.SIndex=modf.NewSIndex,v.IIndex=F,null!=I&&I.length>0&&I[0].MIndex==modf.OldMIndex&&I[0].SIndex==modf.OldSIndex&&I[0].IIndex==modf.OldIIndex&&I[0].Iobjid==modf.OldObjID&&(I[0].MIndex=modf.NewMIndex,I[0].SIndex=modf.NewSIndex,I[0].IIndex=F),g_pog_json[e].ModuleInfo[modf.NewMIndex].ShelfInfo[modf.NewSIndex].ItemInfo.splice(F,0,v)}}for(modf of g_combineItemModf){var W=modf.OldObjID;if(void 0!==(v=g_pog_json[e].ModuleInfo[modf.OldMIndex].ShelfInfo[modf.OldSIndex].ItemInfo)&&"Y"==modf.TransferItem)for(_=0;_<v.length;_++)W==v[_].ObjID&&v.splice(_,1)}await set_shelf_item_index(e);_=0;for(combination of g_combinedShelfs){c=[];for(shelf_info of combination)if(e==shelf_info.PIndex){x=g_pog_json[shelf_info.PIndex].ModuleInfo[shelf_info.MIndex].ShelfInfo[shelf_info.SIndex].ItemInfo;c=c.concat(x);var X=0;for(const e of x)null!=I&&I.length>0&&I[0].MIndex==e.MIndex&&I[0].SIndex==e.SIndex&&I[0].Iobjid==e.ObjID&&(I[0].MIndex=e.MIndex,I[0].SIndex=e.SIndex,I[0].IIndex=X),X++}p={MIndex:"asc",SIndex:"asc",X:"asc"};"N"==r&&c.keySort(p),c.length>0&&(g_combinedShelfs[_].ItemInfo=c),_++}render()}catch(e){logDebug("function : setCombinedShelfItems","E"),error_handling(e)}}function getLastItemCombinedShelf(e,o,n){try{logDebug("function : getLastItemCombinedShelf","S");var d=0,t=-1;for(const o of e.ItemInfo){if(o.ObjID==n){t=d;break}d++}var i={};return"R"==o?void 0!==e.ItemInfo[t+1]&&(i.IIndex=t+1,i.X=e.ItemInfo[t+1].X,i.W=e.ItemInfo[t+1].W,i.CurrIndex=t):void 0!==e.ItemInfo[t-1]&&(i.IIndex=t-1,i.X=e.ItemInfo[t-1].X,i.W=e.ItemInfo[t-1].W,i.CurrIndex=t),i}catch(e){logDebug("function : getLastItemCombinedShelf","E"),error_handling(e)}}function create_g_combine_shelfs(e,o){if(e[o].GenrateCombineS.length>0){for(main_obj of(e[o].GenrateCombineS.keySort({SComIndex:"asc",ShelfCombIndx:"asc"}),e[o].GenrateCombineS)){var n,d,t=[],i=[],f=[],l=[];for(obj of main_obj){if("SHELF"==obj.ObjType||"HANGINGBAR"==obj.ObjType){var I={};I.AllowAutoCrush=obj.AllowAutoCrush,I.Combine=obj.Combine,I.H=wpdSetFixed(obj.H),I.MIndex=obj.MIndex,I.Module=obj.Module,I.ObjType=obj.ObjType,I.PIndex=o,I.Rotation=obj.Rotation,I.SIndex=obj.SIndex,I.Shelf=obj.Shelf,I.Slope=obj.Slope,I.SpreadItem=obj.SpreadItem,I.W=wpdSetFixed(obj.SW),I.X=wpdSetFixed(obj.X),I.Y=wpdSetFixed(obj.Y),t.push(I),n=obj.CombAllowCrush,f.push(wpdSetFixed(obj.X-obj.SW/2)),l.push(wpdSetFixed(obj.X+obj.SW/2)),d=obj.CombSpreadItem}if("ITEM"==obj.OBJECT){var r={};r.W=wpdSetFixed(obj.W),r.Item=obj.Item,r.MIndex=obj.MIndex,r.SIndex=obj.SIndex,r.IIndex=obj.IIndex,r.Orientation=obj.Orientation,r.CrushHoriz=obj.CrushHoriz,r.CrushVert=obj.CrushVert,r.CrushD=obj.CrushD,r.MHorizCrushed=obj.MHorizCrushed,r.MVertCrushed=obj.MVertCrushed,r.MDepthCrushed=obj.MDepthCrushed,r.CWPerc=obj.CWPerc,r.CHPerc=obj.CHPerc,r.CDPerc=obj.CDPerc,r.H=wpdSetFixed(obj.H),r.D=wpdSetFixed(obj.D),r.X=wpdSetFixed(obj.X),r.Y=wpdSetFixed(obj.Y),r.Z=wpdSetFixed(obj.Z),r.RW=obj.RW,r.RH=obj.RH,r.RD=obj.RD,r.BHoriz=obj.BHoriz,r.BVert=obj.BVert,r.BaseD=obj.BaseD,r.Fixed=obj.Fixed,r.SpreadItem=obj.SpreadItem,i.push(r)}}t.AllowAutoCrush=n,t.Start=Math.min.apply(Math,f),t.End=Math.max.apply(Math,l),t.SpreadItem=d,t.ItemInfo=i,g_combinedShelfs.push(t)}}}function get_combine_arr(){var e=[],o=[],n={},d=0;for(combination of g_combinedShelfs){var t={};e=[];var i=0;for(shelf_info of combination)(n={}).SW=shelf_info.W,n.Shelf=shelf_info.Shelf,n.H=shelf_info.H,n.OBJECT="SHELF",n.SComIndex=d,n.ShelfCombIndx=i,n.AllowAutoCrush=shelf_info.AllowAutoCrush,n.Combine=shelf_info.Combine,n.Module=shelf_info.Module,n.ObjType=shelf_info.ObjType,n.PIndex=shelf_info.PIndex,n.MIndex=shelf_info.MIndex,n.SIndex=shelf_info.SIndex,n.Rotation=shelf_info.Rotation,n.Slope=shelf_info.Slope,n.SpreadItem=shelf_info.SpreadItem,n.W=shelf_info.W,n.X=shelf_info.X,n.Y=shelf_info.Y,n.CombSpreadItem=g_combinedShelfs[0].SpreadItem,n.CombAllowCrush=g_combinedShelfs[0].AllowAutoCrush,n.CombStart=g_combinedShelfs[0].Start,n.CombEnd=g_combinedShelfs[0].End,e.push(n),i++;for(items of combination.ItemInfo)(t={}).SW=items.RW,t.Item=items.Item,t.MIndex=items.MIndex,t.SIndex=items.SIndex,t.IIndex=items.IIndex,t.Shelf=g_pog_json[items.PIndex].ModuleInfo[items.MIndex].ShelfInfo[items.SIndex].Shelf,t.Orientation=items.Orientation,t.CrushHoriz=items.CrushHoriz,t.CrushVert=items.CrushVert,t.CrushD=items.CrushD,t.MHorizCrushed=items.MHorizCrushed,t.MVertCrushed=items.MVertCrushed,t.MDepthCrushed=items.MDepthCrushed,t.CWPerc=items.CWPerc,t.CHPerc=items.CHPerc,t.CDPerc=items.CDPerc,t.H=items.H,t.D=items.D,t.X=items.X,t.Y=items.Y,t.Z=items.Z,t.RW=items.RW,t.RH=items.RH,t.RD=items.RD,t.W=items.W,t.SpreadItem=items.SpreadItem,t.Fixed=items.Fixed,t.BHoriz=items.BHoriz,t.BVert=items.BVert,t.BaseD=items.BaseD,t.OBJECT="ITEM",t.IComIndex=d,e.push(t);o.push(e),d++}return o}function calcCombineShelfAvlSpace(e,o){try{logDebug("function : calcCombineShelfAvlSpace;","S");var n=0,d=0,t=0;for(combineShelf of g_combinedShelfs[o]){n+=(f=g_pog_json[e].ModuleInfo[combineShelf.MIndex].ShelfInfo[combineShelf.SIndex]).W,"Y"==g_lr_overhung&&(0==t&&(n+=nvl(f.LOverhang)),t==g_combinedShelfs[o].length-1&&(n+=nvl(f.ROverhang)));for(const e of f.ItemInfo)void 0!==e.BottomObjID&&""!=e.BottomObjID||(d+=e.W);t++}var i=wpdSetFixed(100*(n-d));i=i<0?0:i;t=0;for(combineShelf of g_combinedShelfs[o]){var f=g_pog_json[e].ModuleInfo[combineShelf.MIndex].ShelfInfo[combineShelf.SIndex],l=g_scene_objects[e].scene.children[2].getObjectById(f.SObjID);if(void 0!==f.availableSpaceObjID&&-1!==f.availableSpaceObjID){var I=l.getObjectById(f.availableSpaceObjID);l.remove(I)}var r=f.Color;if(null==hexToRgb(r))var m=parseInt("FF",16),s=parseInt("FF",16),S=parseInt("FF",16);else m=hexToRgb(r).r,s=hexToRgb(r).r,S=hexToRgb(r).g;var h=getTextColor(m,s,S),b=addlabelText("Space "+(0==t?i:0),g_labelFont,g_labelActualSize,h,"center","");l.add(b),g_scene_objects[e].scene.children[2].getObjectById(f.SObjID).AvlSpace=i,b.position.y=-.005,b.uuid="fixel_space",0!==f.Rotation||0!==f.Slope?b.position.z=f.D/2+.005:b.position.z=.005,b.position.x=f.W/2.4-.08+0,f.availableSpaceObjID=b.id,t++}logDebug("function : calcCombineShelfAvlSpace;","E")}catch(e){error_handling(e)}}function reorderShelfWithFixedItem(e,o,n,d,t,i){try{var f=[],l="N",I=[],r=[],m=0,s=0;for(const e of i)e.IIndex=s,e.ShelfSplit="E"==d||"F"==d?m:-1,"Y"==e.Fixed?(e.X-e.W/2<o?e.X=wpdSetFixed(o+e.W/2):e.X+e.W/2>n&&(e.X=wpdSetFixed(n-e.W/2)),"E"==d||"F"==d?(I.push(e),0!==s&&(f.push(I),m++,(I=[]).push(e))):r.push(e),l="Y"):(I.push(e),l="N"),s++;"N"!=l||"E"!=d&&"F"!=d||f.push(I);const v=e.ItemInfo.length-1;if(e.ItemInfo.splice(0),"E"==d||"F"==d){var S="N",h=0;for(splitShelfItems of f){var b=0,a=o,g=n;for(item of splitShelfItems)"Y"==item.Fixed&&(0==b&&(a=wpdSetFixed(item.X-item.W/2),firstItemFixed="Y"),b==splitShelfItems.length-1&&(g=wpdSetFixed(item.X+item.W/2))),b++;var x=g-a,p=0;for(item of splitShelfItems)void 0!==item.BottomObjID&&""!==item.BottomObjID||(x=item.BHoriz>1&&"F"==d?wpdSetFixed(x-(item.W+t*(item.BHoriz-1))):wpdSetFixed(x-item.W),"Y"==S&&0==p&&"Y"==item.Fixed||e.ItemInfo.push(item)),p++;var _=x>=0?wpdSetFixed(x/(splitShelfItems.length-1)):0;splitShelfItems.forEach((e=>{e.ShelfSplit==h&&(e.SpreadItem=_)})),S="Y",h++}}else if("L"==d)for(var c=0,u=0,C=0,j=0;j<=r.length;j++){var M=j!==r.length?r[j]:-1;for(item of(c=0==j?wpdSetFixed(M.X-M.W/2-o):j<r.length?wpdSetFixed(M.X-M.W/2-u):wpdSetFixed(n-u),I))-1==item.ShelfSplit&&((c=wpdSetFixed(c-item.W))>0||-1==M)&&(item.ShelfSplit=0,item.IIndex=C,e.ItemInfo.push(item),C++);-1!==M&&(u=wpdSetFixed(M.X+M.W/2),M.IIndex=C,e.ItemInfo.push(M),C++)}else if("R"==d){c=0;var O=0;for(u=0,C=0,j=r.length-1;j>=-1;j--){M=-1!==j?r[j]:-1;c=j==r.length-1?wpdSetFixed(n-(M.X+M.W/2)):-1==j?wpdSetFixed(O-o):wpdSetFixed(O-(M.X+M.W/2));for(s=I.length-1;s>=0;s--)-1==I[s].ShelfSplit&&((c=wpdSetFixed(c-I[s].W))>0||-1==M)&&(I[s].ShelfSplit=0,I[s].IIndex=v-C,e.ItemInfo.splice(0,0,I[s]),C++);-1!==M&&(u=wpdSetFixed(M.X+M.W/2),O=wpdSetFixed(M.X-M.W/2),M.IIndex=v-C,e.ItemInfo.splice(0,0,M),C++)}}e.ItemInfo.keySort({IIndex:"asc"})}catch(e){error_handling(e)}}