async function create_shelf_from_json_lib(e,t,o,i,n,s,a,r,l,d,p,g,m,I,S,D,f,v,u,C,c,h,_,O,H,M,T,P,F,j,N,y,x,W,b="N",B,w,k,R,Y,A,z="N",L="N"){logDebug("function : create_shelf_from_json_lib; mod_index : "+e+"; p_module_width : "+o+"; draft_ind : "+i+"; new_pog_ind : "+n+"; pog_type : "+s+"; recreate : "+a,"S");try{var E=0;if(t[Y].ModuleInfo[e].ShelfInfo.length>0&&"N"==i&&"Y"==a){g_pog_json[Y].ModuleInfo[e].ShelfInfo.splice(0);var X=0;for(const o of t[Y].ModuleInfo[e].ShelfInfo){var V=g_world.getObjectById(o.SObjID);g_world.remove(V),X++}}if("Y"==p&&(E=t[Y].TotalModWidth),void 0!==t[Y].ModuleInfo[e].ShelfInfo&&t[Y].ModuleInfo[e].ShelfInfo.length>0){(Ve=t[Y].ModuleInfo[e].ShelfInfo).sort(((e,t)=>e.Y>t.Y?1:-1)),"Y"==l&&(copy_shelf=d[Y].ModuleInfo[e].ShelfInfo,copy_shelf.sort(((e,t)=>e.Y>t.Y?1:-1))),g_json.length>0&&(g_json_shelf=g_json[0].ModuleInfo[e].ShelfInfo,g_json_shelf.sort(((e,t)=>e.Y>t.Y?1:-1)));var G=0;for(const o of Ve)if(("DIVIDER"==o.ObjType&&"N"==n&&"F"==s||"DIVIDER"==o.ObjType&&"T"==n&&"D"==s)&&"Y"==r){var U=t[Y].ModuleInfo[e].ShelfInfo,Z=[],Q=[];X=0;for(const e of U){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){if("N"==n&&"F"==s)var K=wpdSetFixed(e.X+e.W/2);else K=wpdSetFixed(e.X);wpdSetFixed(e.Y)<wpdSetFixed(o.Y)&&wpdSetFixed(K-e.W)<=wpdSetFixed(o.X-o.W/2)&&wpdSetFixed(K+e.W)>=wpdSetFixed(o.X+o.W/2)&&(Z.push(wpdSetFixed(o.Y-e.Y)),Q.push(X))}X++}if(Z.length>0){var J=Math.min.apply(Math,Z),$=Z.findIndex((function(e){return e==J}));div_shelf_index=Q[$]}else div_shelf_index=0;if("Y"==l){var q=-1,ee=0;for(const o of copy_shelf){if(o.Shelf==t[Y].ModuleInfo[e].ShelfInfo[div_shelf_index].Shelf){q=ee;break}ee++}}console.log("div_shelf_index,",div_shelf_index,Z,Q),(Ie={}).ItemID=o.Shelf,Ie.Item=o.ObjType,Ie.W=wpdSetFixed(o.W),Ie.H=wpdSetFixed(o.H),Ie.D=wpdSetFixed(o.D),Ie.Color=o.Color,Ie.DimT="",Ie.Desc=o.Desc,Ie.Barcode="",Ie.LocID="",Ie.PegID="",Ie.PegSpread="",Ie.PegPerFacing="",Ie.Fixed="N",Ie.CapStyle="",Ie.CapFacing="",Ie.CapMerch="",Ie.CapOrientaion="",Ie.CapHeight="",Ie.CapHorz="",Ie.CapDepth="",Ie.CapTotalCount="",Ie.Rotation=o.Rotation,Ie.BHoriz=1,Ie.BVert=1,Ie.BaseD=1,Ie.CrushHoriz=0,Ie.CrushVert=0,Ie.CrushD=0,Ie.Orientation="0",Ie.MerchStyle="0",Ie.Supplier="",Ie.Brand="",Ie.BrandType="",Ie.Group="",Ie.Dept="",Ie.Class="",Ie.SubClass="",Ie.StdUOM="",Ie.SizeDesc="",Ie.Price="",Ie.Cost="",Ie.RegMovement="",Ie.RegMovementInd="",Ie.DaysOfSupplyInd="",Ie.MoveBasis="",Ie.AvgSales="",Ie.AvgSalesInd="",Ie.ItemStatus="",Ie.CDTLvl1="",Ie.CDTLvl2="",Ie.CDTLvl3="",Ie.ActualDPP="",Ie.StoreSOH="",Ie.StoreNo="",Ie.WeeksOfInventory="",Ie.DPPLoc="",Ie.CHPerc=0,Ie.CWPerc=0,Ie.CDPerc=0,Ie.ItemNesting=0,Ie.NVal=0,Ie.ItemContain=0,Ie.CnVal=0,Ie.IsContainer="N",Ie.BsktFactor=0,Ie.OverHang=0,Ie.HorizGap=0,Ie.VertGap=0,Ie.UW=0,Ie.UH=0,Ie.UD=0,Ie.CW=0,Ie.CH=0,Ie.CD=0,Ie.TW=0,Ie.TH=0,Ie.TD=0,Ie.DW=0,Ie.DH=0,Ie.DD=0,Ie.CnW=0,Ie.CnH=0,Ie.CnD=0,Ie.NW=0,Ie.NH=0,Ie.ND=0,Ie.OrgUW=0,Ie.OrgUH=0,Ie.OrgUD=0,Ie.OrgCW=0,Ie.OrgCH=0,Ie.OrgCD=0,Ie.OrgTW=0,Ie.OrgTH=0,Ie.OrgTD=0,Ie.OrgDW=0,Ie.OrgDH=0,Ie.OrgDD=0,Ie.OrgCHPerc=0,Ie.OrgCWPerc=0,Ie.OrgCDPerc=0,Ie.OrgCnW=0,Ie.OrgCnH=0,Ie.OrgCnD=0,Ie.OrgNW=0,Ie.OrgNH=0,Ie.OrgND=0,Ie.SIndex=div_shelf_index,Ie.Dragged="N",Ie.Quantity=1,Ie.X=wpdSetFixed(o.X-t[Y].ModuleInfo[e].ShelfInfo[div_shelf_index].X),Ie.Y=wpdSetFixed(o.Y),Ie.Z=.001,Ie.SlotDivider="N",Ie.ImgExists="N",Ie.CapCount=0,Ie.Exists="E",Ie.OW=wpdSetFixed(Ie.W),Ie.OH=wpdSetFixed(Ie.H),Ie.OD=wpdSetFixed(Ie.D),Ie.Distance=wpdSetFixed(o.X-t[Y].ModuleInfo[e].ShelfInfo[div_shelf_index].X),Ie.YDistance=wpdSetFixed(o.Y-(t[Y].ModuleInfo[e].ShelfInfo[div_shelf_index].Y+t[Y].ModuleInfo[e].ShelfInfo[div_shelf_index].H/2)),Ie.SpreadItem=0,Ie.MHorizCrushed="N",Ie.MVertCrushed="N",Ie.MDepthCrushed="N",Ie.MCapTopFacing="N",Ie.RW=wpdSetFixed(Ie.W),Ie.RH=wpdSetFixed(Ie.H),Ie.RD=wpdSetFixed(Ie.D),Ie.LObjID=-1,Ie.SubLblObjID=-1,Ie.DimUpdate="N",Ie.TopObjID="",Ie.BottomObjID="",Ie.SecondTier="",Ie.CompItemObjID="",Ie.SellingPrice="",Ie.ShelfPrice="",Ie.PromoPrice="",Ie.DiscountRate="",Ie.PriceChangeDate="",Ie.WeeksOfInventory="",Ie.Qty="",Ie.WhStock="",Ie.StoreStock="",Ie.StockIntransit="",Ie.SalesUnit="",Ie.NetSales="",Ie.CogsAdj="",Ie.CogsAdjInd="",Ie.GrossProfit="",Ie.GrossProfitInd="",Ie.WeeksCount="",Ie.WeeksCountInd="",Ie.MovingItem="",Ie.Profit="",Ie.TotalMargin="",Ie.MHorizFacings=-1,Ie.MVertFacings=-1,Ie.MPogDepthFacings="",Ie.MPogHorizFacings="",Ie.MPogVertFacings="",Ie.MDepthFacings=-1,Ie.OrientationDesc="Front 0",Ie.StoreCnt="",Ie.CapMaxH="",Ie.MaxHCapStyle="",Ie.NewYN="",Ie.Delist="N",Ie.DescSecond="",Ie.NewPegId="",Ie.OverhungItem="N",Ie.AutoDiv="N",Ie.UDA751="",Ie.UDA755="",Ie.DivHeight=wpdSetFixed(o.DivHeight),Ie.DivWidth=wpdSetFixed(o.DivWidth),Ie.DivPst=o.DivPst,Ie.DivPed=o.DivPed,Ie.DivPbtwFace=o.DivPbtwFace,Ie.DivStX=isNaN(o.DivStX)?0:o.DivStX,Ie.DivSpaceX=isNaN(o.DivSpaceX)?0:o.DivSpaceX,Ie.DivFillCol=o.DivFillCol,Ie.NoDivIDShow=o.NoDivIDShow,Ie.ItemCondition="",Ie.AUR="",Ie.ItemRanking="",Ie.WeeklySales="",Ie.WeeklyNetMargin="",Ie.WeeklyQty="",Ie.NetMarginPercent="",Ie.CumulativeNM="",Ie.TOP80B2="",Ie.ItemBrandC="",Ie.ItemPOGDept="",Ie.ItemRemark="",Ie.RTVStatus="",Ie.Pusher="",Ie.Divider="",Ie.BackSupport="",Ie.OOSPerc="",Ie.InitialItemDesc="",Ie.InitialBrand="",Ie.InitialBarcode="",t[Y].ModuleInfo[e].ShelfInfo[div_shelf_index].ItemInfo.push(Ie),"Y"==l&&d[Y].ModuleInfo[e].ShelfInfo[q].ItemInfo.splice(0,0,Ie),g_json.length>0&&"BASE"!==g_json[0].ModuleInfo[e].ShelfInfo[div_shelf_index].ObjType&&"NOTCH"!==g_json[0].ModuleInfo[e].ShelfInfo[div_shelf_index].ObjType&&"TEXTBOX"!==g_json[0].ModuleInfo[e].ShelfInfo[div_shelf_index].ObjType&&"DIVIDER"!==g_json[0].ModuleInfo[e].ShelfInfo[div_shelf_index].ObjType&&(null!=g_json[0].ModuleInfo[e].ShelfInfo[div_shelf_index].ItemInfo&&void 0!==g_json[0].ModuleInfo[e].ShelfInfo[div_shelf_index].ItemInfo||(g_json[0].ModuleInfo[e].ShelfInfo[div_shelf_index].ItemInfo=[]),g_json[0].ModuleInfo[e].ShelfInfo[div_shelf_index].ItemInfo.splice(0,0,Ie))}}if(void 0!==t[Y].ModuleInfo[e].ShelfInfo&&t[Y].ModuleInfo[e].ShelfInfo.length>0){(Ve=t[Y].ModuleInfo[e].ShelfInfo).sort(((e,t)=>e.Y>t.Y&&"NOTCH"!==e.ObjType&&"BASE"!==e.ObjType?1:-1)),g_json.length>0&&(l_json_shelf_details=g_json[0].ModuleInfo[e].ShelfInfo,l_json_shelf_details.sort(((e,t)=>e.Y>t.Y&&"NOTCH"!==e.ObjType&&"BASE"!==e.ObjType?1:-1))),"Y"==l&&(copy_shelf=d[Y].ModuleInfo[e].ShelfInfo,copy_shelf.sort(((e,t)=>e.Y>t.Y&&"NOTCH"!==e.ObjType&&"BASE"!==e.ObjType?1:-1)));G=0;var te=-1;for(const o of Ve){if("Y"==l){q=-1,ee=0;for(const e of copy_shelf){if(e.Shelf==o.Shelf){q=ee;break}ee++}}var oe={};"Y"==r?("N"==n&&"F"==s?(oe.GrillH=0,oe.LOverhang=null!==o.LOverhang&&""!==o.LOverhang&&void 0!==o.LOverhang?o.LOverhang:0,oe.ROverhang=null!==o.ROverhang&&""!==o.ROverhang&&void 0!==o.ROverhang?o.ROverhang:0,oe.SpacerThick=0,oe.HorizGap=null!==o.HorizGap&&""!==o.HorizGap&&void 0!==o.HorizGap?o.HorizGap:0,oe.SpreadItem=null!==o.SpreadItem&&""!==o.SpreadItem&&void 0!==o.SpreadItem?o.SpreadItem:m,oe.Combine=null!==o.Combine&&""!==o.Combine&&void 0!==o.Combine?o.Combine:"N",oe.AllowAutoCrush=null!==o.AllowAutoCrush&&""!==o.AllowAutoCrush&&void 0!==o.AllowAutoCrush?o.AllowAutoCrush:"N",oe.AutoPlacing=null!==o.AutoPlacing&&""!==o.AutoPlacing&&void 0!==o.AutoPlacing?o.AutoPlacing:v,oe.AutoDepthCalc=null!==o.AutoDepthCalc&&""!==o.AutoDepthCalc&&void 0!==o.AutoDepthCalc?o.AutoDepthCalc:"N",oe.MSpreadItem=null!==o.MSpreadItem&&""!==o.MSpreadItem&&void 0!==o.MSpreadItem?o.MSpreadItem:"N",oe.SMassUpdate=null!==o.SMassUpdate&&""!==o.SMassUpdate&&void 0!==o.SMassUpdate?o.SMassUpdate:"N",oe.HorizSlotStart=0,"PEGBOARD"==o.ObjType?(oe.HorizSpacing=I,oe.VertiSpacing=S):(oe.HorizSpacing=0,oe.VertiSpacing=0),oe.HorizSlotSpacing=0,oe.HorizStart=0,oe.UOverHang=0,oe.LoOverHang=0,oe.VertiStart=0,oe.BsktFill=w,oe.BsktSpreadProduct=k,oe.SnapTo="N","BASKET"==o.ObjType||"CHEST"==o.ObjType?(0!==o.BsktWallH&&void 0!==o.BsktWallH?oe.BsktWallH=o.BsktWallH:oe.BsktWallH=o.MaxMerch,oe.BsktBaseH=o.H,"BASKET"==o.ObjType?oe.BsktWallThickness=D:oe.BsktWallThickness=f):(oe.BsktWallH=0,oe.BsktBaseH=0,oe.BsktWallThickness=0),oe.DSlotStart=0,oe.DSlotSpacing=0,oe.DGap=0,oe.FrontOverHang=0,oe.BackOverHang=0,oe.SlotDivider="N",oe.AllowOverLap="N",oe.AutoFillPeg=o.AutoFillPeg,oe.SlotOrientation="",oe.DividerFixed="N",oe.AvlSpace=0,oe.X="Y"==p?wpdSetFixed(o.X+parseFloat(o.W)/2-E):wpdSetFixed(o.X+parseFloat(o.W)/2),oe.Y=wpdSetFixed(o.Y+parseFloat(o.H)/2),oe.Z=wpdSetFixed(o.Z+parseFloat(o.D)/2+g_pog_json[Y].BackDepth),oe.WrapText=null!==o.WrapText&&""!==o.WrapText?o.WrapText:u,oe.ReduceToFit=null!==o.ReduceToFit&&""!==o.ReduceToFit?o.ReduceToFit:"Y",oe.TextDirection=null!==o.TextDirection&&""!==o.TextDirection?o.TextDirection:"H",oe.FStyle="Arial",oe.FSize=null!==o.FSize&&""!==o.FSize&&0!==o.FSize?o.FSize:C,oe.FBold=o.Fbold,oe.canvasW=null,oe.canvasH=null,oe.peg_vert_values=[],oe.peg_horiz_values=[],oe.DivHeight=o.DivHeight,oe.DivWidth=o.DivWidth,oe.DivPst=o.DivPst,oe.DivPed=o.DivPed,oe.DivPbtwFace=o.DivPbtwFace,oe.DivStX=isNaN(o.DivStX)?0:o.DivStX,oe.DivSpaceX=isNaN(o.DivSpaceX)?0:o.DivSpaceX,oe.DivFillCol=o.DivFillCol,oe.NoDivIDShow=void 0===o.NoDivIDShow&&""!==o.NoDivIDShow?"N":o.NoDivIDShow,oe.Overhung=void 0===o.Overhung&&""!==o.Overhung?"N":o.Overhung):(oe.X="Y"==p?wpdSetFixed(o.X-E):wpdSetFixed(o.X),oe.Y=wpdSetFixed(o.Y),oe.Z=wpdSetFixed(o.Z),oe.GrillH=o.GrillH,oe.LOverhang=o.LOverhang,oe.ROverhang=o.ROverhang,oe.SpacerThick=o.SpacerThick,oe.HorizGap=null!==o.HorizGap&&""!==o.HorizGap&&void 0!==o.HorizGap?o.HorizGap:0,oe.SpreadItem=o.SpreadItem,oe.Combine=o.Combine,oe.AllowAutoCrush=o.AllowAutoCrush,oe.HorizSlotStart=o.HorizSlotStart,oe.HorizSlotSpacing=o.HorizSlotSpacing,oe.HorizStart=o.HorizStart,oe.HorizSpacing=o.HorizSpacing,oe.UOverHang=o.UOverHang,oe.LoOverHang=void 0===o.LoOverHang?0:o.LoOverHang,oe.VertiStart=o.VertiStart,oe.VertiSpacing=o.VertiSpacing,oe.BsktFill=o.BsktFill,oe.BsktSpreadProduct=o.BsktSpreadProduct,oe.SnapTo=o.SnapTo,oe.BsktWallH=o.BsktWallH,oe.BsktBaseH=o.BsktBaseH,oe.BsktWallThickness=o.BsktWallThickness,oe.DSlotStart=o.DSlotStart,oe.DSlotSpacing=o.DSlotSpacing,oe.DGap=o.DGap,oe.FrontOverHang=o.FrontOverHang,oe.BackOverHang=o.BackOverHang,oe.SlotDivider=o.SlotDivider,oe.AllowOverLap=o.AllowOverLap,oe.AutoPlacing=void 0!==o.AutoPlacing&&""!==o.AutoPlacing?o.AutoPlacing:"",oe.AutoFillPeg=void 0!==o.AutoFillPeg&&""!==o.AutoFillPeg?o.AutoFillPeg:"",oe.AvlSpace=o.W+o.LOverhang+o.ROverhang,oe.WrapText=o.WrapText,oe.ReduceToFit=o.ReduceToFit,oe.TextDirection=o.TextDirection,oe.SlotOrientation=o.SlotOrientation,oe.DividerFixed=o.DividerFixed,oe.FStyle=o.FStyle,oe.FSize=o.FSize,oe.FBold=o.FBold,oe.canvasW=o.canvasW,oe.canvasH=o.canvasH,oe.peg_vert_values=o.peg_vert_values,oe.peg_horiz_values=o.peg_horiz_values,oe.DivHeight=o.DivHeight,oe.DivWidth=o.DivWidth,oe.DivPst=o.DivPst,oe.DivPed=o.DivPed,oe.DivPbtwFace=o.DivPbtwFace,oe.DivStX=isNaN(o.DivStX)?0:o.DivStX,oe.DivSpaceX=isNaN(o.DivSpaceX)?0:o.DivSpaceX,oe.DivFillCol=o.DivFillCol,oe.NoDivIDShow=o.NoDivIDShow,oe.Overhung=void 0!==o.Overhung&&""!==o.Overhung?o.Overhung:"N"),oe.ShelfDivObjID=o.ShelfDivObjID,oe.ManualCrush=void 0!==o.ManualCrush&&""!==o.ManualCrush?o.ManualCrush:z,oe.SplitChest=void 0!==o.SplitChest&&""!==o.SplitChest?o.SplitChest:"N",oe.Shelf=o.Shelf,oe.POGCode=g_pog_json[Y].POGCode,oe.Version=g_pog_json[Y].Version,oe.ObjType=o.ObjType,oe.Desc=o.Desc,oe.MaxMerch=o.MaxMerch,oe.LObjID=o.LObjID,oe.OldObjID=o.SObjID,oe.NotchNo=o.NotchNo,""==o.TextImg||void 0===o.TextImg||null==o.TextImg?(oe.TextImg="",oe.TextImgName="",oe.TextImgMime=""):(oe.TextImg=o.TextImg,oe.TextImgName=o.TextImgName,oe.TextImgMime=o.TextImgMime),"BASE"==o.ObjType?(oe.H=g_pog_json[Y].BaseH,oe.W=g_pog_json[Y].BaseW,oe.D=g_pog_json[Y].BaseD,oe.Color=g_pog_json[Y].Color):"NOTCH"==o.ObjType?(oe.H=g_pog_json[Y].ModuleInfo[e].H,oe.W=g_pog_json[Y].ModuleInfo[e].NotchW,oe.D=g_pog_json[Y].ModuleInfo[e].D,oe.Color=g_pog_json[Y].ModuleInfo[e].Color):(oe.H=wpdSetFixed(o.H),oe.W=wpdSetFixed(o.W),oe.D=wpdSetFixed(o.D),null!==o.Color?void 0===o.Color||"#0"==o.Color||"#"==o.Color.charAt(1)?"TEXTBOX"==oe.ObjType?oe.Color=c:oe.Color=h:oe.Color="#FFFF"==o.Color?"#FFFFFF":o.Color:"TEXTBOX"==oe.ObjType?oe.Color=c:oe.Color=h),null==o.Rotation||void 0===o.Rotation?oe.Rotation=0:oe.Rotation=o.Rotation,null==o.Slope||void 0===o.Slope?oe.Slope=0:oe.Slope=o.Slope,oe.LiveImage=o.LiveImage,oe.CompShelfObjID=o.CompShelfObjID,oe.ManualZupdate=o.ManualZupdate,oe.InputText=void 0!==o.InputText&&null!==o.InputText?o.InputText:"",oe.ChestEdit=null!==o.ChestEdit&&""!==o.ChestEdit&&void 0!==o.ChestEdit?o.ChestEdit:"N",oe.ItemInfo=[],oe.InsidePegboard=o.InsidePegboard,g_pog_json[Y].ModuleInfo[e].ShelfInfo.push(oe),te=g_pog_json[Y].ModuleInfo[e].ShelfInfo.length-1):(oe=o,te=G);var ie=0;if(void 0===g_pog_json[Y].ModuleInfo[e].ParentModule||null==g_pog_json[Y].ModuleInfo[e].ParentModule&&"Y"==a){var ne=parseInt(oe.Color.replace("#","0x"),16),se=new THREE.Color(ne);if("PEGBOARD"==oe.ObjType)var ae=add_pegboard(oe.Shelf,oe.W,oe.H,oe.D,se,oe.X,oe.Y,.004,"N",oe.VertiStart,oe.VertiSpacing,oe.HorizStart,oe.HorizSpacing,e,te,oe.Rotation,oe.Slope,"N",j,T,P,F,x,W,y,Y);else if("TEXTBOX"==oe.ObjType){if("#"==oe.Color.charAt(1)&&"TEXTBOX"==oe.ObjType)var re=null;else re=ne;if("Y"==g_show_live_image&&""!==oe.TextImg&&void 0!==oe.TextImg&&null!==oe.TextImg)ae=await add_text_box_with_image(oe.Shelf,"TEXTBOX",oe.W,oe.H,oe.D,se,oe.X,oe.Y,oe.Z,"N",e,oe.InputText,re,oe.WrapText,oe.ReduceToFit,oe.Color,te,oe.Rotation,oe.Slope,"N",oe.FStyle,oe.FSize,oe.FBold,B,Y);else ae=add_text_box(oe.Shelf,"TEXTBOX",oe.W,oe.H,oe.D,se,oe.X,oe.Y,oe.Z,"N",e,oe.InputText,re,oe.WrapText,oe.ReduceToFit,oe.Color,te,oe.Rotation,oe.Slope,"N",oe.FStyle,oe.FSize,oe.FBold,M,Y,g_pogcr_enhance_textbox_fontsize,oe.TextDirection)}else if("ROD"==oe.ObjType)ne=parseInt(oe.Color.replace("#","0x"),16),se=new THREE.Color(ne),ae=add_rod(oe.Shelf,"SHELF",oe.W,oe.H,oe.D,se,oe.X,oe.Y,.004,"N",e,te,Y);else if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&(void 0===g_pog_json[Y].ModuleInfo[e].ParentModule||null==g_pog_json[Y].ModuleInfo[e].ParentModule)){"BASKET"==oe.ObjType||"CHEST"==oe.ObjType?"Y"==g_chest_as_pegboard&&"CHEST"==oe.ObjType?(ie=wpdSetFixed(oe.D),oe.H=wpdSetFixed(oe.D)):(ie=wpdSetFixed(oe.BsktBaseH),oe.H=wpdSetFixed(oe.BsktBaseH)):ie=wpdSetFixed(oe.H);var[ae,le]=await add_shelf(oe.Shelf,"SHELF",oe.W,ie,oe.D,se,oe.X,oe.Y,.005,"N",e,oe.Rotation,oe.Slope,te,"N","N","Y",-1,H,B,j,T,P,F,x,W,y,Y,t);if("Y"==b)updateObjID(oe.OldObjID,ae,"S")}}if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType&&(void 0===g_pog_json[Y].ModuleInfo[e].ParentModule||null==g_pog_json[Y].ModuleInfo[e].ParentModule)&&void 0!==o.ItemInfo&&null!==o.ItemInfo&&o.ItemInfo.length>0){item_Details=o.ItemInfo;var de={X:"asc",Y:"asc"};item_Details.keySort(de),"Y"==l&&(copy_items=d[Y].ModuleInfo[e].ShelfInfo[q].ItemInfo,copy_items.keySort(de)),g_json.length>0&&(g_json_shelf=g_json[0].ModuleInfo[e].ShelfInfo[G].ItemInfo,g_json_shelf.keySort(de));var pe=oe.X-oe.W/2,ge=0,me="N";for(const o of item_Details){if("N"==i){V=g_world.getObjectById(o.ObjID);g_world.remove(V)}var Ie={},Se=-1;if("Y"==r){if("N"==n&&"F"==s){if(Ie.DimT=o.MerchStyle,Ie.PegID="",Ie.PegSpread="",Ie.PegPerFacing="",Ie.Fixed="N",Ie.CapStyle=null!==o.CapStyle&&""!==o.CapStyle&&void 0!==o.CapStyle?o.CapStyle:"0",Ie.CapFacing=null!==o.CapFacing&&""!==o.CapFacing&&void 0!==o.CapFacing?o.CapFacing:"",Ie.CapMerch=null!==o.CapMerch&&""!==o.CapMerch&&void 0!==o.CapMerch?o.CapMerch:"",Ie.CapOrientaion=null!==o.CapOrientaion&&""!==o.CapOrientaion&&void 0!==o.CapOrientaion?o.CapOrientaion:"",Ie.CapHeight=null!==o.CapHeight&&""!==o.CapHeight&&void 0!==o.CapHeight?o.CapHeight:"",Ie.CapHorz=null!==o.CapHorz&&""!==o.CapHorz&&void 0!==o.CapHorz?o.CapHorz:"",Ie.CapDepth=null!==o.CapDepth&&""!==o.CapDepth&&void 0!==o.CapDepth?o.CapDepth:"",Ie.CapTotalCount=null!==o.CapTotalCount&&""!==o.CapTotalCount&&void 0!==o.CapTotalCount?o.CapTotalCount:"",Ie.CapMaxH=null!==o.CapMaxH&&""!==o.CapMaxH&&void 0!==o.CapMaxH?o.CapMaxH:"",Ie.CapCount=null!==o.CapCount&&""!==o.CapCount&&void 0!==o.CapCount?o.CapCount:"",Ie.CapDepthChanged=null!==o.CapDepthChanged&&""!==o.CapDepthChanged&&void 0!==o.CapDepthChanged?o.CapDepthChanged:"N",Ie.MaxHCapStyle="3",Ie.Rotation=0,Ie.CrushHoriz=null!==o.CrushHoriz&&""!==o.CrushHoriz&&void 0!==o.CrushHoriz?o.CrushHoriz:0,Ie.CrushVert=null!==o.CrushVert&&""!==o.CrushVert&&void 0!==o.CrushVert?o.CrushVert:0,Ie.CrushD=null!==o.CrushD&&""!==o.CrushD&&void 0!==o.CrushD?o.CrushD:0,Ie.Price="",Ie.Cost="",Ie.RegMovement="",Ie.RegMovementInd="",Ie.DaysOfSupplyInd="",Ie.AvgSales="",Ie.ItemStatus="",Ie.CDTLvl1="",Ie.CDTLvl2="",Ie.CDTLvl3="",Ie.ActualDPP="",Ie.StoreSOH="",Ie.StoreNo="",Ie.WeeksOfInventory="",Ie.ShelfPrice="",Ie.PromoPrice="",Ie.DiscountRate="",Ie.PriceChangeDate="",Ie.WeeksOfInventory="",Ie.Qty="",Ie.WhStock="",Ie.StoreStock="",Ie.StockIntransit="",Ie.DPPLoc="",Ie.MoveBasis="",Ie.IsContainer="N",Ie.BsktFactor=0,Ie.OverHang=0,Ie.VertGap=0,Ie.BHoriz=null==o.BHoriz?1:o.BHoriz,Ie.BVert=null==o.BVert?1:o.BVert,Ie.BaseD=null==o.BaseD||0==o.BaseD?1:o.BaseD,(g_json.length>0||void 0!==g_json[0])&&"D"==g_json[0].DesignType&&"D"==g_pog_json[Y].DesignType&&"Y"==g_pog_json[Y].MassUpdate)var[De,fe,ve,ue,Ce,ce]=get_new_orientation_dim("0",o.W,o.H,o.D);else var[De,fe,ve,ue,Ce,ce]=get_new_orientation_dim(o.Orientation,o.W,o.H,o.D);Ie.W=De,null!==o.CapCount&&""!==o.CapCount&&void 0!==o.CapCount&&"0"!==o.CapStyle&&void 0!==o.CapStyle&&null!==o.CapStyle?Ie.H=wpdSetFixed(fe*o.BVert+o.CapHeight*o.CapCount):Ie.H=wpdSetFixed(fe*o.BVert),Ie.D=ve,"BASKET"==oe.ObjType&&"DIVIDER"!==o.Item?(Ie.W=wpdSetFixed(oe.W),Ie.H=wpdSetFixed(o.D*o.Quantity),Ie.D=wpdSetFixed(o.D*Ie.BaseD),Ie.RW=wpdSetFixed(o.W),Ie.RH=wpdSetFixed(o.H),Ie.RD=wpdSetFixed(o.D)):(Ie.W=Ie.W*Ie.BHoriz,null!==o.CapCount&&""!==o.CapCount&&void 0!==o.CapCount&&"0"!==o.CapStyle&&void 0!==o.CapStyle&&null!==o.CapStyle?Ie.H=wpdSetFixed(fe*o.BVert+o.CapHeight*o.CapCount):Ie.H=wpdSetFixed(fe*o.BVert),Ie.D=wpdSetFixed(Ie.D*Ie.BaseD),Ie.RW=wpdSetFixed(Ie.W),Ie.RH=wpdSetFixed(fe*o.BVert),Ie.RD=wpdSetFixed(Ie.D)),Ie.OW=wpdSetFixed(o.W),Ie.OH=wpdSetFixed(o.H),Ie.OD=wpdSetFixed(o.D),Ie.LObjID=o.LObjID,Ie.SubLblObjID=o.SubLblObjID,Ie.Dragged="N",Ie.SpreadItem=void 0!==o.SpreadItem&&null!==o.SpreadItem&&""!==o.SpreadItem?o.SpreadItem:0,Ie.MHorizCrushed=null!==o.MHorizCrushed&&""!==o.MHorizCrushed&&void 0!==o.MHorizCrushed?o.MHorizCrushed:"N",Ie.MVertCrushed=null!==o.MVertCrushed&&""!==o.MVertCrushed&&void 0!==o.MVertCrushed?o.MVertCrushed:"N",Ie.MDepthCrushed=null!==o.MDepthCrushed&&""!==o.MDepthCrushed&&void 0!==o.MDepthCrushed?o.MDepthCrushed:"N",Ie.MCapTopFacing="N",Ie.X=oe.X-oe.W/2+o.X+Ie.W/2,"PEGBOARD"==oe.ObjType?"Y"==t[Y].MassUpdate?Ie.Y=wpdSetFixed(o.Y-Ie.H/2):Ie.Y=wpdSetFixed(o.Y-Ie.H/2-g_pog_json[Y].BaseH):"HANGINGBAR"==oe.ObjType?Ie.Y=wpdSetFixed(oe.Y-Ie.H/2):"D"==g_pog_json[Y].DesignType&&"Y"==g_pog_json[Y].MassUpdate&&"SHELF"==oe.ObjType?Ie.Y=wpdSetFixed(oe.Y+oe.H/2+Ie.H/2):Ie.Y=wpdSetFixed(o.Y+Ie.H/2),Ie.SlotDivider="N",Ie.Distance=wpdSetFixed(Ie.X-Ie.W/2-pe),Ie.YDistance=wpdSetFixed(Ie.Y-oe.Y+oe.H/2),"PEGBOARD"==oe.ObjType&&(Ie.PegBoardX=wpdSetFixed(Ie.X-Ie.W/2-pe),Ie.PegBoardY=wpdSetFixed(Ie.Y-Ie.H/2-(oe.Y-oe.H/2))),Ie.NewPegId="",Ie.AutoDiv="N",Ie.MassCrushH=void 0!==o.MassCrushH&&null!==o.MassCrushH?o.MassCrushH:"",Ie.MassCrushV=void 0!==o.MassCrushV&&null!==o.MassCrushV?o.MassCrushV:"",Ie.MassCrushD=void 0!==o.MassCrushD&&null!==o.MassCrushD?o.MassCrushD:"","PALLET"==oe.ObjType?Ie.Z=wpdSetFixed(o.Z+Ie.D/2):Ie.Z=0==o.Z?wpdSetFixed(o.Z+o.D/2):wpdSetFixed(o.Z)}else{Ie.DimT=o.DimT,Ie.PegID=o.PegID,Ie.PegSpread=o.PegSpread,Ie.PegPerFacing=o.PegPerFacing,Ie.Fixed=o.Fixed,Ie.CapStyle=o.CapStyle,Ie.CapFacing=null!==o.CapFacing&&""!==o.CapFacing&&void 0!==o.CapFacing?o.CapFacing:0,Ie.CapMerch=o.CapMerch,Ie.CapOrientaion=o.CapOrientaion,Ie.CapHeight=o.CapHeight,Ie.CapHorz=null!==o.CapHorz&&""!==o.CapHorz&&void 0!==o.CapHorz?o.CapHorz:0,Ie.CapDepth=null!==o.CapDepth&&""!==o.CapDepth&&void 0!==o.CapDepth?o.CapDepth:0,Ie.CapTotalCount=o.CapTotalCount,Ie.CapMaxH=void 0!==o.CapMaxH&&null!==o.CapMaxH?o.CapMaxH:0,Ie.MaxHCapStyle=void 0!==o.MaxHCapStyle&&null!==o.MaxHCapStyle?o.MaxHCapStyle:"3",Ie.Rotation=o.Rotation,Ie.CrushHoriz=o.CrushHoriz,Ie.CrushVert=o.CrushVert,Ie.CrushD=o.CrushD,Ie.Price=o.Price,Ie.Cost=o.Cost,Ie.RegMovement=o.RegMovement,Ie.RegMovementInd=void 0!==o.RegMovementInd?o.RegMovementInd:"",Ie.DaysOfSupplyInd=void 0!==o.DaysOfSupplyInd?o.DaysOfSupplyInd:"",Ie.AvgSales=void 0!==o.AvgSales&&null!=o.AvgSales&&""!=o.AvgSales?Math.floor(100*o.AvgSales)/100:"",Ie.ItemStatus=void 0!==o.ItemStatus?o.ItemStatus:"",Ie.CDTLvl1=void 0!==o.CDTLvl1?o.CDTLvl1:"",Ie.CDTLvl2=void 0!==o.CDTLvl2?o.CDTLvl2:"",Ie.CDTLvl3=void 0!==o.CDTLvl3?o.CDTLvl3:"",Ie.ActualDPP=void 0!==o.ActualDPP?o.ActualDPP:"",Ie.StoreSOH=void 0!==o.StoreSOH?o.StoreSOH:"",Ie.StoreNo=void 0!==o.StoreNo?o.StoreNo:"",Ie.DPPLoc=o.DPPLoc,Ie.WeeksOfInventory=void 0!==o.WeeksOfInventory?o.WeeksOfInventory:"",Ie.ShelfPrice=void 0!==o.ShelfPrice?o.ShelfPrice:"",Ie.PromoPrice=void 0!==o.PromoPrice?o.PromoPrice:"",Ie.DiscountRate=void 0!==o.DiscountRate?o.DiscountRate:"",Ie.PriceChangeDate=void 0!==o.PriceChangeDate?o.PriceChangeDate:"",Ie.WeeksOfInventory=void 0!==o.WeeksOfInventory?o.WeeksOfInventory:"",Ie.Qty=void 0!==o.Qty?o.Qty:"",Ie.WhStock=void 0!==o.WhStock?o.WhStock:"",Ie.StoreStock=void 0!==o.StoreStock?o.StoreStock:"",Ie.StockIntransit=void 0!==o.StockIntransit?o.StockIntransit:"",Ie.MoveBasis=o.MoveBasis,Ie.IsContainer=o.IsContainer,Ie.BsktFactor=o.BsktFactor,Ie.OverHang=o.OverHang,Ie.VertGap=o.VertGap,Ie.OW=wpdSetFixed(o.OW),Ie.OH=wpdSetFixed(o.OH),Ie.OD=wpdSetFixed(o.OD),Ie.Dragged=o.Dragged,Ie.SpreadItem=o.SpreadItem,Ie.MHorizCrushed=o.MHorizCrushed,Ie.MVertCrushed=o.MVertCrushed,Ie.MDepthCrushed=o.MDepthCrushed,Ie.MCapTopFacing=o.MCapTopFacing;var[De,fe,ve,ue,Ce,ce]=get_new_orientation_dim(o.Orientation,o.OW,o.OH,o.OD);Ie.RW=wpdSetFixed(De*o.BHoriz),Ie.RH=wpdSetFixed(fe*o.BVert),Ie.RD=wpdSetFixed(ve*o.BaseD),Ie.LObjID=o.LObjID,Ie.SubLblObjID=o.SubLblObjID,Ie.SlotDivider=o.SlotDivider,Ie.CapCount=o.CapCount,Ie.X="Y"==p?wpdSetFixed(o.X-E):wpdSetFixed(o.X),Ie.Y=wpdSetFixed(o.Y),"HANGINGBAR"==oe.ObjType?Ie.Y=wpdSetFixed(oe.Y-o.H/2):Ie.Y=wpdSetFixed(o.Y),Ie.BHoriz=o.BHoriz,Ie.BVert=o.BVert,Ie.BaseD=o.BaseD,Ie.W=wpdSetFixed(o.W),Ie.H=wpdSetFixed(o.H),Ie.D=wpdSetFixed(o.D),Ie.Distance=o.Distance,Ie.PegBoardX=o.PegBoardX,Ie.PegBoardY=o.PegBoardY,Ie.NewPegId="",Ie.YDistance=void 0!==o.YDistance?o.YDistance:Ie.Y-oe.Y+oe.H/2,Ie.MassCrushH="N",Ie.MassCrushV="N",Ie.MassCrushD="N",Ie.AutoDiv=void 0!==o.AutoDiv?o.AutoDiv:"N","PALLET"==oe.ObjType?Ie.Z=wpdSetFixed(o.Z):Ie.Z=0==o.Z?wpdSetFixed(o.Z+o.D/2):wpdSetFixed(o.Z)}if(Ie.Quantity=Math.round(100*o.Quantity)/100,Ie.ItemID=o.ItemID,Ie.Item=o.Item,void 0===o.Color||null==o.Color?Ie.Color=_:Ie.Color=o.Color,Ie.Desc=o.Desc,Ie.Barcode=o.Barcode,Ie.LocID=o.LocID,Ie.Orientation=o.Orientation,Ie.MerchStyle=null==o.MerchStyle||void 0===o.MerchStyle||""==o.MerchStyle?"0":o.MerchStyle,Ie.Supplier=o.Supplier,void 0!==o.Supplier&&""!==o.Supplier&&null!==o.Supplier?Ie.SupplierName=o.Supplier.split("-")[1]:Ie.SupplierName="",Ie.Brand=o.Brand,Ie.BrandType=o.BrandType,Ie.Group=o.Group,Ie.Dept=o.Dept,Ie.SubClass=o.SubClass,void 0!==o.Dept&&""!==o.Dept&&null!==o.Dept)var he=o.Dept.split("-");else he="";if(void 0!==o.Class&&""!==o.Class&&null!==o.Class)var _e=o.Class.split("-");else _e="";if(void 0!==o.SubClass&&""!==o.SubClass&&null!==o.SubClass)var Oe=o.SubClass.split("-");else Oe="";if(Ie.Class=o.Class,Ie.ClassName=he[0]+"/"+_e[0]+"/"+Oe[0],Ie.StdUOM=o.StdUOM,Ie.SizeDesc=void 0===o.SizeDesc||null==o.SizeDesc?"":o.SizeDesc,Ie.HorizGap=o.HorizGap,Ie.UW=wpdSetFixed(o.UW),Ie.UH=wpdSetFixed(o.UH),Ie.UD=wpdSetFixed(o.UD),Ie.CW=wpdSetFixed(o.CW),Ie.CH=wpdSetFixed(o.CH),Ie.CD=wpdSetFixed(o.CD),Ie.TW=wpdSetFixed(o.TW),Ie.TH=wpdSetFixed(o.TH),Ie.TD=wpdSetFixed(o.TD),Ie.DW=wpdSetFixed(o.DW),Ie.DH=wpdSetFixed(o.DH),Ie.DD=wpdSetFixed(o.DD),Ie.CWPerc=o.CWPerc,Ie.CHPerc=o.CHPerc,Ie.CDPerc=o.CDPerc,Ie.TopObjID=o.TopObjID,Ie.BottomObjID=o.BottomObjID,Ie.SecondTier=o.SecondTier,Ie.CompItemObjID=o.CompItemObjID,Ie.SellingPrice=Math.round(100*o.SellingPrice)/100,Ie.NetSales=void 0!==o.NetSales&&""!==o.NetSales?Math.round(100*o.NetSales)/100:0,Ie.CogsAdj=o.CogsAdj,Ie.CogsAdjInd=void 0!==o.CogsAdjInd?o.CogsAdjInd:"",Ie.RegMovement=o.RegMovement,Ie.RegMovementInd=void 0!==o.RegMovementInd?o.RegMovementInd:"",Ie.AvgSales=void 0!==o.AvgSales&&null!=o.AvgSales&&""!=o.AvgSales?Math.floor(100*o.AvgSales)/100:"",Ie.AvgSalesInd=void 0!==o.AvgSalesInd?o.AvgSalesInd:"",Ie.ItemStatus=void 0!==o.ItemStatus?o.ItemStatus:"",Ie.CDTLvl1=void 0!==o.CDTLvl1?o.CDTLvl1:"",Ie.CDTLvl2=void 0!==o.CDTLvl2?o.CDTLvl2:"",Ie.CDTLvl3=void 0!==o.CDTLvl3?o.CDTLvl3:"",Ie.MPogVertFacings=void 0!==o.MPogVertFacings?o.MPogVertFacings:"",Ie.MPogHorizFacings=void 0!==o.MPogHorizFacings?o.MPogHorizFacings:"",Ie.MPogDepthFacings=void 0!==o.MPogDepthFacings?o.MPogDepthFacings:"",Ie.ActualDPP=void 0!==o.ActualDPP&&null!=o.ActualDPP&&""!=o.ActualDPP?parseFloat(o.ActualDPP).toFixed(2):"",Ie.DPPLoc=o.DPPLoc,Ie.StoreSOH=void 0!==o.StoreSOH?o.StoreSOH:"",Ie.StoreNo=void 0!==o.StoreNo?o.StoreNo:"",Ie.WeeksOfInventory=void 0!==o.WeeksOfInventory?o.WeeksOfInventory:"",Ie.ShelfPrice=void 0!==o.ShelfPrice?o.ShelfPrice:"",Ie.PromoPrice=void 0!==o.PromoPrice?o.PromoPrice:"",Ie.DiscountRate=void 0!==o.DiscountRate?o.DiscountRate:"",Ie.PriceChangeDate=void 0!==o.PriceChangeDate?o.PriceChangeDate:"",Ie.WeeksOfInventory=void 0!==o.WeeksOfInventory?o.WeeksOfInventory:"",Ie.Qty=void 0!==o.Qty?o.Qty:"",Ie.WhStock=void 0!==o.WhStock?o.WhStock:"",Ie.StoreStock=void 0!==o.StoreStock?o.StoreStock:"",Ie.StockIntransit=void 0!==o.StockIntransit?o.StockIntransit:"",Ie.GrossProfit=void 0!==o.GrossProfit?o.GrossProfit:0,Ie.GrossProfitInd=void 0!==o.GrossProfitInd?o.GrossProfitInd:"",Ie.WeeksCount=o.WeeksCount,Ie.WeeksCountInd=void 0!==o.WeeksCountInd?o.WeeksCountInd:"",Ie.MovingItem=o.MovingItem,Ie.Profit=Math.round(100*o.Profit)/100,Ie.TotalMargin=o.TotalMargin,Ie.Price=o.Price,Ie.Cost=o.Cost,Ie.MHorizFacings=void 0===o.MHorizFacings||null==o.MHorizFacings?-1:parseInt(o.MHorizFacings),Ie.MVertFacings=void 0===o.MVertFacings||null==o.MVertFacings?-1:parseInt(o.MVertFacings),Ie.MDepthFacings=void 0===o.MDepthFacings||null==o.MDepthFacings?-1:parseInt(o.MDepthFacings),Ie.Status=o.Status,Ie.DaysOfSupply=o.DaysOfSupply,Ie.DaysOfSupplyInd=void 0!==o.DaysOfSupplyInd?o.DaysOfSupplyInd:"",Ie.ShowColorBackup=o.ShowColorBackup,Ie.OrientationDesc=o.OrientationDesc,Ie.StoreCnt=o.StoreCnt,Ie.NewYN="",Ie.DescSecond=o.DescSecond,Ie.Delist=void 0===o.Delist?"N":o.Delist,Ie.OverhungItem=void 0===o.OverhungItem?"N":o.OverhungItem,"Y"==Ie.Delist&&(Ie.Color=O),void 0===o.CnW?Ie.CnW=0:Ie.CnW=o.CnW,void 0===o.CnH?Ie.CnH=0:Ie.CnH=o.CnH,void 0===o.CnD?Ie.CnD=0:Ie.CnD=o.CnD,void 0===o.NW?Ie.NW=0:Ie.NW=o.NW,void 0===o.NH?Ie.NH=0:Ie.NH=o.NH,void 0===o.ND?Ie.ND=0:Ie.ND=o.ND,Ie.ItemNesting=o.ItemNesting,Ie.NVal="H"==Ie.ItemNesting?o.NH:"W"==Ie.ItemNesting?o.NW:"D"==Ie.ItemNesting?o.ND:0,Ie.ItemContain=o.ItemContain,Ie.CnVal="H"==Ie.ItemContain?o.CnH:"W"==Ie.ItemContain?o.CnW:"D"==Ie.ItemContain?o.CnD:0,Ie.OldCnW=Ie.CnW,Ie.OldCnH=Ie.CnH,Ie.OldCnD=Ie.CnD,Ie.OldNW=Ie.NW,Ie.OldNH=Ie.NH,Ie.OldND=Ie.ND,Ie.OrgUW=wpdSetFixed(o.OrgUW),Ie.OrgUH=wpdSetFixed(o.OrgUH),Ie.OrgUD=wpdSetFixed(o.OrgUD),Ie.OrgCW=wpdSetFixed(o.OrgCW),Ie.OrgCH=wpdSetFixed(o.OrgCH),Ie.OrgCD=wpdSetFixed(o.OrgCD),Ie.OrgTW=wpdSetFixed(o.OrgTW),Ie.OrgTH=wpdSetFixed(o.OrgTH),Ie.OrgTD=wpdSetFixed(o.OrgTD),Ie.OrgDW=wpdSetFixed(o.OrgDW),Ie.OrgDH=wpdSetFixed(o.OrgDH),Ie.OrgDD=wpdSetFixed(o.OrgDD),Ie.OrgCWPerc=o.OrgCWPerc,Ie.OrgCHPerc=o.OrgCHPerc,Ie.OrgCDPerc=o.OrgCDPerc,Ie.OrgCnW=o.OrgCnW,Ie.OrgCnH=o.OrgCnH,Ie.OrgCnD=o.OrgCnD,Ie.OrgNW=o.OrgNW,Ie.OrgNH=o.OrgNH,Ie.OrgND=o.OrgND,void 0!==o.SizeDesc&&""!==o.SizeDesc)var He=null!==o.SizeDesc?o.SizeDesc.split("*"):[];else He=[];var Me=o.CapFacing*o.CapDepth*o.CapHorz;if(Ie.Cpct=o.BHoriz*o.BVert*o.BaseD+(isNaN(Me)?0:Me),Ie.ImgExists=o.ImgExists,Ie.Exists="E",Ie.DimUpdate="N",Ie.ItemImage=o.ItemImage,Ie.Edited="Y",Ie.OldObjID=o.ObjID,Ie.NewPegId="",Ie.DFacing=o.BaseD,Ie.UnitperCase=o.UnitperCase,Ie.UnitperTray=o.UnitperTray,Ie.DfacingUpd="N",Ie.TotalUnitsCalc=o.BHoriz*o.BVert*o.BaseD,Ie.PkSiz=parseInt(He[1]),Ie.ItmDescChi=o.ItmDescChi,He.length>1?Ie.ItmDescEng=o.Brand+" "+o.Desc+" "+parseInt(He[0])/parseInt(He[1])+"*"+He[1]+"*"+He[2]:Ie.ItmDescEng=o.Brand+" "+o.Desc,Ie.Brand_Category=void 0!==o.Brand_Category?o.Brand_Category:"",Ie.Uda_item_status=void 0!==o.Uda_item_status?o.Uda_item_status:"",Ie.Gobecobrand=void 0!==o.Gobecobrand?o.Gobecobrand:"",Ie.Internet=void 0!==o.Internet?o.Internet:"",Ie.LiveNewItem=void 0!==o.LiveNewItem?o.LiveNewItem:"",Ie.CapDepthChanged="N",Ie.Categ=void 0!==o.Categ?o.Categ:"",Ie.COO=void 0!==o.COO?o.COO:"",Ie.ItemSize=void 0!==o.ItemSize?o.ItemSize:"",Ie.SplrLbl=void 0!==o.SplrLbl?o.SplrLbl:"",Ie.EDLP=void 0!==o.EDLP?o.EDLP:"",Ie.GoGreen=void 0!==o.GoGreen?o.GoGreen:"",Ie.LoGrp=void 0!==o.LoGrp?o.LoGrp:"",Ie.SqzPer=(void 0!==o.CrushHoriz?o.CrushHoriz:0)+":"+(void 0!==o.CrushVert?o.CrushVert:0)+":"+(void 0!==o.CrushD?o.CrushD:0),Ie.InternationalRng=void 0!==o.InternationalRng?o.InternationalRng:"",Ie.StoreCnt=void 0!==o.StoreCnt?o.StoreCnt:"",Ie.NewItem=void 0!==o.NewItem?o.NewItem:"",void 0!==o.SalesUnit&&null!==o.SalesUnit){var Te=o.SalesUnit;Ie.SalesUnit=Math.floor(100*Te)/100}else Ie.SalesUnit="";if(void 0!==typeof o.Remarks?Ie.Remarks=o.Remarks:Ie.Remarks="",Ie.UDA751=void 0!==o.UDA751?o.UDA751:"",Ie.UDA755=void 0!==o.UDA755?o.UDA755:"",Ie.ItemCondition=0!=nvl(o.ItemCondition)?o.ItemCondition:"",Ie.AUR=0!=nvl(o.AUR)?o.AUR:"",Ie.ItemRanking=0!=nvl(o.ItemRanking)?o.ItemRanking:"",Ie.WeeklySales=0!=nvl(o.WeeklySales)?o.WeeklySales:"",Ie.WeeklyNetMargin=0!=nvl(o.WeeklyNetMargin)?o.WeeklyNetMargin:"",Ie.WeeklyQty=0!=nvl(o.WeeklyQty)?o.WeeklyQty:"",Ie.NetMarginPercent=void 0!==o.NetMarginPercent?o.NetMarginPercent:void 0!==o.NetMarginPerc?o.NetMarginPerc:"",Ie.CumulativeNM=0!=nvl(o.CumulativeNM)?o.CumulativeNM:"",Ie.TOP80B2=0!=nvl(o.TOP80B2)?o.TOP80B2:"",Ie.ItemBrandC=0!=nvl(o.ItemBrandC)?o.ItemBrandC:"",Ie.ItemPOGDept=0!=nvl(o.ItemPOGDept)?o.ItemPOGDept:"",Ie.ItemRemark=0!=nvl(o.ItemRemark)?o.ItemRemark:"",Ie.RTVStatus=0!=nvl(o.RTVStatus)?o.RTVStatus:"",Ie.Pusher=0!=nvl(o.Pusher)?o.Pusher:"",Ie.Divider=0!=nvl(o.Divider)?o.Divider:"",Ie.BackSupport=0!=nvl(o.BackSupport)?o.BackSupport:"",Ie.OOSPerc=nvl(o.OOSPerc),Ie.InitialItemDesc=void 0!==o.InitialItemDesc?o.InitialItemDesc:"",Ie.InitialBrand=void 0!==o.InitialBrand?o.InitialBrand:"",Ie.InitialBarcode=void 0!==o.InitialBarcode?o.InitialBarcode:"","Y"==l&&!("Y"!=g_auto_apply_v_facings&&"Y"!=g_auto_apply_d_facings||"SHELF"!=oe.ObjType&&"HANGINGBAR"!=oe.ObjType||"DIVIDER"===o.Item)){d[Y].ModuleInfo[e].ShelfInfo[q].ItemInfo[ge].ItemX=wpdSetFixed(Ie.ItemX),d[Y].ModuleInfo[e].ShelfInfo[q].ItemInfo[ge].ItemY=wpdSetFixed(Ie.ItemY);var[Pe,Fe,je,Ne,ye,xe,We]=calcMaxFacings(d,e,q,d[Y].ModuleInfo[e].ShelfInfo[q],Ie,ge);"Y"==g_auto_apply_v_facings&&0!==nvl(Pe)&&("SHELF"==oe.ObjType||"HANGINGBAR"==oe.ObjType&&"Y"==g_auto_hangbar_facings)&&(Ie.H=wpdSetFixed(Pe),Ie.RH=wpdSetFixed(je),Ie.BVert=Fe,Ie.Y=wpdSetFixed(Ne)),"Y"==g_auto_apply_d_facings&&0!==nvl(ye)&&("SHELF"==oe.ObjType||"HANGINGBAR"==oe.ObjType&&"Y"==g_auto_hangbar_facings)&&(Ie.BaseD=wpdSetFixed(xe),Ie.D=wpdSetFixed(ye),Ie.RD=wpdSetFixed(We))}g_pog_json[Y].ModuleInfo[e].ShelfInfo[G].ItemInfo.push(Ie),Se=g_pog_json[Y].ModuleInfo[e].ShelfInfo[G].ItemInfo.length-1}else Ie=o,Se=ge;if("Y"==a){if((Be=g_pog_json[Y].ModuleInfo[e].ShelfInfo[G].ItemInfo[Se]).MIndex=e,Be.SIndex=G,Be.IIndex=Se,g_json.length>0&&"BASE"!==g_json[0].ModuleInfo[e].ShelfInfo[G].ObjType&&"NOTCH"!==g_json[0].ModuleInfo[e].ShelfInfo[G].ObjType&&"TEXTBOX"!==g_json[0].ModuleInfo[e].ShelfInfo[G].ObjType&&"DIVIDER"!==g_json[0].ModuleInfo[e].ShelfInfo[G].ObjType&&(g_json[0].ModuleInfo[e].ShelfInfo[G].ItemInfo[Se].MIndex=e,g_json[0].ModuleInfo[e].ShelfInfo[G].ItemInfo[Se].SIndex=G,g_json[0].ModuleInfo[e].ShelfInfo[G].ItemInfo[Se].IIndex=Se),"DIVIDER"==Be.Item)var be=add_items(Be.ItemID,Be.W,Be.H,Be.D,Be.Color,Be.X,Be.Y,Be.Z,e,G,ge,Be.Rotation,Y);else{if("Y"==L&&"Y"==g_pog_json[Y].MassUpdate){if("1"!=Be.CapStyle&&"2"!=Be.CapStyle&&"3"!=Be.CapStyle||0!=Be.CapCount||await set_item_capping(Y,e,G,ge,"Y","N"),"CHEST"!=oe.ObjType||"Y"!=g_chest_as_pegboard){if("Y"==Be.MVertCrushed||"Y"==Be.MassCrushV||"Y"==oe.AllowAutoCrush)crushItem(Y,e,G,ge,"H","Y",[Be.D],[ge],"Y");if("Y"==Be.MHorizCrushed||"Y"==Be.MassCrushH||"Y"==oe.AllowAutoCrush)me="Y"==crushItem(Y,e,G,ge,"W","Y",[Be.D],[ge],"Y"==oe.DivPed&&oe.DivWidth>0?"Y":"N")?"Y":"N";if("Y"==Be.MDepthCrushed||"Y"==Be.MassCrushD||"Y"==oe.AllowAutoCrush)crushItem(Y,e,G,ge,"D","Y",[Be.D],[ge],"Y")}"N"==n&&"F"==s&&("DIVIDER"==o.Item?Be.X=wpdSetFixed(o.X+o.W/2):Be.X=wpdSetFixed(oe.X-oe.W/2+o.X+Be.W/2),"PEGBOARD"==oe.ObjType?"Y"==t[Y].MassUpdate?Be.Y=wpdSetFixed(o.Y-Be.H/2):Be.Y=wpdSetFixed(o.Y-Be.H/2-g_pog_json[Y].BaseH):"HANGINGBAR"==oe.ObjType?Be.Y=wpdSetFixed(oe.Y-Be.H/2):"D"==g_pog_json[Y].DesignType&&"Y"==g_pog_json[Y].MassUpdate&&"SHELF"==oe.ObjType?Be.Y=wpdSetFixed(oe.Y+oe.H/2+Be.H/2):Be.Y=wpdSetFixed(o.Y+Be.H/2),Be.Distance=wpdSetFixed(Be.X-Be.W/2-pe),Be.YDistance=wpdSetFixed(Be.Y-oe.Y+oe.H/2),"PEGBOARD"==oe.ObjType&&(Be.PegBoardX=wpdSetFixed(Be.X-Be.W/2-pe),Be.PegBoardY=wpdSetFixed(Be.Y-Be.H/2-(oe.Y-oe.H/2))))}var Be=g_pog_json[Y].ModuleInfo[e].ShelfInfo[G].ItemInfo[Se];if("N"==g_show_live_image){var we=g_orientation_json[o.Orientation].split("###");be=await add_items_with_image(Be.ItemID,Be.W,Be.H,Be.D,Be.Color,Be.X,Be.Y,Be.Z,e,G,ge,Be.BHoriz,Be.BVert,Be.Item,parseInt(we[0]),parseInt(we[1]),"N","Y",T,P,F,x,W,y,Y)}else be=await add_items_prom(Be.ItemID,Be.W,Be.H,Be.D,Be.Color,Be.X,Be.Y,Be.Z,e,G,ge,"N","Y",j,N,y,x,W,Y)}void 0!==(V=g_world.getObjectById(be))&&"N"==g_show_live_image&&("N"==Be.Status?(V.BorderColour=g_status_error_color,V.Status="N",V.WireframeObj.material.color.setHex(V.BorderColour)):nvl(o.OOSPerc)>80&&"Y"==g_pogcr_enbl_oos_border?(V.BorderColour=g_pogcr_oos_border_color,V.WireframeObj.material.color.setHex(V.BorderColour)):V.BorderColour=0),"PALLET"==oe.ObjType?g_pog_json[Y].ModuleInfo[e].ShelfInfo[G].ItemInfo[ge].Z=wpdSetFixed(Be.Z):g_pog_json[Y].ModuleInfo[e].ShelfInfo[G].ItemInfo[ge].Z=.016,g_pog_json[Y].ModuleInfo[e].ShelfInfo[G].ItemInfo[ge].ObjID=be,g_pog_json[Y].ModuleInfo[e].ShelfInfo[G].ItemInfo[ge].CType=oe.ObjType}ge+=1}var ke=g_world.getObjectById(g_pog_json[Y].ModuleInfo[e].ShelfInfo[G].SObjID);if(void 0!==ke&&(ke.AvlSpace=wpdSetFixed(100*ke.AvlSpace)),"SHELF"==oe.ObjType||"PALLET"==oe.ObjType)await reset_top_bottom_objects(e,G,"Y",Y);var Re=g_pog_json[Y].ModuleInfo[e].ShelfInfo[G];if("N"==Re.Combine&&"Y"==me&&("CHEST"!=Re.ObjType||"Y"!=g_chest_as_pegboard)&&"PEGBOARD"!==Re.ObjType){var Ye=Re.HorizGap,Ae=Ye,ze=Re.SpreadItem,Le=Re.ItemInfo.length;Re.AllowAutoCrush;if(reorder_items(e,G,Y)){var Ee=0;for(item_info of Re.ItemInfo){var Xe=get_item_xaxis(item_info.W,item_info.H,item_info.D,item_info.CType,"",Ae,ze,Ye,e,G,Ee,"Y",Le,"N",Y);item_info.X=wpdSetFixed(Xe);V=g_world.getObjectById(item_info.ObjID);if(g_world.remove(V),"DIVIDER"==item_info.Item)be=add_items(item_info.ItemID,item_info.W,item_info.H,item_info.D,item_info.Color,item_info.X,item_info.Y,item_info.Z,e,G,Ee,item_info.Rotation,Y);else if("Y"==g_show_live_image)we=g_orientation_json[item_info.Orientation].split("###"),be=await add_items_with_image(item_info.ItemID,item_info.W,item_info.H,item_info.D,item_info.Color,item_info.X,item_info.Y,item_info.Z,e,G,Ee,item_info.BHoriz,item_info.BVert,item_info.Item,parseInt(we[0]),parseInt(we[1]),"N","Y",T,P,F,x,W,y,Y);else be=await add_items_prom(item_info.ItemID,item_info.W,item_info.H,item_info.D,item_info.Color,item_info.X,item_info.Y,item_info.Z,e,G,Ee,"N","Y",j,N,y,x,W,Y);g_pog_json[Y].ModuleInfo[e].ShelfInfo[G].ItemInfo[Ee].ObjID=be,Ee++}}}}G+=1}var Ve=g_pog_json[Y].ModuleInfo[e].ShelfInfo;X=0;for(const t of Ve){for(const o of t.ItemInfo){if("DIVIDER"==o.Item){var Ge=0;for(const t of Ve)"DIVIDER"==t.ObjType&&t.Shelf==o.ItemID&&(g_pog_json[Y].ModuleInfo[e].ShelfInfo[Ge].ShelfDivObjID=o.ObjID),Ge++}0}X++}}render(Y),logDebug("function : create_shelf_from_json_lib","E")}catch(e){error_handling(e)}}async function create_shelf_edit_pog_lib(e,t,o,i,n,s,a,r,l,p,g,m,I,S,D,f,v,u,C,c,h,_,O,H,M,T,P,F,j,N,y,x,W="N"){logDebug("function : create_shelf_edit_pog_lib; mod_index : "+e+"; p_module_width : "+o+"; draft_ind : "+i+"; new_pog_ind : "+n+"; pog_type : "+s+"; carpark_ind : "+a+"; recreate : "+r,"S");try{var b=-1;if(void 0!==t){if(t.length>0){var B=[],w=0;for(const e in t){var k=g_world.getObjectById(e.SObjID);g_world.remove(k),w++}var R=t;w=0;for(const e of t){k=g_world.getObjectById(e.SObjID);g_world.remove(k),w++}if(g_pog_json[y].ModuleInfo[e].Carpark.length>0&&void 0!==g_pog_json[y].ModuleInfo[e].Carpark[0]&&void 0!==g_pog_json[y].ModuleInfo[e].Carpark[0].ItemInfo&&g_pog_json[y].ModuleInfo[e].Carpark[0].ItemInfo.length>0)for(d of B=JSON.parse(JSON.stringify(g_pog_json[y].ModuleInfo[e].Carpark[0].ItemInfo))){k=g_world.getObjectById(d.ObjID);g_world.remove(k)}"Y"==l&&(g_pog_json[y].ModuleInfo[e].Carpark=[]);w=0;for(const o of R){var Y=-1;if("NOTCH"!==o.ObjType&&"BASE"!==o.ObjType){var A={};"Y"==l?("N"==a?(A.X=o.X,A.Y=o.Y,A.Z=o.Z,A.GrillH=o.GrillH,A.LOverhang=o.LOverhang,A.ROverhang=o.ROverhang,A.SpacerThick=o.SpacerThick,A.HorizGap=null!==o.HorizGap&&""!==o.HorizGap&&void 0!==o.HorizGap?o.HorizGap:0,A.SpreadItem=o.SpreadItem,A.Combine=o.Combine,A.AllowAutoCrush=o.AllowAutoCrush,A.HorizSlotStart=o.HorizSlotStart,A.HorizSlotSpacing=o.HorizSlotSpacing,A.HorizStart=o.HorizStart,A.HorizSpacing=o.HorizSpacing,A.UOverHang=o.UOverHang,A.LoOverHang=o.LoOverHang,A.VertiStart=o.VertiStart,A.VertiSpacing=o.VertiSpacing,A.BsktFill=o.BsktFill,A.BsktSpreadProduct=o.BsktSpreadProduct,A.SnapTo=o.SnapTo,A.BsktWallH=o.BsktWallH,A.BsktBaseH=o.BsktBaseH,A.BsktWallThickness=o.BsktWallThickness,A.DSlotStart=o.DSlotStart,A.DSlotSpacing=o.DSlotSpacing,A.DGap=o.DGap,A.FrontOverHang=o.FrontOverHang,A.BackOverHang=o.BackOverHang,A.SlotDivider=o.SlotDivider,A.AllowOverLap=o.AllowOverLap,A.AutoPlacing=void 0!==o.AutoPlacing&&""!==o.AutoPlacing?o.AutoPlacing:"",A.AutoFillPeg=void 0!==o.AutoFillPeg&&""!==o.AutoFillPeg?o.AutoFillPeg:"",A.AvlSpace=o.W+o.LOverhang+o.ROverhang,A.WrapText=o.WrapText,A.ReduceToFit=o.ReduceToFit,A.TextDirection=o.TextDirection,A.SlotOrientation=o.SlotOrientation,A.DividerFixed=o.DividerFixed,A.LObjID=o.LObjID,A.NotchLabelObjID=o.NotchLabelObjID,A.Shelf=o.Shelf,A.ObjType=o.ObjType,A.Desc=o.Desc,A.MaxMerch=o.MaxMerch,A.FStyle=o.FStyle,A.FSize=o.FSize,A.FBold=o.FBold,A.TextImg=o.TextImg,A.TextImgName=o.TextImgName,A.TextImgMime=o.TextImgMime,A.NotchNo=o.NotchNo,A.ManualCrush=void 0!==o.ManualCrush&&""!==o.ManualCrush?o.ManualCrush:W,A.Overhung=void 0===o.Overhung&&""!==o.Overhung?"N":o.Overhung,"BASE"==o.ObjType?(A.H=g_pog_json[y].BaseH,A.W=g_pog_json[y].BaseW,A.D=g_pog_json[y].BaseD,A.Color=g_pog_json[y].Color):"NOTCH"==o.ObjType?(A.H=g_pog_json[y].ModuleInfo[e].H,A.W=g_pog_json[y].ModuleInfo[e].NotchW,A.D=g_pog_json[y].ModuleInfo[e].D,A.Color=g_pog_json[y].ModuleInfo[e].Color):(A.H=o.H,A.W=o.W,A.D=o.D,void 0===o.Color||"#0"==o.Color?A.Color=g:A.Color=o.Color),A.Rotation=o.Rotation,A.Slope=o.Slope,A.LiveImage=o.LiveImage,A.InputText=o.InputText,A.CompShelfObjID=o.CompShelfObjID,A.ManualZupdate=o.ManualZupdate,A.OldObjID=o.SObjID,A.DivHeight=o.DivHeight,A.DivWidth=o.DivWidth,A.DivPst=o.DivPst,A.DivPed=o.DivPed,A.DivPbtwFace=o.DivPbtwFace,A.DivStX=isNaN(o.DivStX)?0:o.DivStX,A.DivSpaceX=isNaN(o.DivSpaceX)?0:o.DivSpaceX,A.DivFillCol=o.DivFillCol,A.NoDivIDShow=o.NoDivIDShow,A.ChestEdit=null!==o.ChestEdit&&""!==o.ChestEdit&&void 0!==o.ChestEdit?o.ChestEdit:"N",A.ItemInfo=[]):(A.Shelf=o.Shelf,A.ObjType="SHELF",A.Desc="CARPARK_SHELF",A.MaxMerch=0,A.GrillH=0,A.LOverhang=0,A.ROverhang=0,A.SpacerThick=0,A.HorizGap=0,A.SpreadItem="L",A.Combine="N",A.AllowAutoCrush="N",A.H=o.H,A.W=o.W,A.D=o.D,A.Rotation=0,A.Slope=0,A.Color=m,A.LiveImage="",A.HorizSlotStart=0,A.HorizSlotSpacing=0,A.HorizStart=0,A.HorizSpacing=0,A.UOverHang=0,A.LoOverHang=0,A.VertiStart=0,A.VertiSpacing=0,A.X=o.X,A.Y=o.Y,A.InputText="",A.WrapText="",A.ReduceToFit="",A.TextDirection="",A.BsktFill="",A.BsktSpreadProduct="",A.SnapTo="",A.BsktWallH=0,A.BsktBaseH=0,A.BsktWallThickness=0,A.DSlotStart=0,A.DSlotSpacing=0,A.DGap=0,A.FrontOverHang=0,A.BackOverHang=0,A.SlotDivider=I,A.AllowOverLap="N",A.AutoPlacing="N",A.AutoFillPeg="N",A.SlotOrientation=S,A.DividerFixed=D,A.LObjID=-1,A.NotchLabelObjID=-1,A.FStyle="",A.FSize="",A.FBold="",A.TextImg="",A.TextImgName="",A.TextImgMime="",A.TextImageBlob="",A.ItemInfo=[],A.Overhung="N",A.DivHeight=0,A.DivWidth=0,A.DivPst="N",A.DivPed="N",A.DivPbtwFace="N",A.NoDivIDShow="N",A.DivStX=0,A.DivSpaceX=0,A.DivFillCol=m),"NOTCH"!==o.ObjType&&"BASE"!==o.ObjType&&"N"==a?(g_pog_json[y].ModuleInfo[e].ShelfInfo.push(A),Y=g_pog_json[y].ModuleInfo[e].ShelfInfo.length-1):"Y"==a&&null!==o.ItemInfo&&o.ItemInfo.length>0&&(g_pog_json[y].ModuleInfo[e].Carpark.push(A),Y=0)):(A=o,Y=w);var z=A.X-A.W/2,L=parseInt(A.Color.replace("#","0x"),16),E=new THREE.Color(L),X=0;if(void 0===g_pog_json[y].ModuleInfo[e].ParentModule||null==g_pog_json[y].ModuleInfo[e].ParentModule&&"Y"==r)if("PEGBOARD"==A.ObjType)var V=add_pegboard(A.Shelf,A.W,A.H,A.D,E,A.X,A.Y,.004,"N",A.VertiStart,A.VertiSpacing,A.HorizStart,A.HorizSpacing,e,g_pog_json[y].ModuleInfo[e].ShelfInfo.length-1,A.Rotation,A.Slope,"N",O,c,h,_,T,P,M,y);else if("TEXTBOX"==A.ObjType){if("Y"==g_show_live_image&&""!==A.TextImg&&void 0!==A.TextImg&&null!==A.TextImg)V=await add_text_box_with_image(A.Shelf,"TEXTBOX",A.W,A.H,A.D,E,A.X,A.Y,A.Z,"N",e,A.InputText,L,A.WrapText,A.ReduceToFit,A.Color,g_pog_json[y].ModuleInfo[e].ShelfInfo.length-1,A.Rotation,A.Slope,"N",A.FStyle,A.FSize,A.FBold,F,y);else V=add_text_box(A.Shelf,"TEXTBOX",A.W,A.H,A.D,E,A.X,A.Y,A.Z,"N",e,A.InputText,L,A.WrapText,A.ReduceToFit,A.Color,g_pog_json[y].ModuleInfo[e].ShelfInfo.length-1,A.Rotation,A.Slope,"N",A.FStyle,A.FSize,A.FBold,C,y,g_pogcr_enhance_textbox_fontsize,o.TextDirection);mod_details=g_pog_json[y].ModuleInfo;var G=0;for(const e of mod_details)void 0!==e.ParentModule&&null!==e.ParentModule&&e.Module==A.Shelf&&(g_pog_json[y].ModuleInfo[G].ObjID=V),G+=1}else if("ROD"==A.ObjType)V=add_rod(A.Shelf,"SHELF",A.W,A.H,A.D,E,A.X,A.Y,.004,"N",e,g_pog_json[y].ModuleInfo[e].ShelfInfo.length-1,y);else if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&(void 0===g_pog_json[y].ModuleInfo[e].ParentModule||null==g_pog_json[y].ModuleInfo[e].ParentModule)&&("Y"==a&&null!==o.ItemInfo&&o.ItemInfo.length>0||"N"==a)){"BASKET"==A.ObjType||"CHEST"==A.ObjType?"Y"==g_chest_as_pegboard&&"CHEST"==A.ObjType?(X=A.D,A.H=A.D):(X=A.BsktBaseH,A.H=A.BsktBaseH):X=A.H;var[V,U]=await add_shelf(A.Shelf,"SHELF",A.W,X,A.D,E,A.X,A.Y,.004,"N",e,A.Rotation,A.Slope,Y,"N",a,"Y",-1,u,F,O,c,h,_,T,P,M,y,t);if(b=V,"Y"==j)updateObjID(A.OldObjID,V,"S")}if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType&&(void 0===g_pog_json[y].ModuleInfo[e].ParentModule||null==g_pog_json[y].ModuleInfo[e].ParentModule)&&void 0!==t[w].ItemInfo&&null!==t[w].ItemInfo&&t[w].ItemInfo.length>0){if("Y"==a)Z=B;else var Z=o.ItemInfo;if(Z.sort(((e,t)=>e.X>t.X?1:-1)),"Y"==a){var Q=g_pog_json[y].ModuleInfo[e].Carpark[Y].ItemInfo;for(d of Q){k=g_world.getObjectById(d.ObjID);g_world.remove(k)}}var K=0;for(items of Z){k=g_world.getObjectById(items.ObjID);g_world.remove(k);var J={};if("Y"==l){if("Y"!==a){if(J.DimT=items.DimT,J.PegID=items.PegID,J.PegSpread=items.PegSpread,J.PegPerFacing=items.PegPerFacing,J.Fixed=items.Fixed,J.CapStyle=items.CapStyle,J.CapFacing=items.CapFacing,J.CapMerch=items.CapMerch,J.CapOrientaion=items.CapOrientaion,J.CapHeight=items.CapHeight,J.CapHorz=items.CapHorz,J.CapDepth=items.CapDepth,J.CapTotalCount=items.CapTotalCount,J.CapMaxH=items.CapMaxH,J.MaxHCapStyle=items.MaxHCapStyle,J.Rotation=items.Rotation,J.BaseD=items.BaseD,J.CrushHoriz=void 0!==items.CrushHoriz?items.CrushHoriz:"",J.CrushVert=void 0!==items.CrushVert?items.CrushVert:"",J.CrushD=void 0!==items.CrushD?items.CrushD:"",J.Price=items.Price,J.Cost=items.Cost,J.RegMovement=items.RegMovement,J.RegMovementInd=void 0!==items.RegMovementInd?items.RegMovementInd:"",J.DaysOfSupplyInd=void 0!==items.DaysOfSupplyInd?items.DaysOfSupplyInd:"",J.AvgSales=void 0!==items.AvgSales?Math.floor(100*items.AvgSales)/100:"",J.AvgSalesInd=void 0!==items.AvgSalesInd?items.AvgSalesInd:"",J.ItemStatus=void 0!==items.ItemStatus?items.ItemStatus:"",J.CDTLvl1=void 0!==items.CDTLvl1?items.CDTLvl1:"",J.CDTLvl2=void 0!==items.CDTLvl2?items.CDTLvl2:"",J.CDTLvl3=void 0!==items.CDTLvl3?items.CDTLvl3:"",J.DPPLoc=items.DPPLoc,J.ActualDPP=void 0!==items.ActualDPP?items.ActualDPP:"",J.StoreSOH=void 0!==items.StoreSOH?items.StoreSOH:"",J.StoreNo=void 0!==items.StoreNo?items.StoreNo:"",J.WeeksOfInventory=void 0!==items.WeeksOfInventory?items.WeeksOfInventory:"",J.ShelfPrice=void 0!==items.ShelfPrice?items.ShelfPrice:"",J.PromoPrice=void 0!==items.PromoPrice?items.PromoPrice:"",J.DiscountRate=void 0!==items.DiscountRate?items.DiscountRate:"",J.PriceChangeDate=void 0!==items.PriceChangeDate?items.PriceChangeDate:"",J.WeeksOfInventory=void 0!==items.WeeksOfInventory?items.WeeksOfInventory:"",J.Qty=void 0!==items.Qty?items.Qty:"",J.WhStock=void 0!==items.WhStock?items.WhStock:"",J.StoreStock=void 0!==items.StoreStock?items.StoreStock:"",J.StockIntransit=void 0!==items.StockIntransit?items.StockIntransit:"",J.MoveBasis=items.MoveBasis,J.ItemNesting=items.ItemNesting,J.NVal=items.NVal,J.ItemContain=items.ItemContain,J.CnVal=items.CnVal,J.IsContainer=items.IsContainer,J.BsktFactor=items.BsktFactor,J.OverHang=items.OverHang,J.VertGap=items.VertGap,J.OW=items.OW,J.OH=items.OH,J.OD=items.OD,J.Quantity=items.Quantity,J.Dragged=items.Dragged,J.SpreadItem=items.SpreadItem,J.MHorizCrushed=items.MHorizCrushed,J.MVertCrushed=items.MVertCrushed,J.MDepthCrushed=items.MDepthCrushed,J.MCapTopFacing=items.MCapTopFacing,J.RW=items.RW,J.RH=items.RH,J.RD=items.RD,J.LObjID=items.LObjID,J.SubLblObjID=items.SubLblObjID,J.DimUpdate=items.DimUpdate,J.SlotDivider=items.SlotDivider,J.CapCount=items.CapCount,J.X=items.X,J.Y=items.Y,J.Z=items.Z,J.BHoriz=items.BHoriz,J.BVert=items.BVert,J.W=items.W,J.H=items.H,J.ItemID=items.ItemID,J.Item=items.Item,J.D=items.D,void 0===items.Color||null==items.Color?J.Color=f:J.Color=items.Color,J.Desc=items.Desc,J.Barcode=items.Barcode,J.LocID=items.LocID,J.Orientation=items.Orientation,J.MerchStyle=items.MerchStyle,J.Supplier=void 0===items.Supplier||null==items.Supplier?"":items.Supplier.split("-")[1],J.Brand=items.Brand,J.BrandType=items.BrandType,J.Group=items.Group,J.Dept=items.Dept,J.Class=items.Class,J.SubClass=items.SubClass,J.StdUOM=items.StdUOM,J.SizeDesc=void 0===items.SizeDesc||null==items.SizeDesc?"":items.SizeDesc,J.HorizGap=items.HorizGap,J.UW=items.UW,J.UH=items.UH,J.UD=items.UD,J.CW=items.CW,J.CH=items.CH,J.CD=items.CD,J.TW=items.TW,J.TH=items.TH,J.TD=items.TD,J.DW=items.DW,J.DH=items.DH,J.DD=items.DD,J.CWPerc=items.CWPerc,J.CHPerc=items.CHPerc,J.CDPerc=items.CDPerc,J.CnW=items.CnW,J.CnH=items.CnH,J.CnD=items.CnD,J.NW=items.NW,J.NH=items.NH,J.ND=items.ND,J.OldCnW=items.CnW,J.OldCnH=items.CnH,J.OldCnD=items.CnD,J.OldNW=items.NW,J.OldNH=items.NH,J.OldND=items.ND,J.OrgUW=items.OrgUW,J.OrgUH=items.OrgUH,J.OrgUD=items.OrgUD,J.OrgCW=items.OrgCW,J.OrgCH=items.OrgCH,J.OrgCD=items.OrgCD,J.OrgTW=items.OrgTW,J.OrgTH=items.OrgTH,J.OrgTD=items.OrgTD,J.OrgDW=items.OrgDW,J.OrgDH=items.OrgDH,J.OrgDD=items.OrgDD,J.OrgCWPerc=items.OrgCWPerc,J.OrgCHPerc=items.OrgCHPerc,J.OrgCDPerc=items.OrgCDPerc,J.OrgCnW=items.OrgCnW,J.OrgCnH=items.OrgCnH,J.OrgCnD=items.OrgCnD,J.OrgNW=items.OrgNW,J.OrgNH=items.OrgNH,J.OrgND=items.OrgND,J.TopObjID=items.TopObjID,J.BottomObjID=items.BottomObjID,J.SecondTier=items.SecondTier,J.CompItemObjID=items.CompItemObjID,J.SellingPrice=parseFloat(nvl(items.SellingPrice)),"undefined"!==items.SalesUnit){var $=parseFloat(nvl(items.SalesUnit));J.SalesUnit=Math.floor(100*$)/100}else J.SalesUnit="";J.NetSales=parseFloat(nvl(items.NetSales)),J.CogsAdj=items.CogsAdj,J.CogsAdjInd=void 0!==items.CogsAdjInd?items.CogsAdjInd:"",J.GrossProfit=items.GrossProfit,J.GrossProfitInd=void 0!==items.GrossProfitInd?items.GrossProfitInd:"",J.MovingItem=items.MovingItem,J.WeeksCount=items.WeeksCount,J.WeeksCountInd=void 0!==items.WeeksCountInd?items.WeeksCountInd:"",J.Profit=parseFloat(nvl(items.Profit)),J.GoGreen=items.GoGreen,J.TotalMargin=parseFloat(nvl(items.TotalMargin)),J.MHorizFacings=void 0===items.MHorizFacings||null==items.MHorizFacings?-1:parseInt(items.MHorizFacings),J.MVertFacings=void 0===items.MVertFacings||null==items.MVertFacings?-1:parseInt(items.MVertFacings),J.MDepthFacings=void 0===items.MDepthFacings||null==items.MDepthFacings?-1:parseInt(items.MDepthFacings),J.Status=items.Status,J.OrientationDesc=items.OrientationDesc,J.StoreCnt=items.StoreCnt,J.NewYN="",J.Delist=items.Delist,J.ImgExists=items.ImgExists,J.Exists="E",J.OldObjID=items.ObjID,J.DescSecond=items.DescSecond,J.OverhungItem=void 0===items.OverhungItem?"N":items.OverhungItem,J.CapDepthChanged="N",J.Brand=items.Brand,J.ItmDescChi=items.ItmDescChi,(q=items.SizeDesc.split("*")).length>1?J.ItmDescEng=items.Brand+" "+items.Desc+" "+parseInt(q[0])/parseInt(q[1])+"*"+q[1]+"*"+q[2]:J.ItmDescEng=items.Brand+" "+items.Desc,J.PkSiz=parseInt(q[1]),J.Brand_Category=void 0!==items.Brand_Category?items.Brand_Category:"",J.ItemSize=void 0!==items.ItemSize?items.ItemSize:"",J.Categ=void 0!==items.Categ?items.Categ:"",J.Uda_item_status=void 0!==items.Uda_item_status?items.Uda_item_status:"",J.Gobecobrand=void 0!==items.Gobecobrand?items.Gobecobrand:"",J.InternationalRng=void 0!==items.InternationalRng?items.InternationalRng:"",J.EDLP=void 0!==items.EDLP?items.EDLP:"",J.LoGrp=void 0!==items.LoGrp?items.LoGrp:"",J.COO=void 0!==items.COO?items.COO:"",J.UDA751=void 0!==items.UDA751?items.UDA751:"",J.UDA755=void 0!==items.UDA755?items.UDA755:"",J.MPogDepthFacings=void 0!==items.MPogDepthFacings?items.MPogDepthFacings:"",J.MPogHorizFacings=void 0!==items.MPogHorizFacings?items.MPogHorizFacings:"",J.MPogVertFacings=void 0!==items.MPogVertFacings?items.MPogVertFacings:"",J.ItemCondition=0!=nvl(items.ItemCondition)?items.ItemCondition:"",J.AUR=0!=nvl(items.AUR)?items.AUR:"",J.ItemRanking=0!=nvl(items.ItemRanking)?items.ItemRanking:"",J.WeeklySales=0!=nvl(items.WeeklySales)?items.WeeklySales:"",J.WeeklyNetMargin=0!=nvl(items.WeeklyNetMargin)?items.WeeklyNetMargin:"",J.WeeklyQty=0!=nvl(items.WeeklyQty)?items.WeeklyQty:"",J.NetMarginPercent=void 0!==items.NetMarginPercent?items.NetMarginPercent:void 0!==items.NetMarginPerc?NetMarginPerc:"",J.CumulativeNM=0!=nvl(items.CumulativeNM)?items.CumulativeNM:"",J.TOP80B2=0!=nvl(items.TOP80B2)?items.TOP80B2:"",J.ItemBrandC=0!=nvl(items.ItemBrandC)?items.ItemBrandC:"",J.ItemPOGDept=0!=nvl(items.ItemPOGDept)?items.ItemPOGDept:"",J.ItemRemark=0!=nvl(items.ItemRemark)?items.ItemRemark:"",J.RTVStatus=0!=nvl(items.RTVStatus)?items.RTVStatus:"",J.Pusher=0!=nvl(items.Pusher)?items.Pusher:"",J.Divider=0!=nvl(items.Divider)?items.Divider:"",J.BackSupport=0!=nvl(items.BackSupport)?items.BackSupport:"",J.OOSPerc=nvl(items.OOSPerc),J.InitialItemDesc=void 0!==items.InitialItemDesc?items.InitialItemDesc:"",J.InitialBrand=void 0!==items.InitialBrand?items.InitialBrand:"",J.InitialBarcode=void 0!==items.InitialBarcode?items.InitialBarcode:"",J.Distance=wpdSetFixed(nvl(items.Distance))}else{if("N"==n&&"F"==s?(J.DimT=items.MerchStyle,J.PegID="",J.PegSpread="",J.PegPerFacing="",J.Fixed="N",J.CapStyle="0",J.CapFacing="",J.CapMerch="",J.CapOrientaion="",J.CapHeight="",J.CapHorz="",J.CapDepth="",J.CapTotalCount="",J.CapMaxH=0,J.MaxHCapStyle="3",J.Rotation=0,J.CrushHoriz=0,J.CrushVert=0,J.CrushD=0,J.Price="",J.Cost="",J.RegMovement="",J.RegMovementInd=void 0!==items.RegMovementInd?items.RegMovementInd:"",J.DaysOfSupplyInd=void 0!==items.DaysOfSupplyInd?items.DaysOfSupplyInd:"",J.AvgSales=void 0!==items.AvgSales?Math.floor(100*items.AvgSales)/100:"",J.ItemStatus=void 0!==items.ItemStatus?items.ItemStatus:"",J.CDTLvl1="",J.CDTLvl2="",J.CDTLvl3="",J.ActualDPP="",J.DPPLoc="",J.StoreSOH="",J.StoreNo="",J.WeeksOfInventory="",J.ShelfPrice="",J.PromoPrice="",J.DiscountRate="",J.PriceChangeDate="",J.WeeksOfInventory="",J.Qty="",J.WhStock="",J.StoreStock="",J.StockIntransit="",J.MoveBasis="",J.IsContainer="N",J.BsktFactor=0,J.OverHang=0,J.VertGap=0,J.BHoriz=null==items.BHoriz?1:items.BHoriz,J.BVert=null==items.BVert?1:items.BVert,J.BaseD=null==items.BaseD?1:items.BaseD,J.W=items.W,J.H=items.H,J.D=items.D,"BASKET"==A.ObjType?(J.W=A.W,J.H=items.D*items.Quantity,J.D=items.D*J.BaseD,J.RW=items.W,J.RH=items.H,J.RD=items.D):(J.W=J.W*J.BHoriz,J.H=J.H*J.BVert,J.D=J.D*J.BaseD,J.RW=J.W,J.RH=J.H,J.RD=J.D),J.OW=items.W,J.OH=items.H,J.OD=items.D,J.LObjID=items.LObjID,J.SubLblObjID=items.SubLblObjID,J.Dragged="N",J.SpreadItem=0,J.MHorizCrushed="N",J.MVertCrushed="N",J.MDepthCrushed="N",J.MCapTopFacing="N",J.X=items.X,J.Y=A.Y+A.H/2+J.H/2,J.Z=items.Z,J.SlotDivider="N",J.CapCount=0,J.Distance=J.X-J.W/2-z,"PEGBOARD"==A.ObjType&&(J.PegBoardX=J.X-J.W/2-z,J.PegBoardY=J.Y-J.H/2-(A.Y-A.H/2))):(J.DimT=items.DimT,J.PegID=items.PegID,J.PegSpread=items.PegSpread,J.PegPerFacing=items.PegPerFacing,J.Fixed=items.Fixed,J.CapStyle=items.CapStyle,J.CapFacing=items.CapFacing,J.CapMerch=items.CapMerch,J.CapOrientaion=items.CapOrientaion,J.CapHeight=items.CapHeight,J.CapHorz=items.CapHorz,J.CapDepth=items.CapDepth,J.CapTotalCount=items.CapTotalCount,J.CapMaxH=void 0!==items.CapMaxH?items.CapMaxH:0,J.MaxHCapStyle=void 0!==items.MaxHCapStyle?items.MaxHCapStyle:"3",J.Rotation=items.Rotation,J.CrushHoriz=items.CrushHoriz,J.CrushVert=items.CrushVert,J.CrushD=items.CrushD,J.Price=items.Price,J.Cost=items.Cost,J.RegMovement=items.RegMovement,J.RegMovementInd=void 0!==items.RegMovementInd?items.RegMovementInd:"",J.DaysOfSupplyInd=void 0!==items.DaysOfSupplyInd?items.DaysOfSupplyInd:"",J.AvgSales=void 0!==items.AvgSales?Math.floor(100*items.AvgSales)/100:"",J.ItemStatus=void 0!==items.ItemStatus?items.ItemStatus:"",J.CDTLvl1=void 0!==items.CDTLvl1?items.CDTLvl1:"",J.CDTLvl2=void 0!==items.CDTLvl2?items.CDTLvl2:"",J.CDTLvl3=void 0!==items.CDTLvl3?items.CDTLvl3:"",J.ActualDPP=void 0!==items.ActualDPP?items.ActualDPP:"",J.DPPLoc=items.DPPLoc,J.StoreSOH=void 0!==items.StoreSOH?items.StoreSOH:"",J.StoreNo=void 0!==items.StoreNo?items.StoreNo:"",J.WeeksOfInventory=void 0!==items.WeeksOfInventory?items.WeeksOfInventory:"",J.ShelfPrice=void 0!==items.ShelfPrice?items.ShelfPrice:"",J.PromoPrice=void 0!==items.PromoPrice?items.PromoPrice:"",J.DiscountRate=void 0!==items.DiscountRate?items.DiscountRate:"",J.PriceChangeDate=void 0!==items.PriceChangeDate?items.PriceChangeDate:"",J.WeeksOfInventory=void 0!==items.WeeksOfInventory?items.WeeksOfInventory:"",J.Qty=void 0!==items.Qty?items.Qty:"",J.WhStock=void 0!==items.WhStock?items.WhStock:"",J.StoreStock=void 0!==items.StoreStock?items.StoreStock:"",J.StockIntransit=void 0!==items.StockIntransit?items.StockIntransit:"",J.MoveBasis=items.MoveBasis,J.IsContainer=items.IsContainer,J.BsktFactor=items.BsktFactor,J.OverHang=items.OverHang,J.VertGap=items.VertGap,J.OW=items.OW,J.OH=items.OH,J.OD=items.OD,J.Dragged=items.Dragged,J.SpreadItem=items.SpreadItem,J.MHorizCrushed=items.MHorizCrushed,J.MVertCrushed=items.MVertCrushed,J.MDepthCrushed=items.MDepthCrushed,J.MCapTopFacing=items.MCapTopFacing,J.RW=items.RW,J.RH=items.RH,J.RD=items.RD,J.LObjID=items.LObjID,J.SubLblObjID=items.SubLblObjID,J.SlotDivider=items.SlotDivider,J.CapCount=items.CapCount,J.X=items.X,J.Y=items.Y,"HANGINGBAR"==A.ObjType?J.Y=A.Y-items.H/2:J.Y=items.Y,J.BHoriz=items.BHoriz,J.BVert=items.BVert,J.BaseD=items.BaseD,J.W=items.W,J.H=items.H,J.D=items.D,J.Distance=items.Distance,J.PegBoardX=items.PegBoardX,J.PegBoardY=items.PegBoardY),J.Z=0==items.Z?items.Z+items.D/2:items.Z,J.Quantity=items.Quantity,J.ItemID=items.ItemID,J.Item=items.Item,void 0===items.Color||null==items.Color?J.Color=f:J.Color=items.Color,J.Desc=items.Desc,J.Barcode=items.Barcode,J.LocID=items.LocID,J.Orientation=items.Orientation,J.MerchStyle=null==items.MerchStyle||void 0===items.MerchStyle||""==items.MerchStyle?"0":items.MerchStyle,J.Supplier=items.Supplier,J.Brand=items.Brand,J.BrandType=items.BrandType,J.Group=items.Group,J.Dept=items.Dept,J.Class=items.Class,J.SubClass=items.SubClass,J.StdUOM=items.StdUOM,J.SizeDesc=void 0===items.SizeDesc||null==items.SizeDesc?"":items.SizeDesc,J.HorizGap=items.HorizGap,J.UW=items.UW,J.UH=items.UH,J.UD=items.UD,J.CW=items.CW,J.CH=items.CH,J.CD=items.CD,J.TW=items.TW,J.TH=items.TH,J.TD=items.TD,J.DW=items.DW,J.DH=items.DH,J.DD=items.DD,J.CWPerc=items.CWPerc,J.CHPerc=items.CHPerc,J.CDPerc=items.CDPerc,J.TopObjID=items.TopObjID,J.BottomObjID=items.BottomObjID,J.SecondTier=items.SecondTier,J.CompItemObjID=items.CompItemObjID,J.SellingPrice=parseFloat(nvl(items.SellingPrice)),"undefined"!==items.SalesUnit){$=parseFloat(nvl(items.SalesUnit));J.SalesUnit=Math.floor(100*$)/100}else J.SalesUnit="";var q;J.NetSales=parseFloat(nvl(items.NetSales)),J.CogsAdj=items.CogsAdj,J.CogsAdjInd=void 0!==items.CogsAdjInd?items.CogsAdjInd:"",J.GrossProfit=items.GrossProfit,J.GrossProfitInd=void 0!==items.GrossProfitInd?items.GrossProfitInd:"",J.WeeksCount=items.WeeksCount,J.WeeksCountInd=void 0!==items.WeeksCountInd?items.WeeksCountInd:"",J.MovingItem=items.MovingItem,J.RegMovement=items.RegMovement,J.RegMovementInd=void 0!==items.RegMovementInd?items.RegMovementInd:"",J.DaysOfSupplyInd=void 0!==items.DaysOfSupplyInd?items.DaysOfSupplyInd:"",J.AvgSales=void 0!==items.AvgSales?Math.floor(100*items.AvgSales)/100:"",J.AvgSalesInd=void 0!==items.AvgSalesInd?items.AvgSalesInd:"",J.ItemStatus=void 0!==items.ItemStatus?items.ItemStatus:"",J.CDTLvl1=void 0!==items.CDTLvl1?items.CDTLvl1:"",J.CDTLvl2=void 0!==items.CDTLvl2?items.CDTLvl2:"",J.CDTLvl3=void 0!==items.CDTLvl3?items.CDTLvl3:"",J.ActualDPP=void 0!==items.ActualDPP?items.ActualDPP:"",J.DPPLoc=items.DPPLoc,J.StoreSOH=void 0!==items.StoreSOH?items.StoreSOH:"",J.StoreNo=void 0!==items.StoreNo?items.StoreNo:"",J.WeeksOfInventory=void 0!==items.WeeksOfInventory?items.WeeksOfInventory:"",J.ShelfPrice=void 0!==items.ShelfPrice?items.ShelfPrice:"",J.PromoPrice=void 0!==items.PromoPrice?items.PromoPrice:"",J.DiscountRate=void 0!==items.DiscountRate?items.DiscountRate:"",J.PriceChangeDate=void 0!==items.PriceChangeDate?items.PriceChangeDate:"",J.WeeksOfInventory=void 0!==items.WeeksOfInventory?items.WeeksOfInventory:"",J.Qty=void 0!==items.Qty?items.Qty:"",J.WhStock=void 0!==items.WhStock?items.WhStock:"",J.StoreStock=void 0!==items.StoreStock?items.StoreStock:"",J.StockIntransit=void 0!==items.StockIntransit?items.StockIntransit:"",J.Profit=parseFloat(nvl(items.Profit)),J.TotalMargin=parseFloat(nvl(items.TotalMargin)),J.MHorizFacings=parseInt(items.MHorizFacings),J.MVertFacings=parseInt(items.MVertFacings),J.MDepthFacings=parseInt(items.MDepthFacings),J.Status=items.Status,J.Cost=items.Cost,J.Price=items.Price,J.DaysOfSupply=items.DaysOfSupply,J.ShowColorBackup=items.ShowColorBackup,J.OrientationDesc=items.OrientationDesc,J.StoreCnt=items.StoreCnt,J.NewYN="",J.DescSecond=items.DescSecond,J.Delist=void 0===items.Delist?"N":items.Delist,J.OverhungItem=void 0===items.OverhungItem?"N":items.OverhungItem,"Y"==J.Delist&&(J.Color=v),void 0===items.CnW?J.CnW=0:J.CnW=items.CnW,void 0===items.CnH?J.CnH=0:J.CnH=items.CnH,void 0===items.CnD?J.CnD=0:J.CnD=items.CnD,void 0===items.NW?J.NW=0:J.NW=items.NW,void 0===items.NH?J.NH=0:J.NH=items.NH,void 0===items.ND?J.ND=0:J.ND=items.ND,J.ItemNesting=items.ItemNesting,J.NVal="H"==J.ItemNesting?items.NH:"W"==J.ItemNesting?items.NW:"D"==J.ItemNesting?items.ND:0,J.ItemContain=items.ItemContain,J.CnVal="H"==J.ItemContain?items.CnH:"W"==J.ItemContain?items.CnW:"D"==J.ItemContain?items.CnD:0,J.OldCnW=J.CnW,J.OldCnH=J.CnH,J.OldCnD=J.CnD,J.OldNW=J.NW,J.OldNH=J.NH,J.OldND=J.ND,J.OrgUW=items.OrgUW,J.OrgUH=items.OrgUH,J.OrgUD=items.OrgUD,J.OrgCW=items.OrgCW,J.OrgCH=items.OrgCH,J.OrgCD=items.OrgCD,J.OrgTW=items.OrgTW,J.OrgTH=items.OrgTH,J.OrgTD=items.OrgTD,J.OrgDW=items.OrgDW,J.OrgDH=items.OrgDH,J.OrgDD=items.OrgDD,J.OrgCWPerc=items.OrgCWPerc,J.OrgCHPerc=items.OrgCHPerc,J.OrgCDPerc=items.OrgCDPerc,J.OrgCnW=items.OrgCnW,J.OrgCnH=items.OrgCnH,J.OrgCnD=items.OrgCnD,J.OrgNW=items.OrgNW,J.OrgNH=items.OrgNH,J.OrgND=items.OrgND,J.ImgExists=items.ImgExists,J.Exists="E",J.DimUpdate="N",J.ItemImage=items.ItemImage,J.Edited="Y",J.OldObjID=items.ObjID,J.Brand=items.Brand,J.ItmDescChi=items.ItmDescChi,(q=items.SizeDesc.split("*")).length>1?J.ItmDescEng=items.Brand+" "+items.Desc+" "+parseInt(q[0])/parseInt(q[1])+"*"+q[1]+"*"+q[2]:J.ItmDescEng=items.Brand+" "+items.Desc,J.PkSiz=parseInt(q[1]),J.Brand_Category=void 0!==items.Brand_Category?items.Brand_Category:"",J.ItemSize=void 0!==items.ItemSize?items.ItemSize:"",J.Categ=void 0!==items.Categ?items.Categ:"",J.Uda_item_status=void 0!==items.Uda_item_status?items.Uda_item_status:"",J.Gobecobrand=void 0!==items.Gobecobrand?items.Gobecobrand:"",J.InternationalRng=void 0!==items.InternationalRng?items.InternationalRng:"",J.EDLP=void 0!==items.EDLP?items.EDLP:"",J.LoGrp=void 0!==items.LoGrp?items.LoGrp:"",J.COO=void 0!==items.COO?items.COO:"",J.UDA751=void 0!==items.UDA751?items.UDA751:"",J.UDA755=void 0!==items.UDA755?items.UDA755:"",J.MPogDepthFacings=void 0!==items.MPogDepthFacings?items.MPogDepthFacings:"",J.MPogHorizFacings=void 0!==items.MPogHorizFacings?items.MPogHorizFacings:"",J.MPogVertFacings=void 0!==items.MPogVertFacings?items.MPogVertFacings:"",J.Internet=void 0!==items.Internet?items.Internet:"",J.SplrLbl=void 0!==items.SplrLbl?items.SplrLbl:"",J.ItemCondition=0!=nvl(items.ItemCondition)?items.ItemCondition:"",J.AUR=0!=nvl(items.AUR)?items.AUR:"",J.ItemRanking=0!=nvl(items.ItemRanking)?items.ItemRanking:"",J.WeeklySales=0!=nvl(items.WeeklySales)?items.WeeklySales:"",J.WeeklyNetMargin=0!=nvl(items.WeeklyNetMargin)?items.WeeklyNetMargin:"",J.WeeklyQty=0!=nvl(items.WeeklyQty)?items.WeeklyQty:"",J.NetMarginPercent=void 0!==items.NetMarginPercent?items.NetMarginPercent:void 0!==items.NetMarginPerc?items.NetMarginPerc:"",J.CumulativeNM=0!=nvl(items.CumulativeNM)?items.CumulativeNM:"",J.TOP80B2=0!=nvl(items.TOP80B2)?items.TOP80B2:"",J.ItemBrandC=0!=nvl(items.ItemBrandC)?items.ItemBrandC:"",J.ItemPOGDept=0!=nvl(items.ItemPOGDept)?items.ItemPOGDept:"",J.ItemRemark=0!=nvl(items.ItemRemark)?items.ItemRemark:"",J.RTVStatus=0!=nvl(items.RTVStatus)?items.RTVStatus:"",J.Pusher=0!=nvl(items.Pusher)?items.Pusher:"",J.Divider=0!=nvl(items.Divider)?items.Divider:"",J.BackSupport=0!=nvl(items.BackSupport)?items.BackSupport:"",J.OOSPerc=nvl(items.OOSPerc),J.InitialItemDesc=void 0!==items.InitialItemDesc?items.InitialItemDesc:"",J.InitialBrand=void 0!==items.InitialBrand?items.InitialBrand:"",J.InitialBarcode=void 0!==items.InitialBarcode?items.InitialBarcode:""}"Y"!==a?g_pog_json[y].ModuleInfo[e].ShelfInfo[Y].ItemInfo.push(J):g_pog_json[y].ModuleInfo[e].Carpark[Y].ItemInfo.push(J)}else J=items;if("DIVIDER"==J.Item&&"Y","Y"==r){if("Y"==a)var ee=await add_carpark_item(J.ItemID,J.W,J.H,J.D,J.Color,J.X,J.Y,J.Z,e,Y,K,"Y","N",g_show_live_image,"",y);else if("Y"==g_show_live_image&&3!=items.MerchStyle){var te=g_orientation_json[items.Orientation].split("###");ee=await add_items_with_image(J.ItemID,J.W,J.H,J.D,J.Color,J.X,J.Y,J.Z,e,Y,K,J.BHoriz,J.BVert,J.Item,parseInt(te[0]),parseInt(te[1]),"N","N",c,h,_,T,P,M,y)}else ee=await add_items_prom(J.ItemID,J.W,J.H,J.D,J.Color,J.X,J.Y,J.Z,e,Y,K,"N","N",O,H,M,T,P,y);if("N"==J.Status)(k=g_world.getObjectById(ee)).BorderColour=g_status_error_color,k.Status="N",k.WireframeObj.material.color.setHex(k.BorderColour);"N"==a?(g_pog_json[y].ModuleInfo[e].ShelfInfo[Y].ItemInfo[K].Z=.025,g_pog_json[y].ModuleInfo[e].ShelfInfo[Y].ItemInfo[K].ObjID=ee,g_pog_json[y].ModuleInfo[e].ShelfInfo[Y].ItemInfo[K].CType=A.ObjType):(g_pog_json[y].ModuleInfo[e].Carpark[Y].ItemInfo[K].Z=.025,g_pog_json[y].ModuleInfo[e].Carpark[Y].ItemInfo[K].ObjID=ee,g_pog_json[y].ModuleInfo[e].Carpark[Y].ItemInfo[K].CType=A.ObjType)}K+=1}if("N"==a){Z=g_pog_json[y].ModuleInfo[e].ShelfInfo[Y].ItemInfo;for(const e of Z)if(void 0!==e.TopObjID&&""!==e.TopObjID||void 0!==e.BottomObjID&&""!==e.BottomObjID){var oe;oe=""!==e.TopObjID&&void 0!==e.TopObjID?"BOTTOM":"TOP";reset_top_bottom_obj_id(oe,e.OldObjID,e.ObjID,e.X,"N",y)}}}}w+=1}}return logDebug("function : create_shelf_edit_pog_lib","E"),b}}catch(e){error_handling(e)}}async function add_shelf(e,t,o,i,n,s,a,r,l,d,p,g,m,I,S,D,f,v,u,C,c,h,_,O,H,M,T,P,F=g_pog_json){logDebug("function : add_shelf; uuid : "+e+"; type : "+t+"; width : "+o+"; height : "+i+"; depth : "+n+"; color : "+s+"; x : "+a+"; y : "+r+"; z : "+l+"; p_edit_ind : "+d+"; mod_index : "+p+"; rotation : "+g+"; slope : "+m+"; shelf_ind : "+I+"; recreate : "+S+"; carpark_ind : "+D+"; shelf_edit : "+f,"S");try{"Y"==D&&(s=u),0!==g||0!==m||(n=.001);var j,N,y=0;if(v=void 0===v?-1:v,"undefined"!=typeof g_module_width&&""!=g_module_width||(g_module_width=parseFloat(g_pog_json[P].ModuleInfo[p].W)),"Y"==d){var x=g_world.getObjectById(g_dblclick_objid);g_world.remove(x),j=I}else j=-1!==I?I:parseFloat(g_pog_json[P].ModuleInfo[p].ShelfInfo.length)-1;var W=g_pog_json[P].ModuleInfo[p].ShelfInfo[j];if("N"==D?(N=W.ObjType,y=W.AvlSpace):(y=g_pog_json[P].ModuleInfo[p].Carpark[0].AvlSpace,N="SHELF"),0==g&&0==m){g=0,m=0;var b=new THREE.Mesh(new THREE.BoxGeometry(o,i,n),new THREE.MeshStandardMaterial({color:s})),B=add_wireframe(b,2);if("N"==D)var w=W;else w=g_pog_json[P].ModuleInfo[p].Carpark[j];b.WFrameID=B,b.position.x=a,b.position.y=r,"N"==D&&isShelfOnPegboard(a,r,p,P,w,F)?b.position.z=.004:b.position.z=9e-4,b.uuid=e,b.POGCode=g_pog_json[P].POGCode,b.Version=g_pog_json[P].Version,b.X=wpdSetFixed(100*w.X-100*w.W/2),"Y"==w.EditNotch?b.Y=wpdSetFixed(100*w.EditNotchY):b.Y=wpdSetFixed(100*w.Y-100*w.H/2),b.Z=wpdSetFixed(100*w.Z-100*w.D/2),b.NotchNo=w.NotchNo,b.Desc=w.Desc,b.FixelID=w.Shelf,b.Module=g_pog_json[P].ModuleInfo[p].Module,b.W=w.W,b.H=w.H,b.D=w.D,b.ROverhang=w.ROverhang,b.LOverhang=w.LOverhang,b.Color=w.Color,b.Rotation=g,b.ItemSlope=m,b.RotationFlag=0!==g||0!==m?"Y":"N",b.ImageExists="N","SHELF"==N&&(b.AvlSpace=wpdSetFixed(nvl(y))),g_world.add(b),"N"==D?(W.WFrameID=B,"Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&g_edit_pallet_shelfid==W.SObjID&&(g_pog_json[P].ModuleInfo[0].ShelfInfo[0]=JSON.parse(JSON.stringify(W)),g_pog_json[P].ModuleInfo[0].ShelfInfo[0].PrimeShelfObjID=parseInt(b.id)),W.SObjID=parseInt(b.id)):(g_pog_json[P].ModuleInfo[p].Carpark[j].WFrameID=B,g_pog_json[P].ModuleInfo[p].Carpark[j].SObjID=parseInt(b.id))}else{g_rotation=g,m=m>0?0-m:-m,g_slope=m;b=new THREE.Mesh(new THREE.BoxGeometry(o,i,n),new THREE.MeshBasicMaterial({color:s})),B=add_wireframe(b,2);b.WFrameID=B;var k=0;if("Y"==S&&"N"==d){for(const e of g_pog_json[P].ModuleInfo)null==e.ParentModule&&(k=Math.max(k,parseFloat(e.X)+e.W/2));a=k+o/2,r=g_pog_json[P].CameraY}b.uuid=e,b.rotateY(g*Math.PI/180),b.rotateX(m*Math.PI/180),g_world.add(b),b.geometry.computeBoundingBox();b.geometry.boundingBox;var R=(new THREE.Box3).setFromObject(b).getSize(new THREE.Vector3);if(b.position.x=a,b.position.y=r,b.position.y=m<0?r+parseFloat(R.y)/2:r-parseFloat(R.y)/2,b.position.z=n/2+g_pog_json[P].BackDepth,"N"==D)w=W;else w=g_pog_json[P].ModuleInfo[p].Carpark[j];if(b.POGCode=g_pog_json[P].POGCode,b.Version=g_pog_json[P].Version,b.X=wpdSetFixed(100*w.X-100*w.W/2),"Y"==w.EditNotch?b.Y=wpdSetFixed(100*w.EditNotchY):b.Y=wpdSetFixed(100*w.Y-100*w.H/2),b.Z=wpdSetFixed(100*w.Z-100*w.D/2),b.Desc=w.Desc,b.FixelID=w.Shelf,b.Module=g_pog_json[P].ModuleInfo[p].Module,b.W=w.W,b.H=w.H,b.D=w.D,b.ROverhang=w.ROverhang,b.LOverhang=w.LOverhang,b.Color=w.Color,b.Rotation=g,b.ItemSlope=m,b.NotchNo=w.NotchNo,b.Rotation=0!==g||0!==m?"Y":"N",b.ImageExists="N","SHELF"==N&&(b.AvlSpace=wpdSetFixed(nvl(y))),"N"==D&&("Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&g_edit_pallet_shelfid==W.SObjID&&(g_pog_json[P].ModuleInfo[0].ShelfInfo[0]=JSON.parse(JSON.stringify(g_pog_json[P].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index])),g_pog_json[P].ModuleInfo[0].ShelfInfo[0].PrimeShelfObjID=parseInt(b.id)),W.X=a,W.Y=r,W.SObjID=parseInt(b.id),W.Z=n/2+g_pog_json[P].BackDepth,W.WFrameID=B,W.ShelfRotateWidth=parseFloat(R.x),W.ShelfRotateHeight=parseFloat(R.y),W.ShelfRotateDepth=parseFloat(R.z)),"N"==g_manual_zoom_ind){var Y=get_min_max_xy(P).split("###");set_camera_z(g_camera,parseFloat(Y[2]),parseFloat(Y[3]),parseFloat(Y[0]),parseFloat(Y[1]),g_offset_z,parseFloat(Y[4]),parseFloat(Y[5]),!0,g_pog_index)}"Y"==S&&"N"==d&&(a=wpdSetFixed(k+o/2),r=g_pog_json[P].CameraY),b.position.x=a,b.position.y=m<0?wpdSetFixed(r+parseFloat(R.y)/2):wpdSetFixed(r-parseFloat(R.y)/2),0!==g&&(b.quaternion.copy(g_camera.quaternion),b.lookAt(g_pog_json[P].CameraX,g_pog_json[P].CameraY,g_pog_json[P].CameraZ),b.rotateY(g*Math.PI/180),b.rotateX(m*Math.PI/180))}b.BorderColour=0;var A=parseInt(b.id);if("Y"==g_show_fixel_label&&"N"==D){if("BASE"!==N&&"NOTCH"!==N){var z=W.Color;if(null==hexToRgb(z))var L=parseInt("FF",16),E=parseInt("FF",16),X=parseInt("FF",16);else L=hexToRgb(z).r,E=hexToRgb(z).r,X=hexToRgb(z).g;var V=getTextColor(L,E,X);if("Y"==g_fixel_label){var G=get_notch_no(g_pog_json[P].ModuleInfo[p],P,W.Y+W.H/2),U=W.Shelf+" "+W.Desc+" "+parseFloat(100*W.Y-W.H/2*100).toFixed(2)+get_message("POGCR_FIXEL_CM")+" "+G,Z=addlabelText(U,g_labelFont,g_labelActualSize,V,"center","");b.add(Z),Z.position.y=-.005;var Q=Z.material.map.image.width/Z.material.map.image.height*g_labelActualSize/2;Z.position.x=0-W.W/2+Q+.01}else{Z=addlabelText(W.Shelf,g_labelFont,g_labelActualSize,V,"center","");b.add(Z);Q=Z.material.map.image.width/Z.material.map.image.height*g_labelActualSize/2;Z.position.x=0-W.W/2+Q+.01,Z.position.y=0}0!==W.Rotation||0!==W.Slope?Z.position.z=W.D/2+.005:Z.position.z=.001,W.LObjID=Z.id}}else if("Y"==D){V="#ffffff",Z=addlabelText(g_pog_json[P].ModuleInfo[p].Carpark[j].Shelf,12,g_labelActualSize,V,"center","");b.add(Z),Z.position.x=0-(g_pog_json[P].ModuleInfo[p].Carpark[j].W/3+.01),Z.position.y=0,Z.position.z=.005}if("CHEST"==N&&"Y"==g_chest_as_pegboard&&add_chest_dots_array(o,i,0,.01,0,.01,j,p,P),"N"==D)update_single_notch_label("Y",p,j,C,b,P,D);if(b.NotchNo=w.NotchNo,"Y"==S&&reorder_items(p,j,P))await recreate_all_items(p,j,W.ObjType,"Y",-1,-1,W.ItemInfo.length,"Y","N",-1,-1,v,"",P,c,h,_,O,H,M,T,"Y");return"undefined"!=typeof g_pog_json&&"EDIT_PALLET"==g_compare_view&&(g_pog_json[P].ModuleInfo[0].ShelfInfo[0].PrimeShelfObjID=b.id),logDebug("function : add_shelf","E"),[A,j]}catch(e){error_handling(e)}}function findNearByShelfMaxDepth(e,t,o,i,n,s){logDebug("function : findNearByShelfMaxDepth; p_module_index : "+e+"; p_shelf_index : "+t+"; i_item_index : "+o+"; p_edit_ind : "+i+"; locationX : "+n,"S");try{var a=g_pog_json[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].X-g_pog_json[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].W/2,r=g_pog_json[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].X+g_pog_json[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].W/2;if("1"!=g_pog_json[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].CapStyle&&"2"!=g_pog_json[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].CapStyle&&"3"!=g_pog_json[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].CapStyle||"SHELF"!=g_pog_json[s].ModuleInfo[e].ShelfInfo[t].ObjType)l=g_pog_json[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].Y+g_pog_json[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].H/2,d=g_pog_json[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].Y-g_pog_json[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].H/2;else var l=g_pog_json[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].Y+g_pog_json[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].RH/2,d=g_pog_json[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].Y-g_pog_json[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].RH/2;var p=g_pog_json[s].ModuleInfo[e].ShelfInfo[t].Shelf,g=g_pog_json[s].ModuleInfo[e].ShelfInfo[t].ObjType,m=[],I=0;return g_pog_json[s].ModuleInfo[e].ShelfInfo.length>1&&"SHELF"==g&&$.each(g_pog_json[s].ModuleInfo[e].ShelfInfo,(function(e,t){if("BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&"TEXTBOX"!==t.ObjType){if(0!==t.Rotation||0!==t.Slope)var o=parseFloat((t.X+t.ShelfRotateWidth/2).toFixed(3)),i=parseFloat((t.X-t.ShelfRotateWidth/2).toFixed(3));else o=parseFloat((t.X+t.W/2).toFixed(3)),i=parseFloat((t.X-t.W/2).toFixed(3));var n=t.Y,s=t.Y+t.H/2;(a>=i&&a<o||r<=o&&r>i)&&l>=n&&p!=t.Shelf&&d<s&&m.push(parseFloat(t.D.toFixed(4)))}})),m.length>0&&(I=Math.max.apply(Math,m)),logDebug("function : findNearByShelfMaxDepth","E"),I}catch(e){error_handling(e)}}function onload_findNearByShelfMaxDepth(e,t,o,i,n,s,a){logDebug("function : findNearByShelfMaxDepth; p_module_index : "+e+"; p_shelf_index : "+t+"; i_item_index : "+o+"; p_edit_ind : "+i+"; locationX : "+n,"S");try{var r=a[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].X-a[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].W/2,l=a[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].X+a[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].W/2,d=a[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].Y+a[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].H/2,p=a[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].Y-a[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].H/2,g=a[s].ModuleInfo[e].ShelfInfo[t].Shelf,m=a[s].ModuleInfo[e].ShelfInfo[t].ObjType,I=[],S=0;return a[s].ModuleInfo[e].ShelfInfo.length>1&&"SHELF"==m&&$.each(a[s].ModuleInfo[e].ShelfInfo,(function(e,t){if("BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&"TEXTBOX"!==t.ObjType){if(0!==t.Rotation||0!==t.Slope)var o=wpdSetFixed(t.X+t.ShelfRotateWidth/2),i=wpdSetFixed(t.X-t.ShelfRotateWidth/2);else o=wpdSetFixed(t.X+t.W/2),i=wpdSetFixed(t.X-t.W/2);var n=t.Y,s=t.Y+t.H/2;(r>=i&&r<o||l<=o&&l>i)&&d>=n&&g!=t.Shelf&&p<s&&I.push(wpdSetFixed(t.D))}})),I.length>0&&(S=Math.max.apply(Math,I)),logDebug("function : findNearByShelfMaxDepth","E"),S}catch(e){throw error_handling(e),e}}function get_shelf_max_merch(e,t,o,i,n,s){logDebug("function : get_shelf_max_merch; p_module_index : "+o+"; p_shelf_index : "+i,"S");try{var a=0;if(t.X>=e.X-e.W/2&&t.X<e.X+e.W/2&&t.Y<=e.H+g_pog_json[n].BaseH&&t.Y>0)a=get_module_max_merch(o,i,n);else if(t.Y<e.H+g_pog_json[n].BaseH&&t.Y>0)a=e.H+g_pog_json[n].BaseH-t.Y;else a=s;return a>t.MaxMerch&&t.MaxMerch>0&&(a=t.MaxMerch),logDebug("function : get_shelf_max_merch","E"),a}catch(e){throw error_handling(e),e}}function get_onload_max_merch(e,t,o,i,n,s,a){var r=i.X,l=i.Y;if(i.MaxMerch>0)var d=i.MaxMerch;else if(r>=o.X-o.W/2&&r<o.X+o.W/2&&l<=o.H+a[s].BaseH&&l>0)d=get_onload_shelf_max_merch(e,t,s,a);else if(l<o.H+a[s].BaseH&&l>0)d=o.H+a[s].BaseH-l;else d=n;return d}function get_onload_shelf_max_merch(e,t,o,i){try{var n=0,s=0,a=0,r=0,l=[],d=i[o].ModuleInfo[e],p=d.ShelfInfo[t],g=p.ObjType;0!==p.MaxMerch&&(a=p.MaxMerch);var m=p.Y+p.H,I=wpdSetFixed(p.X),S=wpdSetFixed(p.X+p.W),D=[];n=0;if("CHEST"!=g&&"BASKET"!=g||(s=p.BsktWallH),d.ShelfInfo.length>1){if("PEGBOARD"==g)D.push(p.H+p.LoOverHang),l.push(t);else if("HANGINGBAR"==g){m=p.Y;var f=0;for(const e of d.ShelfInfo){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){var v=wpdSetFixed(e.X),u=wpdSetFixed(e.X+e.W);t!==f&&e.Y+e.H<m&&(I>=v&&I<=u||S<=v&&S>=u||I>=v&&S<=u||v>=I&&u<=S)&&(D.push(m-(e.Y+e.H)),l.push(f))}f++}}else{f=0;for(const e of d.ShelfInfo){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){u=wpdSetFixed(e.X+e.W),v=wpdSetFixed(e.X);t!==f&&e.Y-e.H>m&&(u>I&&v<=I||v<S&&v>=I)&&e.Y<=d.H+g_pog_json[o].BaseH&&(D.push(e.Y-m),l.push(f))}f++}}if(0==D.length)n=d.H+i[o].BaseH-m;else{n=Math.min.apply(Math,D);var C=D.findIndex((function(e){return e==n}));d.ShelfInfo[l[C]].ObjType}}else n=d.H+i[o].BaseH-m;return r="CHEST"==g||"BASKET"==g?n<s&&s>0||0==s?n:s:n<a&&a>0||0==a?n:a,wpdSetFixed(r)}catch(e){throw error_handling(e),e}}function get_shelf_index(e,t){logDebug("function : get_shelf_index; obj_id : "+e,"S");var o=l_shelf_index=-1,i=g_pog_json[t].ModuleInfo;return $.each(i,(function(t,i){if(l_shelf_index>-1)return!1;null!=i.ParentModule&&"undefined"!=i.ParentModule||$.each(i.ShelfInfo,(function(i,n){return!(l_shelf_index>-1)&&(void 0!==n&&"BASE"!==n.ObjType&&"NOTCH"!==n.ObjType&&"DIVIDER"!==n.ObjType&&n.SObjID==e?(o=t,l_shelf_index=i,!1):void 0)}))})),logDebug("function : l_shelf_index","E"),[o,l_shelf_index]}async function set_shelf_item_index(e){return logDebug("function : set_shelf_item_index","S"),new Promise((function(t,o){if("undefined"!=typeof g_pog_json&&g_pog_json.length>0&&void 0!==g_pog_json[e]){var i=g_pog_json[e].ModuleInfo;$.each(i,(function(t,o){null!=o.ParentModule&&"undefined"!=o.ParentModule||$.each(o.ShelfInfo,(function(o,i){void 0!==i&&("NOTCH"!==i.ObjType&&"BASE"!==i.ObjType&&(g_pog_json[e].ModuleInfo[t].ShelfInfo[o].PIndex=e,g_pog_json[e].ModuleInfo[t].ShelfInfo[o].SIndex=o,g_pog_json[e].ModuleInfo[t].ShelfInfo[o].MIndex=t),i.ItemInfo.length>0&&$.each(i.ItemInfo,(function(i,n){g_pog_json[e].ModuleInfo[t].ShelfInfo[o].ItemInfo[i].PIndex=e,g_pog_json[e].ModuleInfo[t].ShelfInfo[o].ItemInfo[i].MIndex=t,g_pog_json[e].ModuleInfo[t].ShelfInfo[o].ItemInfo[i].SIndex=o,g_pog_json[e].ModuleInfo[t].ShelfInfo[o].ItemInfo[i].IIndex=i})))}))}))}t("SUCCESS"),logDebug("function : set_shelf_item_index","E")}))}function autoPositionShelfVertically(e,t,o,i,n,s,a,r="N"){try{logDebug("function : autoPositionShelfVertically; pPogIndex:"+e+"; pModuleIndex:"+t+"; pShelfIndex:"+o,"S");var l=g_pog_json[e].ModuleInfo[t],d=g_pog_json[e].ModuleInfo[t].ShelfInfo[o],p=-1,g=-1,m=0,I=!0,S=JSON.parse(JSON.stringify(g_pog_json[e].ModuleInfo));S.keySort({X:"asc"});var D=0;for(const e of S){if(void 0===e.ParentModule||null==e.ParentModule){if(0==m&&l.Module==e.Module)return[n,L];l.Module==e.Module&&(p=g),g=D,m++}D++}if(-1==p&&0==nvl(d))return[n,L];var f=S[p].ShelfInfo,v=S[p].W,u=[],C=0;for(h of f){if(!("SHELF"!=h.ObjType&&"HANGINGBAR"!=h.ObjType||"SHELF"!=d.ObjType&&"HANGINGBAR"!=d.ObjType)&&("Y"==r||"N"==r&&100*wpdSetFixed(h.W/v.W)>=100-parseFloat(a))){var c={};c.Distance=Math.abs(wpdSetFixed(d.Y-h.Y)),c.Indx=C,u.push(c)}C++}var h,_=d.Y;if(0!==u.length){var O=u.reduce(((e,t)=>t.Distance<e.Distance?t:e)).Indx;const e=Math.min(...u.map((e=>e.Distance)));var H=u.filter((t=>t.Distance===e)).length;if(I=!(H>1),1==H){var M=f[O].Y+f[O].H/2;h=f[O],_=wpdSetFixed(M-d.H/2)}}var T="N",P=wpdSetFixed(i-d.W/2),F=wpdSetFixed(i+d.W/2),j=wpdSetFixed(_+d.H/2),N=wpdSetFixed(_-d.H/2);if(textboxHit(e,t,o,P,F,j,N,"N")&&(_=n,I=!1,T="Y"),d.ItemInfo.length>0&&"N"==T){var y=[],x="N";for(item of d.ItemInfo){var W,b;y.push(wpdSetFixed(_+d.H/2+item.H)),"HANGINGBAR"==s?(W=wpdSetFixed(i-d.W/2+item.Distance+item.W/2),b=wpdSetFixed(_-item.H/2)):(W=wpdSetFixed(i-d.W/2+item.Distance+item.W/2),b=wpdSetFixed(_+d.H/2+item.H/2));var B=wpdSetFixed(W-item.W/2),w=wpdSetFixed(W+item.W/2),k=wpdSetFixed(b+item.H/2),R=wpdSetFixed(b-item.H/2);if(textboxHit(e,t,o,B,w,k,R)){_=n,I=!1,x="Y";break}}if("N"==x){var Y=Math.max(...y),A=wpdSetFixed(l.Y+l.H/2),z=wpdSetFixed(_+d.H/2);(Y>A&&"SHELF"==d.ObjType||z>A&&"HANGINGBAR"==d.ObjType)&&(_=n,I=!1)}}var L=!1,E=-1;if(I&&(void 0!==h.NotchNo||""!==h.NotchNo)&&g_pog_json[e].ModuleInfo[p].NotchStart==l.NotchStart&&g_pog_json[e].ModuleInfo[p].NotchSpacing==l.NotchSpacing){var X=g_scene_objects[e].scene.children[2].getObjectById(d.SObjID),V=g_scene_objects[e].scene.children[2].getObjectById(h.SObjID);void 0!==X&&void 0!==V&&(X.NotchNo=V.NotchNo),E=h.NotchNo,L=!0}return logDebug("function : autoPositionShelfVertically","E"),[_,L,E]}catch(e){error_handling(e)}}function isShelfOnPegboard(e,t,o,i,n,s){try{var a=!1,r=wpdSetFixed(e-n.W/2),l=wpdSetFixed(e+n.W/2),d=wpdSetFixed(t+n.H/2),p=wpdSetFixed(t-n.H/2);if(s[i].ModuleInfo)for(const e of s[i].ModuleInfo[o].ShelfInfo)if("PEGBOARD"==e.ObjType){var g=wpdSetFixed(e.X-e.W/2),m=wpdSetFixed(e.X+e.W/2),I=wpdSetFixed(e.Y+e.H/2),S=wpdSetFixed(e.Y-e.H/2);if(I>=d&&p>=S&&r>=g&&m>=l){a=!0;break}}return a}catch(e){error_handling(e)}}