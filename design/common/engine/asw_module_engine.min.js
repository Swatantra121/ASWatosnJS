async function create_module_from_json_lib(e,o,t,a,n,r,l,d,_,i,s,p,g,f,u,c,S,h,I,m,M,F,j,x,D,C,v,b,T,N,w,E,H,B,y,O,Y,P,k,W,R,X,L="N",V,G,z,A,U,Z,q,J,K){try{var Q,ee,oe={};if(g_show_live_image="Y"==g_show_item_desc?"N":g_show_live_image,"Y"==l){var te;"N"==g&&(t=e[A].DesignType),null==(ne=e[A].ModuleInfo)&&(e[A].ModuleInfo=[],ne=[]),ge=0;for(const e of ne){if(null!=e.ShelfInfo&&void 0!==e.ShelfInfo||(e.ShelfInfo=[]),null!=e.ChestInfo&&void 0!==e.ChestInfo||(e.ChestInfo=[]),void 0===e.ParentModule||null==e.ParentModule){null!==e.SubDept&&void 0!==e.SubDept&&(te=e.SubDept),ue=0;for(const o of e.ShelfInfo)void 0!==o.ItemInfo&&null!=o.ItemInfo||(o.ItemInfo=[]),ue+=1}ge+=1}if(oe.Action="C",e[A].GenrateCombineS=void 0!==e[A].GenrateCombineS&&null!==e[A].GenrateCombineS?e[A].GenrateCombineS:[],e[A].SubDept=void 0===e[A].SubDept||null==e[A].SubDept?te:e[A].SubDept,oe.Version=""==e[A].Version&&""!==s?s:e[A].Version,"N"==o&&"F"==t){var ae=[],ne=e[A].ModuleInfo;ge=0;for(const e of ne)void 0!==e.ParentModule&&null!=e.ParentModule||ae.push(e.H);if("undefined"==e[A].BaseH||null==e[A].BaseH||0==e[A].BaseH){var re=parseFloat(Math.max.apply(Math,ae)),le=parseFloat(e[A].H-re);oe.BaseH=wpdSetFixed(le)}else oe.BaseH=wpdSetFixed(e[A].BaseH);oe.DesignType="D",oe.DraftVersion=e[A].draftVersion,oe.BaseW=wpdSetFixed(e[A].W),oe.BaseD=wpdSetFixed(e[A].D),oe.BaseX=wpdSetFixed(oe.BaseW/2),oe.BaseY=wpdSetFixed(oe.BaseH/2),oe.NewPOG=e[A].NewPOG,void 0===e[A].SubDept?oe.SubDept="":oe.SubDept=e[A].SubDept,oe.BackDepth=.01,oe.TrafficFlow="LR",oe.HorzStart=0,oe.HorzSpacing=0,oe.VertStart=0,oe.VertSpacing=0,oe.AllowOverlap="N","Y"==$v("P25_POG_EFFECTIVE_START_DATE_UPD")?e[A].EffStartDate<d?oe.EffStartDate=d:oe.EffStartDate=e[A].EffStartDate:"Y"==$v("P25_POG_EFF_START_DATE_UPDATE")?e[A].EffStartDate>d+1?oe.EffStartDate=e[A].EffStartDate:oe.EffStartDate=d+1:oe.EffStartDate=moment(e[A].EffStartDate,get_js_date_format()).format("YYYYMMDD")}else oe.DesignType="D",oe.DraftVersion=e[A].draftVersion,oe.SubDept=e[A].SubDept,oe.BackDepth=e[A].BackDepth,oe.TrafficFlow=e[A].TrafficFlow,oe.HorzStart=e[A].HorzStart,oe.HorzSpacing=e[A].HorzSpacing,oe.VertStart=e[A].VertStart,oe.VertSpacing=e[A].VertSpacing,oe.AllowOverlap=e[A].AllowOverlap,oe.BaseH=wpdSetFixed(e[A].BaseH),oe.BaseW=wpdSetFixed(e[A].BaseW),oe.BaseD=wpdSetFixed(e[A].BaseD),oe.BaseX=wpdSetFixed(e[A].BaseX),oe.BaseY=wpdSetFixed(e[A].BaseY),oe.NewPOG=e[A].NewPOG,"Y"==$v("P25_POG_EFFECTIVE_START_DATE_UPD")&&e[A].EffStartDate<d?oe.EffStartDate=d:oe.EffStartDate=e[A].EffStartDate;oe.POGCode=e[A].POGCode,oe.Opened=n,oe.Name=e[A].Name,oe.Division=e[A].Division,oe.Dept=e[A].Dept,oe.Type=e[A].Type,oe.H=wpdSetFixed(e[A].H),oe.W=wpdSetFixed(e[A].W),oe.D=wpdSetFixed(e[A].D),oe.SegmentW=wpdSetFixed(e[A].SegmentW),oe.NotchW=wpdSetFixed(e[A].NotchW);var de=0;de=Z>-1&&0==e[A].NotchStart&&e[A].NotchW>0?Z/100:e[A].NotchStart,oe.NotchStart=de,oe.NotchSpacing=e[A].NotchSpacing,oe.SpecialType=e[A].SpecialType,oe.SpecialTypeDesc=e[A].SpecialTypeDesc,oe.DisplayMeterage=e[A].DisplayMeterage,oe.RPTMeterage=e[A].RPTMeterage,oe.ModuleDIR=e[A].ModuleDIR,oe.Direction=e[A].Direction,oe.OrderType=e[A].OrderType,oe.StartOneFixel=e[A].StartOneFixel,oe.StartOneModuleLoc=e[A].StartOneModuleLoc,oe.Ignore=e[A].Ignore,oe.StartOneModuleFixel=e[A].StartOneModuleFixel,oe.IncludeModName=e[A].IncludeModName,oe.Separator=e[A].Separator,oe.LeadingText=e[A].LeadingText,oe.TrailingText=e[A].TrailingText,oe.BrandGroupID=e[A].BrandGroupID,oe.Remarks=e[A].Remarks,oe.FixtureGeneration=e[A].FixtureGeneration,oe.FixtureFamily=e[A].FixtureFamily,oe.FixtureFamilyHidden=void 0===e[A].FixtureFamilyHidden?e[A].FixtureFamily:e[A].FixtureFamilyHidden,oe.FixtureType=e[A].FixtureType,oe.FixtureTypeDesc=void 0===e[A].FixtureTypeDesc?e[A].FixtureType:e[A].FixtureTypeDesc,oe.FixtureCodes=void 0===e[A].FixtureCodes?"":e[A].FixtureCodes,oe.FixtureCount=void 0===e[A].FixtureCount?"":e[A].FixtureCount,oe.Flex_Text_1=e[A].Flex_Text_1,oe.Flex_Text_2=e[A].Flex_Text_2,oe.Flex_Text_3=e[A].Flex_Text_3,oe.Flex_Text_4=e[A].Flex_Text_4,oe.Flex_Text_11=e[A].Flex_Text_11,oe.Flex_Text_12=e[A].Flex_Text_12,oe.Flex_Text_13=e[A].Flex_Text_13,oe.Flex_Text_14=e[A].Flex_Text_14,oe.Flex_Text_15=void 0!==e[A].Flex_Text_15&&null!==e[A].Flex_Text_15&&""!==e[A].Flex_Text_15?e[A].Flex_Text_15:e[A].FixtureGroup,oe.FixtureGroup=e[A].FixtureGroup,oe.Flex_Lov_1=e[A].Flex_Lov_1,oe.Flex_Lov_2=e[A].Flex_Lov_2,oe.Flex_Lov_3=e[A].Flex_Lov_3,oe.Flex_Lov_4=e[A].Flex_Lov_4,oe.Flex_Lov_5=e[A].Flex_Lov_5,oe.Flex_Lov_6=e[A].Flex_Lov_6,oe.StoreSegment=e[A].StoreSegment,oe.Desc7=e[A].Desc7,oe.Area=e[A].Area,oe.PLNDept=e[A].PLNDept,oe.CompBaseObjID=e[A].CompBaseObjID,oe.CompCamX=e[A].CompCamX,oe.CompCamY=e[A].CompCamY,oe.CompCamWidth=e[A].CompCamWidth,oe.CompCamHeight=e[A].CompCamHeight,void 0===e[A].Color?oe.Color=_:oe.Color=e[A].Color,oe.BaseZ=wpdSetFixed(e[A].BaseZ),oe.p_cameraX=e[A].p_cameraX,oe.p_cameraY=e[A].p_cameraY,oe.p_cameraZ=e[A].p_cameraZ,oe.X=wpdSetFixed(e[A].X),oe.Y=wpdSetFixed(e[A].Y),oe.Category=e[A].Category,oe.SubCategory=e[A].SubCategory,oe.GenrateCombineS=e[A].GenrateCombineS,void 0!==e[A].SalesInfo&&e[A].SalesInfo.length>0?oe.SalesInfo=e[A].SalesInfo:oe.SalesInfo=[],oe.MassUpdate=void 0!==e[A].MassUpdate&&null!==e[A].MassUpdate&&""!==e[A].MassUpdate?e[A].MassUpdate:"N",void 0===e[A].PromStartDt?oe.PromStartDt="":oe.PromStartDt=e[A].PromStartDt,void 0===e[A].PromEndDt?oe.PromEndDt="":oe.PromEndDt=e[A].PromEndDt,void 0===e[A].PromName?oe.PromName="":oe.PromName=e[A].PromName,void 0===e[A].PDFTemplateName?oe.PDFTemplateName="":oe.PDFTemplateName=e[A].PDFTemplateName,void 0===e[A].ComparePogVersion?oe.ComparePogVersion="":oe.ComparePogVersion=e[A].ComparePogVersion,void 0===e[A].StoreFormat?oe.StoreFormat="":oe.StoreFormat=e[A].StoreFormat,oe.SalesRrshDtl=e[A].SalesRrshDtl,void 0!==e[A].PreVersion?oe.PreVersion=e[A].PreVersion:oe.PreVersion="N",oe.ModuleInfo=[],null!=e[A].DeleteItems&&void 0!==e[A].DeleteItems?oe.DeleteItems=e[A].DeleteItems:oe.DeleteItems=[],null!=e[A].MassDelistedItem&&void 0!==e[A].MassDelistedItem?oe.MassDelistedItem=e[A].MassDelistedItem:oe.MassDelistedItem=[],g_pog_json[A]=oe,oe.X=wpdSetFixed(Q),oe.Y=wpdSetFixed(ee)}else oe=g_pog_json[A];create_g_combine_shelfs(e,A),Q=wpdSetFixed(oe.W/2),ee=wpdSetFixed(oe.H/2+oe.BaseH),oe.H/2,parseFloat(oe.BaseH)/2;var _e=parseInt(oe.Color.replace("#","0x"),16),ie=new THREE.Color(_e);if("Y"==r){var se=get_min_max_xy(A).split("###");set_camera_z(z,parseFloat(se[2]),parseFloat(se[3]),parseFloat(se[0]),parseFloat(se[1]),g_offset_z,parseFloat(se[4]),parseFloat(se[5]),!0,A)}if(oe.BaseH>0&&"Y"==r)await add_base("BASE1",oe.BaseW,oe.BaseH,oe.BaseD,ie,oe.BaseX,oe.BaseY,"N",A);var pe=[];if(p){pe=JSON.parse(JSON.stringify(e));var ge=0,fe=-1;for(const e of pe[A].ModuleInfo){if(void 0===e.ParentModule||null==e.ParentModule){-1==fe?(Q=wpdSetFixed(e.W/2),ee=wpdSetFixed(e.H/2+oe.BaseH)):(Q=wpdSetFixed(pe[A].ModuleInfo[fe].X+pe[A].ModuleInfo[fe].W/2+e.W/2),ee=wpdSetFixed(e.H/2+oe.BaseH)),pe[A].ModuleInfo[ge].X=Q,pe[A].ModuleInfo[ge].Y=ee,fe=ge;var ue=0;if(e.ShelfInfo.sort(((e,o)=>e.Y>o.Y&&"NOTCH"!==e.ObjType&&"BASE"!==e.ObjType?1:-1)),"N"==o&&"F"==t)for(const o of e.ShelfInfo)pe[A].ModuleInfo[ge].ShelfInfo[ue].X=wpdSetFixed(o.X+parseFloat(o.W)/2),pe[A].ModuleInfo[ge].ShelfInfo[ue].Y=wpdSetFixed(o.Y+parseFloat(o.H)/2),ue+=1}ge++}}if(void 0!==e[A].ModuleInfo&&e[A].ModuleInfo.length>0){ne=e[A].ModuleInfo;var ce={SeqNo:"asc"};if(ne.keySort(ce),"undefined"!=typeof g_json&&g_json.length>0){var Se=g_json[0].ModuleInfo;Se.keySort(ce);ge=0;for(const e of Se)e.ShelfInfo.length>0&&$.each(e.ShelfInfo,(function(e,o){void 0!==o&&"BASE"==o.ObjType&&g_json[0].ModuleInfo[ge].ShelfInfo.splice(e,1)})),ge++}ge=0;var he=-1;for(const a of ne){a.ShelfInfo.length>0&&$.each(a.ShelfInfo,(function(o,t){void 0!==t&&"BASE"==t.ObjType&&e[A].ModuleInfo[ge].ShelfInfo.splice(o,1)}));var Ie={};if("Y"==l){"N"==o&&"F"==t?(void 0===a.SubDept?Ie.SubDept="":Ie.SubDept=a.SubDept,Ie.Rotation=0,Ie.HorzStart=0,Ie.HorzSpacing=0,Ie.VertStart=0,Ie.VertSpacing=0,Ie.AllowOverlap="N",Ie.LNotch=0,Ie.Backboard=1,Ie.RNotch=0,Ie.LastCount=0,Ie.EditFlag="N",void 0!==a.Carpark&&null!==a.Carpark&&void 0!==a.Carpark[0]?null==a.Carpark[0].ItemInfo?Ie.Carpark=[]:void 0!==a.Carpark[0].ItemInfo?a.Carpark[0].ItemInfo.length>0?Ie.Carpark=a.Carpark:Ie.Carpark=[]:a.Carpark.length>0?Ie.Carpark=a.Carpark:Ie.Carpark=[]:Ie.Carpark=[]):(Ie.SubDept=a.SubDept,Ie.Rotation=a.Rotation,Ie.HorzStart=a.HorzStart,Ie.HorzSpacing=a.HorzSpacing,Ie.VertStart=a.VertStart,Ie.VertSpacing=a.VertSpacing,Ie.AllowOverlap=a.AllowOverlap,Ie.LNotch=a.LNotch,Ie.Backboard=a.Backboard,Ie.RNotch=a.RNotch,Ie.LastCount=a.LastCount,Ie.EditFlag=void 0!==a.EditFlag?a.EditFlag:"N",void 0!==a.Carpark&&null!==a.Carpark&&void 0!==a.Carpark[0]?null==a.Carpark[0].ItemInfo?Ie.Carpark=[]:void 0!==a.Carpark[0].ItemInfo?a.Carpark[0].ItemInfo.length>0?Ie.Carpark=a.Carpark:Ie.Carpark=[]:a.Carpark.length>0?Ie.Carpark=a.Carpark:Ie.Carpark=[]:Ie.Carpark=[]),Ie.SeqNo=a.SeqNo,Ie.Module=a.Module,void 0===a.ParentModule?Ie.ParentModule=null:Ie.ParentModule=a.ParentModule,Ie.ParentModuleIndex=a.ParentModuleIndex,Ie.POGModuleName=a.ModuleName,Ie.Remarks=a.Remarks,Ie.H=wpdSetFixed(a.H),Ie.W=wpdSetFixed(a.W),Ie.D=wpdSetFixed(a.D),void 0===a.Color?Ie.Color=i:Ie.Color=a.Color,Ie.NotchW=a.NotchW;de=0;de=Z>-1&&0==a.NotchStart&&a.NotchW>0?Z/100:a.NotchStart,Ie.NotchStart=de,Ie.NotchSpacing=a.NotchSpacing,Ie.CompMObjID=a.CompMObjID,a.NotchW>0&&(g_pog_json[A].NotchW=a.NotchW,g_pog_json[A].NotchStart=a.NotchStart,g_pog_json[A].NotchSpacing=a.NotchSpacing),0==ge?(Q=wpdSetFixed(Ie.W/2),ee=wpdSetFixed(Ie.H/2+g_pog_json[A].BaseH)):(Q=wpdSetFixed(g_pog_json[A].ModuleInfo[g_pog_json[A].ModuleInfo.length-1].X+Ie.W/2),ee=wpdSetFixed(Ie.H/2+g_pog_json[A].BaseH)),Ie.X=Q,Ie.Y=ee,Ie.Z=0,Ie.ChestInfo=null!==a.ChestInfo&&void 0!==a.ChestInfo&&""!==a.ChestInfo?a.ChestInfo:[],Ie.SvnCode=a.SvnCode,Ie.EgtCode=a.EgtCode,Ie.ShelfInfo=[],g_pog_json[A].ModuleInfo.push(Ie),he=g_pog_json[A].ModuleInfo.length-1}else Ie=a,Q=wpdSetFixed(a.X),ee=wpdSetFixed(a.Y),he=ge;if((void 0===a.ParentModule||null==a.ParentModule)&&"Y"==r){g_pog_json[A].SegmentW=a.W;_e=parseInt(Ie.Color.replace("#","0x"),16),ie=new THREE.Color(_e),await add_module_lib(a.Module,a.W,a.H,a.D,ie,Q,ee,"N","Y",a.VertStart,a.VertSpacing,a.HorzStart,a.HorzSpacing,"Y",z,he,u,c,S,h,I,m,M,F,j,x,D,C,v,b,T,N,w,E,H,B,y,O,Y,P,k,W,R,X,L,A,V,G,q)}if(void 0!==a.Carpark&&null!==a.Carpark&&a.Carpark.length>0){"N";await create_shelf_edit_pog_lib(ge,a.Carpark,a.W,"Y",o,t,"Y",r,l,m,x,D,C,v,b,T,N,E,H,B,y,O,Y,P,k,W,R,X,L,z,A,U,q)}if(e[A].ModuleInfo[ge].ShelfInfo.length>0)await create_shelf_from_json_lib(ge,e,a.W,"Y",o,t,r,l,p,pe,g,f,u,c,S,h,I,m,M,F,j,x,T,N,E,H,B,y,O,Y,P,k,W,R,L,X,V,G,z,A,U,q,J);ge+=1}mod_details=g_pog_json[A].ModuleInfo,temp_mod_details=g_pog_json[A].ModuleInfo;var me=0;for(const e of mod_details){if(void 0===e.ParentModule||null==e.ParentModule){ge=0;for(shelfs of e.ShelfInfo){console.log(shelfs.AutoDepthCalc,shelfs.SMassUpdate,"values");ue=0;for(items of shelfs.ItemInfo){if(void 0!==shelfs.AutoDepthCalc&&"Y"==shelfs.AutoDepthCalc){var Me=g_auto_cal_depth_fac;g_auto_cal_depth_fac="Y",maximizeItemDepthFacings("D",me,ge,ue,A),g_auto_cal_depth_fac=Me}ue++}if("TEXTBOX"==shelfs.ObjType){ue=0;for(tmp_mod of temp_mod_details)void 0!==tmp_mod.ParentModule&&null!==tmp_mod.ParentModule&&tmp_mod.Module==shelfs.Shelf&&(g_pog_json[A].ModuleInfo[ue].ObjID=shelfs.SObjID),ue++}ge++}}me+=1}}if("Y"==r){se=get_min_max_xy(A).split("###");set_camera_z(z,parseFloat(se[2]),parseFloat(se[3]),parseFloat(se[0]),parseFloat(se[1]),g_offset_z,parseFloat(se[4]),parseFloat(se[5]),!0,A)}if("Y"==r&&update_rotate_shelfs(A),g_multi_pog_json[A]=g_pog_json[A],"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&"Y"==r){var Fe=0;for(let e=0;e<g_combinedShelfs.length;e++)g_combinedShelfs[e][0].PIndex==A&&(g_combinedShelfs.splice(e,1),e--);var je=g_pog_json[A].ModuleInfo;for(g_module of je){var xe=0,De=g_pog_json[A].ModuleInfo[Fe].ShelfInfo;for(shelf_info of De)"SHELF"!=shelf_info.ObjType&&"HANGINGBAR"!=shelf_info.ObjType||"N"===shelf_info.Combine||await generateCombinedShelfs(A,Fe,xe,Y,B,y,O,P,R,k,"Y",K,"Y"),xe++;Fe++}}render(A)}catch(e){error_handling(e)}return"SUCCESS"}function add_base(e,o,t,a,n,r,l,d,_){logDebug("function : add_base; uuid : "+e+"; width : "+o+"; height : "+t+"; depth : "+a+"; color : "+n+"; x : "+r+"; y : "+l+"; p_edit_ind : "+d,"S");try{return new Promise((function(a,i){if("Y"==d){var s=g_scene_objects[_].scene.children[2].getObjectById(g_pog_json[_].BaseObjID);g_scene_objects[_].scene.children[2].remove(s)}var p=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshStandardMaterial({color:n})),g=add_wireframe(p,2);p.position.x=r,p.position.y=l,p.position.z=0,p.uuid=e,g_world.add(p),g_pog_json[_].BaseObjID=p.id,g_pog_json[_].BaseX=r,g_pog_json[_].BaseY=l,g_pog_json[_].BaseZ=0,g_pog_json[_].WFrameID=g,a("SUCCESS"),logDebug("function : add_base","E")}))}catch(e){error_handling(e)}}function add_notches(e,o,t,a,n,r,l,d,_,i,s){try{logDebug("function : add_notches; uuid : "+e+"; width : "+o+"; height : "+t+"; start : "+a+"; spacing : "+n+"; color : "+r+"; p_edit_ind : "+l+"; p_module_width : "+d+"; module_count : "+_,"S");var p=2e-4,g=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshStandardMaterial({color:r})),f=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshStandardMaterial({color:r})),u=(add_wireframe(g,2),add_wireframe(f,2),0-parseFloat(o)/2),c=0-parseFloat(t)/2+parseFloat(a),S=0+parseFloat(o)/2,h=0+parseFloat(t)/2,I=c,m=[];m.push(I);for(var M=0;M<1e3&&(I+=parseFloat(n))<h;M++)m.push(I);var F=[];for(M=0;M<m.length;M++)F.push(new THREE.Vector3(u,m[M],0)),F.push(new THREE.Vector3(S,m[M],0));let b=(new THREE.BufferGeometry).setFromPoints(F);var j=new THREE.LineBasicMaterial({color:0}),x=new THREE.LineSegments(b,j),D=new THREE.LineSegments(b,j);x.position.z=5e-4,D.position.z=5e-4,g.add(x),f.add(D);var C=0-parseFloat(d)/2+parseFloat(o)/2,v=0-parseFloat(d)/2+(parseFloat(d)-parseFloat(o)/2);g.position.x=C,g.position.y=0,g.position.z=p,f.position.x=v,f.position.y=0,f.position.z=p,i.add(g),i.add(f),g.uuid=e+1,f.uuid=e+2,g_pog_json[s].ModuleInfo[_].Notch1X=C,g_pog_json[s].ModuleInfo[_].Notch1Y=0,g_pog_json[s].ModuleInfo[_].Notch1Z=p,g_pog_json[s].ModuleInfo[_].Notch1ObjID=g.id,g_pog_json[s].ModuleInfo[_].Notch2X=v,g_pog_json[s].ModuleInfo[_].Notch2Y=0,g_pog_json[s].ModuleInfo[_].Notch2Z=p,g_pog_json[s].ModuleInfo[_].Notch2ObjID=f.id,logDebug("function : add_notches","E")}catch(e){error_handling(e)}}async function add_module_lib(e,o,t,a,n,r,l,d,_,i,s,p,g,f,u,c,S,h,I,m,M,F,j,x,D,C,v,b,T,N,w,E,H,B,y,O,Y,P,k,W,R,X,L,V,G="N",z,A,U,Z="N"){logDebug("function : add_module_lib; uuid : "+e+"; width : "+o+"; height : "+t+"; depth : "+a+"; color : "+n+"; x : "+r+"; y : "+l+"; p_edit_ind : "+d+"; pog_flag : "+_+"; vert_start : "+i+"; vert_spacing : "+s+"; horz_start : "+p+"; horz_spacing : "+g+"; recreate : "+f+"; module_ind : "+c,"S");try{if(console.log("add_module_lib",g_pog_json,z),-1==c||void 0===c)var q=parseFloat(g_pog_json[z].ModuleInfo.length)-1;else q=c;var J,K,Q=0,ee=[];if("Y"==d){ee=JSON.parse(g_temp_POG_arr);var oe=g_world.getObjectById(g_dblclick_objid);g_world.remove(oe),q=g_module_index;var te=0,ae="N",ne=[],re=[],le=[];if($.each(g_pog_json[z].ModuleInfo,(function(e,o){null!=o.ParentModule&&"undefined"!=o.ParentModule||(e<g_module_index?te+=o.W:e>g_module_index&&(ae="Y"))})),"Y"==ae){J=te+o/2,ne.push(J),re.push(t/2+g_pog_json[z].BaseH),le.push(q),te+=o,$.each(g_pog_json[z].ModuleInfo,(function(e,o){if((null==o.ParentModule||"undefined"==o.ParentModule)&&e>g_module_index){var t=g_world.getObjectById(o.MObjID);g_world.remove(t),J=te+o.W/2,le.push(e),ne.push(J),re.push(o.H/2+g_pog_json[z].BaseH),te+=o.W}}));var de=0;for(const e of ne){const t=le[de],a=re[de];var _e=parseInt(g_pog_json[z].ModuleInfo[t].Color.replace("#","0x"),16),ie=new THREE.Color(_e);await create_final_module(g_pog_json[z].ModuleInfo[t].Module,g_pog_json[z].ModuleInfo[t].W,g_pog_json[z].ModuleInfo[t].H,g_pog_json[z].ModuleInfo[t].D,ie,a,d,g_pog_json[z].ModuleInfo[t].VertStart,g_pog_json[z].ModuleInfo[t].VertSpacing,g_pog_json[z].ModuleInfo[t].HorzStart,g_pog_json[z].ModuleInfo[t].HorzSpacing,e,t,H,z);if("Y"==d&&void 0!==ee[z].ModuleInfo[t]&&void 0!==ee[z].ModuleInfo[0].ShelfInfo){if(void 0!==ee[z].ModuleInfo[t].Carpark&&ee[z].ModuleInfo[t].Carpark.length>0)await create_shelf_edit_pog_lib(t,ee[z].ModuleInfo[t].Carpark,o,"Y","Y","D","Y","Y","Y",F,C,v,b,T,N,w,E,B,y,O,Y,P,k,W,R,X,L,V,G,u,z,z,Z);if(ee[z].ModuleInfo[0].ShelfInfo.length>0)await create_shelf_from_json_lib(t,ee,g_pog_json[z].ModuleInfo[t].W,"N","Y","D","Y","Y",!1,null,"N",null,S,h,I,m,M,F,j,x,D,C,w,E,B,y,O,Y,P,k,W,R,X,L,G,V,A,U,u,z,z,Z)}de+=1}}else{J=te+o/2;await create_final_module(g_pog_json[z].ModuleInfo[q].Module,o,t,a,n,l,d,i,s,p,g,J,q,H,z);if("Y"==d&&void 0!==ee[z].ModuleInfo[q]&&void 0!==ee[z].ModuleInfo[0].ShelfInfo){if(void 0!==ee[z].ModuleInfo[0].Carpark&&ee[z].ModuleInfo[0].Carpark.length>0)await create_shelf_edit_pog_lib(0,ee[z].ModuleInfo[0].Carpark,o,"Y","Y","D","N","Y","Y",F,C,v,b,T,N,w,E,B,y,O,Y,P,k,W,R,X,L,V,G,u,z,z,Z);if(ee[z].ModuleInfo[0].ShelfInfo.length>0)await create_shelf_from_json_lib(q,ee,o,"N","Y","D","Y","Y",!1,[],"N",null,S,h,I,m,M,F,j,x,D,C,w,E,B,y,O,Y,P,k,W,R,X,L,G,V,A,U,u,z,z,Z)}}}else{if(g_pog_json[z].ModuleInfo.length>0){$.each(g_pog_json[z].ModuleInfo,(function(e,o){null!=o.ParentModule&&"undefined"!=o.ParentModule||e<q&&(Q+=o.W)}))}J=o/2+Q,K=wpdSetFixed(t/2+g_pog_json[z].BaseH);await create_final_module(e,o,t,a,n,K,d,i,s,p,g,J,q,H,z)}var se=g_pog_json[z].W;if(g_pog_json[z].BaseH>0){_e=parseInt(g_pog_json[z].Color.replace("#","0x"),16),ie=new THREE.Color(_e);g_pog_json[z].BaseW=se,g_pog_json[z].BaseX=se/2;add_base("BASE1",se,g_pog_json[z].BaseH,g_pog_json[z].BaseD,ie,se/2,g_pog_json[z].BaseY,"Y",z)}if("N"==f){var pe=get_min_max_xy(z).split("###");set_camera_z(u,parseFloat(pe[2]),parseFloat(pe[3]),parseFloat(pe[0]),parseFloat(pe[1]),g_offset_z,parseFloat(pe[4]),parseFloat(pe[5]),!0,g_pog_index)}if("Y"==G)updateObjID(e,c,"M");return logDebug("function : add_module_lib","E"),"SUCCESS"}catch(e){error_handling(e)}}function create_final_module(e,o,t,a,n,r,l,d,_,i,s,p,g,f,u){try{return logDebug("function : create_final_module; uuid : "+e+"; width : "+o+"; height : "+t+"; depth : "+a+"; color : "+n+"; y : "+r+"; p_edit_ind : "+l+"; vert_start : "+d+"; vert_spacing : "+_+"; horz_start : "+i+"; horz_spacing : "+s+"; finalX : "+p+"; edit_module_index : "+g,"S"),new Promise((function(a,c){var S=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshStandardMaterial({color:n}));if(_>0||s>0){var h=add_dots_to_object(o-2*g_pog_json[u].ModuleInfo[g].NotchW,t,7e-4,d,_,i,s,S,"MODULE","",g,f,"N",u);h.position.x=p,h.position.y=r,h.position.z=0,h.uuid=e,g_pog_json[u].ModuleInfo[g].NotchW>0&&add_notches("MODULE"+g+"_NOTCHES",g_pog_json[u].ModuleInfo[g].NotchW,t,g_pog_json[u].ModuleInfo[g].NotchStart,g_pog_json[u].ModuleInfo[g].NotchSpacing,n,l,o,g,h,u);var I=add_wireframe(h,2);h.WFrameID=I,g_world.add(h),"N"==l||(0==g?g_module_obj_array.splice(g,g+1):g_module_obj_array.splice(g,1)),g_module_obj_array.push(h),g_pog_json[u].ModuleInfo[g].MObjID=h.id,g_pog_json[u].ModuleInfo[g].WFrameID=I,h.Module=g_pog_json[u].ModuleInfo[g].Module,h.POGCode=g_pog_json[u].POGCode,h.Version=g_pog_json[u].Version,h.SvnCode=g_pog_json[u].ModuleInfo[g].SvnCode,h.EgtCode=g_pog_json[u].ModuleInfo[g].EgtCode,h.Remarks=null!==g_pog_json[u].ModuleInfo[g].Remarks?g_pog_json[u].ModuleInfo[g].Remarks:""}else{S.position.x=p,S.position.y=r,S.position.z=0,S.uuid=e,g_pog_json[u].ModuleInfo[g].NotchW>0&&add_notches("MODULE"+g+"_NOTCHES",g_pog_json[u].ModuleInfo[g].NotchW,t,g_pog_json[u].ModuleInfo[g].NotchStart,g_pog_json[u].ModuleInfo[g].NotchSpacing,n,l,o,g,S,u);I=add_wireframe(S,2);S.WFrameID=I,g_world.add(S),"N"==l||(0==g?g_module_obj_array.splice(g,g+1):g_module_obj_array.splice(g,1)),g_module_obj_array.push(S),g_pog_json[u].ModuleInfo[g].MObjID=S.id,g_pog_json[u].ModuleInfo[g].WFrameID=I,S.Module=g_pog_json[u].ModuleInfo[g].Module,S.POGCode=g_pog_json[u].POGCode,S.Version=g_pog_json[u].Version,S.Remarks=null!==g_pog_json[u].ModuleInfo[g].Remarks?g_pog_json[u].ModuleInfo[g].Remarks:"",S.SvnCode=g_pog_json[u].ModuleInfo[g].SvnCode,S.EgtCode=g_pog_json[u].ModuleInfo[g].EgtCode}g_pog_json[u].ModuleInfo[g].X=wpdSetFixed(p),g_pog_json[u].ModuleInfo[g].Y=wpdSetFixed(r),g_pog_json[u].ModuleInfo[g].Z=0,a("SUCCESS"),logDebug("function : create_final_module","E")}))}catch(e){error_handling(e)}}function update_module_coords(e,o,t,a){logDebug("function : update_module_coords; height : "+e+"; width : "+o+"; module_ind : "+t,"S");try{var n,r=parseFloat(g_pog_json[a].ModuleInfo.length)-1,l=0,d="N",_=[],i=[],s=[];$.each(g_pog_json[a].ModuleInfo,(function(e,o){null!=o.ParentModule&&"undefined"!=o.ParentModule||(e<t?l+=o.W:e>t&&(d="Y"))})),"Y"==d?(n=l+o/2,_.push(n),i.push(e/2+g_pog_json[a].BaseH),s.push(r),l+=o,$.each(g_pog_json[a].ModuleInfo,(function(e,o){null!=o.ParentModule&&"undefined"!=o.ParentModule||e>t&&(n=l+o.W/2,s.push(e),_.push(n),i.push(o.H/2+g_pog_json[a].BaseH),l+=o.W)})),_.forEach(((e,o)=>{s[o],i[o];g_pog_json[a].ModuleInfo[s[o]].X=e,g_pog_json[a].ModuleInfo[s[o]].Y=i[o]}))):(g_pog_json[a].ModuleInfo[t].X=l+o/2,g_pog_json[a].ModuleInfo[t].Y=e/2+g_pog_json[a].BaseH),logDebug("function : update_module_coords","E")}catch(e){error_handling(e),logDebug("function : update_module_coords","E")}}function get_notch_no(e,o,t){var a=0;for(k=0;k<100;k++){if(t<g_pog_json[o].BaseH+e.NotchStart/2&&e.NotchStart>0){a=0;break}if(t<=g_pog_json[o].BaseH+e.NotchStart&&e.NotchStart>0){a=1;break}if(t<=g_pog_json[o].BaseH&&0==e.NotchStart){a=0;break}if(wpdSetFixed(t)<wpdSetFixed(g_pog_json[o].BaseH+e.NotchStart+e.NotchSpacing*k)){a=k;break}}return a}async function update_single_notch_label(e,o,t,a,n,r,l){var d=g_pog_json[r].ModuleInfo[o].ShelfInfo[t],_=g_pog_json[r].ModuleInfo[o],i=g_notch_label_position.toUpperCase();if(g_pog_json[r].ModuleInfo[o].NotchW>0&&"BASE"!==d.ObjType&&"NOTCH"!==d.ObjType&&"DIVIDER"!==d.ObjType&&"TEXTBOX"!==d.ObjType){if(""==n)try{n=g_scene_objects[r].scene.children[2].getObjectById(g_pog_json[r].ModuleInfo[o].ShelfInfo[t].SObjID)}catch{return"FAIL"}var s=get_notch_no(_,r,d.Y+d.H/2);if(d.NotchNo=s,n.NotchNo=s,"N"==l&&"Y"==g_show_notch_label)if("Y"==e){if(void 0!==d.NotchLabelObjID&&-1!==d.NotchLabelObjID){var p=n.getObjectById(d.NotchLabelObjID);n.remove(p)}var g,f=d.Color;if(null==hexToRgb(f))var u=parseInt("FF",16),c=parseInt("FF",16),S=parseInt("FF",16);else u=hexToRgb(f).r,c=hexToRgb(f).r,S=hexToRgb(f).g;g="CENTER"==i?getTextColor(u,c,S):"#000000";var h=addlabelText(a+" "+s,g_labelFont,g_labelActualSize,g,"center","");n.add(h),0!==d.Rotation||0!==d.Slope?h.position.z=d.D/2+.005:h.position.z=.005,[posX,posY]=getLabelPosition(d,"S",i),h.position.x=posX,h.position.y=posY,g_pog_json[r].ModuleInfo[o].ShelfInfo[t].NotchLabelObjID=h.id}else if(void 0!==d.NotchLabelObjID&&-1!==d.NotchLabelObjID){p=n.getObjectById(d.NotchLabelObjID);n.remove(p)}}return"SUCCESS"}function get_module_max_merch(e,o,t,a="N",n=0){try{var r=0,l=0,d=0,_=0,i=[],s=g_pog_json[t].ModuleInfo[e],p=s.ShelfInfo[o],g=p.ItemInfo[n],f=wpdSetFixed(g?.X-g?.W/2),u=wpdSetFixed(g?.X+g?.W/2),c=p.ObjType;0!==p.MaxMerch&&(d=p.MaxMerch);var S=p.Y+p.H/2,h=wpdSetFixed(p.X-p.W/2),I=wpdSetFixed(p.X+p.W/2),m=wpdSetFixed(p.Z+p.D/2),M=[];r=0;if("CHEST"!=c&&"BASKET"!=c||(l=p.BsktWallH),s.ShelfInfo.length>1){if("PEGBOARD"==c)M.push(p.H+p.LoOverHang),i.push(o);else if("HANGINGBAR"==c){S=p.Y;var F=0;for(const e of s.ShelfInfo){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){var j=wpdSetFixed(e.X-e.W/2),x=wpdSetFixed(e.X+e.W/2);o!==F&&e.Y+e.H/2<S&&(h>=j&&h<=x||I<=j&&I>=x||h>=j&&I<=x||j>=h&&x<=I)&&(M.push(S-(e.Y+e.H/2)),i.push(F))}F++}}else for(F=0;F<s.ShelfInfo.length;F++){const e=s.ShelfInfo[F];if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){x=wpdSetFixed(e.X+e.W/2),j=wpdSetFixed(e.X-e.W/2);if(e.W<s.W&&(f>x||u<j))continue;(m<=wpdSetFixed(e.Z+e.D/2)&&"Y"==a||"N"==a)&&o!==F&&e.Y-e.H/2>S&&e.Y<=s.H+g_pog_json[t].BaseH&&(M.push(e.Y-e.H/2-S),i.push(F))}}if(0==M.length)p.Topmerch="Y",r=s.H+g_pog_json[t].BaseH-S;else{p.Topmerch="N",r=Math.min.apply(Math,M);var D=M.findIndex((function(e){return e==r}));s.ShelfInfo[i[D]].ObjType}}else p.Topmerch="Y",r=s.H+g_pog_json[t].BaseH-S;return _="CHEST"==c||"BASKET"==c?r<l&&l>0||0==l?r:l:r<d&&d>0||0==d?r:d,wpdSetFixed(_)}catch(e){throw error_handling(e),e}}