function get_new_orientation_dim(e,o,t,n){try{if(logDebug("function : get_new_orientation_dim; orientation : "+e+"; item_width : "+o+"; item_height : "+t+"; item_depth : "+n,"S"),width_final=height_final=depth_final=0,"1"==e||"3"==e||"13"==e||"15"==e){var r=o,i=t;height_final=r,width_final=i,depth_final=n;var a="W",I="H",s="D"}else if("4"==e||"6"==e||"16"==e||"18"==e){var f=n;i=t;width_final=o,height_final=f,depth_final=i;a="D",I="W",s="H"}else if("5"==e||"7"==e||"17"==e||"19"==e){f=n,i=t,r=o;height_final=r,width_final=f,depth_final=i;a="W",I="D",s="H"}else if("8"==e||"10"==e||"20"==e||"22"==e){f=n,r=o;width_final=f,height_final=t,depth_final=r;a="H",I="D",s="W"}else if("9"==e||"11"==e||"21"==e||"23"==e){f=n,i=t,r=o;width_final=i,height_final=f,depth_final=r;a="D",I="H",s="W"}else{width_final=o,height_final=t,depth_final=n;a="H",I="W",s="D"}return logDebug("function : get_new_orientation_dim","E"),[width_final,height_final,depth_final,a,I,s]}catch(e){error_handling(e)}}async function recreate_image_items(e,o,t,n,r,i,a,I,s,f,d="Y",l="N,0.018",m){logDebug("function : recreate_image_items; show_live_ind : "+e,"S");try{console.log("live image called"),g_world=g_scene_objects[f].scene.children[2];var _=0,p=g_pog_json[f].ModuleInfo;for(const d of p){if(void 0===d.ParentModule||null==d.ParentModule){if(d.ShelfInfo.length>0){j=0;for(const l of d.ShelfInfo){if("BASE"!==l.ObjType&&"NOTCH"!==l.ObjType&&"DIVIDER"!==l.ObjType&&"TEXTBOX"!==l.ObjType){x=0;for(const s of l.ItemInfo){if("DIVIDER"!==s.Item){var g=g_world.getObjectById(s.ObjID);if(g_world.remove(g),"Y"==e&&3!=s.MerchStyle)var c=g_orientation_json[s.Orientation].split("###"),h=await add_items_with_image(s.ItemID,s.W,s.H,s.D,s.Color,s.X,s.Y,s.Z,_,j,x,s.BHoriz,s.BVert,s.Item,parseInt(c[0]),parseInt(c[1]),"N","N",o,t,n,r,i,a,f);else h=await add_items_prom(s.ItemID,s.W,s.H,s.D,s.Color,s.X,s.Y,s.Z,_,j,x,"N","N",I,r,a,r,i,f);if(g_pog_json[f].ModuleInfo[_].ShelfInfo[j].ItemInfo[x].ObjID=h,"N"==e){g=g_world.getObjectById(h);"E"==s.DimUpdate?(g.BorderColour=g_dim_error_color,g.WireframeObj.material.color.setHex(g.BorderColour)):"N"==s.Status?(g.BorderColour=g_status_error_color,g.Status="N",g.WireframeObj.material.color.setHex(g.BorderColour)):"No"==nvl(s.MovingItem)&&"Y"==g_pogcr_auto_hlite_non_mv_item?(g.BorderColour=g_nonMovingItemColor,g.WireframeObj.material.color.setHex(g.BorderColour)):nvl(s.OOSPerc)>80&&"Y"==g_pogcr_enbl_oos_border?(g.BorderColour=g_pogcr_oos_border_color,g.WireframeObj.material.color.setHex(g.BorderColour)):g.BorderColour=0}else"E"==s.DimUpdate?g.BorderColour=g_dim_error_color:"N"==s.Status&&void 0!==g?(g.BorderColour=g_status_error_color,g.Status="N"):"No"==nvl(s.MovingItem)&&"Y"==g_pogcr_auto_hlite_non_mv_item&&0!==nvl(g)?(g.BorderColour=g_nonMovingItemColor,g.WireframeObj.material.color.setHex(g.BorderColour)):(nvl(s.OOSPerc)>80&&"Y"==g_pogcr_enbl_oos_border?(g.BorderColour=g_pogcr_oos_border_color,g.WireframeObj.material.color.setHex(g.BorderColour)):g.BorderColour=0,void 0!==g&&(g.BorderColour=0))}x++}if("SHELF"==l.ObjType||"PALLET"==l.ObjType)reset_top_bottom_objects(_,j,"N",f)}else if(""!==l.TextImg&&void 0!==l.TextImg&&"TEXTBOX"==l.ObjType&&null!==l.TextImg){var D=parseInt(l.Color.replace("#","0x"),16),S=new THREE.Color(D);if("#"==l.Color.charAt(1)&&"TEXTBOX"==l.ObjType)var u=null;else u=D;if("Y"==e&&""!==l.TextImg&&void 0!==l.TextImg&&null!==l.TextImg)var O=await add_text_box_with_image(l.Shelf,"TEXTBOX",l.W,l.H,l.D,S,l.X,l.Y,l.Z,"Y",_,l.InputText,u,l.WrapText,l.ReduceToFit,l.Color,j,l.Rotation,l.Slope,"N",l.FStyle,l.FSize,l.FBold,s,f);else{g_dblclick_objid=l.SObjID,g_shelf_index=j;O=add_text_box(l.Shelf,"TEXTBOX",l.W,l.H,l.D,S,l.X,l.Y,l.Z,"Y",_,l.InputText,u,l.WrapText,l.ReduceToFit,l.Color,j,l.Rotation,l.Slope,"N",l.FStyle,l.FSize,l.FBold,2,f,g_pogcr_enhance_textbox_fontsize,l.TextDirection)}var b=-1,H=0;for(const e of g_pog_json[f].ModuleInfo)null!==e.ParentModule&&e.Module==l.Shelf&&(b=H),H++;-1!==b&&(g_pog_json[f].ModuleInfo[b].ObjID=O)}j+=1}}if(void 0!==d.Carpark[0]&&d.Carpark[0].ItemInfo.length>0){k=0;for(const o of d.Carpark[0].ItemInfo){g=g_world.getObjectById(o.ObjID);g_world.remove(g);c=g_orientation_json[o.Orientation].split("###"),h=await add_carpark_item(o.ItemID,o.W,o.H,o.D,o.Color,o.X,o.Y,o.Z,_,0,k,"Y","N",e,parseInt(c[1]),f);g_pog_json[f].ModuleInfo[_].Carpark[0].ItemInfo[k].ObjID=h,k+=1}}}_+=1}"Y"==d&&await showHideDaysOfSupplyLabel(g_show_days_of_supply,"N",f,"Y","N",l,m),logDebug("function : recreate_image_items","E")}catch(e){error_handling(e)}}function reset_top_bottom_objects(e,o,t,n){logDebug("function : reset_top_bottom_objects; p_module_index : "+e+"; p_shelf_index : "+o+"; reset_obj : "+t,"S");try{if(void 0!==g_pog_json[n]&&void 0!==g_pog_json[n].ModuleInfo[e]){var r=g_pog_json[n].ModuleInfo[e].ShelfInfo[o];return new Promise((function(i,a){if(void 0!==r){var I=r.ItemInfo,s=[];p=0;var f=r.Y+r.H/2;for(const e of I)r.ItemInfo[p].BottomObjID="",r.ItemInfo[p].TopObjID="",p+=1;var d=0;for(const i of I){var l="N",m=wpdSetFixed(i.X-i.W/2),_=wpdSetFixed(i.X+i.W/2);p=0;for(const e of I){if(wpdSetFixed(e.X)==wpdSetFixed(i.X)&&-1==s.indexOf(wpdSetFixed(i.X))&&d!==p){s.push(wpdSetFixed(i.X)),l="Y";break}p+=1}if("Y"==l){var g=[];p=0;for(const e of I){if("PALLET"!==r.ObjType?wpdSetFixed(e.X)==wpdSetFixed(i.X)||wpdSetFixed(e.X)>m&&wpdSetFixed(e.X)<_:(wpdSetFixed(e.X)==wpdSetFixed(i.X)||wpdSetFixed(e.X)>m&&wpdSetFixed(e.X)<_)&&wpdSetFixed(e.Z)==wpdSetFixed(i.Z)){var c={};c.Y=e.Y,c.Index=p,g.push(c)}p+=1}g.keySort({Y:"asc"}),p=0;for(const i of g){if(0==p&&(r.ItemInfo[g[p].Index].Y=f+r.ItemInfo[g[p].Index].H/2),void 0!==g[p+1]&&void 0!==r.ItemInfo[g[p+1].Index]&&(r.ItemInfo[g[p+1].Index].Y=r.ItemInfo[g[p].Index].Y+r.ItemInfo[g[p].Index].H/2+r.ItemInfo[g[p+1].Index].H/2,r.ItemInfo[g[p+1].Index].BottomObjID=r.ItemInfo[g[p].Index].ObjID,r.ItemInfo[g[p].Index].TopObjID=r.ItemInfo[g[p+1].Index].ObjID,total_height=get_y_distance(e,o,g[p+1].Index,r.ItemInfo[g[p+1].Index].X,r.ItemInfo[g[p+1].Index].Y,n),r.ItemInfo[g[p+1].Index].TotalHeight=total_height,"Y"==t)){var h=g_scene_objects[n].scene.children[2].getObjectById(r.ItemInfo[g[p+1].Index].ObjID);void 0!==h&&(h.position.set(r.ItemInfo[g[p].Index].X,r.ItemInfo[g[p+1].Index].Y,.001+r.D/1e3),"PEGBOARD"==r.ObjType?h.position.z=.016:"PALLET"!==r.ObjType&&(h.position.z=.001+r.D/1e3))}p+=1}}d+=1}}i("SUCCES"),logDebug("function : reset_top_bottom_objects","E")}))}}catch(e){error_handling(e)}}async function add_items_with_image(e,o,t,n,r,i,a,I,s,f,d,l,m,_,g,c,h,D,S,u,O,b,H,C,j){logDebug("function : add_items_with_image; uuid : "+e+"; width : "+o+"; height : "+t+"; depth : "+n+"; color : "+r+"; x : "+i+"; y : "+a+"; z : "+I+"; p_module_index : "+s+"; p_shelf_index : "+f+"; i_item_index : "+d+"; horiz_facing : "+l+"; vert_facing : "+m+"; item_code : "+_+"; item_type : "+g+"; angle : "+c+"; recreate : "+h,"S");try{var v=g_pog_json[j].ModuleInfo[s].ShelfInfo[f],x=g_pog_json[j].ModuleInfo[s].ShelfInfo[f].ItemInfo[d].D;"SHELF"!=g_pog_json[j].ModuleInfo[s].ShelfInfo[f].ObjType&&"HANGINGBAR"!=g_pog_json[j].ModuleInfo[s].ShelfInfo[f].ObjType||(v.AvlSpace=wpdSetFixed(v.AvlSpace-o)),"ROD"==g_pog_json[j].ModuleInfo[s].ShelfInfo[f].ObjType&&(v.AvlSpace=wpdSetFixed(v.D-x));var B=v.SpreadItem,[T,E]=getCombinationShelf(j,v.Shelf);-1!==T&&(B=g_combinedShelfs[T].SpreadItem),m=parseInt(m);var w=v.ItemInfo[d],M=w.CapMerch,y=w.CapOrientaion,F=[],R=g_orientation_json[y];if(void 0!==R){F=R.split("###");var W=g_world.getObjectById(w.ObjID);g_world.remove(W)}var N=w.Orientation,P=g_orientation_json[N],Y=w.CapStyle,z=w.BHoriz;w.CrushHoriz>0&&z>1&&"F"==B&&"0"==w.Orientation&&(o=w.RW*(1-w.CrushHoriz/100)+w.SpreadItem*(z-1));var[A,G,X,L,k,V]=get_new_orientation_dim(w.Orientation,w.OW,w.OH,w.OD,A,G,X,w.Item);w.CrushHoriz>0&&"0"==w.Orientation&&(A=w.W/w.BHoriz),w.CrushVert>0&&"0"==w.Orientation&&(G=w.H/w.BVert),"0"!==w.Orientation&&("H"==k&&w.CrushVert>0&&(A=w.W/w.BHoriz),"W"==L&&w.CrushHoriz>0&&(G=w.H/w.BVert));var U=P.split("###"),Z=w.PegID;return new Promise((function(g,D){var S=(le=v.ItemInfo[d]).NVal,O=v.Rotation,x=v.Slope;le.MerchStyle;var T="N",E=-1,w=-1;if("DB"==u){var y=0;for(const e of g_ItemImages){if(_==e.Item&&U[0]==e.Orientation&&null!==e.ItemImage&&e.MerchStyle==le.MerchStyle){T="Y",w=y;break}y++}y=0;for(const e of g_ItemImages){if(_==e.Item&&F[0]==e.Orientation&&null!==e.ItemImage&&e.MerchStyle==M){E=y;break}y++}}else T="Y";if("Y"==T){if("DB"==u){var R=new Image,W=new THREE.Texture(R);if(W.format=THREE.RGBAFormat,R.onload=()=>{W.needsUpdate=!0},R.src="data:image/jpeg;base64,"+g_ItemImages[w].ItemImage,-1!==E){var N=new Image,P=new THREE.Texture(N);P.format=THREE.RGBAFormat,N.onload=()=>{P.needsUpdate=!0},N.src="data:image/jpeg;base64,"+g_ItemImages[E].ItemImage;var z=new THREE.MeshStandardMaterial({map:P})}}else console.log("Wrong Parameter value for pogcrLoadImgFrom",u);if(0!==O||0!==x){var X=new THREE.BoxBufferGeometry(o,t,n),L=new THREE.MeshBasicMaterial({map:W,transparent:!0});0==S&&(W.wrapS=THREE.RepeatWrapping,W.wrapT=THREE.RepeatWrapping,90==c||270==c?W.repeat.set(m,l):W.repeat.set(l,m),90==c?c=270:270==c&&(c=90),W.rotation=c*Math.PI/180);var k=new THREE.Mesh(X,L),V=g_world.getObjectById(v.SObjID);"N"==h&&(i=wpdSetFixed(0-(v.W/2-o/2-le.Distance)),a=wpdSetFixed(v.H/2+t/2),I=wpdSetFixed(v.D/2-n/2),le.RotationX=i,le.RotationY=a,le.RotationZ=I),k.applyMatrix4((new THREE.Matrix4).makeTranslation(i,a,I)),g_scene.updateMatrixWorld(),k.matrixAutoUpdate=!1,void 0!==V&&k.applyMatrix4(V.matrix)}else{X=new THREE.BoxGeometry(o,t,.001),L=new THREE.MeshStandardMaterial({map:W});if("F"==B){var Q=parseInt(r.replace("#","0x"),16),q=new THREE.Color(Q);k=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshBasicMaterial({color:q,transparent:!0,opacity:0}));0==S&&"0"==Y&&(90==c||270==c?W.repeat.set(m,1):W.repeat.set(1,m)),W.wrapS=THREE.RepeatWrapping,W.wrapT=THREE.RepeatWrapping,90==c?c=270:270==c&&(c=90),W.rotation=c*Math.PI/180;var $=[],K=0,J=(le=le).SpreadItem;if("0"==Y)for(_e=0;_e<l;_e++){if(m>1)var ee=new THREE.BoxGeometry(A,t,.001);else ee=new THREE.BoxGeometry(A,G,.001);$.push(new THREE.Mesh(ee,L)),k.add($[$.length-1]),0==_e?(K=-(le.CrushHoriz>0?o:le.W)/2+A+J,$[0].position.x=-(le.CrushHoriz>0?o:le.W)/2+A/2):($[_e].position.x=K+A/2,K=K+A+J)}else{var oe=m+le.CapCount,te=0,ne=(le.OD,le.CapHeight);console.log(le.CapHeight,ne);var re=m,ie="facings";for(p=0;p<oe;p++){K=0;var ae=-1;if(0==p)te=-le.H/2+G,ae=-le.H/2+G/2,re-=1;else if(re>0)ae=te+G/2,te+=G,re-=1,ie="facings";else ae=(Ie=te+ne)-G/2,te=Ie,ie="cap";for(_e=0;_e<l;_e++){ee=new THREE.BoxGeometry(A,G,.001);$.push(new THREE.Mesh(ee,L)),$[$.length-1].uuid=ie,k.add($[$.length-1]),0==_e?(K=-le.W/2+A+J,$[$.length-1].position.x=-le.W/2+A/2):($[$.length-1].position.x=K+A/2,K=K+A+J),$[$.length-1].position.y=ae}}}}else if(0==S&&"0"==Y&&(90==c||270==c?W.repeat.set(m,l):W.repeat.set(l,m)),W.wrapS=THREE.RepeatWrapping,W.wrapT=THREE.RepeatWrapping,90==c?c=270:270==c&&(c=90),W.rotation=c*Math.PI/180,"0"==Y)k=new THREE.Mesh(X,L);else{Q=parseInt(r.replace("#","0x"),16),q=new THREE.Color(Q);k=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshBasicMaterial({color:q,transparent:!1,opacity:1}));$=[],K=0,oe=m+(le=le).CapCount,te=0,le.OD,ne=le.CapHeight,re=m,ie="facings";for(p=0;p<oe;p++){var Ie;K=0,ae=-1;if(0==p)te=-le.H/2+G,ae=-le.H/2+G/2,re-=1;else if(re>0)ae=te+G/2,te+=G,re-=1,ie="facings";else ae=(Ie=te+ne)-ne/2,te=Ie,ie="cap";for(_e=0;_e<l;_e++){var se;if(p<m){ee=new THREE.BoxGeometry(A,G,.001);se=L}else{ee=new THREE.BoxGeometry(A,ne,.001);-1!==E&&(P.wrapS=THREE.RepeatWrapping,P.wrapT=THREE.RepeatWrapping,c=F[1],90==F[1]?c=270:270==F[1]&&(c=90),P.rotation=c*Math.PI/180),se=-1!==E?z:L}$.push(new THREE.Mesh(ee,se)),$[$.length-1].uuid=ie,k.add($[$.length-1]),0==_e?(K=-le.W/2+A,$[$.length-1].position.x=-le.W/2+A/2):($[$.length-1].position.x=K+A/2,K+=A),$[$.length-1].position.y=ae}}}k.position.x=i,"PEGBOARD"==v.ObjType||isShelfOnPegboard(v.X,v.Y,s,j,v,g_pog_json)?k.position.z=.016:"PALLET"==v.ObjType?k.position.z=.001+v.D/1e3-le.Z/1e3:k.position.z=.001+v.D/1e3,k.position.y=a}L.transparent=!0,k.uuid=e,g_world.add(k);var fe=add_wireframe(k,2);k.WFrameID=fe,k.WireframeObj.material.transparent=!0,k.WireframeObj.material.opacity=.0025;update_item_label(s,f,d,k,g_show_item_label,b,H,j,"N");if("Y"===g_item_vertical_text_display)get_canvas_camera("LABEL"),show_single_item_desc(s,f,d,g_pog_json[j].ModuleInfo[s].ShelfInfo[f].ItemInfo[d],k,g_camera,b,C,j);k.ImageExists="Y"}else{Q=parseInt(r.replace("#","0x"),16),q=new THREE.Color(Q);if(0!==O||0!==x){k=new THREE.Mesh(new THREE.BoxGeometry(o,t,n),new THREE.MeshBasicMaterial({color:q})),V=g_world.getObjectById(v.SObjID);"N"==h&&(i=wpdSetFixed(0-(v.W/2-o/2-le.Distance)),a=wpdSetFixed(v.H/2+t/2),I=wpdSetFixed(v.D/2-n/2),le.RotationX=i,le.RotationY=a,le.RotationZ=I),k.applyMatrix4((new THREE.Matrix4).makeTranslation(i,a,I)),g_scene.updateMatrixWorld(),k.matrixAutoUpdate=!1,void 0!==V&&k.applyMatrix4(V.matrix)}else{if("F"==B&&l>1){k=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshBasicMaterial({color:q,transparent:!0,opacity:0})),$=[],K=0,L=new THREE.MeshStandardMaterial({color:q}),J=(le=le).SpreadItem;for(_e=0;_e<l;_e++){var de=final_height=0;if(m>1||"0"!==Y){ee=new THREE.BoxGeometry(A,t,.001);de=A,final_height=t}else{ee=new THREE.BoxGeometry(A,G,.001);de=A,final_height=G}$.push(new THREE.Mesh(ee,L));fe=add_wireframe($[$.length-1],2);add_item_borders(s,f,d,$[$.length-1],de,final_height,1,j,"N"),k.add($[$.length-1]),0==_e?(K=-(le.CrushHoriz>0?o:le.W)/2+A+J,$[0].position.x=-(le.CrushHoriz>0?o:le.W)/2+A/2):($[_e].position.x=K+A/2,K=K+A+J)}}else k=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshStandardMaterial({color:q}));k.position.x=i,"PEGBOARD"==v.ObjType||isShelfOnPegboard(v.X,v.Y,s,j,v,g_pog_json)?k.position.z=.016:"PALLET"==v.ObjType?k.position.z=.001+v.D/1e3-le.Z/1e3:k.position.z=.001+v.D/1e3,k.position.y=a}k.uuid=e,v.AvlSpace=wpdSetFixed(v.AvlSpace-o);fe=add_wireframe(k,2);k.WFrameID=fe,g_world.add(k),("F"!==B||"F"==B&&1==l)&&add_item_borders(s,f,d,k,o,t,-1,j,"N");update_item_label(s,f,d,k,g_show_item_label,b,H,j,"N"),get_canvas_camera("LABEL"),show_single_item_desc(s,f,d,g_pog_json[j].ModuleInfo[s].ShelfInfo[f].ItemInfo[d],k,g_camera,b,C,j);k.ImageExists="N"}var le=le;k.ItemID=le.Item,k.Description=le.Desc,k.HorizFacing=le.BHoriz,k.VertFacing=le.BVert,k.DFacing=le.BaseD,k.ClassName=le.ClassName,k.DimUpdate=le.DimUpdate,k.SellingPrice=le.SellingPrice,k.SalesUnit=le.SalesUnit,k.NetSales=le.NetSales,k.CogsAdj=le.CogsAdj,k.RegMovement=le.RegMovement,k.AvgSales=le.AvgSales,k.ItemStatus=le.ItemStatus,k.CDTLvl1=le.CDTLvl1,k.CDTLvl2=le.CDTLvl2,k.CDTLvl3=le.CDTLvl3,k.ActualDPP=le.ActualDPP,k.StoreSOH=le.StoreSOH,k.DPPLoc=le.DPPLoc,k.StoreNo=le.StoreNo,k.WeeksOfInventory=le.WeeksOfInventory,k.ShelfPrice=le.ShelfPrice,k.PromoPrice=le.PromoPrice,k.DiscountRate=le.DiscountRate,k.PriceChangeDate=le.PriceChangeDate,k.WeeksOfInventory=le.WeeksOfInventory,k.Qty=le.Qty,k.WhStock=le.WhStock,k.StoreStock=le.StoreStock,k.StockIntransit=le.StockIntransit,k.GrossProfit=le.GrossProfit,k.WeeksCount=le.WeeksCount,k.MovingItem=le.MovingItem,k.Profit=le.Profit,k.TotalMargin=le.TotalMargin,k.W=le.W,k.H=le.H,k.D=le.D,k.Color=le.Color,k.Barcode=le.Barcode,k.Desc=le.Desc,k.Brand=le.Brand,k.BrandType=le.BrandType,k.Group=le.Group,k.Dept=le.Dept,k.Class=le.Class,k.SubClass=le.SubClass,k.StdUOM=le.StdUOM,k.SizeDesc=le.SizeDesc,k.Supplier=le.Supplier,k.SupplierName=le.SupplierName,k.LocID=le.LocID,k.Supplier=le.Supplier,k.ItemDim=g_msg_h+": "+(100*le.OH).toFixed(2)+" ("+g_msg_Sq+" : "+le.CrushVert+") "+g_msg_w+": "+(100*le.OW).toFixed(2)+" ("+g_msg_Sq+" : "+le.CrushHoriz+") "+g_msg_d+": "+(100*le.OD).toFixed(2)+" ("+g_msg_Sq+" : "+le.CrushD+")",k.OrientationDesc=le.OrientationDesc,k.StoreCnt=le.StoreCnt,k.RotationDegree=O,k.OW=100*le.OW,k.OH=100*le.OH,k.OD=100*le.OD,k.CrushW=le.CrushHoriz,k.CrushH=le.CrushVert,k.CrushD=le.CrushD,k.Shelf=v.Shelf,k.Rotation=0,k.ItemSlope=0,k.UnitperCase=le.UnitperCase,k.UnitperTray=le.UnitperTray,k.DescSecond=le.DescSecond,k.DfacingUpd=le.DfacingUpd,k.ItmDescChi=le.ItmDescChi,k.ItmDescEng=le.ItmDescEng,k.TotalUnitsCalc=le.BHoriz*le.BVert*le.BaseD,k.PkSiz=le.PkSiz,k.CapFacing=le.CapFacing,k.CapDepth=le.CapDepth,k.CapHorz=le.CapHorz;var me=le.CapFacing*le.CapDepth*le.CapHorz;if(k.Cpct=le.BHoriz*le.BVert*le.BaseD+(isNaN(me)?0:me),k.Brand_Category=le.Brand_Category,k.Uda_item_status=le.Uda_item_status,k.Gobecobrand=le.Gobecobrand,k.Internet=le.Internet,k.Categ=le.Categ,void 0!==le.SizeDesc&&""!==le.SizeDesc)le.SizeDesc.split("*");else;if(k.GoGreen=le.GoGreen,k.ItemSize=le.ItemSize,k.SplrLbl=le.SplrLbl,k.COO=le.COO,k.EDLP=le.EDLP,k.LoGrp=le.LoGrp,k.SqzPer=(void 0!==le.CrushHoriz?le.CrushHoriz:0)+":"+(void 0!==le.CrushVert?le.CrushVert:0)+":"+(void 0!==le.CrushD?le.CrushD:0),k.InternationalRng=le.InternationalRng,k.NewItem=le.NewItem,k.LiveNewItem=le.LiveNewItem,k.DaysOfSupply=le.DaysOfSupply,k.CapDepthChanged=le.CapDepthChanged,k.Orientation=le.Orientation,k.MassCrushH=le.MassCrushH,k.MassCrushV=le.MassCrushV,k.MassCrushD=le.MassCrushD,k.UDA751=le.UDA751,k.UDA755=le.UDA755,k.MPogDepthFacings=le.MPogDepthFacings,k.MPogHorizFacings=le.MPogHorizFacings,k.MPogVertFacings=le.MPogVertFacings,k.Status=le.Status,k.MerchStyle=le.MerchStyle,k.CapMerch=le.CapMerch,k.ItemCondition=le.ItemCondition,k.AUR=le.AUR,k.ItemRanking=le.ItemRanking,k.WeeklySales=le.WeeklySales,k.WeeklyNetMargin=le.WeeklyNetMargin,k.WeeklyQty=le.WeeklyQty,k.NetMarginPercent=le.NetMarginPercent,k.CumulativeNM=le.CumulativeNM,k.TOP80B2=le.TOP80B2,k.ItemBrandC=le.ItemBrandC,k.ItemPOGDept=le.ItemPOGDept,k.ItemRemark=le.ItemRemark,k.RTVStatus=le.RTVStatus,k.Pusher=le.Pusher,k.Divider=le.Divider,k.BackSupport=le.BackSupport,k.CWPerc=le.CWPerc,k.CHPerc=le.CHPerc,k.CDPerc=le.CDPerc,k.OOSPerc=le.OOSPerc,k.InitialItemDesc=le.InitialItemDesc,k.InitialBrand=le.InitialBrand,k.InitialBarcode=le.InitialBarcode,k.RotationFlag=0!==O||0!==x?"Y":"N","SHELF"==v.ObjType){var _e=0,pe=0;for(const e of v.ItemInfo)pe+=e.W,_e++;if("E"!==v.SpreadItem){var ge=v.HorizGap?v.HorizGap:0;pe+=_e>1?ge*(_e-1):0}v.AvlSpace=wpdSetFixed(100*(v.W-pe));var ce=g_world.getObjectById(v.SObjID);void 0!==ce&&"SHELF"==v.ObjType&&(ce.AvlSpace=v.AvlSpace)}if("F"==v.SpreadItem&&("SHELF"==v.ObjType||"HANGINGBAR"==v.ObjType)){var he=0;for(const e of v.ItemInfo)he+=e?.CrushHoriz>0?e?.W:e?.RW;v.AvlSpace=wpdSetFixed(100*(v.W-he)),void 0!==ce&&"SHELF"==v.ObjType&&(ce.AvlSpace=v.AvlSpace)}V=g_world.getObjectById(k.id);"E"==k.DimUpdate&&void 0!==k.DimUpdate?(V.BorderColour=g_dim_error_color,V.WireframeObj.material.color.setHex(V.BorderColour)):"N"==nvl(k.Status)?(V.BorderColour=g_status_error_color,V.Status="N",V.WireframeObj.material.color.setHex(V.BorderColour)):"No"==nvl(k.MovingItem)&&"Y"==g_pogcr_auto_hlite_non_mv_item?(V.BorderColour=g_nonMovingItemColor,V.WireframeObj.material.color.setHex(V.BorderColour)):nvl(k.OOSPerc)>80&&"Y"==g_pogcr_enbl_oos_border?(V.BorderColour=g_pogcr_oos_border_color,V.WireframeObj.material.color.setHex(V.BorderColour)):V.BorderColour=0;V=g_world.getObjectById(k.id);var De=v.ObjType;if(!(void 0===Z&&""===Z||"Y"!=g_show_peg_tags||"HANGINGBAR"!=De&&"PEGBOARD"!=De))show_pegTages("N",le,V,s,f,d,j);render(j),logDebug("function : add_items_with_image","E"),g(k.id)}))}catch(e){logDebug("function : add_items_with_image","E"),error_handling(e)}}async function add_items_prom(e,o,t,n,r,i,a,I,s,f,d,l,m,_,p,g,c,h,D){logDebug("function : add_items_prom; uuid : "+e+"; width : "+o+"; height : "+t+"; depth : "+n+"; color : "+r+"; x : "+i+"; y : "+a+"; z : "+I+"; p_module_index : "+s+"; p_shelf_index : "+f+"; i_item_index : "+d+"; recreate : "+l);try{var S=g_pog_json[D].ModuleInfo[s].ShelfInfo[f],u=S.SpreadItem,[O,b]=getCombinationShelf(D,S.Shelf);-1!==O&&(u=g_combinedShelfs[O].SpreadItem),r=void 0===r?"#FFFFFF":r,objType=S.ObjType;var H=S.ItemInfo[d],C=H.PegID,j=H.pegHeadRoom,v=H.BHoriz,x=H.BVert,B=H.CapStyle;H.CrushHoriz>0&&v>1&&"F"==u&&"0"==H.Orientation&&(o=H.RW*(1-H.CrushHoriz/100)+H.SpreadItem*(v-1)),"Y"==H.Delist&&(r=_,H.Color=_);var[T,E,w,M,y,F]=get_new_orientation_dim(H.Orientation,H.OW,H.OH,H.OD);H.CrushHoriz>0&&"0"==H.Orientation&&(T=H.W/H.BHoriz),H.CrushVert>0&&"0"==H.Orientation&&(E=H.H/H.BVert),"0"!==H.Orientation&&("H"==y&&H.CrushVert>0&&(T=H.W/H.BHoriz),"W"==M&&H.CrushHoriz>0&&(E=H.H/H.BVert));parseFloat(o),parseFloat(t),parseFloat(o),parseFloat(t);return""!==C&&void 0!==j&&"Y"==g_show_peg_tags&&("HANGINGBAR"!=objType&&"PEGBOARD"!=objType||(t+=j/100,a+=(j/=2)/100)),new Promise((function(_,p){var O=parseInt(r.replace("#","0x"),16),b=new THREE.Color(O),j=S.Rotation,w=S.Slope;if(0!==j||0!==w){H=new THREE.Mesh(new THREE.BoxGeometry(o,t,n),new THREE.MeshStandardMaterial({color:b})),0!==S.ItemInfo[d].Rotation&&"DIVIDER"==S.ItemInfo[d].Item&&H.rotateY(S.ItemInfo[d].Rotation*Math.PI/180);var M=g_scene_objects[D].scene.children[2].getObjectById(S.SObjID);"N"==l&&("PEGBOARD"==S.ObjType?(i=0-S.W/2+(S.ItemInfo[d].PegBoardX+o/2),a=0-S.H/2+(S.ItemInfo[d].PegBoardY+t/2),I=.01+n/2):(i=wpdSetFixed(0-(S.W/2-o/2-S.ItemInfo[d].Distance)),a=wpdSetFixed(S.H/2+t/2),I=wpdSetFixed(S.D/2-n/2)),S.ItemInfo[d].RotationX=i,S.ItemInfo[d].RotationY=a,S.ItemInfo[d].RotationZ=I),H.applyMatrix4((new THREE.Matrix4).makeTranslation(i,a,I)),g_scene.updateMatrixWorld(),H.matrixAutoUpdate=!1,H.applyMatrix4(M.matrix),g_scene_objects[D].scene.children[2].add(H),M.updateMatrix();var y=new THREE.Vector3;y.setFromMatrixPosition(H.matrixWorld),H.geometry.computeBoundingBox();H.geometry.boundingBox;var F=(new THREE.Box3).setFromObject(H).getSize(new THREE.Vector3);S.ItemInfo[d].RotationWidth=parseFloat(F.x),S.ItemInfo[d].RotationHeight=parseFloat(F.y),S.ItemInfo[d].RotationDepth=parseFloat(F.z),S.ItemInfo[d].ItemRotateWorldX=y.x,S.ItemInfo[d].ItemRotateWorldY=y.y,S.ItemInfo[d].ItemRotateWorldZ=y.z}else{if(0!==S.ItemInfo[d].Rotation&&"DIVIDER"==S.ItemInfo[d].Item)(H=new THREE.Mesh(new THREE.BoxGeometry(o,t,n),new THREE.MeshStandardMaterial({color:b}))).rotateY(S.ItemInfo[d].Rotation*Math.PI/180),H.position.z=I+S.D/1e3;else{if("F"==u&&v>1){H=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshBasicMaterial({color:b,transparent:!0,opacity:0}));var R=[],W=0,N=new THREE.MeshStandardMaterial({color:b}),P=(G=S.ItemInfo[d]).SpreadItem;for(k=0;k<v;k++){var Y=final_height=0;if(x>1||"0"!==B){var z=new THREE.BoxGeometry(T,t,.001);Y=T,final_height=t}else{z=new THREE.BoxGeometry(T,E,.001);Y=T,final_height=E}R.push(new THREE.Mesh(z,N)),R[R.length-1].uuid="horiz_facing";var A=add_wireframe(R[R.length-1],2);add_item_borders(s,f,d,R[R.length-1],Y,final_height,1,D,"N"),H.add(R[R.length-1]),0==k?(W=-(G.CrushHoriz>0?o:G.W)/2+T+P,R[0].position.x=-(G.CrushHoriz>0?o:G.W)/2+T/2):(R[k].position.x=W+T/2,W=W+T+P)}}else H=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshStandardMaterial({color:b}));"PEGBOARD"==S.ObjType||isShelfOnPegboard(S.X,S.Y,s,D,S,g_pog_json)?H.position.z=.016:"PALLET"==S.ObjType?H.position.z=.001+S.D/1e3-S.ItemInfo[d].Z/1e3:H.position.z=.001+S.D/1e3}H.position.x=i,H.position.y=a,g_world.add(H)}H.uuid=e;var G=S.ItemInfo[d];H.ItemID=G.Item,H.Description=G.Desc,H.HorizFacing=G.BHoriz,H.VertFacing=G.BVert,H.DFacing=G.BaseD,H.ClassName=G.ClassName,H.DimUpdate=G.DimUpdate,H.SellingPrice=G.SellingPrice,H.SalesUnit=G.SalesUnit,H.NetSales=G.NetSales,H.CogsAdj=G.CogsAdj,H.GrossProfit=G.GrossProfit,H.WeeksCount=G.WeeksCount,H.MovingItem=G.MovingItem,H.RegMovement=G.RegMovement,H.AvgSales=G.AvgSales,H.ItemStatus=G.ItemStatus,H.CDTLvl1=G.CDTLvl1,H.CDTLvl2=G.CDTLvl2,H.CDTLvl3=G.CDTLvl3,H.ActualDPP=G.ActualDPP,H.StoreSOH=G.StoreSOH,H.DPPLoc=G.DPPLoc,H.StoreNo=G.StoreNo,H.WeeksOfInventory=G.WeeksOfInventory,H.ShelfPrice=G.ShelfPrice,H.PromoPrice=G.PromoPrice,H.DiscountRate=G.DiscountRate,H.PriceChangeDate=G.PriceChangeDate,H.WeeksOfInventory=G.WeeksOfInventory,H.Qty=G.Qty,H.WhStock=G.WhStock,H.StoreStock=G.StoreStock,H.StockIntransit=G.StockIntransit,H.Profit=G.Profit,H.TotalMargin=G.TotalMargin,H.W=G.W,H.H=G.H,H.D=G.D,H.Color=G.Color,H.Barcode=G.Barcode,H.Desc=G.Desc,H.Brand=G.Brand,H.BrandType=G.BrandType,H.Group=G.Group,H.Dept=G.Dept,H.Class=G.Class,H.SubClass=G.SubClass,H.StdUOM=G.StdUOM,H.SizeDesc=G.SizeDesc,H.Supplier=G.Supplier,H.SupplierName=G.SupplierName,H.LocID=G.LocID,H.ClassName=G.ClassName,H.ItemDim=g_msg_h+": "+(100*G.OH).toFixed(2)+" ("+g_msg_Sq+" : "+G.CrushVert+") "+g_msg_w+": "+(100*G.OW).toFixed(2)+" ("+g_msg_Sq+" : "+G.CrushHoriz+") "+g_msg_d+": "+(100*G.OD).toFixed(2)+" ("+g_msg_Sq+" : "+G.CrushD+")",H.OrientationDesc=G.OrientationDesc,H.Orientation=G.Orientation,H.StoreCnt=G.StoreCnt,H.RotationDegree=j,H.OW=100*G.OW,H.OH=100*G.OH,H.OD=100*G.OD,H.CrushW=G.CrushHoriz,H.CrushH=G.CrushVert,H.CrushD=G.CrushD,H.DescSecond=G.DescSecond,H.Shelf=S.Shelf,H.Rotation=0,H.ItemSlope=0,H.RotationFlag=0!==j||0!==w?"Y":"N",H.ImageExists="N",H.UnitperCase=G.UnitperCase,H.UnitperTray=G.UnitperTray,H.DfacingUpd=G.DfacingUpd,H.ItmDescChi=G.ItmDescChi,H.ItmDescEng=G.ItmDescEng,H.TotalUnitsCalc=G.BHoriz*G.BVert*G.BaseD,H.PkSiz=G.PkSiz,H.CapFacing=G.CapFacing,H.CapDepth=G.CapDepth,H.CapHorz=G.CapHorz;var X=G.CapFacing*G.CapDepth*G.CapHorz;if(H.Cpct=G.BHoriz*G.BVert*G.BaseD+(isNaN(X)?0:X),H.Brand_Category=G.Brand_Category,H.Uda_item_status=G.Uda_item_status,H.Gobecobrand=G.Gobecobrand,H.Internet=G.Internet,H.GoGreen=G.GoGreen,H.Categ=G.Categ,void 0!==G.SizeDesc&&""!==G.SizeDesc)G.SizeDesc.split("*");else;if(H.ItemSize=G.ItemSize,H.SplrLbl=G.SplrLbl,H.COO=G.COO,H.EDLP=G.EDLP,H.LoGrp=G.LoGrp,H.SqzPer=(void 0!==G.CrushHoriz?G.CrushHoriz:0)+":"+(void 0!==G.CrushVert?G.CrushVert:0)+":"+(void 0!==G.CrushD?G.CrushD:0),H.InternationalRng=G.InternationalRng,H.NewItem=G.NewItem,H.LiveNewItem=G.LiveNewItem,H.DaysOfSupply=G.DaysOfSupply,H.CapDepthChanged=G.CapDepthChanged,H.MassCrushH=G.MassCrushH,H.MassCrushV=G.MassCrushV,H.MassCrushD=G.MassCrushD,H.UDA751=G.UDA751,H.UDA755=G.UDA755,H.MPogDepthFacings=G.MPogDepthFacings,H.MPogHorizFacings=G.MPogHorizFacings,H.MPogVertFacings=G.MPogVertFacings,H.Status=G.Status,H.MerchStyle=G.MerchStyle,H.CapMerch=G.CapMerch,H.ItemCondition=G.ItemCondition,H.AUR=G.AUR,H.ItemRanking=G.ItemRanking,H.WeeklySales=G.WeeklySales,H.WeeklyNetMargin=G.WeeklyNetMargin,H.WeeklyQty=G.WeeklyQty,H.NetMarginPercent=G.NetMarginPercent,H.CumulativeNM=G.CumulativeNM,H.TOP80B2=G.TOP80B2,H.ItemBrandC=G.ItemBrandC,H.ItemPOGDept=G.ItemPOGDept,H.ItemRemark=G.ItemRemark,H.RTVStatus=G.RTVStatus,H.Pusher=G.Pusher,H.Divider=G.Divider,H.BackSupport=G.BackSupport,H.CWPerc=G.CWPerc,H.CHPerc=G.CHPerc,H.CDPerc=G.CDPerc,H.OOSPerc=G.OOSPerc,H.InitialItemDesc=G.InitialItemDesc,H.InitialBrand=G.InitialBrand,H.InitialBarcode=G.InitialBarcode,"SHELF"==S.ObjType||"HANGINGBAR"==S.ObjType&&"Y"==m){var L,k=0,V=0;for(const e of S.ItemInfo)V+=e.W,k++;if("E"!==S.SpreadItem){var U=S.HorizGap?S.HorizGap:0;V+=k>1?U*(k-1):0}S.AvlSpace=wpdSetFixed(100*(S.W-V)),void 0!==(L=g_world.getObjectById(S.SObjID))&&"SHELF"==S.ObjType&&(L.AvlSpace=S.AvlSpace)}if("F"==S.SpreadItem&&("SHELF"==S.ObjType||"HANGINGBAR"==S.ObjType)){var Z=0;for(const e of S.ItemInfo)Z+=e?.CrushHoriz>0?e?.W:e?.RW;S.AvlSpace=wpdSetFixed(100*(S.W-Z)),void 0!==L&&"SHELF"==S.ObjType&&(L.AvlSpace=S.AvlSpace)}"ROD"==S.ObjType&&"Y"==m&&(S.AvlSpace=wpdSetFixed(S.D-G.D),void 0!==(L=g_world.getObjectById(S.SObjID))&&"ROD"==S.ObjType&&(L.AvlSpace=S.AvlSpace));update_item_label(s,f,d,H,g_show_item_label,c,h,D,"N"),A=add_wireframe(H,2);H.WFrameID=A;show_single_item_desc(s,f,d,g_pog_json[D].ModuleInfo[s].ShelfInfo[f].ItemInfo[d],H,g_camera,c,g,D);("F"!==u||"F"==u&&1==v)&&add_item_borders(s,f,d,H,o,t,-1,D,"N");M=g_world.getObjectById(H.id);"E"==H.DimUpdate&&void 0!==H.DimUpdate?(M.BorderColour=g_dim_error_color,M.WireframeObj.material.color.setHex(M.BorderColour)):"N"==nvl(H.Status)?(M.BorderColour=g_status_error_color,M.Status="N",M.WireframeObj.material.color.setHex(M.BorderColour)):"No"==nvl(H.MovingItem)&&"Y"==g_pogcr_auto_hlite_non_mv_item?(M.BorderColour=g_nonMovingItemColor,M.WireframeObj.material.color.setHex(M.BorderColour)):nvl(H.OOSPerc)>80&&"Y"==g_pogcr_enbl_oos_border?(M.BorderColour=g_pogcr_oos_border_color,M.WireframeObj.material.color.setHex(M.BorderColour)):M.BorderColour=0;var Q=S.ObjType;if(!(void 0===C&&""===C||"Y"!=g_show_peg_tags||"HANGINGBAR"!=Q&&"PEGBOARD"!=Q))show_pegTages("N",S.ItemInfo[d],M,s,f,d,D);_(H.id),logDebug("function : add_items_prom","E")}))}catch(e){logDebug("function : add_items_prom","E"),error_handling(e)}}function add_items(e,o,t,n,r,i,a,I,s,f,d,l,m){try{logDebug("function : add_items; uuid : "+e+"; width : "+o+"; height : "+t+"; depth : "+n+"; color : "+r+"; x : "+i+"; y : "+a+"; z : "+I+"; p_module_index : "+s+"; p_shelf_index : "+f+"; i_item_index : "+d+"; rotation : "+l,"S");var _=parseInt(r.replace("#","0x"),16),p=new THREE.Color(_),g=g_pog_json[m].ModuleInfo[s].ShelfInfo[f],c=(l=g.Rotation,g.Slope);if(0!==l||0!==c){items=new THREE.Mesh(new THREE.BoxGeometry(o,t,n),new THREE.MeshStandardMaterial({color:p})),0!==g.ItemInfo[d].Rotation&&"DIVIDER"==g.ItemInfo[d].Item&&items.rotateY(g.ItemInfo[d].Rotation*Math.PI/180);var h=g_world.getObjectById(g.SObjID);"PEGBOARD"==g.ObjType?(i=0-g.W/2+(g.ItemInfo[d].PegBoardX+o/2),a=0-g.H/2+(g.ItemInfo[d].PegBoardY+t/2),I=.01+n/2):(i=wpdSetFixed(0-(g.W/2-o/2-g.ItemInfo[d].Distance)),a=wpdSetFixed(g.H/2+t/2),I=wpdSetFixed(g.D/2-n/2)),g.ItemInfo[d].RotationX=i,g.ItemInfo[d].RotationY=a,g.ItemInfo[d].RotationZ=I,items.applyMatrix4((new THREE.Matrix4).makeTranslation(i,a,I)),g_scene.updateMatrixWorld(),items.matrixAutoUpdate=!1,items.applyMatrix4(h.matrix),items.FixelID=g.ItemInfo[d].ItemID,items.Module=g_pog_json[m].ModuleInfo[s].Module,items.POGCode=g_pog_json[m].POGCode,items.Version=g_pog_json[m].Version,items.X=wpdSetFixed(100*g.ItemInfo[d].X-100*g.ItemInfo[d].W/2),items.Y=wpdSetFixed(100*g.ItemInfo[d].Y-100*g.ItemInfo[d].H/2),items.Z=wpdSetFixed(100*g.ItemInfo[d].Z),items.Desc=g.Desc,g_world.add(items),h.updateMatrix();var D=new THREE.Vector3;D.setFromMatrixPosition(items.matrixWorld),g.ItemInfo[d].ItemRotateWorldX=D.x,g.ItemInfo[d].ItemRotateWorldY=D.y,g.ItemInfo[d].ItemRotateWorldZ=D.z}else{items=new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshStandardMaterial({color:p})),items.position.x=i,items.position.z=.001+g.D/1e3,items.position.y=a,items.uuid=e;var S=g.ItemInfo[d];items.FixelID=S.ItemID,items.Module=g_pog_json[m].ModuleInfo[s].Module,items.W=S.W,items.H=S.H,items.D=S.D,items.Color=S.Color,items.Rotation=0,items.ItemSlope=0,items.Rotation=0!==l||0!==c?"Y":"N",items.ImageExists="N",items.POGCode=g_pog_json[m].POGCode,items.Version=g_pog_json[m].Version,items.X=wpdSetFixed(100*g.ItemInfo[d].X-100*g.ItemInfo[d].W/2),items.Y=wpdSetFixed(100*g.ItemInfo[d].Y-100*g.ItemInfo[d].H/2),items.Z=wpdSetFixed(100*g.ItemInfo[d].Z),items.Desc=g.Desc,g_world.add(items)}add_wireframe(items,2);add_item_borders(s,f,d,items,o,t,-1,m,"N");var u=g_pog_json[m].ModuleInfo[s].ShelfInfo,O=0,b="N",H=!1;for(const e of u){if(e.Shelf==g.ItemInfo[d].ItemID){g_pog_json[m].ModuleInfo[s].ShelfInfo[O].ShelfDivObjID=items.id,e.DivHeight>0&&("Y"==e.DivPbtwFace||"Y"==e.DivPed||"Y"==e.DivPst)&&(b="Y",H=!0);break}O++}if(H||g.DivHeight>0&&("Y"==g.DivPbtwFace||"Y"==g.DivPed||"Y"==g.DivPst)&&(b="Y"),show_div_id="undefined"!==g.NoDivIDShow&&"Y"==b?g.NoDivIDShow:"N","Y"==g_show_fixel_label&&"N"==show_div_id){var C=g.ItemInfo[d].Color;if(null==hexToRgb(C))parseInt("FF",16),parseInt("FF",16),parseInt("FF",16);else hexToRgb(C).r,hexToRgb(C).r,hexToRgb(C).g;"#ffffff";var j=addlabelText(g.ItemInfo[d].ItemID,g_labelFont,g_labelActualSize,"#ffffff","center","");items.add(j),j.position.x=0,j.position.y=0,0!==g.Rotation||0!==g.Slope?j.position.z=g.ItemInfo[d].D/2+.005:j.position.z=.005,g.ItemInfo[d].LObjID=j.id;u=g_pog_json[m].ModuleInfo[s].ShelfInfo;$.each(u,(function(e,o){if(o.Shelf==g.ItemInfo[d].ItemID)return g_pog_json[m].ModuleInfo[s].ShelfInfo[e].LObjID=j.id,!1}))}return logDebug("function : add_items","E"),items.id}catch(e){error_handling(e)}}async function update_item_distance(e,o,t,n="N"){logDebug("function : update_item_distance; p_module_index : "+e+"; p_shelf_index : "+o,"S");try{if("Y"==n)var r=g_pog_json[t].ModuleInfo[e].ChestInfo[o];else r=g_pog_json[t].ModuleInfo[e].ShelfInfo[o];var i=r.ItemInfo,a=r.ObjType,I=r.X-r.W/2,s=r.Y+r.H/2,f=r.Y-r.H/2,d=r.BsktSpreadProduct;"BASKET"==a&&"BT"==d?$.each(i,(function(e,o){r.ItemInfo[e].Distance=o.Y-o.H/2-s})):"PEGBOARD"==a||"CHEST"==a&&"Y"==g_chest_as_pegboard?$.each(i,(function(e,o){r.ItemInfo[e].PegBoardX=o.X-o.W/2-I,r.ItemInfo[e].PegBoardY=o.Y-o.H/2-f,r.ItemInfo[e].Distance=o.X-o.W/2-I})):$.each(i,(function(e,o){r.ItemInfo[e].Distance=o.X-o.W/2-I,r.ItemInfo[e].YDistance=o.Y-s})),logDebug("function : update_item_distance","E")}catch(e){error_handling(e)}}async function set_all_items(e,o,t,n,r,i,a,I,s,f){logDebug("function : set_all_items; p_module_index : "+e+"; p_shelf_index : "+o+"; a : "+t+"; y : "+n+"; p_shelf_edit_flag : "+r+"; resetType : "+i+"; set_axis : "+a,"S");try{var d=g_pog_json[I].ModuleInfo[e].ShelfInfo[o];if(d.ItemInfo.length>0&&"Y"==r){var l=d.ItemInfo,m=d.W,_=d.H,p=(d.D,d.ObjType),g=(d.SpreadItem,d.BsktSpreadProduct),c=d.Rotation,h=d.Slope,D=0,S=0;if(0!==c&&"N"!==c||0!==h){var u=0,O=g_scene_objects[s].scene.children[2].getObjectById(d.SObjID);for(const e of l){var b=g_scene_objects[s].scene.children[2].getObjectById(e.ObjID),H=e.RotationX,C=(n=e.RotationY,e.RotationZ),j=new THREE.Vector3(H,n,C).applyMatrix4(O.matrixWorld);b.position.x=j.x,b.position.y=j.y,b.position.z=j.z,b.quaternion.copy(O.quaternion),b.updateMatrix();var v=new THREE.Vector3;v.setFromMatrixPosition(b.matrixWorld),isNaN(v.x)||(d.ItemInfo[u].ItemRotateWorldX=v.x,d.ItemInfo[u].ItemRotateWorldY=v.y,d.ItemInfo[u].ItemRotateWorldZ=v.z),u+=1}render(I)}else if("BASKET"==p&&"BT"==g){u=0;for(const e of l){void 0!==(O=g_scene_objects[s].scene.children[2].getObjectById(e.ObjID))&&(D=t-m/2+e.W/2,S=n+_/2+e.Distance+e.H/2,O.position.set(D,S,O.position.z),"Y"==a&&(d.ItemInfo[u].X=D,d.ItemInfo[u].Y=S)),u++}}else if("HANGINGBAR"==p){u=0;for(const e of l){void 0!==(O=g_scene_objects[s].scene.children[2].getObjectById(e.ObjID))&&(D=t-m/2+e.Distance+e.W/2,S=n-e.H/2,O.position.set(D,S,O.position.z),"Y"==a&&(d.ItemInfo[u].X=D,d.ItemInfo[u].Y=S)),u++}}else if("ROD"==g_shelf_object_type){u=0;for(const e of l){void 0!==(O=g_scene_objects[s].scene.children[2].getObjectById(e.ObjID))&&(D=t,S=n-_/2-e.H/2,O.position.set(D,S,O.position.z),"Y"==a&&(d.ItemInfo[u].X=D,d.ItemInfo[u].Y=S)),u++}}else if("PEGBOARD"==g_shelf_object_type||"CHEST"==g_shelf_object_type&&"Y"==g_chest_as_pegboard){u=0;for(const e of l){void 0!==(O=g_scene_objects[s].scene.children[2].getObjectById(e.ObjID))&&(D=t-m/2+e.PegBoardX+e.W/2,S=n-_/2+e.PegBoardY+e.H/2,O.position.set(D,S,.016),"Y"==a&&(d.ItemInfo[u].X=D,d.ItemInfo[u].Y=S)),u++}}else{u=0;for(const e of l){var x=e.OldItemHeight;if("E"==i?null==x&&(x=e.H):x=e.H,void 0!==(O=g_scene_objects[s].scene.children[2].getObjectById(e.ObjID))){if(void 0!==e.BottomObjID&&""!==e.BottomObjID){var B;for(const o of l){if(B=o.OldItemHeight,"E"==i?void 0===B&&(B=o.H):B=o.H,e.BottomObjID==o.ObjID){D=t-m/2+o.Distance+o.W/2,S=n+_/2+e.TotalHeight+e.H/2;break}0}}else D=t-m/2+e.Distance+e.W/2,S=n+_/2+x/2;"BASKET"==p&&"DIVIDER"==e.Item&&(S=n+_/2+e.YDistance+e.H/2,O.position.set(D,S,g_drag_z)),"PALLET"==p?(O.position.x=D,O.position.y=S):"Y"===f?O.position.set(D,S):O.position.set(D,S,g_drag_z),"Y"==a&&(d.ItemInfo[u].X=D,d.ItemInfo[u].Y=S),d.ItemInfo[u].H=x}u++}}}logDebug("function : set_all_items","E")}catch(e){error_handling(e)}}function get_similar_items(e,o,t,n="N"){try{logDebug("function : get_similar_items; desc : "+e+"; p_type : "+o,"S");var r=[];if("N"==n){if(g_pog_json.length>0){var i=0;for(const t of g_pog_json){for(const t of g_pog_json[i].ModuleInfo){if(null==t.ParentModule){if(void 0!==t.Carpark&&void 0!==t.Carpark[0]&&t.Carpark[0].ItemInfo.length>0){for(const n of t.Carpark[0].ItemInfo){if("I"==o&&n.Item==e||"D"==o&&0!=nvl(n.Desc)&&-1!==n.Desc.search(e))void 0!==(a=g_scene_objects[i].scene.children[2].getObjectById(n.ObjID))&&r.push(a);0}}for(const n of t.ShelfInfo){if("BASE"!==n.ObjType&&"NOTCH"!==n.ObjType&&"DIVIDER"!==n.ObjType&&"TEXTBOX"!==n.ObjType){for(const t of n.ItemInfo){if("I"==o&&t.Item==e||"D"==o&&0!=nvl(t.Desc)&&-1!==t.Desc.search(e))void 0!==(a=g_scene_objects[i].scene.children[2].getObjectById(t.ObjID))&&r.push(a);0}}0}}0}i++}}}else{for(const n of g_pog_json[t].ModuleInfo){if(null==n.ParentModule){if(void 0!==n.Carpark&&void 0!==n.Carpark[0]&&n.Carpark[0].ItemInfo.length>0){for(const i of n.Carpark[0].ItemInfo){if("I"==o&&i.Item==e||"D"==o&&0!=nvl(i.Desc)&&-1!==i.Desc.search(e))void 0!==(a=g_scene_objects[t].scene.children[2].getObjectById(i.ObjID))&&r.push(a);0}}for(const i of n.ShelfInfo){if("BASE"!==i.ObjType&&"NOTCH"!==i.ObjType&&"DIVIDER"!==i.ObjType&&"TEXTBOX"!==i.ObjType){for(const n of i.ItemInfo){var a;if("I"==o&&n.Item==e||"D"==o&&0!=nvl(n.Desc)&&-1!==n.Desc.search(e))void 0!==(a=g_scene_objects[t].scene.children[2].getObjectById(n.ObjID))&&r.push(a);0}}0}}0}}return logDebug("function : get_similar_items","E"),r}catch(e){error_handling(e)}}function reorder_items(e,o,t){logDebug("function : reorder_items; p_module_index : "+e+"; p_shelf_index : "+o,"S");try{var n=g_pog_json[t].ModuleInfo[e].ShelfInfo[o],r=n.ObjType,[i,a]=[-1,-1];items_arr=JSON.parse(JSON.stringify(n.ItemInfo)),items_arr.forEach((e=>e.SpreadItem=0)),temp_item_arr=[];var I=n.SpreadItem,s=n.HorizGap,f=(wpdSetFixed(n.Y+n.H/2),0),d=0,l=n.W;H=wpdSetFixed(n.X-l/2-n.LOverhang),shelf_end=wpdSetFixed(n.X+l/2+n.ROverhang),l=wpdSetFixed(n.W+n.LOverhang+n.ROverhang);var m,_=[],p="N",g=-1,c=0;if("SHELF"!=r&&"HANGINGBAR"!=r||"N"===n.Combine||([i,a]=getCombinationShelf(t,n.Shelf)),I=-1!==i&&-1!==a?g_combinedShelfs[i].SpreadItem:I,-1===i||-1===a||"E"!=I&&"F"!=I){if(n.ItemInfo.length>0&&"ROD"!==r&&"PEGBOARD"!==r&&("CHEST"!=r||"Y"!=g_chest_as_pegboard)){var h=0;if("HANGINGBAR"==r){h=0;for(const r of n.ItemInfo){if("Y"==p)break;var D=wpdSetFixed(r.Y+r.H/2),S=wpdSetFixed(r.Y-r.H/2),u=0;for(const n of g_pog_json[t].ModuleInfo[e].ShelfInfo){if(n.ItemInfo.length>0&&"HANGINGBAR"==n.ObjType&&u!==o&&n.Y<D&&n.Y>S){p="Y",m="B",g=u;break}u++}h++}if("N"==p){var O=n;h=0;for(const n of g_pog_json[t].ModuleInfo[e].ShelfInfo){if("Y"==p)break;if("HANGINGBAR"==n.ObjType&&h!==o){u=0;for(const e of n.ItemInfo){D=wpdSetFixed(e.Y+e.H/2),D=wpdSetFixed(e.Y+e.H/2),S=e.Y-e.H/2;if(O.Y<D&&O.Y>S){p="Y",m="T",g=h;break}u++}}h++}}}if("N"==p||"Y"==p&&"B"==m){if("E"==I||"F"==I||"L"==I)if(!items_arr.some((e=>"Y"===e.Fixed))||"HANGINGBAR"!=r&&"SHELF"!=r){if("E"==I||"F"==I){d=0;items_arr=n.ItemInfo;u=0;for(const e of items_arr)void 0!==e.BottomObjID&&""!==e.BottomObjID&&"HANGINGBAR"!==r||(e.BHoriz>1&&"F"==I?f+=e.CrushHoriz>0?e.W:e.RW:f+=e.W,d+="E"==I?1:e.BHoriz),u++;if(d>0)B=wpdSetFixed((l-f)/(d-1))<0?0:wpdSetFixed((l-f)/(d-1));else B=wpdSetFixed(l-f)<0?0:wpdSetFixed(l-f);$.each(items_arr,(function(e,o){o.SpreadItem=wpdSetFixed(B)}))}}else reorderShelfWithFixedItem(n,H,shelf_end,I,s,items_arr);else if("R"==I){if(!items_arr.some((e=>"Y"===e.Fixed))||"HANGINGBAR"!=r&&"SHELF"!=r){for(h=items_arr.length-1;h>=0;h--)items_arr[h].IIndex=h,items_arr[h].NotFixed="N",_.push(items_arr[h]);n.ItemInfo.splice(0);h=0;for(const e of _)"N"==e.NotFixed&&n.ItemInfo.splice(0,0,e),h++}else reorderShelfWithFixedItem(n,H,shelf_end,I,s,items_arr)}}else{var b=n,H=b.X-b.W/2,C=100;h=0;for(const o of g_pog_json[t].ModuleInfo[e].ShelfInfo[g].ItemInfo){D=wpdSetFixed(o.Y+o.H/2),S=wpdSetFixed(o.Y-o.H/2);b.Y<D&&b.Y>S&&(C=Math.min(C,o.X-o.W/2)),h++}l=C-H;if("E"==I||"F"==I){d=0;items_arr=n.ItemInfo;u=0;for(const e of items_arr)void 0!==e.BottomObjID&&""!==e.BottomObjID&&"HANGINGBAR"!==r||(e.BHoriz>1&&"F"==I?f+=e.W+s*(e.BHoriz-1):f+=e.W,d+="E"==I?1:e.BHoriz),u++;if(d>0)B=wpdSetFixed((l-f)/(d-1))<0?0:wpdSetFixed((l-f)/(d-1));else B=wpdSetFixed(l-f)<0?0:wpdSetFixed(l-f);$.each(items_arr,(function(e,o){o.SpreadItem=B}))}else if("R"==I){items_arr=n.ItemInfo;h=0;for(const e of items_arr)items.ShelfEnd=C,h++}}}}else{var j,v;c=g_combinedShelfs[i].length;s=0,l=0;for(var x=0;x<c;x++){v=g_combinedShelfs[i][x].MIndex,j=g_combinedShelfs[i][x].SIndex,l=l+(n=g_pog_json[t].ModuleInfo[v].ShelfInfo[j]).W+n.LOverhang+n.ROverhang,items_arr=n.ItemInfo;for(const e of items_arr)void 0!==e.BottomObjID&&""!=e.BottomObjID||(f+=e.W,d+="E"==I?1:e.BHoriz)}var B=0;d>1?B=(l-f)/(d-1)<=0?0:(l-f)/(d-1):1!==d&&(B=l-f<0?0:l-f);for(x=0;x<c;x++){v=g_combinedShelfs[i][x].MIndex,j=g_combinedShelfs[i][x].SIndex,n=g_pog_json[t].ModuleInfo[v].ShelfInfo[j],items_arr=n.ItemInfo;for(const e of items_arr)e.SpreadItem=B}}return logDebug("function : reorder_items","E"),!0}catch(e){error_handling(e)}}function get_item_xaxis(e,o,t,n,r,i,a,I,s,f,d,l,m,_,p,g="Y",c="N"){logDebug("function : get_item_xaxis; width : "+e+"; height : "+o+"; depth : "+t+"; shelf_obj_type : "+n+"; locationX : "+r+"; horiz_gap : "+i+"; spread_product : "+a+"; spread_gap : "+I+"; p_module_index : "+s+"; p_shelf_index : "+f+"; i_item_index : "+d+"; p_edit_ind : "+l+"; item_length : "+m+"; shelf_edit : "+_,"S");try{g_invalidPosition="N";var h=0,D=g_pog_json[p].ModuleInfo[s].ShelfInfo[f],S=D.ItemInfo[d].Fixed,u=D.BsktSpreadProduct,O=D.BsktFill,b=D.W,H=D.H,C=D.D,j=D.Y,v=D.ItemInfo[d].BottomObjID,x=D.ItemInfo,B=D.X-D.W/2,T=1,[E,w]=[-1,-1],M=g_pog_json[p].ModuleInfo[s].ShelfInfo[f],y=D.ItemInfo[d].BottomObjID;if("SHELF"!=M.ObjType&&"HANGINGBAR"!=M.ObjType||"N"===M.Combine||([E,w]=getCombinationShelf(p,M.Shelf),-1!==E&&-1!==w&&(T=g_combinedShelfs[E].length)),T>1){const e=g_combinedShelfs[E].Start,o=g_combinedShelfs[E].End;var F=0,R=0;Ce=getLastItemCombinedShelf(g_combinedShelfs[E],a,D.ItemInfo[d].ObjID),$.isEmptyObject(Ce)||(Ce.X,Ce.W,F=Ce.X-Ce.W/2,R=Ce.X+Ce.W/2),"R"==a?h=0!==F?F-D.ItemInfo[d].W/2:o-D.ItemInfo[d].W/2:"L"==a?h=0!==R?R+D.ItemInfo[d].W/2:e+D.ItemInfo[d].W/2:"E"==a||"F"==a?("F"==a&&D.ItemInfo[d].BHoriz>1&&0==D.ItemInfo[d].CrushHoriz?D.ItemInfo[d].W=D.ItemInfo[d].RW+D.ItemInfo[d].SpreadItem*(D.ItemInfo[d].BHoriz-1):"E"==a&&D.ItemInfo[d].BHoriz>1&&i>0&&0==D.ItemInfo[d].CrushHoriz&&(D.ItemInfo[d].W=D.ItemInfo[d].RW+i*(D.ItemInfo[d].BHoriz-1)),h=0!==R?R+D.ItemInfo[d].W/2+D.ItemInfo[d].SpreadItem:e+D.ItemInfo[d].W/2):"M"==a&&(h=D.ItemInfo[d].X)}else if("Y"==_)h=D.ItemInfo[d].X;else if(-1!==["SHELF","HANGINGBAR"].indexOf(n))if("R"==a){var W=D.ItemInfo[d].ObjID,N=D.ItemInfo[d].X,P=D.ItemInfo[d].Fixed;if(d==D.ItemInfo.length-1)if("N"==S||"B"==S){var Y=-1;if(void 0!==v&&""!==v)h=D.ItemInfo[get_shelf_item_ind(s,f,v,p)].X;else{if("HANGINGBAR"==n&&void 0!==D.ItemInfo[d].ShelfEnd)var z=D.ItemInfo[d].ShelfEnd;else z=D.X+D.W/2;h=z-e/2+D.ROverhang}}else h=D.ItemInfo[d].X;else if("N"==S||"B"==S){Y=-1;if(void 0!==v&&""!==v)h=D.ItemInfo[get_shelf_item_ind(s,f,v,p)].X;else{if("SHELF"==n){var A=0;for(const e of x)A>d&&(void 0===e.BottomObjID||""==e.BottomObjID)&&(Y=-1!==Y?Math.min(Y,A):A),A++}else Y=d+1;if(-1==Y){if("HANGINGBAR"==n&&void 0!==D.ItemInfo[d].ShelfEnd)z=D.ItemInfo[d].ShelfEnd;else z=D.X+D.W/2;h=z-e/2+D.ROverhang}else h=D.ItemInfo[Y].X-D.ItemInfo[Y].W/2-parseFloat(e)/2-I}}else h=D.ItemInfo[d].X;if("B"==g_isBookend&&W==g_movedObjID){h=D.ItemInfo[d].X;var G=D.ItemInfo[d].X+D.ItemInfo[d].W/2;if(d<D.ItemInfo.length-1){var X=D.ItemInfo[d+1].X-D.ItemInfo[d+1].W/2;G>X&&(h=X-e/2)}}h>N&&"B"==P&&(h=D.ItemInfo[d].X),h+e/2>L&&"Y"==g_validationFlag&&"N"==g_overhung_shelf_active?g_invalidPosition="Y":g_validationFlag="Y"}else if("L"==a){Y=-1;var L=D.X+D.W/2;W=D.ItemInfo[d].ObjID,P=D.ItemInfo[d].Fixed,N=D.ItemInfo[d].X;if(d>0)if("N"==S||"B"==S){Y=-1;void 0!==v&&""!==v&&(h=D.ItemInfo[get_shelf_item_ind(s,f,y,p)].X),void 0!==v&&""!=v||("SHELF"==n?$.each(x,(function(e,o){e<d&&(void 0===o.BottomObjID||""==o.BottomObjID)&&(Y=Math.max(Y,e))})):Y=d-1,h=-1==Y?B+parseFloat(e)/2-D.LOverhang:D.ItemInfo[Y].X+D.ItemInfo[Y].W/2+parseFloat(e)/2+I)}else h=D.ItemInfo[d].X;else if("N"==S||"B"==S){Y=-1;h=void 0!==v&&""!==v?D.ItemInfo[get_shelf_item_ind(s,f,y,p)].X:B+parseFloat(e)/2-D.LOverhang}else h=D.ItemInfo[d].X;if("B"==g_isBookend&&W==g_movedObjID){h=D.ItemInfo[d].X;var k=D.ItemInfo[d].X-D.ItemInfo[d].W/2;if(d>0){var V=D.ItemInfo[d-1].X+D.ItemInfo[d-1].W/2;k<V&&(h=V+e/2)}}h<N&&"B"==P&&(h=D.ItemInfo[d].X),h+e/2>L&&"Y"==g_validationFlag&&"N"==g_overhung_shelf_active?g_invalidPosition="Y":g_validationFlag="Y"}else if("E"==a||"F"==a){if("F"==a&&D.ItemInfo[d].BHoriz>1&&0==D.ItemInfo[d].CrushHoriz)D.ItemInfo[d].W=D.ItemInfo[d].RW+D.ItemInfo[d].SpreadItem*(D.ItemInfo[d].BHoriz-1);else if("E"==a&&D.ItemInfo[d].BHoriz>1&&i>0&&0==D.ItemInfo[d].CrushHoriz)D.ItemInfo[d].W=D.ItemInfo[d].RW+i*(D.ItemInfo[d].BHoriz-1);else if("F"==a&&D.ItemInfo[d].BHoriz>1&&"0"!==D.ItemInfo[d].Orientation){var U=D.ItemInfo[d],[Z,Q,q,K,J,ee]=get_new_orientation_dim(U.Orientation,U.OW,U.OH,U.OD);("H"==J&&0==U.CrushVert||"D"==J&&0==U.CrushD)&&(D.ItemInfo[d].W=D.ItemInfo[d].RW+D.ItemInfo[d].SpreadItem*(D.ItemInfo[d].BHoriz-1))}if(d>0)if("N"==S||"B"==S){Y=-1;if(void 0!==v&&""!==v)h=D.ItemInfo[get_shelf_item_ind(s,f,y,p)].X;else{if("SHELF"==n){A=0;for(const e of x)A<d&&(void 0===e.BottomObjID||""==e.BottomObjID)&&(Y=Math.max(Y,A)),A++}else Y=d-1;if(-1==Y)h=B+D.ItemInfo[d].W/2-D.LOverhang;else{var oe=D.ItemInfo[d],te=D.ItemInfo[Y],[ne,re,ie,ae,Ie,se]=get_new_orientation_dim(oe.Orientation,oe.OW,oe.OH,oe.OD),[fe,de,le,me,_e,pe]=get_new_orientation_dim(te.Orientation,te.OW,te.OH,te.OD);if(oe.CrushHoriz>0&&"0"==oe.Orientation)var ge=oe.RW*(1-oe.CrushHoriz/100)+oe.SpreadItem*(oe.BHoriz-1);else if("0"!==oe.Orientation&&"H"==Ie&&oe.CrushVert>0)ge=oe.RW*(1-oe.CrushVert/100)+oe.SpreadItem*(oe.BHoriz-1);else if("0"!==oe.Orientation&&"D"==Ie&&oe.CrushD>0)ge=oe.RW*(1-oe.CrushD/100)+oe.SpreadItem*(oe.BHoriz-1);else ge=oe.W;if(te.CrushHoriz>0&&"0"==te.Orientation)var ce=te.RW*(1-te.CrushHoriz/100)+te.SpreadItem*(te.BHoriz-1);else if("0"!==te.Orientation&&"H"==_e&&te.CrushVert>0)ce=te.RW*(1-te.CrushVert/100)+te.SpreadItem*(te.BHoriz-1);else if("0"!==te.Orientation&&"D"==_e&&te.CrushD>0)ce=te.RW*(1-te.CrushD/100)+te.SpreadItem*(te.BHoriz-1);else ce=te.W;if(h="F"==a?wpdSetFixed(te.X+ce/2+ge/2+oe.SpreadItem):wpdSetFixed(te.X+te.W/2+oe.W/2+oe.SpreadItem),d==D.ItemInfo.length-1&&"N"==g_overhung_shelf_active){const e=wpdSetFixed(D.X+D.W/2+D.ROverhang);wpdSetFixed(h+ge/2)>e&&(h=e-ge/2,"Y"===c&&"HANGINGBAR"===n||(oe.SpreadItem=wpdSetFixed(h-ge/2-(te.X+ce/2))))}}}}else h=D.ItemInfo[d].X;else{var he=0,De=!1;for(const e of D.ItemInfo)he=wpdSetFixed(he+e.W);if(he>wpdSetFixed(D.W+D.ROverhang+D.LOverhang)&&(De=!0),0==d&&De)h=wpdSetFixed(D.ItemInfo[d].W/2+(D.X-he/2)-D.LOverhang);else if("N"==S||"B"==S){Y=-1;if(void 0!==v&&""!==v)h=D.ItemInfo[get_shelf_item_ind(s,f,v,p)].X;else{if(D.ItemInfo[d].CrushHoriz>0&&D.ItemInfo[d].BHoriz>1&&"F"==a&&"0"==D.ItemInfo[d].Orientation)var Se=D.ItemInfo[d].RW*(1-D.ItemInfo[d].CrushHoriz/100)+D.ItemInfo[d].SpreadItem*(D.ItemInfo[d].BHoriz-1);else if(D.ItemInfo[d].BHoriz>1&&"F"==a&&"0"!==D.ItemInfo[d].Orientation){U=D.ItemInfo[d];var[Z,Q,q,K,J,ee]=get_new_orientation_dim(U.Orientation,U.OW,U.OH,U.OD),ue="H"==J?U.CrushVert:"D"==J?U.CrushD:U.CrushHoriz;Se=D.ItemInfo[d].RW*(1-ue/100)+D.ItemInfo[d].SpreadItem*(D.ItemInfo[d].BHoriz-1)}else Se=D.ItemInfo[d].W;h=wpdSetFixed(B+Se/2-D.LOverhang)}}else h=D.ItemInfo[d].X}}else"M"==a&&(h=D.ItemInfo[d].X);else if("BASKET"==n){var Oe=get_max_merch(s,f,d,"N",r,p),be=D.ItemInfo[d].Quantity;if("DIVIDER"!==D.ItemInfo[d].Item){if("LR"==u){if("T"==O||"M"==O)D.ItemInfo[d].W=D.ItemInfo[d].D*be,D.ItemInfo[d].H=Oe;else if("F"==O){var He=get_basket_fill_count(s,f,u,O,b,Oe,C,p);D.ItemInfo[d].W=D.ItemInfo[d].D*He,D.ItemInfo[d].H=Oe,D.ItemInfo[d].Quantity=He}if(0==d)h=B+parseFloat(D.ItemInfo[d].W)/2,D.ItemInfo[d].Y=j+H/2+D.ItemInfo[d].H/2;else{var Ce=D.ItemInfo[d-1].Item,je=d-1;k=B;"DIVIDER"==Ce?void 0!==D.ItemInfo[d-2]&&(je=d-2,k=D.ItemInfo[je].X+D.ItemInfo[je].W/2):k=D.ItemInfo[je].X+D.ItemInfo[je].W/2,h=k+parseFloat(D.ItemInfo[d].W)/2,D.ItemInfo[d].Y=j+H/2+D.ItemInfo[d].H/2}}else if("BT"==u){if("T"==O)D.ItemInfo[d].W=b,D.ItemInfo[d].H=.02,D.ItemInfo[d].Quantity=1;else if("F"==O){He=get_basket_fill_count(s,f,u,O,b,Oe,C,p);D.ItemInfo[d].W=b,D.ItemInfo[d].H=D.ItemInfo[d].OD*He,D.ItemInfo[d].Quantity=He}else"M"==O&&(D.ItemInfo[d].W=b,D.ItemInfo[d].H=D.ItemInfo[d].OD*be,D.ItemInfo[d].Quantity=be);if(h=B+parseFloat(D.ItemInfo[d].W)/2,0==d)D.ItemInfo[d].Y=j+H/2+D.ItemInfo[d].H/2,h=B+parseFloat(D.ItemInfo[d].W)/2;else h=B+parseFloat(D.ItemInfo[d].W)/2,"DIVIDER"==(Ce=D.ItemInfo[d-1].Item)?void 0!==D.ItemInfo[d-2]?(je=d-2,D.ItemInfo[d].Y=D.ItemInfo[je].Y+D.ItemInfo[je].H/2+parseFloat(D.ItemInfo[d].H)/2):D.ItemInfo[d].Y=j+H/2+D.ItemInfo[d].H/2:D.ItemInfo[d].Y=D.ItemInfo[d-1].Y+D.ItemInfo[d-1].H/2+parseFloat(D.ItemInfo[d].H)/2}else if("FB"==u){if(D.ItemInfo[d].W=b,D.ItemInfo[d].H=Oe,h=B+parseFloat(D.ItemInfo[d].W)/2,D.ItemInfo[d].Y=j+H/2+D.ItemInfo[d].H/2,"F"==O)He=get_basket_fill_count(s,f,"FB","F",b,Oe,C,p);else if(O="M")He=be;else He=1;D.ItemInfo[d].Quantity=He}}else h=(D.ItemInfo[d].Item,D.ItemInfo[d].X)}else if("CHEST"==n&&"N"==g_chest_as_pegboard||"PALLET"==n){var ve=D.ItemInfo[d].Exists,xe=D.ItemInfo[d].Dragged;let o;"PALLET"==n&&void 0!==v&&""!==v&&(o=get_shelf_item_ind(s,f,v,p)),"PALLET"==n&&void 0!==v&&""!==v&&o>=0?h=D.ItemInfo[o].X:"Y"==xe?h=1==m&&"N"==l?B+parseFloat(e)/2-D.LOverhang:m>1&&"N"==l?d>0?D.ItemInfo[d-1].X+D.ItemInfo[d-1].W/2+parseFloat(e)/2+I:B+parseFloat(e)/2-D.LOverhang:r+e/2>D.X+D.W/2?d!==g_edited_item_index?D.ItemInfo[d].X:d>0?D.ItemInfo[d-1].X+D.ItemInfo[d-1].W/2+parseFloat(e)/2+I:B+parseFloat(e)/2-D.LOverhang:D.ItemInfo[d].X:(D.ItemInfo[d].Dragged="Y",h="E"==ve?D.ItemInfo[d].X:d>0&&g_edited_item_index!==d?D.ItemInfo[d-1].X+D.ItemInfo[d-1].W/2+parseFloat(e)/2+I:g_edited_item_index!==d&&0==d?B+parseFloat(e)/2+D.LOverhang:g_edited_item_index==d&&"Y"==l?D.ItemInfo[d].X:r)}else h="ROD"==n?D.X:"PEGBOARD"==n||"CHEST"==n&&"Y"==g_chest_as_pegboard?find_pegboard_gap(e,o,D.ItemInfo[d].X,D.ItemInfo[d].Y,i,s,f,d,g_edited_item_index,"N",p,"Y",g_auto_x_space,g_auto_y_space,g):r;return logDebug("function : get_item_xaxis","E"),wpdSetFixed(h)}catch(e){error_handling(e)}}function get_item_xy(e,o,t,n,r){logDebug("function : get_item_xy; item_width : "+t+"; item_height : "+n,"S");try{var i=0,a=0;if("BASKET"==e.ObjType&&"BT"==e.BsktSpreadProduct)i=e.X-e.W/2+t/2,a=e.Y+e.H/2+o.Distance+n/2;else if("HANGINGBAR"==e.ObjType)i=e.X-e.W/2+o.Distance+t/2,a=e.Y-n/2;else if("ROD"==e.ObjType)i=e.X,a=e.Y-e.H/2-n/2;else if("PEGBOARD"==e.ObjType||"CHEST"==e.ObjType&&"Y"==g_chest_as_pegboard){var I=e.peg_vert_values,s=[];$.each(I,(function(o,t){s.push(e.Y+I[o])}));var f=o.Y+n/2;if(s.length>0)var d=s.reduce(((e,o)=>Math.abs(o-f)<Math.abs(e-f)?o:e));i=e.X-e.W/2+o.PegBoardX+t/2,a=parseFloat(d)-n/2,a=void 0!==o.PegBoardY&&""!==o.PegBoardY?e.Y-e.H/2+o.PegBoardY+n/2:parseFloat(d)-n/2}else i=e.X-e.W/2+o.Distance+t/2,a=e.Y+e.H/2+n/2;return"DIVIDER"==o.Item&&"BASKET"==e.ObjType&&(a=g_finalY),logDebug("function : get_item_xy","E"),[wpdSetFixed(i),wpdSetFixed(a)]}catch(e){throw error_handling(e),e}}async function recreate_all_items(e,o,t,n,r,i,a,I,s,f,d,l,m,_,p,g,c,h,D,S,u,O="Y",b="Y"){logDebug("function : recreate_all_items; p_module_index : "+e+"; p_shelf_index : "+o+"; shelf_obj_type : "+t+"; p_edit_ind : "+n+"; locationX : "+r+"; edit_item_index : "+i+"; item_length : "+a+"; shelf_edit : "+s+"; redoX : "+f+"; create_canvas : "+l,"S");try{var H=(B=g_pog_json[_].ModuleInfo[e].ShelfInfo[o]).SpreadItem,C=1,[j,v]=[-1,-1];j=-1,v=-1,"SHELF"!=B.ObjType&&"HANGINGBAR"!=B.ObjType||"N"===B.Combine||([j,v]=getCombinationShelf(_,B.Shelf)),-1!==j&&-1!==v&&(C=g_combinedShelfs[j].length,await setCombinedShelfItems(_,j,v,r,n,s,f,i,[])),g_world=g_scene_objects[_].scene.children[2];for(var x=0;x<C;x++){-1!==j&&-1!==v&&C>1&&(e=g_combinedShelfs[j][x].MIndex,o=g_combinedShelfs[j][x].SIndex,H=g_combinedShelfs[j].SpreadItem),console.log("recreate all items ",e,o,t,n,r,i,a,I,s,f,d,l,m,_);var B=g_pog_json[_].ModuleInfo[e].ShelfInfo[o],T=g_show_live_image,E=B.HorizGap,w=E,M=(B.Combine,B.Rotation,B.X-B.W/2),y=B.Y-B.H/2,F=[],R=0;if(-1!==d&&""!==d&&void 0!==d)F=d;else F=B.ItemInfo;if("SHELF"==B.ObjType&&("L"==B.SpreadItem||"R"==B.SpreadItem)&&"Y"==O){var W=0;for(item of B.ItemInfo){mergeAdjacentItems(_,e,o,W);W++}}var N=B.ItemInfo.length;W=0;for(const e of F){var P=g_world.getObjectById(e.ObjID);g_world.remove(P),e.W,W++}if(B.AvlSpace=B.W+B.LOverhang+B.ROverhang,"R"==H){F=B.ItemInfo;if("PEGBOARD"!==B.ObjType&&("CHEST"!=B.ObjType||"Y"!=g_chest_as_pegboard)){var Y=F.some((e=>"Y"===e.Fixed));if("R"!=H||!Y||"HANGINGBAR"!=B.ObjType&&"SHELF"!=B.ObjType){var z={X:"asc"};F.keySort(z)}}for(W=F.length-1;W>=0;W--){if(N-=1,R=get_item_xaxis(F[W].W,F[W].H,F[W].D,t,r,w,H,E,e,o,N,n,B.ItemInfo.length,s,_,b),"DIVIDER"==F[W].Item){var A=g_pog_json[_].ModuleInfo[e].ShelfInfo,G=-1,X=0;for(const e of A)e.Shelf==F[W].ItemID&&"DIVIDER"==e.ObjType&&(G=X),X++;G>-1&&(g_pog_json[_].ModuleInfo[e].ShelfInfo[G].X=R)}B.ItemInfo[N].Distance=R-F[W].W/2-M,("PEGBOARD"==B.ObjType||"CHEST"==B.ObjType&&"Y"==g_chest_as_pegboard)&&(B.ItemInfo[N].PegBoardX=R-F[W].W/2-M,B.ItemInfo[N].PegBoardY=B.ItemInfo[N].Y-F[W].H/2-y,B.ItemInfo[N].FromProductList="N"),B.ItemInfo[N].OldObjID=F[W].ObjID;var L=F[W].ObjID;if("Y"==T&&"DIVIDER"!==F[W].Item&&3!=F[W].MerchStyle){var k=g_orientation_json[B.ItemInfo[N].Orientation].split("###");Z=await add_items_with_image(F[W].ItemID,F[W].W,F[W].H,F[W].D,F[W].Color,R,F[W].Y,"",e,o,W,F[W].BHoriz,F[W].BVert,F[W].Item,parseInt(k[0]),parseInt(k[1]),"N",I,g,c,h,D,S,u,_)}else Z="DIVIDER"==F[W].Item?add_items(F[W].ItemID,F[W].W,F[W].H,F[W].D,F[W].Color,R,F[W].Y,"",e,o,W,F[W].Rotation,_):await add_items_prom(F[W].ItemID,F[W].W,F[W].H,F[W].D,F[W].Color,R,F[W].Y,"",e,o,W,"N",I,p,"",u,D,S,_);for(var V=0;V<g_combineItemModf.length;V++)g_combineItemModf[V].NewMIndex==e&&g_combineItemModf[V].NewSIndex==o&&g_combineItemModf[V].OldObjID==L&&(g_combineItemModf[V].NewObjID=Z);P=g_world.getObjectById(Z);"E"==F[W].DimUpdate?(P.BorderColour=g_dim_error_color,P.WireframeObj.material.color.setHex(P.BorderColour)):"N"==F[W].Status?(P.BorderColour=g_status_error_color,P.Status="N",P.WireframeObj.material.color.setHex(P.BorderColour)):"No"==nvl(F[W].MovingItem)&&"Y"==g_pogcr_auto_hlite_non_mv_item?(P.BorderColour=g_nonMovingItemColor,P.WireframeObj.material.color.setHex(P.BorderColour)):nvl(items.OOSPerc)>80&&"Y"==g_pogcr_enbl_oos_border?(P.BorderColour=g_pogcr_oos_border_color,P.WireframeObj.material.color.setHex(P.BorderColour)):P.BorderColour=0;var U=0;if(U="PEGBOARD"==B.ObjType?B.Z+B.D/2+F[W].D/2:"PALLET"==B.ObjType?"N"==B.ItemInfo[W].Edited?+F[W].D/2:B.ItemInfo[W].Z:.001+B.D/1e3,B.ItemInfo[W].X=R,B.ItemInfo[W].Z=U,B.ItemInfo[W].ObjID=Z,B.ItemInfo[W].CType=B.ObjType,void 0!==F[W].TopObjID&&""!==F[W].TopObjID||void 0!==F[W].BottomObjID&&""!==F[W].BottomObjID)reset_top_bottom_obj_id(""!==F[W].TopObjID&&void 0!==F[W].TopObjID?"BOTTOM":"TOP",L,Z,R,"N",_);"DIVIDER"==F[W].Item&&(g_pog_json[_].ModuleInfo[e].ShelfInfo[G].ShelfDivObjID=Z)}}else{W=0,F=B.ItemInfo;if("PEGBOARD"!==B.ObjType&&("CHEST"!=B.ObjType||"Y"!=g_chest_as_pegboard)){Y=F.some((e=>"Y"===e.Fixed));if("L"!=H||!Y||"HANGINGBAR"!=B.ObjType&&"SHELF"!=B.ObjType){z={X:"asc"};"Y"==g_allowItemSort&&F.keySort(z)}}for(const a of F){if(R=-1!==f&&W==i?f:get_item_xaxis(a.W,a.H,a.D,t,r,w,H,E,e,o,W,n,B.ItemInfo.length,s,_,b),"DIVIDER"==a.Item){A=g_pog_json[_].ModuleInfo[e].ShelfInfo,G=-1,X=0;for(const e of A)e.Shelf==a.ItemID&&"DIVIDER"==e.ObjType&&(G=X),X++;G>-1&&(g_pog_json[_].ModuleInfo[e].ShelfInfo[G].X=R)}B.ItemInfo[W].Distance=R-a.W/2-M,("PEGBOARD"==B.ObjType||"CHEST"==B.ObjType&&"Y"==g_chest_as_pegboard)&&(B.ItemInfo[W].PegBoardX=R-a.W/2-M,B.ItemInfo[W].PegBoardY=B.ItemInfo[W].Y-a.H/2-y,B.ItemInfo[W].FromProductList="N"),B.ItemInfo[W].OldObjID=a.ObjID;var Z;L=a.ObjID;if("Y"==T&&"DIVIDER"!==a.Item&&3!=F[W].MerchStyle){k=g_orientation_json[B.ItemInfo[W].Orientation].split("###");Z=await add_items_with_image(a.ItemID,a.W,a.H,a.D,a.Color,R,B.ItemInfo[W].Y,"",e,o,W,a.BHoriz,a.BVert,a.Item,parseInt(k[0]),parseInt(k[1]),"N",I,g,c,h,D,S,u,_)}else Z="DIVIDER"==a.Item?add_items(a.ItemID,a.W,a.H,a.D,a.Color,R,a.Y,"",e,o,W,a.Rotation,_):await add_items_prom(a.ItemID,a.W,a.H,a.D,a.Color,R,B.ItemInfo[W].Y,"",e,o,W,"N",I,p,"",u,D,S,_);for(V=0;V<g_combineItemModf.length;V++)g_combineItemModf[V].NewMIndex==e&&g_combineItemModf[V].NewSIndex==o&&g_combineItemModf[V].OldObjID==L&&(g_combineItemModf[V].NewObjID=Z);P=g_world.getObjectById(Z);if("E"==a.DimUpdate?(P.BorderColour=g_dim_error_color,P.WireframeObj.material.color.setHex(P.BorderColour)):"N"==a.Status?(P.BorderColour=g_status_error_color,P.Status="N",P.WireframeObj.material.color.setHex(P.BorderColour)):"No"==nvl(a.MovingItem)&&"Y"==g_pogcr_auto_hlite_non_mv_item?(P.BorderColour=g_nonMovingItemColor,P.WireframeObj.material.color.setHex(P.BorderColour)):nvl(a.OOSPerc)>80&&"Y"==g_pogcr_enbl_oos_border?(P.BorderColour=g_pogcr_oos_border_color,P.WireframeObj.material.color.setHex(P.BorderColour)):P.BorderColour=0,U="PEGBOARD"==B.ObjType?B.Z+B.D/2+a.D/2:"PALLET"==B.ObjType?"N"!=a.Edited||void 0!==a.TopObjID&&""!=a.TopObjID||void 0!==a.BottomObjID||""!=a.BottomObjID?B.ItemInfo[W].Z:+a.D/2:.001+B.D/1e3,B.ItemInfo[W].X=R,B.ItemInfo[W].Z=U,B.ItemInfo[W].ObjID=Z,B.ItemInfo[W].CType=B.ObjType,void 0!==a.TopObjID&&""!==a.TopObjID||void 0!==a.BottomObjID&&""!==a.BottomObjID)reset_top_bottom_obj_id(""!==a.TopObjID&&void 0!==a.TopObjID?"BOTTOM":"TOP",L,Z,R,"N",_);"DIVIDER"==a.Item&&G>-1&&(g_pog_json[_].ModuleInfo[e].ShelfInfo[G].ShelfDivObjID=Z),W+=1}console.log("finished loop ",e,o,B.Shelf,getDateTime())}F=B.ItemInfo;W=0;for(const e of F){if(void 0!==e.TopObjID&&""!==e.TopObjID||void 0!==e.BottomObjID&&""!==e.BottomObjID)reset_top_bottom_obj_id(""!==e.TopObjID&&void 0!==e.TopObjID?"BOTTOM":"TOP",e.OldObjID,e.ObjID,e.X,"Y",_);W+=1}if("SHELF"==B.ObjType||"PALLET"==B.ObjType)reset_top_bottom_objects(e,o,"N",_);if(""==m)await calculateFixelAndSupplyDays("N",_);"Y"==g_show_live_image&&g_canvas_objects.length>0&&animate_pog(_),g_item_edit_flag="",g_item_index=""}return logDebug("function : recreate_all_items","E"),R}catch(e){console.log("err",e),error_handling(e)}}async function reset_top_bottom_obj_id(e,o,t,n,r,i){logDebug("function : reset_top_bottom_obj_id; tier_ind : "+e+"; old_id : "+o+"; new_id : "+t+"; bottom_x : "+n+"; reset : "+r,"S");var a=g_pog_json[i].ModuleInfo,I=0;for(const d of a){if(null==d.ParentModule||"undefined"==d.ParentModule){var s=0;for(const a of d.ShelfInfo){if(void 0!==a&&("SHELF"==a.ObjType||"PALLET"==a.ObjType)&&a.ItemInfo.length>0){var f=0;for(const d of a.ItemInfo)"Y"==r&&"BOTTOM"==e&&d.BottomObjID==t&&(g_pog_json[i].ModuleInfo[I].ShelfInfo[s].ItemInfo[f].X=n,selected_object=g_world.getObjectById(g_pog_json[i].ModuleInfo[I].ShelfInfo[s].ItemInfo[f].ObjID),selected_object.position.set(n,d.Y,.001+g_pog_json[i].ModuleInfo[I].ShelfInfo[s].D/1e3)),"TOP"==e&&d.TopObjID==o&&"N"==r?g_pog_json[i].ModuleInfo[I].ShelfInfo[s].ItemInfo[f].TopObjID=t:"BOTTOM"==e&&d.BottomObjID==o&&(g_pog_json[i].ModuleInfo[I].ShelfInfo[s].ItemInfo[f].BottomObjID=t),f++}s++}}I++}return logDebug("function : reset_top_bottom_obj_id","E"),"SUCCESS"}async function set_item_capping(e,o,t,n,r,i){logDebug("function : set_item_capping; i_item_index : "+n,"S");try{if("Y"==r&&void 0!==g_json[0]&&g_json.length>0)if(void 0!==g_json[0].ModuleInfo[o].ShelfInfo[t])var a=(f=(s=g_json[0].ModuleInfo[o].ShelfInfo[t]).ItemInfo[n]).RH*f.BVert,I=f.RD*f.BaseD;else a=(f=(s=g_pog_json[e].ModuleInfo[o].ShelfInfo[t]).ItemInfo[n]).RH,I=f.RD;else{var s,f;a=(f=(s=g_pog_json[e].ModuleInfo[o].ShelfInfo[t]).ItemInfo[n]).RH,I=f.RD}var d=-1,l=g_pog_json[e].ModuleInfo[o],m=0,_=0,p=0,g="N",c=0,h=0;if(("1"==f.CapStyle||"2"==f.CapStyle||"3"==f.CapStyle)&&"SHELF"==s.ObjType){var D=f.CapMerch;if("Y"==r&&void 0!==g_json[0])var S=get_onload_max_merch(o,t,l,s,g_dft_max_merch,0,g_json);else S=get_cap_max_merch(o,t,l,s,e,g_dft_max_merch);h=S;var u=f.CapMaxH,O=(D=""==f.CapMerch?"0":f.CapMerch,""==f.CapOrientaion?"4":f.CapOrientaion);"0"==D?wpdSetFixed(f.UW)!==wpdSetFixed(f.OrgUW)||wpdSetFixed(f.UH)!==wpdSetFixed(f.OrgUH)||wpdSetFixed(f.UD)!==wpdSetFixed(f.OrgUD)?(_=f.OrgUW,p=f.OrgUH,c=f.OrgUD):(_=f.UW,p=f.UH,c=f.UD):"2"==D?wpdSetFixed(f.CW)!==wpdSetFixed(f.OrgCW)||wpdSetFixed(f.CH)!==wpdSetFixed(f.OrgCH)||wpdSetFixed(f.CD)!==wpdSetFixed(f.OrgCD)?(_=f.OrgCW,p=f.OrgCH,c=f.OrgCD):(_=f.CW,p=f.CH,c=f.CD):"1"==D?wpdSetFixed(f.TW)!==wpdSetFixed(f.OrgTW)||wpdSetFixed(f.TH)!==wpdSetFixed(f.OrgTH)||wpdSetFixed(f.TD)!==wpdSetFixed(f.OrgTD)?(_=f.OrgTW,p=f.OrgTH,c=f.OrgTD):(_=f.TW,p=f.TH,c=f.TD):"3"==D&&(wpdSetFixed(f.DW)!==wpdSetFixed(f.OrgDW)||wpdSetFixed(f.DH)!==wpdSetFixed(f.OrgDH)||wpdSetFixed(f.DD)!==wpdSetFixed(f.OrgDD)?(_=f.OrgDW,p=f.OrgDH,c=f.OrgDD):(_=f.DW,p=f.DH,c=f.DD));var[b,H,C,j,v,x]=get_new_orientation_dim(O,_,p,c),B=p,T=""!==f.CapDepth&&f.CapDepth>1?parseInt(f.CapDepth):1;B*T>I&&(f.CapDepth=Math.trunc(I/C)),p="W"==j?_:c;var E=""!==f.CapFacing&&f.CapFacing>0&&f.CapFacing>u&&u>0?parseInt(u):parseInt(f.CapFacing);"1"==f.CapStyle?(S-=a,d=Math.trunc(S/p),I<C&&(d=0),d>0&&(m=a+p*(d=1))):"2"==f.CapStyle?(S-=a,d=Math.trunc(S/p),"2"==f.MaxHCapStyle&&d>u&&u>0&&(d=u),d=d>0?"Y"==f.MCapTopFacing&&E>0?E:d:0,I<C&&(d=0),d>0&&(m=a+p*d)):"3"==f.CapStyle&&(S-=a/f.BVert,d=Math.trunc(S/p),"3"==f.MaxHCapStyle&&d>u&&u>0&&(d=u),d=d>0?"Y"==f.MCapTopFacing&&E>0?E:d:0,I<C&&(d=0),d>0&&(m=a/f.BVert+p*d,f.BVert=1))}if(0==_&&0==p&&0==c&&"Y"==i)g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapMerch=D,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapOrientaion=O;else if(d>0){var w=f.BHoriz,M=d*w*T;if("Y"==i){g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapFacing=d,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapMerch=D,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapOrientaion=O,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapHeight=p,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].MCapTopFacing=f.MCapTopFacing,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapDepth=Math.trunc(I/C),g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapCount=d,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapHorz=w,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapTotalCount=M,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].H=m;var[y,F]=get_item_xy(s,f,f.W,f.H,e);g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].Y=F}}else if("Y"==i){g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapFacing=0,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapHeight=0,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].MCapTopFacing="N",g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapCount=0,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapHorz=0,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapDepth=0,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapTotalCount=0,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapStyle=f.CapStyle,g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].H=a;var[y,F]=get_item_xy(s,f,f.W,f.H,e);g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].Y=F}return h>=m&&(g="Y"),g}catch(e){error_handling(e)}}function maximizeItemDepthFacings(e,o,t,n,r){try{g_pog_json[r].ModuleInfo[o];var i=g_pog_json[r].ModuleInfo[o].ShelfInfo[t],a=g_pog_json[r].ModuleInfo[o].ShelfInfo[t].ItemInfo[n],I=findNearByShelfMaxDepth(o,t,n,n,-1,r),s=1,f=i.SpreadItem,d=i.HorizGap,l=a.NVal,m=void 0!==a.ItemNesting&&""!==a.ItemNesting?a.ItemNesting:"",_=a.HorizGap;if(("SHELF"==i.ObjType||"HANGINGBAR"==i.ObjType&&"Y"==g_auto_hangbar_facings||"PEGBOARD"==i.ObjType&&"Y"==i.AutoFillPeg||"CHEST"==i.ObjType)&&!(""!==a.TopObjID&&void 0!==a.TopObjID&&""!==a.BottomObjID&&void 0!==a.BottomObjID||"DIVIDER"===a.Item||"Y"!=g_auto_cal_depth_fac||"D"!=e&&"B"!=e)){var p,g=wpdSetFixed(a.RD/a.BaseD);"Y"==a.MDepthCrushed&&a.CrushD>0&&(g-=g*(a.CrushD/100));var c=(p="HANGINGBAR"==i.ObjType?0==i.MaxMerch||""==i.MaxMerch?g_hangbar_dft_maxmerch:i.MaxMerch:"PEGBOARD"==i.ObjType?0==i.MaxMerch||""==i.MaxMerch?g_pegboard_dft_item_depth:i.MaxMerch:"CHEST"==i.ObjType?i.BsktWallH:i.D)-I-g,h=nvl(a.MPogDepthFacings)>0?a.MPogDepthFacings:a.MDepthFacings;if("F"!==f&&0==d&&0==_&&0!==l&&""!==m&&"D"==a.ItemNesting?(s=h<(s=Math.floor(100*c/(100*l))+1)&&h>-1?h:s,g_pog_json[r].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].D=g+(s>0?s:1)*l):(s=h<(s=Math.floor(100*wpdSetFixed(p-I)/(100*g)))&&h>-1?h:s,g_pog_json[r].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].D=g*(s>0?s:1)),g_pog_json[r].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].RD=wpdSetFixed(a.RD/a.BaseD*(s>0?s:1)),"CHEST"==i.ObjType){var D=h<Math.trunc(i.BsktWallH/g)&&h>-1?h:Math.trunc(i.BsktWallH/g);g_pog_json[r].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].BaseD=D}else g_pog_json[r].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].BaseD=s>0?s:1;var S=g_pog_json[r].ModuleInfo[o].ShelfInfo[t].ItemInfo[n],u=""==S.CapOrientaion?"4":S.CapOrientaion,[O,b,H]=get_cap_dim(S),[C,j,v,x,B,T]=get_new_orientation_dim(u,O,b,H);"N"!=S.CapDepthChanged&&void 0!==S.CapDepthChanged||(g_pog_json[r].ModuleInfo[o].ShelfInfo[t].ItemInfo[n].CapDepth=Math.trunc(a.RD/v))}}catch(e){throw error_handling(e),e}}function get_cap_dim(e){try{var o=0,t=0,n=0,r=""==e.CapMerch?"0":e.CapMerch;return"0"==r?wpdSetFixed(e.UW)!==wpdSetFixed(e.OrgUW)||wpdSetFixed(e.UH)!==wpdSetFixed(e.OrgUH)||wpdSetFixed(e.UD)!==wpdSetFixed(e.OrgUD)?(o=e.OrgUW,t=e.OrgUH,n=e.OrgUD):(o=e.UW,t=e.UH,n=e.UD):"2"==r?wpdSetFixed(e.CW)!==wpdSetFixed(e.OrgCW)||wpdSetFixed(e.CH)!==wpdSetFixed(e.OrgCH)||wpdSetFixed(e.CD)!==wpdSetFixed(e.OrgCD)?(o=e.OrgCW,t=e.OrgCH,n=e.OrgCD):(o=e.CW,t=e.CH,n=e.CD):"1"==r?wpdSetFixed(e.TW)!==wpdSetFixed(e.OrgTW)||wpdSetFixed(e.TH)!==wpdSetFixed(e.OrgTH)||wpdSetFixed(e.TD)!==wpdSetFixed(e.OrgTD)?(o=e.OrgTW,t=e.OrgTH,n=e.OrgTD):(o=e.TW,t=e.TH,n=e.TD):"3"==r&&(wpdSetFixed(e.DW)!==wpdSetFixed(e.OrgDW)||wpdSetFixed(e.DH)!==wpdSetFixed(e.OrgDH)||wpdSetFixed(e.DD)!==wpdSetFixed(e.OrgDD)?(o=wpdSetFixed(e.OrgDW),t=wpdSetFixed(e.OrgDH),n=wpdSetFixed(e.OrgDD)):(o=wpdSetFixed(e.DW),t=wpdSetFixed(e.DH),n=wpdSetFixed(e.DD))),[o,t,n]}catch(e){throw error_handling(e),e}}