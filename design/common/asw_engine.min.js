function backupPog(e,o,t,a){1==g_curr_canvas&&"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&(g_pogBackup=[],backDetail=[],backDetail.backupType=e,"S"==e?(backDetail.shelfIndex=o,backDetail.moduleIndex=t,backDetail.push(JSON.parse(JSON.stringify(g_pog_json[a].ModuleInfo[t].ShelfInfo[o])))):(backDetail.shelfIndex=-1,backDetail.moduleIndex=-1,backDetail.push(JSON.parse(JSON.stringify(g_pog_json[a])))),g_pogBackup.push(backDetail))}function get_min_max_xy_module(e,o,t,a,n,l,r){logDebug("function : get_min_max_xy_module; p_module_index : "+o+"; width : "+t+"; height : "+a+"; moduleX : "+n,"S");try{var _=0,i=0,d=0,s=0,g=0,f=0,p=0,I=-1,c=-1;if(a<=.2){if(_=t,i=0,d=a,s=0,e.ShelfInfo.length>0){var h=0;for(const a of e.ShelfInfo){"BASE"!==a.ObjType&&"NOTCH"!==a.ObjType&&"DIVIDER"!==a.ObjType&&("TEXTBOX"==a.ObjType&&a.W<l||1==r||"TEXTBOX"!==a.ObjType&&r>1)&&"N"==a.SplitChest&&(0!==a.Rotation||0!==a.Slope?(g=a.ShelfRotateWidth,f=a.ShelfRotateHeight):(g=a.W,f=a.H),"TEXTBOX"==a.ObjType&&p<a.H&&(p=a.H,I=o,c=h));var m=a.X-(n-t/2);_=Math.max(_,m+g/2),i=Math.min(i,m-g/2),d=Math.max(d,a.Y+f/2),s=Math.min(s,a.Y-f/2),h++}}if(0!==nvl(e.ChestInfo)&&e.ChestInfo.length>0){h=0;for(const a of e.ChestInfo){0!==a.Rotation||0!==a.Slope?(g=a.ShelfRotateWidth,f=a.ShelfRotateHeight):(g=a.W,f=a.H),"TEXTBOX"==a.ObjType&&p<a.H&&(p=a.H,I=o,c=h);m=a.X-(n-t/2);_=Math.max(_,m+g/2),i=Math.min(i,m-g/2),d=Math.max(d,a.Y+f/2),s=Math.min(s,a.Y-f/2),h++}}var u=parseFloat(_)-parseFloat(i),S=parseFloat(d)-parseFloat(s);if(-1!==I&&-1!==c)var v=e.ShelfInfo[c].X-(n-t/2),j=e.ShelfInfo[c].Y;else v=u/2,j=S/2}else{if(_=t,i=0,d=a,s=0,e.ShelfInfo.length>0){h=0;for(const o of e.ShelfInfo){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&("TEXTBOX"==o.ObjType&&o.W<l||1==r||"TEXTBOX"!==o.ObjType&&r>1)&&"N"==o.SplitChest){0!==o.Rotation||0!==o.Slope?(g=o.ShelfRotateWidth,f=o.ShelfRotateHeight):(g=o.W,f=o.H);m=o.X-(n-t/2);_=Math.max(_,m+g/2),i=Math.min(i,m-g/2),d=Math.max(d,o.Y+f/2),s=Math.min(s,o.Y-f/2);for(const e of o.ItemInfo){var M=e.X-(n-t/2);_=Math.max(_,M+e.W/2),i=Math.min(i,M-e.W/2),d=Math.max(d,e.Y+e.H/2),s=Math.min(s,e.Y-e.H/2)}}h++}}if(0!==nvl(e.ChestInfo)&&e.ChestInfo.length>0){h=0;for(const o of e.ChestInfo){0!==o.Rotation||0!==o.Slope?(g=o.ShelfRotateWidth,f=o.ShelfRotateHeight):(g=o.W,f=o.H);m=o.X-(n-t/2);_=Math.max(_,m+g/2),i=Math.min(i,m-g/2),d=Math.max(d,o.Y+f/2),s=Math.min(s,o.Y-f/2);for(const e of o.ItemInfo){M=e.X-(n-t/2);_=Math.max(_,M+e.W/2),i=Math.min(i,M-e.W/2),d=Math.max(d,e.Y+e.H/2),s=Math.min(s,e.Y-e.H/2)}h++}}i-=1,_+=1,s-=1,d+=1;u=parseFloat(_)-parseFloat(i),S=parseFloat(d)-parseFloat(s),v=parseFloat(i)+u/2,j=parseFloat(s)+S/2}return logDebug("function : get_min_max_xy_module","E"),u+"###"+S+"###"+v+"###"+j+"###"+i+"###"+s+"###"+_+"###"+d}catch(e){error_handling(e)}}function get_actual_mod_xy(e,o,t,a){logDebug("function : get_module_final_xy;   width : "+o+"; height : "+t+"S");try{console.log(e,o,t,a);var n=0,l=0,r=o,_=a,i=t,d=0;if(e.ShelfInfo.length>0){for(const o of e.ShelfInfo){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType){0!==o.Rotation||0!==o.Slope?(n=o.ShelfRotateWidth,l=o.ShelfRotateHeight):(n=o.W,l=o.H);var s=o.X;r=Math.max(r,s+n/2),_=Math.min(_,s-n/2),i=Math.max(i,o.Y+l/2),d=Math.min(d,o.Y-l/2);for(const e of o.ItemInfo){var g=e.X;r=Math.max(r,g+e.W/2),_=Math.min(_,g-e.W/2),i=Math.max(i,e.Y+e.H/2),d=Math.min(d,e.Y-e.H/2)}}0}}var f=parseFloat(r)-parseFloat(_),p=parseFloat(i)-parseFloat(d),I=f/2,c=p/2;return logDebug("function : get_module_final_xy","E"),f+"###"+p+"###"+I+"###"+c+"###"+_+"###"+d+"###"+r+"###"+i}catch(e){error_handling(e)}}function get_min_max_xy_combine(e,o){logDebug("function : get_min_max_xy","S");try{var t=0,a=0,n=0,l=0,r=0,_=0,i=0,d=-1,s=-1;if(void 0!==e&&e.length>0)if(e[0].H<=.2){console.log("if",e[0].H),t=e[0].W,a=0,n=e[0].H,l=0;var g=0;for(const c of e[0].ModuleInfo){if(void 0===c.ParentModule||null==c.ParentModule){if(void 0!==e[0].ModuleInfo[g].Carpark&&null!==e[0].ModuleInfo[g].Carpark&&e[0].ModuleInfo[g].Carpark.length>0){var f=0;for(const e of c.Carpark){0!==e.Rotation||0!==e.Slope?(r=void 0===e.ShelfRotateWidth?e.W:e.ShelfRotateWidth,_=void 0===e.ShelfRotateHeight?e.W:e.ShelfRotateHeight):(r=e.W,_=e.H),"TEXTBOX"==e.ObjType&&i<e.H&&(i=e.H,d=g,s=f),t=Math.max(t,e.X+r/2-o),a=Math.min(a,e.X-r/2-o),n=Math.max(n,e.Y+_/2),l=Math.min(l,e.Y-_/2);var p=0;for(const r of e.ItemInfo)t=Math.max(t,r.X+r.W/2-o),a=Math.min(a,r.X-r.W/2-o),n=Math.max(n,r.Y+r.H/2),l=Math.min(l,r.Y-r.H/2),p=p++;f=f++}}if(console.log("0",0,g),e[0].ModuleInfo[g].ShelfInfo.length>0){var I=0;for(const e of c.ShelfInfo)"BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&(0!==e.Rotation||0!==e.Slope?(r=void 0===e.ShelfRotateWidth?e.W:e.ShelfRotateWidth,_=void 0===e.ShelfRotateHeight?e.W:e.ShelfRotateHeight):(r=e.W,_=e.H),"TEXTBOX"==e.ObjType&&i<e.H&&(i=e.H,d=g,s=I)),t=Math.max(t,e.X+r/2-o),a=Math.min(a,e.X-r/2-o),n=Math.max(n,e.Y+_/2),l=Math.min(l,e.Y-_/2),I++}}g++}var c=parseFloat(t)-parseFloat(a),h=parseFloat(n)-parseFloat(l);if(-1!==d&&-1!==s)var m=e[0].ModuleInfo[d].ShelfInfo[s].X,u=e[0].ModuleInfo[d].ShelfInfo[s].Y;else m=parseFloat(a)+c/2,u=parseFloat(l)+h/2}else{t=e[0].W,a=0,n=e[0].H,l=0;g=0;for(const c of e[0].ModuleInfo){if(void 0===c.ParentModule||null==c.ParentModule){if(void 0!==e[0].ModuleInfo[g].Carpark&&null!==e[0].ModuleInfo[g].Carpark&&e[0].ModuleInfo[g].Carpark.length>0){f=0;for(const e of c.Carpark){0!==e.Rotation||0!==e.Slope?(r=void 0===e.ShelfRotateWidth?e.W:e.ShelfRotateWidth,_=void 0===e.ShelfRotateHeight?e.W:e.ShelfRotateHeight):(r=e.W,_=e.H),"TEXTBOX"==e.ObjType&&i<e.H&&(i=e.H,d=g,s=f),t=Math.max(t,e.X+r/2-o),a=Math.min(a,e.X-r/2-o),n=Math.max(n,e.Y+_/2),l=Math.min(l,e.Y-_/2);p=0;for(const r of e.ItemInfo)t=Math.max(t,r.X+r.W/2-o),a=Math.min(a,r.X-r.W/2-o),n=Math.max(n,r.Y+r.H/2),l=Math.min(l,r.Y-r.H/2),p++;f++}}if(e[0].ModuleInfo[g].ShelfInfo.length>0){I=0;for(const e of c.ShelfInfo){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType){0!==e.Rotation||0!==e.Slope?(r=void 0===e.ShelfRotateWidth?e.W:e.ShelfRotateWidth,_=void 0===e.ShelfRotateHeight?e.W:e.ShelfRotateHeight):(r=e.W,_=e.H),t=Math.max(t,e.X+r/2-o),a=Math.min(a,e.X-r/2-o),n=Math.max(n,e.Y+_/2),l=Math.min(l,e.Y-_/2);p=0;"TEXTBOX"==e.ObjType&&(e.ItemInfo=[]);for(const r of e.ItemInfo)t=Math.max(t,r.X+r.W/2-o),a=Math.min(a,r.X-r.W/2-o),n=Math.max(n,r.Y+r.H/2),l=Math.min(l,r.Y-r.H/2),p++}I++}}}g++}c=parseFloat(t)-parseFloat(a),h=parseFloat(n)-parseFloat(l),m=parseFloat(a)+c/2,u=parseFloat(l)+h/2}return logDebug("function : get_min_max_xy","E"),c+"###"+h+"###"+m+"###"+u+"###"+a+"###"+l}catch(e){error_handling(e)}}function get_min_max_xy(e){logDebug("function : get_min_max_xy","S");try{var o=0,t=0,a=0,n=0,l=0,r=0,_=0,i=-1,d=-1;if("undefined"!=typeof g_pog_json&&g_pog_json.length>0)if(g_pog_json[e].H<=.2){console.log("if",g_pog_json[e].H),o=g_pog_json[e].W,t=0,a=g_pog_json[e].H,n=0;var s=0;for(const I of g_pog_json[e].ModuleInfo){if(void 0===I.ParentModule||null==I.ParentModule){if(void 0!==g_pog_json[e].ModuleInfo[s].Carpark&&null!==g_pog_json[e].ModuleInfo[s].Carpark&&g_pog_json[e].ModuleInfo[s].Carpark.length>0){var g=0;for(const e of I.Carpark){0!==e.Rotation||0!==e.Slope?(l=void 0===e.ShelfRotateWidth?e.W:e.ShelfRotateWidth,r=void 0===e.ShelfRotateHeight?e.W:e.ShelfRotateHeight):(l=e.W,r=e.H),"TEXTBOX"==e.ObjType&&_<e.H&&(_=e.H,i=s,d=g),o=Math.max(o,e.X+l/2),t=Math.min(t,e.X-l/2),a=Math.max(a,e.Y+r/2),n=Math.min(n,e.Y-r/2);var f=0;for(const l of e.ItemInfo)o=Math.max(o,l.X+l.W/2),t=Math.min(t,l.X-l.W/2),a=Math.max(a,l.Y+l.H/2),n=Math.min(n,l.Y-l.H/2),f=f++;g=g++}}if(console.log("p_pog_index",e,s),g_pog_json[e].ModuleInfo[s].ShelfInfo.length>0){var p=0;for(const e of I.ShelfInfo)"BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&(0!==e.Rotation||0!==e.Slope?(l=void 0===e.ShelfRotateWidth?e.W:e.ShelfRotateWidth,r=void 0===e.ShelfRotateHeight?e.W:e.ShelfRotateHeight):(l=e.W,r=e.H),"TEXTBOX"==e.ObjType&&_<e.H&&(_=e.H,i=s,d=p)),o=Math.max(o,e.X+l/2),t=Math.min(t,e.X-l/2),a=Math.max(a,e.Y+r/2),n=Math.min(n,e.Y-r/2),p++}}s++}var I=parseFloat(o)-parseFloat(t),c=parseFloat(a)-parseFloat(n);if(-1!==i&&-1!==d)var h=g_pog_json[e].ModuleInfo[i].ShelfInfo[d].X,m=g_pog_json[e].ModuleInfo[i].ShelfInfo[d].Y;else h=parseFloat(t)+I/2,m=parseFloat(n)+c/2}else{o=g_pog_json[e].W,t=0,a=g_pog_json[e].H,n=0;s=0;for(const I of g_pog_json[e].ModuleInfo){if(void 0===I.ParentModule||null==I.ParentModule){if(void 0!==g_pog_json[e].ModuleInfo[s].Carpark&&null!==g_pog_json[e].ModuleInfo[s].Carpark&&g_pog_json[e].ModuleInfo[s].Carpark.length>0){g=0;for(const e of I.Carpark){0!==e.Rotation||0!==e.Slope?(l=void 0===e.ShelfRotateWidth?e.W:e.ShelfRotateWidth,r=void 0===e.ShelfRotateHeight?e.W:e.ShelfRotateHeight):(l=e.W,r=e.H),"TEXTBOX"==e.ObjType&&_<e.H&&(_=e.H,i=s,d=g),o=Math.max(o,e.X+l/2),t=Math.min(t,e.X-l/2),a=Math.max(a,e.Y+r/2),n=Math.min(n,e.Y-r/2);f=0;for(const l of e.ItemInfo)o=Math.max(o,l.X+l.W/2),t=Math.min(t,l.X-l.W/2),a=Math.max(a,l.Y+l.H/2),n=Math.min(n,l.Y-l.H/2),f++;g++}}if(g_pog_json[e].ModuleInfo[s].ShelfInfo.length>0){p=0;for(const e of I.ShelfInfo){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType){0!==e.Rotation||0!==e.Slope?(l=void 0===e.ShelfRotateWidth?e.W:e.ShelfRotateWidth,r=void 0===e.ShelfRotateHeight?e.W:e.ShelfRotateHeight):(l=e.W,r=e.H),o=Math.max(o,e.X+l/2),t=Math.min(t,e.X-l/2),a=Math.max(a,e.Y+r/2),n=Math.min(n,e.Y-r/2);f=0;"TEXTBOX"==e.ObjType&&(e.ItemInfo=[]);for(const l of e.ItemInfo)o=Math.max(o,l.X+l.W/2),t=Math.min(t,l.X-l.W/2),a=Math.max(a,l.Y+l.H/2),n=Math.min(n,l.Y-l.H/2),f++}p++}}}s++}I=parseFloat(o)-parseFloat(t),c=parseFloat(a)-parseFloat(n),h=parseFloat(t)+I/2,m=parseFloat(n)+c/2}return logDebug("function : get_min_max_xy","E"),I+"###"+c+"###"+h+"###"+m+"###"+t+"###"+n}catch(e){error_handling(e)}}function add_chest_dots_array(e,o,t,a,n,l,r,_,i){var d=0+e/2-0,s=0-o/2+0,g=[],f=[],p=0+o/2-0,I=0-e/2+0;f.push(p);for(var c=0;c<1e3&&(p-=a)>s;c++)f.push(p);g.push(I);for(c=0;c<1e3&&(I+=parseFloat(l))<d;c++)g.push(I);g_pog_json[i].ModuleInfo[_].ShelfInfo[r].peg_vert_values=f,g_pog_json[i].ModuleInfo[_].ShelfInfo[r].peg_horiz_values=g}function add_dots_to_object(e,o,t,a,n,l,r,_,i,d,s,g,f="N",p){try{logDebug("function : add_dots_to_object","S");var I=.01,c=0+e/2-I,h=0-o/2+I,m=[],u=[],S=0+o/2-a-I,v=0-e/2+l+I;u.push(S);for(var M=0;M<1e3&&(S-=n)>h;M++)u.push(S);m.push(v);for(M=0;M<1e3&&(v+=parseFloat(r))<c;M++)m.push(v);var b=[];for(M=0;M<u.length;M++)for(j=0;j<m.length;j++)b.push(new THREE.Vector3(m[j],u[M],-1e-4));let O=(new THREE.BufferGeometry).setFromPoints(b);var x=new THREE.PointsMaterial({size:.03,color:0}),y=new THREE.Points(O,x);return y.position.z="N"==f?"N"==g?6e-4:t:t/2,_.add(y),"N"==f&&(y.uuid="pegdots","PEGBOARD"==i?(g_pog_json[p].ModuleInfo[s].ShelfInfo[d].peg_vert_values=u,g_pog_json[p].ModuleInfo[s].ShelfInfo[d].peg_horiz_values=m):(g_pog_json[p].ModuleInfo[s].peg_vert_values=u,g_pog_json[p].ModuleInfo[s].peg_horiz_values=m)),logDebug("function : add_dots_to_object","E"),_}catch(e){logDebug("function : add_dots_to_object","E"),error_handling(e)}}function add_dots_to_object_3d(e,o,t,a,n,l,r,_,i,d,s){return add_dots_to_object(e,o,t,a,n,l,r,_,i,d,s,null,null,"Y",g_pog_index)}function add_rod(e,o,t,a,n,l,r,_,i,d,s,g,f){logDebug("function : add_rod; uuid : "+e+"; type : "+o+"; width : "+t+"; height : "+a+"; depth : "+n+"; color : "+l+"; x : "+r+"; y : "+_+"; z : "+i+"; p_edit_ind : "+d+"; mod_index : "+s+"; shelf_ind : "+g,"S");try{var p;n=.001;var I=[],c=[];if("undefined"!=typeof g_module_width&&""!=g_module_width||(g_module_width=parseFloat(g_pog_json[f].ModuleInfo[s].W)),"Y"==d){var h=g_world.getObjectById(g_dblclick_objid);g_world.remove(h),p=g_shelf_index}else p=-1!==g?g:parseFloat(g_pog_json[f].ModuleInfo[s].ShelfInfo.length)-1;var m=g_pog_json[f].ModuleInfo[s].ShelfInfo[p],u=m.SObjID,S=new THREE.Mesh(new THREE.BoxGeometry(t,a,n),new THREE.MeshStandardMaterial({color:l}));I.push(0-t/2),I.push(t/2),I.push(0-t/2),I.push(t/2),c.push(0-a/2),c.push(a/2),c.push(a/2),c.push(0-a/2);var v=[];v.push(new THREE.Vector3(I[0],c[0],0)),v.push(new THREE.Vector3(I[1],c[1],0)),v.push(new THREE.Vector3(I[2],c[2],0)),v.push(new THREE.Vector3(I[3],c[3],0));let o=(new THREE.BufferGeometry).setFromPoints(v);var j=new THREE.LineBasicMaterial({color:14293787}),M=new THREE.LineSegments(o,j),b=new THREE.LineSegments(o,j);M.position.z=.001,b.position.z=.001,S.add(M),S.add(b);var x=add_wireframe(S,2);S.WFrameID=x,S.position.x=r,S.position.y=_,S.position.z=.008,S.uuid=e;var y=m;if(S.POGCode=g_pog_json[f].POGCode,S.Version=g_pog_json[f].Version,S.X=wpdSetFixed(100*y.X-100*y.W/2),"Y"==y.EditNotch?S.Y=wpdSetFixed(100*y.EditNotchY):S.Y=wpdSetFixed(100*y.Y-100*y.H/2),S.Z=wpdSetFixed(100*y.Z-100*y.D/2),S.AvlSpace=y.AvlSpace,S.FixelID=y.Shelf,S.Desc=y.Desc,S.Module=g_pog_json[f].ModuleInfo[s].Module,S.W=y.W,S.H=y.H,S.D=y.D,S.Color=y.Color,S.Rotation=0,S.ItemSlope=0,S.Rotation="N",S.ImageExists="N",S.BorderColour=0,g_world.add(S),m.LineVerticesX=I,m.LineVerticesY=c,m.SObjID=parseInt(S.id),m.WFrameID=x,"Y"==g_show_fixel_label&&"BASE"!==u&&"NOTCH"!==u){var O=m.Color;if(null==hexToRgb(O))var F=parseInt("FF",16),Y=parseInt("FF",16),T=parseInt("FF",16);else F=hexToRgb(O).r,Y=hexToRgb(O).r,T=hexToRgb(O).g;var D=getTextColor(F,Y,T),E=addlabelText(m.Shelf,g_labelFont,g_labelActualSize,D,"center","");S.add(E),E.position.x=0-(m.W/2.4+.01),E.position.y=0,E.position.z=.005,m.LObjID=E.id}return logDebug("function : add_rod","E"),parseInt(S.id)}catch(e){error_handling(e)}}function add_pegboard(e,o,t,a,n,l,r,_,i,d,s,g,f,p,I,c,h,m,u,S,v,j,M,b,x,y){logDebug("function : add_pegboard; uuid : "+e+"; width : "+o+"; height : "+t+"; depth : "+a+"; color : "+n+"; x : "+l+"; y : "+r+"; z : "+_+"; p_edit_ind : "+i+"; vert_start : "+d+"; vert_spacing : "+s+"; horz_start : "+g+"; horz_spacing : "+f+"; mod_index : "+p+"; shelf_ind : "+I+"; rotation : "+c+"; slope : "+h+"; recreate : "+m,"S");try{var O=0;if("Y"==i){var F=g_world.getObjectById(g_dblclick_objid);g_world.remove(F),O=g_shelf_index}else O=-1!==I?I:parseFloat(g_pog_json[y].ModuleInfo[p].ShelfInfo.length)-1;var Y=g_pog_json[y].ModuleInfo[p].ShelfInfo[O];Y.SObjID;if(0!==c||0!==h){g_rotation=c,h=h>0?0-h:-h,g_slope=h;var T=add_dots_to_object(o,t,7e-4,d,s,g,f,new THREE.Mesh(new THREE.BoxGeometry(o,t,.01),new THREE.MeshStandardMaterial({color:n})),"PEGBOARD",O,p,g_peg_holes_active,"N",y),D=0,E=0;if("Y"==m&&"N"==i){for(const e of g_pog_json[y].ModuleInfo)null==e.ParentModule&&(D=Math.max(D,parseFloat(e.X)+e.W/2)),E++;l=D+o/2,r=g_pog_json[y].CameraY}T.position.x=g_pog_json[y].CameraX,T.position.y=r,T.position.z=.00115,T.uuid=e;var w=Y;T.POGCode=g_pog_json[y].POGCode,T.Version=g_pog_json[y].Version,T.FixelID=w.Shelf,T.Module=g_pog_json[y].ModuleInfo[p].Module,T.W=w.W,T.H=w.H,T.D=w.D,T.X=wpdSetFixed(100*w.X-100*w.W/2),"Y"==w.EditNotch?T.Y=wpdSetFixed(100*w.EditNotchY):T.Y=wpdSetFixed(100*w.Y-100*w.H/2),T.Z=wpdSetFixed(100*w.Z-100*w.D/2),T.Color=w.Color,T.Rotation=c,T.ItemSlope=h,T.Rotation=0!==c||0!==h?"Y":"N",T.ImageExists="N",T.rotateY(c*Math.PI/180),T.rotateX(h*Math.PI/180);var H=add_wireframe(T,2);T.WFrameID=H,g_world.add(T),T.geometry.computeBoundingBox();T.geometry.boundingBox;var X=(new THREE.Box3).setFromObject(T).getSize(new THREE.Vector3);if(Y.WFrameID=H,Y.ShelfRotateWidth=parseFloat(X.x),Y.ShelfRotateHeight=parseFloat(X.y),Y.ShelfRotateDepth=parseFloat(X.z),"N"==g_manual_zoom_ind){var C=get_min_max_xy(y).split("###");set_camera_z(g_camera,parseFloat(C[2]),parseFloat(C[3]),parseFloat(C[0]),parseFloat(C[1]),g_offset_z,parseFloat(C[4]),parseFloat(C[5]),!0,y)}"Y"==m&&"N"==i&&(l=D+o/2,r=g_pog_json[y].CameraY),T.position.x=l,T.position.y=h<0?r+parseFloat(X.y)/2:r-parseFloat(X.y)/2,T.position.z=.00115,0!==c&&(T.quaternion.copy(g_camera.quaternion),T.lookAt(g_pog_json[y].CameraX,g_pog_json[y].CameraY,g_pog_json[y].CameraZ)),T.rotateY(c*Math.PI/180),T.rotateX(h*Math.PI/180),T.updateMatrix()}else{(T=add_dots_to_object(o,t,7e-4,d,s,g,f,new THREE.Mesh(new THREE.BoxGeometry(o,t,.001),new THREE.MeshStandardMaterial({color:n})),"PEGBOARD",O,p,g_peg_holes_active,"N",y)).position.x=l,T.position.y=r,T.position.z=.00115,T.uuid=e,T.POGCode=g_pog_json[y].POGCode,T.Version=g_pog_json[y].Version;w=Y;T.FixelID=w.Shelf,T.Module=g_pog_json[y].ModuleInfo[p].Module,T.W=w.W,T.H=w.H,T.D=w.D,T.X=wpdSetFixed(100*w.X-100*w.W/2),"Y"==w.EditNotch?T.Y=wpdSetFixed(100*w.EditNotchY):T.Y=wpdSetFixed(100*w.Y-100*w.H/2),T.Z=wpdSetFixed(100*w.Z-100*w.D/2),T.Color=w.Color,T.Rotation=c,T.ItemSlope=h,T.Rotation=0!==c||0!==h?"Y":"N",T.ImageExists="N";H=add_wireframe(T,2);T.WFrameID=H,g_world.add(T)}if(Y.SObjID=parseInt(T.id),T.BorderColour=0,"Y"==m&&Y.ItemInfo.length>0){var R=Y.ItemInfo;E=0;for(const e of R)Y.ItemInfo[E].Exists="E",E++;return_val=recreate_all_items(p,O,Y.ObjType,"Y",-1,-1,Y.ItemInfo.length,"N","N",y,[],g_start_canvas,"",y,u,S,v,j,M,b,x,"Y")}if("Y"==g_show_fixel_label){var W=Y.Color;if(null==hexToRgb(W))var N=parseInt("FF",16),P=parseInt("FF",16),k=parseInt("FF",16);else N=hexToRgb(W).r,P=hexToRgb(W).r,k=hexToRgb(W).g;var B=getTextColor(N,P,k),A=addlabelText(Y.Shelf,g_labelFont,g_labelActualSize,B,"center","");T.add(A);var V=A.material.map.image.width/A.material.map.image.height*g_labelActualSize/2;A.position.x=0-Y.W/2+V+.01,A.position.y=0,0!==Y.Rotation||0!==Y.Slope?A.position.z=Y.D/2+.005:A.position.z=.005,Y.LObjID=A.id}return Y.WFrameID=H,g_dblclick_opened="N",logDebug("function : add_pegboard","E"),parseInt(T.id)}catch(e){logDebug("function : add_pegboard","E"),error_handling(e)}}function get_y_distance(e,o,t,a,n,l){logDebug("function : get_y_distance; p_module_index : "+e+"; p_shelf_index : "+o+"; i_item_index : "+t+"; itemX : "+a+"; itemY : "+n,"S");try{var r=g_pog_json[l].ModuleInfo[e].ShelfInfo[o].ItemInfo,_=0;for(const e of r)wpdSetFixed(a)==wpdSetFixed(e.X)&&wpdSetFixed(e.Y)<wpdSetFixed(n)&&(_+=e.H);return logDebug("function : get_y_distance","E"),_}catch(e){error_handling(e)}}function get_canvas_json(e){try{return logDebug("function : get_canvas_json; loc : "+e,"S"),g_pog_json}catch(e){error_handling(e)}}function get_canvas_world(e){try{return logDebug("function : get_canvas_world; loc : "+e,"S"),g_world}catch(e){error_handling(e)}}function get_curr_canvas(){try{return logDebug("function : get_curr_canvas","S"),1==g_curr_canvas?(logDebug("function : get_curr_canvas","E"),document.getElementById("maincanvas")):(logDebug("function : get_curr_canvas","E"),document.getElementById("maincanvas1"))}catch(e){error_handling(e)}}function get_curr_renderer(){try{return logDebug("function : get_curr_renderer","S"),g_renderer}catch(e){error_handling(e)}}function get_canvas_camera(e){try{return logDebug("function : get_canvas_camera; loc : "+e,"S"),g_camera}catch(e){error_handling(e)}}async function get_all_images(e,o,t="N",a,n,l){try{var r;if(logDebug("function : get_all_images; ","S"),"undefined"!=typeof g_pog_json&&g_pog_json.length>0){r="Y"==t?0:e;var _=[];for(pogs of g_pog_json){var i=g_pog_json[r].ModuleInfo,d=0;if(null!==i)for(const e of i){if(void 0===e.ParentModule||null==e.ParentModule){if(void 0!==e.ShelfInfo&&null!==e.ShelfInfo&&e.ShelfInfo.length>0){j=0;for(const t of e.ShelfInfo){if("BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&"TEXTBOX"!==t.ObjType&&void 0!==t.ItemInfo&&null!==t.ItemInfo&&t.ItemInfo.length>0){for(const e of t.ItemInfo){var s=(u=g_orientation_json[e.Orientation]).split("###"),g=get_orientation_list(s[0]),f="N";for(const o of g_ItemImages){if(e.Item==o.Item&&s[0]==o.Orientation&&e.MerchStyle==o.MerchStyle){f="Y";break}0}if("1"==e.CapStyle||"2"==e.CapStyle||"3"==e.CapStyle){var p="N",I=void 0!==e.CapMerch&&""!==e.CapMerch?e.CapMerch:"0",c=void 0!==e.CapOrientaion&&""!==e.CapOrientaion?e.CapOrientaion:"0",h=g_orientation_json[c].split("###");for(const o of g_ItemImages){if(e.Item==o.Item&&h[0]==o.Orientation&&I==o.MerchStyle){p="Y";break}0}if("N"==p)"0"==I?m="U":"1"==I?m="T":"2"==I?m="C":"3"==I&&(m="D"),ItemImageInfo={},ItemImageInfo.Item=e.Item,ItemImageInfo.Orientation=h[0],ItemImageInfo.MerchStyle=m,_.push(ItemImageInfo)}if("N"==f)"0"==e.MerchStyle?m="U":"1"==e.MerchStyle?m="T":"2"==e.MerchStyle?m="C":"3"==e.MerchStyle&&(m="D"),ItemImageInfo={},ItemImageInfo.Item=e.Item,ItemImageInfo.Orientation=s[0],ItemImageInfo.MerchStyle=m,_.push(ItemImageInfo),"Y"==o&&(1==s[0]||2==s[0]||3==s[0]||8==s[0])&&(ItemImageInfo={},ItemImageInfo.Item=e.Item,ItemImageInfo.Orientation=g[0],ItemImageInfo.MerchStyle=m,_.push(ItemImageInfo),ItemImageInfo={},ItemImageInfo.Item=e.Item,ItemImageInfo.Orientation=g[1],ItemImageInfo.MerchStyle=m,_.push(ItemImageInfo),ItemImageInfo={},ItemImageInfo.Item=e.Item,ItemImageInfo.Orientation=g[2],ItemImageInfo.MerchStyle=m,_.push(ItemImageInfo));0}}j+=1}}if(null!==e.Carpark&&void 0!==e.Carpark&&void 0!==e.Carpark[0]&&null!==e.Carpark[0].ItemInfo&&e.Carpark[0].ItemInfo.length>0){for(const o of e.Carpark[0].ItemInfo){var m;s=(u=g_orientation_json[o.Orientation]).split("###"),f="N";for(const e of g_ItemImages){if(o.Item==e.Item&&s[0]==e.Orientation&&o.MerchStyle==e.MerchStyle){f="Y";break}0}if("N"==f)"0"==o.MerchStyle?m="U":"1"==o.MerchStyle?m="T":"2"==o.MerchStyle?m="C":"3"==o.MerchStyle&&(m="D"),ItemImageInfo={},ItemImageInfo.Item=o.Item,ItemImageInfo.Orientation=s[0],ItemImageInfo.MerchStyle=m,_.push(ItemImageInfo);0}}}d+=1}if("Y"!=t)break;r++}await get_all_image_ajax(_),d=0;for(var u of g_ItemImages){var S=new Image,v="";S.src="data:image/jpeg;base64,"+u.ItemImage,S.onload=function(){(async()=>{v=await async function(e){return(await resizeImage(e,parseFloat(a),parseFloat(n),parseFloat(l))).split(",")[1]}(S),d<=g_ItemImages.length-1&&(g_ItemImages[d].ItemImage=v)})()},d++}}return logDebug("function : get_all_images; ","E"),"SUCCESS"}catch(e){error_handling(e)}}function get_all_image_ajax(e){return new Promise((function(o,t){try{var a=new Date;logDebug("function : get_all_image_ajax; ","S"),apex.server.process("GET_IMAGE_CLOB",{p_clob_01:JSON.stringify(e)},{dataType:"html"}).done((function(e){""!==$.trim(e)?(g_ItemImages=g_ItemImages.concat(JSON.parse($.trim(e))),logDebug("function : get_all_image_ajax; ","E"),o("SUCESS")):(console.log("Image Not Found"),logDebug("function : get_all_image_ajax; ","E"),o("SUCESS"));var t=((new Date).getTime()-a.getTime())/1e3;console.log("Seconds Difference",t)})),logDebug("function : get_all_image_ajax ; ","E")}catch(e){error_handling(e)}}))}function setParams(e,o,t,a,n,l,r,_,i,d,s,g,f,p,I){e&&(g_labelFont=parseInt(e),g_labelActualSize=.0034375*e),o&&(g_status_error_color=parseInt(o.replace("#","0x"),16)),t&&(g_offset_z=parseFloat(t)),a&&(g_textbox_merge_pdf=a),n&&(g_auto_hangbar_facings=n),l&&(g_auto_apply_d_facings=l),r&&(g_auto_apply_v_facings=r),_&&(g_show_live_image=_),i&&(g_dim_error_color=parseInt(i.replace("#","0x"),16)),d&&(g_pogcr_auto_hlite_non_mv_item=d),s&&(g_show_desc_no_image=s),g&&(g_notch_label_position=g),f&&(g_fixel_label=f),I&&(g_dft_max_merch=I)}async function updateDaysOfSupply(e,o,t,a,n,l="N",r,_="N"){try{var i=0,d=0==nvl(e.RegMovement)?1:nvl(e.RegMovement),s=get_similar_items(e.ItemID,"I",r,"Y"),g=[],f=[];for(items of s)i+=items.VertFacing*items.HorizFacing*items.DFacing;var p=g_scene_objects[r].scene.children[2].getObjectById(e.ObjID);if(0!==nvl(p)&&0!==nvl(e.RegMovement)&&"0"!==e.RegMovement?(p.DaysOfSupply=parseFloat(i/d).toFixed(2),"N"==n?g_pog_json[r].ModuleInfo[a].ShelfInfo[t].ItemInfo[o].DaysOfSupply=parseFloat(p.DaysOfSupply).toFixed(2):g_pog_json[r].ModuleInfo[a].Carpark[0].ItemInfo[o].DaysOfSupply=parseFloat(p.DaysOfSupply).toFixed(2)):0!==nvl(p)&&(p.DaysOfSupply="","N"==n?(p.DaysOfSupply="0.00",g_pog_json[r].ModuleInfo[a].ShelfInfo[t].ItemInfo[o].DaysOfSupply="0.00"):g_pog_json[r].ModuleInfo[a].Carpark[0].ItemInfo[o].DaysOfSupply=""),"N"==n){var I=g_pog_json[r].ModuleInfo[a].ShelfInfo[t].ItemInfo[o];"Y"==l&&(g.push(g_pog_json[r].ModuleInfo[a].ShelfInfo[t].ItemInfo[o].ItemID),f.push(g_pog_json[r].ModuleInfo[a].ShelfInfo[t].ItemInfo[o].DaysOfSupply),await updatePOGItemInfoColl(g,f,r))}else I=g_pog_json[r].ModuleInfo[a].Carpark[0].ItemInfo[o];return I}catch(e){error_handling(e)}}async function auto_position_all(e,o,t,a,n){logDebug("function : auto_position_all","");try{if("undefined"!=typeof g_pog_json&&g_pog_json.length>0){g_pog_edited_ind="Y";var l=g_world,r=e;if("Y"==g_all_pog_flag)var _=0;else _=o;for(const l of g_pog_json){if(_!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex){void 0===t&&"N"==g_all_pog_flag?t=o:"Y"==g_all_pog_flag&&(t=_),g_world=g_scene_objects[_].scene.children[2],e=g_scene_objects[_].scene.children[0],T=g_pog_json[_].ModuleInfo,f=0;var i=[],d=[];for(const e of T){if((void 0===e.ParentModule||null==e.ParentModule)&&e.H>.1){var s={};s.ModStart=wpdSetFixed(e.X-e.W/2),s.ModEnd=wpdSetFixed(e.X+e.W/2),s.ModBottom=wpdSetFixed(e.Y-e.H/2),s.ModTop=wpdSetFixed(e.Y+e.H/2),s.ModX=e.X,s.ModIndex=f,s.Module=e.Module,s.ModWidth=e.W,s.MObjID=e.MObjID,d.push(s)}f+=1}g_cut_copy_arr=[];for(const e of d){var g=g_pog_json[_].ModuleInfo[e.ModIndex].ShelfInfo,f=0;for(shelfs of g)if("TEXTBOX"!==shelfs.ObjType&&"BASE"!==shelfs.ObjType&&"NOTCH"!==shelfs.ObjType&&"DIVIDER"!==shelfs.ObjType&&"ROD"!==shelfs.ObjType){var p=[];p.moduleIndex=e.ModIndex,p.shelfIndex=f,p.actionType="SHELF_DRAG",p.objectID=shelfs.SObjID,p.push(JSON.parse(JSON.stringify(shelfs))),p.moduleObjectID=e.MObjID,p.startCanvas=g_present_canvas,p.g_present_canvas=g_present_canvas,g_allUndoObjectsInfo.push(p)}f++}g_delete_details.multi_delete_shelf_ind="N",logFinalUndoObjectsInfo("SHELF_DRAG","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","Y"),g_allUndoObjectsInfo=[],f=0;for(const l of d){g=g_pog_json[_].ModuleInfo[l.ModIndex].ShelfInfo;var I=0;for(const r of g){if(r.ItemInfo.length>0&&update_item_distance(l.ModIndex,I,_,"N"),"BASE"!==r.ObjType&&"NOTCH"!==r.ObjType&&"DIVIDER"!==r.ObjType&&"ROD"!==r.ObjType&&("N"==a||"Y"==a)){var c=wpdSetFixed(r.X-r.W/2),h=wpdSetFixed(r.X+r.W/2),m="N";if((r.X>l.ModStart&&r.X<=l.ModEnd||c>=l.ModStart&&c<l.ModEnd||h>l.ModStart&&h<l.ModEnd)&&r.Y>l.ModBottom&&r.Y<l.ModTop||r.X>l.ModStart&&r.X<l.ModEnd&&(r.Y>l.ModTop||r.Y<l.ModBottom)?m="Y":g_pog_json[_].ModuleInfo[l.ModIndex].ShelfInfo[I].ShelfChangeReq="Y","Y"==m){await set_item_xy(r,l.ModIndex,I,o);var[u,S,v]=update_position_loc(r,l,I,l.ModIndex,l.ModIndex,e,_,g_scene_objects[t].scene.children[2],n);g_pog_json[_].ModuleInfo[l.ModIndex].ShelfInfo[I].ShelfChangeReq="N"}if("TEXTBOX"!==r.ObjType)var[j,M]=await set_shelf_after_drag(u,"Y",l.ModIndex,l.ModIndex,I,g_pog_json[_].ModuleInfo[l.ModIndex].ShelfInfo[I].X,g_pog_json[_].ModuleInfo[l.ModIndex].ShelfInfo[I].Y,"N","N","","",_,_,-1,"Y")}I+=1}f+=1}f=0;for(const o of d){var b=0;for(const a of T){if((void 0===a.ParentModule||null==a.ParentModule)&&a.H>.1){g=a.ShelfInfo,I=0;for(const a of g){if("BASE"!==a.ObjType&&"NOTCH"!==a.ObjType&&"DIVIDER"!==a.ObjType&&"ROD"!==a.ObjType&&"Y"==a.ShelfChangeReq&&"TEXTBOX"!==a.ObjType){c=wpdSetFixed(a.X-a.W/2),h=wpdSetFixed(a.X+a.W/2),m="N";var x="",y="",O="";if(f!==b&&c>o.ModStart&&c<o.ModEnd||h>o.ModStart&&h<o.ModEnd){m="Y",x=b,y=o.ModIndex,O=I,o.ModWidth,o.ModX;var[u,S,v]=update_position_loc(a,o,I,o.ModIndex,b,e,_,g_scene_objects[t].scene.children[2],n);"Y"!=u&&"R"!=u||(mod_detail={},mod_detail.MIndex=x,mod_detail.CurrIndex=y,mod_detail.SIndex=O,mod_detail.X=S,mod_detail.Y=v,mod_detail.Shelf=a.Shelf,mod_detail.ObjType=a.ObjType,i.push(mod_detail))}}I+=1}}b+=1}f+=1}if(void 0===i&&null!=i){f=0;for(const e of i){I=0;var F=-1,Y=-1,T=g_pog_json[_].ModuleInfo;for(const o of T){if((void 0===o.ParentModule||null==o.ParentModule)&&o.H>.1){g=o.ShelfInfo;var D=0;for(const o of g){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"ROD"!==o.ObjType&&o.Shelf==e.Shelf){F=I,Y=D;break}D+=1}}I+=1}if("TEXTBOX"!==e.ObjType)var[j,M]=await set_shelf_after_drag("Y","Y",F,e.CurrIndex,Y,e.X,e.Y,"Y","N","","",_,_,-1,"Y");f+=1}}var E=get_min_max_xy(_).split("###");set_camera_z(e,parseFloat(E[2]),parseFloat(E[3]),parseFloat(E[0]),parseFloat(E[1]),g_offset_z,parseFloat(E[4]),parseFloat(E[5]),!0,_),render(_)}if("Y"!=g_all_pog_flag)break;_++}g_world=l,e=r,async function(){await recreate_compare_views(g_compare_view,"N")}()}logDebug("function : auto_position_all","E")}catch(e){error_handling(e)}}function get_closest_peg(e,o,t,a,n){logDebug("function : get_closest_peg; item_height : "+e+"; p_module_index : "+o+"; p_shelf_index : "+t+"; p_final_y : "+a);var l=g_pog_json[n].ModuleInfo[o].ShelfInfo[t].peg_vert_values,r=g_pog_json[n].ModuleInfo[o].ShelfInfo[t].Y,_=[];$.each(l,(function(e,o){_.push(r+l[e])}));var i=a+e/2;if(_.length>0)var d=_.reduce(((e,o)=>Math.abs(o-i)<Math.abs(e-i)?o:e));return logDebug("function : get_closest_peg","E"),d}function get_top_y(e,o,t,a,n,l){var r=e-t,_=e+t,i=0,d=-1,s=-1;for(var g of o){if(i<a){var f=g.Y+g.H/2;f<=_&&f>=r&&l.X+l.W/2>g.X+g.W/2&&(d=f,s=i)}i++}return d>-1?d-=n/2:d=e-n/2,[d,s]}function find_pegboard_gap(e,o,t,a,n,r,_,i,d,s,g,f="Y",p,I,c){logDebug("function : find_pegboard_gap; width : "+e+"; height : "+o+"; locationX : "+t+"; locationY : "+a+"; horiz_gap : "+n+"; p_module_index : "+r+"; p_shelf_index : "+_+"; i_item_index : "+i+"; i_edited_item_index : "+d+"; validate : "+s,"S");try{var h=-1,m=g_pog_json[g].ModuleInfo[r].ShelfInfo[_].ItemInfo,u=g_pog_json[g].ModuleInfo[r].ShelfInfo[_],S=(m[i].Item,m.length),v=m[i].Exists,j=(m[i].X,m[i].FromProductList),M=(m[i].SameShelf,m[i].Edited),b=u.AllowOverLap,x=m[i].DropY,y=u.HorizSpacing,O=(u.VertiSpacing,u.HorizStart,u.AutoPlacing),F=u.Y+u.H/2+u.UOverHang,Y=u.Y-u.H/2-u.LoOverHang,T=u.X-u.W/2-u.LOverhang,D=u.X+u.W/2+u.ROverhang,E=u.peg_vert_values,w=u.peg_horiz_values,H=u.Y,X=-1!==x?x+o/2+.003:"",C=[],R=[],W=m,N="Y",P=0,k=0,B="N";void 0===O&&(O="N"),E.length>0&&$.each(E,(function(e,o){C.push(H+E[e])})),w.length>0&&$.each(w,(function(e,o){R.push(g_pog_json[g].ModuleInfo[r].ShelfInfo[_].X+w[e])}));var A=a+m[i].H/2;if(C.length>0)var V=C.reduce(((e,o)=>Math.abs(o-A)<Math.abs(e-A)?o:e));if("E"==v)h=m[i].X;else if("Y"==O&&"Y"==g_chest_as_pegboard&&"CHEST"==u.ObjType){var[h,z]=get_auto_placing_item_loc(r,_,g,i,e,o,p,I);-1!==h&&(m[i].X=h,m[i].Y=z,U="Y")}else if(void 0!==j&&"Y"==j||"Y"==g_pegbrd_auto_placing&&"Y"==M){if(0==i)h=T+e/2+y,"Y"==g_pegbrd_auto_placing&&"Y"==M?(h=t,z="N"==c?a:V-o/2):z=C[0]-o/2,m[i].Y=z,m[i].SecondTier="N",m[i].X=h;else if(S>1&&i>0){for(l=0;l<C.length&&!(h>-1)&&C[l]-o>Y;l++)if(console.log("peg_vert_details[l]",C[l],X,M),""!==X&&C[l]<=X&&"Y"==M||"N"==M||""==X){for(P=0;P<R.length&&R[P]+e<D;P++){"Y"==g_pegbrd_auto_placing&&"Y"==M?("CHEST"!==u.ObjType?(A=wpdSetFixed(t-e/2+.01),oe=wpdSetFixed(t+e/2+.01)):(A=wpdSetFixed(t-e/2),oe=wpdSetFixed(t+e/2)),q=wpdSetFixed(C[l]),K=wpdSetFixed(C[l]-o)):("CHEST"!==u.ObjType?(A=wpdSetFixed(R[P]+.01),oe=wpdSetFixed(R[P]+e+.01)):(A=wpdSetFixed(R[P]),oe=wpdSetFixed(R[P]+e)),q=wpdSetFixed(C[l]),K=wpdSetFixed(C[l]-o));k=0;var U="Y",G=-1;for(const e of W){if(k<i){if(div_start=wpdSetFixed(e.X-e.W/2),div_end=wpdSetFixed(e.X+e.W/2),J=wpdSetFixed(e.Y+e.H/2),(q>(Q=wpdSetFixed(e.Y-e.H/2))&&J>q||oe>D)&&"N"==O){U="N",g_prevX=P,g_prevY=l,G=k;break}if((div_start<oe&&div_start>=A||div_end>A&&div_end<=oe)&&(Q<q&&Q>=K||J<=q&&J>K)||(A<div_start&&oe>div_start||A<div_end&&oe>=div_end)&&q<=J&&K>=Q||(div_start<=A&&div_end>=oe||div_start>=A&&div_end<=oe)&&(J>=q&&K>=Q||J>=q&&Q<=K||J>q&&Q<=q)||A<div_start&&oe>=div_end&&q<=J&&q>Q&&K<=Q||A>div_start&&oe<=div_end&&q>=J&&K<J&&K<=Q||A<div_start&&oe>=div_end&&q<=J&&K>=Q||A<div_start&&oe>=div_end&&q<J&&q>Q||A>=div_start&&A<div_end&&K>=Q&&K<J){U="N",g_prevX=P,g_prevY=l,G=k;break}}k++}if("Y"==U){if(g_prevX++,g_prevY++,h=A+e/2,"CHEST"!==g_pog_json[g].ModuleInfo[r].ShelfInfo[_].ObjType&&T==A-.02&&(h-=.01),m[i].X=h,"CHEST"==u.ObjType&&"Y"==O){var[z,L]=get_top_y(q,W,.001,i,o,m[i]);m[i].Y=z-I}else m[i].Y="N"==c?a:q-o/2;m[i].SecondTier="Y",B="Y";break}if("Y"==b){var J=m[G].Y+m[G].H/2,Q=m[G].Y-m[G].H/2;if(q=a+m[i].H/2,(K=a-m[i].H/2)<m[G].Y&&J<K||q>m[G].Y&&q<J||J>a&&J<q||Q<a&&J>q){var Z=m[G].D*m[G].BaseD+m[i].D*m[i].BaseD;if(g_pog_json[g].ModuleInfo[r].ShelfInfo[_].MaxMerch>0){if(Z>g_pog_json[g].ModuleInfo[r].ShelfInfo[_].MaxMerch){N="D";break}N="Y",m[i].X=t,m[i].Y="N"==c?a:V-o/2;break}N="Y",m[i].X=t,m[i].Y="N"==c?a:V-o/2;break}N="Y",m[i].X=t,m[i].Y="N"==c?a:V-o/2;break}}if("Y"==B)break}}}else if("N"==v&&("N"==j||void 0===j)){var q=wpdSetFixed(m[i].Y+o/2),K=wpdSetFixed(m[i].Y-o/2),ee=m[i].X;isNaN(ee)&&(ee=g_final_x);A=wpdSetFixed(ee-e/2);var oe=wpdSetFixed(ee+e/2);m[i].ItemID,U="Y",k=0;for(const e of W){if(k!==i&&(div_start=wpdSetFixed(e.X-e.W/2),div_end=wpdSetFixed(e.X+e.W/2),J=wpdSetFixed(e.Y+e.H/2),Q=wpdSetFixed(e.Y-e.H/2),(div_start<oe&&div_start>=A||div_end>A&&div_end<=oe)&&(Q<q&&Q>=K||J<=q&&J>K)||(A<div_start&&oe>div_start||A<div_end&&oe>=div_end)&&q<=J&&K>=Q||(div_start<=A&&div_end>=oe||div_start>=A&&div_end<=oe)&&(J>=q&&K>=Q||J>=q&&Q<=K||J>q&&Q<=q)||A<div_start&&oe>=div_end&&q<=J&&q>Q&&K<=Q||A>div_start&&oe<=div_end&&q>=J&&K<J&&K<=Q||A<div_start&&oe>=div_end&&q<=J&&K>=Q||A<div_start&&oe>=div_end&&q<J&&q>Q||A>=div_start&&A<div_end&&K>=Q&&K<J)){U="N",G=k,console.log("items",e.Item,e.X,e.W),console.log("div_start ",div_start," div end ",div_end," div top ",J,"div bottom ",Q),console.log("item_start ",A," item end ",oe," item top ",q," item bottom ",K);break}k++}if("Y"==U){if(h="CHEST"!==u.ObjType?A+m[i].W/2+.002:ee,prevX=h,"CHEST"!==g_pog_json[g].ModuleInfo[r].ShelfInfo[_].ObjType){if("N"==g_mselect_drag&&"Y"==f)if("N"==c)z=a;else for(l=0;l<C.length;l++)if(C[l]<g_finalY+o/2){var te=wpdSetFixed(g_pog_json[g].ModuleInfo[r].ShelfInfo[_].X+g_pog_json[g].ModuleInfo[r].ShelfInfo[_].H/2);g_pog_json[g].ModuleInfo[r].ShelfInfo[_].UOverHang>0&&te<g_finalY+o/2&&te>g_finalY-o/2?m[i].Y=wpdSetFixed(C[l]):m[i].Y=wpdSetFixed(C[l])-o/2;break}}else"CHEST"!==u.ObjType&&T==A-.02&&(h-=.01),m[i].X=h,"N"==c&&"CHEST"!==u.ObjType?m[i].Y=a:m[i].Y=q-o/2;m[i].SecondTier="Y"}else if("Y"==b){J=m[G].Y+m[G].H/2,Q=m[G].Y-m[G].H/2;if(q=a+m[i].H/2,(K=a-m[i].H/2)<m[G].Y&&J<K||q>m[G].Y&&q<J||J>a&&J<q||Q<a&&J>q){Z=m[G].D*m[G].BaseD+m[i].D*m[i].BaseD;g_pog_json[g].ModuleInfo[r].ShelfInfo[_].MaxMerch>0&&Z>g_pog_json[g].ModuleInfo[r].ShelfInfo[_].MaxMerch?N="D":(N="Y",m[i].X=t,m[i].Y="N"==c?a:V-o/2)}else N="Y",m[i].X=t,m[i].Y="N"==c?a:V-o/2}if("Y"==U){q=wpdSetFixed(m[i].Y+o/2),K=wpdSetFixed(m[i].Y-o/2),ee=m[i].X;isNaN(ee)&&(ee=g_final_x);A=wpdSetFixed(ee-e/2),oe=wpdSetFixed(ee+e/2);(A<T||oe<T||oe>D||q>F||K<Y)&&(h=-1,U="N")}}return logDebug("function : find_pegboard_gap","E"),"Y"==s&&"D"==N&&"Y"==b?"D":"Y"==s&&"N"==N&&"Y"==b?"N":"Y"==s&&"Y"==N&&"Y"==b?t:"Y"==s&&-1==h?"N":-1==h&&"N"==s?m[i].X:h}catch(e){error_handling(e)}}async function recreate_compare_views(e,o){if(logDebug("function : recreate_compare_views; view_ind : "+e+"; reload : "+o,"S"),"Y"==g_compare_pog_flag&&"PREV_VERSION"!==g_compare_view&&"POG"!==g_compare_view)if("POG"==e&&"Y"==o){var t=JSON.parse(JSON.stringify(g_pog_json));await create_module_from_json([g_pog_json[g_ComViewIndex]],"N","F","N","E","N","N","Y","Y","","Y",g_scene_objects[g_ComViewIndex].scene.children[2],g_scene_objects[g_ComViewIndex].scene,g_ComViewIndex,g_ComViewIndex);var a=JSON.parse(JSON.stringify(g_multi_pog_json));g_multi_pog_json=JSON.parse(JSON.stringify(t)),g_multi_pog_json.push(a[0]),g_pog_json=g_multi_pog_json;var n=get_min_max_xy(g_ComViewIndex).split("###");set_camera_z(g_scene_objects[g_ComViewIndex].scene.children[0],parseFloat(n[2]),parseFloat(n[3]),parseFloat(n[0]),parseFloat(n[1]),g_offset_z,parseFloat(n[4]),parseFloat(n[5]),g_ComViewIndex)}else if("CUTAWAY"==e){var l=g_scene_objects[g_pog_index].scene.children[2].clone(!0);g_scene_objects[g_ComViewIndex].scene.children[2]=l,set_camera_z(g_scene_objects[g_ComViewIndex].scene.children[0],g_cutaway_cam_detail[0].x,g_cutaway_cam_detail[0].y,g_cutaway_cam_detail[0].width,g_cutaway_cam_detail[0].height,g_cutaway_cam_detail[0].offset,g_cutaway_cam_detail[0].x,g_cutaway_cam_detail[0].y,!0,g_ComViewIndex)}else if("POG"!==e&&"N"==o&&"EDIT_PALLET"!==e){console.log("g_ComViewIndex",g_ComViewIndex,e),g_scene_objects.splice(g_ComViewIndex,1),g_canvas_objects.splice(g_ComViewIndex,1),init(g_ComViewIndex);var r={};if(r.scene=g_scene,r.renderer=g_renderer,g_scene_objects.push(r),g_pog_json[g_ComViewIndex].H<.2)await create_compare_pog(e);else{await create_side(e,g_ComBaseIndex,g_ComViewIndex);g_scene_objects[g_ComViewIndex].scene.children[0].updateProjectionMatrix()}}else if("EDIT_PALLET"==e){old_pog_index=g_pog_index,console.log("g_ComBaseIndex",g_ComBaseIndex,g_ComViewIndex);var[_,i]=get_shelf_index(g_edit_pallet_shelfid,g_ComBaseIndex);-1!==_&&-1!==i&&(update_item_distance(_,i,g_ComBaseIndex,"N"),g_pog_json[g_ComViewIndex].ModuleInfo[0].ShelfInfo[0]=JSON.parse(JSON.stringify(g_pog_json[g_ComBaseIndex].ModuleInfo[_].ShelfInfo[i])),g_pog_json[g_ComViewIndex].ModuleInfo[0].ShelfInfo[0].PrimeShelfObjID=g_pog_json[g_ComBaseIndex].ModuleInfo[_].ShelfInfo[i].SObjID),g_pog_json.splice(g_ComViewIndex,1),g_scene_objects.splice(g_ComViewIndex,1),g_canvas_objects.splice(g_ComViewIndex,1),await edit_pallet("N",_,i,g_ComBaseIndex,"N")}logDebug("function : recreate_compare_views","E")}async function get_chest_split_details(e,o){try{var t=[],a=0;if("Y"==e){for(const e of g_pog_json[o].ModuleInfo){if(void 0===e.ParentModule||null==e.ParentModule){e.ChestInfo=[];var n=0,l=wpdSetFixed(e.X-e.W/2),r=wpdSetFixed(e.X+e.W/2);for(const d of e.ShelfInfo){if(g_pog_json[o].ModuleInfo[a].ShelfInfo[n].SplitChest="N","CHEST"==d.ObjType){var _=wpdSetFixed(d.X-d.W/2),i=wpdSetFixed(d.X+d.W/2);(l>=_&&r<i||l>=_&&r<i||l<=_&&r<i&&r>_||l>=_&&r>i&&l<i)&&(d.MIndex=a,d.SIndex=n,t.push(d),g_pog_json[o].ModuleInfo[a].ShelfInfo[n].SplitChest="Y")}n++}}a++}for(chest of t){var d=wpdSetFixed(chest.X-chest.W/2),s=wpdSetFixed(chest.X+chest.W/2),g=chest.ItemInfo,f=0,p=0;for(const e of g_pog_json[o].ModuleInfo){if(void 0===e.ParentModule||null==e.ParentModule){var I="N",c=wpdSetFixed(e.X-e.W/2),h=wpdSetFixed(e.X+e.W/2),m=JSON.parse(JSON.stringify(chest));c>=d&&h<=s?(I="Y",m.W=e.W,m.X=e.X):c<=d&&h<=s&&h>d?(I="Y",m.W=wpdSetFixed(h-d),m.X=wpdSetFixed(d+m.W/2)):c>=d&&h>=s&&c<s&&(I="Y",m.W=wpdSetFixed(s-c),m.X=wpdSetFixed(c+m.W/2));var u=[],S=wpdSetFixed(m.X-m.W/2),v=wpdSetFixed(m.X+m.W/2);for(items of(p=chest.MIndex+1,g))items.X>=S&&items.X<=v&&(items.ModuleNo=p,u.push(items));"Y"==I&&(u.sort((function(e,o){return parseInt(e.LocID)-parseInt(o.LocID)})),m.ItemInfo=u,m.SplitChest="Y",g_pog_json[o].ModuleInfo[f].ChestInfo.push(m))}f++}0}}return"SUCCESS"}catch(e){throw error_handling(e),e}}function get_sales_info(e,o){try{var t={LeadTime:0,SalesAmt:0,VRM:0,GP:0,BEI:0,MarkDown:0,ShrinkageAmt:0,SalesUnit:0,SalesPerWeek:0,SalesUnitPerWeek:0,NonShrinkageAmt:0,ASP:0,VRMPer:"0%",GPPer:"0%",BEIPer:"0%",MarkDownPer:"0%",ShrinkageAmtPer:"0%",AvgSalesPerWeek:0,AvgQtyPerWeek:0,SalesPartPer:"0%",QtyPartPer:"0%",NoOfListing:0,TotalShrinkageAmtPer:"0%",AUR:0,WeeklySales:0,WeeklyQty:0,NetMarginPercent:"0%",WeeklyNetMargin:"0%"},a=!1;if(void 0!==g_pog_json[e].SalesInfo&&g_pog_json[e].SalesInfo.length>0)for(ItemSales of g_pog_json[e].SalesInfo)if(ItemSales.Item==o){t={LeadTime:ItemSales.LeadTime,SalesAmt:parseFloat(nvl(ItemSales.SalesAmt).toFixed(1)),VRM:parseFloat(nvl(ItemSales.VRM).toFixed(1)),GP:parseFloat(nvl(ItemSales.GP).toFixed(2)),BEI:ItemSales.BEI,MarkDown:ItemSales.MarkDown,ShrinkageAmt:parseFloat(nvl(ItemSales.ShrinkageAmt).toFixed(1)),SalesUnit:ItemSales.SalesUnit,SalesPerWeek:parseFloat(nvl(ItemSales.SalesPerWeek).toFixed(1)),SalesUnitPerWeek:parseFloat(nvl(ItemSales.SalesUnitPerWeek).toFixed(1)),NonShrinkageAmt:parseFloat(nvl(ItemSales.NonShrinkageAmt).toFixed(1)),ASP:void 0!==ItemSales.ASP&&""!==ItemSales.ASP&&null!==ItemSales.ASP&&0!==ItemSales.ASP?parseFloat(nvl(ItemSales.ASP).toFixed(2)):0==ItemSales.SalesUnit?0:parseFloat((nvl(ItemSales.SalesAmt)/nvl(ItemSales.SalesUnit)).toFixed(1)),VRMPer:(0==nvl(ItemSales.SalesAmt)?0:parseFloat((nvl(ItemSales.VRM)/nvl(ItemSales.SalesAmt)*100).toFixed(1)))+"%",GPPer:(0==nvl(ItemSales.SalesAmt)?0:parseFloat((nvl(ItemSales.GP)/nvl(ItemSales.SalesAmt)*100).toFixed(1)))+"%",BEIPer:(0==nvl(ItemSales.SalesAmt)?0:parseFloat((nvl(ItemSales.BEI)/nvl(ItemSales.SalesAmt)*100).toFixed(1)))+"%",MarkDownPer:(0==nvl(ItemSales.SalesAmt)?0:parseFloat((nvl(ItemSales.MarkDown)/nvl(ItemSales.SalesAmt)*100).toFixed(1)))+"%",ShrinkageAmtPer:(0==nvl(ItemSales.SalesAmt)?0:parseFloat((nvl(ItemSales.ShrinkageAmt)/nvl(ItemSales.SalesAmt)*100).toFixed(1)))+"%",AvgSalesPerWeek:parseFloat(nvl(ItemSales.AvgSalesPerWeek).toFixed(1)),AvgQtyPerWeek:parseFloat(nvl(ItemSales.AvgQtyPerWeek).toFixed(1)),SalesPartPer:parseFloat(nvl(ItemSales.SalesPartPer).toFixed(1))+"%",QtyPartPer:parseFloat(nvl(ItemSales.QtyPartPer).toFixed(1))+"%",NoOfListing:parseFloat(nvl(ItemSales.NoOfListing).toFixed(1)),TotalShrinkageAmtPer:(0==nvl(ItemSales.SalesAmt)?0:parseFloat(((nvl(ItemSales.ShrinkageAmt)+nvl(ItemSales.NonShrinkageAmt))/nvl(ItemSales.SalesAmt)*100).toFixed(1)))+"%",AUR:parseFloat(nvl(ItemSales.AUR).toFixed(1)),WeeklySales:parseFloat(nvl(ItemSales.weeklysales).toFixed(1)),WeeklyQty:parseFloat(nvl(ItemSales.weeklyqty).toFixed(1)),NetMarginPercent:parseFloat(nvl(ItemSales.nmper).toFixed(1))+"%",WeeklyNetMargin:parseFloat(nvl(ItemSales.netmarginpercent).toFixed(1))+"%"},a=!0;break}if(!a)for(const n of g_pog_json[e].ModuleInfo)if(void 0===n.ParentModule||null==n.ParentModule)for(const e of n.ShelfInfo)if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.ItemInfo.length>0)for(const n of e.ItemInfo)if("DIVIDER"!==n.Item&&""!==n.Desc&&void 0!==n.Desc&&n.Item==o){t={LeadTime:0,SalesAmt:parseFloat(n.NetSales.toFixed(1)),VRM:0,GP:n.GrossProfit,BEI:0,MarkDown:0,ShrinkageAmt:0,SalesUnit:n.SalesUnit,SalesPerWeek:0,SalesUnitPerWeek:0,NonShrinkageAmt:0,ASP:0==n.SalesUnit?0:parseFloat((n.NetSales/n.SalesUnit).toFixed(1)),VRMPer:"0%",GPPer:(0==n.NetSales?0:parseFloat((n.GrossProfit/n.NetSales*100).toFixed(1)))+"%",BEIPer:"0%",MarkDownPer:"0%",ShrinkageAmtPer:"0%",AvgSalesPerWeek:0,AvgQtyPerWeek:0,SalesPartPer:"0%",QtyPartPer:"0%",NoOfListing:0,TotalShrinkageAmtPer:"0%",AUR:0,WeeklySales:0,WeeklyQty:0,NetMarginPercent:"0%",WeeklyNetMargin:"0%"},a=!0;break}return t}catch(e){throw error_handling(e),e}}function get_cap_max_merch(e,o,t,a,n,l,r="N",_="N",i=0){if(a.MaxMerch>0&&"N"==r)var d=a.MaxMerch;else if(a.X>=t.X-t.W/2&&a.X<t.X+t.W/2&&a.Y<=t.H+g_pog_json[n].BaseH&&a.Y>0)d=get_module_max_merch(e,o,n,_,i);else if(a.Y<t.H+g_pog_json[n].BaseH&&a.Y>0)d=t.H+g_pog_json[n].BaseH-a.Y;else d=l;return d}function mergeAdjacentItems(e,o,t,a){try{var n=-1,l=!1,r=-1,_=-1,i=g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo.length-1,d=g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[a],s=d.ItemID,g=-1,f=-1,p=d.ObjID;if(void 0!==i&&0!==i&&"DIVIDER"!==d.Item&&(0==a?_=a+1:(a==i||(_=a+1),r=a-1),g=-1!==_?g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[_]:-1,f=-1!==r?g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[r]:-1,-1!==g&&s==g.ItemID&&d.BVert==g.BVert&&d.BaseD==g.BaseD?(g.BHoriz=g.BHoriz+d.BHoriz,n=a+1,l=!0):-1!==f&&s==f.ItemID&&d.BVert==f.BVert&&d.BaseD==f.BaseD&&(f.BHoriz=f.BHoriz+d.BHoriz,n=r,l=!0),l)){var I=g_pog_json[e].ModuleInfo[o].ShelfInfo[t],c=g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo[n],h=0;g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo.splice(a,1);var m=g_world.getObjectById(p);void 0!==m&&g_world.remove(m);for(const a of g_pog_json[e].ModuleInfo[o].ShelfInfo[t].ItemInfo){if(a.ObjID==c.ObjID){n=h;break}h++}var[u,S,v]=get_select_dim(c);c.Exists="N";const[l,r,_,i,d,s]=set_dim_validate_item(o,t,n,u,S,v,c.ItemNesting,c.NVal,c.BHoriz,c.BVert,c.BaseD,c.Orientation,c.OrgCWPerc,c.OrgCHPerc,c.OrgCDPerc,"Y","Y","Y",e);if("ERROR"!==l){var[j,M]=get_item_xy(I,c,l,r,e);c.X=j,c.Y=M,c.Exists="E",c.W=l,c.H=r,c.D=_,c.RW=i,c.RH=d,c.RD=s}}return n}catch(e){error_handling(e)}}function getSafeRandomizedLayout(e,o,t,a,n,l=5e3){let r=null,_=-1/0;for(let i=0;i<l;i++){const l=e.slice().sort((()=>Math.random()-.5)),i=[];let d=o,s=t,g=0,f=0;for(const e of l){let[o,t,l,r,_,p]=getChestOverlappedItemDimension(d,s,a,n,e);const I=.5*a,c=.5*n;l<I&&(l=I),r<c&&(r=c),i.push({item:e,ItemX:d,ItemY:s,ItemW:l,ItemH:r,ItemWidthCrush:_,ItemHeightCrush:p,Area:l*r}),f+=l*r,d+=l,g=Math.max(g,r)}f>_&&(_=f,r=i)}return r}async function add_merch(e,o){try{logDebug("function : add_merch; add_ind : "+e,"S");var t,a,n={};if("undefined"==typeof g_undoRedoAction&&(g_undoRedoAction="REDO"),t="REDO"==g_undoRedoAction?"U":"R","Y"==e){var l=g_pog_json[o].ModuleInfo;$.each(l,(function(e,t){null!=t.ParentModule&&void 0!==t.ParentModule||$.each(t.ShelfInfo,(function(a,n){if(void 0!==n&&"NOTCH"!==n.ObjType&&"BASE"!==n.ObjType&&"TEXTBOX"!==n.ObjType&&"DIVIDER"!==n.ObjType&&"ROD"!==n.ObjType&&"PEGBOARD"!==n.ObjType){if(n.MaxMerch>0)var l=n.MaxMerch;else if(n.X>=t.X-t.W/2&&n.X<t.X+t.W/2&&n.Y<=t.H+g_pog_json[o].BaseH&&n.Y>0){l=get_module_max_merch(e,a,o);n.TOP="Y"}else if(n.Y<t.H+g_pog_json[o].BaseH&&n.Y>0)l=t.H+g_pog_json[o].BaseH-n.Y;else l=g_default_max_merch;var r,_=g_scene_objects[o].scene.children[2].getObjectById(n.SObjID);if(r=0!==n.Rotation||0!==n.Slope?n.ShelfRotateWidth:n.W,void 0!==(_=g_scene_objects[o].scene.children[2].getObjectById(n.SObjID)).merchid){var i=g_scene_objects[o].scene.children[2].getObjectById(_.merchid);void 0!==i&&_.remove(i)}add_merch_border(_,r,l,n.H,n.ObjType,n.Rotation,n.Slope,n)}}))}))}else{l=g_pog_json[o].ModuleInfo;$.each(l,(function(e,t){null!=t.ParentModule&&void 0!==t.ParentModule||$.each(t.ShelfInfo,(function(e,t){if(void 0!==t&&"NOTCH"!==t.ObjType&&"BASE"!==t.ObjType&&"TEXTBOX"!==t.ObjType&&"DIVIDER"!==t.ObjType&&"ROD"!==t.ObjType&&"PEGBOARD"!==t.ObjType){var a=g_scene_objects[o].scene.children[2].getObjectById(t.SObjID),n=g_scene_objects[o].scene.children[2].getObjectById(a.merchid);a.remove(n)}}))}))}a="Y"==e?"N":"Y",n.g_show_max_merch=a,void 0!==g_scene_objects[o].Indicators&&(g_scene_objects[o].Indicators.MaxMerch=e),g_undo_details=[],g_undo_details.push(n),"U"==t?(g_delete_details.multi_delete_shelf_ind="N",g_undo_all_obj_arr=[],g_undo_all_obj_arr.push(g_undo_details),g_undo_all_obj_arr.push(g_cut_copy_arr),g_undo_all_obj_arr.previousAction="MAX_MERCH",g_cut_support_obj_arr.length>0?g_undo_all_obj_arr.hasSupportArr="Y":g_undo_all_obj_arr.hasSupportArr="N",g_undo_all_obj_arr.g_MultiObjects="N",g_undo_all_obj_arr.multi_delete_shelf_ind="N",g_undo_final_obj_arr.push(g_undo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]):(g_delete_details.multi_delete_shelf_ind="N",g_redo_all_obj_arr=[],g_redo_all_obj_arr.push(g_undo_details),g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.previousAction="MAX_MERCH",g_cut_support_obj_arr.length>0?g_redo_all_obj_arr.hasSupportArr="Y":g_redo_all_obj_arr.hasSupportArr="N",g_redo_all_obj_arr.g_MultiObjects="N",g_redo_all_obj_arr.multi_delete_shelf_ind="N",g_redo_final_obj_arr.push(g_redo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]),render(o),logDebug("function : add_merch","E")}catch(e){error_handling(e)}}function logFinalUndoObjectsInfo(e,o,t,a,n,l,r,_,i,d,s){logDebug("function : logFinalUndoObjectsInfo; actionType : "+e+"; undoType : "+o+"; p_MultiObjects : "+n+"; multiDelShelfInd : "+l+"; multiSelectDrag : "+r+"; g_multiselect : "+_+"; ctrlSelect : "+i+"; clearRedoLog : "+d+"; isCarpark : "+s,"S"),"U"==o?(g_undo_all_obj_arr=[],"Y"==d&&(g_redo_final_obj_arr=[]),g_redo_all_obj_arr=[],g_undo_all_obj_arr.push(t),g_undo_all_obj_arr.push(a),g_undo_all_obj_arr.previousAction=e,g_undo_all_obj_arr.g_MultiObjects=n,g_undo_all_obj_arr.multi_delete_shelf_ind=l,g_undo_all_obj_arr.CurrCanvas=g_curr_canvas,g_undo_all_obj_arr.IsCarpark=s,g_undo_final_obj_arr.push(g_undo_all_obj_arr),"Y"!==g_context_opened&&("Y"!=g_delete_details.is_dragging&&(g_delete_details=[]),g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[]),g_cut_copy_arr=[],cut_copy_arr1=[],g_undo_details=[],g_mselect_drag=r,g_ctrl_select=i,g_undo_all_obj_arr=[],g_temp_cut_arr=[]):(g_redo_all_obj_arr=[],g_redo_all_obj_arr=[],g_redo_all_obj_arr.push(t),g_redo_all_obj_arr.push(a),g_redo_all_obj_arr.previousAction=e,g_redo_all_obj_arr.g_MultiObjects=n,g_redo_all_obj_arr.CurrCanvas=g_curr_canvas,g_redo_all_obj_arr.IsCarpark=s,g_redo_all_obj_arr.multi_delete_shelf_ind=l,g_redo_final_obj_arr.push(g_redo_all_obj_arr),"Y"!==g_context_opened&&("Y"!=g_delete_details.is_dragging&&(g_delete_details=[]),g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[]),g_cut_copy_arr=[],cut_copy_arr1=[],g_undo_details=[],g_mselect_drag=r,g_ctrl_select=i,g_undo_all_obj_arr=[],g_temp_cut_arr=[]),logDebug("function : logFinalUndoObjectsInfo","E")}function filterAutoFillJsontag(e){const o=["ItemID","Item","Desc"];if(!e||"object"!=typeof e)return{};const t=JSON.parse(JSON.stringify(e)),a=e=>{Array.isArray(e)&&e.forEach((e=>{Object.keys(e).forEach((t=>{o.includes(t)||delete e[t]}))}))};return Array.isArray(t.BlkInfo)&&t.BlkInfo.forEach((e=>{if(e.BlockDim&&e.BlockDim.ColorObj){const o=e.BlockDim.ColorObj.object;e.BlockDim.ColorObj={object:o}}Array.isArray(e.BlkModInfo)&&e.BlkModInfo.forEach((e=>{const o=e?.moduleInfo?.ShelfInfo;Array.isArray(o)?o.forEach((e=>a(e.ItemInfo))):o&&"object"==typeof o&&a(o.ItemInfo)})),Array.isArray(e.BlkShelfInfo)&&e.BlkShelfInfo.forEach((e=>{const o=e?.ShelfInfo;Array.isArray(o)?o.forEach((e=>a(e.ItemInfo))):o&&"object"==typeof o&&a(o.ItemInfo)}))})),t}