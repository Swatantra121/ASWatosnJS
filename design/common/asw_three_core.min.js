function setUpMouseHander(e,t,o,i,n,r){if(logDebug("function : setUpMouseHander","S"),!e||!t||"function"!=typeof t)throw"Illegal arguments in setUpMouseHander";if("string"==typeof e&&(e=document.getElementById(e)),!e||!e.addEventListener)throw"first argument in setUpMouseHander is not a valid element";var a,l,s,_,g=0,d=$v("P25_POG_DELAY_TIME_IN_MS"),c=!1,f=document.getElementById("t_Body_nav"),p=document.getElementById("side_bar"),u=window.devicePixelRatio;g_start_pixel_ratio=u;f.offsetWidth,p.offsetWidth;r.addEventListener("mousemove",(function(e){if(!c&&o){set_curr_canvas(e);var t=r.getAttribute("id"),i=r,n=i.getAttribute("data-indx"),g=g_camera;"CANVAS"==e.target.nodeName&&void 0!==g_scene_objects[n]?(n=(i=e.target).getAttribute("data-indx"),g_scene_objects.length>0&&(g=g_scene_objects[n].scene.children[0])):(i=e.target,n=0,g=g_camera);var d=i.getBoundingClientRect(),f=(d.height,e.clientX-d.left),p=e.clientY-d.top,u=Math.abs(f-a),b=Math.abs(p-l);if(!g_dragging||u>10||b>10||g_pog_json.length>1){const r=g_dragging?s:f,a=g_dragging?_:p;o(f,p,e,r,a,i,g,t,n)}s=f,_=p}})),r.addEventListener("mouseup",(function(e){if(g_dragging){if(set_curr_canvas(e),i&&g_scene_objects.length>0){var t=r.getBoundingClientRect(),o=e.clientX-t.left,n=e.clientY-t.top;i(o,n,e,s,_,r,g_camera,g_pog_index)}g_dragging=!1}})),r.addEventListener("mousedown",(function(e){if(!g_dragging){var o=Date.now();if(c=o-g<d,g=o,1==window.event.which&&g_scene_objects.length>0&&(set_curr_canvas(e),g_scene_objects.length>0)){var i=r.getBoundingClientRect(),n=(i.left,i.top,e.clientX-i.left),f=e.clientY-i.top;s=a=n,_=l=f,c||(g_dragging=t(n,f,i.left,i.top,e,r,"N",g_pog_index))}}})),r.addEventListener("dblclick",(function(e){if(set_curr_canvas(e),g_scene_objects.length>0){var t=r.getBoundingClientRect(),o=e.clientX-t.left,i=e.clientY-t.top;n(o,i,a,l,e,r,g_camera,g_pog_index)}c=!1})),logDebug("function : setUpMouseHander","E")}function limited_animate(e,t,o){try{if(g_counting<5)if(g_counting+=1,null!==g_renderer&&void 0!==o)if(null!==g_canvas_objects[o].getContext("2d")){var i=g_canvas_objects[o].getContext("2d");g_renderer.setPixelRatio(window.devicePixelRatio);var n=g_canvas_objects[o].width,r=g_canvas_objects[o].height;g_renderer.setSize(n,r),g_scene_objects[o].scene.children[0].aspect=n/r,g_renderer.render(g_scene_objects[o].scene,g_scene_objects[o].scene.children[0]),null!==i&&i.drawImage(g_renderer.domElement,0,0,n,r),requestAnimationFrame((function(){limited_animate(g_scene_objects[o].scene,g_scene_objects[o].scene.children[0],o)}))}else null!==g_renderer&&(g_renderer.render(e,t),requestAnimationFrame((function(){limited_animate(e,t,o)})));else null!==g_renderer&&(g_renderer.render(e,t),requestAnimationFrame((function(){limited_animate(e,t,o)})));else g_counting=0}catch(e){error_handling(e)}}function animate_pog(e){try{void 0!==typeof g_scene_objects&&g_scene_objects.length>0&&requestAnimationFrame((function(){limited_animate(g_scene_objects[e].scene,g_scene_objects[e].scene.children[0],e)}))}catch(e){error_handling(e)}}function animate_pog_pdf(){try{requestAnimationFrame((function(){limited_animate(g_scene_pdf,g_camera_pdf)}))}catch(e){error_handling(e)}}function get_visible_size(e,t,o,i,n){try{logDebug("function : get_visible_size; objectZ : "+e+"; obj_width : "+t+"; obj_height : "+o,"S");var r=n.position.z-e,a=THREE.MathUtils.degToRad(n.fov),l=2*Math.tan(a/2)*r,s=l*n.aspect,_=i.width/window.devicePixelRatio,g=i.height/window.devicePixelRatio,d=_*(t/s),c=g*(o/l);return logDebug("function : get_visible_size","E"),[d,c]}catch(e){logDebug("function : get_visible_size","E"),error_handling(e)}}function create3dWorld(){try{g_scene=new THREE.Scene,g_camera=new THREE.PerspectiveCamera(25,g_canvas.width/g_canvas.height,.1,1e3),g_camera.lookAt(new THREE.Vector3(0,0,0)),g_renderer.setPixelRatio(window.devicePixelRatio),g_scene.add(g_camera),g_renderer.setClearColor(16777215),g_renderer.setSize(g_canvas.width,g_canvas.height);var e=new THREE.HemisphereLight(16777215,16777215,.61);e.position.set(0,50,0),g_scene.add(e);var t=new THREE.DirectionalLight(16777215,.54);t.position.set(-8,12,15),t.castShadow=!0,t.shadow.mapSize.width=2048,t.shadow.mapSize.height=2048,g_scene.add(t),g_camera.aspect=g_canvas.width/g_canvas.height,g_camera.updateProjectionMatrix();var o=new THREE.PlaneGeometry(g_json[0].CameraW+1.5,3,1,1),i=new THREE.MeshPhongMaterial({color:10919846,shininess:0});i.flatShading=!0,o.normalsNeedUpdate,o.computeFaceNormals();var n=new THREE.Mesh(o,i);if(n.rotation.x-=Math.PI/2,g_json[0].CameraMinY<0)var r=g_json[0].CameraH/2+(0-g_json[0].CameraMinY);else r=g_json[0].CameraH/2;n.position.y=0-r,g_scene.add(n),n.receiveShadow=!0,g_world=new THREE.Object3D,g_scene.add(g_world),g_targetForDragging=new THREE.Mesh(new THREE.BoxGeometry(100,100,.01),new THREE.MeshBasicMaterial),g_targetForDragging.material.visible=!1,g_targetForDragging.material.transparent=!0,g_targetForDragging.material.opacity=.1,g_targetForDragging.uuid="drag_object"}catch(e){error_handling(e)}}function createWorld(){try{g_scene={},g_camera={},g_world={},g_scene=new THREE.Scene,g_camera=new THREE.PerspectiveCamera(25,g_canvas.width/2/g_canvas.height,.1,1e3),g_camera.lookAt(new THREE.Vector3(0,0,0)),g_renderer&&"function"==typeof g_renderer.setPixelRatio?g_renderer.setPixelRatio(window.devicePixelRatio):"undefined"!=typeof THREE&&"undefined"!=typeof g_canvas&&g_canvas&&(g_renderer=new THREE.WebGLRenderer({canvas:g_canvas,antialias:!0,preserveDrawingBuffer:!0}),"function"==typeof g_renderer.setPixelRatio&&g_renderer.setPixelRatio(window.devicePixelRatio)),g_camera.add(new THREE.PointLight(16777215,.2)),g_scene.add(g_camera),g_renderer&&"function"==typeof g_renderer.setClearColor&&g_renderer.setClearColor(16777215);var e=new THREE.DirectionalLight(16777215,1);e.position.set(-1,2,4).normalize(),g_scene.add(e),g_camera.aspect=g_canvas.width/2/g_canvas.height,g_camera.updateProjectionMatrix(),g_world=new THREE.Object3D,g_scene.add(g_world),g_targetForDragging=new THREE.Mesh(new THREE.BoxGeometry(100,100,.01),new THREE.MeshBasicMaterial),g_targetForDragging.material.visible=!1,g_targetForDragging.material.transparent=!0,g_targetForDragging.material.opacity=.1,g_targetForDragging.uuid="drag_object"}catch(e){error_handling(e)}}function add_wireframe(e,t){try{logDebug("function : add_wireframe; linewidth : "+t,"S");var o=new THREE.EdgesGeometry(e.geometry),i=new THREE.LineBasicMaterial({color:0,linewidth:t}),n=new THREE.LineSegments(o,i);return n.renderOrder=1,n.uuid="wireframe",e.WireframeObj=n,e.add(n),logDebug("function : add_wireframe","E"),n.id}catch(e){error_handling(e)}}function add_wireframe_3d(e){return add_wireframe(e,2)}function set_camera_z(e,t,o,n,r,a,l,s,_=!0,g){try{console.log("p_pog_index",g),logDebug("function : set_camera_z; x : "+t+"; y : "+o+"; width : "+n+"; height : "+r+"; offset : "+a+"; min_x : "+l+"; min_y : "+s,"S"),t=Number(t)||0,o=Number(o)||0,n=Number(n),(!Number.isFinite(n)||n<=0)&&(n=1),r=Number(r),(!Number.isFinite(r)||r<=0)&&(r=1),a=Number(a),Number.isFinite(a)||(a=0),l=Number(l)||0,s=Number(s)||0,e.position.x=t,e.position.y=o,e.position.z=0,console.log("camera.x",e.position.x,t);var d=.1,c=0,f=0;for(i=0;i<1e3&&(c=visibleHeightAtZDepth(d,e),f=visibleWidthAtZDepth(d,e),!(parseFloat(r)<c&&parseFloat(n)<f));i++)d+=.1;e.position.z=a+d,_&&(g_pog_json[g].CameraX=t,g_pog_json[g].CameraY=o,g_pog_json[g].CameraZ=d,g_pog_json[g].CameraW=n,g_pog_json[g].CameraH=r,g_pog_json[g].CameraMinX=l,g_pog_json[g].CameraMinY=s),logDebug("function : set_camera_z","E")}catch(e){logDebug("function : set_camera_z","E"),error_handling(e)}}function set_camera_z_3d(e,t,o,i,n,r){set_camera_z(e,t,o,i,n,r,0,0,!1,g_pog_index)}function set_camera_z_offside(e,t,o,n,r,a,l,s){try{t=Number(t)||0,o=Number(o)||0,n=Number(n),(!Number.isFinite(n)||n<=0)&&(n=1),r=Number(r),(!Number.isFinite(r)||r<=0)&&(r=1),a=Number(a),Number.isFinite(a)||(a=0),l=Number(l)||0,s=Number(s)||0;var _=.1,g=0,d=0;for(i=0;i<1e3&&(g=visibleHeightAtZDepth(_,e),d=visibleWidthAtZDepth(_,e),!(parseFloat(r)<g&&parseFloat(n)<d));i++)_+=.1;return[a+_,o]}catch(e){error_handling(e)}}function getCombinedBoundingBox(e){logDebug("function : getCombinedBoundingBox","S");try{const t=new THREE.Box3;return e.traverse((e=>{e.geometry&&(e.geometry.computeBoundingBox(),t.union(e.geometry.boundingBox))})),logDebug("function : getCombinedBoundingBox","E"),t}catch(e){error_handling(e),logDebug("function : getCombinedBoundingBox","E")}}function wrapText(e,t,o,i,n,r){logDebug("function : wrapText; text : "+t+"; x : "+o+"; y : "+i+"; maxWidth : "+n+"; lineHeight : "+r,"S");try{var a,l,s=t.split(" "),_="",g=0;for(g=0;g<s.length;g++){for(a=s[g],l=e.measureText(a);l.width>n;)a=a.substring(0,a.length-1),l=e.measureText(a);s[g]!=a&&""!==a&&(s.splice(g+1,0,s[g].substr(a.length)),s[g]=a),a=_+s[g]+" ",(l=e.measureText(a)).width>n&&g>0?(e.fillText(_,o,i),_=s[g]+" ",i+=r):_=a}e.fillText(_,o,i),logDebug("function : wrapText","E")}catch(e){logDebug("function : wrapText","E"),error_handling(e)}}function dcText(e,t,o,n,r,a,l,s,_,g,d,c,f,p,u,b,m){try{if(logDebug("function : dcText; txt : "+e,"S"),-1!==f){var h=g_pog_json[u].ModuleInfo[c].ShelfInfo[f];if(("TEXTBOX"!==h.ObjType||"TEXTBOX"==h.ObjType&&"Y"==b&&"Y"==s)&&(b="N"),void 0!==h.canvasW)if(null!==h.canvasW&&"N"==b)var I=h.canvasW*p,v=h.canvasH*p;else if(g_initial_camera){var[I,v]=get_visible_size(.012,r*p,a*p,g_canvas,g_initial_camera);null==h.canvasW&&(h.canvasW=I/p,h.canvasH=v/p)}else{var[I,v]=get_visible_size(.012,r*p,a*p,g_canvas,g_camera);null==h.canvasW&&(h.canvasW=I/p,h.canvasH=v/p)}else{var[I,v]=get_visible_size(.012,r*p,a*p,g_canvas,g_camera);h.canvasW=I/p,h.canvasH=v/p}}else var[I,v]=get_visible_size(.012,r*p,a*p,g_canvas,g_camera);(!t||""===t&&"V"==m)&&(t=12);var D=document.createElement("DIV");D.style.fontFamily=_,D.style.fontWeight="bold"==g?"bold":"normal",D.style.fontSize=parseInt(t)*p+"pt",D.style.position="absolute",D.style.top="-500px",D.style.left="0",D.innerHTML=e,document.body.appendChild(D);let d={width:D.offsetWidth,height:D.offsetHeight},C=window.getComputedStyle(D,null),N=parseFloat(C.fontSize);document.body.removeChild(D);D.offsetWidth;var j=parseInt(t)*p,S=document.createElement("canvas"),O=S.getContext("2d");if(S.width=I,S.height=v,null==n&&null===n||(O.fillStyle="#"+n.toString(16).padStart(6,"0"),O.fillRect(0,0,I,v)),O.textAlign="center",O.textBaseline="middle",O.fillStyle="#"+o.toString(16).padStart(6,"0"),O.font=g+" "+N+"px "+_,h&&"TEXTBOX"===h.ObjType&&"V"==m){const o=e.split("");let i=parseInt(t)*p,n=1.2*i,r=o.length*n,a=1;"Y"===l&&r>v&&(a=2);let d=Math.ceil(o.length/a);if("Y"===s)for(;d*n>v&&i>6;)i--,n=1.2*i,r=o.length*n,d=Math.ceil(o.length/a);O.font=g+" "+i+"px "+_;let c=(v-n*d)/2+n/2,f=I/2,u=i;for(let e=0;e<a;e++){let t=2===a?f+(0===e?-u/2:u/2):f;for(let i=0;i<d;i++){let r=i+e*d;if(r>=o.length)break;let a=c+i*n;O.fillText(o[r],t,a)}}}else{var y=O.measureText(e);lineGap=d.height-(y.fontBoundingBoxAscent+y.fontBoundingBoxDescent);let t={width:y.width,cssHeight:d.height,cssFontSizePx:N,fontAscent:y.fontBoundingBoxAscent,fontDescent:y.fontBoundingBoxDescent,actualAscent:y.actualBoundingBoxAscent,actualDescent:y.actualBoundingBoxDescent,lineHeight:d.height,lineGap:lineGap,lineGapTop:lineGap/2,lineGapBottom:lineGap/2};y=O.measureText(e).width;if("Y"==s&&y>I&&"N"==l){var T=50;for(i=50;i>=0;i--){var E=document.createElement("canvas"),x=E.getContext("2d");if(E.width=I,E.height=v,null==n&&null===n||(x.fillStyle="#"+n.toString(16).padStart(6,"0"),x.fillRect(0,0,I,v)),x.textAlign="center",x.textBaseline="middle",x.fillStyle="#"+o.toString(16).padStart(6,"0"),x.font=g+" "+i+"px "+_,x.measureText(e).width+5<=I){T=i;break}}j=T<50?T:j}null==n&&null===n||(O.fillStyle="#"+n.toString(16).padStart(6,"0"),O.fillRect(0,0,I,v)),O.textAlign="center",O.textBaseline="middle",O.fillStyle="#"+o.toString(16).padStart(6,"0"),O.font=(g?g+" ":"")+" "+j+"px "+_;var R=t.lineHeight-t.lineGap;"Y"==l&&y>I?wrapText(O,e,I/2,j,I,R):O.fillText(e,I/2,v/2)}var w=new THREE.CanvasTexture(S);w.minFilter=THREE.LinearFilter,geometry=new THREE.PlaneGeometry(r,a);var H=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:w,transparent:!0,opacity:1}),B=new THREE.Mesh(geometry,H);return logDebug("function : dcText","E"),B}catch(e){error_handling(e)}}function add_item_borders(e,t,o,n,r,a,l,s,_){try{if(logDebug("function : add_item_borders; p_module_index : "+e+"; p_shelf_index : "+t+"; i_item_index : "+o+"; width : "+r+"; height : "+a+"; item_horiz_facing : "+l,"S"),"Y"==_)var g=g_pog_json[s].ModuleInfo[e].ChestInfo[t];else g=g_pog_json[s].ModuleInfo[e].ShelfInfo[t];var d=g.ItemInfo[o];horiz_facing=-1!==l?l:d.BHoriz,vert_facing=d.BVert;var c=d.ItemNesting,f=d.NVal,p=d.CapStyle,u=d.CapCount,[b,m,h,I,v,D]=get_new_orientation_dim(d.Orientation,d.OW,d.OH,d.OD),j=(d.RH,g.Rotation,g.D,g.HorizGap),S=g.SpreadItem,O=[],y=[],T="N",E=0,x=0,R=0,w=0-parseFloat(r)/2,H=0-parseFloat(a)/2,B=0+parseFloat(r)/2,C=0+parseFloat(a)/2,N=[];if(0!==f&&(vert_facing>1||horiz_facing>1)&&0==j&&"F"!==S&&"D"!==c){if(f<0&&(f*=-1,T="Y"),"H"==c){for("N"==T?(x=H+m,O.push(x)):x=H,i=1;i<vert_facing&&(x+=parseFloat(f))<C;i++)O.push(x);for(i=0;i<O.length;i++)N.push(new THREE.Vector3(w,O[i],0)),N.push(new THREE.Vector3(B,O[i],0));if(horiz_facing>1){E=r/horiz_facing;var M=w;for(i=1;i<horiz_facing;i++)M+=parseFloat(E),y.push(M);for(i=0;i<y.length;i++)N.push(new THREE.Vector3(y[i],H,0)),N.push(new THREE.Vector3(y[i],C,0))}}else if("W"==c){for("N"==T?(x=w+b,y.push(x)):x=w,i=1;i<horiz_facing&&(x+=parseFloat(f))<B;i++)y.push(x);for(i=0;i<y.length;i++)N.push(new THREE.Vector3(y[i],H,0)),N.push(new THREE.Vector3(y[i],C,0));if(vert_facing>1){for(R=a/vert_facing,x=H,i=1;i<vert_facing&&(x+=parseFloat(R))<C;i++)O.push(x);for(i=0;i<O.length;i++)N.push(new THREE.Vector3(w,O[i],0)),N.push(new THREE.Vector3(B,O[i],0))}}}else if("0"!==p){if("1"==p){for(x=H,i=1;i<=vert_facing&&(x+=parseFloat(m))<C;i++)O.push(x);for(i=1;i<u&&(x+=parseFloat(d.CapHeight))<C;i++)O.push(x);for(i=0;i<O.length;i++)N.push(new THREE.Vector3(w,O[i],0)),N.push(new THREE.Vector3(B,O[i],0))}else if("2"==p){for(x=H,i=1;i<=vert_facing;i++)x+=m,O.push(x);for(i=1;i<u&&(x+=parseFloat(d.CapHeight))<C;i++)O.push(x);for(i=0;i<O.length;i++)N.push(new THREE.Vector3(w,O[i],0)),N.push(new THREE.Vector3(B,O[i],0))}else if("3"==p){for(x=H+m,O.push(x),i=1;i<u&&(x+=parseFloat(d.CapHeight))<C;i++)O.push(x);for(i=0;i<O.length;i++)N.push(new THREE.Vector3(w,O[i],0)),N.push(new THREE.Vector3(B,O[i],0))}if(horiz_facing>1){E=r/horiz_facing;M=w;for(i=1;i<horiz_facing&&(M+=parseFloat(E))<C;i++)y.push(M);for(i=0;i<y.length;i++)N.push(new THREE.Vector3(y[i],H,0)),N.push(new THREE.Vector3(y[i],C,0))}}else{if(vert_facing>1){for(R=a/vert_facing,x=H,i=1;i<vert_facing;i++)x+=parseFloat(R),O.push(x);for(i=0;i<O.length;i++)N.push(new THREE.Vector3(w,O[i],0)),N.push(new THREE.Vector3(B,O[i],0))}if(horiz_facing>1){E=r/horiz_facing;M=w;for(i=1;i<horiz_facing;i++)M+=parseFloat(E),y.push(M);for(i=0;i<y.length;i++)N.push(new THREE.Vector3(y[i],H,0)),N.push(new THREE.Vector3(y[i],C,0))}}let A=(new THREE.BufferGeometry).setFromPoints(N);var F=new THREE.LineBasicMaterial({color:0}),L=new THREE.LineSegments(A,F);L.position.z=6e-4,n.add(L),logDebug("function : add_item_borders","E")}catch(e){error_handling(e)}}async function update_rotate_shelfs(e){logDebug("function : update_rotate_shelfs","S");try{var t=0;for(const a of g_pog_json[e].ModuleInfo){if(null==a.ParentModule){var o=0;for(const l of a.ShelfInfo){if("BASE"!==l.ObjType&&"NOTCH"!==l.ObjType&&"DIVIDER"!==l.ObjType&&(0!==l.Rotation||0!==l.Slope)){var i=g_world.getObjectById(l.SObjID);if(0!==l.Rotation){i.quaternion.copy(g_camera.quaternion),i.lookAt(g_pog_json[e].CameraX,g_pog_json[e].CameraY,g_pog_json[e].CameraZ),i.rotateY(l.Rotation*Math.PI/180);var n=0;n=l.Slope>0?0-l.Slope:l.Slope<0?-l.Slope:0,i.rotateX(n*Math.PI/180),i.updateMatrix()}if(g_pog_json[e].ModuleInfo[t].ShelfInfo[o].ItemInfo.length>0){async function r(){await set_all_items(t,o,l.X,l.Y,g_shelf_edit_flag,"N","Y",e,e)}g_scene.updateMatrixWorld(),r()}}o++}}t++}logDebug("function : update_rotate_shelfs","E")}catch(s){error_handling(s)}}function update_item_label(e,t,o,i,n,r,a,l,s="N"){logDebug("function : update_item_label; p_module_index : "+e+"; p_shelf_index : "+t+"; i_item_index : "+o+"; g_show_item_label : "+n,"S");try{if("Y"==s)var _=g_pog_json[l].ModuleInfo[e].ChestInfo[t];else _=g_pog_json[l].ModuleInfo[e].ShelfInfo[t];if("Y"==n&&""!==_.ItemInfo[o].LocID&&void 0!==_.ItemInfo[o].LocID){var g,d=r;if(null==hexToRgb(d))var c=parseInt("FF",16),f=parseInt("FF",16),p=parseInt("FF",16);else c=hexToRgb(d).r,f=hexToRgb(d).r,p=hexToRgb(d).g;if(g=getTextColor(c,f,p),"N"==g_fixel_label)var u=addlabelText(_.ItemInfo[o].LocID,g_labelFont,g_labelActualSize,g,"center",d);else{var b=get_type(_.ItemInfo[o].BrandType);u=addlabelText(b=void 0===b||""==b?_.ItemInfo[o].LocID:b+" "+_.ItemInfo[o].LocID,g_labelFont,g_labelActualSize,g,"center",d)}i.add(u),u.position.x=0,u.position.y="CENTER"==a?0:"BOTTOM"==a?0-_.ItemInfo[o].H/2+.0015625*g_labelFont:_.ItemInfo[o].H/2+.0015625*g_labelFont,0!==_.Rotation||0!==_.Slope?u.position.z=_.ItemInfo[o].D/2+.005:u.position.z=.0015,_.ItemInfo[o].LObjID=u.id}return logDebug("function : update_item_label","E"),"success"}catch(e){error_handling(e)}}function show_item_labels(e,t,o,i){try{logDebug("function : show_item_labels; show_label_ind : "+e+"; pogcrItemBackLabelColor : "+t+"; pogcrItemLabelPosition : "+o,"S");var n,r=g_pog_json[i].ModuleInfo,a={};"undefined"==typeof g_undoRedoAction&&(g_undoRedoAction="REDO"),n="REDO"==g_undoRedoAction?"U":"R";var l,s=0;if("Y"==e)for(const e of r){if(void 0===e.ParentModule||null==e.ParentModule){var _=e.ShelfInfo,g=0;for(const e of _){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.ItemInfo.length>0){var d=e.ItemInfo,c=0;for(const n of d){if("DIVIDER"!==n.Item&&""!==n.LocID&&void 0!==n.LocID){if(void 0!==(D=g_scene_objects[i].scene.children[2].getObjectById(n.ObjID))){if(void 0!==n.LObjID&&-1!==n.LObjID){var f=D.getObjectById(n.LObjID);D.remove(f)}var p=t;if(null==hexToRgb(p))var u=parseInt("FF",16),b=parseInt("FF",16),m=parseInt("FF",16);else u=hexToRgb(p).r,b=hexToRgb(p).r,m=hexToRgb(p).g;var h=getTextColor(u,b,m);if("Y"==g_fixel_label)var I=get_type(n.BrandType),v=addlabelText(I=void 0===I||""==I?n.LocID:I+""+n.LocID,g_labelFont,g_labelActualSize,h,"center",p);else v=addlabelText(n.LocID,g_labelFont,g_labelActualSize,h,"center",p);D.add(v),v.position.x=0,v.position.y="CENTER"==o?0:"BOTTOM"==o?0-n.H/2+.0015625*g_labelFont:n.H/2+.0015625*g_labelFont,0!==e.Rotation||0!==e.Slope?v.position.z=n.D/2+5e-4:v.position.z=.0015,g_pog_json[i].ModuleInfo[s].ShelfInfo[g].ItemInfo[c].LObjID=v.id}}else if("DIVIDER"!==n.Item){if(void 0!==n.LObjID&&-1!==n.LObjID)if(void 0!==(D=g_scene_objects[i].scene.children[2].getObjectById(n.ObjID))){f=D.getObjectById(n.LObjID);D.remove(f)}}c+=1}}g+=1}}s+=1}else{s=0;for(const e of r){if(void 0===e.ParentModule||null==e.ParentModule){_=e.ShelfInfo,g=0;for(const e of _){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.ItemInfo.length>0){d=e.ItemInfo,c=0;for(const e of d){var D;if("DIVIDER"!==e.Item&&""!==e.LocID&&void 0!==e.LocID)if(void 0!==(D=g_scene_objects[i].scene.children[2].getObjectById(e.ObjID))){if(void 0!==e.LObjID&&-1!==e.LObjID){f=D.getObjectById(e.LObjID);D.remove(f)}g_pog_json[i].ModuleInfo[s].ShelfInfo[g].ItemInfo[c].LObjID=-1}c+=1}}g+=1}}s+=1}}l="Y"==e?"N":"Y",a.show_item_labels=l,g_undo_details=[],g_undo_details.push(a),"U"==n?(g_delete_details.multi_delete_shelf_ind="N",g_undo_all_obj_arr=[],g_undo_all_obj_arr.push(g_undo_details),g_undo_all_obj_arr.push(g_cut_copy_arr),g_undo_all_obj_arr.previousAction="ITEM_LABEL",g_cut_support_obj_arr.length>0?g_undo_all_obj_arr.hasSupportArr="Y":g_undo_all_obj_arr.hasSupportArr="N",g_undo_all_obj_arr.g_MultiObjects="N",g_undo_all_obj_arr.multi_delete_shelf_ind="N",g_undo_final_obj_arr.push(g_undo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]):(g_delete_details.multi_delete_shelf_ind="N",g_redo_all_obj_arr=[],g_redo_all_obj_arr.push(g_undo_details),g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.previousAction="ITEM_LABEL",g_cut_support_obj_arr.length>0?g_redo_all_obj_arr.hasSupportArr="Y":g_redo_all_obj_arr.hasSupportArr="N",g_redo_all_obj_arr.g_MultiObjects="N",g_redo_all_obj_arr.multi_delete_shelf_ind="N",g_redo_final_obj_arr.push(g_redo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]),animate_pog(i),render(i),logDebug("function : show_item_labels","E")}catch(e){error_handling(e)}}function update_single_fixel_label(e,t,o,n){var r=-1,a=g_pog_json[t].ModuleInfo[o].ShelfInfo[n],l=g_pog_json[t].ModuleInfo[o];if("DIVIDER"==e.ObjType){var s=g_pog_json[t].ModuleInfo[o].ShelfInfo;$.each(s,(function(t,o){"BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&$.each(o.ItemInfo,(function(o,n){"DIVIDER"==n.Item&&e.ShelfDivObjID==n.ObjID&&(div_mod_index=i,div_shelf_index=t,div_item_index=o,r=n.LObjID)}))}));var _=g_scene_objects[t].scene.children[2].getObjectById(e.ShelfDivObjID)}else{r=e.LObjID;_=g_scene_objects[t].scene.children[2].getObjectById(e.SObjID)}if(void 0!==_){if(void 0!==r&&-1!==r){var g=_.getObjectById(r);_.remove(g)}var d=e.Color;if(null==hexToRgb(d))var c=parseInt("FF",16),f=parseInt("FF",16),p=parseInt("FF",16);else c=hexToRgb(d).r,f=hexToRgb(d).r,p=hexToRgb(d).g;var u=getTextColor(c,f,p);if("Y"==g_fixel_label)var b=get_notch_no(l,t,e.Y+e.H/2),m=addlabelText(e.Shelf+" "+e.Desc+" "+parseFloat(100*e.Y-e.H/2*100).toFixed(2)+get_message("POGCR_FIXEL_CM")+" "+b,g_labelFont,g_labelActualSize,u,"center","");else m=addlabelText(e.Shelf,g_labelFont,g_labelActualSize,u,"center","");_.add(m),m.position.y=-.005,0!==e.Rotation||0!==e.Slope?m.position.z=e.D/2+.005:m.position.z=.005,"DIVIDER"==e.ObjType&&-1!==div_mod_index?(m.position.x=0,g_pog_json[t].ModuleInfo[div_mod_index].ShelfInfo[div_shelf_index].ItemInfo[div_item_index].LObjID=m.id,a.LObjID=m.id):("Y"!==g_fixel_label?m.position.x=0-(e.W/2.4+.01):m.position.x=0-(e.W/2.4-.02),a.LObjID=m.id)}}function show_fixel_labels(e,t){try{logDebug("function : show_fixel_labels; show_label_ind : "+e,"S");var o,i=g_pog_json[t].ModuleInfo,n=-1,r=-1,a=-1,l="N",s={};"undefined"==typeof g_undoRedoAction&&(g_undoRedoAction="REDO"),o="REDO"==g_undoRedoAction?"U":"R";var _,g=0;if("Y"==e)for(const e of i){if(void 0===e.ParentModule||null==e.ParentModule){var d=e.ShelfInfo,c=0;for(const o of d){if(l="N",console.log("ObjType TextBox",o.ObjType),"BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"TEXTBOX"!==o.ObjType){var f=-1;if("DIVIDER"==o.ObjType){var p=g_pog_json[t].ModuleInfo[g].ShelfInfo;$.each(p,(function(e,t){"BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&$.each(t.ItemInfo,(function(i,s){"DIVIDER"==s.Item&&o.ShelfDivObjID==s.ObjID&&(n=g,r=e,a=i,f=s.LObjID,l=o.DivHeight>0&&("Y"==o.DivPbtwFace||"Y"==o.DivPst||"Y"==o.DivPed)?void 0!==o.NoDivIDShow?o.NoDivIDShow:void 0!==t.NoDivIDShow?t.NoDivIDShow:"N":"N")}))}));var u=g_scene_objects[t].scene.children[2].getObjectById(o.ShelfDivObjID)}else{f=o.LObjID;u=g_scene_objects[t].scene.children[2].getObjectById(o.SObjID)}if(void 0!==u){if(void 0!==f&&-1!==f){var b=u.getObjectById(f);u.remove(b)}var m=o.Color;if(null==hexToRgb(m))var h=parseInt("FF",16),I=parseInt("FF",16),v=parseInt("FF",16);else h=hexToRgb(m).r,I=hexToRgb(m).r,v=hexToRgb(m).g;var D=getTextColor(h,I,v);if("Y"==g_fixel_label){if("N"==l)var j=get_notch_no(e,t,o.Y+o.H/2),S=addlabelText(o.Shelf+" "+o.Desc+" "+parseFloat(100*o.Y-o.H/2*100).toFixed(2)+get_message("POGCR_FIXEL_CM")+" "+j,g_labelFont,g_labelActualSize,D,"center","")}else if("N"==l)S=addlabelText(o.Shelf,g_labelFont,g_labelActualSize,D,"center","");if("N"==l)if(u.add(S),0!==o.Rotation||0!==o.Slope?S.position.z=o.D/2+.005:S.position.z=.005,"DIVIDER"==o.ObjType&&-1!==n)S.position.x=0,g_pog_json[t].ModuleInfo[n].ShelfInfo[r].ItemInfo[a].LObjID=S.id,g_pog_json[t].ModuleInfo[g].ShelfInfo[c].LObjID=S.id;else{if("Y"!==g_fixel_label){var O=S.material.map.image.width/S.material.map.image.height*g_labelActualSize/2;S.position.x=0-o.W/2+O+.01,S.position.y=0}else{O=S.material.map.image.width/S.material.map.image.height*g_labelActualSize/2;S.position.x=0-o.W/2+O+.01,S.position.y=-.005}g_pog_json[t].ModuleInfo[g].ShelfInfo[c].LObjID=S.id}}}c+=1}}g+=1}else{g=0;for(const e of i){if(void 0===e.ParentModule||null==e.ParentModule){d=e.ShelfInfo,c=0;for(const e of d){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType){f=-1;if("DIVIDER"==e.ObjType){p=g_pog_json[t].ModuleInfo[g].ShelfInfo;$.each(p,(function(t,o){"BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&$.each(o.ItemInfo,(function(o,i){"DIVIDER"==i.Item&&e.ShelfDivObjID==i.ObjID&&(n=g,r=t,a=o,f=i.LObjID)}))}));u=g_scene_objects[t].scene.children[2].getObjectById(e.ShelfDivObjID)}else{f=e.LObjID;u=g_scene_objects[t].scene.children[2].getObjectById(e.SObjID)}if(void 0!==f&&-1!==f){b=u.getObjectById(f);u.remove(b)}g_pog_json[t].ModuleInfo[g].ShelfInfo[c].LObjID=-1}c+=1}}g+=1}"Y"==g_fixel_label&&show_notch_labels("N","","Y",t)}_="Y"==e?"N":"Y",s.show_fixel_labels=_,g_undo_details=[],g_undo_details.push(s),"U"==o?(g_delete_details.multi_delete_shelf_ind="N",g_undo_all_obj_arr=[],g_undo_all_obj_arr.push(g_undo_details),g_undo_all_obj_arr.push(g_cut_copy_arr),g_undo_all_obj_arr.previousAction="FIXEL_LABEL",g_cut_support_obj_arr.length>0?g_undo_all_obj_arr.hasSupportArr="Y":g_undo_all_obj_arr.hasSupportArr="N",g_undo_all_obj_arr.g_MultiObjects="N",g_undo_all_obj_arr.multi_delete_shelf_ind="N",g_undo_final_obj_arr.push(g_undo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]):(g_delete_details.multi_delete_shelf_ind="N",g_redo_all_obj_arr=[],g_redo_all_obj_arr.push(g_undo_details),g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.previousAction="FIXEL_LABEL",g_cut_support_obj_arr.length>0?g_redo_all_obj_arr.hasSupportArr="Y":g_redo_all_obj_arr.hasSupportArr="N",g_redo_all_obj_arr.g_MultiObjects="N",g_redo_all_obj_arr.multi_delete_shelf_ind="N",g_redo_final_obj_arr.push(g_redo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]),animate_pog(t),render(t),logDebug("function : show_fixel_labels","E")}catch(e){error_handling(e)}}function show_notch_labels(e,t,o="Y",i){try{logDebug("function : show_notch_labels; show_label_ind : "+e,"S");var n,r,a,l=g_pog_json[i].ModuleInfo,s=g_notch_label_position.toUpperCase(),_={};"undefined"==typeof g_undoRedoAction&&(g_undoRedoAction="REDO"),n="REDO"==g_undoRedoAction?"U":"R";var g,d=0;if("Y"==e)for(const e of l){if((void 0===e.ParentModule||null==e.ParentModule)&&e.NotchW>0){var c=e.ShelfInfo,f=0;for(const o of c){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType){var p=g_scene_objects[i].scene.children[2].getObjectById(o.SObjID);if(void 0!==o.NotchLabelObjID&&-1!==o.NotchLabelObjID){var u=p.getObjectById(o.NotchLabelObjID);p.remove(u)}var b=get_notch_no(e,i,o.Y+o.H/2);o.NotchNo=b;var m,h=o.Color;if(null==hexToRgb(h))var I=parseInt("FF",16),v=parseInt("FF",16),D=parseInt("FF",16);else I=hexToRgb(h).r,v=hexToRgb(h).r,D=hexToRgb(h).g;m="CENTER"==s?getTextColor(I,v,D):"#000000";var j=addlabelText(t+" "+b,g_labelFont,g_labelActualSize,m,"center","");p.add(j),0!==o.Rotation||0!==o.Slope?j.position.z=o.D/2+.005:j.position.z=.005,[r,a]=getLabelPosition(o,"S",s),j.position.x=r,j.position.y=a,g_pog_json[i].ModuleInfo[d].ShelfInfo[f].NotchLabelObjID=j.id}f+=1}}d+=1}else for(const e of l){if(void 0===e.ParentModule||null==e.ParentModule){c=e.ShelfInfo,f=0;for(const e of c){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){p=g_scene_objects[i].scene.children[2].getObjectById(e.SObjID);if(void 0!==e.NotchLabelObjID&&-1!==e.NotchLabelObjID){u=p.getObjectById(e.NotchLabelObjID);p.remove(u)}g_pog_json[i].ModuleInfo[d].ShelfInfo[f].NotchLabelObjID=-1}f+=1}}d+=1}g="Y"==e?"N":"Y",_.show_notch_labels=g,g_undo_details=[],"Y"==o&&g_undo_details.push(_),"Y"==o&&("U"==n?(g_delete_details.multi_delete_shelf_ind="N",g_undo_all_obj_arr=[],"Y"==o&&g_undo_all_obj_arr.push(g_undo_details),"Y"==o&&g_undo_all_obj_arr.push(g_cut_copy_arr),g_undo_all_obj_arr.previousAction="NOTCH_LABEL",g_cut_support_obj_arr.length>0?g_undo_all_obj_arr.hasSupportArr="Y":g_undo_all_obj_arr.hasSupportArr="N",g_undo_all_obj_arr.g_MultiObjects="N",g_undo_all_obj_arr.multi_delete_shelf_ind="N",g_undo_final_obj_arr.push(g_undo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]):(g_delete_details.multi_delete_shelf_ind="N",g_redo_all_obj_arr=[],g_redo_all_obj_arr.push(g_undo_details),g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.previousAction="NOTCH_LABEL",g_cut_support_obj_arr.length>0?g_redo_all_obj_arr.hasSupportArr="Y":g_redo_all_obj_arr.hasSupportArr="N",g_redo_all_obj_arr.g_MultiObjects="N",g_redo_all_obj_arr.multi_delete_shelf_ind="N",g_redo_final_obj_arr.push(g_redo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[])),render(i),logDebug("function : show_notch_labels","E")}catch(e){error_handling(e)}}function addlabelText(e,t,o,i,n,r){try{logDebug("function : addlabelText; text : "+e+"; textHeight : "+t+"; actualFontSize : "+o+"; font_color : "+i+"; txt_align : "+n+"; back_color : "+r,"S");var a=document.createElement("canvas"),l=a.getContext("2d");l.fillStyle="#000000";l.measureText(e).width;var[s,_]=get_visible_text_dim(e,t);a.width=s,a.height=_,l.font="normal "+t+"px Arial",l.textAlign=n,l.textBaseline="middle",""!==r&&(l.fillStyle=r,l.fillRect(0,0,a.width,a.height)),l.fillStyle=i,l.fillText(e,s/2,_/2);let c=new THREE.CanvasTexture(a);c.minFilter=THREE.LinearFilter;var g=new THREE.SpriteMaterial({map:c});g.map.minFilter=THREE.LinearFilter;var d=new THREE.Sprite(g);return d.scale.set(s/_*o,o,1),logDebug("function : addlabelText","E"),d.uuid=e,d}catch(e){error_handling(e)}}async function clearThree(e){for(;e.children.length>0;)clearThree(e.children[0]),e.remove(e.children[0]);e.geometry&&e.geometry.dispose(),e.material&&(Object.keys(e.material).forEach((t=>{e.material[t]&&null!==e.material[t]&&"function"==typeof e.material[t].dispose&&e.material[t].dispose()})),e.material.dispose()),e.texture&&e.texture.dispose(),e.map&&e.map.dispose()}function show_labels(e,t,o,i){try{var n=g_pog_json[i].ModuleInfo,r=-1,a=-1,l=-1,s=0;try{if("Y"==e||"Y"==t)for(const D of n){if(void 0===D.ParentModule||null==D.ParentModule){var _=D.ShelfInfo,g=0;for(const n of _){if("BASE"!==n.ObjType&&"NOTCH"!==n.ObjType&&"TEXTBOX"!==n.ObjType&&("Y"==t&&"DIVIDER"!==n.ObjType||"Y"==e)){if("DIVIDER"==n.ObjType){var d=g_pog_json[i].ModuleInfo[s].ShelfInfo;$.each(d,(function(e,t){"BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&$.each(t.ItemInfo,(function(t,o){"DIVIDER"==o.Item&&n.ShelfDivObjID==o.ObjID&&(r=s,a=e,l=t)}))}));var c=g_world.getObjectById(n.ShelfDivObjID)}else c=g_world.getObjectById(n.SObjID);var f=0;if(void 0!==c){if(void 0!==n.LObjID&&-1!==n.LObjID&&"Y"==e){var p=c.getObjectById(n.LObjID);c.remove(p)}else if("Y"==t&&void 0!==n.NotchLabelObjID&&-1!==n.NotchLabelObjID){p=c.getObjectById(n.NotchLabelObjID);c.remove(p);for(k=0;k<100;k++){if(n.Y+n.H/2<=g_pog_json[i].BaseH+D.NotchStart){f=0;break}if(n.Y+n.H/2<=g_pog_json[i].BaseH+D.NotchStart+D.NotchSpacing*k){f=k;break}}}var u=n.Color;if(null==hexToRgb(u))var b=parseInt("FF",16),m=parseInt("FF",16),h=parseInt("FF",16);else b=hexToRgb(u).r,m=hexToRgb(u).r,h=hexToRgb(u).g;var I=getTextColor(b,m,h);if("Y"==t&&"DIVIDER"!==n.ObjType)var v=addlabelText(o+" "+f,g_labelFont,g_labelActualSize,I,"center","");else v=addlabelText(n.Shelf,g_labelFont,g_labelActualSize,I,"center","");void 0!==v&&(c.add(v),v.position.y=-.005,0!==n.Rotation||0!==n.Slope?v.position.z=n.D/2+.005:v.position.z=.005,"DIVIDER"==n.ObjType?(v.position.x=0,g_pog_json[i].ModuleInfo[r].ShelfInfo[a].ItemInfo[l].LObjID=v.id,g_pog_json[i].ModuleInfo[s].ShelfInfo[g].LObjID=v.id):"Y"==t?(v.position.x=0-(n.W/4+.01),g_pog_json[i].ModuleInfo[s].ShelfInfo[g].NotchLabelObjID=v.id):(v.position.x=0-(n.W/2.4+.01),g_pog_json[i].ModuleInfo[s].ShelfInfo[g].LObjID=v.id))}}g+=1}}s+=1}else for(const o of n){if(void 0===o.ParentModule||null==o.ParentModule){_=o.ShelfInfo,g=0;for(const o of _){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&("Y"==t&&"DIVIDER"!==o.ObjType||"Y"==e)){if("DIVIDER"==o.ObjType)c=g_world.getObjectById(o.ShelfDivObjID);else c=g_world.getObjectById(o.SObjID);if(void 0!==o.LObjID&&-1!==o.LObjID&&"Y"==e){p=c.getObjectById(o.LObjID);c.remove(p)}else if("Y"==t&&void 0!==o.NotchLabelObjID&&-1!==o.NotchLabelObjID){p=c.getObjectById(o.NotchLabelObjID);c.remove(p)}g_pog_json[i].ModuleInfo[s].ShelfInfo[g].LObjID=-1}g+=1}}s+=1}}catch(e){error_handling(e)}}catch(e){error_handling(e)}}function addItemDescription(e,t,o,i,n,r,a,l,s,_,g,d,c,f){try{logDebug("function : addItemDescription; text : "+e+"; textHeight : "+t+"; actualFontSize : "+o+"; font_color : "+i+"; txt_align : "+n+"; back_color : "+r+"; obj_width : "+a+"; obj_height : "+l+"; wrap_text : "+s+"; item_vertical_text_display : "+d+"; item_text_center_align : "+c,"S"),e=e.replace(/\ - $/,"");var p=document.createElement("DIV");p.style.fontFamily="Arial",p.style.fontWeight="normal",p.style.fontSize=t+"pt",p.style.position="absolute",p.style.top="-500px",p.style.left="0",p.innerHTML=e,document.body.appendChild(p);let g={width:p.offsetWidth,height:p.offsetHeight},C=window.getComputedStyle(p,null),N=parseFloat(C.fontSize);document.body.removeChild(p);var u=document.createElement("canvas").getContext("2d").measureText(e);let M=g.height-(u.fontBoundingBoxAscent+u.fontBoundingBoxDescent||0),F={width:u.width,cssHeight:g.height,cssFontSizePx:N,fontAscent:u.fontBoundingBoxAscent||0,fontDescent:u.fontBoundingBoxDescent||0,actualAscent:u.actualBoundingBoxAscent||0,actualDescent:u.actualBoundingBoxDescent||0,lineHeight:g.height,lineGap:M};if("Y"===d){var b=a,m=l,[h,I]=get_visible_size(.012,10*b,10*m,g_canvas,g_camera),v=(x=document.createElement("canvas")).getContext("2d");x.width=h,x.height=I,v.textAlign="left",v.textBaseline="top",r&&(v.fillStyle=r,v.fillRect(0,0,h,I)),v.fillStyle=i||"#000";let o=t;const n=12,s=e.split("");let _=!1;for(;o>n;){v.font=`${o}px Arial`;const e=Math.floor(I/(1.2*o));if(s.length<=e){_=!0;break}o--}let g=1;if(!_)for(g=2;o>n;){v.font=`${o}px Arial`;const e=Math.floor(I/(1.2*o))*g;if(s.length<=e)break;o--}t=o;let d=1*o;v.font=`${t}px Arial`;const p=Math.floor(I/d),u=Math.max(...s.map((e=>v.measureText(e).width)));let O="Y"===c?(h-(g*u+.4*o*(g-1)))/2:0;const y=Math.min(p,s.length)*d,T="Y"===c?(I-y)/2:0;f%2==0&&_&&(O+=u);let E=0,R=0;for(let e=0;e<s.length;e++){const t=s[e],i=O+E*(u+.4*o)+(u-v.measureText(t).width)/2,n=T+R*d;if(v.fillText(t,i,n),R++,R>=p&&(R=0,E++,E>=g))break}var D=new THREE.CanvasTexture(x);D.minFilter=THREE.LinearFilter,D.matrixAutoUpdate=!0,D.needsUpdate=!0,D.isCanvasTexture=!0;var j=new THREE.PlaneGeometry(b,m),S=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:D,transparent:!0,opacity:1});return(B=new THREE.Mesh(j,S)).uuid="ITEM_DESC",B}{var O=_,y=(a-l)/((a+l)/2)*100;if(y<0&&(y=-y),O>0)if(y>O&&l>a){b=l,m=a;var T=10*l,E=10*a}else b=a,m=l,T=10*a,E=10*l;else T=10*(b=a<l?l:a),E=10*(m=a<l?a:l);g.width,parseInt(t);var x,[h,I]=get_visible_size(.012,T,E,g_canvas,g_camera),[R,w]=get_visible_text_dim(e,t);v=(x=document.createElement("canvas")).getContext("2d");x.width=h,x.height=I,v.textAlign=n,v.textBaseline="top",""!==r&&(v.fillStyle=r,v.fillRect(0,0,x.width,x.height)),v.fillStyle=i;var H=F.lineHeight-F.lineGap;fitText(v,e,h/2,0,h,I,t,H);let o=new THREE.CanvasTexture(x);o.minFilter=THREE.LinearFilter,o.matrixAutoUpdate=!0,o.needsUpdate=!0,o.isCanvasTexture=!0;j=new THREE.PlaneGeometry(b,m);(S=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:o,transparent:!0,opacity:1})).map.minFilter=THREE.LinearFilter;var B=new THREE.Mesh(j,S);return y>O&&l>a&&B.rotateOnAxis(new THREE.Vector3(0,0,1),90*Math.PI/180),B.uuid="ITEM_DESC",logDebug("function : addItemDescription","E"),B}}catch(e){error_handling(e)}}function fitText(e,t,o,i,n,r,a,l){try{if(logDebug("function : fitText; text : "+t+"; x : "+o+"; y : "+i+"; width : "+n+"; height : "+r+"; fontSize : "+a+"; lineHeight : "+l,"S"),void 0!==o&&void 0!==i&&void 0!==n&&void 0!==r&&!isNaN(n)&&!isNaN(r)){if(e.font="normal "+a+"px Arial",(u=e.measureText(t)).width<=n&&0==g_lines.length){var s=o-(n-u.width)/2+2;return void e.fillText(t,s,r/2-a/4)}var _=t.split(" "),g="";g_lines=[];for(var d=0;d<_.length;d++){var c=g+_[d]+" ";(u=e.measureText(c)).width>n&&d>0?(g_lines.push(g),g=_[d]+" "):g=c}if(!((u=e.measureText(g)).width<=n))return fitText(e,t,o,i,n,r,a-1,l);if(g_lines.push(g),g_lines.length>3)return fitText(e,t,o,i,n,r,a-1,l);for(var f=i+a/4,p=0;p<g_lines.length;p++){var u;s=o-(n-(u=e.measureText(g_lines[p])).width)/2+2;e.fillText(g_lines[p],s,f),f+=1.1*a}}logDebug("function : fitText","E")}catch(e){error_handling(e)}}async function showHideItemDescription(e,t,o,i){try{logDebug("function : showHideItemDescription; g_show_item_desc : "+e,"S");var n=g_pog_json[i].ModuleInfo,r=g_camera.position.z,a=t,l=o.split(","),s=parseInt(a.replace("#","0x"),16);new THREE.Color(s);if("N"==e){var _=0;for(const e of n){if(void 0===e.ParentModule||null==e.ParentModule){var g=e.ShelfInfo,d=g_pog_json[i].ModuleInfo[_].Carpark,c=0;for(const e of g){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.ItemInfo.length>0){var f=e.ItemInfo,p=0;for(const e of f){if("DIVIDER"!==e.Item&&""!==e.Desc&&void 0!==e.Desc){var u=g_scene_objects[i].scene.children[2].getObjectById(e.ObjID);if(void 0!==e.DescID&&-1!==e.DescID&&void 0!==u){var b=u.getObjectById(e.DescID);u.remove(b)}g_pog_json[i].ModuleInfo[_].ShelfInfo[c].ItemInfo[p].DescID=-1}p+=1}}c+=1}p=0;if(void 0!==d&&d.length>0)for(const e of d[0].ItemInfo){if("DIVIDER"!==e.Item&&""!==e.Desc&&void 0!==e.Desc){u=g_scene_objects[i].scene.children[2].getObjectById(e.ObjID);if(void 0!==e.DescID&&-1!==e.DescID){b=u.getObjectById(e.DescID);u.remove(b)}g_pog_json[i].ModuleInfo[_].Carpark[0].ItemInfo[p].DescID=-1}p+=1}}_+=1}}else{g_camera.position.z=7;_=0;for(const e of n){if(void 0===e.ParentModule||null==e.ParentModule){g=e.ShelfInfo,d=g_pog_json[i].ModuleInfo[_].Carpark,c=0;for(const e of g){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.ItemInfo.length>0){f=e.ItemInfo,p=0;for(const t of f){if("DIVIDER"!==t.Item&&""!==t.Desc&&void 0!==t.Desc){u=g_scene_objects[i].scene.children[2].getObjectById(t.ObjID);var m=g_pog_json[i].ModuleInfo[_].ShelfInfo[c].Color;if(null==hexToRgb(m))parseInt("FF",16),parseInt("FF",16),parseInt("FF",16);else hexToRgb(m).r,hexToRgb(m).r,hexToRgb(m).g;O="#000000";var h="";if("N"==g_temp_desc)for(q=0;q<l.length;q++)"ITEM"==l[q]?h=h+t.ItemID+" - ":"DESCRIPTION"==l[q]&&(h=h+t.Desc+" - ");else{var I=g_temp_desc.split(""),v=0,D=get_sales_info(i,t.ItemID);for(const e of I){if("I"==e&&(h=h+t.ItemID+" - "),"D"==e&&(h=h+t.Desc+" "+t.DescSecond+" - "),"V"==e&&(h=h+" SV: "+D.SalesPerWeek+" "),"U"==e&&(h=h+"SU "+D.SalesUnitPerWeek+" "),"R"==e&&(h=h+" VRM$: "+D.VRM+" "),"C"==e){var j=t.SizeDesc.split("*");details=t.BHoriz*t.BVert*t.BaseD/parseInt(j[1]),isNaN(details)||!isFinite(details)?temp_text="C: 0":temp_text="C: "+details.toFixed(1),h=h+temp_text+" "}"O"==e&&(details=t.BHoriz*t.BVert*t.BaseD/(D.SalesUnitPerWeek/7),isNaN(details)||!isFinite(details)?temp_text="D: 0":temp_text="D: "+details.toFixed(1),h=h+temp_text+" "),"P"==e&&(h=h+"VRM%: "+D.VRMPer+" "),"F"==e&&(h=h+" "+t.BHoriz+" - "),"E"==e&&(h=h+t.Brand+" "+t.Desc+" "+t.SizeDesc+" - "),v>0&&(h+="\n"),v++}}if(void 0!==t.DescID&&-1!==t.DescID){b=u.getObjectById(t.DescID);u.remove(b)}if(void 0!==u){var S=addItemDescription(h,70,g_labelActualSize,O,"center","",t.W,t.H,"Y",g_vert_text_dis,t.ItemID,g_item_vertical_text_display,g_item_text_center_align,t.BHoriz);u.add(S),S.position.x=0,S.position.y=0,0!==e.Rotation||0!==e.Slope?S.position.z=t.D/2+5e-4:S.position.z=6e-4,u.WireframeObj.material.color.setHex(0),g_pog_json[i].ModuleInfo[_].ShelfInfo[c].ItemInfo[p].DescID=S.id}}p+=1}}c+=1}p=0;if(void 0!==d&&d.length>0)for(const e of d[0].ItemInfo){if("DIVIDER"!==e.Item&&""!==e.Desc&&void 0!==e.Desc){var O;u=g_scene_objects[i].scene.children[2].getObjectById(e.ObjID),m=g_pog_json[i].ModuleInfo[_].Carpark[0].Color;if(null==hexToRgb(m))parseInt("FF",16),parseInt("FF",16),parseInt("FF",16);else hexToRgb(m).r,hexToRgb(m).r,hexToRgb(m).g;O="#000000";h="",S=addItemDescription(h=e.ItemID+"- "+e.Desc,70,g_labelActualSize,O,"center","",e.W,e.H,"Y",g_vert_text_dis,e.ItemID,g_item_vertical_text_display,g_item_text_center_align,e.BHoriz);u.add(S),S.position.x=0,S.position.y=0,S.position.z=.001,g_pog_json[i].ModuleInfo[_].Carpark[0].ItemInfo[p].DescID=S.id}p+=1}}_+=1}g_camera.position.z=r}render(i),logDebug("function : showHideItemDescription","E")}catch(e){error_handling(e)}}function show_single_item_desc(e,t,o,i,n,r,a,l,s){if("DIVIDER"!==i.Item&&""!==i.Desc&&void 0!==i.Desc&&"Y"==g_show_desc_no_image){var _=r.position.z;r.position.z=7;var g=g_pog_json[s].ModuleInfo[e].ShelfInfo[t].Color;if(null==hexToRgb(g))parseInt("FF",16),parseInt("FF",16),parseInt("FF",16);else hexToRgb(g).r,hexToRgb(g).r,hexToRgb(g).g;"#000000";var d=parseInt(a.replace("#","0x"),16),c=(new THREE.Color(d),l.split(",")),f="";if("N"==g_temp_desc)for(q=0;q<c.length;q++)"ITEM"==c[q]?f=f+i.ItemID+" - ":"DESCRIPTION"==c[q]&&(f=f+i.Desc+" - ");else{var p=g_temp_desc.split(""),u=0,b=get_sales_info(s,i.ItemID);for(const e of p){if("I"==e&&(f=f+i.ItemID+" - "),"D"==e&&(f=f+i.Desc+" "+i.DescSecond+" - "),"V"==e&&(f=f+" SV: "+b.SalesPerWeek+" "),"U"==e&&(f=f+"SU "+b.SalesUnitPerWeek+" "),"R"==e&&(f=f+" VRM$: "+b.VRM+" "),"C"==e){var m=i.SizeDesc.split("*");details=i.BHoriz*i.BVert*i.BaseD/parseInt(m[1]),isNaN(details)||!isFinite(details)?temp_text="C: 0":temp_text="C: "+details.toFixed(1),f=f+temp_text+" "}"O"==e&&(details=i.BHoriz*i.BVert*i.BaseD/(b.SalesUnitPerWeek/7),isNaN(details)||!isFinite(details)?temp_text="D: 0":temp_text="D: "+details.toFixed(1),f=f+temp_text+" "),"P"==e&&(f=f+"VRM%: "+b.VRMPer+" "),"F"==e&&(f=f+" "+i.BHoriz+" - "),"E"==e&&(f=f+i.Brand+" "+i.Desc+" "+i.SizeDesc+" - "),u>0&&(f+="\n"),u++}}if(void 0!==i.DescID&&-1!==i.DescID){var h=n.getObjectById(i.DescID);n.remove(h)}var I=addItemDescription(f,70,g_labelActualSize,"#000000","center","",i.W,i.H,"Y",g_vert_text_dis,i.ItemID,g_item_vertical_text_display,g_item_text_center_align,i.BHoriz);n.add(I),I.position.x=0,I.position.y=0,I.position.z=6e-4,n.WireframeObj.material.color.setHex(0),g_pog_json[s].ModuleInfo[e].ShelfInfo[t].ItemInfo[o].DescID=I.id,r.position.z=_}}async function showHideDaysOfSupplyLabel(e,t="N",o,i="Y",n="N",r,a){try{if(logDebug("function : showHideDaysOfSupplyLabel; show_label_ind : "+e,"S"),g_pog_json.length>0){var l=g_pog_json[o].ModuleInfo,s=g_scene_objects[o].scene.children[0].position.z;if("N"==e){var _=0;for(const e of l){if(void 0===e.ParentModule||null==e.ParentModule){var g=e.ShelfInfo,d=g_pog_json[o].ModuleInfo[_].Carpark,c=0;for(const e of g){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.ItemInfo.length>0){var f=e.ItemInfo,p=0;for(const e of f){if("DIVIDER"!==e.Item&&""!==e.DaysOfSupply&&void 0!==e.DaysOfSupply){console.log("beforeupdatedos func",g_show_days_of_supply);var u=await updateDaysOfSupply(e,p,c,_,"N",t,o,n),b=g_scene_objects[o].scene.children[2].getObjectById(e.ObjID);if(void 0!==e.daysOfSupplyID&&-1!==e.daysOfSupplyID){var m=b.getObjectById(e.daysOfSupplyID);b.remove(m)}g_pog_json[o].ModuleInfo[_].ShelfInfo[c].ItemInfo[p].daysOfSupplyID=-1}p+=1}}c+=1}p=0;if(void 0!==d&&d.length>0)for(const e of d[0].ItemInfo){if("DIVIDER"!==e.Item&&""!==e.DaysOfSupply&&void 0!==e.DaysOfSupply){u=await updateDaysOfSupply(e,p,c,_,"Y",t,o),b=g_scene_objects[o].scene.children[2].getObjectById(e.ObjID);if(void 0!==e.daysOfSupplyID&&-1!==e.daysOfSupplyID){m=b.getObjectById(e.daysOfSupplyID);b.remove(m)}g_pog_json[o].ModuleInfo[_].Carpark[0].ItemInfo[p].daysOfSupplyID=-1}p+=1}}_+=1}}else{var h=a.split(",");_=0;g_scene_objects[o].scene.children[0].position.z=6;for(const e of l){if(void 0===e.ParentModule||null==e.ParentModule){g=e.ShelfInfo,d=g_pog_json[o].ModuleInfo[_].Carpark,c=0;for(const e of g){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.ItemInfo.length>0){f=e.ItemInfo,p=0;for(const a of f){if(void 0!==(u=await updateDaysOfSupply(a,p,c,_,"N",t,o,n))&&"Y"==i)if("DIVIDER"!==u.Item&&""!==u.DaysOfSupply&&void 0!==u.DaysOfSupply)if(void 0!==(b=g_scene_objects[o].scene.children[2].getObjectById(u.ObjID))){var I="#000000",v="";if(0!==nvl(b)){var D=0;for(const e of h){var j="",S=e.split(":"),O=get_sales_info(o,a.ItemID);if("COS"==S[0]){var y=a.SizeDesc.split("*"),T=a.CapFacing*a.CapDepth*a.CapHorz*parseInt(1==a.CapMerch?a.UnitperTray:1);details=(a.BHoriz*a.BVert*a.BaseD*parseInt(1==a.MerchStyle?a.UnitperTray:2==a.MerchStyle?a.UnitperCase:1)+T)/parseInt(y[1]),j=isNaN(details)||!isFinite(details)?S[1]+": 0":S[1]+": "+details.toFixed(1)}if("DOS"==S[0])j=parseFloat(b.DaysOfSupply).toFixed(1);else if("SALES"==S[0])j=S[1]+": "+O.SalesPerWeek;else if("UNIT"==S[0])j=S[1]+": "+O.SalesUnitPerWeek;else if("VRMS"==S[0])j=S[1]+": "+O.VRMPer;else if("DOS_CAL"==S[0])details=a.BHoriz*a.BVert*a.BaseD*parseInt(1==a.MerchStyle?a.UnitperTray:2==a.MerchStyle?a.UnitperCase:1)/(O.SalesUnitPerWeek/7),j=isNaN(details)||!isFinite(details)?S[1]+": 0":S[1]+": "+details.toFixed(1);else if("AVG_SALES_WK"==S[0])j=S[1]+": "+O.AvgSalesPerWeek;else if("AVG_QTY_WK"==S[0])j=S[1]+": "+O.AvgQtyPerWeek;else if("SALES_PER"==S[0])j=S[1]+"%: "+O.SalesPartPer;else if("QTY_PER"==S[0])j=S[1]+"%: "+O.QtyPartPer;else if("NO_OF_LIST"==S[0])j=S[1]+": "+O.NoOfListing;else if("GP"==S[0])j=S[1]+": "+O.GP;else if("ASP"==S[0])j=S[1]+": "+O.ASP;else if("EDLP"==S[0]){var E=void 0!==a.EDLP&&null!==a.EDLP?a.EDLP:0;j=S[1]+": "+E}v=0==D?j:v+"\n"+j,D++}}if(v.substring(1),0!==nvl(u.daysOfSupplyID)&&-1!==u.daysOfSupplyID){m=b.getObjectById(u.daysOfSupplyID);b.remove(m)}var x=addDaysOfSupply(v,20,g_labelActualSize,I,"center","#ffffff",r,u.W,u.H);b.add(x),x.uuid="days_of_supply",new_x=u.W/2,new_y=u.H/2,x.position.x=0,x.position.y=0,0!==e.Rotation||0!==e.Slope?x.position.z=u.D/2+.005:x.position.z=6e-4,g_pog_json[o].ModuleInfo[_].ShelfInfo[c].ItemInfo[p].daysOfSupplyID=x.id}p+=1}}c+=1}p=0;if(void 0!==d&&d.length>0)for(const e of d[0].ItemInfo){if("DIVIDER"!==e.Item&&""!==e.DaysOfSupply&&void 0!==e.DaysOfSupply){await updateDaysOfSupply(e,p,0,_,"Y",t,o,n);if("Y"==i){b=g_scene_objects[o].scene.children[2].getObjectById(e.ObjID),I="#000000",v="";var R=g_scene_objects[o].scene.children[2].getObjectById(e.ObjID);if(0!==nvl(R)&&(v=R.DaysOfSupply),void 0!==e.daysOfSupplyID&&-1!==e.daysOfSupplyID){m=b.getObjectById(e.daysOfSupplyID);b.remove(m)}x=addDaysOfSupply(v,20,g_labelActualSize,I,"center","#ffffff",r,e.W,e.H);b.add(x),x.uuid="days_of_supply",g_pog_json[o].ModuleInfo[_].Carpark[0].ItemInfo[p].daysOfSupplyID=x.id}}p+=1}}_+=1}g_scene_objects[o].scene.children[0].position.z=s}}render(o),logDebug("function : showHideDaysOfSupplyLabel","E")}catch(e){error_handling(e)}}function addDaysOfSupplySingle(e,t,o,i,n,r,a){try{logDebug("function : addlabelText; text : "+e+"; textHeight : "+t+"; actualFontSize : "+o+"; font_color : "+i+"; txt_align : "+n+"; back_color : "+r,"S");var l=document.createElement("canvas"),s=l.getContext("2d");s.fillStyle="#000000";s.measureText(e).width;if("N"==a.split(",")[0])o=a.split(",")[1];else o=a.split(",")[1];var[_,g]=get_visible_text_dim(e,t);l.width=_,l.height=g,s.font="normal "+t+"px Arial",s.textAlign=n,s.textBaseline="middle",""!==r&&(s.fillStyle=r,s.fillRect(0,0,l.width,l.height)),s.fillStyle=i,s.fillText(e,_/2,g/2);let f=new THREE.CanvasTexture(l);f.minFilter=THREE.LinearFilter;var d=new THREE.SpriteMaterial({map:f});d.map.minFilter=THREE.LinearFilter;var c=new THREE.Sprite(d);return c.scale.set(_/g*o,o,1),c.uuid="days_of_supply",logDebug("function : addlabelText","E"),c}catch(e){error_handling(e)}}function addDaysOfSupply(e,t,o,i,n,r,a,l,s){try{logDebug("function : addlabelText; text : "+e+"; textHeight : "+t+"; actualFontSize : "+o+"; font_color : "+i+"; txt_align : "+n+"; back_color : "+r,"S");var _=e.split("\n"),g=10*l,d=10*s;t=70;var c=document.createElement("canvas"),f=c.getContext("2d");f.fillStyle="#000000";f.measureText(e).width;if("N"==a.split(",")[0])o=a.split(",")[1];else o=a.split(",")[1];o=o/1.5*_.length;var[p,u]=get_visible_size(.012,g,d,g_canvas,g_camera);c.width=p,c.height=u,f.font="bold "+t+"px Arial",f.textAlign=n,f.textBaseline="middle",""!==r&&(f.fillStyle=r,f.fillRect(0,0,c.width,c.height)),f.fillStyle=i;for(var b=0+t/2,m=0;m<_.length;m++){var h=0-(l-f.measureText(_[m]).width)/2+2;f.fillText(_[m],h,b),b+=1.11*t}let j=new THREE.CanvasTexture(c);j.minFilter=THREE.LinearFilter,j.matrixAutoUpdate=!0,j.needsUpdate=!0,j.isCanvasTexture=!0;var I=new THREE.PlaneGeometry(l,s),v=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:j,transparent:!0,opacity:.6});v.map.minFilter=THREE.LinearFilter;var D=new THREE.Mesh(I,v);return D.uuid="days_of_supply",logDebug("function : addlabelText","E"),D}catch(e){error_handling(e)}}async function showFixelAvailableSpace(e,t,o){try{logDebug("function : showFixelAvailableSpace; resetYN : "+e+"; calcShelfSpace : "+t,"S"),t=void 0===t?"N":t,g_labelFont=12;var[i,n]=[-1,-1],r=g_pog_index;if("N"==t){"Y"==(e=void 0===e?"Y":e)&&("N"==g_show_fixel_space?(g_show_fixel_space="Y",$(".fixel_space").addClass("item_label_active")):(g_show_fixel_space="N",$(".fixel_space").removeClass("item_label_active")));var a=[];if(void 0!==o?a.push(g_pog_json[o]):a=g_pog_json,"Y"==g_show_fixel_space){if("N"==g_all_pog_flag)var l=o;else l=0;for(const e of g_pog_json){if(l!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex||l==g_ComViewIndex&&"PREV_VERSION"==g_compare_view){g_scene=g_scene_objects[l].scene,g_camera=g_scene_objects[l].scene.children[0];for(const e of g_pog_json[l].ModuleInfo)if(e&&Array.isArray(e.ShelfInfo)){var s=0;for(const t of e.ShelfInfo){if(void 0===(O=g_scene_objects[l].scene.children[2].getObjectById(t.SObjID))||"SHELF"!=t.ObjType&&"HANGINGBAR"!=t.ObjType||([i,n]=getCombinationShelf(l,t.Shelf)),-1!==i&&-1!==n)calcCombineShelfAvlSpace(l,i);else if(void 0!==O&&("SHELF"==t.ObjType||"HANGINGBAR"==t.ObjType||"ROD"==t.ObjType)){var _=0;if(void 0!==t.ROverhang&&""!=t.ROverhang||(t.ROverhang=0),void 0!==t.LOverhang&&""!=t.LOverhang||(t.LOverhang=0),"Y"==g_lr_overhung)var g=t.W+t.ROverhang+t.LOverhang;else g=t.W;var d=t.D,c=0,f=0,p=Array.isArray(t.ItemInfo)?t.ItemInfo:[];for(const e of p)void 0!==e.BottomObjID&&""!=e.BottomObjID||("SHELF"==t.ObjType||"HANGINGBAR"==t.ObjType?_+=e.W:_+=e.D,f++);if("SHELF"==t.ObjType||"HANGINGBAR"==t.ObjType){if("E"!==t.SpreadItem){var u=t.HorizGap?t.HorizGap:0;_+=f>1?u*(f-1):0}c=wpdSetFixed(100*(g-_))}else c=wpdSetFixed(100*(d-_));if("F"==t.SpreadItem&&("SHELF"==t.ObjType||"HANGINGBAR"==t.ObjType)){var b=0;for(const e of t.ItemInfo)b+=e?.CrushHoriz>0?e?.W:e?.RW;c=wpdSetFixed(100*(g-b))}if(void 0!==t.availableSpaceObjID&&-1!==t.availableSpaceObjID){var m=O.getObjectById(t.availableSpaceObjID);O.remove(m)}var h=t.Color;if(null==hexToRgb(h))var I=parseInt("FF",16),v=parseInt("FF",16),D=parseInt("FF",16);else I=hexToRgb(h).r,v=hexToRgb(h).r,D=hexToRgb(h).g;var j=getTextColor(I,v,D);c<0&&(c=0);var S=addlabelText("Space "+c,g_labelFont,g_labelActualSize,j,"center","");O.add(S),(T=g_scene_objects[l].scene.children[2].getObjectById(t.SObjID)).AvlSpace=c,"ROD"==t.ObjType?S.position.y=-.009:S.position.y=-.005,S.uuid="fixel_space",0!==t.Rotation||0!==t.Slope?S.position.z=t.D/2+.005:S.position.z=.005,"DIVIDER"!==t.ObjType&&("ROD"==t.ObjType?S.position.x=t.W/2.4+.08+0:S.position.x=t.W/2.4-.08+0,e.ShelfInfo[s].availableSpaceObjID=S.id)}s++}0}render(l),set_indicator_objects(l)}if("Y"!=g_all_pog_flag)break;l++}g_scene=g_scene_objects[r].scene,g_camera=g_scene_objects[r].scene.children[0]}else{if("N"==g_all_pog_flag)l=o;else l=0;for(const e of g_pog_json){if(l!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex||l==g_ComViewIndex&&"PREV_VERSION"==g_compare_view){g_renderer=g_scene_objects[l].renderer,g_scene=g_scene_objects[l].scene,g_camera=g_scene_objects[l].scene.children[0];for(const e of g_pog_json[l].ModuleInfo){f=0;for(const t of e.ShelfInfo){if("BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&"TEXTBOX"!==t.ObjType){var O=g_scene_objects[l].scene.children[2].getObjectById(t.SObjID);if(void 0!==t.availableSpaceObjID&&-1!==t.availableSpaceObjID){var y=O.getObjectById(t.availableSpaceObjID);O.remove(y)}e.ShelfInfo[f].availableSpaceObjID=-1}f++}}render(l)}if("N"==g_all_pog_flag)break;l++}g_renderer=g_scene_objects[r].renderer,g_scene=g_scene_objects[r].scene,g_camera=g_scene_objects[r].scene.children[0]}}else{if("N"==g_all_pog_flag)l=o;else l=0;for(const e of g_pog_json){if(l!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex){g_renderer=g_scene_objects[l].renderer,g_scene=g_scene_objects[l].scene,g_camera=g_scene_objects[l].scene.children[0];for(const e of g_pog_json[l].ModuleInfo){f=0;for(const t of e.ShelfInfo){if(void 0!==(O=g_scene_objects[l].scene.children[2].getObjectById(t.SObjID))&&"SHELF"==t.ObjType){_=0;if(void 0!==t.ROverhang&&""!=t.ROverhang||(t.ROverhang=0),void 0!==t.LOverhang&&""!=t.LOverhang||(t.LOverhang=0),"Y"==g_lr_overhung)g=t.W+t.ROverhang+t.LOverhang;else g=t.W;c=0,s=0;for(const o of e.ShelfInfo[f].ItemInfo)void 0!==o.BottomObjID&&""!=o.BottomObjID||("SHELF"==t.ObjType||"HANGINGBAR"==t.ObjType?_+=o.W:_+=o.D,s++);if("SHELF"==t.ObjType||"HANGINGBAR"==t.ObjType){if("E"!==t.SpreadItem){u=t.HorizGap?t.HorizGap:0;_+=s>1?u*(s-1):0}c=wpdSetFixed(100*(g-_))}else c=wpdSetFixed(100*(d-_));if("F"==t.SpreadItem&&("SHELF"==t.ObjType||"HANGINGBAR"==t.ObjType)){b=0;for(const e of t.ItemInfo)b+=e?.CrushHoriz>0?e?.W:e?.RW;c=wpdSetFixed(100*(g-b))}var T=g_scene_objects[l].scene.children[2].getObjectById(t.SObjID);c<0&&(c=0),T.AvlSpace=c}f++}}render(l)}if("N"==g_all_pog_flag)break;l++}g_renderer=g_scene_objects[r].renderer,g_scene=g_scene_objects[r].scene,g_camera=g_scene_objects[r].scene.children[0]}logDebug("function : showFixelAvailableSpace","E")}catch(e){error_handling(e)}}function getLabelPosition(e,t,o){o=o.toUpperCase();try{var i,n;return"M"==t?(i=-1,n=-1):"S"==t?"CENTER"==o?(i=0-(e.W/4+.01),n="ROD"==e.ObjType?.05:-.005):"TOP"==o?"HANGINGBAR"==e.ObjType?(i=0-(e.W/2.4+.01),n=0-(e.H/2+.012)):"ROD"==e.ObjType?(i=0-(e.W/4+.01),n=.05):(i=0-(e.W/2.4+.01),n=e.H/2+.012+0):"LEFT"==o?"HANGINGBAR"==e.ObjType?(i=0-(e.W/2+.08),n=-.005):"ROD"==e.ObjType?(i=0-(e.W/4+.08),n=.005):(i=0-(e.W/2+.08),n=-.005):"RIGHT"==o?"HANGINGBAR"==e.ObjType?(i=0-(e.W/2+.1),n=-.005):"ROD"==e.ObjType?(i=0-(e.W/4+.01),n=.05):(i=e.W/2+.1+0,n=-.005):"BOTTOM"==o&&("HANGINGBAR"==e.ObjType?(i=0-(e.W/2.4+.01),n=e.H/2+.012+0):"ROD"==e.ObjType?(i=0-(e.W/4+.01),n=.05):(i=0-(e.W/2.4+.01),n=0-(e.H/2+.012))):"I"==t&&(i=-1,n=-1),[i,n]}catch(e){error_handling(e)}}function highlightProduct(e,t,o,i,n,r){try{console.log("highlighting product",e),logDebug("function : add_wireframe; linewidth : "+t,"S");var a=new THREE.BoxGeometry(o+.03,i+.05,0),l=new THREE.EdgesGeometry(a),s=new THREE.LineBasicMaterial({color:16711680,linewidth:3}),_=new THREE.LineSegments(l,s);return e.geometry.computeBoundingBox(),_.position.copy(e.geometry.boundingBox.getCenter(new THREE.Vector3)),_.position.z+=.01,_.BorderColour=16711680,_.uuid="highlight_frame",e.WireframeObj=_,e.add(_),e.WireframeObj=_,logDebug("function : add_wireframe","E"),_.id}catch(e){error_handling(e)}}function render_blink_effect(){clearInterval(g_myVar),g_myVar=setInterval((function(){blink_effect_3d()}),500)}window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame;var blink_color=16711680,g_intersected=[];function blink_effect_3d(){if(blink_color=16711680==blink_color?65535:16711680,"Y"==g_show_live_image)for(var e=0;e<g_intersected.length;e++)void 0!==g_intersected[e]&&(65535==blink_color?g_intersected[e].WireframeObj.material.color.setHex(16711680):g_intersected[e].WireframeObj.material.color.setHex(65535));else for(e=0;e<g_intersected.length;e++)if(void 0!==g_intersected[e]&&(65535==blink_color?g_intersected[e].material.color.setHex(16711680):g_intersected[e].material.color.setHex(65535),g_intersected[e].children&&g_intersected[e].children.length>0))for(var t=0;t<g_intersected[e].children.length;t++){var o=g_intersected[e].children[t];o.material&&"highlight_frame"!==o.uuid&&"wireframe"!==o.uuid&&"Sprite"!==o.type&&"LineSegments"!==o.type&&(65535==blink_color?o.material.color.setHex(16711680):o.material.color.setHex(65535))}l_highlightStatus=$v("P25_POGCR_HIGHLIGHT_SEARCHED_ITEM"),"Y"==l_highlightStatus&&g_pog_json.length>1?render_all_pog():render(0)}function render(e){logDebug("function : render","S");try{if(void 0!==e&&void 0!==g_scene_objects[e]&&void 0!==g_canvas_objects[e]){if(g_scene_objects.length>0){var t=g_canvas_objects[e].getContext("2d");if(null==t)null!=g_renderer&&g_renderer.render(g_scene,g_camera);else{g_renderer.setPixelRatio(window.devicePixelRatio);var o=g_canvas_objects[e].width,i=g_canvas_objects[e].height;g_renderer.setSize(o,i);var n=g_scene_objects[e].scene.children[0];n.aspect=o/i,n.updateProjectionMatrix(),g_renderer.render(g_scene_objects[e].scene,n),t.drawImage(g_renderer.domElement,0,0,o,i)}}}else null!=g_renderer&&g_renderer.render(g_scene,g_camera);logDebug("function : render","E")}catch(e){error_handling(e)}}var new_count=0;function animate_all(e){logDebug("function : limited_animate","S"),setTimeout((function(){if(new_count<5){new_count+=1,async function(){await render_all_pog()}(),requestAnimationFrame(animate_all)}else new_count=0;logDebug("function : limited_animate","E")}),50)}function animate_all_pog(){requestAnimationFrame(animate_all)}async function render_all_pog(){var e=0;for(const n of g_scene_objects){var t=g_canvas_objects[e].getContext("2d");g_renderer.setPixelRatio(window.devicePixelRatio);var o=g_canvas_objects[e].width,i=g_canvas_objects[e].height;g_renderer.setSize(o,i),g_scene_objects[e].scene.children[0].aspect=o/i,g_renderer.render(g_scene_objects[e].scene,g_scene_objects[e].scene.children[0]),null!==t&&t.drawImage(g_renderer.domElement,0,0,o,i),e++}}async function add_carpark_item(e,t,o,i,n,r,a,l,s,_,g,d,c,f,p,u){logDebug("function : add_carpark_item; uuid : "+e+"; width : "+t+"; height : "+o+"; depth : "+i+"; color : "+n+"; x : "+r+"; y : "+a+"; z : "+l+"; p_module_index : "+s+"; p_shelf_index : "+_+"; i_item_index : "+g+"; recreate : "+d+"; with_image : "+f+"; angle : "+p,"S");try{console.log("add carpark ",f);var b=g_pog_json[u].ModuleInfo[s].Carpark[_].ItemInfo[g],m=b.NVal,h=b.Orientation,I=b.BVert,v=b.BHoriz,D=g_orientation_json[h].split("###");return new Promise((function(i,l){var g="N",d=-1,c=b.Item,h=0;for(const e of g_ItemImages){if(c==e.Item&&D[0]==e.Orientation&&null!==e.ItemImage){g="Y",d=h;break}h++}if("Y"==g&&"Y"==f){var j=new Image,S=new THREE.Texture(j);j.onload=()=>{S.needsUpdate=!0},j.src="data:image/jpeg;base64,"+g_ItemImages[d].ItemImage;var O=new THREE.BoxGeometry(t,o,.001),y=new THREE.MeshStandardMaterial({map:S});0==m&&(S.wrapS=THREE.RepeatWrapping,S.wrapT=THREE.RepeatWrapping,90==p||270==p?S.repeat.set(I,v):S.repeat.set(v,I),90==p?p=270:270==p&&(p=90),S.rotation=p*Math.PI/180),items=new THREE.Mesh(O,y),items.position.x=r,items.position.z=.001,items.position.y=a}else{var T=parseInt(n.replace("#","0x"),16),E=new THREE.Color(T);items=new THREE.Mesh(new THREE.BoxGeometry(t,o,.001),new THREE.MeshStandardMaterial({color:E})),items.position.z=.001,items.position.x=r,items.position.y=a}g_world.add(items);var x=b;items.uuid=e,items.ItemID=x.Item,items.Description=x.Desc,items.HorizFacing=x.BHoriz,items.VertFacing=x.BVert,items.DFacing=x.BaseD,items.DimUpdate=x.DimUpdate,items.SellingPrice=x.SellingPrice,items.SalesUnit=x.SalesUnit,items.NetSales=x.NetSales,items.CogsAdj=x.CogsAdj,items.RegMovement=x.RegMovement,items.AvgSales=x.AvgSales,items.ItemStatus=x.ItemStatus,items.CDTLvl1=x.CDTLvl1,items.CDTLvl2=x.CDTLvl2,items.CDTLvl3=x.CDTLvl3,items.ActualDPP=x.ActualDPP,items.DPPLoc=x.DPPLoc,items.StoreSOH=x.StoreSOH,items.StoreNo=x.StoreNo,items.WeeksOfInventory=x.WeeksOfInventory,items.ShelfPrice=x.ShelfPrice,items.PromoPrice=x.PromoPrice,items.DiscountRate=x.DiscountRate,items.PriceChangeDate=x.PriceChangeDate,items.WeeksOfInventory=x.WeeksOfInventory,items.Qty=x.Qty,items.WhStock=x.WhStock,items.StoreStock=x.StoreStock,items.StockIntransit=x.StockIntransit,items.GrossProfit=x.GrossProfit,items.WeeksCount=x.WeeksCount,items.MovingItem=x.MovingItem,items.Profit=x.Profit,items.TotalMargin=x.TotalMargin,items.W=x.W,items.H=x.H,items.D=x.D,items.Color=x.Color,items.Barcode=x.Barcode,items.Desc=x.Desc,items.Brand=x.Brand,items.Group=x.Group,items.Dept=x.Dept,items.Class=x.Class,items.SubClass=x.SubClass,items.StdUOM=x.StdUOM,items.SizeDesc=x.SizeDesc,items.Supplier=x.Supplier,items.LocID=x.LocID,items.SupplierName=x.SupplierName,items.ItemDim=g_msg_h+": "+(100*x.OH).toFixed(2)+" ("+g_msg_Sq+" : "+x.CrushVert+") "+g_msg_w+": "+(100*x.OW).toFixed(2)+" ("+g_msg_Sq+" : "+x.CrushHoriz+") "+g_msg_d+": "+(100*x.OD).toFixed(2)+" ("+g_msg_Sq+" : "+x.CrushD+")",items.OrientationDesc=x.OrientationDesc,items.StoreCnt=x.StoreCnt,items.RotationDegree=0,items.OW=100*x.OW,items.OH=100*x.OH,items.OD=100*x.OD,items.CrushW=x.CrushHoriz,items.CrushH=x.CrushVert,items.CrushD=x.CrushD,items.Shelf=g_pog_json[u].ModuleInfo[s].Carpark[_].Shelf,items.Rotation=0,items.ItemSlope=0,items.Rotation="N",items.ImageExists="N",items.DescSecond=x.DescSecond,items.DfacingUpd=x.DfacingUpd,items.ItmDescChi=x.ItmDescChi,items.ItmDescEng=x.ItmDescEng,items.TotalUnitsCalc=x.BHoriz*x.BVert*x.BaseD,items.PkSiz=x.PkSiz;var R=x.CapFacing*x.CapDepth*x.CapHorz;items.Cpct=x.BHoriz*x.BVert*x.BaseD+(isNaN(R)?0:R),items.Brand_Category=x.Brand_Category,items.ClassName=x.ClassName,items.Uda_item_status=x.Uda_item_status,items.Gobecobrand=x.Gobecobrand,items.Internet=x.Internet,items.Categ=x.Categ;x.SizeDesc.split("*");if(items.ItemSize=x.ItemSize,items.SplrLbl=x.SplrLbl,items.COO=x.COO,items.EDLP=x.EDLP,items.LoGrp=x.LoGrp,items.SqzPer=(void 0!==x.CrushHoriz?x.CrushHoriz:0)+":"+(void 0!==x.CrushVert?x.CrushVert:0)+":"+(void 0!==x.CrushD?x.CrushD:0),items.InternationalRng=x.InternationalRng,items.NewItem=x.NewItem,items.DaysOfSupply=x.DaysOfSupply,items.BrandType=x.BrandType,items.LiveNewItem=x.LiveNewItem,items.GoGreen=x.GoGreen,items.UnitperCase=x.UnitperCase,items.Orientation=x.Orientation,items.UnitperTray=x.UnitperTray,void 0!==x.Dept&&""!==x.Dept&&null!==x.Dept)var w=x.Dept.split("-");else w="";if(void 0!==x.Class&&""!==x.Class&&null!==x.Class)var H=x.Class.split("-");else H="";if(void 0!==x.SubClass&&""!==x.SubClass&&null!==x.SubClass)var B=x.SubClass.split("-");else B="";items.ClassName=w[0]+"/"+H[0]+"/"+B[0],items.UDA751=x.UDA751,items.UDA755=x.UDA755,items.Status=x.Status,items.StoreCnt=x.StoreCnt;var C=add_wireframe(items,2);items.WFrameID=C,items.ItemCondition=x.ItemCondition,items.AUR=x.AUR,items.ItemRanking=x.ItemRanking,items.WeeklySales=x.WeeklySales,items.WeeklyNetMargin=x.WeeklyNetMargin,items.WeeklyQty=x.WeeklyQty,items.NetMarginPercent=x.NetMarginPercent,items.CumulativeNM=x.CumulativeNM,items.TOP80B2=x.TOP80B2,items.ItemBrandC=x.ItemBrandC,items.ItemPOGDept=x.ItemPOGDept,items.ItemRemark=x.ItemRemark,items.RTVStatus=x.RTVStatus,items.Pusher=x.Pusher,items.Divider=x.Divider,items.BackSupport=x.BackSupport,items.CWPerc=x.CWPerc,items.CHPerc=x.CHPerc,items.CDPerc=x.CDPerc,items.OOSPerc=x.OOSPerc,items.InitialItemDesc=x.InitialItemDesc,items.InitialBrand=x.InitialBrand,items.InitialBarcode=x.InitialBarcode,i(items.id);var N=g_world.getObjectById(items.id);"E"==items.DimUpdate?(N.BorderColour=g_dim_error_color,N.WireframeObj.material.color.setHex(N.BorderColour)):"N"==items.Status?(N.BorderColour=g_status_error_color,N.Status="N",N.WireframeObj.material.color.setHex(N.BorderColour)):"No"==nvl(items.MovingItem)&&"Y"==g_pogcr_auto_hlite_non_mv_item?(N.BorderColour=g_nonMovingItemColor,N.WireframeObj.material.color.setHex(N.BorderColour)):items.OOSPerc>80&&"Y"==g_pogcr_enbl_oos_border?(N.BorderColour=g_pogcr_oos_border_color,N.WireframeObj.material.color.setHex(N.BorderColour)):N.BorderColour=0,logDebug("function : add_carpark_item","E")}))}catch(e){error_handling(e)}}function blink_effect(){for(var e=0;e<g_intersected.length;e++)if(0==g_intersected[e].blink_color||g_intersected[e].blink_color==g_dim_error_color||g_intersected[e].blink_color==g_status_error_color||g_intersected[e].blink_color==g_pogcr_oos_border_color&&"Y"==g_pogcr_enbl_oos_border)void 0!==g_intersected[e].ItemID?g_intersected[e].blink_color=g_select_item_color_change:g_intersected[e].blink_color=16777215;else for(e=0;e<g_intersected.length;e++)nvl(g_intersected[e].OOSPerc)>80&&"Y"==g_pogcr_enbl_oos_border&&(g_intersected[e].blink_color!=g_dim_error_color||g_intersected[e].blink_color!=g_status_error_color)?g_intersected[e].blink_color=g_pogcr_oos_border_color:g_intersected[e].blink_color=0;for(e=0;e<g_intersected.length;e++)void 0!==g_intersected[e]&&("Y"!=g_intersected[e].ImageExists||"Y"!=g_show_live_image&&"Y"!=g_show_live_image_comp||(g_intersected[e].WireframeObj.material.transparent=!1,g_intersected[e].WireframeObj.material.opacity=1),"E"!=g_intersected[e].DimUpdate&&"N"!=g_intersected[e].Status||0!=g_intersected[e].blink_color?g_intersected[e].WireframeObj.material.color.setHex(g_intersected[e].blink_color):g_intersected[e].WireframeObj.material.color.setHex(g_intersected[e].BorderColour));render_all_pog()}function set_multi_blink(e,t){if(logDebug("function : set_multi_blink","S"),void 0!==e&&e.length>0&&g_delete_details.length>0){if(g_intersected)for(var o=0;o<g_intersected.length;o++)g_select_color=g_intersected[o].BorderColour,g_intersected[o].WireframeObj.material.color.setHex(g_intersected[o].BorderColour),"Y"!=g_intersected[o].ImageExists||"Y"!=g_show_live_image&&"Y"!=g_show_live_image_comp||(g_intersected[o].WireframeObj.material.transparent=!0,g_intersected[o].WireframeObj.material.opacity=.0025);g_intersected=[],"undefined"!=typeof g_delete_details&&($.each(g_delete_details,(function(e,o){var i=g_scene_objects[t].scene.children[2].getObjectById(o.ObjID);g_intersected.push(i)})),render_animate_selected())}logDebug("function : set_multi_blink","E")}function render_animate_selected(){if("Y"==g_product_list_blink){var e=[];for(const t of g_intersected)0!=nvl(t.ItemID)&&e.push(t.ItemID);e=[...new Set(e)],$("#draggable_table .product_list_blink").removeClass("product_list_blink");let t=-1;if($("#draggable_table thead th").each((function(e){if("product"===$(this).text().trim().toLowerCase())return t=e,!1})),-1!==t)for(const o of e)$('#draggable_table [data-id="'+o+'"] td').eq(t).addClass("product_list_blink")}clearInterval(g_myVar),g_myVar=setInterval((function(){blink_effect()}),500)}function showItemSubLabel(e,t,o,i,n){try{var r,a=g_pog_json[n].ModuleInfo,l={};"undefined"==typeof g_undoRedoAction&&(g_undoRedoAction="REDO"),r="REDO"==g_undoRedoAction?"U":"R";var s=0;if("Y"==t)for(const r of a){if(void 0===r.ParentModule||null==r.ParentModule){var _=r.ShelfInfo,g=0;for(const r of _){if("BASE"!==r.ObjType&&"NOTCH"!==r.ObjType&&"DIVIDER"!==r.ObjType&&"TEXTBOX"!==r.ObjType&&r.ItemInfo.length>0){var d=r.ItemInfo,c=0;for(const a of d){if("DIVIDER"!==a.Item){if(void 0!==(y=g_scene_objects[n].scene.children[2].getObjectById(a.ObjID))){if(void 0!==a.SubLblObjID&&-1!==a.SubLblObjID){var f=y.getObjectById(a.SubLblObjID);y.remove(f)}var p,u,b,m,h=o;null==hexToRgb(h)?(u=parseInt("FF",16),b=parseInt("FF",16),m=parseInt("FF",16)):(u=hexToRgb(h).r,b=hexToRgb(h).r,m=hexToRgb(h).g),p=getTextColor(u,b,m);var I="",v=get_sales_info(n,a.ItemID);if("LPR"==e)I=0!==nvl(a.ItemID)?a.ItemID:"";else if("LQT"==e)I=0!==nvl(a.SalesUnit)?a.SalesUnit:"";else if("LSL"==e){var D=parseFloat(a.AvgSales).toFixed(2);I=0!==nvl(a.AvgSales)?D:""}else if("LST"==e)I=0!==nvl(a.StoreSOH)?a.StoreSOH:"";else if("LDP"==e)I=0!==nvl(a.ActualDPP)?a.ActualDPP:"";else if("LSC"==e)I=0!==nvl(a.StoreCnt)?a.StoreCnt:"";else if("LNP"==e)0!==nvl(a.NewItem)&&"N"!==a.NewItem&&"Y"!==a.LiveNewItem?I=a.NewItem:"N"!==a.LiveNewItem&&"Y"==g_pogcr_live_new_item&&(I=0!==nvl(a.LiveNewItem)&&"Y"==a.LiveNewItem?"New":"");else if("COS"==e){var j=a.SizeDesc.split("*"),S=a.CapFacing*a.CapDepth*a.CapHorz*parseInt(1==a.CapMerch?a.UnitperTray:1);l=(a.BHoriz*a.BVert*a.BaseD*parseInt(1==a.MerchStyle?a.UnitperTray:2==a.MerchStyle?a.UnitperCase:1)+S)/parseInt(j[1]),I=isNaN(l)||!isFinite(l)?"":l.toFixed(1)}else"DOS"==e?(l=a.BHoriz*a.BVert*a.BaseD*parseInt(1==a.MerchStyle?a.UnitperTray:2==a.MerchStyle?a.UnitperCase:1)/(v.SalesUnitPerWeek/7),I=isNaN(l)||!isFinite(l)?"":l.toFixed(1)):"SU"==e?I=0!==nvl(v.SalesUnitPerWeek)?v.SalesUnitPerWeek:"":"SV"==e?I=0!==nvl(v.SalesPerWeek)?v.SalesPerWeek:"":"VRMPer"==e?I=0!==nvl(v.VRMPer)?v.VRMPer:"":"EDLP"==e&&(I=0!==nvl(a.EDLP)?a.EDLP:"");if(console.log("text",nvl(a.LiveNewItem),a.LiveNewItem),""!==I){var O=addlabelText(I,g_labelFont,g_labelActualSize,p,"center",h);y.add(O),O.position.x=0,O.position.y="CENTER"!=i&&"BOTTOM"!=i||"Y"!=t?0-a.H/2+.0015625*g_labelFont:a.H/2+.0015625*g_labelFont,0!==r.Rotation||0!==r.Slope?O.position.z=a.D/2+.0055:O.position.z=.0015,g_pog_json[n].ModuleInfo[s].ShelfInfo[g].ItemInfo[c].SubLblObjID=O.id}}}else if("DIVIDER"!==a.Item){if(void 0!==a.SubLblObjID&&-1!==a.SubLblObjID)if(void 0!==(y=g_scene_objects[n].scene.children[2].getObjectById(a.ObjID))){f=y.getObjectById(a.SubLblObjID);y.remove(f)}}c+=1}}g+=1}}s+=1}else{s=0;for(const e of a){if(void 0===e.ParentModule||null==e.ParentModule){_=e.ShelfInfo,g=0;for(const e of _){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&e.ItemInfo.length>0){d=e.ItemInfo,c=0;for(const e of d){var y;if("DIVIDER"!==e.Item&&""!==e.LocID&&void 0!==e.LocID)if(void 0!==(y=g_scene_objects[n].scene.children[2].getObjectById(e.ObjID))){if(void 0!==e.SubLblObjID&&-1!==e.SubLblObjID){f=y.getObjectById(e.SubLblObjID);y.remove(f)}g_pog_json[n].ModuleInfo[s].ShelfInfo[g].ItemInfo[c].SubLblObjID=-1}c+=1}}g+=1}}s+=1}}const T=g_itemSubLabelInd,E=g_itemSubLabel;l.item_sale_label_ind=T,l.item_sale_label_type=E,g_undo_details=[],g_undo_details.push(l),"U"==r?(g_delete_details.multi_delete_shelf_ind="N",g_undo_all_obj_arr=[],g_undo_all_obj_arr.push(g_undo_details),g_undo_all_obj_arr.push(g_cut_copy_arr),g_undo_all_obj_arr.previousAction="ITEM_SALE_LABEL",g_cut_support_obj_arr.length>0?g_undo_all_obj_arr.hasSupportArr="Y":g_undo_all_obj_arr.hasSupportArr="N",g_undo_all_obj_arr.g_MultiObjects="N",g_undo_all_obj_arr.multi_delete_shelf_ind="N",g_undo_final_obj_arr.push(g_undo_all_obj_arr),"Y"!=g_delete_details.is_dragging&&(g_delete_details=[]),g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]):(g_delete_details.multi_delete_shelf_ind="N",g_redo_all_obj_arr=[],g_redo_all_obj_arr.push(g_undo_details),g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.previousAction="ITEM_SALE_LABEL",g_cut_support_obj_arr.length>0?g_redo_all_obj_arr.hasSupportArr="Y":g_redo_all_obj_arr.hasSupportArr="N",g_redo_all_obj_arr.g_MultiObjects="N",g_redo_all_obj_arr.multi_delete_shelf_ind="N",g_redo_final_obj_arr.push(g_redo_all_obj_arr),"Y"!=g_delete_details.is_dragging&&(g_delete_details=[]),g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]),g_itemSubLabelInd=t,g_itemSubLabel=e,animate_pog(n),render(n)}catch(e){error_handling(e)}}function add_merch_border(e,t,o,i,n,r,a,l){try{logDebug("function : add_merch_border; width : "+t+"; height : "+o+"; shelf_height : "+i+"; obj_type : "+n+"; rotation : "+r+"; slope : "+a,"S");var s=new THREE.BoxGeometry(t,o-.01,0),_=new THREE.EdgesGeometry(s),g=new THREE.LineBasicMaterial({color:16711680,linewidth:2}),d=new THREE.LineSegments(_,g);d.renderOrder=1,e.add(d),d.uuid="merch_border",e.merchid=d.id,d.position.x=0,0===r&&0===a||(d.rotateY(r*Math.PI/180),d.rotateX(a*Math.PI/180)),"HANGINGBAR"==n?(d.position.y=-(o/2+i/2),"Y"==l.Topmerch&&0==l.MaxMerch?l.Merch=0:"Y"!==l.Topmerch&&0!=l.MaxMerch?l.Merch=l.MaxMerch:l.Merch=wpdSetFixed(-(o/2+i/2))):(d.position.y=o/2+i/2+5e-4,"Y"==l.Topmerch&0==l.MaxMerch?l.Merch=0:"Y"!==l.Topmerch&&0!=l.MaxMerch?l.Merch=l.MaxMerch:l.Merch=wpdSetFixed(o/2+i/2+5e-4)),logDebug("function : add_merch_border","E")}catch(e){error_handling(e)}}