var l_selected_mod,l_pog_type="";function setUpMouseHander(e,t,_,o,s,n){try{if("string"==typeof e&&(e=document.getElementById(e)),!e||!e.addEventListener)throw"first argument in setUpMouseHander is not a valid element";var i,a;document.addEventListener("mousemove",(function(e){if(t){var _=document.getElementById("maincanvas"),o=g_pog_json;void 0!==g_scene_objects[n]?(new_camera=g_scene_objects[n].scene.children[0],new_world=g_scene_objects[n].scene.children[2]):(new_camera=g_camera,new_world=g_world);var s=_.getBoundingClientRect(),g=(s.height,e.clientX-s.left),r=e.clientY-s.top;t(g,r,e,i,a,_,o,"#maincanvas",n)}i=g,a=r})),s.domElement.addEventListener("mousedown",(function(e){if(!g_dragging&&1==window.event.which){g_taskItemInContext=clickInsideElement(e,"canvasregion"),g_taskItemInContext1=clickInsideElement(e,"canvasregion1"),g_taskItemInContext?g_canvas=document.getElementById("maincanvas"):g_canvas=document.getElementById("maincanvas1");var t=g_canvas.getBoundingClientRect(),o=t.left,s=t.top,g=e.clientX-t.left,r=e.clientY-t.top;i=g,a=r,g_dragging=_(g,r,o,s,e,g_canvas,"N",n)}})),s.domElement.addEventListener("mouseup",(function(e){if(g_dragging){g_taskItemInContext=clickInsideElement(e,"canvasregion"),g_taskItemInContext1=clickInsideElement(e,"canvasregion1");var t=[];if(g_taskItemInContext?(g_canvas=document.getElementById("maincanvas"),t=g_pog_json,void 0!==g_scene_objects[n]?(g_scene_objects[n].scene.children[0],g_scene_objects[n].scene.children[2]):(g_camera,g_world)):(g_canvas=document.getElementById("maincanvas1"),t=g_pog_json_comp,g_camera_comp,g_world_comp),o){var _=g_canvas.getBoundingClientRect(),s=e.clientX-_.left,g=e.clientY-_.top;o(s,g,e,i,a,g_canvas,t,n)}g_dragging=!1}}))}catch(e){error_handling(e)}}function init(){try{g_canvas_region=document.getElementById("drawing_region"),g_selection=document.getElementById("selection"),g_renderer=new THREE.WebGLRenderer({canvas:g_canvas,antialias:!0}),g_canvas_objects.push(g_canvas)}catch(e){return void(document.getElementById("canvas-holder").innerHTML="<p><b>Sorry, an error occurred:<br>"+e+"</b></p>")}createWorld(),g_raycaster=new THREE.Raycaster,render(),g_multiselect="N",g_ctrl_select="N";var e=window.devicePixelRatio;g_start_pixel_ratio=e;var t=document.getElementById("ig_mod_details");if(t)var _=t.offsetWidth;else _=0;windowWidth=window.innerWidth-_,setUpMouseHander("maincanvas",doMouseMove,doMouseDown,doMouseUp,g_renderer,g_pog_index),g_tanFOV=Math.tan(Math.PI/180*g_camera.fov/2),g_windowHeight=window.innerHeight,g_initial_windowHeight=window.innerHeight,g_camera.aspect=windowWidth/g_windowHeight,g_camera.fov=360/Math.PI*Math.atan(g_tanFOV*(g_windowHeight/g_initial_windowHeight)),g_camera.updateProjectionMatrix(),render(),window.addEventListener("resize",onWindowResize,!1),onWindowResize("F")}function onWindowResize(e){try{var t=document.getElementById("ig_mod_details");if(t)var _=t.offsetWidth;else _=0;windowWidth=window.innerWidth-_,g_windowHeight=window.innerHeight,g_camera.aspect=windowWidth/g_windowHeight,g_camera.fov=360/Math.PI*Math.atan(g_tanFOV*(g_windowHeight/g_initial_windowHeight));window.devicePixelRatio;g_renderer.setSize(windowWidth,g_windowHeight),g_camera.updateProjectionMatrix(),g_renderer.render(g_scene,g_camera)}catch(e){error_handling(e)}}async function create_module_from_json(e,t,_,o,s,n,i,a,g,r,l,c){try{if(load_orientation_json(),$("#LIVE_IMAGE").addClass("apex_disabled"),"Y"==$v("P174_POGCR_DFT_NOTCH_LABEL")&&(g_show_notch_label="Y"),"Y"==$v("P174_POGCR_DFT_FIXEL_LABEL")&&(g_show_fixel_label="Y"),"Y"==$v("P174_POGCR_SHOW_DFLT_ITEM_LOC")&&(g_show_item_label="Y"),await create_module_from_json_lib(e,t,_,o,s,a,g,$v("P174_VDATE"),$v("P174_POG_DEFAULT_COLOR"),$v("P174_MODULE_DEFAULT_COLOR"),null,!1,r,l,$v("P174_POGCR_DFT_SPREAD_PRODUCT"),parseFloat($v("P174_PEGBOARD_DFT_HORZ_SPC")),parseFloat($v("P174_PEGBOARD_DFT_VERT_SPC")),parseFloat($v("P174_BASKET_WALL_THICK")),parseFloat($v("P174_CHEST_WALL_THICK")),$v("P174_POGCR_PEG_ITEM_AUTO_PLACE"),$v("P174_POGCR_DEFAULT_WRAP_TEXT"),parseInt($v("P174_POGCR_TEXT_DEFAULT_SIZE")),$v("P174_POG_TEXTBOX_DEFAULT_COLOR"),$v("P174_SHELF_DEFAULT_COLOR"),$v("P174_DIV_COLOR"),$v("P174_SLOT_DIVIDER"),$v("P174_SLOT_ORIENTATION"),$v("P174_DIVIDER_FIXED"),$v("P174_ITEM_DFT_COLOR"),$v("P174_POGCR_DELIST_ITEM_DFT_COLOR"),"Y",null,1,$v("P174_MERCH_STYLE"),$v("P174_POGCR_LOAD_IMG_FROM"),$v("P174_BU_ID"),$v("P174_POGCR_DELIST_ITEM_DFT_COLOR"),$v("P174_POGCR_ITEM_NUM_LBL_COLOR"),$v("P174_POGCR_DISPLAY_ITEM_INFO"),$v("P174_POGCR_ITEM_NUM_LBL_COLOR"),$v("P174_POGCR_ITEM_NUM_LABEL_POS"),$v("P174_NOTCH_HEAD"),"N",$v("P174_POGCR_DFT_BASKET_FILL"),$v("P174_POGCR_DFT_BASKET_SPREAD"),g_scene_objects[0].scene.children[0],c,l,$v("P174_POGCR_NOTCH_START_VALUE"),"N","Y","N"),("Y"==$v("P174_POGCR_DFT_ITEM_DESC")||0==g_ItemImages.length&&"Y"==$v("P174_POGCR_DFLT_LIVE_IMAGES"))&&(await showHideItemDescription("Y",$v("P174_POGCR_ITEM_NUM_LBL_COLOR"),$v("P174_POGCR_DISPLAY_ITEM_INFO"),c),"Y"==$v("P174_POGCR_DFT_ITEM_DESC")&&(g_show_live_image="N"),g_show_item_desc="Y"),await get_all_images(c,"N","N",$v("P174_POGCR_IMG_MAX_WIDTH"),$v("P174_POGCR_IMG_MAX_HEIGHT"),$v("P174_IMAGE_COMPRESS_RATIO")),$("#LIVE_IMAGE").removeClass("apex_disabled"),g_ItemImages.length>0&&"N"==i&&"Y"==$v("P174_POGCR_DFLT_LIVE_IMAGES")&&"N"==$v("P174_POGCR_DFT_ITEM_DESC"))try{g_show_live_image="Y";await recreate_image_items("Y",$v("P174_MERCH_STYLE"),$v("P174_POGCR_LOAD_IMG_FROM"),$v("P174_BU_ID"),$v("P174_POGCR_ITEM_NUM_LBL_COLOR"),$v("P174_POGCR_ITEM_NUM_LABEL_POS"),$v("P174_POGCR_DISPLAY_ITEM_INFO"),$v("P174_POGCR_DELIST_ITEM_DFT_COL"),$v("P174_NOTCH_HEAD"),c,"N");animate_pog(c)}catch(e){error_handling()}console.log("P174_POGCR_DFT_NOTCH_LABEL",$v("P174_POGCR_DFT_NOTCH_LABEL"),$v("P174_POGCR_DFT_FIXEL_LABEL"),$v("P174_POGCR_SHOW_DFLT_ITEM_LOC"));var d=get_min_max_xy(c).split("###");set_camera_z(g_scene_objects[c].scene.children[0],parseFloat(d[2]),parseFloat(d[3]),parseFloat(d[0]),parseFloat(d[1]),g_offset_z,parseFloat(d[4]),parseFloat(d[5]),!0,c),render(),"undefined"!=typeof regionloadWait&&null!==regionloadWait&&"Y"==n&&removeLoadingIndicator(regionloadWait)}catch(e){error_handling(e)}return"SUCCESS"}function doMouseMove(e,t,_,o,s,n,a,g,r){try{var l=n.width/window.devicePixelRatio,c=n.height/window.devicePixelRatio,d=2*e/l-1,m=1-2*t/c,p=(parseFloat($("#ig_mod_details").css("padding-left").replace("px","")),devicePixelRatio,document.getElementById("ig_mod_details").offsetWidth+40),u=$(document).scrollTop(),I=$(".t-Region-body").scrollLeft();g_scene_objects[0].scene.children[0].updateProjectionMatrix(),g_raycaster.setFromCamera(new THREE.Vector2(d,m),g_scene_objects[0].scene.children[0]),void 0!==g_scene_objects[r]?g_intersects=g_raycaster.intersectObjects(g_scene_objects[r].scene.children[2].children):g_intersects=g_raycaster.intersectObjects(g_world.children);var f=$(document),O=$(window),D=$("#object_info"),h=D.offset(),E=h.top-f.scrollTop(),v=(O.height(),D.height(),h.left-f.scrollLeft());O.width(),D.width();g_mouse.x=_.clientX+I-p,g_mouse.y=_.clientY+u;var M=g_startMouse.x,b=g_mouse.x,P=g_startMouse.y,j=g_mouse.y;if(M>b){var x=M;M=b,b=x}if(P>j){var y=P;P=j,j=y}if(g_dragging){g_raycaster.setFromCamera(new THREE.Vector2(d,m),g_scene_objects[0].scene.children[0]),g_intersects=g_raycaster.intersectObject(g_targetForDragging);g_drag_z;var S=g_intersects[0].point.x,C=g_intersects[0].point.y,T=g_intersects[0].point.z,L=new THREE.Vector3(S,C,T);g_scene_objects[r].scene.children[2].worldToLocal(L),d=Math.min(19,Math.max(-19,L.x)),t=Math.min(19,Math.max(-19,L.y)),g_selecting&&(g_multiselect="Y",g_DragMouseEnd.x=d,g_DragMouseEnd.y=t,g_selection.style.left=M+"px",g_selection.style.top=P+"px",g_selection.style.width=b-M-5+"px",g_selection.style.height=j-P-5+"px",console.log("g_selection.style.left",g_selection.style.left,g_selection.style.top,g_selection.style.width)),g_DragMouseEnd.x=d,g_DragMouseEnd.y=t}else g_selecting&&(g_selecting=!1,g_selection.style.visibility="hidden");var R=document.getElementById("object_info");$("#object_info").contents().filter((function(){return 3==this.nodeType})).remove();var w="",N=0,G=[],A=" | ";if(g_intersects.length>0&&void 0!==g_intersects[0].object.ItemID&&""!==g_intersects[0].object.ItemID&&"DIVIDER"!==g_intersects[0].object.ItemID){var F=$v("P174_POGCR_ITEM_DESC_LIST").split(":");for(i=0;i<F.length;i++){var H=0;A=i>0?" | ":"";if("ITEM"==F[i]&&(w=w+A+get_message("ITEM_ID_LBL")+': <span style="color:yellow">'+g_intersects[0].object.ItemID+"</span>",H=(" | "+get_message("ITEM_ID_LBL")+": "+g_intersects[0].object.ItemID).visualLength("ruler")),"UPC"==F[i]&&(w=w+A+get_message("POGCR_REP_TEMP_HEAD_BARCODE")+': <span style="color:yellow">'+g_intersects[0].object.Barcode+"</span>",H=(" | "+get_message("POGCR_REP_TEMP_HEAD_BARCODE")+": "+g_intersects[0].object.Barcode).visualLength("ruler")),"DESC"==F[i]&&(w=w+A+get_message("DESCRIPTION_DETAIL")+': <span style="color:yellow">'+g_intersects[0].object.Description+"</span>",H=(" | "+get_message("DESCRIPTION_DETAIL")+": "+g_intersects[0].object.Description).visualLength("ruler")),"BRAND"==F[i]&&(w=w+A+get_message("POGCR_BRAND")+': <span style="color:yellow">'+g_intersects[0].object.Brand+"</span>",H=(" | "+get_message("POGCR_BRAND")+": "+g_intersects[0].object.Brand).visualLength("ruler")),"GROUP"==F[i]&&(w=w+A+get_message("POGCR_GROUP_LBL")+': <span style="color:yellow">'+g_intersects[0].object.Group+"</span>",H=(" | "+get_message("POGCR_GROUP_LBL")+": "+g_intersects[0].object.Group).visualLength("ruler")),"DEPT"==F[i]&&(w=w+A+get_message("POGCR_TEMP_HEAD_DEPARTMENT")+': <span style="color:yellow">'+g_intersects[0].object.Dept+"</span>",H=(" | "+get_message("POGCR_TEMP_HEAD_DEPARTMENT")+": "+g_intersects[0].object.Dept).visualLength("ruler")),"CLASS"==F[i]&&(w=w+A+get_message("POGCR_CLASS_LBL")+': <span style="color:yellow">'+g_intersects[0].object.Class+"</span>",H=(" | "+get_message("POGCR_CLASS_LBL")+": "+g_intersects[0].object.Class).visualLength("ruler")),"SUBCLASS"==F[i]&&(w=w+A+get_message("POGCR_SUBCLASS_LBL")+': <span style="color:yellow">'+g_intersects[0].object.SubClass+"</span>",H=(" | "+get_message("POGCR_SUBCLASS_LBL")+": "+g_intersects[0].object.SubClass).visualLength("ruler")),"ITEM_SIZE"==F[i]&&(w=w+A+get_message("POGCR_ITEMSIZE_LBL")+': <span style="color:yellow">'+g_intersects[0].object.SizeDesc+"</span>",H=(" | "+get_message("POGCR_ITEMSIZE_LBL")+": "+g_intersects[0].object.SizeDesc).visualLength("ruler")),"SUPPLIER"==F[i]&&(w=w+A+get_message("POGCR_REP_HEAD_SUPPLIERS")+': <span style="color:yellow">'+g_intersects[0].object.Supplier+"</span>",H=(" | "+get_message("POGCR_REP_HEAD_SUPPLIERS")+": "+g_intersects[0].object.Supplier).visualLength("ruler")),"WIDTH"==F[i]&&(w=w+A+get_message("POGCR_WIDTH_LBL")+': <span style="color:yellow">'+(100*g_intersects[0].object.OW).toFixed(2)+"</span>",H=(" | "+get_message("POGCR_WIDTH_LBL")+": "+(100*g_intersects[0].object.OW).toFixed(2)).visualLength("ruler")),"HEIGHT"==F[i]&&(w=w+A+get_message("POGCR_HEIGHT_LBL")+': <span style="color:yellow">'+(100*g_intersects[0].object.OH).toFixed(2)+"</span>",H=(" | "+get_message("POGCR_HEIGHT_LBL")+": "+(100*g_intersects[0].object.OH).toFixed(2)).visualLength("ruler")),"DEPTH"==F[i]&&(w=w+A+get_message("POGCR_DEPTH_LBL")+': <span style="color:yellow">'+(100*g_intersects[0].object.OD).toFixed(2)+"</span>",H=(" | "+get_message("POGCR_DEPTH_LBL")+": "+(100*g_intersects[0].object.OD).toFixed(2)).visualLength("ruler")),"STORE"==F[i]&&(w=w+A+get_message("POGCR_STORE_LBL")+': <span style="color:yellow">'+g_intersects[0].object.StoreCnt+"</span>",H=(" | "+get_message("POGCR_STORE_LBL")+": "+g_intersects[0].object.StoreCnt).visualLength("ruler")),"ITEM_DIM"==F[i]&&(w=w+A+get_message("POGCR_ITEM_DIM_LBL")+': <span style="color:yellow">'+g_intersects[0].object.ItemDim+"</span>",H=(" | "+get_message("POGCR_ITEM_DIM_LBL")+": "+g_intersects[0].object.ItemDim).visualLength("ruler")),"POSITION"==F[i]&&(w=w+A+get_message("POGCR_POSITION_LBL")+': <span style="color:yellow">'+g_intersects[0].object.LocID+"</span>",H=(" | "+get_message("POGCR_POSITION_LBL")+": "+g_intersects[0].object.LocID).visualLength("ruler")),"SHELF"==F[i]&&(w=w+A+get_message("POGCR_SHELF_LBL")+': <span style="color:yellow">'+g_intersects[0].object.Shelf+"</span>",H=(" | "+get_message("POGCR_SHELF_LBL")+": "+g_intersects[0].object.Shelf).visualLength("ruler")),"ORIENTATION"==F[i]&&(w=w+A+get_message("POGCR_ORIENTATION_LBL")+': <span style="color:yellow">'+g_intersects[0].object.OrientationDesc+"</span>",H=(" | "+get_message("POGCR_ORIENTATION_LBL")+": "+g_intersects[0].object.OrientationDesc).visualLength("ruler")),"DEPTH_FACING"==F[i]&&(w=w+A+get_message("POGCR_DEPTH_FACING_LBL")+': <span style="color:yellow">'+g_intersects[0].object.DFacing+"</span>",H=(" | "+get_message("POGCR_DEPTH_FACING_LBL")+": "+g_intersects[0].object.DFacing).visualLength("ruler")),"HORIZ_FACING"==F[i]&&(w=w+A+get_message("TEMP_HEAD_HORIZ_FACING")+': <span style="color:yellow">'+g_intersects[0].object.HorizFacing+"</span>",H=(" | "+get_message("TEMP_HEAD_HORIZ_FACING")+": "+g_intersects[0].object.HorizFacing).visualLength("ruler")),"VERT_FACING"==F[i]&&(w=w+A+get_message("TEMP_HEAD_VERT_FACING")+': <span style="color:yellow">'+g_intersects[0].object.VertFacing+"</span>",H=(" | "+get_message("TEMP_HEAD_VERT_FACING")+": "+g_intersects[0].object.VertFacing).visualLength("ruler")),"SELLING_PRICE"==F[i]&&(w=w+A+get_message("SELLING_PRICE_LBL")+': <span style="color:yellow">'+parseFloat(g_intersects[0].object.SellingPrice).toFixed(2)+"</span>",H=(" | "+get_message("SELLING_PRICE_LBL")+": "+g_intersects[0].object.SellingPrice).visualLength("ruler")),"SALES_UNIT"==F[i]&&(w=w+A+get_message("SALES_UNIT_LBL")+': <span style="color:yellow">'+parseFloat(g_intersects[0].object.SalesUnit).toFixed(2)+"</span>",H=(" | "+get_message("SALES_UNIT_LBL")+": "+g_intersects[0].object.SalesUnit).visualLength("ruler")),"NET_SALES"==F[i]&&(w=w+A+get_message("NET_SALES_LBL")+': <span style="color:yellow">'+parseFloat(g_intersects[0].object.NetSales).toFixed(2)+"</span>",H=(" | "+get_message("NET_SALES_LBL")+": "+g_intersects[0].object.NetSales).visualLength("ruler")),"PROFIT"==F[i]&&(w=w+A+get_message("PROFIT_LBL")+': <span style="color:yellow">'+parseFloat(g_intersects[0].object.Profit).toFixed(2)+"</span>",H=(" | "+get_message("PROFIT_LBL")+": "+g_intersects[0].object.Profit).visualLength("ruler")),"TOTAL_MARGIN"==F[i]&&(w=w+A+get_message("POGCR_TOTAL_MARGIN")+': <span style="color:yellow">'+parseFloat(g_intersects[0].object.TotalMargin).toFixed(2)+"</span>",H=(" | "+get_message("POGCR_TOTAL_MARGIN")+": "+g_intersects[0].object.TotalMargin).visualLength("ruler")),"COGS_ADJ"==F[i]&&(w=w+A+get_message("COGS_ADJ")+': <span style="color:yellow">'+parseFloat(nvl(g_intersects[0].object.CogsAdj)).toFixed(2)+"</span>",H=(" | "+get_message("COGS_ADJ")+": "+nvl(g_intersects[0].object.CogsAdj)).visualLength("ruler")),"GP"==F[i]&&(w=w+A+get_message("GROSS_PROFIT")+': <span style="color:yellow">'+parseFloat(nvl(g_intersects[0].object.GrossProfit)).toFixed(2)+"</span>",H=(" | "+get_message("GROSS_PROFIT")+": "+nvl(g_intersects[0].object.GrossProfit)).visualLength("ruler")),"WK_COUNT"==F[i]&&(w=w+A+get_message("WEEKS_COUNT")+': <span style="color:yellow">'+parseFloat(nvl(g_intersects[0].object.WeeksCount)).toFixed(2)+"</span>",H=(" | "+get_message("WEEKS_COUNT")+": "+nvl(g_intersects[0].object.WeeksCount)).visualLength("ruler")),"REG_MOV"==F[i]&&(w=w+A+get_message("REG_MOV")+': <span style="color:yellow">'+parseFloat(nvl(g_intersects[0].object.RegMovement)).toFixed(2)+"</span>",H=(" | "+get_message("REG_MOV")+": "+nvl(g_intersects[0].object.RegMovement)).visualLength("ruler")),"AVG_SALES"==F[i]&&(w=w+A+get_message("AVG_SALES")+': <span style="color:yellow">'+parseFloat(nvl(g_intersects[0].object.AvgSales)).toFixed(2)+"</span>",H=(" | "+get_message("AVG_SALES")+": "+nvl(g_intersects[0].object.AvgSales)).visualLength("ruler")),"DESC_SECOND"==F[i]&&(w=w+A+get_message("DESC_SECOND_LBL")+': <span style="color:yellow">'+g_intersects[0].object.DescSecond+"</span>",H=(" | "+get_message("DESC_SECOND_LBL")+": "+g_intersects[0].object.DescSecond).visualLength("ruler")),"ITEM_STATUS"==F[i]&&(w=w+A+get_message("ITEM_STATUS")+': <span style="color:yellow">'+g_intersects[0].object.ItemStatus+"</span>",H=(" | "+get_message("ITEM_STATUS")+": "+Y).visualLength("ruler")),"TOTAL_UNIT"==F[i]){var Y=g_intersects[0].object.HorizFacing*g_intersects[0].object.VertFacing*g_intersects[0].object.DFacing;w=w+A+get_message("TOTAL_UNIT")+': <span style="color:yellow">'+Y+"</span>",H=(" | "+get_message("TOTAL_UNIT")+": "+Y).visualLength("ruler")}(N+=H)>1300&&(w+="<br>",G.push(N),N=0)}}else if(g_intersects.length>0&&void 0!==g_intersects[0].object.FixelID&&""!==g_intersects[0].object.FixelID&&void 0!==a[r]){var B=void 0!==a[r].Version&&null!==a[r].Version?a[r].Version:"";if("Y"==sessionStorage.getItem("new_pog_ind"))var W=A+get_message("POGCR_DRAFT_VERSION")+': <span style="color:yellow">'+sessionStorage.getItem("P174_EXISTING_DRAFT_VER")+" </span> ",V="";else W="",V=A+get_message("POGCR_POG_VERSION")+': <span style="color:yellow">'+B+" </span> ";w=void 0!==g_intersects[0].object.AvlSpace?w+get_message("POGCR_POG_CODE")+': <span style="color:yellow">'+a[r].POGCode+" </span> "+V+W+A+get_message("POGCR_POG_MOD")+': <span style="color:yellow">'+g_intersects[r].object.Module+" </span> "+A+get_message("POGCR_FIXEL_ID")+': <span style="color:yellow">'+g_intersects[r].object.FixelID+" </span> "+A+get_message("POGC_FIXEL_SPACE")+': <span style="color:yellow">'+g_intersects[0].object.AvlSpace+"</span>":w+get_message("POGCR_POG_CODE")+': <span style="color:yellow">'+a[r].POGCode+" </span> "+V+W+A+get_message("POGCR_POG_MOD")+': <span style="color:yellow">'+g_intersects[r].object.Module+" </span> "+A+get_message("POGCR_FIXEL_ID")+': <span style="color:yellow">'+g_intersects[r].object.FixelID+" </span> "+A+"</span>",R.classList.add("active")}else if(g_intersects.length>0&&void 0!==g_intersects[0].object.Module&&""!==g_intersects[0].object.Module&&void 0!==a[r]){B=void 0!==a[r].Version&&null!==a[r].Version?a[r].Version:"";if("Y"==sessionStorage.getItem("new_pog_ind"))W=A+get_message("POGCR_DRAFT_VERSION")+': <span style="color:yellow">'+sessionStorage.getItem("P174_EXISTING_DRAFT_VER")+" </span> ",V="";else W="",V=A+get_message("POGCR_POG_VERSION")+': <span style="color:yellow">'+B+" </span> ";w=w+get_message("POGCR_POG_CODE")+': <span style="color:yellow">'+a[r].POGCode+" </span> "+V+W+A+get_message("POGCR_POG_MOD")+': <span style="color:yellow">'+g_intersects[0].object.Module+"</span>",R.classList.add("active")}else if(void 0!==a&&a.length>0&&void 0!==a[r]){B=void 0!==a[r].Version&&null!==a[r].Version?a[r].Version:"";if("Y"==sessionStorage.getItem("new_pog_ind"))W=A+get_message("POGCR_DRAFT_VERSION")+': <span style="color:yellow">'+sessionStorage.getItem("P174_EXISTING_DRAFT_VER")+" </span> ",V="";else W="",V=A+get_message("POGCR_POG_VERSION")+': <span style="color:yellow">'+B+" </span> ";w=w+get_message("POGCR_POG_CODE")+': <span style="color:yellow">'+a[r].POGCode+" </span> "+V+W,R.classList.add("active")}else R.classList.remove("active");if(g_intersects.length>0)if(void 0!==g_intersects[0].object.ItemID&&""!==g_intersects[0].object.ItemID&&"DIVIDER"!==g_intersects[0].object.ItemID){c=36;var z=F.length>7?150:50;if(G.length>0)l=Math.max.apply(Math,G)+z;else l=w.visualLength("ruler")+z}else c=31,l=w.visualLength("ruler")+50;else c=31,l=w.visualLength("ruler")+50;$("#object_info").html(w),R.style.top=window.innerHeight-D.height()+"px",R.style.width=l+"px",R.style.height=c+5+"px",R.style.fontSize="large",R.style.fontFamily="Tahoma",R.style.left="0px"}catch(e){error_handling(e)}}function get_textbox_z(e,t,_,o,s,n,i,a){try{var g=_-s/2,r=_+s/2,l=o+n/2,c=o-n/2,d=i[a].ModuleInfo,m="N",p=0;for(const e of d){if("Y"==m)break;if(void 0===e.ParentModule||null==e.ParentModule){var u=e.ShelfInfo;for(const e of u){if("Y"==m)break;if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType)if(e.ItemInfo.length>0){var I=e.ItemInfo;for(const t of I){var f=t.X-t.W/2,O=t.X+t.W/2,D=t.Y+t.H/2,h=t.Y-t.H/2;if(g>=f&&g<O&&(l>h&&l<=D||c>=h&&c<D)||r>f&&r<=O&&(l>h&&l<=D||c>=h&&c<D)||g<f&&r>O&&(l>h&&l<=D||c>=h&&c<D)){m="Y",p=i[a].BackDepth/2+e.D+.005;break}if(g>=f&&g&&l>D&&c<h||r>f&&r<=O&&l>D&&c<h){m="Y",p=i[a].BackDepth/2+e.D+.005;break}1}}else{f=e.X-e.W/2,O=e.X+e.W/2,D=e.Y+e.H/2,h=e.Y-e.H/2;if(g>=f&&g<O&&(l>h&&l<=D||c>=h&&c<D)||r>f&&r<=O&&(l>h&&l<=D||c>=h&&c<D)||g<f&&r>O&&(l>h&&l<=D||c>=h&&c<D)){m="Y",p=i[a].BackDepth/2+e.D+.005;break}if(g>=f&&g&&l>D&&c<h||r>f&&r<=O&&l>D&&c<h){m="Y",p=i[a].BackDepth/2+e.D+.005;break}}1}}1}return"N"==m&&i[a].ModuleInfo[e].ShelfInfo[t].Y-i[a].ModuleInfo[e].ShelfInfo[t].H/2<=0?p=i[a].BackDepth/2+.005+i[a].BaseD:"N"==m&&(p=i[a].BackDepth/2+.005),parseFloat(p.toFixed(3))}catch(e){error_handling(e)}}async function set_scene(e,t,_,o,s,n,i,a,g,r,l,c,d,m,p,u,I="N",f="",O,D,h,E){logDebug("function : set_scene; template_id : "+e+"; save_pdf : "+t+"; notch_label : "+_+"; fixel_label : "+o+"; item_label : "+s+"; pdf_lang : "+n+"; save_pog : "+i+"; mime_type : "+a+"; new_item_label : "+g,"S");var v=.5;"Y"==$v("P174_POGCR_ENHANCE_PDF_IMG")&&(v=parseFloat($v("P174_POGCR_PDF_IMG_ENHANCE_RATIO")));var M=$v("P174_POGCR_PDF_CANVAS_SIZE").split(":"),b=g_canvas,P=[];render();var j=JSON.parse(JSON.stringify(g_pog_json)),x="",y=-1,S=0,C=0;for(const e of j[p].ModuleInfo)if(void 0===e.ParentModule||null==e.ParentModule){x=e.Module,S=e.W,C=e.H,y=0;break}console.log(" before base64 ",getDateTime());if("Y"==(w=O.split("###"))[0]){if("Y"==w[1]){if("N"==m)await recreate_image_items("N",$v("P174_MERCH_STYLE"),$v("P174_POGCR_LOAD_IMG_FROM"),$v("P174_BU_ID"),$v("P174_POGCR_ITEM_NUM_LBL_COLOR"),$v("P174_POGCR_ITEM_NUM_LABEL_POS"),$v("P174_POGCR_DISPLAY_ITEM_INFO"),$v("P174_POGCR_DELIST_ITEM_DFT_COL"),$v("P174_NOTCH_HEAD"),p,"N");bay=(100*S).toFixed(2),(L={Module:"COMBINE"}).Bay=bay,bay="";var T=await b.toDataURL("image/jpeg",.9);L.ImgData=T.match(/,(.*)$/)[1],P.push(L)}if("N"!=typeof w[2]){var L;await showHideItemDescription("Y",$v("P414_ITEM_DFT_COLOR"),$v("P414_POGCR_DISPLAY_ITEM_INFO"),p),bay=(100*S).toFixed(2),(L={Module:"COMBINE"}).Bay=bay,L.TotalBay=(100*C).toFixed(2)+"*"+bay,bay="";T=await b.toDataURL("image/jpeg",.9);L.ImgData=T.match(/,(.*)$/)[1],P.push(L)}}var R=JSON.parse(JSON.stringify(g_pog_json));await get_chest_split_details(g_pogcr_pdf_chest_split,p);var w,N=j[p].ModuleInfo[y],G=(w=get_min_max_xy_module(N,y,N.W,N.H,0,j[p].W,y)).split("###");console.log("details_arr",G),g_scene_objects[0].scene.children[0].position.z=0;var[A,F]=set_camera_z_offside(g_scene_objects[p].scene.children[0],parseFloat(G[2]),parseFloat(G[3]),parseFloat(G[0]),parseFloat(G[1]),g_offset_z,0,parseFloat(G[5]),!0,p);console.log("cameraz, new_y",A,F),g_scene_objects[0].scene.children[0].position.y=F-.09,g_scene_objects[0].scene.children[0].position.z=A,g_scene_objects[0].scene.children[0].position.x=parseFloat(G[2]),console.log(" before base64 ",getDateTime());T=await b.toDataURL("image/jpeg",.5);console.log(" after  base64 ",getDateTime()),(H={Module:"POG"}).ImgData=T.match(/,(.*)$/)[1],P.push(H);var H;b=await get_full_canvas_module(parseInt(M[0]),parseInt(M[1]),p,3+(.5==v?0:3*v)),T=await b.toDataURL("image/jpeg",.5);(H={}).Module=x,H.ImgData=T.match(/,(.*)$/)[1],P.push(H),console.log("mod_arr",P);await send_to_db(j[p].POGCode,P);console.log("finished sending"),logDebug("function : Download PDF","S"),apex.server.process("DOWNLOAD_PDF",{x01:e.SeqNo,x02:e.POGCode,x03:e.POGVersion,x04:e.Selection_Type,x05:e.Print_Type,x06:e.TemplateId,x07:e.SequenceId,x08:"",x09:e.POGModule,p_clob_01:JSON.stringify(j)},{dataType:"html"}).done((function(e){g_pog_json=R,g_show_fixel_label="Y"==o?"Y":"N",g_show_item_label="Y"==s?"Y":"N",g_show_notch_label="Y"==_?"Y":"N",g_show_item_desc="Y"==c?"Y":"N",console.log("old_live_iamge",d,m);var t="f?p="+$v("pFlowId")+":"+$v("pFlowStepId")+":"+$v("pInstance")+":APPLICATION_PROCESS=OPEN_PDF:NO::AI_RANDOM_STRING:"+(new Date).getTime();removeLoadingIndicator(regionloadWait),logDebug("function : Download PDF","E"),window.open(t,"new data"),async function(){if(console.log("item_desc",c,r,d,m),"N"==c&&"Y"==r)showHideItemDescription("N",$v("P414_ITEM_DFT_COLOR"),$v("P414_POGCR_DISPLAY_ITEM_INFO"),p);else if("Y"==c&&"N"==r)showHideItemDescription("Y",$v("P414_ITEM_DFT_COLOR"),$v("P414_POGCR_DISPLAY_ITEM_INFO"),p);if("N"==d&&"Y"==m)await recreate_image_items("N",$v("P174_MERCH_STYLE"),$v("P174_POGCR_LOAD_IMG_FROM"),$v("P174_BU_ID"),$v("P174_POGCR_ITEM_NUM_LBL_COLOR"),$v("P174_POGCR_ITEM_NUM_LABEL_POS"),$v("P174_POGCR_DISPLAY_ITEM_INFO"),$v("P174_POGCR_DELIST_ITEM_DFT_COL"),$v("P174_NOTCH_HEAD"),p,"N");else if("Y"==d&&"N"==m&&"N"==c)await recreate_image_items("Y",$v("P174_MERCH_STYLE"),$v("P174_POGCR_LOAD_IMG_FROM"),$v("P174_BU_ID"),$v("P174_POGCR_ITEM_NUM_LBL_COLOR"),$v("P174_POGCR_ITEM_NUM_LABEL_POS"),$v("P174_POGCR_DISPLAY_ITEM_INFO"),$v("P174_POGCR_DELIST_ITEM_DFT_COL"),$v("P174_NOTCH_HEAD"),p,"N");show_notch_labels(g_show_notch_label,$v("P174_NOTCH_HEAD"),"Y",p),show_fixel_labels(g_show_fixel_label,p),show_item_labels(g_show_item_label,$v("P174_POGCR_ITEM_NUM_LBL_COLOR"),$v("P174_POGCR_ITEM_NUM_LABEL_POS"),p),reset_zoom(p)}(),"undefined"!=typeof g_renderer_pdf&&null!==g_renderer_pdf&&""!==g_renderer_pdf&&(g_renderer_pdf.forceContextLoss(),g_renderer_pdf.context=null,g_renderer_pdf.domElement=null,g_renderer_pdf=null)})),logDebug("function : set_scene","E")}async function doMouseUp(e,t,_,o,s,n,i,a){logDebug("function : doMouseUp; x : "+e+"; y : "+t+"; prevX : "+o+"; prevY : "+s,"S");try{var g=n.width/window.devicePixelRatio,r=n.height/window.devicePixelRatio,l=2*e/g-1,c=1-2*t/r;if(g_raycaster.setFromCamera(new THREE.Vector2(l,c),g_scene_objects[0].scene.children[0]),g_intersects=g_raycaster.intersectObject(g_targetForDragging),0==g_intersects.length)return;var d=g_intersects[0].point.x,m=g_intersects[0].point.y,p=g_intersects[0].point.z,u=new THREE.Vector3(d,m,p);g_scene_objects[a].scene.children[2].worldToLocal(u);Math.min(19,Math.max(-19,u.x)),Math.min(19,Math.max(-19,u.y)),g_drag_z;if("Y"==g_shelf_edit_flag&&("PEGBOARD"==g_shelf_object_type?g_dragItem.position.z=15e-5:"ROD"==g_shelf_object_type?g_dragItem.position.z=.005:"TEXTBOX"!==g_shelf_object_type&&(g_dragItem.position.z=5e-4)),g_delete_details.length>0?g_multiItemCopy="Y":g_multiItemCopy="N",g_selecting&&void 0!==i&&i.length>0){await get_multiselect_obj(i,a);"Y"==g_area_zoom_ind?(new_camera=get_canvas_camera("MOUSEUP"),new_pogjson=get_canvas_json("MOUSEUP"),select_zoom(g_scene_objects[a].scene.children[0],new_pogjson,a),g_area_zoom_ind="N"):g_selecting=!1,g_selection.style.visibility="hidden"}logDebug("function : doMouseUp","E")}catch(e){error_handling(e)}}function doMouseDown(e,t,_,o,s,n,i,a){logDebug("function : doMouseDown; x : "+e+"; y : "+t+"; startX : "+_+"; startY : "+o+"; context_call : "+i,"S");try{window.devicePixelRatio;var g=$(document).scrollTop(),r=$(".t-Region-body").scrollLeft(),l=document.getElementById("ig_mod_details").offsetWidth+40;g_multiselect="Y",g_global_counter+=1,g_start_coorX=_,g_start_coorY=o,g_taskItemInContext=clickInsideElement(s,"canvasregion"),g_taskItemInContext1=clickInsideElement(s,"canvasregion1"),g_selection.style.visibility="hidden";var c,d={};g_taskItemInContext&&(n=document.getElementById("maincanvas"),void 0!==g_scene_objects[a]?(d=g_scene_objects[a].scene.children[0],c=g_scene_objects[a].scene.children[2]):(d=g_camera,c=g_world));var m=get_canvas_json("LABEL"),p=n.width/window.devicePixelRatio,u=n.height/window.devicePixelRatio,I=2*e/p-1,f=1-2*t/u;if(g_carpark_item_flag="N",g_carpark_edit_flag="N",g_module_edit_flag="N",g_shelf_edit_flag="N",g_item_edit_flag="N",g_module_index=-1,g_shelf_index=-1,g_module_cnt=-1,g_item_index=-1,g_module_width=-1,comp_obj_id=-1,g_module_X="",g_shelf_max_merch="",g_shelf_basket_spread="",render(),d.updateProjectionMatrix(),g_raycaster.setFromCamera(new THREE.Vector2(I,f),d),g_intersects=g_raycaster.intersectObjects(c.children),$s("P174_SELECTED_CANVAS",`${g_curr_canvas}`),0==g_intersects.length){if(c.add(g_targetForDragging),g_targetForDragging.position.set(0,0,0),render(),g_intersects=g_raycaster.intersectObjects(c.children),g_intersects.length>0){var O=g_intersects[0].point.x,D=g_intersects[0].point.y;g_drag_z=g_intersects[0].point.z,g_drag_z+=.001;var h=new THREE.Vector3(O,D,b);c.worldToLocal(h);I=Math.min(19,Math.max(-19,h.x)),t=Math.min(19,Math.max(-19,h.y));if(g_DragMouseStart.x=I,g_DragMouseStart.y=t,g_DragMouseEnd.x=I,g_DragMouseEnd.y=t,g_startMouse.x=s.clientX+r-l,g_startMouse.y=s.clientY+g,g_prevMouse.x=I,g_prevMouse.y=t,g_nextMouse=g_prevMouse.clone(),c.remove(g_targetForDragging),g_intersected=[],g_select_zoom_arr=[],s.shiftKey)return!1;var E=g_startMouse.x,v=g_startMouse.y;return g_selecting=!0,g_selection.style.left=g_startMouse.x+"px",g_selection.style.top=g_startMouse.y+"px",g_selection.style.width=E-g_startMouse.x+"px",g_selection.style.height=v-g_startMouse.y+"px",g_selection.style.visibility="visible",!0}return g_intersected=[],g_select_zoom_arr=[],!1}if(g_intersects.length>0){if("drag_object"==g_intersects[0].object.uuid){var M=g_intersects[1];g_objectHit=M.object;O=g_intersects[1].point.x;g_mousedown_locx=g_intersects[1].point.x;D=g_intersects[1].point.y;var b=g_intersects[1].point.z;g_drag_z=g_intersects[1].point.z}else{M=g_intersects[0];g_objectHit=M.object;O=g_intersects[0].point.x;g_mousedown_locx=g_intersects[0].point.x;D=g_intersects[0].point.y,b=g_intersects[0].point.z;g_drag_z=g_objectHit.position.z}h=new THREE.Vector3(O,D,b);c.worldToLocal(h);I=Math.min(19,Math.max(-19,h.x));var P=g_drag_z;g_drag_z+=.001,g_itemDragZ=g_objectHit.position.z,g_itemDragX=g_objectHit.position.x;t=Math.min(19,Math.max(-19,h.y));if(g_objectHit_uuid=g_objectHit.uuid,g_objectHit_id=g_objectHit.id,console.log("g_objectHit_id",g_objectHit_id,g_objectHit_uuid,I,t,P),get_object_identity(m,a),-1!==g_module_index&&-1!==g_shelf_index&&update_item_distance(g_module_index,g_shelf_index,a),g_drag_x=g_module_X,render(),"Y"==g_module_edit_flag||-1!==g_module_obj_array.indexOf(g_objectHit)||g_objectHit_uuid.match(/BASE.*/)||g_objectHit_uuid.match(/NOTCH.*/)){g_startMouse.x=s.clientX+r-l,g_startMouse.y=s.clientY+g,g_prevMouse.x=I,g_prevMouse.y=t,g_nextMouse=g_prevMouse.clone(),g_DragMouseStart.x=I,g_DragMouseStart.y=t,g_DragMouseEnd.x=I,g_DragMouseEnd.y=t;E=g_startMouse.x+1,v=g_startMouse.y+1;return"N"!=g_context_opened||s.shiftKey||(g_selecting=!0,g_selection.style.left=g_startMouse.x+"px",g_selection.style.top=g_startMouse.y+"px",g_selection.style.width=E-g_startMouse.x+"px",g_selection.style.height=v-g_startMouse.y+"px",g_selection.style.visibility="visible"),!0}return g_dragItem=g_objectHit,console.log("evt.ctrlKey",s.ctrlKey,g_module_edit_flag,g_item_edit_flag,g_ctrl_select,g_mselect_drag,g_multiItemCopy),!1}if(g_intersected){for(var j=0;j<g_intersected.length;j++)g_select_color=g_intersected[j].BorderColour,g_intersected[j].WireframeObj.material.color.setHex(g_intersected[j].BorderColour),"Y"!=g_intersected[j].ImageExists||"Y"!=g_show_live_image&&"Y"!=g_show_live_image_comp||(g_intersected[j].WireframeObj.material.transparent=!0,g_intersected[j].WireframeObj.material.opacity=.0025);clearInterval(g_myVar),g_select_color=0,render(),g_intersected=[],g_select_zoom_arr=[]}logDebug("function : doMouseDown","E")}catch(e){error_handling(e)}}async function get_multiselect_obj(e,t){logDebug("function : get_multiselect_obj","S");try{if(console.log("g multiselect obj",e),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],void 0!==e&&e.length>0){var _=e[t].ModuleInfo,o=0;for(const O of _){if(null==O.ParentModule||"undefined"==O.ParentModule){var s=0;for(const _ of O.ShelfInfo){if(void 0!==_&&"NOTCH"!==_.ObjType&&"BASE"!==_.ObjType&&"DIVIDER"!==_.ObjType){if(0!==_.Rotation||0!==_.Slope)var n=_.X-_.ShelfRotateWidth/2,i=_.X+_.ShelfRotateWidth/2,a=_.Y-_.ShelfRotateHeight/2,g=_.Y+_.ShelfRotateHeight/2;else n=_.X-_.W/2,i=_.X+_.W/2,a=_.Y-_.H/2,g=_.Y+_.H/2;if(g_DragMouseStart.x<g_DragMouseEnd.x&&g_DragMouseStart.y>g_DragMouseEnd.y){if(n>g_DragMouseStart.x&&i>g_DragMouseStart.x&&a<g_DragMouseStart.y&&g<g_DragMouseStart.y&&n<g_DragMouseEnd.x&&i<g_DragMouseEnd.x&&a>g_DragMouseEnd.y&&g>g_DragMouseEnd.y)(p={}).ObjID=_.SObjID,p.MIndex=o,p.SIndex=s,p.ObjWidth=_.W,p.ObjHeight=_.H,p.XAxis=_.X,p.YAxis=_.Y,p.ZAxis=_.Z,p.IIndex=-1,p.ObjType=_.ObjType,p.IsDivider="N",p.Object="SHELF",p.MObjID=O.MObjID,p.SObjID=-1,p.ItemID="",p.Item="",p.Exists="N",p.Rotation=_.Rotation,p.Slope=_.Slope,p.Distance=0,p.TopObjID="",p.BottomObjID="",g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(p)}else if(g_DragMouseStart.x>g_DragMouseEnd.x&&g_DragMouseStart.y>g_DragMouseEnd.y){if(n>g_DragMouseEnd.x&&i>g_DragMouseEnd.x&&a>g_DragMouseEnd.y&&g>g_DragMouseEnd.y&&n<g_DragMouseStart.x&&i<g_DragMouseStart.x&&a<g_DragMouseStart.y&&g<g_DragMouseStart.y)(p={}).ObjID=_.SObjID,p.MIndex=o,p.SIndex=s,p.ObjWidth=_.W,p.ObjHeight=_.H,p.XAxis=_.X,p.YAxis=_.Y,p.ZAxis=_.Z,p.IIndex=-1,p.ObjType=_.ObjType,p.IsDivider="N",p.Object="SHELF",p.MObjID=O.MObjID,p.SObjID=-1,p.ItemID="",p.Item="",p.Exists="N",p.Rotation=_.Rotation,p.Slope=_.Slope,p.Distance=0,p.TopObjID="",p.BottomObjID="",g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(p)}else if(g_DragMouseStart.x<g_DragMouseEnd.x&&g_DragMouseStart.y<g_DragMouseEnd.y){if(n>g_DragMouseStart.x&&i>g_DragMouseStart.x&&a>g_DragMouseStart.y&&g>g_DragMouseStart.y&&n<g_DragMouseEnd.x&&i<g_DragMouseEnd.x&&a<g_DragMouseEnd.y&&g<g_DragMouseEnd.y)(p={}).ObjID=_.SObjID,p.MIndex=o,p.SIndex=s,p.ObjWidth=_.W,p.ObjHeight=_.H,p.XAxis=_.X,p.YAxis=_.Y,p.ZAxis=_.Z,p.IIndex=-1,p.ObjType=_.ObjType,p.IsDivider="N",p.Object="SHELF",p.MObjID=O.MObjID,p.SObjID=-1,p.ItemID="",p.Item="",p.Exists="N",p.Rotation=_.Rotation,p.Slope=_.Slope,p.Distance=0,p.TopObjID="",p.BottomObjID="",g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(p)}else if(g_DragMouseStart.x>g_DragMouseEnd.x&&g_DragMouseStart.y<g_DragMouseEnd.y){if(n<g_DragMouseStart.x&&i<g_DragMouseStart.x&&a>g_DragMouseStart.y&&g>g_DragMouseStart.y&&n>g_DragMouseEnd.x&&i>g_DragMouseEnd.x&&a<g_DragMouseEnd.y&&g<g_DragMouseEnd.y)(p={}).ObjID=_.SObjID,p.MIndex=o,p.SIndex=s,p.ObjWidth=_.W,p.ObjHeight=_.H,p.XAxis=_.X,p.YAxis=_.Y,p.ZAxis=_.Z,p.IIndex=-1,p.ObjType=_.ObjType,p.IsDivider="N",p.Object="SHELF",p.MObjID=O.MObjID,p.SObjID=-1,p.ItemID="",p.Item="",p.Exists="N",p.Rotation=_.Rotation,p.Slope=_.Slope,p.Distance=0,p.TopObjID="",p.BottomObjID="",g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(p)}var r=0;for(const n of _.ItemInfo){var l=n.X-n.W/2,c=n.X+n.W/2,d=n.Y-n.H/2,m=n.Y+n.H/2;if(g_DragMouseStart.x<g_DragMouseEnd.x&&g_DragMouseStart.y>g_DragMouseEnd.y){if(l>g_DragMouseStart.x&&c>g_DragMouseStart.x&&d<g_DragMouseStart.y&&m<g_DragMouseStart.y&&l<g_DragMouseEnd.x&&c<g_DragMouseEnd.x&&d>g_DragMouseEnd.y&&m>g_DragMouseEnd.y){var p={},u="N",I="ITEM";if("DIVIDER"==n.Item&&(u="Y",I="SHELF"),p.ObjID=n.ObjID,p.MIndex=o,p.SIndex=s,p.ObjWidth=n.W,p.ObjHeight=n.H,p.XAxis=n.X,p.YAxis=n.Y,p.ZAxis=n.Z,p.IIndex=r,p.ObjType=_.ObjType,p.IsDivider=u,p.Object=I,p.MObjID=O.MObjID,p.SObjID=_.SObjID,p.ItemID=n.ItemID,p.Item=n.Item,p.W=n.W,p.H=n.H,p.X=n.X,p.Y=n.Y,p.Exists="N",p.Rotation=0,p.Slope=0,p.Distance=n.Distance,p.TopObjID=n.TopObjID,p.BottomObjID=n.BottomObjID,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(p),void 0!==s&&void 0!==o&&g_delete_details.length>0){var f=e[t].ModuleInfo[o].ShelfInfo[s];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(f)}}}else if(g_DragMouseStart.x>g_DragMouseEnd.x&&g_DragMouseStart.y>g_DragMouseEnd.y){if(l>g_DragMouseEnd.x&&c>g_DragMouseEnd.x&&d>g_DragMouseEnd.y&&m>g_DragMouseEnd.y&&l<g_DragMouseStart.x&&c<g_DragMouseStart.x&&d<g_DragMouseStart.y&&m<g_DragMouseStart.y){p={},u="N",I="ITEM";if("DIVIDER"==n.Item&&(u="Y",I="SHELF"),p.ObjID=n.ObjID,p.MIndex=o,p.SIndex=s,p.ObjWidth=n.W,p.ObjHeight=n.H,p.XAxis=n.X,p.YAxis=n.Y,p.ZAxis=n.Z,p.IIndex=r,p.ObjType=_.ObjType,p.IsDivider=u,p.Object=I,p.MObjID=O.MObjID,p.SObjID=_.SObjID,p.ItemID=n.ItemID,p.Item=n.Item,p.W=n.W,p.H=n.H,p.X=n.X,p.Y=n.Y,p.Exists="N",p.Rotation=0,p.Slope=0,p.Distance=n.Distance,p.TopObjID=n.TopObjID,p.BottomObjID=n.BottomObjID,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(p),void 0!==s&&void 0!==o&&g_delete_details.length>0){f=e[t].ModuleInfo[o].ShelfInfo[s];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(f)}}}else if(g_DragMouseStart.x<g_DragMouseEnd.x&&g_DragMouseStart.y<g_DragMouseEnd.y){if(l>g_DragMouseStart.x&&c>g_DragMouseStart.x&&d>g_DragMouseStart.y&&m>g_DragMouseStart.y&&l<g_DragMouseEnd.x&&c<g_DragMouseEnd.x&&d<g_DragMouseEnd.y&&m<g_DragMouseEnd.y){p={},u="N",I="ITEM";if("DIVIDER"==n.Item&&(u="Y",I="SHELF"),p.ObjID=n.ObjID,p.MIndex=o,p.SIndex=s,p.ObjWidth=n.W,p.ObjHeight=n.H,p.XAxis=n.X,p.YAxis=n.Y,p.ZAxis=n.Z,p.IIndex=r,p.ObjType=_.ObjType,p.IsDivider=u,p.Object=I,p.MObjID=O.MObjID,p.SObjID=_.SObjID,p.ItemID=n.ItemID,p.Item=n.Item,p.W=n.W,p.H=n.H,p.X=n.X,p.Y=n.Y,p.Exists="N",p.Rotation=0,p.Slope=0,p.Distance=n.Distance,p.TopObjID=n.TopObjID,p.BottomObjID=n.BottomObjID,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(p),void 0!==s&&void 0!==o&&g_delete_details.length>0){f=e[t].ModuleInfo[o].ShelfInfo[s];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(f)}}}else if(g_DragMouseStart.x>g_DragMouseEnd.x&&g_DragMouseStart.y<g_DragMouseEnd.y&&l<g_DragMouseStart.x&&c<g_DragMouseStart.x&&d>g_DragMouseStart.y&&m>g_DragMouseStart.y&&l>g_DragMouseEnd.x&&c>g_DragMouseEnd.x&&d<g_DragMouseEnd.y&&m<g_DragMouseEnd.y){p={},u="N",I="ITEM";if("DIVIDER"==n.Item&&(u="Y",I="SHELF"),p.ObjID=n.ObjID,p.MIndex=o,p.SIndex=s,p.ObjWidth=n.W,p.ObjHeight=n.H,p.XAxis=n.X,p.YAxis=n.Y,p.ZAxis=n.Z,p.IIndex=r,p.ObjType=_.ObjType,p.IsDivider=u,p.Object=I,p.MObjID=O.MObjID,p.SObjID=_.SObjID,p.ItemID=n.ItemID,p.Item=n.Item,p.W=n.W,p.H=n.H,p.X=n.X,p.Y=n.Y,p.Exists="N",p.Rotation=0,p.Slope=0,p.Distance=n.Distance,p.TopObjID=n.TopObjID,p.BottomObjID=n.BottomObjID,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(p),void 0!==s&&void 0!==o&&g_delete_details.length>0){f=e[t].ModuleInfo[o].ShelfInfo[s];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(f)}}r++}}s++}}o++}}logDebug("function : get_multiselect_obj","E")}catch(e){error_handling(e)}}function select_zoom(e,t,_){logDebug("function : select_zoom","S");var o=g=r=l=0;try{if(g_cutaway_cam_detail=[],console.log("g_DragMouseStart",g_DragMouseStart,g_DragMouseEnd,g_multiselect),0!==g_DragMouseStart.x&&0!==g_DragMouseEnd.x&&"Y"==g_multiselect){if(g_DragMouseStart.x>g_DragMouseEnd.x?(o=g_DragMouseStart.x-g_DragMouseEnd.x,r=g_DragMouseEnd.x+o/2):(o=g_DragMouseEnd.x-g_DragMouseStart.x,r=g_DragMouseStart.x+o/2),g_DragMouseStart.y>g_DragMouseEnd.y?(g=g_DragMouseStart.y-g_DragMouseEnd.y,l=g_DragMouseEnd.y+g/2):(g=g_DragMouseEnd.y-g_DragMouseStart.y,l=g_DragMouseStart.y+g/2),set_camera_z(g_scene_objects[0].scene.children[0],r,l,o,g,0,r,l,!0,_),g_manual_zoom_ind="Y",(d={}).x=r,d.y=l,d.width=o,d.height=g,d.offset=0,g_cutaway_cam_detail.push(d),g_intersected){for(var s=0;s<g_intersected.length;s++)g_select_color=g_intersected[s].BorderColour,g_intersected[s].WireframeObj.material.color.setHex(g_select_color),"Y"!=g_intersected[s].ImageExists||"Y"!=g_show_live_image&&"Y"!=g_show_live_image_comp||(g_intersected[s].WireframeObj.material.transparent=!0,g_intersected[s].WireframeObj.material.opacity=.0025);clearInterval(g_myVar),g_select_color=0,render()}g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_multiselect="N",g_intersected=[]}else if(g_select_zoom_arr.length>0){var n=maxx=miny=maxy=-1;for(s=0;s<g_select_zoom_arr.length;s++){var i="N",a="N";$.each(t[_].ModuleInfo,(function(e,o){if("Y"==i)return!1;if(null==o.ParentModule||"undefined"==o.ParentModule){if(o.MObjID==g_select_zoom_arr[s].id)return n=-1==n?o.X-o.W/2:Math.min(n,o.X-o.W/2),-1==miny?miny=o.Y-o.H/2+t[_].BaseH:miny=Math.min(miny,o.Y-o.H/2+t[_].BaseH),maxx=Math.max(maxx,o.X+o.W/2),maxy=Math.max(maxy,o.Y+o.H/2+t[_].BaseH),i="Y",a="Y","Y",!1;$.each(o.ShelfInfo,(function(e,t){if("Y"==i)return!1;if(void 0!==t&&"NOTCH"!==t.ObjType&&"BASE"!==t.ObjType&&"DIVIDER"!==t.ObjType){if(g_shelf.SObjID==g_select_zoom_arr[s].id)return 0!==t.Rotation||0!==t.Slope?(shelf_width=void 0===t.ShelfRotateWidth?t.W:t.ShelfRotateWidth,shelf_height=void 0===t.ShelfRotateHeight?t.W:t.ShelfRotateHeight):(shelf_width=t.W,shelf_height=t.H),n=-1==n?t.X-shelf_width/2:Math.min(n,t.X-shelf_width/2),-1==miny?miny=t.Y-shelf_height/2:miny=Math.min(miny,t.Y-shelf_height/2),maxx=Math.max(maxx,t.X+shelf_width/2),maxy=Math.max(maxy,t.Y+shelf_height/2),i="Y",a="Y",!1;t.ItemInfo.length>0&&$.each(t.ItemInfo,(function(e,_){if(_.ObjID==g_select_zoom_arr[s].id)return 0!==t.Rotation||0!==t.Slope?(item_width=void 0===_.RotationWidth||null==_.RotationWidth||0==_.RotationWidth?_.W:_.RotationWidth,item_height=void 0===_.RotationHeight||null==_.RotationHeight||0==_.RotationHeight?_.H:_.RotationHeight):(item_width=_.W,item_height=_.H),n=-1==n?_.X-item_width/2:Math.min(n,_.X-item_width/2),-1==miny?miny=_.Y-item_height/2:miny=Math.min(miny,_.Y-item_height/2),maxx=Math.max(maxx,_.X+item_width/2),maxy=Math.max(maxy,_.Y+item_height/2),i="Y",a="Y",!1}))}}))}}))}if("Y"==a){if(g_intersected){for(s=0;s<g_intersected.length;s++)g_select_color=g_intersected[s].BorderColour,g_intersected[s].WireframeObj.material.color.setHex(g_select_color),"Y"!=g_intersected[s].ImageExists||"Y"!=g_show_live_image&&"Y"!=g_show_live_image_comp||(g_intersected[s].WireframeObj.material.transparent=!0,g_intersected[s].WireframeObj.material.opacity=.0025);clearInterval(g_myVar),g_select_color=0,render()}o=maxx-n;var g=maxy-miny,r=n+o/2,l=miny+g/2;set_camera_z(g_scene_objects[0].scene.children[0],r,l,o,g,.5,r,l,!0,_),(d={}).x=r,d.y=l,d.width=o,d.height=g,d.offset=.5,g_cutaway_cam_detail.push(d),g_manual_zoom_ind="Y",g_select_zoom_arr=[],render()}}else{if("Y"==g_module_edit_flag){o=t[_].ModuleInfo[g_module_index].W,g=t[_].ModuleInfo[g_module_index].H,r=t[_].ModuleInfo[g_module_index].X,l=t[_].ModuleInfo[g_module_index].Y;var c=g_offset_z}else if("Y"==g_shelf_edit_flag){o=t[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].W,g=t[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].H,r=t[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X,l=t[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y;c=0}else if("Y"==g_item_edit_flag){o=t[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].W,g=t[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].H,r=t[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].X,l=t[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Y;c=0}var d;if(o>0)set_camera_z(g_scene_objects[0].scene.children[0],r,l,o,g,c,r,l,!0,_),(d={}).x=r,d.y=l,d.width=o,d.height=g,d.offset=c,g_cutaway_cam_detail.push(d),g_manual_zoom_ind="Y",render()}}catch(e){error_handling(e)}logDebug("function : select_zoom","E")}function get_object_identity(e,t){logDebug("function : get_object_identity","S");try{var _=0;for(const s of e[t].ModuleInfo){if("Y"==g_carpark_edit_flag)break;if(null==s.ParentModule&&void 0!==s.Carpark&&s.Carpark.length>0&&s.Carpark[0].ItemInfo.length>0){var o=0;for(const e of s.Carpark){if(e.SObjID==g_objectHit_id){g_module_index=_,g_shelf_index=o,g_carpark_edit_flag="Y";break}g_carpark_edit_flag="N",o++}}_++}if("N"==g_carpark_edit_flag){_=0;for(const o of e[t].ModuleInfo){if(g_taskItemInContext||"POG"==g_compare_view||"EDIT_PALLET"==g_compare_view){if(o.MObjID==g_objectHit_id&&null==o.ParentModule){g_module_index=_,g_module_cnt=_,g_module_width=o.W,g_module_X=o.X,g_module_edit_flag="Y",comp_obj_id=o.CompMObjID,g_wireframe_id=o.WFrameID,apex.item("P400_MODULE_DISP").setValue(o.Module);break}g_module_edit_flag="N"}else{if(o.CompMObjID==g_objectHit_id&&null==o.ParentModule){g_module_index=_,g_module_cnt=_,g_module_width=o.W,g_module_X=o.X,g_module_edit_flag="Y",comp_obj_id=o.MObjID,g_wireframe_id=o.WFrameID,apex.item("P400_MODULE_DISP").setValue(o.Module);break}g_module_edit_flag="N"}_++}}if("N"==g_module_edit_flag&&"N"==g_carpark_edit_flag){o=0;for(const _ of e[t].ModuleInfo){if("Y"==g_shelf_edit_flag)break;null==_.ParentModule&&$.each(_.ShelfInfo,(function(e,t){if("BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType)if(g_taskItemInContext||"POG"==g_compare_view||"EDIT_PALLET"==g_compare_view){if(t.SObjID==g_objectHit_id)return g_module_index=o,g_shelf_index=e,g_shelf_max_merch=t.MaxMerch,g_shelf_basket_spread=t.BsktSpreadProduct,g_shelf_edit_flag="Y",g_wireframe_id=t.WFrameID,g_shelf_object_type=t.ObjType,comp_obj_id=t.CompShelfObjID,g_rotation=t.Rotation,t.Slope>0?g_slope=0-t.Slope:t.Slope<0?g_slope=-t.Slope:g_slope=0,!1;g_shelf_edit_flag="N"}else{if(t.CompShelfObjID==g_objectHit_id)return g_module_index=o,g_shelf_index=e,g_shelf_max_merch=t.MaxMerch,g_shelf_edit_flag="Y",g_wireframe_id=t.WFrameID,g_shelf_object_type=t.ObjType,g_shelf_basket_spread=t.BsktSpreadProduct,g_rotation=t.Rotation,comp_obj_id=t.SObjID,t.Slope>0?g_slope=0-t.Slope:t.Slope<0?g_slope=-t.Slope:g_slope=0,!1;g_shelf_edit_flag="N"}})),o++}}if("N"==g_shelf_edit_flag&&"N"==g_module_edit_flag&&"N"==g_carpark_edit_flag){var s=0;for(const n of e[t].ModuleInfo){if("Y"==g_item_edit_flag)break;if(null==n.ParentModule){if(void 0!==n.Carpark&&void 0!==n.Carpark[0]&&n.Carpark.length>0&&n.Carpark[0].ItemInfo.length>0){o=0;for(const e of n.Carpark[0].ItemInfo){if(g_taskItemInContext||"POG"==g_compare_view||"EDIT_PALLET"==g_compare_view){if(e.ObjID==g_objectHit_id){g_module_index=s,g_shelf_index=0,g_item_index=o,g_item_edit_flag="Y",g_shelf_object_type=n.Carpark[0].ObjType,g_wireframe_id=e.WFrameID,comp_obj_id=e.CompItemObjID,g_carpark_item_flag="Y";break}g_item_edit_flag="N"}else{if(e.ObjID==g_objectHit_id){g_module_index=s,g_shelf_index=0,g_item_index=o,g_item_edit_flag="Y",g_shelf_object_type=n.Carpark[0].ObjType,g_wireframe_id=e.WFrameID,comp_obj_id=e.ObjID,g_carpark_item_flag="Y";break}g_item_edit_flag="N"}o++}}_=0;for(const e of n.ShelfInfo){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){if("Y"==g_item_edit_flag)break;o=0;for(const t of e.ItemInfo){if(g_taskItemInContext||"POG"==g_compare_view||"EDIT_PALLET"==g_compare_view){if(t.ObjID==g_objectHit_id){g_module_index=s,g_shelf_index=_,g_item_index=o,g_item_edit_flag="Y",g_shelf_object_type=e.ObjType,g_wireframe_id=t.WFrameID,comp_obj_id=t.CompItemObjID;break}g_item_edit_flag="N"}else{if(t.CompItemObjID==g_objectHit_id){g_module_index=s,g_shelf_index=_,g_item_index=o,g_item_edit_flag="Y",comp_obj_id=t.ObjID,g_shelf_object_type=e.ObjType,g_wireframe_id=t.WFrameID;break}g_item_edit_flag="N"}o++}}_++}}s++}}logDebug("function : get_object_identity","E")}catch(e){error_handling(e)}}function onDocumentMouseWheel(e){var t,_,o;if(logDebug("function : onDocumentMouseWheel","S"),g_taskItemInContext=clickInsideElement(e,"canvasregion"),g_taskItemInContext1=clickInsideElement(e,"canvasregion1"),g_taskItemInContext?(t=document.getElementById("maincanvas"),_=g_camera,o="#maincanvas"):(t=document.getElementById("maincanvas1"),_=g_camera_comp,o="#maincanvas1"),e.ctrlKey){g_duplicating="N",e.preventDefault(),e.stopPropagation(),g_manual_zoom_ind="Y";var s=t.getBoundingClientRect(),n=e.clientX-s.left,i=e.clientY-s.top,a=parseFloat($v("P174_POGCR_CAMERA_ZOOM_FACTOR")),g=2*n/(t.width/window.devicePixelRatio)-1,r=1-2*i/(t.height/window.devicePixelRatio),l=new THREE.Vector3(g,r,e.deltaY/500);l.unproject(_),l.sub(_.position),e.deltaY<0?($(o).css("cursor","zoom-in"),_.position.addVectors(_.position,l.setLength(a))):($(o).css("cursor","zoom-out"),_.position.subVectors(_.position,l.setLength(a))),render()}else if("Y"==g_manual_zoom_ind){var c=parseFloat($v("P174_POGCR_WHEEL_UP_DOWN_INTER"));e.deltaY<0?_.position.set(_.position.x,_.position.y+c,_.position.z):e.deltaY>0&&_.position.set(_.position.x,_.position.y-c,_.position.z),render()}logDebug("function : onDocumentMouseWheel","E")}function reset_zoom(e){logDebug("function : reset_zoom","S");try{if("undefined"!=typeof g_pog_json&&g_pog_json.length>0||"undefined"!=typeof g_pog_json_comp&&g_pog_json_comp.length>0){if($(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),$("#maincanvas").css("cursor","auto"),$("#maincanvas1").css("cursor","auto"),g_manual_zoom_ind="N",g_area_zoom_ind="N",g_select_zoom_arr=[],1==g_curr_canvas){var t=get_min_max_xy(g_pog_index).split("###");set_camera_z(g_scene_objects[e].scene.children[0],parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[0]),parseFloat(t[1]),g_offset_z,parseFloat(t[4]),parseFloat(t[5]),!0,e)}if("undefined"!=typeof g_pog_json_comp&&g_pog_json_comp.length>0&&2==g_curr_canvas&&"CUTAWAY"!==g_compare_view){t=get_min_max_xy(g_pog_index).split("###");set_camera_z(g_camera_comp,parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[0]),parseFloat(t[1]),g_offset_z,parseFloat(t[4]),parseFloat(t[5]),!0,e)}else 2==g_curr_canvas&&"CUTAWAY"!==g_compare_view&&set_camera_z(g_camera_comp,g_pog_json[e].CompCamX,g_pog_json[e].CompCamY,g_pog_json[e].CompCamWidth,g_pog_json[e].CompCamHeight,g_offset_z,g_pog_json[e].CompCamWidth,g_pog_json[e].CompCamHeight,!0,e);render(),g_intersected=[]}logDebug("function : reset_zoom","E")}catch(e){error_handling(e)}}function area_zoom(){logDebug("function : area_zoom","S"),"N"==g_area_zoom_ind?($(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),$(".area_zoom").addClass("active"),g_area_zoom_ind="Y",g_select_zoom_arr=[]):($(".area_zoom").removeClass("active"),g_area_zoom_ind="N"),logDebug("function : area_zoom","E")}function open_module(e){var t;if(l_selected_mod!==e){l_selected_mod=e;var _=apex.region("ig_mod_details").widget().interactiveGrid("getViews","grid").model;_.forEach((function(e){_.getValue(e,"POG_MODULE")!==l_selected_mod?$('#ig_mod_details [data-id="'+_.getValue(e,"POG_MODULE")+'"] .pdfViewLink').addClass("nolink"):t=e})),g_pog_index=0,init(),g_scene_objects=[],objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects),apex.region("ig_mod_details").widget().interactiveGrid("getCurrentView").view$.grid("setSelectedRecords",[t],!0);var o="",s=-1,n=[],i=-1;if(""!==e){if(g_pog_json_data.length>0){$.each(g_pog_json_data[g_pog_index].ModuleInfo,(function(t,_){null==_.ParentModule&&_.Module==e&&(i=t,n.push(_),s=_.W)}));var a=0;$.each(g_pog_json_data[g_pog_index].ModuleInfo,(function(e,t){null==t.ParentModule&&e<i&&(a+=t.W)}))}console.log("if ",s,i),g_pog_json[g_pog_index].ModuleInfo=n,g_pog_json[g_pog_index].W=s,g_pog_json[g_pog_index].BaseW=s,g_pog_json[g_pog_index].TotalModWidth=a}o=void 0===e||""==e?"N":"Y";var g=JSON.parse(JSON.stringify(g_pog_json));module_obj_array=[],async function(){addLoadingIndicator(),g_pog_json=[],await create_module_from_json(g,"N",l_pog_type,"N","E","Y","N","Y","Y",o,i,g_pog_index);var e=apex.region("ig_mod_details").widget().interactiveGrid("getViews","grid").model;e.forEach((function(t){e.getValue(t,"POG_MODULE")==l_selected_mod&&$('#ig_mod_details [data-id="'+e.getValue(t,"POG_MODULE")+'"] .pdfViewLink').removeClass("nolink")}))}(),dblclick_opened="N"}}function get_pog_layout(){apex.server.process("GET_JSON_FROM_COLL",{x01:$v("P174_POG_CODE"),x02:$v("P174_POG_VERSION")},{dataType:"html"}).done((function(e){try{g_pog_json_data=JSON.parse($.trim(e))}catch{return apex.message.clearErrors(),apex.message.showErrors([{type:"error",location:"page",message:$.trim(e)}]),void $("#LIVE_IMAGE").css("display","none")}g_pog_index=0,init(),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects),g_pog_json=JSON.parse(JSON.stringify(g_pog_json_data));var t="",_=-1,o=[],s=-1;apex.region("ig_mod_details").widget().interactiveGrid("getViews","grid").model;if(""!==$v("P174_POG_MODULE")&&(l_selected_mod=$v("P174_POG_MODULE")),""!==t){if(apex.region("ig_mod_details").widget().interactiveGrid("getCurrentView").view$.grid("setSelectedRecords",[undefined],!0),g_pog_json_data.length>0){$.each(g_pog_json[g_pog_index].ModuleInfo,(function(e,n){console.log("loop",n.Module,n.ParentModule,t),null==n.ParentModule&&n.Module==t&&(console.log("got "),s=e,o.push(n),_=n.W)}));var n=0;$.each(g_pog_json[g_pog_index].ModuleInfo,(function(e,t){null==t.ParentModule&&e<s&&(n+=t.W)}))}g_pog_json[g_pog_index].ModuleInfo=o,g_pog_json[g_pog_index].W=_,g_pog_json[g_pog_index].TotalModWidth=n}t=void 0===t||""==t?"N":"Y",module_obj_array=[],async function(){addLoadingIndicator();var e=JSON.parse(JSON.stringify(g_pog_json));g_pog_json=[],l_pog_type=e[0].DesignType,await create_module_from_json(e,"N",l_pog_type,"N","E","Y","N","Y","Y",t,s,g_pog_index)}(),dblclick_opened="N",removeParam("")}))}async function create_pdf_func(){if(""==$v("P174_DEFAULT_TEMPLATE"))alert("Default PDF template not available");else{addLoadingIndicator(),await clear_mod_collection();var e={SeqNo:"",POGCode:$v("P174_POG_CODE"),POGVersion:$v("P174_POG_VERSION"),POGModule:l_selected_mod,Selection_Type:"E",Print_Type:"P",SequenceId:"",TemplateId:$v("P174_DEFAULT_TEMPLATE").split("-")[0],TemplateDetails:$v("P174_DEFAULT_TEMPLATE")};await create_pdf(e,"N","N",g_pog_json,"E",$v("P174_POGCR_ITEM_NUM_LBL_COLOR"),$v("P174_POGCR_ITEM_NUM_LABEL_POS"),$v("P174_POGCR_DISPLAY_ITEM_INFO"),$v("P174_NOTCH_HEAD"),"N",g_pog_index,"N","N",$v("P174_MERCH_STYLE"),$v("P174_POGCR_LOAD_IMG_FROM"),$v("P174_BU_ID"),$v("P174_POGCR_ITEM_NUM_LBL_COLOR"),$v("P174_POGCR_ITEM_NUM_LABEL_POS"),$v("P174_POGCR_DISPLAY_ITEM_INFO"),$v("P174_POGCR_DELIST_ITEM_DFT_COL"),$v("P174_NOTCH_HEAD"))}}function clear_mod_collection(){try{return new Promise((function(e,t){apex.server.process("DELETE_MOD_IMG_COLL",{x01:""},{dataType:"html"}).done((function(t){-1==$.trim(t).indexOf("ERROR")?e("SUCCESS"):e($.trim(t))}))}))}catch(e){error_handling()}}async function get_full_canvas_module(e,t,_,o){try{var s=document.createElement("canvas");s.width=e*o,s.height=t*o,g_camera=g_scene_objects[_].scene.children[0],g_scene_objects[_].scene.children[0].aspect=s.width/s.height,g_scene_objects[_].scene.children[0].updateProjectionMatrix();var n=get_min_max_xy(_).split("###");set_camera_z(g_camera,parseFloat(n[2]),parseFloat(n[3]),parseFloat(n[0]),parseFloat(n[1]),g_offset_z,parseFloat(n[4]),parseFloat(n[5]),!0,_);var i=s.getContext("2d");return i.imageSmoothingEnabled=!0,g_renderer.setPixelRatio(window.devicePixelRatio),g_renderer.render(g_scene_objects[_].scene,g_scene_objects[_].scene.children[0]),i.drawImage(g_renderer.domElement,0,0,s.width,s.height),g_scene_objects[_].scene.children[0].aspect=g_canvas_objects[_].width/g_canvas_objects[_].height,g_scene_objects[_].scene.children[0].updateProjectionMatrix(),s}catch(e){throw error_handling(e),e}}async function comparePOG(e,t,_,o,s){logDebug("function : comparePOG","S"),await get_compare_pog(e,t,_,o,s),logDebug("function : comparePOG","E")}async function get_compare_pog(e,t,_,o,s){logDebug("function : get_compare_pog; compare_ind : "+e+"; pog_code : "+t+"; pog_version : "+_+"; draft_id : "+o+"; prev_version : "+s,"S");try{"Y"==s&&$(".item_color_legends").css("display","none"),addLoadingIndicator();var n,a,g=g_pog_index;"1"==e?(n="N",a="E"):(n="Y",a="N"),apex.server.process("GET_COMPARE_JSON",{x01:e,x02:t,x03:_,x04:o},{dataType:"html"}).done((function(e){var t=$.trim(e);if(t.match(/ERROR.*/))raise_error(t),removeLoadingIndicator(regionloadWait);else if(""!==t){g_json=JSON.parse($.trim(e));JSON.parse(JSON.stringify(g_pog_json));g_pog_json_data=g_json;var _=g_pog_json_data[0].ModuleInfo;i=0;for(const e of _){if(null!=e.ShelfInfo&&void 0!==e.ShelfInfo||(e.ShelfInfo=[]),void 0===e.ParentModule||null==e.ParentModule){null!==e.SubDept&&void 0!==e.SubDept&&(subdept=e.SubDept),j=0;for(const t of e.ShelfInfo)void 0!==t.ItemInfo&&null!=t.ItemInfo||(t.ItemInfo=[]),j+=1}i+=1}$(".live_image").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".open_pdf").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),$(".open_pdf_online").css("color","#c7c7c7").removeAttr("onclick").css("cursor","auto"),apex.server.process("ADD_POG_VERSION_TO_ARRAY",{x01:$v("1"),x02:$v("2"),x03:$v("3"),x04:$v("4")},{dataType:"text",success:function(e){}}),console.log("view_ind",l_pog_dtl_clob),async function(){g_pog_json_data[0].PreVersion="";var e,t=g_pog_json_data[0];g_comp_base_code=t.POGCode,t.PreVersion="Y",t.POGCode=t.POGCode+"-PREV_VERSION",g_ComBaseIndex=g,g_colorBackup="N",g_comp_view_code=t.POGCode,"Y"==g_compare_pog_flag&&"PREV_VERSION"==g_compare_view?(g_pog_json[g_ComViewIndex]=t,g_ComViewIndex=g_ComViewIndex,init(g_ComViewIndex),(e={}).scene=g_scene,e.renderer=g_renderer,g_scene_objects[g_ComViewIndex]=e):(g_pog_json.push(t),g_ComViewIndex=g_pog_json.length-1,appendMultiCanvasRowCol(g_pog_json.length,$v("P25_POGCR_TILE_VIEW")),init(g_ComViewIndex),(e={}).scene=g_scene,e.renderer=g_renderer,g_scene_objects.push(e));var _=JSON.parse(JSON.stringify(g_pog_json));if(g_json=[g_pog_json[g_ComViewIndex]],g_compare_view="Y"==s?"PREV_VERSION":"POG",g_compare_pog_flag="Y",set_indicator_objects(g_ComViewIndex),modifyWindowAfterMinMax(g_scene_objects),g_pog_index=g_ComViewIndex,g_multi_pog_json=[],g_world=g_scene_objects[g_ComViewIndex].scene.children[2],g_camera=g_scene_objects[g_ComViewIndex].scene.children[0],await create_module_from_json(_,n,"F",$v("P25_PRODUCT_BTN_CLICK"),a,"N","N","Y","Y","","Y",g_scene_objects[g_ComViewIndex].scene.children[0],g_scene_objects[g_ComViewIndex].scene,g_pog_index,g_ComViewIndex),removeLoadingIndicator(regionloadWait),render(g_ComViewIndex),"Y"==s){if("Y"==g_show_item_color)await showItemColor("OFF",g_ComViewIndex);await two_pog_diff_checker(g_ComBaseIndex,g_ComViewIndex),await calculateFixelAndSupplyDays("N",g_ComViewIndex)}render(g_pog_index),g_pog_index=g,add_pog_code_header()}(),$s("P25_OPEN_DRAFT","Y"),g_auto_position_ind="N",g_dblclick_opened="N"}}))}catch(e){error_handling(e),removeLoadingIndicator(regionloadWait)}}$(document).keydown((function(e){get_canvas_world("LABEL");var t=get_canvas_json("LABEL"),_=get_canvas_camera("LABEL");e.keyCode;38==e.keyCode&&1==e.ctrlKey&&void 0!==t&&t.length>0?($("#maincanvas").css("cursor","zoom-in"),_.position.set(_.position.x,_.position.y,_.position.z-parseFloat($v("P174_POGCR_CAMERA_ZOOM_FACTOR"))),g_manual_zoom_ind="Y",render()):40==e.keyCode&&1==e.ctrlKey&&void 0!==t&&t.length>0&&($("#maincanvas").css("cursor","zoom-out"),_.position.set(_.position.x,_.position.y,_.position.z+parseFloat($v("P174_POGCR_CAMERA_ZOOM_FACTOR"))),g_manual_zoom_ind="Y",render()),g_renderer.domElement.addEventListener("mousewheel",onDocumentMouseWheel,!1)}));