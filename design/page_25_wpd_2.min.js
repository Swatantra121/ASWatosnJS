function get_div_shelf_index(e,_,o,n,t,g,l){logDebug("function : get_div_shelf_index; i_final_x : "+e+"; p_final_y : "+_+"; curr_module : "+o+"; item_inside_world : "+n,"S");try{var i,d=100,a=-1,s=0,f=0,I="N",r=0,p="N";if("Y"==n)for(const n of g_pog_json[t].ModuleInfo[o].ShelfInfo){if(n.Rotation>0||n.Rotation<0)var c=wpdSetFixed(n.X+n.ShelfRotateWidth/2),u=wpdSetFixed(n.X-n.ShelfRotateWidth/2);else if("PEGBOARD"===n.ObjType){c=wpdSetFixed(n.X+n.W/2+n.ROverhang),u=wpdSetFixed(n.X-n.W/2-n.LOverhang);var m=wpdSetFixed(n.Y+n.H/2+n.UOverHang),h=wpdSetFixed(n.Y-n.H/2-n.LoOverHang)}else c=wpdSetFixed(n.X+n.W/2),u=wpdSetFixed(n.X-n.W/2),m=wpdSetFixed(n.Y+n.H/2),h=wpdSetFixed(n.Y-n.H/2);if("BASE"!==n.ObjType&&"NOTCH"!==n.ObjType&&"DIVIDER"!==n.ObjType&&"TEXTBOX"!==n.ObjType){if(parseFloat(_)>h&&parseFloat(_)<m&&parseFloat(e)>u&&parseFloat(e)<c){i=n.ObjType,s=n.Y,f=n.H,a=r,I="Y";break}wpdSetFixed(n.Y-n.H/2)<_&&(c>e||u<e)&&parseFloat(e)>u&&parseFloat(e)<c&&d>wpdSetFixed(parseFloat(_)-parseFloat(n.Y))&&(d=wpdSetFixed(parseFloat(_)-parseFloat(n.Y)),i=n.ObjType,s=n.Y,f=n.H,a=r,I="Y")}r++}else{var S=0;for(const g of g_pog_json[t].ModuleInfo){if(null==g.ParentModule){r=0;var O=g.ShelfInfo;for(const t of O){if(t.Rotation>0||t.Rotation<0)c=wpdSetFixed(t.X+t.ShelfRotateWidth/2),u=wpdSetFixed(t.X-t.ShelfRotateWidth/2);else c=wpdSetFixed(t.X+t.W/2),u=wpdSetFixed(t.X-t.W/2);"BASE"!==t.ObjType&&"NOTCH"!==t.ObjType&&"DIVIDER"!==t.ObjType&&"TEXTBOX"!==t.ObjType&&(parseFloat(_)>parseFloat(t.Y)-t.H/2&&parseFloat(_)<wpdSetFixed(parseFloat(t.Y)+t.H/2)&&parseFloat(e)>wpdSetFixed(parseFloat(t.X)-t.W/2)&&parseFloat(e)<wpdSetFixed(parseFloat(t.X)+t.W/2)&&("CHEST"==t.ObjType||"PEGBOARD"==t.ObjType)?d>wpdSetFixed(parseFloat(_)-parseFloat(t.Y))&&(d=wpdSetFixed(parseFloat(_)-parseFloat(t.Y)),n="Y",o=S,i=t.ObjType,s=t.Y,f=t.H,a=r,I="Y"):t.Y-t.H/2<_&&c>e&&u<e&&"CHEST"!==t.ObjType&&d>wpdSetFixed(parseFloat(_)-parseFloat(t.Y))&&(d=wpdSetFixed(parseFloat(_)-parseFloat(t.Y)),n="Y",o=S,i=t.ObjType,s=t.Y,f=t.H,a=r,I="Y")),r++}}S++}}if(l&&"PEGBOARD"==i)var[o,i,s,f,a,I,p]=itemOverShelfInsidePegboard(e,_,o,a,t,g);return logDebug("function : get_div_shelf_index","E"),[n,o,i,s,f,a,I,p]}catch(e){error_handling(e)}}async function refresh_product_list(e){"Y"==g_open_productlist&&null!==apex.region("draggable_table")&&("N"==g_all_pog_flag?($s("P25_OPEN_POG_CODE",`${g_pog_json[e].POGCode}`),$s("P25_OPEN_POG_VERSION",`${g_pog_json[e].Version}`)):($s("P25_OPEN_POG_CODE",""),$s("P25_OPEN_POG_VERSION","")),apex.region("draggable_table").widget().interactiveGrid("getActions").set("edit",!1),apex.region("draggable_table").widget().interactiveGrid("getViews").grid.curInst._refreshGrid())}function get_new_mod_ind(e,_,o,n){logDebug("function : get_new_mod_ind; p_module_index : "+e+"; curr_module : "+_+"; shelf_rotate_hit : "+o,"S");try{var t=-1,g=0;for(const e of g_pog_json[n].ModuleInfo)null!=e.ParentModule&&void 0!==e.ParentModule||(g=Math.max(g,e.H));if(g<g_final_y||g_final_y<0&&g>.1){var l=0;for(const e of g_pog_json[n].ModuleInfo){if((null==e.ParentModule||void 0===e.ParentModule)&&g_final_x>e.X-e.W/2&&g_final_x<e.X+e.W/2){t=l;break}l++}-1==t&&(t=0)}else t=e!==_&&-1!==_&&"N"==o?_:e;return logDebug("function : get_new_mod_ind","E"),t}catch(e){error_handling(e)}}async function check_item_dim_valid(e,_,o,n,t,g="Y"){logDebug("function : check_item_dim_valid; p_module_index : "+_+"; p_shelf_index : "+o+"; i_item_index : "+n,"S");try{var l=g_pog_json[t].ModuleInfo[_].ShelfInfo[o],[i,d,a]=get_select_dim(e),s="N",f=0;""!==e.ItemNesting&&("W"==e.ItemNesting?f=e.OrgNW:"H"==e.ItemNesting?f=e.OrgNH:"D"==e.ItemNesting&&(f=e.OrgND));var I="N"==g?"N":"Y";const[u,m,h,S,O,j]=set_dim_validate_item(_,o,n,i,d,a,e.ItemNesting,f,e.BHoriz,e.BVert,e.BaseD,e.Orientation,e.OrgCWPerc,e.OrgCHPerc,e.OrgCDPerc,I,"Y","N",t);if("ERROR"!==u){update_item_org_dim(_,o,n,u,m,h,S,O,j,t),await org_dim_update_items(_,o,n,e.Item,"Y",t),g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[n].DimUpdate="Y",g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[n].OW=i,g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[n].OH=d,g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[n].OD=a;const g=g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[n].ObjID;g.OW=100*i,g.OH=100*d,g.OD=100*a;var[r,p]=get_item_xy(l,e,u,m,t);g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[n].X=r,"BASKET"==g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ObjType&&"DIVIDER"==g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[n].Item?g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[n].Y=g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[n].Y:g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[n].Y=p,s="F"}else if(s="E",g_dragItem.DimUpdate="E","N"!=g){var c=g_scene_objects[t].scene.children[2].getObjectById(g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[n].ObjID);c.WireframeObj.material.color.setHex(g_dim_error_color),c.BorderColour=g_dim_error_color}return logDebug("function : check_item_dim_valid","E"),s}catch(e){error_handling(e)}}function update_validate_item_height(e,_,o,n,t,g,l,i){logDebug("function : update_validate_item_height; p_module_index : "+_+"; p_shelf_index : "+o+"; i_item_index : "+n+"; i_final_x : "+t+"; p_object_type : "+g+"; new_x : "+l,"S");try{var d=g_pog_json[i].ModuleInfo[_].ShelfInfo[o].HorizGap,a=d,s=g_pog_json[i].ModuleInfo[_].ShelfInfo[o].SpreadItem,f=g_pog_json[i].ModuleInfo[_].ShelfInfo[o].ItemInfo.length,I=g_pog_json[i].ModuleInfo[_].ShelfInfo[o].AllowAutoCrush,r="N",p=0;if(""!==e.ItemNesting&&("W"==e.ItemNesting?p=e.OrgNW:"H"==e.ItemNesting?p=e.OrgNH:"D"==e.ItemNesting&&(p=e.OrgND)),g_combinedShelfs.length>0){var[c,u]=getCombinationShelf(i,g_pog_json[i].ModuleInfo[_].ShelfInfo[o].Shelf);-1!==c&&(I=g_combinedShelfs[c][0].AllowAutoCrush)}if("DIVIDER"!==g_pog_json[i].ModuleInfo[_].ShelfInfo[o].ItemInfo[n].Item)var[m,h,S]=get_select_dim(e);else var[m,h,S]=[e.W,e.H,e.D];const[O,j,x,M,T,b]=set_dim_validate_item(_,o,n,m,h,S,e.ItemNesting,p,e.BHoriz,e.BVert,e.BaseD,e.Orientation,e.OrgCWPerc,e.OrgCHPerc,e.OrgCDPerc,"N","N","N",i);if("ERROR"!==O&&update_item_org_dim(_,o,n,O,j,x,M,T,b,i),("SHELF"==g||"CHEST"==g&&"N"==g_chest_as_pegboard||"PALLET"==g)&&(-1==l&&(l=get_item_xaxis(e.W,e.H,e.D,g,t,a,s,d,_,o,n,"Y",f,"N",i)),"BASKET"!=g||"DIVIDER"!=e.Item))r=item_height_validation(e.H,_,o,n,"Y",l,I,e.CrushVert,e.Fixed,"Y",e.D,"N",i,"Y");return logDebug("function : update_validate_item_height","E"),r}catch(e){error_handling(e)}}async function auto_position_shelf(e,_,o,n,t,g,l,i){logDebug("function : auto_position_shelf; p_module_index : "+e+"; curr_module : "+_+"; p_shelf_index : "+o+"; i_final_x : "+t+"; p_final_y : "+g+"; g_canvas_drag : "+l,"S");try{if("N"==l)var d=get_new_mod_ind(e,_,n,i);else d=_;var a=g_pog_json[i].ModuleInfo[d].X,s=g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ItemInfo,f=-1,I=(s=g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ItemInfo,-1),r=-1,p=g_pog_json[i].ModuleInfo[e].ShelfInfo[o].SpreadItem,c=g_pog_json[i].ModuleInfo[e].ShelfInfo[o].W,u=g_pog_json[i].ModuleInfo[e].ShelfInfo[o].H,m=!1,h=-1,S=$v("P25_ALIGN_BOTH_XY_POSITION");if(("PEGBOARD"==g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ObjType||"CHEST"==g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ObjType&&"Y"==g_chest_as_pegboard)&&(g_drag_z=.00115),t-c/2>a-g_pog_json[i].ModuleInfo[d].W/2&&t-c/2<a+g_pog_json[i].ModuleInfo[d].W/2||t+c/2>a-g_pog_json[i].ModuleInfo[d].W/2&&t+c/2<a+g_pog_json[i].ModuleInfo[d].W/2){f=t<=a?a-g_pog_json[i].ModuleInfo[d].W/2+g_pog_json[i].ModuleInfo[e].ShelfInfo[o].W/2:a+g_pog_json[i].ModuleInfo[d].W/2-g_pog_json[i].ModuleInfo[e].ShelfInfo[o].W/2,g_pog_json[i].ModuleInfo[e].ShelfInfo[o].X=f,t=f,"HANGINGBAR"!=g_shelf_object_type&&"SHELF"!=g_shelf_object_type||"Y"!=S?g_dragItem.position.set(f,g_pog_json[i].ModuleInfo[e].ShelfInfo[o].Y,g_drag_z):([g,m,h]=autoPositionShelfVertically(i,e,o,f,g,g_shelf_object_type,$v("P25_POGCR_SUBSHELF_W_PERC")),m&&(g_pog_json[i].ModuleInfo[e].ShelfInfo[o].NotchNo=h),g_pog_json[i].ModuleInfo[e].ShelfInfo[o].Y=g,g_dragItem.position.set(f,g,g_drag_z));var O=0;for(const _ of s){if("BASKET"==g_shelf_object_type&&"BT"==p?(I=t-c/2+_.W/2,r=g+u/2+_.Distance+_.H/2):"HANGINGBAR"==g_shelf_object_type?(I=t-c/2+_.Distance+_.W/2,r=g-_.H/2):"ROD"==g_shelf_object_type?(I=t,r=g-u/2-_.H/2):"PEGBOARD"==g_shelf_object_type||"CHEST"==g_shelf_object_type&&"Y"==g_chest_as_pegboard?(I=t-c/2+_.PegBoardX+_.W/2,r=g-u/2+_.PegBoardY+_.H/2):(I=t-c/2+_.Distance+_.W/2,r=g+u/2+_.H/2),g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ItemInfo[O].X=I,g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ItemInfo[O].Y=r,"Y"==g_auto_position_ind)g_scene_objects[i].scene.children[2].getObjectById(_.ObjID).position.set(I,r,.001+g_pog_json[i].ModuleInfo[e].ShelfInfo[o].D/1e3);O++}s=g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ItemInfo,O=0;for(const _ of s){if(void 0!==_.BottomObjID&&""!==_.BottomObjID){for(const n of s){if(n.ObjID==_.BottomObjID)I=n.X,r=n.Y+n.H/2+_.H/2,g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ItemInfo[O].X=I,g_pog_json[i].ModuleInfo[e].ShelfInfo[o].ItemInfo[O].Y=r,g_scene_objects[i].scene.children[2].getObjectById(_.ObjID).position.set(I,r,.001+g_pog_json[i].ModuleInfo[e].ShelfInfo[o].D/1e3);0}}O++}}else await set_all_items(e,o,t,g,"Y","N","Y",i,i,"Y");return render(i),logDebug("function : auto_position_shelf","E"),m}catch(e){error_handling(e)}}function set_item_after_drag(e,_,o,n,t,g,l){logDebug("function : set_item_after_drag; new_object_type : "+e+"; new_module_index : "+o+"; new_shelf_index : "+n+"; upd_item_index : "+t,"S");try{var i=-1;return"PEGBOARD"==e||"CHEST"==e&&"Y"==g_chest_as_pegboard?(g_pog_json[l].ModuleInfo[o].ShelfInfo[n].ItemInfo.push(g),i=g_pog_json[l].ModuleInfo[o].ShelfInfo[n].ItemInfo.length-1):(g_pog_json[l].ModuleInfo[o].ShelfInfo[n].ItemInfo.splice(t,0,g),i=t),logDebug("function : set_item_after_drag","E"),i}catch(e){error_handling(e)}}async function set_shelf_after_drag(e,_,o,n,t,g,l,i,d,a,s,f,I,r=-1,p="N"){logDebug("function : set_shelf_after_drag; validate_passed : "+e+"; i_shelf_edit_flag : "+_+"; module_ind : "+o+"; curr_mod : "+n+"; shelf_ind : "+t+"; i_final_x : "+g+"; p_final_y : "+l+"; splice_shelf : "+i+"; text_z_update : "+d+"; oldModuleIndex : "+a+"; oldShelfIndex : "+s,"S");try{var c=-1;if(a=void 0===a||""==a?o:a,s=void 0===s||""==s?t:s,"Y"==_&&o!==n&&-1!==n){var u=g_pog_json[I].ModuleInfo;if("TEXTBOX"==g_shelf_object_type){var m=0;for(const e of u){if(e.ObjID==g_objectHit_id){g_pog_json[I].ModuleInfo[m].ParentModule=g_pog_json[I].ModuleInfo[n].Module,m;break}m++}}if("Y"==i){var h=g_pog_json[f].ModuleInfo[a].ShelfInfo[s];g_pog_json[f].ModuleInfo[a].ShelfInfo.splice(s,1);var S=get_min_shelf(n,l,I).split(",");c=parseFloat(S[0]),"Y"==S[1]?(g_pog_json[I].ModuleInfo[n].ShelfInfo.splice(c+1,0,h),t=c+1):(g_pog_json[I].ModuleInfo[n].ShelfInfo.splice(c,0,h),t=0),o=n,g_module_index=o,g_shelf_index=t}else g_module_index=o,g_shelf_index=t;if("PALLET"===g_shelf_object_type||"R"!=e&&"Y"!=g_max_facing_enabled||reorder_items(o,g_shelf_index,I)&&await recreate_all_items(o,g_shelf_index,g_pog_json[I].ModuleInfo[o].ShelfInfo[g_shelf_index].ObjType,"N",g,-1,g_pog_json[I].ModuleInfo[o].ShelfInfo[g_shelf_index].ItemInfo.length,"N","N",-1,-1,g_start_canvas,"N",I,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y"),r>-1&&void 0!==g_combinedShelfs[r]){var O=g_combinedShelfs[r][0].MIndex,j=g_combinedShelfs[r][0].SIndex;reorder_items(O,j,I)&&await recreate_all_items(O,j,g_pog_json[I].ModuleInfo[O].ShelfInfo[j].ObjType,"N",g,-1,g_pog_json[I].ModuleInfo[O].ShelfInfo[j].ItemInfo.length,"N","N",-1,-1,g_start_canvas,"N",I,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")}var x=g_scene_objects[I].scene.children[2].getObjectById(g_pog_json[I].ModuleInfo[o].ShelfInfo[g_shelf_index].SObjID),M=wpdSetFixed(100*g_pog_json[I].ModuleInfo[o].ShelfInfo[g_shelf_index].Y-100*g_pog_json[I].ModuleInfo[o].ShelfInfo[g_shelf_index].H/2);x.X=wpdSetFixed(100*g_pog_json[I].ModuleInfo[o].ShelfInfo[g_shelf_index].X-100*g_pog_json[I].ModuleInfo[o].ShelfInfo[g_shelf_index].W/2),x.Y=wpdSetFixed(M),"TEXTBOX"==g_shelf_object_type?x.Z=wpdSetFixed(100*g_pog_json[I].ModuleInfo[o].ShelfInfo[g_shelf_index].Z):x.Z=wpdSetFixed(100*g_pog_json[I].ModuleInfo[o].ShelfInfo[g_shelf_index].Z-100*g_pog_json[I].ModuleInfo[o].ShelfInfo[g_shelf_index].D/2),x.Module=g_pog_json[I].ModuleInfo[o].Module}else if("Y"==_&&o==n){if("Y"==i){h=g_pog_json[f].ModuleInfo[a].ShelfInfo[s];0==s?g_pog_json[f].ModuleInfo[a].ShelfInfo.splice(s,s+1):g_pog_json[f].ModuleInfo[a].ShelfInfo.splice(s,1);S=get_min_shelf(n,l,I).split(",");c=parseFloat(S[0]),"Y"==S[1]?(g_pog_json[I].ModuleInfo[o].ShelfInfo.splice(c+1,0,h),t=c+1):(g_pog_json[I].ModuleInfo[o].ShelfInfo.splice(c,0,h),t=c)}else g_module_index=o,g_shelf_index=t;if("PALLET"===g_shelf_object_type||"R"!=e&&"Y"!=g_max_facing_enabled||reorder_items(o,g_shelf_index,I)&&await recreate_all_items(o,t,g_pog_json[I].ModuleInfo[o].ShelfInfo[t].ObjType,"N",g,-1,g_pog_json[I].ModuleInfo[o].ShelfInfo[t].ItemInfo.length,"N","N",-1,-1,g_start_canvas,"N",I,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y"),r>-1&&void 0!==g_combinedShelfs[r]){O=g_combinedShelfs[r][0].MIndex,j=g_combinedShelfs[r][0].SIndex;reorder_items(O,j,I)&&await recreate_all_items(O,j,g_pog_json[I].ModuleInfo[O].ShelfInfo[j].ObjType,"N",g,-1,g_pog_json[I].ModuleInfo[O].ShelfInfo[j].ItemInfo.length,"N","N",-1,-1,g_start_canvas,"N",I,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")}x=g_scene_objects[I].scene.children[2].getObjectById(g_pog_json[I].ModuleInfo[o].ShelfInfo[t].SObjID),M=wpdSetFixed(100*g_pog_json[I].ModuleInfo[o].ShelfInfo[t].Y-100*g_pog_json[I].ModuleInfo[o].ShelfInfo[t].H/2);x.X=wpdSetFixed(100*g_pog_json[I].ModuleInfo[o].ShelfInfo[t].X-100*g_pog_json[I].ModuleInfo[o].ShelfInfo[t].W/2),x.Y=wpdSetFixed(M),"TEXTBOX"==g_shelf_object_type?x.Z=wpdSetFixed(100*g_pog_json[I].ModuleInfo[o].ShelfInfo[t].Z):x.Z=wpdSetFixed(100*g_pog_json[I].ModuleInfo[o].ShelfInfo[t].Z-100*g_pog_json[I].ModuleInfo[o].ShelfInfo[t].D/2)}if("TEXTBOX"==g_shelf_object_type&&"Y"==d){if(g_textbox_dragged="Y","Y"!=g_pog_json[I].ModuleInfo[o].ShelfInfo[t].ManualZupdate){if(-1==textboxPriorityPlacing(x,I)){var T=get_textbox_z(o,t,g_pog_json[I].ModuleInfo[o].ShelfInfo[t].X,g_pog_json[I].ModuleInfo[o].ShelfInfo[t].Y,g_pog_json[I].ModuleInfo[o].ShelfInfo[t].W,g_pog_json[I].ModuleInfo[o].ShelfInfo[t].H,I);x.position.z=T>.0021?.0021:0==T?6e-4:T,g_pog_json[I].ModuleInfo[o].ShelfInfo[t].Z=T}x.Z=wpdSetFixed(100*g_pog_json[I].ModuleInfo[o].ShelfInfo[t].Z)}else textboxPriorityPlacing(x,I,"","Y");g_textbox_dragged="N"}return-1!==g_shelf_index&&"N"==p&&"TEXTBOX"!==g_shelf_object_type&&(g_pog_json[I].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Combine="N"),logDebug("function : set_shelf_after_drag","E"),[o,t]}catch(e){error_handling(e)}}function doMouseDoubleclick(e,_,o,n,t,g,l,i){if(logDebug("function : doMouseDoubleclick; x : "+e+"; y : "+_+"; startX : "+o+"; startY : "+n,"S"),g_taskItemInContext=clickInsideElement(t,"canvasregion"),g_taskItemInContext1=clickInsideElement(t,"canvasregion1"),"N"==g_dblclick_opened&&g_ComViewIndex!==i){var d=2*e/g.width-1,a=1-2*_/g.height;if(g_raycaster.setFromCamera(new THREE.Vector2(d,a),l),g_intersects=g_raycaster.intersectObjects(g_scene_objects[i].scene.children[2].children),0==g_intersects.length)return"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&void 0!==o&&e<=g.width&&(open_pog_modal("edit_pog",i,"N"),g_dblclick_opened="Y",$s("P25_MODULE_DISP","")),!1;var s=g_intersects[0];if(g_objectHit=s.object,g_object_hit_ind="o",g_dblclick_objid=g_objectHit.id,g_objectHit_uuid=g_objectHit.uuid,"Y"===g_auto_fill_active&&Array.isArray(g_mod_block_list)&&g_mod_block_list.length>0){var f=e/g.width,I=1-_/g.height;let o=!1,n=null;for(let e=0;e<g_mod_block_list.length;e++){var r=g_mod_block_list[e],p=r.BlockDim;if(p){var c=p.CalcX,u=1-(p.CalcX-p.BlkWidth),m=p.CalcY,h=1-(p.CalcY-p.BlkHeight);if(f>=c&&f<=u&&I>=m&&I<=h){o=!0,n=r;break}}}if(o&&n)try{return void apex.theme.openRegion("auto_fill_reg")}catch(e){return void error_handling(e)}}g_carpark_edit_flag="N",g_carpark_item_flag="N",g_module_edit_flag="N",g_shelf_edit_flag="N",g_item_edit_flag="N",g_module_index="",g_shelf_index="",g_module_cnt="",g_item_index="",g_module_width="",g_module_X="",g_shelf_max_merch="",$.each(g_pog_json[i].ModuleInfo,(function(e,_){if("Y"==g_carpark_edit_flag)return!1;null==_.ParentModule&&void 0!==_.Carpark&&void 0!==_.Carpark[0]&&_.Carpark[0].ItemInfo.length>0&&$.each(_.Carpark,(function(_,o){if(o.SObjID==g_objectHit_id)return g_module_index=e,g_shelf_index=_,g_carpark_edit_flag="Y",!1;g_carpark_edit_flag="N"}))})),"N"==g_carpark_edit_flag&&$.each(g_pog_json[i].ModuleInfo,(function(e,_){if(_.MObjID==g_dblclick_objid&&null==_.ParentModule)return g_module_index=e,g_module_cnt=e,g_module_width=_.W,g_module_X=_.X,g_module_edit_flag="Y",!1;g_module_edit_flag="N"})),"N"==g_module_edit_flag&&"N"==g_carpark_edit_flag&&$.each(g_pog_json[i].ModuleInfo,(function(e,_){if("Y"==g_shelf_edit_flag)return!1;null==_.ParentModule&&$.each(_.ShelfInfo,(function(_,o){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType){if(o.SObjID==g_dblclick_objid)return g_module_index=e,g_shelf_index=_,g_shelf_max_merch=o.MaxMerch,g_shelf_edit_flag="Y",!1;g_shelf_edit_flag="N"}}))})),"N"==g_shelf_edit_flag&&"N"==g_module_edit_flag&&"N"==g_carpark_edit_flag&&$.each(g_pog_json[i].ModuleInfo,(function(e,_){if("Y"==g_item_edit_flag)return!1;null==_.ParentModule&&(void 0!==_.Carpark&&void 0!==_.Carpark[0]&&_.Carpark[0].ItemInfo.length>0&&$.each(_.Carpark[0].ItemInfo,(function(o,n){if(n.ObjID==g_objectHit_id)return g_module_index=e,g_shelf_index=0,g_item_index=o,g_item_edit_flag="Y",g_shelf_object_type=_.Carpark[0].ObjType,g_wireframe_id=n.WFrameID,g_carpark_item_flag="Y",!1;g_item_edit_flag="N"})),$.each(_.ShelfInfo,(function(_,o){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType){if("Y"==g_item_edit_flag)return!1;$.each(o.ItemInfo,(function(n,t){if(t.ObjID==g_dblclick_objid)return g_module_index=e,g_shelf_index=_,g_item_index=n,g_item_edit_flag="Y",g_shelf_object_type=o.ObjType,!1;g_item_edit_flag="N"}))}})))})),"Y"==g_carpark_item_flag?g_object_hit_ind="I":"Y"==g_module_edit_flag?g_object_hit_ind="M":"Y"==g_shelf_edit_flag?g_object_hit_ind="S":"Y"==g_item_edit_flag?(g_object_hit_ind="I",g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Exists="E"):g_objectHit_uuid.match(/BASE.*/)&&(g_object_hit_ind="B"),g_dblclick_opened="Y";try{open_edit_modal_popup(g_object_hit_ind,g_module_index,g_shelf_index,"N",i)}catch(e){error_handling(e)}}logDebug("function : doMouseDoubleclick","E")}async function set_inter_canvas_items(e,_,o,n,t,g,l,i,d,a,s,f,I,r="N"){logDebug("function : set_inter_canvas_items; a : "+e+"; y : "+_+"; shelf_width : "+t+"; shelf_height : "+g+"; p_object_type : "+l+"; basket_spread : "+i+"; rotation : "+d+"; slope : "+a+"; p_shelf_index : "+s+"; p_module_index : "+f,"S");var p=g_pog_json[I].ModuleInfo[f].ShelfInfo[s];if(0!==a||0!==d&&"N"!==d){var c=0,u=o;for(const e of n){var m=e,h=e.RotationX,S=(_=e.RotationY,e.RotationZ),O=new THREE.Vector3(h,_,S).applyMatrix4(u.matrixWorld);m.position.x=O.x,m.position.y=O.y,m.position.z=O.z,m.quaternion.copy(u.quaternion),m.updateMatrix(),(new THREE.Vector3).setFromMatrixPosition(m.matrixWorld),c+=1}render(I)}else if("BASKET"==l&&"BT"==i){c=0;for(const o of n){u=o;item_y=_+g/2+o.Distance+o.H/2,item_x=e-t/2+o.W/2,u.position.set(item_x,item_y,.001),"Y"==r&&(p.ItemInfo[c].X=item_x,p.ItemInfo[c].Y=item_y),c++}}else if("HANGINGBAR"==l){c=0;for(const o of n){u=o;item_x=e-t/2+o.Distance+o.W/2,item_y=_-o.H/2,u.position.set(item_x,item_y,.001),"Y"==r&&(p.ItemInfo[c].X=item_x,p.ItemInfo[c].Y=item_y),c++}}else if("ROD"==g_shelf_object_type){c=0;for(const o of n){u=o;item_x=e,item_y=_-g/2-o.H/2,u.position.set(item_x,item_y,.001),"Y"==r&&(p.ItemInfo[c].X=item_x,p.ItemInfo[c].Y=item_y),c++}}else if("PEGBOARD"==g_shelf_object_type||"CHEST"==g_shelf_object_type&&"Y"==g_chest_as_pegboard){c=0;for(const o of n){u=o;item_x=e-t/2+o.PegBoardX+o.W/2,item_y=_-g/2+o.PegBoardY+o.H/2,u.position.set(item_x,item_y,.016),"Y"==r&&(p.ItemInfo[c].X=item_x,p.ItemInfo[c].Y=item_y),c++}}else{c=0;for(const o of n){u=o;void 0!==o.BottomObjID&&""!==o.BottomObjID?(item_x=e-t/2+o.Distance+o.W/2,item_y=_+g/2+o.TotalHeight+o.H/2):(item_x=e-t/2+o.Distance+o.W/2,item_y=_+g/2+o.H/2),"PALLET"==g_shelf_object_type?(u.position.set(item_x,item_y,.001+p.D/1e3),o.D):"BASKET"==g_shelf_object_type&&"DIVIDER"==p.ItemInfo[c].Item?(item_y=_+g/2+p.ItemInfo[c].YDistance+p.ItemInfo[c].H/2,u.position.set(item_x,item_y,.001+p.D/1e3)):u.position.set(item_x,item_y,.001+p.D/1e3),"Y"==r&&(p.ItemInfo[c].X=item_x,p.ItemInfo[c].Y=item_y),c++}}logDebug("function : set_inter_canvas_items","E")}function set_item_blink(e){logDebug("function : set_item_blink","S");try{var _;if(g_multiselect="Y","undefined"!=typeof g_pog_json&&g_pog_json.length>0){if(g_intersected)for(var o=0;o<g_intersected.length;o++)g_select_color=g_intersected[o].BorderColour,g_intersected[o].WireframeObj.material.color.setHex(g_intersected[o].BorderColour),"Y"==g_intersected[o].ImageExists&&"Y"==g_show_live_image&&(g_intersected[o].WireframeObj.material.transparent=!0,g_intersected[o].WireframeObj.material.opacity=.0025);if(g_intersected=[],g_delete_details=[],void 0!==e){for(o=0;o<e.length;o++){_="Y"==g_all_pog_flag?0:g_pog_index;for(const a of g_pog_json){if(_!==g_ComViewIndex&&g_ComViewIndex>-1||-1==g_ComViewIndex){var n=0;for(const a of g_pog_json[_].ModuleInfo){if(null==a.ParentModule||"undefined"==a.ParentModule){var t=0;for(const s of a.ShelfInfo){if(void 0!==s&&"NOTCH"!==s.ObjType&&"BASE"!==s.ObjType&&"DIVIDER"!==s.ObjType&&"TEXTBOX"!==s.ObjType){var g=0;for(const f of s.ItemInfo){if(f.Item==e[o].getAttribute("data-id")){var l=g_scene_objects[_].scene.children[2].getObjectById(f.ObjID);g_intersected.push(l);var i={};if(i.p_pog_index=_,i.ObjID=f.ObjID,i.MIndex=n,i.SIndex=t,i.ObjWidth=f.W,i.ObjHeight=f.H,i.XAxis=f.X,i.YAxis=f.Y,i.ZAxis=f.Z,i.IIndex=g,i.ObjType=s.ObjType,i.IsDivider="N",i.Object="ITEM",i.MObjID=a.MObjID,i.SObjID=s.SObjID,i.ItemID=f.ItemID,i.Item=f.Item,i.W=f.W,i.H=f.H,i.X=f.X,i.Y=f.Y,i.RW=f.RW,i.Exists="N",i.Rotation=0,i.Slope=0,i.Distance=f.Distance,i.TopObjID=f.TopObjID,i.BottomObjID=f.BottomObjID,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(i),void 0!==t&&void 0!==n&&g_delete_details.length>0){var d=g_pog_json[_].ModuleInfo[n].ShelfInfo[t];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(d)}}g++}}t++}}n++}}if("Y"!=g_all_pog_flag)break;_++}}render_animate_selected()}}logDebug("function : set_item_blink","E")}catch(e){error_handling(e)}}function add_ctrl_select_items(e,_,o,n,t,g,l,i,d){logDebug("function : add_ctrl_select_items; module_index : "+n+"; shelf_index : "+t+"; i_item_index : "+g+"; module_obj_id : "+l+"; i_objectHit_id : "+i,"S");var a="Y";for(const e of g_delete_details)e.ObjID==i&&(a="N");if("Y"==a)if("S"==e){var s="N",f="SHELF";if((p={}).ObjID=o.SObjID,p.ObjWidth=o.W,p.ObjHeight=o.H,p.XAxis=o.X,p.YAxis=o.Y,p.ZAxis=o.Z,p.IIndex=-1,p.W=o.W,p.H=o.H,p.D=o.D,p.X=o.X,p.Y=o.Y,p.ItemID=o.Shelf,p.Item="",p.Distance=-1,p.TopObjID=-1,p.BottomObjID=-1,p.p_pog_index=d,p.MIndex=n,p.SIndex=t,p.ObjType=o.ObjType,p.IsDivider=s,p.Object=f,p.MObjID=l,p.SObjID=o.SObjID,p.Exists="N",p.AllowAutoCrush=o.AllowAutoCrush,p.Rotation=o.Rotation,p.Slope=o.Slope,p.Color=o.Color,p.Combine=o.Combine,p.LOverhang=o.LOverhang,p.ROverhang=o.ROverhang,p.DivHeight=void 0===o.DivHeight?0:o.DivHeight,p.DivWidth=void 0===o.DivWidth?0:o.DivWidth,p.DivPst=void 0===o.DivPst?"N":o.DivPst,p.DivPed=void 0===o.DivPed?"N":o.DivPed,p.DivPbtwFace=void 0===o.DivPbtwFace?"N":o.DivPbtwFace,p.NoDivIDShow=o.NoDivIDShow,p.DivFillCol=void 0===o.DivFillCol?"#3D393D":o.DivFillCol,p.SpreadItem=o.SpreadItem,p.MaxMerch=o.MaxMerch,p.StartCanvas=d,p.FBold=o.FBold,p.FSize=o.FSize,p.FStyle=o.FStyle,p.InputText=o.InputText,p.TextImg=o.TextImg,p.TextImgMime=o.TextImgMime,p.TextImgName=o.TextImgName,p.ReduceToFit=o.ReduceToFit,p.TextDirection=o.TextDirection,p.WrapText=o.WrapText,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(p),void 0!==t&&void 0!==n&&g_delete_details.length>0){var I=g_pog_json[d].ModuleInfo[n].ShelfInfo[t];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(I)}var r=0;for(obj of g_pog_json[d].ModuleInfo[n].ShelfInfo[t].ItemInfo){var p={};s="N",f="ITEM";"DIVIDER"==obj.Item&&(s="Y",f="SHELF"),p.ObjID=obj.ObjID,p.ObjWidth=obj.W,p.ObjHeight=obj.H,p.XAxis=obj.X,p.YAxis=obj.Y,p.ZAxis=obj.Z,p.IIndex=r,p.W=obj.W,p.RW=obj.RW,p.H=obj.H,p.X=obj.X,p.Y=obj.Y,p.ItemID=obj.ItemID,p.Item=obj.Item,p.Distance=obj.Distance,p.TopObjID=obj.TopObjID,p.BottomObjID=obj.BottomObjID,p.p_pog_index=d,p.MIndex=n,p.SIndex=t,p.ObjType=o.ObjType,p.IsDivider=s,p.Object=f,p.MObjID=l,p.SObjID=o.SObjID,p.Exists="N",p.Rotation=0,p.Slope=0,p.StartCanvas=d,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(p),r++}}else{p={},s="N",f="ITEM";if("DIVIDER"==_.Item&&(s="Y",f="SHELF"),p.ObjID=_.ObjID,p.ObjWidth=_.W,p.ObjHeight=_.H,p.XAxis=_.X,p.YAxis=_.Y,p.ZAxis=_.Z,p.IIndex=g,p.W=_.W,p.RW=_.RW,p.H=_.H,p.X=_.X,p.Y=_.Y,p.ItemID=_.ItemID,p.Item=_.Item,p.Distance=_.Distance,p.TopObjID=_.TopObjID,p.BottomObjID=_.BottomObjID,p.p_pog_index=d,p.MIndex=n,p.SIndex=t,p.ObjType=o.ObjType,p.IsDivider=s,p.Object=f,p.MObjID=l,p.SObjID=o.SObjID,p.Exists="N",p.Rotation=0,p.Slope=0,p.Color=o.Color,"Y"==s&&(p.DivHeight=void 0===o.DivHeight?0:o.DivHeight,p.DivWidth=void 0===o.DivWidth?0:o.DivWidth,p.DivPst=void 0===o.DivPst?"N":o.DivPst,p.DivPed=void 0===o.DivPed?"N":o.DivPed,p.DivPbtwFace=void 0===o.DivPbtwFace?"N":o.DivPbtwFace,p.NoDivIDShow=o.NoDivIDShow,p.DivFillCol=void 0===o.DivFillCol?"#3D393D":o.DivFillCol,p.LOverhang=0,p.ROverhang=0,p.MaxMerch=0),p.D=o.D,p.StartCanvas=d,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(p),void 0!==t&&void 0!==n&&g_delete_details.length>0){I=g_pog_json[d].ModuleInfo[n].ShelfInfo[t];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(I)}}logDebug("function : add_ctrl_select_items","E")}async function update_array_xy_distance(e,_,o){new_details=JSON.parse(JSON.stringify(e));for(const e of new_details)e.ShelfInfo="";if(JsonContains(new_details,"Object","SHELF")){var n=0;for(const _ of e)n+=_.W;i=0;var t=0;for(const n of e){update_item_distance(n.MIndex,n.SIndex,n.p_pog_index);var g=0;t=0==i?(g=_)+n.W/2:(g=t+n.W/2)+n.W/2;var l=n.YAxis;e[i].XDistance=wpdSetFixed(g-_),e[i].YDistance=wpdSetFixed(l-o),i+=1}}else{n=0;var d=0;for(const _ of e)n+=_.W,d=Math.max(d,_.H);i=0;t=0;for(const d of e){if(0!==nvl(d.BottomObjID)||0!==nvl(d.TopObjID)){g=d.XAxis,l=d.YAxis;e[i].XDistance=wpdSetFixed(g-_),e[i].YDistance=wpdSetFixed(l-o)}else{var a=0;0==i?t=(g=_-n/2)+d.W/2:("PEGBOARD"==d.ObjType&&(a=.01),t=(g=t+d.W/2+a)+d.W/2);l=d.YAxis;e[i].XDistance=wpdSetFixed(g-_),e[i].YDistance=d.H/2}i+=1}}}async function update_item_xy_distance(e,_,o,n){new_details=JSON.parse(JSON.stringify(g_delete_details));for(const e of new_details)e.ShelfInfo="";if(JsonContains(new_details,"Object","SHELF")){var t=0;for(const e of g_delete_details){update_item_distance(e.MIndex,e.SIndex,g_pog_index);var g=e.XAxis,l=e.YAxis;g_delete_details[t].XDistance=wpdSetFixed(g-o),g_delete_details[t].YDistance=wpdSetFixed(l-n),t+=1}}else{var i=0,d=0;for(const e of g_delete_details)i+=e.W,d=Math.max(d,e.H);t=0;var a=0;for(const e of g_delete_details){if(0!==nvl(e.BottomObjID)||0!==nvl(e.TopObjID)){g=e.XAxis,l=e.YAxis;g_delete_details[t].XDistance=wpdSetFixed(g-o),g_delete_details[t].YDistance=wpdSetFixed(l-n)}else{var s=0;0==t?a=(g=o-i/2)+e.W/2:("PEGBOARD"==e.ObjType&&(s=.01),a=(g=a+e.W/2+s)+e.W/2);l=e.YAxis;g_delete_details[t].XDistance=wpdSetFixed(g-o),g_delete_details[t].YDistance=e.H/2}t+=1}}if("Y"==e)for(const e of g_delete_details){void 0===e.IntoShelf&&(e.IntoShelf="N");var f=!1;for(const _ of g_multi_drag_shelf_arr)if(_.MIndex===e.MIndex&&_.SIndex===e.SIndex){f=!0;break}if("SHELF"!=e.Object||"N"!=e.IsDivider||f)"N"==e.IntoShelf&&(g_multi_drag_item_arr.push(e),"Y"==g_delete_details.multi_carpark_ind?g_multi_drag_item_arr[g_multi_drag_item_arr.length-1].ItemObj=[JSON.parse(JSON.stringify(g_pog_json[_].ModuleInfo[e.MIndex].Carpark[e.SIndex].ItemInfo[e.IIndex]))]:g_multi_drag_item_arr[g_multi_drag_item_arr.length-1].ItemObj=[JSON.parse(JSON.stringify(g_pog_json[_].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex]))]);else{g_multi_drag_shelf_arr.push(e),e.IntoShelf="Y",g_multi_drag_shelf_arr[g_multi_drag_shelf_arr.length-1].ItemInfo=[],j=0;for(const o of g_delete_details){if(e.MIndex==o.MIndex&&e.SIndex==o.SIndex&&"SHELF"!==o.Object){o.IntoShelf="Y";var I=g_pog_json[_].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex].ItemInfo[o.IIndex];g_multi_drag_shelf_arr[g_multi_drag_shelf_arr.length-1].ItemInfo.push(I),"Y"==g_delete_details.multi_carpark_ind?g_delete_details[j].ItemObj=[JSON.parse(JSON.stringify(g_pog_json[_].ModuleInfo[o.MIndex].Carpark[o.SIndex].ItemInfo[o.IIndex]))]:g_delete_details[j].ItemObj=[JSON.parse(JSON.stringify(I))]}j+=1}}}}function doMouseDown(e,_,o,n,t,g,l,i){logDebug("function : doMouseDown; x : "+e+"; y : "+_+"; startX : "+o+"; startY : "+n+"; context_call : "+l,"S");try{if(g_scene_objects.length>0){var d=document.getElementById("t_Header"),a=document.getElementById("t_Body_title"),s=document.getElementById("top_bar"),f=document.getElementById("t_Body_nav"),I=document.getElementById("side_bar"),r=window.devicePixelRatio,p=$(document).scrollTop(),c=$(".t-Region-body").scrollLeft(),u=d.offsetHeight,m=a.offsetHeight,h=s.offsetHeight,S=(f.offsetWidth,I.offsetWidth),O=parseFloat($(".t-Body-contentInner").css("padding-left").replace("px",""))*r;g_global_counter+=1,g_start_coorX=o,g_start_coorY=n,g_taskItemInContext=!0,g_taskItemInContext1=!0,"N"==l&&(g_selection.style.visibility="hidden");var j={},x={};void 0!==g_scene_objects[g_pog_index]&&g_scene_objects.length>0&&(j=g_scene_objects[g_pog_index].scene.children[0],x=g_scene_objects[g_pog_index].scene.children[2]);for(var M=[],T=0,b=g_undo_final_obj_arr.length;T<b;T++)g_undo_final_obj_arr[T][0].length>0&&void 0!==g_undo_final_obj_arr[T][0][0]&&void 0===g_undo_final_obj_arr[T][0][0].CurrCanvas&&M.push(g_undo_final_obj_arr[T]);g_undo_final_obj_arr=M;for(M=[],T=0,b=g_redo_final_obj_arr.length;T<b;T++)void 0!==g_redo_final_obj_arr[T][0][0]&&void 0===g_redo_final_obj_arr[T][0][0].CurrCanvas&&M.push(g_redo_final_obj_arr[T]);g_redo_final_obj_arr=M,g_curr_canvas=g_pog_index,g_start_canvas=g_pog_index,reset_indicators(),"Y"==g_show_item_color&&(g_pog_json[i].GroupingType=g_scene_objects[g_pog_index].Indicators.canvas_color_flag,$s("P25_SELECT_COLOR_TYPE",g_scene_objects[g_pog_index].Indicators.canvas_color_flag));var D=g.width,E=g.height,v=2*e/D-1,N=1-2*_/E;if(g_carpark_item_flag="N",g_carpark_edit_flag="N",g_module_edit_flag="N",g_shelf_edit_flag="N",g_item_edit_flag="N",g_module_index=-1,g_shelf_index=-1,g_module_cnt=-1,g_item_index=-1,g_module_width=-1,comp_obj_id=-1,g_module_X="",g_shelf_max_merch="",g_shelf_basket_spread="",render(g_pog_index),j.updateProjectionMatrix(),g_raycaster.setFromCamera(new THREE.Vector2(v,N),j),g_intersects=g_raycaster.intersectObjects(x.children),console.log(g_intersects),$s("P25_SELECTED_CANVAS",`${g_curr_canvas}`),0==g_intersects.length){if(g_mselect_drag="N",g_multiselect="N",g_ctrl_select="N",g_delete_details=[],$("#draggable_table .product_list_blink").removeClass("product_list_blink"),g_intersected&&g_intersected.length>0){for(T=0;T<g_intersected.length;T++)void 0!==g_intersected[T]&&(void 0!==g_intersected[T].BorderColour&&(g_select_color=g_intersected[T].BorderColour),g_intersected[T].WireframeObj.material.color.setHex(g_intersected[T].BorderColour),"Y"==g_intersected[T].ImageExists&&"Y"==g_show_live_image&&(g_intersected[T].WireframeObj.material.transparent=!0,g_intersected[T].WireframeObj.material.opacity=.0025));clearInterval(g_myVar),g_select_color=0,l_highlightStatus=$v("P25_POGCR_HIGHLIGHT_SEARCHED_ITEM"),(l_highlightStatus="Y")&&find_highlight_frame(),render(g_pog_index)}if(x.add(g_targetForDragging),g_targetForDragging.position.set(0,0,0),render(g_pog_index),g_intersects=g_raycaster.intersectObjects(x.children),g_intersects.length>0){var P=g_intersects[0].point.x,C=g_intersects[0].point.y;g_drag_z=g_intersects[0].point.z,g_drag_z+=.001;var R=new THREE.Vector3(P,C,A);x.worldToLocal(R);v=Math.min(19,Math.max(-19,R.x)),_=Math.min(19,Math.max(-19,R.y));if("N"==l&&(g_DragMouseStart.x=v,g_DragMouseStart.y=_,g_DragMouseEnd.x=v,g_DragMouseEnd.y=_),g_startMouse.x=t.clientX+c-(S+O),g_startMouse.y=t.clientY+p-(m+O+u+h),g_prevMouse.x=v,g_prevMouse.y=_,g_nextMouse=g_prevMouse.clone(),x.remove(g_targetForDragging),g_intersected=[],g_select_zoom_arr=[],"N"!=g_context_opened||t.shiftKey)return!(!t.shiftKey||"Y"!=g_manual_zoom_ind)||("Y"!=g_context_opened||t.shiftKey||(g_mselect_drag="N",g_context_opened="N"),!1);var y=g_startMouse.x,H=g_startMouse.y;return g_selecting=!0,g_selection.style.left=g_startMouse.x+"px",g_selection.style.top=g_startMouse.y+"px",g_selection.style.width=y-g_startMouse.x+"px",g_selection.style.height=H-g_startMouse.y+"px",g_selection.style.visibility="visible",!0}return g_intersected=[],g_select_zoom_arr=[],!1}if(g_intersects.length>0){if("drag_object"==g_intersects[0].object.uuid){var Y=g_intersects[1];g_objectHit=Y.object;P=g_intersects[1].point.x;g_mousedown_locx=g_intersects[1].point.x;C=g_intersects[1].point.y;var A=g_intersects[1].point.z;g_drag_z=g_intersects[1].point.z}else{Y=g_intersects[0];g_objectHit=Y.object;P=g_intersects[0].point.x;g_mousedown_locx=g_intersects[0].point.x;C=g_intersects[0].point.y,A=g_intersects[0].point.z;g_drag_z=g_objectHit.position.z}R=new THREE.Vector3(P,C,A);x.worldToLocal(R);v=Math.min(19,Math.max(-19,R.x)),g_drag_z;g_drag_z+=.001,g_itemDragZ=g_objectHit.position.z,g_itemDragX=g_objectHit.position.x;_=Math.min(19,Math.max(-19,R.y));g_objectHit_uuid=g_objectHit.uuid,g_objectHit_id=g_objectHit.id,T=0;var F,L="N";if("Y"==g_multiselect||"Y"==g_ctrl_select){for(const e of g_delete_details)e.ObjID==g_objectHit_id&&(L="Y");"Y"==L&&(update_item_xy_distance("Y",i,v,_),g_mselect_drag="Y")}else g_mselect_drag="N";if(get_object_identity(g_pog_index,g_multiselect,g_multi_copy_done,v,_),"N"==l&&"N"==g_ctrl_select&&(g_multiselect="N"),-1!==g_module_index&&-1!==g_shelf_index&&update_item_distance(g_module_index,g_shelf_index,g_pog_index),g_ComViewIndex==g_pog_index&&"EDIT_PALLET"==g_compare_view){if(g_intersects.length>0){var B=g_pog_json[g_ComViewIndex].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index];if(void 0!==B&&(""==B.TopObjID||void 0===B.TopObjID))for(const e of g_intersects){for(const _ of g_pog_json[g_ComViewIndex].ModuleInfo){T=0;for(const o of _.ShelfInfo){var w=0;for(const _ of o.ItemInfo){if(_.ObjID==e.object.id){var X=g_scene_objects[g_ComViewIndex].scene.children[2].getObjectById(_.ObjID);"PEGBOARD"!==g_shelf_object_type?X.Distance=_.Distance:(X.PegBoardX=_.PegBoardX,X.PegBoardY=_.PegBoardY),X.ItemInfo=_,X.IIndex=w,X.StartCanvas=g_start_canvas,X.MIndex=g_module_index,X.SIndex=g_shelf_index,X.old_position_x=X.position.x,X.old_position_y=X.position.y,X.old_position_z=X.position.z,g_drag_items_arr.push(X)}w++}T++}0}}}if(0==g_drag_items_arr.length)return!1}if(g_intersects.length>0&&"N"==l&&"Y"!==g_mselect_drag){if(0==t.altKey){if(g_intersected&&g_intersected[0]!=g_intersects[0].object)for(T=0;T<g_intersected.length;T++)void 0!==g_intersected[T]&&(void 0!==g_intersected[T].BorderColour&&(g_select_color=g_intersected[T].BorderColour),g_intersected[T].WireframeObj.material.color.setHex(g_intersected[T].BorderColour),"Y"==g_intersected[T].ImageExists&&"Y"==g_show_live_image&&(g_intersected[T].WireframeObj.material.transparent=!0,g_intersected[T].WireframeObj.material.opacity=.0025));g_intersected=[],g_select_zoom_arr=[],g_intersected.push(g_objectHit)}else if(1==t.altKey&&(g_select_zoom_arr.push(g_objectHit),g_intersected.push(g_objectHit),"Y"==g_item_edit_flag||"Y"==g_shelf_edit_flag)){var G=g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index],W=g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index];add_ctrl_select_items("Y"==g_shelf_edit_flag?"S":"I","Y"==g_shelf_edit_flag?{}:G,W,g_module_index,g_shelf_index,g_item_index,g_pog_json[i].ModuleInfo[g_module_index].MObjID,g_objectHit_id,i),g_ctrl_select="Y",g_multiselect="Y",g_multiItemCopy="Y"}l_highlightStatus=$v("P25_POGCR_HIGHLIGHT_SEARCHED_ITEM"),(l_highlightStatus="Y")&&find_highlight_frame(),render_animate_selected()}else if(g_intersected){for(T=0;T<g_intersected.length;T++)void 0!==g_intersected[T]&&(g_select_color=g_intersected[T].BorderColour,g_intersected[T].WireframeObj.material.color.setHex(g_intersected[T].BorderColour),"Y"!=g_intersected[T].ImageExists||"Y"!=g_show_live_image&&"Y"!=g_show_live_image_comp||(g_intersected[T].WireframeObj.material.transparent=!0,g_intersected[T].WireframeObj.material.opacity=.0025));clearInterval(g_myVar),g_select_color=0,render(g_pog_index)}if(g_pog_index==g_ComViewIndex){if("POG"!==g_compare_view&&"undefined"!=typeof comp_obj_id&&"PREV_VERSION"!==g_compare_view&&"EDIT_PALLET"!==g_compare_view)void 0!==(X=g_scene_objects[g_ComBaseIndex].scene.children[2].getObjectById(comp_obj_id))&&g_intersected.push(X),clearInterval(g_myVar),g_select_color=0,render_animate_selected();else if("POG"==g_compare_view||"PREV_VERSION"==g_compare_view&&0==t.altKey||"EDIT_PALLET"==g_compare_view){var k=get_similar_items(g_objectHit_uuid,"I",g_ComBaseIndex);if(g_intersected=[],k.length>0){for(T=0;T<k.length;T++)g_intersected.push(k[T]);clearInterval(g_myVar),g_select_color=0,render_animate_selected()}}}else if(("Y"==g_module_edit_flag||"Y"==g_shelf_edit_flag||"Y"==g_item_edit_flag)&&g_ComViewIndex>-1&&0==t.altKey)if("POG"!==g_compare_view&&"undefined"!=typeof comp_obj_id&&"Y"==g_compare_pog_flag){if(g_scene_objects[g_ComViewIndex].scene.children[2].children.length>0){X=g_scene_objects[g_ComViewIndex].scene.children[2].getObjectById(comp_obj_id);g_intersected=[],void 0!==X&&g_intersected.push(X),clearInterval(g_myVar),g_select_color=0,render_animate_selected()}}else if("Y"==g_item_edit_flag){k=get_similar_items(g_objectHit_uuid,"I",g_ComViewIndex);if(g_intersected=[],k.length>0){for(T=0;T<k.length;T++)g_intersected.push(k[T]);clearInterval(g_myVar),g_select_color=0,render_animate_selected()}}if(g_drag_x=g_module_X,"Y"==g_shift_mutli_item_select&&-1!==g_item_index)(F="Y"==g_carpark_item_flag?g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index]:g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index]).isCarpark=g_carpark_item_flag,$.isEmptyObject(g_shift_multi_item_first)?g_shift_multi_item_first=F:g_shift_multi_item_last=F;if(-1!==g_shelf_index&&-1!==g_module_index)update_item_distance(g_module_index,g_shelf_index,g_pog_index);if(render(g_pog_index),0===nvl(g_pog_json)||"PREV_VERSION"===g_compare_view||"Y"!=g_item_edit_flag&&"Y"!=g_shelf_edit_flag||backupPog("S",g_shelf_index,g_module_index,g_pog_index),"Y"==g_carpark_edit_flag||"Y"==g_shelf_edit_flag&&g_pog_index==g_ComViewIndex&&"EDIT_PALLET"==g_compare_view)return!1;if(g_pog_index==g_ComViewIndex&&"EDIT_PALLET"!==g_compare_view&&"PREV_VERSION"!==g_compare_view)return!1;if("Y"==g_module_edit_flag||-1!==g_module_obj_array.indexOf(g_objectHit)||g_objectHit_uuid.match(/BASE.*/)||g_objectHit_uuid.match(/NOTCH.*/)){if("N"==g_auto_fill_active)t.ctrlKey&&"Y"==g_module_edit_flag?(context_copy("S",i),g_duplicating="Y"):t.ctrlKey&&"Y"==g_item_edit_flag&&(context_copy("S",i),g_duplicating="Y",g_dupShelfDepth=g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].D);else if("Y"==g_auto_fill_active&&g_mod_block_list.length>0){var V=function(e){try{if("undefined"==typeof g_raycaster)return!1;for(const t of g_mod_block_list)if(t.BlkName===e){var _=t.BlockDim&&t.BlockDim.ColorObj?t.BlockDim.ColorObj:null;if(!_)return!1;var o=_.getObjectByProperty("uuid",e);if(!o)return!1;var n=g_raycaster.intersectObject(o,!0);return n&&n.length>0}}catch(e){return!1}return!1};for(colorObj of g_mod_block_list)if(colorObj.mod_index[0]==g_module_index&&V(colorObj.BlkName)){var U=colorObj.BlkName,z=colorObj.BlockDim.ColorObj;return g_dragItem=z.getObjectByProperty("uuid",U),!0}}if("N"==g_context_opened){g_startMouse.x=t.clientX+c-(S+O),g_startMouse.y=t.clientY+p-(m+O+u+h),g_prevMouse.x=v,g_prevMouse.y=_,g_nextMouse=g_prevMouse.clone(),g_DragMouseStart.x=v,g_DragMouseStart.y=_,g_DragMouseEnd.x=v,g_DragMouseEnd.y=_;y=g_startMouse.x+1,H=g_startMouse.y+1;if(t.shiftKey||(g_selecting=!0,g_selection.style.left=g_startMouse.x+"px",g_selection.style.top=g_startMouse.y+"px",g_selection.style.width=y-g_startMouse.x+"px",g_selection.style.height=H-g_startMouse.y+"px",g_selection.style.visibility="visible"),g_intersected){for(T=0;T<g_intersected.length;T++)void 0!==g_intersected[T]&&(g_select_color=g_intersected[T].BorderColour,g_intersected[T].WireframeObj.material.color.setHex(g_intersected[T].BorderColour),"Y"==g_intersected[T].ImageExists&&"Y"==g_show_live_image&&(g_intersected[T].WireframeObj.material.transparent=!0,g_intersected[T].WireframeObj.material.opacity=.0025));clearInterval(g_myVar),g_select_color=0,render(g_pog_index),g_intersected=[],g_select_zoom_arr=[]}if(g_select_zoom_arr.push(g_objectHit),g_intersected.push(g_objectHit),g_pog_index==g_ComViewIndex&&"Y"==g_module_edit_flag&&"undefined"!=typeof comp_obj_id)void 0!==(X=g_scene_objects[g_ComViewIndex].scene.children[2].getObjectById(comp_obj_id))&&g_intersected.push(X);else if("Y"==g_module_edit_flag&&"Y"==g_compare_pog_flag&&"undefined"!=typeof comp_obj_id){if(g_scene_objects[g_ComViewIndex].scene.children[2].children.length>0)void 0!==(X=g_scene_objects[i].scene.children[2].getObjectById(comp_obj_id))&&g_intersected.push(X)}else if(g_objectHit_uuid.match(/BASE.*/)&&"Y"==g_compare_pog_flag&&void 0!==g_pog_json[i].CompBaseObjID){void 0!==(X=g_scene_objects[g_ComViewIndex].scene.children[2].getObjectById(g_pog_json[i].CompBaseObjID))&&g_intersected.push(X)}return render_animate_selected(),!0}return!1}if("N"==g_auto_fill_active){if(g_dragItem=g_objectHit,"N"==g_chest_move&&"CHEST"==g_shelf_object_type&&"Y"==g_shelf_edit_flag&&"Y"==g_chest_as_pegboard){g_startMouse.x=t.clientX+c-(S+O),g_startMouse.y=t.clientY+p-(m+O+u+h),g_prevMouse.x=v,g_prevMouse.y=_,g_nextMouse=g_prevMouse.clone(),g_DragMouseStart.x=v,g_DragMouseStart.y=_,g_DragMouseEnd.x=v,g_DragMouseEnd.y=_;y=g_startMouse.x+1,H=g_startMouse.y+1;t.shiftKey||(g_selecting=!0,g_selection.style.left=g_startMouse.x+"px",g_selection.style.top=g_startMouse.y+"px",g_selection.style.width=y-g_startMouse.x+"px",g_selection.style.height=H-g_startMouse.y+"px",g_selection.style.visibility="visible")}else{if("Y"==g_shelf_edit_flag&&"DIVIDER"!==g_shelf_object_type&&"TEXTBOX"!==g_shelf_object_type){g_dragItem.ShelfInfo=g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index],g_dragItem.StartCanvas=g_start_canvas,g_dragItem.MIndex=g_module_index,g_dragItem.SIndex=g_shelf_index;w=0;for(const e of g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo){void 0!==(X=x.getObjectById(e.ObjID))&&("PEGBOARD"!==g_shelf_object_type?X.Distance=e.Distance:(X.PegBoardX=e.PegBoardX,X.PegBoardY=e.PegBoardY),X.ItemInfo=e,X.IIndex=w,X.StartCanvas=g_start_canvas,X.MIndex=g_module_index,X.SIndex=g_shelf_index,g_drag_items_arr.push(X)),w++}}else"Y"==g_item_edit_flag?(g_dragItem.ItemInfo=g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index],g_dragItem.MIndex=g_module_index,g_dragItem.SIndex=g_shelf_index,g_dragItem.IIndex=g_item_index,g_dragItem.StartCanvas=g_start_canvas):"Y"==g_shelf_edit_flag&&(g_dragItem.ShelfInfo=g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index],g_dragItem.StartCanvas=g_start_canvas,g_dragItem.MIndex=g_module_index,g_dragItem.SIndex=g_shelf_index);t.ctrlKey&&"Y"==g_shelf_edit_flag?(context_copy("S",i),g_duplicating="Y",render_animate_selected()):t.ctrlKey&&"Y"==g_item_edit_flag&&(context_copy("S",i),g_duplicating="Y",g_dupShelfDepth=g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].D,render_animate_selected())}if("N"==l)return!0}}else if(g_intersected){for(T=0;T<g_intersected.length;T++)void 0!==g_intersected[T]&&(g_select_color=g_intersected[T].BorderColour,g_intersected[T].WireframeObj.material.color.setHex(g_intersected[T].BorderColour),"Y"==g_intersected[T].ImageExists&&"Y"==g_show_live_image&&(g_intersected[T].WireframeObj.material.transparent=!0,g_intersected[T].WireframeObj.material.opacity=.0025));clearInterval(g_myVar),g_select_color=0,render(g_pog_index),g_intersected=[],g_select_zoom_arr=[]}logDebug("function : doMouseDown","E")}}catch(e){error_handling(e)}}async function doMouseMove(p_x,p_y,p_event,p_prevX,p_prevY,p_canvas,p_camera,p_jselector,p_pog_index){try{if(g_present_canvas=parseInt(p_pog_index),g_taskItemInContext=!0,"CANVAS"==p_event.target.nodeName){var canvas_drag=p_event.target;p_jselector=canvas_drag.getAttribute("id");var p_index=parseInt(canvas_drag.getAttribute("data-indx")),width=canvas_drag.width,height=canvas_drag.height,a=2*p_x/width-1,b=1-2*p_y/height,yaxis=p_y;if(p_index>-1&&void 0!==g_scene_objects[p_index]?(p_camera=g_scene_objects[p_index].scene.children[0],new_world=g_scene_objects[p_index].scene.children[2]):new_world=g_world,p_camera.updateProjectionMatrix(),g_raycaster.setFromCamera(new THREE.Vector2(a,b),p_camera),g_intersects=g_raycaster.intersectObjects(new_world.children),g_dragging&&"N"==g_duplicating){g_pog_index=p_pog_index,p_canvas=canvas_drag,g_raycaster.setFromCamera(new THREE.Vector2(a,b),p_camera),g_intersects=g_raycaster.intersectObject(g_targetForDragging);var z=g_drag_z,locationX=g_intersects[0].point.x,locationY=g_intersects[0].point.y,locationZ=g_intersects[0].point.z,coords=new THREE.Vector3(locationX,locationY,locationZ);if(new_world.worldToLocal(coords),a=Math.min(19,Math.max(-19,coords.x)),p_y=Math.min(19,Math.max(-19,coords.y)),g_intersected){for(var i=0;i<g_intersected.length;i++)void 0!==g_intersected[i]&&(g_select_color=g_intersected[i].BorderColour,void 0!==g_intersected[i].WireframeObj&&(g_intersected[i].WireframeObj.material.color.setHex(g_select_color),"Y"==g_intersected[i].ImageExists&&"Y"==g_show_live_image&&(g_intersected[i].WireframeObj.material.transparent=!0,g_intersected[i].WireframeObj.material.opacity=.0025)));clearInterval(g_myVar),g_select_color=0,render(p_pog_index)}var header=document.getElementById("t_Header"),breadcrumb=document.getElementById("t_Body_title"),top_bar=document.getElementById("top_bar"),side_nav=document.getElementById("t_Body_nav"),button_cont=document.getElementById("side_bar"),devicePixelRatio=window.devicePixelRatio,scroll_top=$(document).scrollTop(),scroll_left=$(".t-Region-body").scrollLeft(),padding=parseFloat($(".t-Body-contentInner").css("padding-left").replace("px",""))*devicePixelRatio,header_height=header.offsetHeight,breadcrumb_height=breadcrumb.offsetHeight,top_bar_height=top_bar.offsetHeight,side_nav_width=side_nav.offsetWidth,btn_cont_width=button_cont.offsetWidth;g_mouse.x=p_event.clientX+scroll_left-(btn_cont_width+padding),g_mouse.y=p_event.clientY+scroll_top-(breadcrumb_height+padding+header_height+top_bar_height);var x1=g_startMouse.x,x2=g_mouse.x,y1=g_startMouse.y,y2=g_mouse.y;if(x1>x2){var tmp1=x1;x1=x2,x2=tmp1}if(y1>y2){var tmp2=y1;y1=y2,y2=tmp2}if(g_selecting&&(g_multiselect="Y",g_DragMouseEnd.x=a,g_DragMouseEnd.y=p_y,g_selection.style.left=x1+"px",g_selection.style.top=y1+"px",g_selection.style.width=x2-x1-20+"px",g_selection.style.height=y2-y1+"px"),g_DragMouseEnd.x=a,g_DragMouseEnd.y=p_y,p_event.shiftKey&&"Y"==g_manual_zoom_ind)g_grabbing_progress="Y",$(p_jselector).css("cursor","grabbing"),g_prevMouse=g_nextMouse,g_nextMouse.x=a,g_nextMouse.y=p_y,grab_interval=parseFloat($v("P25_POGCR_GRAB_INTERVAL")),p_x>p_prevX&&p_camera.position.set(p_camera.position.x-grab_interval,p_camera.position.y,p_camera.position.z),p_x<p_prevX&&p_camera.position.set(p_camera.position.x+grab_interval,p_camera.position.y,p_camera.position.z),yaxis>p_prevY&&p_camera.position.set(p_camera.position.x,p_camera.position.y+grab_interval,p_camera.position.z),yaxis<p_prevY&&p_camera.position.set(p_camera.position.x,p_camera.position.y-grab_interval,p_camera.position.z),render(p_pog_index);else if("Y"==g_mselect_drag&&g_curr_canvas==g_present_canvas){var i=0;for(const e of g_delete_details){var selectObjects=new_world.getObjectById(e.ObjID);if(void 0!==selectObjects&&(selectObjects.WireframeObj.material.color.setHex(0),"PEGBOARD"==e.ObjType||"CHEST"==e.ObjType&&"Y"==g_chest_as_pegboard?selectObjects.position.set(a+e.XDistance,p_y-e.YDistance,g_drag_z):selectObjects.position.set(a+e.XDistance,p_y+e.YDistance,g_drag_z),selectObjects.updateMatrix(),"SHELF"==e.Object&&"N"==e.IsDivider&&0!==e.Rotation)){g_scene.updateMatrixWorld();var slope=0;slope=e.Slope>0?0-e.Slope:-e.Slope,selectObjects.quaternion.copy(p_camera.quaternion),selectObjects.lookAt(g_pog_json[p_pog_index].CameraX,g_pog_json[p_pog_index].CameraY,g_pog_json[p_pog_index].CameraZ),selectObjects.rotateY(e.Rotation*Math.PI/180),"TEXTBOX"==e.ObjType&&0==e.Rotation?selectObjects.rotateX(slope/2*Math.PI/180):selectObjects.rotateX(slope*Math.PI/180),selectObjects.updateMatrix(),g_scene.updateMatrixWorld(),await set_all_items(e.MIndex,e.SIndex,a+e.XDistance,p_y+e.YDistance,"Y","N","N",p_pog_index,p_pog_index),await update_rotate_shelfs(p_pog_index)}i++}render(p_pog_index)}else if(0==g_selecting&&"undefined"!=typeof g_dragItem)if("N"==g_auto_fill_active&&("Y"==g_compare_pog_flag&&g_start_canvas==g_ComViewIndex&&g_present_canvas==g_ComViewIndex&&"PREV_VERSION"==g_compare_view||"PREV_VERSION"!=g_compare_view||g_start_canvas!=g_ComViewIndex&&g_present_canvas!=g_ComViewIndex))if(g_curr_canvas!==g_present_canvas&&"N"==g_carpark_item_flag&&("Y"==g_compare_pog_flag&&parseInt(g_present_canvas)==g_ComViewIndex&&"POG"==g_compare_view||"N"==g_compare_pog_flag||"Y"==g_compare_pog_flag&&parseInt(g_present_canvas)!==g_ComViewIndex)){g_canvas_drag="Y";var new_world=g_scene_objects[g_present_canvas].scene.children[2],remove_world=g_scene_objects[g_curr_canvas].scene.children[2],remove_renderer=g_scene_objects[g_curr_canvas].renderer,remove_scene=g_scene_objects[g_curr_canvas].scene,remove_camera=remove_scene.children[0],image_ind=g_show_live_image;if("N"==g_mselect_drag){if("Y"==g_item_edit_flag){async function create_item(){g_world=g_scene_objects[g_present_canvas].scene.children[2];var[e,_]=await create_drag_objects(g_module_index,g_shelf_index,g_item_index,g_dragItem.ShelfInfo,g_dragItem.ItemInfo,image_ind,"ITEM",g_dragItem,g_start_canvas,g_present_canvas);e.position.x=a,e.position.y=p_y,e.position.z=z,remove_world.remove(g_dragItem),render(g_curr_canvas),g_dragItem=e,g_curr_canvas=g_present_canvas,g_canvas_drag="Y",g_drag_inprogress="Y",g_dragItem.updateMatrix()}create_item()}else if("Y"==g_shelf_edit_flag){async function create_obj(){g_world=g_scene_objects[g_present_canvas].scene.children[2];var[e,_]=await create_drag_objects(g_module_index,g_shelf_index,g_item_index,g_dragItem.ShelfInfo,g_dragItem.ItemInfo,image_ind,"SHELF",g_dragItem,g_start_canvas,g_present_canvas);remove_world.remove(g_dragItem),g_dragItem=e;var o=g_curr_canvas;g_curr_canvas=g_present_canvas,g_canvas_drag="Y",g_drag_inprogress="Y",g_dragItem.updateMatrix();var n=[];if(g_drag_items_arr.length>0){for(const o of g_drag_items_arr){remove_world.remove(o);var[e,_]=await create_drag_objects(g_module_index,g_shelf_index,o.IIndex,o.ShelfInfo,o.ItemInfo,image_ind,"ITEM",o,g_start_canvas,g_present_canvas);n.push(e)}n.length>0&&(g_drag_items_arr=[],g_drag_items_arr=n),await set_inter_canvas_items(a,p_y,g_dragItem,n,g_dragItem.W,g_dragItem.H,g_shelf_object_type,g_shelf_basket_spread,g_dragItem.Rotation,g_dragItem.ItemSlope,g_shelf_index,g_module_index,g_start_canvas)}render(o)}await create_obj()}}else{var j=-1,return_obj,newObjId,old_canvas=g_curr_canvas;g_world=g_scene_objects[g_present_canvas].scene.children[2];for(const _ of g_multi_drag_item_arr){async function create_item(){var e=g_pog_json[g_start_canvas].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex],o=g_pog_json[g_start_canvas].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[_.IIndex].ObjID,n=remove_world.getObjectById(o);[return_obj,newObjId]=await create_drag_objects(_.MIndex,_.SIndex,_.IIndex,e,e.ItemInfo[_.IIndex],image_ind,"ITEM",n,g_start_canvas,g_present_canvas),void 0!==n&&(n.position.set(a+_.XDistance,p_y+_.YDistance,g_drag_z),n.updateMatrix()),return_obj.position.x=a,return_obj.position.y=p_y,return_obj.position.z=z,remove_world.remove(n),g_dragItem=return_obj,g_curr_canvas=g_present_canvas,g_canvas_drag="Y",g_drag_inprogress="Y",g_dragItem.updateMatrix()}j++,await create_item();var item_Details=g_pog_json[g_start_canvas].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo;for(const o of item_Details){var tier_ind;if(void 0!==o.TopObjID&&""!==o.TopObjID||void 0!==o.BottomObjID&&""!==o.BottomObjID)tier_ind=""!==o.TopObjID&&void 0!==o.TopObjID?"BOTTOM":"TOP",await reset_top_bottom_obj_id(tier_ind,o.OldObjID,o.ObjID,o.X,"N",g_start_canvas)}k=0;for(const n of g_delete_details)n.ObjID==g_multi_drag_item_arr[j].ObjID&&(g_delete_details[k].OldObjID=g_delete_details[j].ObjID,g_delete_details[k].ObjID=newObjId),k++;g_multi_drag_item_arr[j].OldObjID=g_multi_drag_item_arr[j].ObjID,g_multi_drag_item_arr[j].ObjID=newObjId,g_pog_json[g_start_canvas].ModuleInfo[_.MIndex].ShelfInfo[_.SIndex].ItemInfo[_.IIndex].ObjID=newObjId}var j=-1;for(const t of g_multi_drag_shelf_arr){async function create_obj(){var e=g_pog_json[g_start_canvas].ModuleInfo[t.MIndex].ShelfInfo[t.SIndex],_=remove_world.getObjectById(t.ObjID);[n,newObjId]=await create_drag_objects(t.MIndex,t.SIndex,t.IIndex,e,e.ItemInfo,image_ind,"SHELF",_,g_start_canvas,g_present_canvas),remove_world.remove(_),_=n,g_canvas_drag="Y",g_drag_inprogress="Y",_.updateMatrix();g_drag_items_arr=[],$.each(t.ItemInfo,(function(e,_){var o=remove_world.getObjectById(_.ObjID);"CHEST"==g_shelf_object_type&&"Y"==g_chest_as_pegboard?(o.PegBoardX=_.PegBoardX,o.PegBoardY=_.PegBoardY):"PEGBOARD"!==g_shelf_object_type?o.Distance=_.Distance:(o.PegBoardX=_.PegBoardX,o.PegBoardY=_.PegBoardY),o.ItemInfo=_,o.IIndex=e,o.StartCanvas=g_curr_canvas,o.MIndex=t.MIndex,o.SIndex=t.SIndex,g_drag_items_arr.push(o)}));var o=[];if(g_drag_items_arr.length>0){for(const _ of g_drag_items_arr){remove_world.remove(_);var[n,g]=await create_drag_objects(t.MIndex,t.SIndex,_.IIndex,e,_.ItemInfo,image_ind,"ITEM",_,g_start_canvas,g_present_canvas);o.push(n);var l=0;for(const e of g_delete_details)e.ObjID==_.id&&(g_delete_details[l].OldObjID=_.id,g_delete_details[l].ObjID=g),l++;_.ItemInfo.ObjID=g,g_pog_json[g_start_canvas].ModuleInfo[t.MIndex].ShelfInfo[t.SIndex].ItemInfo[_.IIndex].ObjID=g}o.length>0&&(g_drag_items_arr=[],g_drag_items_arr=o),await set_inter_canvas_items(a,p_y,_,o,_.W,_.H,g_shelf_object_type,g_shelf_basket_spread,_.Rotation,_.ItemSlope,t.SIndex,t.MIndex,g_start_canvas)}}j++,await create_obj(),l=0;for(const g of g_delete_details)g.ObjID==g_multi_drag_shelf_arr[j].ObjID&&(g_delete_details[l].OldObjID=g_delete_details[j].ObjID,g_delete_details[l].ObjID=newObjId),l++;g_multi_drag_shelf_arr[j].OldObjID=g_multi_drag_shelf_arr[j].ObjID,g_multi_drag_shelf_arr[j].ObjID=newObjId,g_pog_json[g_start_canvas].ModuleInfo[t.MIndex].ShelfInfo[t.SIndex].SObjID=newObjId}render(g_curr_canvas),render(old_canvas),g_curr_canvas=g_present_canvas}render(p_pog_index)}else if("Y"==g_compare_pog_flag&&g_present_canvas==g_ComViewIndex&&"PREV_VERSION"==g_compare_view||"Y"==g_compare_pog_flag&&g_start_canvas==g_ComViewIndex&&"EDIT_PALLET"==g_compare_view||"N"==g_compare_pog_flag||"Y"==g_compare_pog_flag&&g_start_canvas!==g_ComViewIndex&&"N"==g_carpark_item_flag){if(g_drag_inprogress="Y",0==g_intersects.length)return;if(("PEGBOARD"==g_shelf_object_type||"CHEST"==g_shelf_object_type&&"Y"==g_chest_as_pegboard)&&"Y"==g_shelf_edit_flag&&(g_drag_z=.00115),"Y"==g_compare_pog_flag&&"EDIT_PALLET"==g_compare_view&&g_present_canvas==g_ComViewIndex)for(const d of g_drag_items_arr)d.position.set(a,p_y,d.position.z);else if("TEXTBOX"==g_shelf_object_type&&"Y"==g_shelf_edit_flag)g_dragItem.position.set(a,p_y);else{if(g_present_canvas===g_ComViewIndex&&(g_present_canvas!=g_ComViewIndex||"PREV_VERSION"!=g_compare_view))return!1;g_dragItem.position.set(a,p_y,g_drag_z)}if(g_dragItem.updateMatrix(),"Y"!=g_shelf_edit_flag&&"Y"!=g_item_edit_flag||"N"!=g_canvas_drag){if("Y"==g_shelf_edit_flag){var new_pogjson=g_pog_json;await set_inter_canvas_items(a,p_y,g_dragItem,g_drag_items_arr,g_dragItem.W,g_dragItem.H,g_shelf_object_type,g_shelf_basket_spread,g_dragItem.Rotation,g_dragItem.ItemSlope,g_shelf_index,g_module_index,g_start_canvas)}}else await set_all_items(g_module_index,g_shelf_index,a,p_y,g_shelf_edit_flag,"N","N",g_curr_canvas,g_curr_canvas);"Y"==g_shelf_edit_flag&&0!==g_rotation&&(g_dragItem.quaternion.copy(p_camera.quaternion),g_dragItem.lookAt(g_pog_json[g_curr_canvas].CameraX,g_pog_json[g_curr_canvas].CameraY,g_pog_json[g_curr_canvas].CameraZ),g_dragItem.rotateY(g_rotation*Math.PI/180),"TEXTBOX"==g_pog_json[g_curr_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType&&0==g_rotation?g_dragItem.rotateX(g_slope/2*Math.PI/180):g_dragItem.rotateX(g_slope*Math.PI/180),g_dragItem.updateMatrix()),render(p_pog_index)}else g_scene_objects[g_curr_canvas].scene.children[2].remove(g_dragItem),render(g_curr_canvas);else if("Y"==g_auto_fill_active){if(g_drag_inprogress="Y",0==g_intersects.length)return;var z=g_dragItem.position.z;a-=g_pog_json[g_start_canvas].ModuleInfo[g_module_index].X,p_y-=g_pog_json[g_start_canvas].ModuleInfo[g_module_index].Y,g_dragItem.position.set(a,p_y,z),g_dragItem.updateMatrix(),render(p_pog_index)}}else{g_selecting&&(g_selecting=!1,g_selection.style.visibility="hidden"),"Y"==g_duplicating&&(g_drag_inprogress="Y");var $doc=$(document),$win=$(window),$this=$("#object_info"),offset=$this.offset(),dTop=offset.top-$doc.scrollTop(),dBottom=$win.height()-dTop-$this.height(),dLeft=offset.left-$doc.scrollLeft(),dRight=$win.width()-dLeft-$this.width(),fieldValue,contextElement=document.getElementById("object_info");$("#object_info").contents().filter((function(){return 3==this.nodeType})).remove();var append_detail="",valid_width=0,lines_arry=[],divider=" | ";if(g_intersects.length>0&&void 0!==g_intersects[0].object.ItemID&&""!==g_intersects[0].object.ItemID&&"DIVIDER"!==g_intersects[0].object.ItemID){var desc_list_arr=$v("P25_POGCR_ITEM_DESC_LIST").split(":"),i=0,sorto={Seq:"asc"};g_status_bar.keySort(sorto);var SalesInfo=get_sales_info(p_pog_index,g_intersects[0].object.ItemID),SalesInfoList=["LeadTime","SalesAmt","VRM","GP","BEI","MarkDown","ShrinkageAmt","SalesUnit","SalesPerWeek","SalesUnitPerWeek","NonShrinkageAmt","ASP","VRMPer","GPPer","BEIPer","MarkDownPer","ShrinkageAmtPer","DOS","AvgSalesPerWeek","AvgQtyPerWeek","SalesPartPer","QtyPartPer","NoOfListing","TotalShrinkageAmtPer","WeeklySales","WeeklyQty","NetMarginPercent","AUR"],browserWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;for(const obj of g_status_bar){var line_width=0,divider=i>0?" | ":"";if(desc_list_arr.includes(obj.Param)&&"I"==obj.label_type){if(SalesInfoList.includes(obj.Map))"DOS"==obj.Map?(fieldValue=g_intersects[0].object.HorizFacing*g_intersects[0].object.VertFacing*g_intersects[0].object.DFacing*parseInt(1==g_intersects[0].object.MerchStyle?g_intersects[0].object.UnitperTray:2==g_intersects[0].object.MerchStyle?g_intersects[0].object.UnitperCase:1)/(SalesInfo.SalesUnitPerWeek/7),fieldValue=isNaN(fieldValue)||!isFinite(fieldValue)?0:parseFloat(fieldValue.toFixed(1))):fieldValue="SalesUnitPerWeek"==obj.Map?SalesInfo.SalesUnitPerWeek+" "+g_msg_unit:"SalesPerWeek"==obj.Map?g_msg_dollar+SalesInfo.SalesPerWeek:"TotalShrinkageAmtPer"==obj.Map?SalesInfo.TotalShrinkageAmtPer:"ASP"==obj.Map?g_msg_dollar+SalesInfo.ASP:eval("SalesInfo."+obj.Map);else if("COS"==obj.Map){var item_capacity=g_intersects[0].object.HorizFacing*g_intersects[0].object.VertFacing*g_intersects[0].object.DFacing*parseInt(1==g_intersects[0].object.MerchStyle?g_intersects[0].object.UnitperTray:2==g_intersects[0].object.MerchStyle?g_intersects[0].object.UnitperCase:1)+g_intersects[0].object.CapFacing*g_intersects[0].object.CapDepth*g_intersects[0].object.CapHorz*parseInt(1==g_intersects[0].object.CapMerch?g_intersects[0].object.UnitperTray:1);fieldValue=item_capacity/parseInt(g_intersects[0].object.SizeDesc.split("*")[1]),fieldValue=isNaN(fieldValue)||!isFinite(fieldValue)?0:parseFloat(fieldValue.toFixed(1))+" ("+item_capacity+" "+g_msg_unit+")"}else"TotalUnits"==obj.Map?fieldValue=g_intersects[0].object.HorizFacing*g_intersects[0].object.VertFacing*g_intersects[0].object.DFacing*parseInt(1==g_intersects[0].object.MerchStyle?g_intersects[0].object.UnitperTray:2==g_intersects[0].object.MerchStyle?g_intersects[0].object.UnitperCase:1)+g_intersects[0].object.CapFacing*g_intersects[0].object.CapDepth*g_intersects[0].object.CapHorz*parseInt(1==g_intersects[0].object.CapMerch?g_intersects[0].object.UnitperTray:1):"OOSPerc"==obj.Map&&"undefined"!==g_intersects[0].object.OOSPerc&&""!==g_intersects[0].object.OOSPerc?fieldValue=g_intersects[0].object.OOSPerc+"%":"Y"!=$v("P25_POGCR_REFRESH_SALES_WTCCN")||"NetMarginPercent"!=obj.Map&&"WeeklySales"!=obj.Map&&"WeeklyQty"!=obj.Map&&"AUR"!=obj.Map&&"WeeklyNetMargin"!=obj.Map?fieldValue=getFieldValue(g_intersects[0].object,obj.Map,"I"):"NetMarginPercent"==obj.Map&&"undefined"!==SalesInfo.netmarginpercent&&""!==SalesInfo.netmarginpercent?fieldValue=SalesInfo.netmarginpercent+"%":"WeeklySales"==obj.Map&&"undefined"!==SalesInfo.weeklysales&&""!==SalesInfo.weeklysales?fieldValue=SalesInfo.weeklysales:"WeeklyQty"==obj.Map&&"undefined"!==SalesInfo.weeklyqty&&""!==SalesInfo.weeklyqty?fieldValue=SalesInfo.weeklyqty:"AUR"==obj.Map&&"undefined"!==SalesInfo.AUR&&""!==SalesInfo.AUR?fieldValue=SalesInfo.AUR:"WeeklyNetMargin"==obj.Map&&"undefined"!==SalesInfo.WeeklyNetMargin&&""!==SalesInfo.WeeklyNetMargin&&(fieldValue=SalesInfo.WeeklyNetMargin);void 0!==fieldValue&&(line_width=(" | : "+obj.label+": <span>"+fieldValue+"</span>").visualLength("ruler")),valid_width+line_width>browserWidth&&(append_detail+="<br>",lines_arry.push(valid_width),valid_width=0),append_detail=append_detail+divider+obj.label+': <span style="color:yellow">'+fieldValue+"</span>",valid_width+=line_width}i++}}else if(g_intersects.length>0&&void 0!==g_intersects[0].object.FixelID&&""!==g_intersects[0].object.FixelID&&void 0!==g_pog_json[p_pog_index])var[lines_arry,append_detail]=get_status_bar_lines($v("P25_POGCR_FIXEL_DESC_LIST"),"F",contextElement,g_intersects[0].object,p_pog_index);else if(g_intersects.length>0&&void 0!==g_intersects[0].object.Module&&""!==g_intersects[0].object.Module&&void 0!==g_pog_json[p_pog_index])var[lines_arry,append_detail]=get_status_bar_lines($v("P25_POGCR_MODULE_DESC_LIST"),"M",contextElement,g_intersects[0].object,p_pog_index);else if("undefined"!=typeof g_pog_json&&g_pog_json.length>0&&(g_taskItemInContext||g_taskItemInContext1)&&void 0!==g_pog_json[p_pog_index])var[lines_arry,append_detail]=get_status_bar_lines($v("P25_POGCR_POG_DESC_LIST"),"P",contextElement,"",p_pog_index);else contextElement.classList.remove("active");if("Y"==g_compare_pog_flag&&"PREV_VERSION"==g_compare_view&&(append_detail=append_detail+'<br>Version Compare color details : <span style="color:#80ff80">Added Product</span> '+divider+' <span style="color:#8080ff">Retain Product with position change</span> '+divider+' <span style="color:#FFFFFF">Retain with no change</span> '+divider+' <span style="color:#ff6666">Deleted Product</span> '+divider+' <span style="color:#808080">New Products</span>'),g_intersects.length>0)if(void 0!==g_intersects[0].object.ItemID&&""!==g_intersects[0].object.ItemID&&"DIVIDER"!==g_intersects[0].object.ItemID){var height=append_detail.visualHeight("ruler")+12,buffer_width=desc_list_arr.length>7?150:50;if(lines_arry.length>0)var width=Math.max.apply(Math,lines_arry)+buffer_width;else var width=append_detail.visualLength("ruler")+buffer_width}else var height=append_detail.visualHeight("ruler")+7,width=append_detail.visualLength("ruler")+50;else var height=append_detail.visualHeight("ruler")+7,width=append_detail.visualLength("ruler")+50;$("#object_info").html(append_detail),contextElement.style.top=window.innerHeight-$this.height()+"px",contextElement.style.width=browserWidth+"px",contextElement.style.height=height+5+"px",contextElement.style.fontSize="larger",contextElement.style.fontFamily="Tahoma",contextElement.style.left="0px";var canvasHolderH=$("#canvas-list-holder").height(),canvasHolderTop=window.innerHeight-$this.height()-canvasHolderH;$("#canvas-list-holder").css("top",canvasHolderTop+"px")}}else g_selecting&&(g_selecting=!1,g_selection.style.visibility="hidden",g_dragging=!1)}catch(s){error_handling(s)}}function get_status_bar_lines(e,_,o,n,t){var g=e.split(":"),l=0,i="",d=[],a=0;g_status_bar.keySort({Seq:"asc"});for(const e of g_status_bar){var s=0,f=l>0?" | ":"";let o=e.label,I=sessionStorage.getItem("new_pog_ind");if(g.includes(e.Param)&&e.label_type==_)if("Y"===I&&"POG_DRAFT_VERSION"===e.Param){o=get_message("POGCR_DRAFT_VERSION");let _=g_pog_json[t][e.Map];void 0!==_&&(i+=f+o+': <span style="color:yellow">'+_+"</span>",s=(" | : "+o+":"+_).visualLength("ruler"))}else if("N"===I&&"POG_VERSION"===e.Param){o=get_message("POGCR_POG_VERSION");let _=g_pog_json[t][e.Map];void 0!==_&&(i+=f+o+': <span style="color:yellow">'+_+"</span>",s=(" | : "+o+":"+_).visualLength("ruler"))}else if("POG_VERSION"!==e.Param&&"POG_DRAFT_VERSION"!==e.Param){let g;g=void 0!==n&&""!==n?getFieldValue(n,e.Map,_):g_pog_json[t][e.Map],void 0!==g&&(i+=f+o+': <span style="color:yellow">'+g+"</span>",s=(" | : "+o+":"+g).visualLength("ruler"))}a+s>(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)&&(i+="<br>",d.push(a),a=0),a+=s,l++}return o.classList.add("active"),[d,i]}async function create_drag_objects(e,_,o,n,t,g,l,i,d,a){if(logDebug("function : create_drag_objects; p_module_index : "+e+"; p_shelf_index : "+_+"; i_item_index : "+o+"; i_show_live_image : "+g+"; p_object_type : "+l,"S"),g_module_index=e,g_shelf_index=_,"SHELF"==l){var s=parseInt(n.Color.replace("#","0x"),16),f=new THREE.Color(s);if("PEGBOARD"==n.ObjType)var I=add_pegboard(n.Shelf,n.W,n.H,n.D,f,n.X,n.Y,.004,"Y",n.VertiStart,n.VertiSpacing,n.HorizStart,n.HorizSpacing,e,_,n.Rotation,n.Slope,"N",$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),d);else if("TEXTBOX"==n.ObjType){var r=s;if("Y"==g&&""!==n.TextImg&&void 0!==n.TextImg&&null!==n.TextImg)I=await add_text_box_with_image(n.Shelf,"TEXTBOX",n.W,n.H,n.D,f,n.X,n.Y,.004,"Y",e,n.InputText,r,n.WrapText,n.ReduceToFit,n.Color,_,n.Rotation,n.Slope,"N",n.FStyle,n.FSize,n.FBold,$v("P25_NOTCH_HEAD"),d);else I=add_text_box(n.Shelf,"TEXTBOX",n.W,n.H,n.D,f,n.X,n.Y,.004,"Y",e,n.InputText,r,n.WrapText,n.ReduceToFit,n.Color,_,n.Rotation,n.Slope,"N",n.FStyle,n.FSize,n.FBold,2,d,g_pogcr_enhance_textbox_fontsize,n.TextDirection)}else if("ROD"==n.ObjType)I=add_rod(n.Shelf,"SHELF",n.W,n.H,n.D,f,n.X,n.Y,.004,"Y",e,_,d);else{var[I,p]=await add_shelf(n.Shelf,"SHELF",n.W,n.H,n.D,f,n.X,n.Y,.004,"Y",e,n.Rotation,n.Slope,_,"N","N","Y",-1,$v("P25_POG_CP_SHELF_DFLT_COLOR"),$v("P25_NOTCH_HEAD"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),d);updateObjID(i.id,I,"S")}g_pog_json[d].ModuleInfo[e].ShelfInfo[_].SObjID=I}else{if("DIVIDER"==t.Item){I=add_items(t.ItemID,t.W,t.H,t.D,t.Color,t.X,t.Y,t.Z,e,_,o,t.Rotation,d);var c=g_pog_json[d].ModuleInfo[e].ShelfInfo,u=-1,m=0;for(const e of c)e.Shelf==t.ItemID&&"DIVIDER"==e.ObjType&&(u=m),m++;u>-1&&(g_pog_json[d].ModuleInfo[e].ShelfInfo[u].ShelfDivObjID=I)}else if("Y"==g){var h=g_orientation_json[items.Orientation].split("###");I=await add_items_with_image(t.ItemID,t.W,t.H,t.D,t.Color,t.X,t.Y,t.Z,e,_,o,t.BHoriz,t.BVert,t.Item,parseInt(h[0]),parseInt(h[1]),"N","Y",$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),d)}else I=await add_items_prom(t.ItemID,t.W,t.H,t.D,t.Color,t.X,t.Y,t.Z,e,_,o,"N","Y",$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),d);g_pog_json[d].ModuleInfo[e].ShelfInfo[_].ItemInfo[o].OldObjID=g_pog_json[d].ModuleInfo[e].ShelfInfo[_].ItemInfo[o].ObjID,g_pog_json[d].ModuleInfo[e].ShelfInfo[_].ItemInfo[o].ObjID=I}var S=g_world.getObjectById(I);return S.W=i.W,S.H=i.H,S.D=i.D,S.Color=i.Color,S.Rotation=i.Rotation,S.ItemSlope=i.ItemSlope,S.Rotation=i.Rotation,S.Distance=i.Distance,S.PegBoardX=i.PegBoardX,S.PegBoardY=i.PegBoardY,S.ShelfInfo=i.ShelfInfo,S.ItemInfo=i.ItemInfo,S.IIndex=i.IIndex,S.StartCanvas=i.StartCanvas,S.MIndex=i.MIndex,S.SIndex=i.SIndex,render(a),logDebug("function : create_drag_objects","E"),[S,I]}function get_object_identity(e,_,o,n,t){logDebug("function : get_object_identity","S");try{var g=0;for(const _ of g_pog_json[e].ModuleInfo){if("Y"==g_carpark_edit_flag)break;if(null==_.ParentModule&&void 0!==_.Carpark&&_.Carpark.length>0&&_.Carpark[0].ItemInfo.length>0){var l=0;for(const e of _.Carpark){if(e.SObjID==g_objectHit_id){g_module_index=g,g_shelf_index=l,g_carpark_edit_flag="Y";break}g_carpark_edit_flag="N",l++}}g++}if("N"==g_carpark_edit_flag){g=0;for(const _ of g_pog_json[e].ModuleInfo){if(g_taskItemInContext||"POG"==g_compare_view||"EDIT_PALLET"==g_compare_view){if(_.MObjID==g_objectHit_id&&null==_.ParentModule){g_module_index=g,g_module_cnt=g,g_module_width=_.W,g_module_X=_.X,g_module_edit_flag="Y",comp_obj_id=_.CompMObjID,g_wireframe_id=_.WFrameID,apex.item("P25_MODULE_DISP").setValue(_.Module);break}g_module_edit_flag="N"}else{if(_.CompMObjID==g_objectHit_id&&null==_.ParentModule){g_module_index=g,g_module_cnt=g,g_module_width=_.W,g_module_X=_.X,g_module_edit_flag="Y",comp_obj_id=_.MObjID,g_wireframe_id=_.WFrameID,apex.item("P25_MODULE_DISP").setValue(_.Module);break}g_module_edit_flag="N"}g++}}if("N"==g_module_edit_flag&&"N"==g_carpark_edit_flag){l=0;for(const _ of g_pog_json[e].ModuleInfo){if("Y"==g_shelf_edit_flag)break;null==_.ParentModule&&$.each(_.ShelfInfo,(function(e,_){if("BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType)if(g_taskItemInContext||"POG"==g_compare_view||"EDIT_PALLET"==g_compare_view){if(_.SObjID==g_objectHit_id)return g_module_index=l,g_shelf_index=e,g_shelf_max_merch=_.MaxMerch,g_shelf_basket_spread=_.BsktSpreadProduct,g_shelf_edit_flag="Y",g_wireframe_id=_.WFrameID,g_shelf_object_type=_.ObjType,comp_obj_id=_.CompShelfObjID,g_rotation=_.Rotation,_.Slope>0?g_slope=0-_.Slope:_.Slope<0?g_slope=-_.Slope:g_slope=0,!1;g_shelf_edit_flag="N"}else{if(_.CompShelfObjID==g_objectHit_id)return g_module_index=l,g_shelf_index=e,g_shelf_max_merch=_.MaxMerch,g_shelf_edit_flag="Y",g_wireframe_id=_.WFrameID,g_shelf_object_type=_.ObjType,g_shelf_basket_spread=_.BsktSpreadProduct,g_rotation=_.Rotation,comp_obj_id=_.SObjID,_.Slope>0?g_slope=0-_.Slope:_.Slope<0?g_slope=-_.Slope:g_slope=0,!1;g_shelf_edit_flag="N"}})),l++}}if("N"==g_shelf_edit_flag&&"N"==g_module_edit_flag&&"N"==g_carpark_edit_flag){var i=0;for(const _ of g_pog_json[e].ModuleInfo){if("Y"==g_item_edit_flag)break;if(null==_.ParentModule){if(void 0!==_.Carpark&&void 0!==_.Carpark[0]&&_.Carpark.length>0&&_.Carpark[0].ItemInfo.length>0){l=0;for(const e of _.Carpark[0].ItemInfo){if(g_taskItemInContext||"POG"==g_compare_view||"EDIT_PALLET"==g_compare_view){if(e.ObjID==g_objectHit_id){g_module_index=i,g_shelf_index=0,g_item_index=l,g_item_edit_flag="Y",g_shelf_object_type=_.Carpark[0].ObjType,g_wireframe_id=e.WFrameID,comp_obj_id=e.CompItemObjID,g_carpark_item_flag="Y";break}g_item_edit_flag="N"}else{if(e.ObjID==g_objectHit_id){g_module_index=i,g_shelf_index=0,g_item_index=l,g_item_edit_flag="Y",g_shelf_object_type=_.Carpark[0].ObjType,g_wireframe_id=e.WFrameID,comp_obj_id=e.ObjID,g_carpark_item_flag="Y";break}g_item_edit_flag="N"}l++}}g=0;for(const e of _.ShelfInfo){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){if("Y"==g_item_edit_flag)break;l=0;for(const _ of e.ItemInfo){if(g_taskItemInContext||"POG"==g_compare_view||"EDIT_PALLET"==g_compare_view||"PREV_VERSION"==g_compare_view){if(_.ObjID==g_objectHit_id){g_module_index=i,g_shelf_index=g,g_item_index=l,g_item_edit_flag="Y",g_shelf_object_type=e.ObjType,g_wireframe_id=_.WFrameID,comp_obj_id=_.CompItemObjID;break}g_item_edit_flag="N"}else{if(_.CompItemObjID==g_objectHit_id){g_module_index=i,g_shelf_index=g,g_item_index=l,g_item_edit_flag="Y",comp_obj_id=_.ObjID,g_shelf_object_type=e.ObjType,g_wireframe_id=_.WFrameID;break}g_item_edit_flag="N"}l++}}g++}}i++}}if("N"==_&&"N"==o){g_delete_details=[];var d=g_pog_json[e].ModuleInfo[g_module_index];if(-1!==g_shelf_index&&-1==g_item_index&&"N"==g_carpark_item_flag){var a=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index];(f={}).ObjID=a.SObjID,f.MIndex=g_module_index,f.SIndex=g_shelf_index,f.ObjWidth=a.W,f.ObjHeight=a.H,f.XAxis=a.X,f.YAxis=a.Y,f.ZAxis=a.Z,f.IIndex=-1,f.ObjType=a.ObjType,f.IsDivider="N",f.Object="SHELF",f.MObjID=d.MObjID,f.SObjID=a.SObjID,f.ItemID=a.Shelf,f.Item="",f.Exists="N",f.Rotation=a.Rotation,f.Slope=a.Slope,f.Distance=0,f.TopObjID="",f.BottomObjID="",f.StartCanvas=g_start_canvas,f.g_present_canvas=g_present_canvas,f.p_pog_index=e,f.W=a.W,f.H=a.H,f.D=a.D,f.AllowAutoCrush=a.AllowAutoCrush,f.Rotation=a.Rotation,f.Slope=a.Slope,f.Color=a.Color,f.Combine=a.Combine,f.LOverhang=a.LOverhang,f.ROverhang=a.ROverhang,f.DivHeight=void 0===a.DivHeight?0:a.DivHeight,f.DivWidth=void 0===a.DivWidth?0:a.DivWidth,f.DivPst=void 0===a.DivPst?"N":a.DivPst,f.DivPed=void 0===a.DivPed?"N":a.DivPed,f.DivPbtwFace=void 0===a.DivPbtwFace?"N":a.DivPbtwFace,f.NoDivIDShow=a.NoDivIDShow,f.DivFillCol=void 0===a.DivFillCol?"#3D393D":a.DivFillCol,f.SpreadItem=a.SpreadItem,f.MaxMerch=a.MaxMerch,f.FBold=a.FBold,f.FSize=a.FSize,f.FStyle=a.FStyle,f.InputText=a.InputText,f.TextImg=a.TextImg,f.TextImgMime=a.TextImgMime,f.TextImgName=a.TextImgName,f.ReduceToFit=a.ReduceToFit,f.TextDirection=a.TextDirection,f.WrapText=a.WrapText,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(f)}else if(-1!==g_shelf_index&&-1!==g_item_index&&"N"==g_carpark_item_flag){a=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index];var s=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index],f={},I="N",r="ITEM";"DIVIDER"==s.Item&&(I="Y",r="SHELF"),f.ObjID=s.ObjID,f.MIndex=g_module_index,f.SIndex=g_shelf_index,f.ObjWidth=s.W,f.ObjHeight=s.H,f.XAxis=s.X,f.YAxis=s.Y,f.ZAxis=s.Z,f.IIndex=g_item_index,f.ObjType=a.ObjType,f.IsDivider=I,f.Object=r,f.MObjID=d.MObjID,f.SObjID=a.SObjID,f.ItemID=s.ItemID,f.Item=s.Item,f.W=s.W,f.H=s.H,f.X=s.X,f.Y=s.Y,f.Exists="N",f.Rotation=0,f.Slope=0,f.Distance=s.Distance,f.TopObjID=s.TopObjID,f.BottomObjID=s.BottomObjID,f.StartCanvas=g_start_canvas,f.g_present_canvas=g_present_canvas,f.p_pog_index=e,f.Color=s.Color,"DIVIDER"==s.Item&&(f.DivHeight=void 0===s.DivHeight?0:s.DivHeight,f.DivWidth=void 0===s.DivWidth?0:s.DivWidth,f.DivPst=void 0===s.DivPst?"N":s.DivPst,f.DivPed=void 0===s.DivPed?"N":s.DivPed,f.DivPbtwFace=void 0===s.DivPbtwFace?"N":s.DivPbtwFace,f.NoDivIDShow=s.NoDivIDShow,f.DivFillCol=void 0===s.DivFillCol?"#3D393D":s.DivFillCol,f.LOverhang=0,f.ROverhang=0,f.MaxMerch=0),f.D=s.D,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(f)}else if(-1!==g_shelf_index&&-1!==g_item_index&&"Y"==g_carpark_item_flag){var p=g_pog_json[e].ModuleInfo[g_module_index].Carpark;s=g_pog_json[e].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index];(f={}).ObjID=s.ObjID,f.MIndex=g_module_index,f.SIndex=0,f.ObjWidth=s.W,f.ObjHeight=s.H,f.XAxis=s.X,f.YAxis=s.Y,f.ZAxis=s.Z,f.IIndex=g_item_index,f.ObjType=p.ObjType,f.IsDivider="N",f.Object="CARPARK_ITEM",f.MObjID=d.MObjID,f.SObjID=p.SObjID,f.ItemID=s.ItemID,f.Item=s.Item,f.W=s.W,f.H=s.H,f.X=s.X,f.Y=s.Y,f.Exists="N",f.Rotation=0,f.Slope=0,f.Distance=s.Distance,f.TopObjID=s.TopObjID,f.BottomObjID=s.BottomObjID,f.IsCarpark="Y",f.StartCanvas=g_start_canvas,f.g_present_canvas=g_present_canvas,f.p_pog_index=e,f.Color=s.Color,g_delete_details.multi_delete_shelf_ind="",g_delete_details.multi_carpark_ind="Y",g_delete_details.push(f)}g_delete_details.StartCanvas=g_start_canvas,g_delete_details.g_present_canvas=g_present_canvas,update_item_xy_distance("N",e,n,t)}logDebug("function : get_object_identity","E")}catch(e){error_handling(e)}}async function multi_canvas_drag(e,_,o,n,t,g,l){try{logDebug("function : multi_canvas_drag; i_final_x : "+e+"; p_final_y : "+_+"; p_module_index : "+o+"; p_shelf_index : "+n+"; i_shelf_edit_flag : "+t+"; i_module_edit_flag : "+g,"S");var i,d,a,s=[],f=[],I=(g_scene_objects[g_start_canvas].renderer,g_scene_objects[g_start_canvas].scene.children[0],g_start_canvas),r=g_present_canvas;s.push(g_pog_json[g_present_canvas]),i=g_scene_objects[g_present_canvas].scene.children[2],f.push(g_pog_json[g_start_canvas]),d=g_scene_objects[g_start_canvas].scene.children[2];var p=(W=f[0].ModuleInfo[o].ShelfInfo[n]).ItemInfo[g_item_index],c="Y",u=[];if("Y"==t){var m=W,h=m.X,S=m.Y,O=[];O.moduleIndex=o,O.module=f[0].ModuleInfo[o].Module,O.shelfIndex=n,O.objectID=W.SObjID,O.actionType="SHELF_DRAG",O.startCanvas=I,O.g_present_canvas=r;var j=JSON.parse(JSON.stringify(W));O.push(JSON.parse(JSON.stringify(W))),m.X=e,m.Y=_;var[x,M,T,b]=get_curr_module(e,_,"Y",o,n,m,l);O.moduleObjectID=s[0].ModuleInfo[x].MObjID;var D=W.ItemInfo,E=W.AllowAutoCrush;if(await set_all_items(o,n,e,_,"Y","E","Y",I,r),"ROD"!==g_shelf_object_type&&"TEXTBOX"!==g_shelf_object_type&&"N"==T)var v=validate_shelf_min_distance(x,n,_,D,E,o,e,"Y",m,l);else v="Y"==T?"N":"Y";if("Y"==g_multi_cnvs_drag_conf&&("Y"==v||"R"==v)){for(const e of g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo)u.push(e.ItemID);c=await doItemMoveConf(u,g_pog_json,g_present_canvas)}if("Y"!=v&&"R"!=v||"Y"!=c){g_world=d;var[N,P]=await create_drag_objects(o,n,g_item_index,g_dragItem.ShelfInfo,g_dragItem.ItemInfo,g_show_live_image,"SHELF",g_dragItem,g_start_canvas,l);i.remove(g_dragItem),N.position.x=h,N.position.y=S,W.SObjID=N.id,W.X=h,W.Y=S;var C=[];g_intersected=[];var R=g_pog_json[g_start_canvas].ModuleInfo[o].ShelfInfo[n].SObjID;if(j.ItemInfo.length>0){B=0;for(const e of j.ItemInfo){var y=i.getObjectById(e.ObjID),[H,P]=await create_drag_objects(o,n,B,j,e,g_show_live_image,"ITEM",y,I,l);i.remove(y),H.position.x=e.X,H.position.y=e.Y,W.ItemInfo[B].X=e.X,W.ItemInfo[B].Y=e.Y,W.ItemInfo[B].ObjID=H.id,C.push(H);y=g_scene_objects[g_start_canvas].scene.children[2].getObjectById(H.id);g_intersected.push(y),render_animate_selected(),B++}g_intersected.push(g_scene_objects[g_start_canvas].scene.children[2].getObjectById(R)),render_animate_selected(),set_inter_canvas_items(h,S,N,C,m.W,m.H,g_shelf_object_type,g_shelf_basket_spread,m.Rotation,m.Slope,n,o,g_start_canvas)}else{y=g_scene_objects[g_start_canvas].scene.children[2].getObjectById(R);g_intersected.push(y),render_animate_selected()}render(g_start_canvas),g_world=i}else{g_allUndoObjectsInfo.push(O),logFinalUndoObjectsInfo("SHELF_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","Y",g_carpark_item_flag),g_allUndoObjectsInfo=[];var Y=-1,A="N",F=-1,L=s[0].ModuleInfo,$={};if("TEXTBOX"==g_shelf_object_type){var B=0;for(const e of L){if(e.ObjID==g_objectHit_id)return s[0].ModuleInfo[B].ParentModule=s[0].ModuleInfo[x].Module,void(F=B);B++}$=f[0].ModuleInfo[F],0==F&&(console.log("before",f[0].ModuleInfo[o]),f[0].ModuleInfo.splice(F,F+1),console.log("after",f[0].ModuleInfo[o])),s[0].ModuleInfo.push($)}0==n?f[0].ModuleInfo[o].ShelfInfo.splice(n,n+1):(console.log("before",f[0].ModuleInfo[o]),f[0].ModuleInfo[o].ShelfInfo.splice(n,1));var w=get_min_shelf(x,_,l).split(",");if(Y=parseFloat(w[0]),A=w[1],m.Shelf=s[0].ModuleInfo[x].Module+s[0].ModuleInfo[x].ShelfInfo.length,g_dragItem.Module=s[0].ModuleInfo[x].Module,"Y"==A?(s[0].ModuleInfo[x].ShelfInfo.splice(Y+1,0,m),a=Y+1):(s[0].ModuleInfo[x].ShelfInfo.splice(Y,0,m),a=0),s[0].ModuleInfo[x].H>.1&&"ROD"!==g_shelf_object_type&&"TEXTBOX"!==g_shelf_object_type&&"Y"==g_auto_position_ind&&auto_position_shelf(x,x,a,T,e,_,"Y",l),"R"==v){var X=recreate_all_items(x,a,s[0].ModuleInfo[x].ShelfInfo[a].ObjType,"N",e,-1,s[0].ModuleInfo[x].ShelfInfo[a].ItemInfo.length,"N","N",-1,-1,g_start_canvas,"N",l,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y");if(g_combineItemModf.length>0)for(var G=0;G<g_combineItemModf.length;G++)if(g_combineItemModf[G].OldMIndex==x&&g_combineItemModf[G].OldSIndex==a){x=g_combineItemModf[G].NewMIndex,a=g_combineItemModf[G].NewSIndex;break}}var W=s[0].ModuleInfo[x].ShelfInfo[a],k=g_scene_objects[l].scene.children[2].getObjectById(W.SObjID);if(g_intersected.push(k),render_animate_selected(),"TEXTBOX"==g_shelf_object_type){var V=get_textbox_z(x,a,s[0].ModuleInfo[x].ShelfInfo[a].X,s[0].ModuleInfo[x].ShelfInfo[a].Y,s[0].ModuleInfo[x].ShelfInfo[a].W,s[0].ModuleInfo[x].ShelfInfo[a].H,I,l);s[0].ModuleInfo[x].ShelfInfo[a].Z=V}}await calculateFixelAndSupplyDays("N",g_present_canvas),await calculateFixelAndSupplyDays("N",g_start_canvas),g_canvas_drag="N",g_drag_inprogress="N",g_drag_items_arr=[],g_dragItem=[],render(l)}else if("Y"==g_item_edit_flag){var U,z=W,[x,M,T,b]=get_curr_module(e,_,"Y",o,n,z,l),[M,x,Z,J,K,Y,A]=get_div_shelf_index(e,_,x,M,l,"",!1),q=JSON.parse(JSON.stringify(f[0].ModuleInfo[o].ShelfInfo[n].ItemInfo[g_item_index])),Q=q.ObjID,ee=(U=f[0].ModuleInfo[o].ShelfInfo[n].ItemInfo[g_item_index]).X,_e=U.Y;if("Y"==g_multi_cnvs_drag_conf&&-1!==Y&&(u=[g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].ItemID],c=await doItemMoveConf(u,g_pog_json,g_present_canvas)),-1!==Y&&"N"!=c){(O=[]).moduleIndex=x,O.shelfIndex=Y,O.actionType="ITEM_DELETE",O.startCanvas=r,O.g_present_canvas=I,O.objectID=s[0].ModuleInfo[x].ShelfInfo[Y].SObjID,O.module=s[0].ModuleInfo[x].Module,O.moduleObjectID=s[0].ModuleInfo[x].MObjID,O.push(JSON.parse(JSON.stringify(s[0].ModuleInfo[x].ShelfInfo[Y]))),g_allUndoObjectsInfo.push(O),(O=[]).moduleIndex=o,O.shelfIndex=n,O.actionType="ITEM_DELETE",O.startCanvas=I,O.g_present_canvas=r,O.objectID=W.SObjID,O.module=f[0].ModuleInfo[o].Module,O.moduleObjectID=f[0].ModuleInfo[o].MObjID,O.push(JSON.parse(JSON.stringify(W))),g_allUndoObjectsInfo.push(O);g_dragItem.ItemInfo.Fixed;var oe=s[0].ModuleInfo[x].ShelfInfo[Y].SpreadItem;U.Fixed="N",p.X=e,p.Y=_;var[ne,te,ge,le,ie,U,de,ae,se]=await update_item_loc(x,o,n,Y,Z,g_dragItem.IIndex,e,A,U,J,K,_,s,"B",g_present_canvas,I);if(void 0!==q.TopObjID&&""!==q.TopObjID||void 0!==q.BottomObjID&&""!==q.BottomObjID)reset_bottom_item(o,n,g_item_index,x,te,e,g_start_canvas);if("CHEST"==le&&"Y"==g_chest_as_pegboard)Ie=_;else if("PEGBOARD"!==le)var[fe,Ie]=get_item_xy(s[0].ModuleInfo[ge].ShelfInfo[te],U,U.W,U.H,g_present_canvas);else Ie=_;"BASKET"==le&&"DIVIDER"==U.Item?U.Y=_:U.Y=Ie,W.ItemInfo.splice(g_dragItem.IIndex,1);var re=set_item_after_drag(le,oe,ge,te,ne,U,g_present_canvas);"Y"==g_pegbrd_auto_placing&&"PEGBOARD"==le||"PEGBOARD"!==le?U.Edited="Y":U.Edited="N";var pe=0;for(const e of s[0].ModuleInfo[ge].ShelfInfo[te].ItemInfo){if(e.ObjID==U.ObjID){re=pe;break}pe++}X="N";var ce=s[0].ModuleInfo[ge].ShelfInfo[te].ItemInfo[re],ue=s[0].ModuleInfo[ge].ShelfInfo[te].HorizGap,me=get_item_xaxis(ce.W,ce.H,ce.D,le,e,ue,oe,ue,ge,te,re,"PALLET"==le?"N":"Y",s[0].ModuleInfo[ge].ShelfInfo[te].ItemInfo.length,"N",g_present_canvas);s[0].ModuleInfo[ge].ShelfInfo[te].ItemInfo[re].X=me;var he=s[0].ModuleInfo[ge].ShelfInfo[te].ItemInfo[re];if(X=update_validate_item_height(ce,ge,te,re,e,le,me,g_present_canvas),"CHEST"==le&&"Y"==g_chest_as_pegboard)Ie=_;else if("PEGBOARD"!==le)var[fe,Ie]=get_item_xy(s[0].ModuleInfo[ge].ShelfInfo[te],he,he.W,he.H,g_present_canvas);else Ie=_;"BASKET"==le&&"DIVIDER"==U.Item?he.Y=_:he.Y=Ie,"Y"==g_max_facing_enabled&&reset_auto_crush(ge,te,re,g_present_canvas,ge,te,r),await set_auto_facings(ge,te,re,ce,"B","I","D",g_present_canvas);if([].push(wpdSetFixed(U.W)),[].push(wpdSetFixed(U.H)),[].push(wpdSetFixed(U.D)),[].push(re),"F"==X||"N"==X){if(logFinalUndoObjectsInfo("SHELF_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","Y",g_carpark_item_flag),g_allUndoObjectsInfo=[],reorder_items(ge,te,g_present_canvas)){X=await recreate_all_items(ge,te,le,"Y",e,-1,s[0].ModuleInfo[ge].ShelfInfo[te].ItemInfo.length,"N","N",-1,-1,r,"",g_present_canvas,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y");if(g_combineItemModf.length>0)for(G=0;G<g_combineItemModf.length;G++)if(g_combineItemModf[G].OldMIndex==ge&&g_combineItemModf[G].OldSIndex==te){ge=g_combineItemModf[G].NewMIndex,te=g_combineItemModf[G].NewSIndex;break}y=g_scene_objects[l].scene.children[2].getObjectById(ce.ObjID);g_intersected.push(y),render_animate_selected()}if(reorder_items(o,n,g_start_canvas)){X=await recreate_all_items(o,n,g_shelf_object_type,"Y",e,-1,W.ItemInfo.length,"N","N",-1,-1,I,"",g_start_canvas,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y");if(g_combineItemModf.length>0)for(G=0;G<g_combineItemModf.length;G++)if(g_combineItemModf[G].OldMIndex==o&&g_combineItemModf[G].OldSIndex==n){o=g_combineItemModf[G].NewMIndex,n=g_combineItemModf[G].NewSIndex;break}}}else{g_allUndoObjectsInfo=[],q.DimUpdate=s[0].ModuleInfo[ge].ShelfInfo[te].ItemInfo[re].DimUpdate,g_carpark_item_flag,0==re?s[0].ModuleInfo[ge].ShelfInfo[te].ItemInfo.splice(re,re+1):s[0].ModuleInfo[ge].ShelfInfo[te].ItemInfo.splice(re,1),"Y"==g_carpark_item_flag?(f[0].ModuleInfo[o].Carpark[0].ItemInfo.splice(g_item_index,0,q),f[0].ModuleInfo[o].Carpark[0].ItemInfo[g_item_index].X=ee,f[0].ModuleInfo[o].Carpark[0].ItemInfo[g_item_index].Y=_e):(W.ItemInfo.splice(g_item_index,0,q),p.X=ee,p.Y=_e),g_world=d;var[H,P]=await create_drag_objects(o,n,g_item_index,z,q,g_show_live_image,"ITEM",g_dragItem,g_start_canvas,g_present_canvas);H.position.x=ee,H.position.y=_e,p.ObjID=H.id,g_world=i;var Se=i.getObjectById(Q);i.remove(Se),H.updateMatrix()}}else{"Y"==g_carpark_item_flag?(f[0].ModuleInfo[o].Carpark[0].ItemInfo[g_item_index].X=ee,f[0].ModuleInfo[o].Carpark[0].ItemInfo[g_item_index].Y=_e):(p.X=ee,p.Y=_e),g_world=d;var[H,P]=await create_drag_objects(o,n,g_item_index,z,p,g_show_live_image,"ITEM",g_dragItem,g_start_canvas,g_present_canvas);H.position.x=ee,H.position.y=_e,p.ObjID=H.id,render(g_start_canvas),g_world=i;Se=i.getObjectById(Q);i.remove(Se),H.updateMatrix()}await calculateFixelAndSupplyDays("N",g_present_canvas),await calculateFixelAndSupplyDays("N",g_start_canvas),g_canvas_drag="N",g_drag_inprogress="N",g_drag_items_arr=[],g_dragItem=[],render(l),render(g_start_canvas),render_all_pog(),animate_all_pog(),render_animate_selected(),await recreate_compare_views(g_compare_view,"Y")}logDebug("function : multi_canvas_drag","E")}catch(e){error_handling(e)}}function get_multi_item_shelf(e,_){try{logDebug("function : get_multi_item_shelf","S");var o=[],n=[],t=0;for(const d of e){if(void 0===d.IntoShelf&&(d.IntoShelf="N"),"SHELF"==d.Object&&"N"==d.IsDivider){if(o.push(d),d.IntoShelf="Y",d.ShelfInfo=[JSON.parse(JSON.stringify(g_pog_json[_].ModuleInfo[d.MIndex].ShelfInfo[d.SIndex]))],"TEXTBOX"!==d.ObjType){o[o.length-1].ShelfItems=[],j=0;for(const _ of e)d.MIndex==_.MIndex&&d.SIndex==_.SIndex&&"SHELF"!==_.Object&&(_.IntoShelf="Y",o[o.length-1].ShelfItems.push(_)),j+=1}if("TEXTBOX"==d.ObjType){var g=-1,l=g_pog_json[_].ModuleInfo;t=0;for(const e of l){if(e.ObjID==d.ObjID){g=t;break}t++}-1!==g&&(d.support_obj=[JSON.parse(JSON.stringify(g_pog_json[_].ModuleInfo[g]))])}}else if("N"==d.IntoShelf)if(n.push(d),"Y"==e.multi_carpark_ind?n[n.length-1].ItemObj=[JSON.parse(JSON.stringify(g_pog_json[_].ModuleInfo[d.MIndex].Carpark[d.SIndex].ItemInfo[d.IIndex]))]:n[n.length-1].ItemObj=[JSON.parse(JSON.stringify(g_pog_json[_].ModuleInfo[d.MIndex].ShelfInfo[d.SIndex].ItemInfo[d.IIndex]))],"Y"==d.IsDivider){shelf_arr=g_pog_json[_].ModuleInfo[d.MIndex].ShelfInfo;var i=-1;$.each(shelf_arr,(function(e,_){_.Shelf==d.ItemID&&(i=e)})),-1!==i&&(d.support_obj=[JSON.parse(JSON.stringify(g_pog_json[_].ModuleInfo[d.MIndex].ShelfInfo[i]))])}else d.support_obj=[];t+=1}return logDebug("function : get_multi_item_shelf","E"),[o,n]}catch(e){error_handling(e)}}async function multi_drag_setup(e,_,o,n){logDebug("function : multi_drag_setup; i_final_x : "+e+"; p_final_y : "+_,"S");try{var t=[],g=[],l=[],i=[],d=[],a=[],s=[],f=[],I=[],r=[],p=[],m=-1,h=-1,S=g_start_canvas,O=g_present_canvas;g_canvas_drag="N";var j,x="Y",M="Y",T="Y",b="B",D=[],E=[],v="N";g_temp_cut_arr=[],startCanvas="R";g_scene_objects[g_start_canvas].renderer;var N=g_scene_objects[g_start_canvas].scene;N.children[0];d_=N.children[2],[].push(g_pog_json[S]),g_temp_cut_arr.push(JSON.parse(JSON.stringify(g_pog_json[S].ModuleInfo))),E.push(JSON.parse(JSON.stringify(g_pog_json[n].ModuleInfo)));var P=-1,C=-1,R=-1,y=-1,H=-1,[Y,A]=[-1,-1],F="Y",L=[],B=0;for(const s_ of g_delete_details){if(void 0===s_.IntoShelf&&(s_.IntoShelf="N"),"SHELF"==s_.Object&&"N"==s_.IsDivider){t.push(s_),s_.IntoShelf="Y",t[t.length-1].ItemInfo=[];var w=0;for(const f_ of g_delete_details){if(s_.MIndex==f_.MIndex&&s_.SIndex==f_.SIndex&&"SHELF"!==f_.Object){f_.IntoShelf="Y";var X=g_pog_json[S].ModuleInfo[f_.MIndex].ShelfInfo[f_.SIndex].ItemInfo[f_.IIndex];t[t.length-1].ItemInfo.push(X)}w+=1}}else"N"==s_.IntoShelf&&(g.push(s_),"Y"==g_delete_details.multi_carpark_ind?g[g.length-1].ItemObj=[JSON.parse(JSON.stringify(g_pog_json[S].ModuleInfo[s_.MIndex].Carpark[0].ItemInfo[s_.IIndex]))]:g[g.length-1].ItemObj=[JSON.parse(JSON.stringify(g_pog_json[S].ModuleInfo[s_.MIndex].ShelfInfo[s_.SIndex].ItemInfo[s_.IIndex]))]);s_.OldItemX=s_.XAxis,s_.OldItemY=s_.YAxis,B+=1}if(t.length>0){B=0;for(const I_ of t){var G="Y",W=e+I_.XDistance,V=_+I_.YDistance;g_pog_json[S].ModuleInfo[I_.MIndex].ShelfInfo[I_.SIndex].X=W,g_pog_json[S].ModuleInfo[I_.MIndex].ShelfInfo[I_.SIndex].Y=V}M=await getconfirm_shelfmove(S);B=0;for(const r_ of t){G="Y";if("PEGBOARD"==r_.ObjType||"CHEST"==r_.ObjType&&"Y"==g_chest_as_pegboard)V=_-r_.YDistance;else V=_+r_.YDistance;W=e+r_.XDistance;var U=g_pog_json[S].ModuleInfo[r_.MIndex].ShelfInfo[r_.SIndex],[z,Z,J,K]=get_curr_module(W,V,"Y",r_.MIndex,r_.SIndex,U,n),q=g_pog_json[S].ModuleInfo[r_.MIndex].ShelfInfo[r_.SIndex].ItemInfo,Q=g_pog_json[S].ModuleInfo[r_.MIndex].ShelfInfo[r_.SIndex].AllowAutoCrush;g_pog_json[n].ModuleInfo[z].H>.1&&"ROD"!==g_shelf_object_type&&"TEXTBOX"!==g_shelf_object_type&&"Y"==g_auto_position_ind?auto_position_shelf(r_.MIndex,z,r_.SIndex,J,W,V,"N",n):await set_all_items(r_.MIndex,r_.SIndex,W,V,"Y","E","Y",S,O);var ee=z==r_.MIndex?r_.MIndex:z;if("ROD"!==r_.ObjType&&"TEXTBOX"!==r_.ObjType&&"N"==J&&"Y"==M)G=validate_shelf_min_distance(ee,r_.SIndex,V,q,Q,r_.MIndex,W,"Y",U,n);else G="Y"==J?"N":"Y";if("N"==M&&(G="N"),"Y"===M&&"B"===g_pog_json[n]?.ModuleInfo?.[r_.MIndex]?.ShelfInfo?.[r_.SIndex]?.Combine&&(g_pog_json[n].ModuleInfo[r_.MIndex].ShelfInfo[r_.SIndex].Combine="N"),"Y"!=G&&"R"!=G){for(const p_ of g_delete_details)"ITEM"==p_.Object?(g_pog_json[S].ModuleInfo[p_.MIndex].ShelfInfo[p_.SIndex].ItemInfo[p_.IIndex].X=p_.XAxis,g_pog_json[S].ModuleInfo[p_.MIndex].ShelfInfo[p_.SIndex].ItemInfo[p_.IIndex].Y=p_.YAxis):(g_pog_json[S].ModuleInfo[p_.MIndex].ShelfInfo[p_.SIndex].X=p_.XAxis,g_pog_json[S].ModuleInfo[p_.MIndex].ShelfInfo[p_.SIndex].Y=p_.YAxis);t[B].Valid="N",x="N",g_pog_json[S].ModuleInfo[r_.MIndex].ShelfInfo[r_.SIndex].X=r_.XAxis,g_pog_json[S].ModuleInfo[r_.MIndex].ShelfInfo[r_.SIndex].Y=r_.YAxis;break}t[B].Valid=G,t[B].CurrModIndex=z,"CHEST"==U.ObjType&&"Y"==g_chest_as_pegboard&&(U.ChestEdit="Y"),B+=1}}if("Y"==x){x="Y";var _e="N";if(g.length>0){B=0;var oe=0;for(const c_ of g)oe+=c_.W,B++;var[z,Z,J,K]=get_curr_module(e,_,"N",-1,-1,[],n),[Z,z,ne,te,ge,le,ie]=get_div_shelf_index(e,_,z,Z,n,g_dragItem,!1);if("CHEST"==ne&&"Y"==g_chest_as_pegboard||-1===le||([Y,A]=getCombinationShelf(n,g_pog_json[n].ModuleInfo[z].ShelfInfo[le].Shelf)),"CHEST"==ne&&"Y"==g_chest_as_pegboard||-1!=Y||-1===le)0!==nvl(ne)&&"CHEST"==ne&&"Y"==g_chest_as_pegboard?(x="Y",_e="Y",v="Y",le):-1!==Y?(x="Y",_e="Y",v="N"):x="N";else{var de=-1,ae=-1,se="N",fe=0;for(const u_ of g){W=e+u_.XDistance;if("PEGBOARD"==u_.ObjType)V=_-u_.YDistance;else V=_+u_.YDistance;U=g_pog_json[S].ModuleInfo[u_.MIndex].ShelfInfo[u_.SIndex];var[z,Z,J,K]=get_curr_module(W,V,"Y",u_.MIndex,u_.SIndex,U,n),[Z,z,ne,te,ge,le,ie]=get_div_shelf_index(W,V,z,Z,n,u_,!0);void 0!==g_pog_json[n].ModuleInfo[z].ShelfInfo[le]?(H=le,z!==de&&de>-1?se="Y":de=z,le!==ae&&ae>-1?se="Y":ae=le):fe++}if(fe==g.length&&(se="Y"),"N"==se)if("PEGBOARD"!==ne){var Ie=0;for(const m_ of g_pog_json[n].ModuleInfo[z].ShelfInfo[H].ItemInfo){var re="N";for(const h_ of g)if(h_.ObjID==m_.ObjID){re="Y";break}"N"==re&&(Ie+=m_.W),B++}oe>g_pog_json[n].ModuleInfo[z].ShelfInfo[H].W-Ie&&("Y"!=g_overhung_shelf_active||"SHELF"!=ne&&"HANGINGBAR"!=ne)?x="N":oe<=g_pog_json[n].ModuleInfo[z].ShelfInfo[H].W-Ie&&(_e="Y")}else x="Y",_e="Y";else{B=0;for(const S_ of g){W=e+S_.XDistance,V=_+S_.YDistance,U=g_pog_json[S].ModuleInfo[S_.MIndex].ShelfInfo[S_.SIndex];var[z,Z,J,K]=get_curr_module(W,V,"Y",S_.MIndex,S_.SIndex,U,n),[Z,z,ne,te,ge,le,ie]=get_div_shelf_index(W,V,z,Z,n,S_,!0);if(void 0===g_pog_json[n].ModuleInfo[z].ShelfInfo[le]){x="N";break}if((W+S_.W/2>g_pog_json[n].ModuleInfo[z].ShelfInfo[le].X+g_pog_json[n].ModuleInfo[z].ShelfInfo[le].W/2||W-S_.W/2<g_pog_json[n].ModuleInfo[z].ShelfInfo[le].X-g_pog_json[n].ModuleInfo[z].ShelfInfo[le].W/2)&&("Y"!=g_overhung_shelf_active||"SHELF"!=ne&&"HANGINGBAR"!=ne)){x="N";break}B+=1}}}}}if(g_present_canvas!=g_start_canvas&&"Y"==g_multi_cnvs_drag_conf&&"N"!=x){for(const O_ of g_delete_details)if("SHELF"==O_.Object)for(const j_ of g_pog_json[g_start_canvas].ModuleInfo[O_.MIndex].ShelfInfo[O_.SIndex].ItemInfo)L.push(j_.ItemID);else"ITEM"==O_.Object&&L.push(O_.ItemID);L=[...new Set(L)],F=await doItemMoveConf(L,g_pog_json,g_present_canvas)}if("N"==x||"N"==F){"N"==x&&alert(get_message("POGCR_OUT_OF_FIXEL_ERR")),i_=g_scene_objects[g_present_canvas].scene.children[2],d_=g_scene_objects[g_start_canvas].scene.children[2];w=0;g_world=d_;for(const x_ of g_multi_drag_item_arr){$.each(g_pog_json[g_start_canvas].ModuleInfo[x_.MIndex].ShelfInfo[x_.SIndex].ItemInfo,(function(e,_){if(_.ObjID==x_.ObjID)return De=e,!1})),g_pog_json[g_start_canvas].ModuleInfo[x_.MIndex].ShelfInfo[x_.SIndex].ItemInfo[De].X=x_.XAxis,g_pog_json[g_start_canvas].ModuleInfo[x_.MIndex].ShelfInfo[x_.SIndex].ItemInfo[De].Y=x_.YAxis;var pe=i_.getObjectById(x_.ObjID);if(g_pog_json[g_start_canvas].ModuleInfo[x_.MIndex].ShelfInfo[x_.SIndex].ItemInfo.length>0){var[ce,ue]=await create_drag_objects(x_.MIndex,x_.SIndex,De,U,g_pog_json[g_start_canvas].ModuleInfo[x_.MIndex].ShelfInfo[x_.SIndex].ItemInfo[De],g_show_live_image,"ITEM",pe,g_start_canvas,g_present_canvas);ce.position.x=x_.XAxis,ce.position.y=x_.YAxis,i_.remove(pe),ce.updateMatrix()}w++}w=-1;for(const M_ of g_multi_drag_shelf_arr){async function me(){var e=g_pog_json[S].ModuleInfo[M_.MIndex].ShelfInfo[M_.SIndex];e.X=M_.XAxis,e.Y=M_.YAxis;var _=i_.getObjectById(M_.ObjID);[l,newObjId]=await create_drag_objects(M_.MIndex,M_.SIndex,M_.IIndex,e,e.ItemInfo,g_show_live_image,"SHELF",_,g_start_canvas,g_present_canvas),i_.remove(_),(_=l).updateMatrix();g_drag_items_arr=[];var o=0;for(const _ of e.ItemInfo){var t=g_scene_objects[n].scene.children[2].getObjectById(_.ObjID);void 0!==t&&("CHEST"==g_shelf_object_type&&"Y"==g_chest_as_pegboard?(t.PegBoardX=_.PegBoardX,t.PegBoardY=_.PegBoardY):"PEGBOARD"!==g_shelf_object_type?t.Distance=_.Distance:(t.PegBoardX=_.PegBoardX,t.PegBoardY=_.PegBoardY),t.ItemInfo=_,t.IIndex=o,t.StartCanvas=g_start_canvas,t.MIndex=M_.MIndex,t.SIndex=M_.SIndex,g_drag_items_arr.push(t)),o++}var g=[];if(g_drag_items_arr.length>0){for(const e of g_drag_items_arr){i_.remove(e);var[l,i]=await create_drag_objects(e.MIndex,e.SIndex,e.IIndex,e.ShelfInfo,e.ItemInfo,g_show_live_image,"ITEM",e,g_start_canvas,g_present_canvas);g.push(l)}g.length>0&&(g_drag_items_arr=[],g_drag_items_arr=g),set_inter_canvas_items(M_.XAxis,M_.YAxis,_,g,_.W,_.H,g_shelf_object_type,g_shelf_basket_spread,_.Rotation,_.ItemSlope,M_.SIndex,M_.MIndex,g_start_canvas,"Y")}}w++,await me()}if(render(g_start_canvas),g_world=i_,t.length>0)for(const T_ of t)g_pog_json[S].ModuleInfo[T_.MIndex].ShelfInfo[T_.SIndex].X=T_.XAxis,g_pog_json[S].ModuleInfo[T_.MIndex].ShelfInfo[T_.SIndex].Y=T_.YAxis;g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],cut_copy_arr1=[],g_undo_details=[],g_mselect_drag="N",g_multiselect="N",g_ctrl_select="N",g_undo_all_obj_arr=[],g_temp_cut_arr=[],g_intersected=[],g_select_zoom_arr=[],render(n),render_animate_selected()}else{if(g.length>0){b=g_DragMouseEnd.x>g_DragMouseStart.x?"F":"B";B=0;var he=-1;for(const b_ of g){if(D.push(b_.ObjID),-1!==le){var[Y,A]=getCombinationShelf(S,g_pog_json[S].ModuleInfo[b_.MIndex].ShelfInfo[b_.SIndex].Shelf);if(-1!==Y&&-1!==A){if(currCombination=g_combinedShelfs[Y],currCombination.length>1&&h!=Y)for(obj of(h=Y,currCombination))p.push(JSON.parse(JSON.stringify(g_pog_json[obj.PIndex].ModuleInfo[obj.MIndex].ShelfInfo[obj.SIndex])));-1==he?he=Y:he!==Y&&"N"}else R!=b_.MIndex&&y!=b_.SIndex&&(R=b_.MIndex,y=b_.SIndex,p.push(JSON.parse(JSON.stringify(g_pog_json[S].ModuleInfo[b_.MIndex].ShelfInfo[b_.SIndex]))))}if(0==B&&("PEGBOARD"==Pe||"CHEST"==Pe&&"CHEST"==b_.ObjType&&"Y"==g_chest_as_pegboard))W=e+b_.XDistance+.01;else W=e+b_.XDistance;if("PEGBOARD"==b_.ObjType||"CHEST"==b_.ObjType&&"Y"==g_chest_as_pegboard||"CHEST"==Pe&&"CHEST"==b_.ObjType&&"Y"==g_chest_as_pegboard)V=_-b_.YDistance;else V=_+b_.YDistance;"Y"==g_delete_details.multi_carpark_ind?(g_pog_json[S].ModuleInfo[b_.MIndex].Carpark[0].ItemInfo[b_.IIndex].X=W,g_pog_json[S].ModuleInfo[b_.MIndex].Carpark[0].ItemInfo[b_.IIndex].Y=V,g_pog_json[S].ModuleInfo[b_.MIndex].Carpark[0].ItemInfo[b_.IIndex].DropY=V):(g_pog_json[S].ModuleInfo[b_.MIndex].ShelfInfo[b_.SIndex].ItemInfo[b_.IIndex].X=W,g_pog_json[S].ModuleInfo[b_.MIndex].ShelfInfo[b_.SIndex].ItemInfo[b_.IIndex].Y=V,g_pog_json[S].ModuleInfo[b_.MIndex].ShelfInfo[b_.SIndex].ItemInfo[b_.IIndex].DropY=V)}B=0;var Se="N",Oe=-1;for(const D_ of g){l=[],i=[],d=[],a=[];if(0==B&&"PEGBOARD"==Pe)W=e+D_.XDistance+.01;else W=e+D_.XDistance;if("PEGBOARD"==D_.ObjType||"CHEST"==D_.ObjType&&"Y"==g_chest_as_pegboard||"CHEST"==Pe&&"CHEST"==D_.ObjType&&"Y"==g_chest_as_pegboard||"CHEST"==D_.ObjType&&"Y"==g_chest_as_pegboard)V=_-D_.YDistance;else V=_+D_.YDistance;U="Y"==g_delete_details.multi_carpark_ind?g_pog_json[S].ModuleInfo[D_.MIndex].Carpark[0]:g_pog_json[S].ModuleInfo[D_.MIndex].ShelfInfo[D_.SIndex];if("N"==v)var[z,Z,J,K]=get_curr_module(W,V,"Y",D_.MIndex,D_.SIndex,U,n),[Z,z,ne,te,ge,le,ie]=get_div_shelf_index(W,V,z,Z,n,D_,!0);else var[z,Z,J,K]=get_curr_module(e,_,"N",-1,-1,[],n),[Z,z,ne,te,ge,le,ie]=get_div_shelf_index(e,_,z,Z,n);if(-1==le&&"Y"==_e&&-1!==H&&(le=H,ne=g_pog_json[n].ModuleInfo[z].ShelfInfo[le].ObjType,te=g_pog_json[n].ModuleInfo[z].ShelfInfo[le].Y,ge=g_pog_json[n].ModuleInfo[z].ShelfInfo[le].H,ie="Y"),-1!==le){var je=D_.ItemObj[0],xe=JSON.parse(JSON.stringify(D_.ItemObj[0])),Me=D_.ItemObj[0].Fixed,Te=g_pog_json[n].ModuleInfo[z].ShelfInfo[le].SpreadItem,be=g_pog_json[n].ModuleInfo[z].ShelfInfo[le];"PEGBOARD"!=ne&&"M"!=Te||(je.X=W,je.Y=V,je.DropY=V),"CHEST"==ne&&"Y"==g_chest_as_pegboard&&0==B&&"Y"==be.AutoPlacing?W-je.W/2<be.X-be.W/2?(Se="Y",je.X=be.X-be.W/2+je.W/2,je.Y=V,je.DropY=V,Oe=je.X+je.W/2):(je.X=W,je.Y=V,je.DropY=V,"N"==je.MHorizCrushed&&(je.W=je.RW,je.CrushHoriz=0),"N"==je.MVertCrushed&&(je.H=je.RH,je.CrushVert=0),"N"==je.MDepthCrushed&&(je.D=je.RD,je.CrushD=0)):"Y"==Se?(je.X=Oe+je.W/2,je.Y=V,je.DropY=V,Oe=je.X+je.W/2):(je.X=W,je.Y=V,je.DropY=V,"N"==je.MHorizCrushed&&(je.W=je.RW,je.CrushHoriz=0),"N"==je.MVertCrushed&&(je.H=je.RH,je.CrushVert=0),"N"==je.MDepthCrushed&&(je.D=je.RD,je.CrushD=0));g_pog_json[S].ModuleInfo[D_.MIndex].ShelfInfo[D_.SIndex];var De=-1;if($.each(g_pog_json[S].ModuleInfo[D_.MIndex].ShelfInfo[D_.SIndex].ItemInfo,(function(e,_){if(_.ObjID==D_.ObjID)return De=e,!1})),"F"==g_pog_json[S].ModuleInfo[D_.MIndex].ShelfInfo[D_.SIndex].SpreadItem&&(je.W=je.RW),0==B){var Ee={X:"asc",Y:"asc"};g_pog_json[n].ModuleInfo[z].ShelfInfo[le].ItemInfo.keySort(Ee);var[ve,ae,Ne,Pe,Ce,je,Re,ye,He]=await update_item_loc(z,D_.MIndex,D_.SIndex,le,ne,De,W,ie,je,te,ge,V,g_pog_json,b,n,S)}if(void 0===ve){for(const E_ of g)g_pog_json[n].ModuleInfo[E_.MIndex].ShelfInfo[E_.SIndex].ItemInfo[E_.IIndex].X=E_.X,g_pog_json[n].ModuleInfo[E_.MIndex].ShelfInfo[E_.SIndex].ItemInfo[E_.IIndex].Y=E_.Y;x="N",T="N",g[B].Valid="N";break}if("PEGBOARD"!==Pe&&("CHEST"==Pe&&"N"==g_chest_as_pegboard||"CHEST"!==Pe))var[Ye,Ae]=get_item_xy(g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae],je,je.W,je.H,g_pog_json);else Ae=V,"Y"==g_pegbrd_auto_placing&&"PEGBOARD"==Pe||"PEGBOARD"!==Pe&&"CHEST"!==Pe?je.Edited="Y":je.Edited="N",je.FromProductList="Y","CHEST"==Pe&&"Y"==g_chest_as_pegboard&&(je.FromProductList="N"),je.Exists="N";g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].Y,g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].H;if("SHELF"==Pe||"PALLET"==Pe){if(void 0===je.BottomObjID||""==je.BottomObjID)"Y"==ye?(g_pog_json[n].ModuleInfo[D_.MIndex].ShelfInfo[D_.SIndex].ItemInfo[De].BottomObjID=g_pog_json[n].ModuleInfo[z].ShelfInfo[le].ItemInfo[He].ObjID,g_pog_json[n].ModuleInfo[z].ShelfInfo[le].ItemInfo[He].TopObjID=g_pog_json[n].ModuleInfo[D_.MIndex].ShelfInfo[D_.SIndex].ItemInfo[De].ObjID,je.TopItem="Y",je.Edited="Y",je.BottomObjID=g_pog_json[n].ModuleInfo[z].ShelfInfo[le].ItemInfo[He].ObjID,g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ItemInfo[He].BelowItem="Y",Ae=g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ItemInfo[He].Y+g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ItemInfo[He].H/2+je.H/2):je.TopItem="N",je.Y=Ae;else if(void 0!==je.BottomObjID&&""!==je.BottomObjID){var Fe="N",Le=g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ItemInfo;for(const v_ of Le)if(v_.ObjID==je.BottomObjID){je.Y=v_.Y+v_.H/2+je.H/2,Fe="Y";break}if("N"==Fe){je.BottomObjID="",je.Y=Ae;reset_bottom_item(D_.MIndex,D_.SIndex,De,z,le,-1,S)}}}else if("N"==g_delete_details.multi_carpark_ind)reset_bottom_item(D_.MIndex,D_.SIndex,De,z,le,-1,S);var[Y,A]=getCombinationShelf(n,g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].Shelf);if(-1!==Y&&-1!==A){if(currCombination=g_combinedShelfs[Y],currCombination.length>1&&m!=Y)for(obj of(m=Y,currCombination))f.push(JSON.parse(JSON.stringify(g_pog_json[obj.PIndex].ModuleInfo[obj.MIndex].ShelfInfo[obj.SIndex])))}else P!=Ne&&C!=ae&&(P=Ne,C=ae,f.push(JSON.parse(JSON.stringify(g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae]))));De=-1;if("Y"==g_delete_details.multi_carpark_ind)$.each(g_pog_json[S].ModuleInfo[D_.MIndex].Carpark[0].ItemInfo,(function(e,_){if(_.ObjID==D_.ObjID)return De=e,!1})),g_pog_json[S].ModuleInfo[D_.MIndex].Carpark[0].ItemInfo.splice(De,1);else if($.each(g_pog_json[S].ModuleInfo[D_.MIndex].ShelfInfo[D_.SIndex].ItemInfo,(function(e,_){if(_.ObjID==D_.ObjID)return De=e,!1})),-1==De){var[Y,A]=getCombinationShelf(n,g_pog_json[n].ModuleInfo[D_.MIndex].ShelfInfo[D_.SIndex].Shelf);if(-1!==Y&&-1!==A)for(var $e of g_combinedShelfs[Y])$.each(g_pog_json[S].ModuleInfo[$e.MIndex].ShelfInfo[$e.SIndex].ItemInfo,(function(e,_){if(_.ObjID==D_.ObjID)return De=w,g_pog_json[S].ModuleInfo[$e.MIndex].ShelfInfo[$e.SIndex].ItemInfo.splice(e,1),!1}))}else g_pog_json[S].ModuleInfo[D_.MIndex].ShelfInfo[D_.SIndex].ItemInfo.splice(De,1);B>0&&(ve+=1);var Be=set_item_after_drag(Pe,Te,Ne,ae,ve,je,n),we=B==g.length-1?"Y":"N",[Ne,ae,Be]=await set_combine_items_after_drag(Ne,ae,n,Be,D_.MIndex,D_.SIndex,D_.IIndex,S,W,we);g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ItemInfo[Be].Exists="N",g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ItemInfo[Be].Dragged="N","CHEST"==Pe&&"Y"==g_chest_as_pegboard&&"PEGBOARD"===Pe||(g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ItemInfo[Be].Edited="N"),("F"==Te||je.CrushHoriz>0&&("CHEST"!=Pe||"Y"!=g_chest_as_pegboard))&&$.each(g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ItemInfo,(function(e,_){_.W=_.RW}));var Xe="N";l.push(wpdSetFixed(je.W)),i.push(wpdSetFixed(je.H)),d.push(wpdSetFixed(je.D)),a.push(Be);var Ge=g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ItemInfo[Be],We=g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].HorizGap;if(void 0===je.BottomObjID||""==je.BottomObjID){if("R"!==Te){var ke=get_item_xaxis(Ge.W,Ge.H,Ge.D,Pe,W,We,Te,We,Ne,ae,Be,"Y",g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ItemInfo.length,"N",n);g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ItemInfo[Be].X=ke}Ge=g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ItemInfo[Be];void 0!==je.BottomObjID&&""!=je.BottomObjID||void 0!==je.TopObjID&&""!=je.TopObjID||"Y"==g_max_facing_enabled&&reset_auto_crush(Ne,ae,Be,n,Ne,ae,n),"CHEST"==Pe&&"Y"==g_chest_as_pegboard||"PEGBOARD"==Pe||(Xe=update_validate_item_height(Ge,Ne,ae,Be,W,Pe,ke,n)),void 0!==je.BottomObjID&&""!=je.BottomObjID||void 0!==je.TopObjID&&""!=je.TopObjID||await set_auto_facings(Ne,ae,Be,Ge,"B","I","D",n)}if("PEGBOARD"==g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ObjType?(Ge.Exists="N",Ge.X=W,Ge.Y=V):"PALLET"==g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ObjType?(Ge.Exists="N",Ge.Dragged="N"):"N"!==Ge.Fixed&&(Ge.X=W),!(void 0!==je.BottomObjID&&""!=je.BottomObjID||void 0!==je.TopObjID&&""!=je.TopObjID||"PEGBOARD"===g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ObjType||"CHEST"==g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ObjType&&"Y"==g_chest_as_pegboard)){Ge=g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ItemInfo[Be];var[Ye,Ae]=get_item_xy(g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae],Ge,Ge.W,Ge.H,n);g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ItemInfo[Be].Y=Ae}if("F"!=Xe&&"N"!=Xe||!validate_items(l,i,d,a,Pe,Ne,ae,Be,Ce,je.CrushHoriz,je.CrushVert,je.CrushD,W,Me,"N","Y",ye,"N",D,"Y","Y","Y",n,"N","Y")){g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ItemInfo[Be].X=D_.OldItemX,g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ItemInfo[Be].Y=D_.OldItemY,xe.X=D_.OldItemX,xe.Y=D_.OldItemY,0==Be?g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ItemInfo.splice(Be,Be+1):g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ItemInfo.splice(Be,1),"Y"==g_delete_details.multi_carpark_ind?g_pog_json[S].ModuleInfo[D_.MIndex].Carpark[0].ItemInfo.splice(D_.IIndex,0,xe):g_pog_json[S].ModuleInfo[D_.MIndex].ShelfInfo[D_.SIndex].ItemInfo.splice(D_.IIndex,0,xe),k=0;for(const N_ of g)k>B&&("Y"==g_delete_details.multi_carpark_ind?($.each(g_pog_json[S].ModuleInfo[N_.MIndex].Carpark[0].ItemInfo,(function(e,_){if(_.ObjID==N_.ObjID)return Be=e,!1})),g_pog_json[S].ModuleInfo[N_.MIndex].Carpark[0].ItemInfo[Be].X=N_.XAxis,g_pog_json[S].ModuleInfo[N_.MIndex].Carpark[0].ItemInfo[Be].Y=N_.YAxis):($.each(g_pog_json[S].ModuleInfo[N_.MIndex].ShelfInfo[N_.SIndex].ItemInfo,(function(e,_){if(_.ObjID==N_.ObjID)return Be=e,!1})),g_pog_json[S].ModuleInfo[N_.MIndex].ShelfInfo[N_.SIndex].ItemInfo[Be].X=N_.XAxis,g_pog_json[S].ModuleInfo[N_.MIndex].ShelfInfo[N_.SIndex].ItemInfo[Be].Y=N_.YAxis)),k+=1;var Ve="Y"==g_delete_details.multi_carpark_ind?g_pog_json[S].ModuleInfo[D_.MIndex].Carpark[0].ItemInfo:g_pog_json[S].ModuleInfo[D_.MIndex].ShelfInfo[D_.SIndex].ItemInfo;Ee={X:"asc"};Ve.keySort(Ee),x="N",g[B].Valid="N";break}g_pog_json[n].ModuleInfo[Ne].ShelfInfo[ae].ItemInfo[Be].Exists="E",g[B].Valid="Y",g[B].newItemIndex=Be,g[B].newModIndex=Ne,g[B].newShelfIndex=ae,shelf_info={},shelf_info.OldModuleIndex=D_.MIndex,shelf_info.OldShelfIndex=D_.SIndex,shelf_info.OldItemIndex=D_.IIndex,shelf_info.OldObjectType=D_.ObjType,shelf_info.SIndex=ae,shelf_info.MIndex=Ne,shelf_info.ObjType=Pe,shelf_info.IIndex=Be,shelf_info.ObjID=D_.ObjID,shelf_info.OldInfo=xe,shelf_info.IsDivider=D_.IsDivider,shelf_info.XAxis=D_.XAxis,shelf_info.YAxis=D_.YAxis,shelf_info.ZAxis=D_.ZAxis,shelf_info.OldItemX=D_.OldItemX,shelf_info.OldItemY=D_.OldItemY,I.push(shelf_info)}B+=1}}if(I.length>0&&(s=I.filter((function(e){var _=e.SIndex+"|"+e.MIndex;if(!this[_])return this[_]=!0,!0}),Object.create(null)),r=I.filter((function(e){var _=e.OldShelfIndex+"|"+e.OldModuleIndex;if(!this[_])return this[_]=!0,!0}),Object.create(null))),"Y"==x&&(g.length>0||t.length>0)&&"Y"==M){B=0,g_undo_details=[],g_undo_obj_arr=[],g_undo_supp_obj_arr=[],g_pog_edited_ind="Y";B=0;for(const P_ of t){W=e+P_.XDistance,V=_+P_.YDistance;var Ue=-1;w=0;for(const C_ of g_pog_json[S].ModuleInfo[P_.MIndex].ShelfInfo){if(C_.SObjID==P_.ObjID){Ue=w;break}w++}var ze="N";if("TEXTBOX"!==g_shelf_object_type)var[Y,A]=getCombinationShelf(n,g_pog_json[n].ModuleInfo[P_.MIndex].ShelfInfo[P_.SIndex].Shelf);var Y=-1,A=-1;try{g_pog_json&&g_pog_json[n]&&g_pog_json[n].ModuleInfo&&g_pog_json[n].ModuleInfo[P_.MIndex]&&g_pog_json[n].ModuleInfo[P_.MIndex].ShelfInfo&&void 0!==g_pog_json[n].ModuleInfo[P_.MIndex].ShelfInfo[P_.SIndex]?[Y,A]=getCombinationShelf(n,g_pog_json[n].ModuleInfo[P_.MIndex].ShelfInfo[P_.SIndex].Shelf):logDebug("Warning: missing ShelfInfo for getCombinationShelf (multi_drag_setup)","W")}catch(R_){logDebug("Error calling getCombinationShelf: "+R_,"E")}-1!==Y&&(ze="Y"),g_pog_json&&g_pog_json[n]&&g_pog_json[n].ModuleInfo&&g_pog_json[n].ModuleInfo[P_.MIndex]&&g_pog_json[n].ModuleInfo[P_.MIndex].ShelfInfo&&void 0!==g_pog_json[n].ModuleInfo[P_.MIndex].ShelfInfo[P_.SIndex]&&(g_pog_json[n].ModuleInfo[P_.MIndex].ShelfInfo[P_.SIndex].Combine="N"),"TEXTBOX"!==g_shelf_object_type&&await generateCombinedShelfs(n,P_.MIndex,P_.SIndex,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y","","Y");var[ee,Ze]=await set_shelf_after_drag("Y"==ze?"R":P_.Valid,"Y",P_.MIndex,P_.CurrModIndex,Ue,W,V,"Y","Y",g_start_canvas!==g_present_canvas?P_.MIndex:"",g_start_canvas!==g_present_canvas?Ue:"",g_start_canvas,n,Y),Je=-1;w=0;for(const y_ of g_pog_json[n].ModuleInfo[ee].ShelfInfo){if(y_.SObjID==P_.ObjID){Je=w;break}w++}if(await set_all_items(ee,Je,W,V,"Y","N","Y",n,n),t[B].newItemIndex=-1,t[B].newModIndex=ee,t[B].newShelfIndex=Je,"Y"==g_show_notch_label)update_single_notch_label("Y",ee,Ze,$v("P25_NOTCH_HEAD"),"",n,"N");g_intersected=[];var Ke=g_pog_json[n].ModuleInfo[ee].ShelfInfo[Ze],qe=g_scene_objects[n].scene.children[2].getObjectById(Ke.SObjID);g_intersected.push(qe);for(const H_ of Ke.ItemInfo){var Qe=g_scene_objects[n].scene.children[2].getObjectById(H_.ObjID);g_intersected.push(Qe)}B++}render_animate_selected();for(const Y_ of I)if("Y"==Y_.IsDivider){shelf_arr=g_pog_json[n].ModuleInfo[Y_.OldModuleIndex].ShelfInfo;B=0;for(const A_ of shelf_arr){if(A_.Shelf==Y_.ItemID){A_;break}B++}}var e_={};for(const F_ of s){var __=g_pog_json[n].ModuleInfo[F_.MIndex].ShelfInfo[F_.SIndex].SpreadItem;Ve=g_pog_json[n].ModuleInfo[F_.MIndex].ShelfInfo[F_.SIndex].ItemInfo,We=g_pog_json[n].ModuleInfo[F_.MIndex].ShelfInfo[F_.SIndex].HorizGap,Te=g_pog_json[n].ModuleInfo[F_.MIndex].ShelfInfo[F_.SIndex].SpreadItem;if(g_pog_json[n].ModuleInfo[F_.MIndex].ShelfInfo[F_.SIndex].ItemInfo.length>0){B=0;for(const L_ of Ve){ke=get_item_xaxis(L_.W,L_.H,L_.D,g_pog_json[n].ModuleInfo[F_.MIndex].ShelfInfo[F_.SIndex].ObjType,-1,We,Te,We,F_.MIndex,F_.SIndex,B,"Y",g_pog_json[n].ModuleInfo[F_.MIndex].ShelfInfo[F_.SIndex].ItemInfo.length,"N",n);g_pog_json[n].ModuleInfo[F_.MIndex].ShelfInfo[F_.SIndex].ItemInfo[B].X=ke,B++}}if("F"==__){B=0;for(const $_ of g_pog_json[n].ModuleInfo[F_.MIndex].ShelfInfo[F_.SIndex].ItemInfo)$_.W=$_.RW,("PEGBOARD"==g_pog_json[n].ModuleInfo[F_.MIndex].ShelfInfo[F_.SIndex].ObjType||"CHEST"==g_pog_json[n].ModuleInfo[F_.MIndex].ShelfInfo[F_.SIndex].ObjType&&"Y"==g_chest_as_pegboard)&&($_.Exists="E"),B++}if(reorder_items(F_.MIndex,F_.SIndex,n)){await recreate_all_items(F_.MIndex,F_.SIndex,F_.ObjType,"Y",e,-1,g_pog_json[n].ModuleInfo[F_.MIndex].ShelfInfo[F_.SIndex].ItemInfo.length,"N","N",-1,-1,g_present_canvas,"",n,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y"),e_.NewModuleIndex=F_.MIndex,e_.NewShelfIndex=F_.SIndex,undoObjectsInfo=[];var[Y,A]=getCombinationShelf(n,g_pog_json[n].ModuleInfo[F_.MIndex].ShelfInfo[F_.SIndex].Shelf);if(-1!==Y){if(undoObjectsInfo.CombineInd="Y",undoObjectsInfo.CombShelfIndex=A,currCombination=g_combinedShelfs[Y],currCombination.length>1)for(obj of f)undoObjectsInfo.push(obj)}else undoObjectsInfo.push(JSON.parse(JSON.stringify(E[0][F_.MIndex].ShelfInfo[F_.SIndex])));e_.NewModuleIndex=F_.MIndex,e_.NewShelfIndex=F_.SIndex,undoObjectsInfo.moduleIndex=F_.MIndex,undoObjectsInfo.module=E[0][F_.MIndex].Module,undoObjectsInfo.moduleObjectID=E[0][F_.MIndex].MObjID,undoObjectsInfo.shelfIndex=F_.SIndex,undoObjectsInfo.actionType="ITEM_DELETE",undoObjectsInfo.startCanvas=g_present_canvas,undoObjectsInfo.objectID=E[0][F_.MIndex].ShelfInfo[F_.SIndex].SObjID,g_allUndoObjectsInfo.push(undoObjectsInfo),undoObjectsInfo=[],j="ITEM_DELETE";var o_=g_pog_json[n].ModuleInfo[F_.MIndex].ShelfInfo[F_.SIndex].ItemInfo;"CHEST"==g_pog_json[n].ModuleInfo[F_.MIndex].ShelfInfo[F_.SIndex].ObjType&&"Y"==g_chest_as_pegboard&&(g_pog_json[n].ModuleInfo[F_.MIndex].ShelfInfo[F_.SIndex].ChestEdit="Y");Ee={X:"asc",Y:"asc"};o_.keySort(Ee);for(const B_ of o_)B_.Edited="Y",B_.FromProductList="N",B_.Exists="E"}if(g_intersected=[],void 0!==g){for(const w_ of g)for(const X_ of o_)if(w_.ObjID==X_.OldObjID){Qe=g_scene_objects[n].scene.children[2].getObjectById(X_.ObjID);g_intersected.push(Qe)}render_animate_selected()}}for(const G_ of r)if("Y"==g_delete_details.multi_carpark_ind){if(e_.MIndex=G_.OldModuleIndex,e_.SIndex=G_.OldShelfIndex,undoObjectsInfo=[],undoObjectsInfo.moduleIndex=G_.OldModuleIndex,undoObjectsInfo.module=g_temp_cut_arr[0][G_.OldModuleIndex].Module,undoObjectsInfo.moduleObjectID=g_temp_cut_arr[0][G_.OldModuleIndex].MObjID,undoObjectsInfo.shelfIndex=G_.OldShelfIndex,undoObjectsInfo.IsCarpark="Y",undoObjectsInfo.actionType="ITEM_DELETE",undoObjectsInfo.startCanvas=g_start_canvas,undoObjectsInfo.push(JSON.parse(JSON.stringify(g_temp_cut_arr[0][G_.OldModuleIndex].Carpark[0]))),undoObjectsInfo.objectID=g_temp_cut_arr[0][G_.OldModuleIndex].Carpark[0].SObjID,g_allUndoObjectsInfo.push(undoObjectsInfo),j="ITEM_DELETE",void 0!==g_pog_json[S].ModuleInfo[G_.OldModuleIndex].Carpark[0]&&0==g_pog_json[S].ModuleInfo[G_.OldModuleIndex].Carpark[0].ItemInfo.length&&"Y"==g_delete_details.multi_carpark_ind){var n_=g_world.getObjectById(g_pog_json[S].ModuleInfo[G_.OldModuleIndex].Carpark[0].SObjID);g_world.remove(n_),g_pog_json[S].ModuleInfo[G_.OldModuleIndex].Carpark.splice(0,1)}}else{if("F"==(__=g_pog_json[S].ModuleInfo[G_.OldModuleIndex].ShelfInfo[G_.OldShelfIndex].SpreadItem)){B=0;for(const W_ of g_pog_json[S].ModuleInfo[G_.OldModuleIndex].ShelfInfo[G_.OldShelfIndex].ItemInfo)W_.W=W_.RW,B++}if(reorder_items(G_.OldModuleIndex,G_.OldShelfIndex,S)){await recreate_all_items(G_.OldModuleIndex,G_.OldShelfIndex,G_.OldObjectType,"Y",e,-1,g_pog_json[S].ModuleInfo[G_.OldModuleIndex].ShelfInfo[G_.OldShelfIndex].ItemInfo.length,"N","N",-1,-1,g_start_canvas,"",S,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y"),e_.MIndex=G_.OldModuleIndex,e_.SIndex=G_.OldShelfIndex,undoObjectsInfo=[];var[Y,A]=getCombinationShelf(S,g_pog_json[S].ModuleInfo[G_.OldModuleIndex].ShelfInfo[G_.OldShelfIndex].Shelf);if(-1!==Y){if(undoObjectsInfo.CombineInd="Y",undoObjectsInfo.CombShelfIndex=A,currCombination=g_combinedShelfs[Y],currCombination.length>1)for(obj of p)undoObjectsInfo.push(obj)}else undoObjectsInfo.push(JSON.parse(JSON.stringify(g_temp_cut_arr[0][G_.OldModuleIndex].ShelfInfo[G_.OldShelfIndex])));undoObjectsInfo.moduleIndex=G_.OldModuleIndex,undoObjectsInfo.module=g_temp_cut_arr[0][G_.OldModuleIndex].Module,undoObjectsInfo.moduleObjectID=g_temp_cut_arr[0][G_.OldModuleIndex].MObjID,undoObjectsInfo.shelfIndex=G_.OldShelfIndex,undoObjectsInfo.IsCarpark="N",undoObjectsInfo.actionType="ITEM_DELETE",undoObjectsInfo.startCanvas=g_start_canvas,undoObjectsInfo.objectID=g_temp_cut_arr[0][G_.OldModuleIndex].ShelfInfo[G_.OldShelfIndex].SObjID,g_allUndoObjectsInfo.push(undoObjectsInfo),j="ITEM_DELETE","CHEST"==g_pog_json[S].ModuleInfo[G_.OldModuleIndex].ShelfInfo[G_.OldShelfIndex].ObjType&&"Y"==g_chest_as_pegboard&&(g_pog_json[S].ModuleInfo[G_.OldModuleIndex].ShelfInfo[G_.OldShelfIndex].ChestEdit="Y")}}render(S);var t_=-1,g_=-1,l_=-1;for(B of g_allUndoObjectsInfo)t_!==B.moduleIndex||g_!==B.shelfIndex||l_!==B.startCanvas?(t_=B.moduleIndex,g_=B.shelfIndex,l_=B.startCanvas):g_allUndoObjectsInfo.splice(B,1);[].push(e_),await recreate_compare_views(g_compare_view,"N")}else if("N"==x&&(g.length>0||t.length>0)||"N"==M){var i_,d_;B=0;if("Y"==T)for(const k_ of I){De=-1,w=0;for(const V_ of g_pog_json[S].ModuleInfo[k_.MIndex].ShelfInfo[k_.SIndex].ItemInfo){if(V_.ObjID==k_.ObjID){De=w;break}w++}0==De?g_pog_json[S].ModuleInfo[k_.MIndex].ShelfInfo[k_.SIndex].ItemInfo.splice(De,De+1):g_pog_json[S].ModuleInfo[k_.MIndex].ShelfInfo[k_.SIndex].ItemInfo.splice(De,1),k_.OldInfo.X=k_.OldItemX,k_.OldInfo.Y=k_.OldItemY,"Y"==g_delete_details.multi_carpark_ind?(g_pog_json[S].ModuleInfo[k_.OldModuleIndex].Carpark[0].SpreadItem,g_pog_json[S].ModuleInfo[k_.OldModuleIndex].Carpark[0].ItemInfo.splice(k_.IIndex,0,k_.OldInfo)):(g_pog_json[S].ModuleInfo[k_.OldModuleIndex].ShelfInfo[k_.OldShelfIndex].SpreadItem,g_pog_json[S].ModuleInfo[k_.OldModuleIndex].ShelfInfo[k_.OldShelfIndex].ItemInfo.splice(k_.IIndex,0,k_.OldInfo)),B+=1;Ve="Y"==g_delete_details.multi_carpark_ind?g_pog_json[S].ModuleInfo[k_.OldModuleIndex].Carpark[0].ItemInfo:g_pog_json[S].ModuleInfo[k_.OldModuleIndex].ShelfInfo[k_.OldShelfIndex].ItemInfo,Ee={X:"asc",Y:"asc"};Ve.keySort(Ee)}i_=g_scene_objects[g_present_canvas].scene.children[2],d_=g_scene_objects[g_start_canvas].scene.children[2];w=0;g_world=d_;for(const U_ of g_multi_drag_item_arr){$.each(g_pog_json[S].ModuleInfo[U_.MIndex].ShelfInfo[U_.SIndex].ItemInfo,(function(e,_){if(_.ObjID==U_.ObjID)return De=e,!1})),g_pog_json[S].ModuleInfo[U_.MIndex].ShelfInfo[U_.SIndex].ItemInfo[De].X=U_.XAxis,g_pog_json[S].ModuleInfo[U_.MIndex].ShelfInfo[U_.SIndex].ItemInfo[De].Y=U_.YAxis;pe=i_.getObjectById(U_.ObjID);if(g_pog_json[S].ModuleInfo[U_.MIndex].ShelfInfo[U_.SIndex].ItemInfo.length>0){var[ce,ue]=await create_drag_objects(U_.MIndex,U_.SIndex,De,U,g_pog_json[S].ModuleInfo[U_.MIndex].ShelfInfo[U_.SIndex].ItemInfo[De],g_show_live_image,"ITEM",pe,g_start_canvas,g_present_canvas);ce.position.x=U_.XAxis,ce.position.y=U_.YAxis,i_.remove(pe),ce.updateMatrix()}w++}w=-1;for(const z_ of g_multi_drag_shelf_arr){async function me(){var e=g_pog_json[S].ModuleInfo[z_.MIndex].ShelfInfo[z_.SIndex],_=i_.getObjectById(z_.ObjID);[l,newObjId]=await create_drag_objects(z_.MIndex,z_.SIndex,z_.IIndex,e,e.ItemInfo,g_show_live_image,"SHELF",_,g_start_canvas,g_present_canvas),i_.remove(_),(_=l).updateMatrix();g_drag_items_arr=[];var o=0;for(const _ of e.ItemInfo){var t=g_scene_objects[n].scene.children[2].getObjectById(_.ObjID);void 0!==t&&("CHEST"==g_shelf_object_type&&"Y"==g_chest_as_pegboard?(t.PegBoardX=_.PegBoardX,t.PegBoardY=_.PegBoardY):"PEGBOARD"!==g_shelf_object_type?t.Distance=_.Distance:(t.PegBoardX=_.PegBoardX,t.PegBoardY=_.PegBoardY),t.ItemInfo=_,t.IIndex=o,t.StartCanvas=g_start_canvas,t.MIndex=z_.MIndex,t.SIndex=z_.SIndex,t.XAxis=e.X,t.YAxis=e.Y,g_drag_items_arr.push(t)),o++}var g=[];if(g_drag_items_arr.length>0){for(const e of g_drag_items_arr){i_.remove(e);var[l,i]=await create_drag_objects(e.MIndex,e.SIndex,e.IIndex,e.ShelfInfo,e.ItemInfo,g_show_live_image,"ITEM",e,g_start_canvas,g_present_canvas);g.push(l)}g.length>0&&(g_drag_items_arr=[],g_drag_items_arr=g),set_inter_canvas_items(z_.XAxis,z_.YAxis,_,g,_.W,_.H,g_shelf_object_type,g_shelf_basket_spread,_.Rotation,_.ItemSlope,z_.SIndex,z_.MIndex,n)}}w++,await me()}render(g_start_canvas),g_world=i_,render(n),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],cut_copy_arr1=[],g_undo_details=[],g_mselect_drag="N",g_multiselect="N",g_ctrl_select="N",g_undo_all_obj_arr=[],g_temp_cut_arr=[],g_select_zoom_arr=[]}if("Y"==x&&"Y"==M){g_cut_copy_arr=[];B=0;for(det of t)undoObjectsInfo=[],undoObjectsInfo.moduleIndex=det.MIndex,undoObjectsInfo.shelfIndex=det.SIndex,undoObjectsInfo.actionType="SHELF_DRAG",undoObjectsInfo.objectID=det.ObjID,j="SHELF_DRAG",void 0!==det.ShelfInfo&&void 0!==det.ShelfInfo[B]?(undoObjectsInfo.push(JSON.parse(JSON.stringify(det.ShelfInfo[B]))),undoObjectsInfo.moduleObjectID=E[0][det.newModIndex].MObjID,undoObjectsInfo.startCanvas=S,undoObjectsInfo.g_present_canvas=O,g_allUndoObjectsInfo.push(undoObjectsInfo)):(undoObjectsInfo.module=g_temp_cut_arr[0][det.MIndex].Module,undoObjectsInfo.startCanvas=S,undoObjectsInfo.g_present_canvas=O,undoObjectsInfo.moduleObjectID=E[0][det.newModIndex].MObjID,undoObjectsInfo.push(JSON.parse(JSON.stringify(g_temp_cut_arr[0][det.MIndex].ShelfInfo[det.SIndex]))),g_allUndoObjectsInfo.push(undoObjectsInfo)),B++;if(g.length>0){oldworld=g_scene_objects[n].scene.children[2]}else;B=0;for(c of g_cut_copy_arr){for(u of g_undo_details)c.OldObjID==u.ObjID&&(g_undo_details[B].ObjID=c.ObjID);B++}g_delete_details.multi_delete_shelf_ind="N",logFinalUndoObjectsInfo(j,"U",g_allUndoObjectsInfo,"","Y","N","N","N","N","Y"),g_allUndoObjectsInfo=[]}if(await calculateFixelAndSupplyDays("N",g_start_canvas),await calculateFixelAndSupplyDays("N",g_present_canvas),g_select_zoom_arr=[],g_mselect_drag="N","N"==g_manual_zoom_ind){var a_=get_min_max_xy(n).split("###");set_camera_z(o,parseFloat(a_[2]),parseFloat(a_[3]),parseFloat(a_[0]),parseFloat(a_[1]),g_offset_z,parseFloat(a_[4]),parseFloat(a_[5]),!1,n)}render(n),render(g_start_canvas),S!==O?animate_all_pog():animate_pog(n)}return logDebug("function : multi_drag_setup","E"),"SUCCESS"}catch(Z_){error_handling(Z_)}}function reset_bottom_item(e,_,o,n,t,g,l){try{logDebug("function : reset_bottom_item; p_module_index : "+e+"; p_shelf_index : "+_+"; i_item_index : "+o+"; curr_module : "+n+"; div_shelf_index : "+t+"; i_final_x : "+g,"S");var i=g_pog_json[l].ModuleInfo[e].ShelfInfo[_].ItemInfo[o].BottomObjID,d=g_pog_json[l].ModuleInfo[e].ShelfInfo[_].ItemInfo[o].TopObjID;if(n!==e||_!==t){if(""!==i&&void 0!==i){var a=0;for(const o of g_pog_json[l].ModuleInfo[e].ShelfInfo[_].ItemInfo){if(i==o.ObjID){g_pog_json[l].ModuleInfo[e].ShelfInfo[_].ItemInfo[a].TopObjID="";break}a++}g_pog_json[l].ModuleInfo[e].ShelfInfo[_].ItemInfo[o].BottomObjID=""}else if(void 0!==d&&""!==d){a=0;for(const o of g_pog_json[l].ModuleInfo[e].ShelfInfo[_].ItemInfo){if(d==o.ObjID){g_pog_json[l].ModuleInfo[e].ShelfInfo[_].ItemInfo[a].BottomObjID="",g_pog_json[l].ModuleInfo[e].ShelfInfo[_].ItemInfo[a].Y=g_pog_json[l].ModuleInfo[e].ShelfInfo[_].Y+g_pog_json[l].ModuleInfo[e].ShelfInfo[_].H/2+o.H/2;break}a++}g_pog_json[l].ModuleInfo[e].ShelfInfo[_].ItemInfo[o].TopObjID=""}}else{if(""!==d&&void 0!==d&&""!==i&&void 0!==i){a=0;for(const o of g_pog_json[l].ModuleInfo[e].ShelfInfo[_].ItemInfo){if(d==o.ObjID){g_pog_json[l].ModuleInfo[e].ShelfInfo[_].ItemInfo[a].BottomObjID=i,g_pog_json[l].ModuleInfo[e].ShelfInfo[_].ItemInfo[a].Y=g_pog_json[l].ModuleInfo[e].ShelfInfo[_].ItemInfo[get_shelf_item_ind(e,_,i,l)].H+g_pog_json[l].ModuleInfo[e].ShelfInfo[_].Y+g_pog_json[l].ModuleInfo[e].ShelfInfo[_].H/2+o.H/2;break}a++}}else{a=0;for(const o of g_pog_json[l].ModuleInfo[e].ShelfInfo[_].ItemInfo){if(d==o.ObjID){g_pog_json[l].ModuleInfo[e].ShelfInfo[_].ItemInfo[a].BottomObjID="",g_pog_json[l].ModuleInfo[e].ShelfInfo[_].ItemInfo[a].Y=g_pog_json[l].ModuleInfo[e].ShelfInfo[_].Y+g_pog_json[l].ModuleInfo[e].ShelfInfo[_].H/2+o.H/2;break}a++}}if(g_pog_json[l].ModuleInfo[e].ShelfInfo[_].ItemInfo[o].X=g,"SHELF"==g_pog_json[l].ModuleInfo[e].ShelfInfo[_].ObjType||"PALLET"==g_pog_json[l].ModuleInfo[e].ShelfInfo[_].ObjType)reset_top_bottom_objects(e,_,"N",l)}return logDebug("function : reset_bottom_item","E"),"SUCCESS"}catch(e){error_handling(e)}}async function doMouseUp(e,_,o,n,t,g,l,i){logDebug("function : doMouseUp; x : "+e+"; y : "+_+"; prevX : "+n+"; prevY : "+t,"S");try{var d,a,s,f=g.width,I=g.height,r=2*e/f-1,p=1-2*_/I;if(g_raycaster.setFromCamera(new THREE.Vector2(r,p),l),g_intersects=g_raycaster.intersectObject(g_targetForDragging),0==g_intersects.length)return;d=g_intersects[0].point.x,a=g_intersects[0].point.y,s=g_intersects[0].point.z;var c=new THREE.Vector3(d,a,s);g_scene_objects[i].scene.children[2].worldToLocal(c);var u=Math.min(19,Math.max(-19,c.x)),m=Math.min(19,Math.max(-19,c.y)),h=g_drag_z;if("Y"==g_shelf_edit_flag){if("SHELF"==g_shelf_object_type)var S=wpdSetFixed(g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X-g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].W/2),O=wpdSetFixed(g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X+g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].W/2),x=wpdSetFixed(g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y+g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].H/2),M=wpdSetFixed(g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y-g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].H/2),T=textboxHit(g_start_canvas,g_module_index,g_shelf_index,S,O,x,M,"N"),b=isShelfOnPegboard(g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X,g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y,g_module_index,g_start_canvas,g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index],g_pog_json);("Y"==g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].InsidePegboard||b||T)&&"SHELF"==g_shelf_object_type?g_dragItem.position.z=T?.00115:.016:"PEGBOARD"==g_shelf_object_type||"CHEST"==g_shelf_object_type&&"Y"==g_chest_as_pegboard?g_dragItem.position.z=.00115:"ROD"==g_shelf_object_type?g_dragItem.position.z=.005:"TEXTBOX"!==g_shelf_object_type&&(0!=g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Slope||0!=g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Rotation?g_dragItem.position.z=g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].D/2+5e-4:g_dragItem.position.z=5e-4,g_drag_z=5e-4)}if(g_delete_details.length>0&&"Y"==g_duplicating?g_multiItemCopy="Y":g_multiItemCopy="N","undefined"!=typeof g_pog_json&&g_pog_json.length>0&&(g_selecting&&"Y"==g_multiselect&&"N"==g_shift_mutli_item_select?(g_duplicating="N",await get_multiselect_obj(i),"Y"==g_area_zoom_ind?(select_zoom(l,i),g_area_zoom_ind="N",g_multiselect="N",g_ctrl_select="N"):set_multi_blink(g_pog_json,i),g_selecting=!1,g_selection.style.visibility="hidden"):"Y"==g_shift_mutli_item_select&&multiSelectItemsWithShift(i,g_multi_select_offset_perc)),$("#maincanvas").css("cursor","auto"),"Y"==g_auto_fill_active){if([g_autofillModInfo,g_autofillShelfInfo]=getAutofillModShelf(g_DragMouseStart,g_DragMouseEnd,g_pog_json,g_pog_index),g_autofillShelfInfo.length>=1)apex.region("block_filters").widget().interactiveGrid("getActions").set("edit",!1),apex.region("block_filters").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("block_filters").refresh(),apex.event.trigger("#P25_BLK_RULE","apexrefresh"),$s("P25_BLK_NAME",""),$s("P25_BLK_COLOR",randomColor()),$s("P25_BLK_FILTER",""),$("#ADD_BLK").css("display","inline"),$("#SAVE_BLK").css("display","inline"),$("#UPDATE_BLK").css("display","none"),openInlineDialog("block_details",40,65);else if("undefined"!=typeof g_dragItem&&null!=g_dragItem&&"Y"==g_drag_inprogress&&(g_dragItem.length&&g_dragItem.length>0||void 0!==g_dragItem.uuid||"object"==typeof g_dragItem)){var D;if(void 0===(D=getAutoFillCurrModule(u,m,g_module_index,i))||-1===D){try{var E=null;if(g_dragItem&&(void 0!==g_dragItem.uuid?E=g_dragItem.uuid:g_dragItem.length&&g_dragItem.length>0&&g_dragItem[0]&&void 0!==g_dragItem[0].uuid&&(E=g_dragItem[0].uuid)),E)if((H=g_mod_block_list.filter((function(e){return e.BlkName==E})))&&H.length>0&&H[0].BlockDim){var v=H[0].BlockDim.CalcX,N=H[0].BlockDim.CalcY,P=H[0].BlockDim.CalcZ;g_dragItem&&g_dragItem.position&&"function"==typeof g_dragItem.updateMatrix&&(g_dragItem.position.set(v,N,P),g_dragItem.updateMatrix(),render(i),alert(get_message("VALIDATE_SWAP_BLOCK_MSG")))}}catch(e){}return g_dragItem=void 0,!1}if(void 0!==D&&-1!==D){var C={},R={},y=!1;E=null;if(g_dragItem&&(void 0!==g_dragItem.uuid?E=g_dragItem.uuid:g_dragItem.length&&g_dragItem.length>0&&g_dragItem[0]&&void 0!==g_dragItem[0].uuid&&(E=g_dragItem[0].uuid)),!E)return g_dragItem=void 0,!1;var H=g_mod_block_list.filter((e=>e.BlkName==E));C.x=g_pog_json[i].ModuleInfo[D].X-g_pog_json[i].ModuleInfo[D].W/2,C.y=m+H[0].BlockDim.BlkHeight/2,R.x=g_pog_json[i].ModuleInfo[D].X+g_pog_json[i].ModuleInfo[D].W/2,R.y=m-H[0].BlockDim.BlkHeight/2;var Y=getAutoFillCurrShelf(C,R,D,i);if(void 0!==D&&-1!==D){for(colorObj of g_mod_block_list)if(colorObj.BlkName!==g_dragItem.uuid){var A=colorObj.BlockDim.FinalTop,F=colorObj.BlockDim.FinalBtm,L=g_pog_json[i].ModuleInfo[colorObj.mod_index[0]].X-g_pog_json[i].ModuleInfo[colorObj.mod_index[0]].W/2,B=g_pog_json[i].ModuleInfo[colorObj.mod_index[0]].X+g_pog_json[i].ModuleInfo[colorObj.mod_index[0]].W/2;if(A>m&&F<m&&L<u&&B>u)return await swapColoredBlocks(colorObj,H[0],i),g_dragItem=void 0,y=!0,render(i),!0}if(!y)if(-1===Y){H[0].BlockDim.ColorObj.remove(g_dragItem),H[0].mod_index=[D];var w=await add_module_autofill_color(C,R,[D],H[0].BlkColor,H[0].BlkName,"Y",H[0],i,"Y");H[0].BlockDim=w,await save_blk_dtl_coll("Y","",g_mod_block_list),render(i)}else{v=H[0].BlockDim.CalcX,N=H[0].BlockDim.CalcY,P=H[0].BlockDim.CalcZ;g_dragItem.position.set(v,N,P),g_dragItem.updateMatrix(),render(i),alert(get_message("VALIDATE_SWAP_BLOCK_MSG"))}}else{v=H[0].BlockDim.CalcX,N=H[0].BlockDim.CalcY,P=H[0].BlockDim.CalcZ;g_dragItem.position.set(v,N,P),g_dragItem.updateMatrix(),render(i)}}}}else if("Y"!==g_shift_mutli_item_select&&("Y"==g_mselect_drag&&g_start_canvas==g_present_canvas&&"N"==g_duplicating&&"N"==g_drag_inprogress||"Y"==g_canvas_drag&&"Y"==g_mselect_drag&&g_start_canvas!==g_present_canvas&&"N"==g_duplicating&&"PREV_VERSION"!==g_compare_view)){g_duplicating="N",g_delete_details.is_dragging="Y",g_combineItemModf=[];var X=await multi_drag_setup(u,m,l,i);g_delete_details.is_dragging="N",render(i)}else if("EDIT_PALLET"==g_compare_view&&"Y"==g_item_edit_flag&&"Y"==g_drag_inprogress&&"N"==g_canvas_drag&&g_present_canvas==g_ComViewIndex&&g_ComViewIndex==g_start_canvas)update_item_edit_pallet(u,m,g_module_index,g_shelf_index,g_item_index,g_item_edit_flag,g_ComBaseIndex,g_ComViewIndex);else if("Y"==g_duplicating&&"Y"==g_drag_inprogress&&g_present_canvas!==g_ComViewIndex)if(Array.isArray(g_delete_details)&&g_delete_details.length>1){g_cut_copy_arr=[],g_cut_loc_arr=[];for(const e of g_delete_details){g_cut_support_obj_arr=[],loc_details={};var G=JSON.parse(JSON.stringify(g_pog_json[g_start_canvas].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex]));g_cut_copy_arr.push(G),g_cut_copy_arr[0].OldObjID=g_cut_copy_arr[0].ObjID,g_cut_copy_arr[0].ObjID="",loc_details.MIndex=e.MIndex,loc_details.SIndex=e.SIndex,loc_details.IIndex=e.IIndex,loc_details.ShelfObjType=G.CType||"",loc_details.Item=G.Item||"",loc_details.ModuleEdit="N",loc_details.ShelfEdit="N",loc_details.ItemEdit="Y",loc_details.gPogIndex=g_start_canvas,g_cut_loc_arr.push(loc_details),g_cut_copy_arr[0].loc_details=g_cut_loc_arr}duplicate_drag_obj(u,m,g_module_index,g_shelf_index,g_shelf_edit_flag,g_module_edit_flag,l,g_start_canvas,g_present_canvas,$v("P25_POGCR_MODULE_COPY_WITH_ITEM")),g_delete_details=[]}else duplicate_drag_obj(u,m,g_module_index,g_shelf_index,g_shelf_edit_flag,g_module_edit_flag,l,g_start_canvas,g_present_canvas,$v("P25_POGCR_MODULE_COPY_WITH_ITEM"));else if("Y"==g_canvas_drag&&"Y"==g_drag_inprogress&&g_dragItem.StartCanvas!==g_present_canvas&&"N"==g_duplicating&&("Y"==g_compare_pog_flag&&parseInt(g_present_canvas)==g_ComViewIndex&&"POG"==g_compare_view||"N"==g_compare_pog_flag||"Y"==g_compare_pog_flag&&parseInt(g_present_canvas)!==g_ComViewIndex))multi_canvas_drag(u,m,g_module_index,g_shelf_index,g_shelf_edit_flag,g_module_edit_flag,i);else if(null!=g_dragItem&&"Y"==g_drag_inprogress&&"N"==g_duplicating)if(g_start_canvas!==g_present_canvas&&"Y"==g_drag_inprogress&&"PREV_VERSION"!=g_compare_view){var W=g_pog_json[g_start_canvas].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index];if(g_world=g_scene_objects[g_start_canvas].scene.children[2],"Y"==g_shelf_edit_flag){var[k,V]=await create_drag_objects(g_module_index,g_shelf_index,g_item_index,W,W.ItemInfo,g_show_live_image,"SHELF",g_dragItem,g_start_canvas,g_present_canvas);W.SObjID=V;var U=[];if(g_drag_items_arr.length>0){for(const e of g_drag_items_arr){var[k,V]=await create_drag_objects(g_module_index,g_shelf_index,e.IIndex,e.ShelfInfo,e.ItemInfo,g_show_live_image,"ITEM",e,g_start_canvas,g_present_canvas);W.ItemInfo[g_item_index].ObjID=V,U.push(k)}U.length>0&&(g_drag_items_arr=[],g_drag_items_arr=U),await set_inter_canvas_items(J,K,g_dragItem,U,W.W,W.H,W.ObjType,W.BsktSpreadProduct,W.Rotation,W.Slope,g_shelf_index,g_module_index,g_start_canvas)}render(g_start_canvas)}else if("Y"==g_item_edit_flag){var[k,V]=await create_drag_objects(g_module_index,g_shelf_index,g_item_index,g_dragItem.ShelfInfo,g_dragItem.ItemInfo,g_show_live_image,"ITEM",g_dragItem,g_start_canvas,g_present_canvas);if("Y"==g_carpark_item_flag){var z=g_pog_json[g_start_canvas].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].X,Z=g_pog_json[g_start_canvas].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].Y;g_pog_json[g_start_canvas].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].Z}else z=W.ItemInfo[g_item_index].X,Z=W.ItemInfo[g_item_index].Y,W.ItemInfo[g_item_index].Z;"Y"==g_carpark_item_flag?g_pog_json[g_start_canvas].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].ObjID=V:W.ItemInfo[g_item_index].ObjID=V,k.position.x=z,k.position.y=Z,k.position.z=g_drag_z}g_pog_index=g_start_canvas,animate_pog(i),g_canvas_drag="N",g_drag_inprogress="N",g_intersected=[]}else if("Y"==g_duplicating)g_cut_copy_arr=[],g_cut_support_obj_arr=[],g_cut_loc_arr=[],loc_details={},g_undo_details=[],g_duplicating="N",g_drag_inprogress="N";else{g_mousedown_locx="",g_final_x=g_dragItem.position.x,g_finalY=g_dragItem.position.y,m=g_dragItem.position.y,g_final_z=g_dragItem.position.z;var J=0,K=0,q="N",Q=[];if(g_allUndoObjectsInfo=[],-1!==g_module_index&&""!==g_module_index&&-1!==g_shelf_index&&""!==g_shelf_index){g_pog_json[i].ModuleInfo[g_module_index];var ee=g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index]}var _e=ee,[D,oe,ne,te]=get_curr_module(g_final_x,m,g_shelf_edit_flag,g_module_index,g_shelf_index,_e,i),ge="";if("Y"==g_item_edit_flag){var[oe,D,le,ie,de,ae,se,b]=get_div_shelf_index(g_final_x,m,D,oe,i,g_dragItem,!0);if("Y"!==b){var[fe,Ie,re,pe,ce,ue,me,he,ge]=itemInPegboardOverhang(g_final_x,m,i,g_dragItem);fe&&([oe,D,le,ie,de,ae,se]=[Ie,re,pe,ce,ue,me,he])}}if((0!==nvl(g_pog_json)&&"Y"==g_item_edit_flag||"Y"==g_shelf_edit_flag)&&void 0!==ae&&-1!==ae&&(checkDuplicate("",D,ae,"BACKUP")||backupPog("S",ae,D,i)),"Y"==g_shelf_edit_flag){J=ee.X,K=ee.Y,ee.Z,(Ae=[]).moduleIndex=g_module_index,Ae.module=g_pog_json[i].ModuleInfo[g_module_index].Module,Ae.shelfIndex=g_shelf_index,Ae.objectID=ee.SObjID,Ae.moduleObjectID=g_pog_json[i].ModuleInfo[D].MObjID,Ae.actionType="SHELF_DRAG",Ae.startCanvas=g_start_canvas,Ae.g_present_canvas=g_present_canvas;var Se=ee;Ae.push(JSON.parse(JSON.stringify(ee))),g_allUndoObjectsInfo.push(Ae),ee.Y=m,ee.X=g_final_x,old_iteminfo=JSON.parse(JSON.stringify(ee.ItemInfo));var Oe,je=!1,[xe,Me]=getCombinationShelf(i,g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Shelf);if(-1!==xe&&(comb_shelf_ind="Y"),Oe=await getconfirm_shelfmove(i),g_pog_json[i].ModuleInfo[D].H>.1&&"ROD"!==g_shelf_object_type&&"TEXTBOX"!==g_shelf_object_type&&"Y"==g_auto_position_ind?je=auto_position_shelf(g_module_index,D,g_shelf_index,ne,g_final_x,m,"N",i):await set_all_items(g_module_index,g_shelf_index,g_final_x,m,g_shelf_edit_flag,"E","Y",i,i),-1!==g_module_index&&""!==g_module_index&&-1!==g_shelf_index&&""!==g_shelf_index){var Te=ee.ItemInfo,be=ee.AllowAutoCrush;"Y"==g_shelf_edit_flag&&"Y"==Oe&&("Y"==g_max_facing_enabled&&reset_auto_crush(g_module_index,g_shelf_index,g_item_index,i,g_module_index,g_shelf_index,i),await set_auto_facings(g_module_index,g_shelf_index,-1,Te,"B","S","D",i))}if("Y"==g_shelf_edit_flag&&"ROD"!==g_shelf_object_type&&"TEXTBOX"!==g_shelf_object_type&&"N"==ne&&"Y"==Oe){var De=D==g_module_index?g_module_index:D;q=await validate_shelf_min_distance(De,g_shelf_index,ee.Y,Te,be,g_module_index,ee.X,"Y",_e,i)}else q="Y"==ne?"N":"Y";if("N"==Oe&&(q="N"),"Y"!=q&&"R"!=q||"Y"!=g_shelf_edit_flag||"Y"!=Oe){if("N"==q&&"Y"==g_shelf_edit_flag){if(ee.X=J,ee.Y=K,ee.ItemInfo=old_iteminfo,"Y"==ne&&alert(get_message("LOST_FROM_SHELF_ROTATION_ERR",ee.Shelf,g_pog_json[i].POGCode+g_pog_json[i].ModuleInfo[g_module_index].Module)),"Y"==g_max_facing_enabled){await set_all_items(g_module_index,g_shelf_index,J,K,g_shelf_edit_flag,"E","Y",i,i);X=await recreate_all_items(g_module_index,g_shelf_index,g_shelf_object_type,"Y",g_final_x,-1,g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.length,"N","N",-1,-1,g_start_canvas,"",i,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y",ge)}else ee.ItemInfo.length>0&&"N"==ne&&await set_all_items(g_module_index,g_shelf_index,J,K,g_shelf_edit_flag,"E","Y",i,i);g_dragItem.position.set(J,K,g_drag_z),"Y"==g_shelf_edit_flag&&("PEGBOARD"==g_shelf_object_type||"CHEST"==g_shelf_object_type&&"Y"==g_chest_as_pegboard?g_dragItem.position.z=15e-5:"ROD"==g_shelf_object_type?g_dragItem.position.z=.005:"TEXTBOX"==g_shelf_object_type?g_dragItem.position.z=5e-4:g_dragItem.position.z=0==nvl(g_dragItem.position.z)?15e-5:g_dragItem.position.z)}}else{g_pog_edited_ind="Y",g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Combine="N","SHELF"!=g_shelf_object_type&&"HANGINGBAR"!=g_shelf_object_type||await generateCombinedShelfs(i,g_module_index,g_shelf_index,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y","","Y");var[De,Ee]=await set_shelf_after_drag(comb_shelf_ind="R",g_shelf_edit_flag,g_module_index,D,g_shelf_index,g_final_x,ee.Y,"Y","Y",g_module_index,g_shelf_index,i,i,xe);"Y"==g_itemSubLabelInd&&showItemSubLabel(g_itemSubLabel,g_itemSubLabelInd,$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),i);Se=g_pog_json[i].ModuleInfo[De].ShelfInfo[Ee];var ve=0;if(!je&&ee.X>g_pog_json[i].ModuleInfo[De].X-g_pog_json[i].ModuleInfo[De].W/2&&ee.X<g_pog_json[i].ModuleInfo[De].X+g_pog_json[i].ModuleInfo[De].W/2&&ee.Y+ee.H/2>g_pog_json[i].ModuleInfo[De].Y-g_pog_json[i].ModuleInfo[De].H/2&&ee.Y<g_pog_json[i].ModuleInfo[De].Y+g_pog_json[i].ModuleInfo[De].H/2&&g_pog_json[i].ModuleInfo[De].NotchSpacing>0&&"CHEST"!==g_shelf_object_type&&"ROD"!==g_shelf_object_type&&"TEXTBOX"!==g_shelf_object_type){var[Ne,Pe]=find_top_notch(De,Ee,ee.Y,g_final_x,g_drag_shelf_notch,i);if(Ne>-1&&Pe>-1){var Ce=g_scene_objects[i].scene.children[2].getObjectById(g_pog_json[i].ModuleInfo[De].ShelfInfo[Ee].SObjID);g_pog_json[i].ModuleInfo[De].ShelfInfo[Ee].X=Pe,g_pog_json[i].ModuleInfo[De].ShelfInfo[Ee].Y=Ne,Ce.X=wpdSetFixed(100*g_pog_json[i].ModuleInfo[De].ShelfInfo[Ee].X-100*g_pog_json[i].ModuleInfo[De].ShelfInfo[Ee].W/2),Ce.Y=wpdSetFixed(100*g_pog_json[i].ModuleInfo[De].ShelfInfo[Ee].Y-100*g_pog_json[i].ModuleInfo[De].ShelfInfo[Ee].H/2),await set_all_items(De,Ee,Pe,Ne,g_shelf_edit_flag,"N","Y",i,i),Ce.position.set(Pe,Ne)}}if(g_undo_details=[],g_undo_obj_arr=[],g_undo_supp_obj_arr=[],g_redo_final_obj_arr=[],g_redo_all_obj_arr=[],logFinalUndoObjectsInfo("SHELF_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","Y"),g_allUndoObjectsInfo=[],"Y"==g_show_max_merch&&(await add_merch("N",i),await add_merch("Y",i)),"Y"==g_show_notch_label&&await update_single_notch_label("Y",De,Ee,$v("P25_NOTCH_HEAD"),"",i,"N"),"Y"==g_fixel_label&&await show_fixel_labels("Y",i),await recreate_compare_views(g_compare_view,"N"),Te.length>0&&(g_pog_json[i].ModuleInfo[De].EditFlag="Y"),"CHEST"==Se.ObjType&&"Y"==g_chest_as_pegboard&&(Se.ChestEdit="Y"),"Y"==Se.InsidePegboard){(Ce=g_scene_objects[i].scene.children[2].getObjectById(g_pog_json[i].ModuleInfo[De].ShelfInfo[Ee].SObjID)).position.z=.016;for(const e of Se.ItemInfo){g_scene_objects[i].scene.children[2].getObjectById(e.ObjID).position.z=.016,ve++}}}}if("Y"==g_item_edit_flag&&"Y"==oe&&-1!==ae){if("Y"==g_carpark_item_flag){z=g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].X,Z=g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].Y,g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].Z;var Re=g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].Fixed,ye=(Te=g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo,Q=JSON.parse(JSON.stringify(g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index])),g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].SpreadItem),He=g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index]}else{z=ee.ItemInfo[g_item_index].X,Z=ee.ItemInfo[g_item_index].Y,ee.ItemInfo[g_item_index].Z;Re=ee.ItemInfo[g_item_index].Fixed,Te=ee.ItemInfo,Q=JSON.parse(JSON.stringify(ee.ItemInfo[g_item_index])),ye=ee.SpreadItem,He=ee.ItemInfo[g_item_index];g_temp_cut_arr.push(JSON.parse(JSON.stringify(g_pog_json[i].ModuleInfo))),g_isBookend=ee.ItemInfo[g_item_index].Fixed,g_movedObjID=ee.ItemInfo[g_item_index].ObjID}var Ye;item_width_arr=[],item_height_arr=[],item_depth_arr=[],r_=[],t_=[],isTopItem="N",Xe=-1,we=-1,We="N",old_div_shelf="",drag_direction=z<g_final_x?"F":"B";var Ae=[],xe="";if(t_.push(n_),g_shelf_index!==ae||g_module_index!==D){Ae=[];var[xe,Me]=getCombinationShelf(i,g_pog_json[i].ModuleInfo[D].ShelfInfo[ae].Shelf);if(-1!==xe){if(Ae.CombineInd="Y",Ae.CombShelfIndex=Me,currCombination=g_combinedShelfs[xe],currCombination.length>1)for(obj of currCombination)Ae.push(JSON.parse(JSON.stringify(g_pog_json[obj.PIndex].ModuleInfo[obj.MIndex].ShelfInfo[obj.SIndex])))}else Ae.push(JSON.parse(JSON.stringify(g_pog_json[i].ModuleInfo[D].ShelfInfo[ae])));Ae.moduleIndex=D,Ae.shelfIndex=ae,Ae.actionType="ITEM_DELETE",Ae.startCanvas=g_start_canvas,Ae.objectID=g_pog_json[i].ModuleInfo[D].ShelfInfo[ae].SObjID,Ae.module=g_pog_json[i].ModuleInfo[D].Module,Ae.moduleObjectID=g_pog_json[i].ModuleInfo[D].MObjID,g_allUndoObjectsInfo.push(Ae)}if("Y"==g_carpark_item_flag)if(g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo.length>1)(Ae=[]).moduleIndex=g_module_index,Ae.shelfIndex=g_shelf_index,Ae.IsCarpark="Y",Ae.actionType="ITEM_DELETE",Ae.startCanvas=g_start_canvas,Ae.objectID=g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].SObjID,Ae.module=g_pog_json[i].ModuleInfo[g_module_index].Module,Ae.moduleObjectID=g_pog_json[i].ModuleInfo[g_module_index].MObjID,Ae.push(JSON.parse(JSON.stringify(g_pog_json[i].ModuleInfo[g_module_index].Carpark[0]))),g_allUndoObjectsInfo.push(Ae);else{for(var Fe=[],Le=(ve=0,g_undo_final_obj_arr.length);ve<Le;ve++)void 0!==g_undo_final_obj_arr[ve].IsCarpark&&"N"!=g_undo_final_obj_arr[ve][0][0].IsCarpark||Fe.push(g_undo_final_obj_arr[ve]);g_undo_final_obj_arr=Fe;for(Fe=[],ve=0,Le=g_redo_final_obj_arr.length;ve<Le;ve++)void 0!==g_redo_final_obj_arr[ve].IsCarpark&&"N"!=g_undo_final_obj_arr[ve][0][0].IsCarpark||Fe.push(g_redo_final_obj_arr[ve]);g_redo_final_obj_arr=Fe}if("N"==g_carpark_item_flag){Ae=[];var[$e,Be]=getCombinationShelf(i,ee.Shelf);if(-1!==$e){if($e!==xe||g_shelf_index==ae&&g_module_index==D){if(Ae.CombineInd="Y",Ae.CombShelfIndex=Be,currCombination=g_combinedShelfs[$e],currCombination.length>1)for(obj of currCombination)Ae.push(JSON.parse(JSON.stringify(g_pog_json[obj.PIndex].ModuleInfo[obj.MIndex].ShelfInfo[obj.SIndex])));Ae.moduleIndex=g_module_index,Ae.shelfIndex=g_shelf_index,Ae.actionType="ITEM_DELETE",Ae.startCanvas=g_start_canvas,Ae.objectID=ee.SObjID,Ae.module=g_pog_json[i].ModuleInfo[g_module_index].Module,Ae.moduleObjectID=g_pog_json[i].ModuleInfo[g_module_index].MObjID,g_allUndoObjectsInfo.push(Ae)}}else Ae.push(JSON.parse(JSON.stringify(ee))),Ae.moduleIndex=g_module_index,Ae.shelfIndex=g_shelf_index,Ae.actionType="ITEM_DELETE",Ae.startCanvas=g_start_canvas,Ae.objectID=ee.SObjID,Ae.module=g_pog_json[i].ModuleInfo[g_module_index].Module,Ae.moduleObjectID=g_pog_json[i].ModuleInfo[g_module_index].MObjID,g_allUndoObjectsInfo.push(Ae)}if(D==g_module_index&&g_shelf_index==ae&&(g_item_index>0&&g_item_index<ee.ItemInfo.length-1?g_final_x>ee.ItemInfo[g_item_index-1].X&&g_final_x<ee.ItemInfo[g_item_index+1].X&&(drag_direction="S"):0==g_item_index&&ee.ItemInfo.length>1?g_final_x<ee.ItemInfo[g_item_index+1].X&&(drag_direction="S"):g_item_index==ee.ItemInfo.length-1&&ee.ItemInfo.length>1&&g_final_x>ee.ItemInfo[g_item_index-1].X&&(drag_direction="S")),old_item_ind=g_item_index,"N"==g_carpark_item_flag&&"BASKET"==ee.ItemInfo[g_item_index].CType&&(ee.ItemInfo[g_item_index].H=ee.ItemInfo[g_item_index].OH,ee.ItemInfo[g_item_index].W=ee.ItemInfo[g_item_index].OW,ee.ItemInfo[g_item_index].D=ee.ItemInfo[g_item_index].OD,ee.ItemInfo[g_item_index].BaseD=1,ee.ItemInfo[g_item_index].BHoriz=1,ee.ItemInfo[g_item_index].BVert=1),$.each(Te,(function(e,_){"Y"==g_carpark_item_flag?g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[e].Exists="E":ee.ItemInfo[e].Exists="E"})),"DIVIDER"==He.Item&&("PEGBOARD"==le||"TEXTBOX"==le||"HANGINGBAR"==le||"ROD"==le||"CHEST"==le&&"Y"==g_chest_as_pegboard))g_dragItem.position.set(z,Z,g_drag_z),alert(get_message("LOST_FROM_SHELF_ROTATION_ERR",He.ItemID,g_pog_json[i].ModuleInfo[D].ShelfInfo[ae].Shelf));else{if("N"==g_carpark_item_flag&&(void 0!==He.TopObjID&&""!==He.TopObjID||void 0!==He.BottomObjID&&""!==He.BottomObjID))reset_bottom_item(g_module_index,g_shelf_index,g_item_index,g_module_index,g_shelf_index,g_final_x,i);("F"==ye||He.CrushHoriz>0&&"N"==He.MHorizCrushed)&&(He.W=He.RW,ee.ItemInfo[g_item_index].W=He.RW);var[Ye,we,Xe,Ge,We,He,ke,Ve,Ue]=await update_item_loc(D,g_module_index,g_shelf_index,ae,le,g_item_index,g_final_x,se,He,ie,de,m,g_pog_json,drag_direction,i,i);if("DIVIDER"==He.Item&&(old_div_shelf=JSON.parse(JSON.stringify(g_pog_json[i].ModuleInfo[Xe].ShelfInfo[ke]))),"Y"==g_pegbrd_auto_placing&&"PEGBOARD"==Ge||"PEGBOARD"!==Ge&&"CHEST"!==Ge||"CHEST"==Ge&&"N"==g_chest_as_pegboard?He.Edited="Y":He.Edited="N",He.SameShelf="N","N"==(_e=g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we]).AllowAutoCrush&&_e.SObjID!==ee.SObjID&&(He.CrushVert=0,He.CrushD=0,He.CrushHoriz=0),"Y"==g_carpark_item_flag?g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].Y=m:(ee.ItemInfo[g_item_index].Y=m,"PALLET"==Ge&&"PALLET"!==g_shelf_object_type&&(He.Z=0+He.D/2,ee.ItemInfo[g_item_index].Z=0+He.D/2)),"CHEST"==Ge&&"Y"==g_chest_as_pegboard)Ze=m;else if("PEGBOARD"!==Ge)var[ze,Ze]=get_item_xy(_e,He,He.W,He.H,i);else Ze=m;var Je=-1;if("Y"==Ve?(Je=g_pog_json[i].ModuleInfo[D].ShelfInfo[ae].ItemInfo[Ue].ObjID,ee.ItemInfo[g_item_index].BottomObjID=g_pog_json[i].ModuleInfo[D].ShelfInfo[ae].ItemInfo[Ue].ObjID,ee.ItemInfo[g_item_index].X=g_pog_json[i].ModuleInfo[D].ShelfInfo[ae].ItemInfo[Ue].X,g_pog_json[i].ModuleInfo[D].ShelfInfo[ae].ItemInfo[Ue].TopObjID=ee.ItemInfo[g_item_index].ObjID,"PALLET"==Ge&&(ee.ItemInfo[g_item_index].Z=g_pog_json[i].ModuleInfo[D].ShelfInfo[ae].ItemInfo[Ue].Z,He.Z=ee.ItemInfo[g_item_index].Z),Ye="R"==ye?Ue-1:Ue+1,He.BottomObjID=Je,He.TopItem="Y",g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo[Ue].BelowItem="Y",Ze=g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo[Ue].Y+g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo[Ue].H/2+He.H/2):(He.TopItem="N",He.X=g_final_x),"DIVIDER"!==He.Item?He.Y=Ze:"BASKET"==Ge&&"DIVIDER"==He.Item?He.Y=m:He.Y=Ze,He.YDistance=m-(g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].Y+g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].H/2),He.DropY=Ze,"DIVIDER"==He.Item&&"CHEST"!==Ge&&"PALLET"!==Ge&&(He.Rotation=0),He.SIndex=we,He.Dragged="Y","N"==g_carpark_item_flag&&("PEGBOARD"==Ge&&"PEGBOARD"==ee.ObjType||"CHEST"==Ge&&"CHEST"==ee.ObjType&&"Y"==g_chest_as_pegboard)&&(He.SameShelf="Y"),"Y"==g_carpark_item_flag?0==g_item_index?g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo.splice(g_item_index,g_item_index+1):g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo.splice(g_item_index,1):0==g_item_index?ee.ItemInfo.splice(g_item_index,g_item_index+1):ee.ItemInfo.splice(g_item_index,1),"Y"==Ve){ve=0;for(const e of g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo){if(e.ObjID==Je){Ye="R"==ye?ve-1:ve+1;break}ve++}}else await crushItem(i,g_module_index,g_shelf_index,-1,"W","Y",-1,-1);He.DfacingUpd="Y";var Ke=await set_item_after_drag(Ge,ye,Xe,we,Ye,He,i);ve=0;for(const e of g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo){if(e.ObjID==He.ObjID){Ke=ve;break}ve++}var[Xe,we,Ke]=await set_combine_items_after_drag(Xe,we,i,Ke,g_module_index,g_shelf_index,g_item_index,i,g_final_x,"N");"BASKET"==g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ObjType&&"DIVIDER"==g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo[Ke].Item&&(g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo[Ke].Y=g_finalY);var qe=g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo[Ke];if(reorder_items(Xe,we,i)){const e=g_invalidPosition;ve=0;for(const e of g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo){if(e.ObjID==qe.ObjID){Ke=ve;break}ve++}var Qe=0;for(const e of g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo){e.CType=g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ObjType;var e_=get_item_xaxis(e.W,e.H,e.D,e.CType,-1,g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].HorizGap,g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].SpreadItem,g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].HorizGap,Xe,we,Qe,"Y",g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo.length,"N",i,ge);e.X=e_,Qe++}X="N";if(check_dim_difference(Xe,we,Ke,i))X=await check_item_dim_valid(qe,Xe,we,Ke,i);else if("PEGBOARD"!==Ge)if("BASKET"==Ge&&"DIVIDER"==He.Item||"Y"==g_chest_as_pegboard&&"CHEST"==Ge);else X=update_validate_item_height(qe,Xe,we,Ke,g_final_x,Ge,-1,i);if("N"==Ve&&"DIVIDER"!==g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo[Ke].Item)await set_auto_facings(Xe,we,Ke,qe,"B","I","D",i);g_invalidPosition=e}("PEGBOARD"==Ge||"Y"==g_chest_as_pegboard&&"CHEST"==Ge)&&(g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo[Ke].Exists="N",g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo[Ke].X=g_final_x,g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo[Ke].Y=m,g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo[Ke].DropY=m),"F"==g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].SpreadItem&&$.each(g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo,(function(e,_){_.W=_.RW}));qe=g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo[Ke];item_width_arr.push(wpdSetFixed(qe.W)),item_height_arr.push(wpdSetFixed(qe.H)),item_depth_arr.push(wpdSetFixed(qe.D)),r_.push(Ke);var __={};if(g_combineItemModf=[],__.NewMIndex=Xe,__.NewSIndex=we,__.OldMIndex=Xe,__.OldSIndex=we,__.OldIIndex=Ke,__.OldObjID=qe.ObjID,g_combineItemModf.push(__),"F"!=X&&"N"!=X||!await validate_items(item_width_arr,item_height_arr,item_depth_arr,r_,Ge,Xe,we,Ke,We,He.CrushHoriz,He.CrushVert,He.CrushD,g_final_x,Re,"N","Y",Ve,"N",[],"Y","Y","Y",i)){if(Q.DimUpdate=g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo[Ke].DimUpdate,"N"==g_carpark_item_flag)reset_bottom_item(Xe,we,Ke,-1,-1,g_final_x,i);if(0==Ke?g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo.splice(Ke,Ke+1):g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo.splice(Ke,1),"Y"==g_carpark_item_flag?(g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo.splice(g_item_index,0,Q),g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].X=z,g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo[g_item_index].Y=Z):(ee.ItemInfo.splice(g_item_index,0,Q),ee.ItemInfo[g_item_index].X=z,ee.ItemInfo[g_item_index].Y=Z),0!==ee.Rotation){Ce=g_scene_objects[i].scene.children[2].getObjectById(ee.SObjID),e=ee.ItemInfo[g_item_index].RotationX,_=ee.ItemInfo[g_item_index].RotationY,h=ee.ItemInfo[g_item_index].RotationZ;var o_=new THREE.Vector3(e,_,h).applyMatrix4(Ce.matrixWorld);g_dragItem.position.x=o_.x,g_dragItem.position.y=o_.y,g_dragItem.position.z=o_.z,g_dragItem.quaternion.copy(Ce.quaternion),g_dragItem.updateMatrix()}else g_dragItem.position.set(z,Z,g_itemDragZ),g_dragItem.updateMatrix()}else{g_pog_edited_ind="Y";var V=0;g_undo_details=[],g_undo_obj_arr=[],g_undo_supp_obj_arr=[];var n_={},t_=[];if(n_.MIndex=g_module_index,n_.SIndex=g_shelf_index,n_.NewModuleIndex=Xe,n_.NewShelfIndex=we,t_.push(n_),g_shelf_index!==ae||D!==g_module_index){try{if(reorder_items(Xe,we,i)){if("SHELF"==le&&("L"==g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].SpreadItem||"R"==g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].SpreadItem)){var g_=mergeAdjacentItems(i,Xe,we,Ke);g_>-1&&(Ke=g_)}X=await recreate_all_items(Xe,we,le,"Y",g_final_x,Ke,g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo.length,"N","N",-1,-1,g_start_canvas,"",i,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y",ge);var l_=-1;if(g_combineItemModf.length>0)for(var i_=0;i_<g_combineItemModf.length;i_++)if(g_combineItemModf[i_].OldMIndex==Xe&&g_combineItemModf[i_].OldSIndex==we){Xe=g_combineItemModf[i_].OldMIndex,we=g_combineItemModf[i_].OldSIndex,l_=i_;break}var d_=g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo,a_={X:"asc",Y:"asc"};if(d_.keySort(a_),-1!==l_){var s_=0;for(item of d_)item.ObjID==g_combineItemModf[l_].NewObjID&&(Ke=s_),s_++}g_combineItemModf=[];var f_=g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo[Ke],Ce=g_scene_objects[i].scene.children[2].getObjectById(f_.ObjID);g_intersected.push(Ce),render_animate_selected()}update_item_distance(Xe,we,i),render(i)}catch(e){error_handling(e)}logFinalUndoObjectsInfo("SHELF_DELETE","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","Y",g_carpark_item_flag),g_allUndoObjectsInfo=[],g_pog_json[i].ModuleInfo[Xe].EditFlag="Y","CHEST"==g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ObjType&&"Y"==g_chest_as_pegboard&&(g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ChestEdit="Y")}try{if("F"==ee.SpreadItem){ve=0;for(const e of ee.ItemInfo)0==e.CrushHoriz&&(e.W=e.RW),ve++}var[xe,Me]=getCombinationShelf(i,g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].Shelf),[I_,Be]=getCombinationShelf(i,g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Shelf);if((xe!==I_&&xe>-1||-1==xe||g_shelf_index==ae&&D==g_module_index)&&reorder_items(g_module_index,g_shelf_index,i)){X=await recreate_all_items(g_module_index,g_shelf_index,ee.ObjType,"Y",g_final_x,Ke,ee.ItemInfo.length,"N","N",-1,-1,g_start_canvas,"",i,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y",ge),l_=-1;if(g_combineItemModf.length>0)for(i_=0;i_<g_combineItemModf.length;i_++)if(g_combineItemModf[i_].OldMIndex==Xe&&g_combineItemModf[i_].OldSIndex==we){Xe=g_combineItemModf[i_].NewMIndex,we=g_combineItemModf[i_].NewSIndex,l_=i_;break}d_=g_pog_json[i].ModuleInfo[Xe].ShelfInfo[we].ItemInfo,a_={X:"asc",Y:"asc"};if(d_.keySort(a_),-1!==l_){s_=0;for(item of d_)item.ObjID==g_combineItemModf[l_].NewObjID&&(Ke=s_),s_++}}update_item_distance(g_module_index,g_shelf_index,i),g_pog_json[i].ModuleInfo[g_module_index].EditFlag="Y","CHEST"==g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType&&"Y"==g_chest_as_pegboard&&(g_pog_json[i].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ChestEdit="Y"),render(i)}catch(e){error_handling(e)}if(g_shelf_index==ae&&D==g_module_index&&(logFinalUndoObjectsInfo("SHELF_DRAG","U",g_allUndoObjectsInfo,"","Y","N","N","N","N","Y",g_carpark_item_flag),g_allUndoObjectsInfo=[]),"Y"==g_carpark_item_flag&&"DB"==$v("P25_POGCR_LOAD_IMG_FROM")){var r_=[];(Te=[]).push(He),r_.push(Ke);X=await get_images(Xe,we,Te,r_,parseFloat($v("P25_POGCR_IMG_MAX_WIDTH")),parseFloat($v("P25_POGCR_IMG_MAX_HEIGHT")),parseFloat($v("P25_IMAGE_COMPRESS_RATIO")));if(Te.length>0)X=await get_images(ve,j,Te,r_,parseFloat($v("P25_POGCR_IMG_MAX_WIDTH")),parseFloat($v("P25_POGCR_IMG_MAX_HEIGHT")),parseFloat($v("P25_IMAGE_COMPRESS_RATIO")));if(0==g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].ItemInfo.length){var p_=g_scene_objects[i].scene.children[2].getObjectById(g_pog_json[i].ModuleInfo[g_module_index].Carpark[0].SObjID);g_scene_objects[i].scene.children[2].remove(p_),g_pog_json[i].ModuleInfo[g_module_index].Carpark.splice(0,1)}}recreate_compare_views(g_compare_view,"N")}if("Y"==g_invalidPosition){var c_=g_undoRedoAction;g_invalidPosition="N",g_validationFlag="Y",undo_actions_not_delete("UNDO",l,i),alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",ee.Shelf)),g_redo_final_obj_arr.pop(),g_undoRedoAction=c_}}}else"Y"==g_item_edit_flag&&rollback_item(g_module_index,g_shelf_index,g_item_index,g_drag_z,i);if("Y"==g_shelf_edit_flag){if("N"==g_manual_zoom_ind){var u_=get_min_max_xy(i).split("###");set_camera_z(l,parseFloat(u_[2]),parseFloat(u_[3]),parseFloat(u_[0]),parseFloat(u_[1]),g_offset_z,parseFloat(u_[4]),parseFloat(u_[5]),!1,i)}if(0!==g_rotation||0!==g_slope){if(0!==g_rotation){if(g_dragItem.quaternion.copy(l.quaternion),g_dragItem.lookAt(g_pog_json[i].CameraX,g_pog_json[i].CameraY,g_pog_json[i].CameraZ),"TEXTBOX"==ee.ObjType){var m_=g_slope;0==g_rotation?g_dragItem.rotateX(m_/2*Math.PI/180):g_dragItem.rotateX(m_*Math.PI/180)}else g_dragItem.rotateX(m_*Math.PI/180);g_dragItem.rotateY(g_rotation*Math.PI/180),g_dragItem.updateMatrix()}ee.ItemInfo.length>0&&(g_scene_objects[i].scene.updateMatrixWorld(),await set_all_items(g_module_index,g_shelf_index,J,K,g_shelf_edit_flag,"N","Y",i,i))}update_rotate_shelfs(i)}g_drag_inprogress="N",g_rotation=0,g_slope=0}g_drag_inprogress="N",g_duplicating="N",g_canvas_drag="N",g_mselect_drag="N","undefined"!=typeof g_dragItem&&"N"==g_canvas_drag&&"N"==g_drag_inprogress&&g_dragItem.StartCanvas==g_present_canvas&&(g_dragItem=[],g_drag_items_arr=[]),render_animate_selected(),render(i),logDebug("function : doMouseUp","E")}catch(e){error_handling(e)}}async function set_combine_items_after_drag(e,_,o,n,t,g,l,i,d,a){var s=g_pog_json[o].ModuleInfo[e].ShelfInfo[_],f=g_pog_json[i].ModuleInfo[t].ShelfInfo[g],I=e,r=_,p=n;if(("SHELF"==s.ObjType||"HANGINGBAR"==s.ObjType)&&"N"!==s.Combine){var c=[],u={};u.MIndex=e,u.SIndex=_,s.ItemInfo&&s.ItemInfo.length>0?(u.IIndex=s.ItemInfo.length-1,u.Iobjid=s.ItemInfo[u.IIndex].ObjID):(u.IIndex=0,u.Iobjid=""),c.push(u),[currCombinationIndex,currShelfCombIndx]=getCombinationShelf(o,s.Shelf),-1!==currCombinationIndex&&-1!==currShelfCombIndx&&(await setCombinedShelfItems(o,currCombinationIndex,currShelfCombIndx,d,"Y","N",-1,u.IIndex,c),I=c[0].MIndex,r=c[0].SIndex,p=c[0].IIndex)}return"Y"!=a||"SHELF"!=f.ObjType&&"HANGINGBAR"!=f.ObjType||"N"===f.Combine||([currCombinationIndex,currShelfCombIndx]=getCombinationShelf(i,f.Shelf),-1!==currCombinationIndex&&-1!==currShelfCombIndx&&(await setCombinedShelfItems(i,currCombinationIndex,currShelfCombIndx,d,"Y","N",-1,l,[]),await reset_auto_crush(t,g,l,i,t,g,i))),[I,r,p]}function rollback_item(e,_,o,n,t){if(logDebug("function : rollback_item; p_module_index : "+e+"; p_shelf_index : "+_+"; i_item_index : "+o+"; g_drag_z : "+n),0!==g_pog_json[t].ModuleInfo[e].ShelfInfo[_].Rotation){var g=g_scene_objects[t].scene.children[2].getObjectById(g_pog_json[t].ModuleInfo[e].ShelfInfo[_].SObjID),l=g_pog_json[t].ModuleInfo[e].ShelfInfo[_].ItemInfo[o].RotationX,i=g_pog_json[t].ModuleInfo[e].ShelfInfo[_].ItemInfo[o].RotationY,d=g_pog_json[t].ModuleInfo[e].ShelfInfo[_].ItemInfo[o].RotationZ,a=new THREE.Vector3(l,i,d).applyMatrix4(g.matrixWorld);g_dragItem.position.x=a.x,g_dragItem.position.y=a.y,g_dragItem.position.z=a.z,g_dragItem.quaternion.copy(g.quaternion),g_dragItem.updateMatrix()}else"N"==g_carpark_item_flag?g_dragItem.position.set(g_pog_json[t].ModuleInfo[e].ShelfInfo[_].ItemInfo[o].X,g_pog_json[t].ModuleInfo[e].ShelfInfo[_].ItemInfo[o].Y,n):g_dragItem.position.set(g_pog_json[t].ModuleInfo[e].Carpark[_].ItemInfo[o].X,g_pog_json[t].ModuleInfo[e].Carpark[_].ItemInfo[o].Y,n);logDebug("function : rollback_item","E")}async function update_item_loc(e,_,o,n,t,g,l,i,d,a,s,f,I,r,p,c){logDebug("function : update_item_loc; curr_module : "+e+"; p_module_index : "+_+"; p_shelf_index : "+o+"; div_shelf_index : "+n+"; div_object_type : "+t+"; i_item_index : "+g+"; i_final_x : "+l+"; shelf_found : "+i+"; shelfY : "+a+"; shelfHeight : "+s+"; p_final_y : "+f+"; drag_direction : "+r,"S");try{var u,m=-1,h=-1,S=-1,O="N",j=wpdSetFixed(d.W),x=d.Fixed,M=d.D,T=d.CapStyle,b=d.H;if(void 0!==e&&p!==c||void 0!==e&&e!==_&&-1!=e){if("Y"==i){var[D,E,v]=get_nearest_item(e,n,l,g,"N",f,j,M,x,T,b,r,_,o,d,I,p,c);m=p,h=e,S=n,u=t,O="N",d.Exists="N";await reset_auto_crush(_,o,g,c,h,S,m);if("DIVIDER"==d.Item){shelf_arr=g_pog_json[c].ModuleInfo[_].ShelfInfo;var N=-1,P={},C=0;for(const e of shelf_arr)e.Shelf==d.ItemID&&(N=C,P=e),C++;0==N?g_pog_json[c].ModuleInfo[_].ShelfInfo.splice(N,N+1):g_pog_json[c].ModuleInfo[_].ShelfInfo.splice(N,1),P.Y=a+s/2+d.H/2,g_pog_json[p].ModuleInfo[e].ShelfInfo.push(P),N=g_pog_json[p].ModuleInfo[e].ShelfInfo.length-1}}}else if(o!==n&&e==_&&-1!=e){if("Y"==i){var[D,E,v]=get_nearest_item(_,n,l,g,"N",f,j,M,x,T,b,r,_,o,d,I,p,c);m=c,h=_,S=n,u=t,O="N",d.Exists="N";await reset_auto_crush(_,o,g,p,h,S,m);if("DIVIDER"==d.Item){shelf_arr=g_pog_json[p].ModuleInfo[_].ShelfInfo;N=-1,C=0;for(const e of shelf_arr)e.Shelf==d.ItemID&&(N=C),C++;N>-1&&(g_pog_json[p].ModuleInfo[_].ShelfInfo[N].Y=a+s/2+d.H/2)}}}else{var[D,E,v]=get_nearest_item(_,o,l,g,"Y",f,j,M,x,T,b,r,_,o,d,I,p,c);m=c,S=o,h=_,u=g_shelf_object_type,O="Y",d.Exists="E";await reset_auto_crush(_,o,g,c,h,S,m);if("DIVIDER"==d.Item){shelf_arr=g_pog_json[p].ModuleInfo[_].ShelfInfo;N=-1,C=0;for(const e of shelf_arr)e.Shelf==d.ItemID&&(N=C),C++;N>-1&&(g_pog_json[p].ModuleInfo[_].ShelfInfo[N].Y=a+s/2+d.H/2)}}return logDebug("function : update_item_loc","E"),[D,S,h,u,O,d,N,v,E]}catch(e){error_handling(e)}}function get_nearest_item(e,_,o,n,t,g,l,i,d,a,s,f,I,r,p,c,u,m){logDebug("function : get_nearest_item; p_module_index : "+e+"; p_shelf_index : "+_+"; i_final_x : "+o+"; i_item_index : "+n+"; p_edit_ind : "+t+"; p_final_y : "+g+"; item_width : "+l+"; item_depth : "+i+"; item_fixed : "+d+"; cap_style : "+a+"; item_height : "+s+"; drag_direction : "+f+"; curr_mod_ind : "+I+"; curr_shelf_ind : "+r,"S");try{var h=g_pog_json[u].ModuleInfo[e].ShelfInfo[_].ItemInfo,S=g_pog_json[u].ModuleInfo[e].ShelfInfo[_].SpreadItem,O=g_pog_json[u].ModuleInfo[e].ShelfInfo[_].ObjType,j=(g_pog_json[u].ModuleInfo[e].ShelfInfo[_].X,g_pog_json[u].ModuleInfo[e].ShelfInfo[_].W,g_pog_json[u].ModuleInfo[e].ShelfInfo[_].ObjType),[x,M]=getCombinationShelf(u,g_pog_json[u].ModuleInfo[e].ShelfInfo[_].Shelf),T=-1,b=[],D=[],E="N",v="N",N=-1;bottom_y_arr=[],bottom_index_arr=[];var P=wpdSetFixed(g_pog_json[u].ModuleInfo[e].ShelfInfo[_].Y+g_pog_json[u].ModuleInfo[e].ShelfInfo[_].H/2);if("R"==S){var C=0;for(const e of h){if(h[C].Exists="E","Y"==t&&n!==C||"N"==t){var R=e.X-e.W/2,y=e.X+e.W/2;!(o>R&&o<y&&(l<=e.W||"N"==g_item_stack_valid)&&"N"==e.Fixed&&"N"==d&&("0"==e.CapStyle||null==e.CapStyle)&&("0"==a||null==a)&&g-s/2<e.Y+e.H/2&&g-s/2>e.Y&&"DIVIDER"!==e.Item&&1==e.BHoriz&&-1!==g&&"N"==d)||"SHELF"!=j&&"PALLET"!=j||void 0!==e.TopObjID&&""!=e.TopObjID||-1!=x||(bottom_y_arr.push(e.Y),bottom_index_arr.push(C)),o>e.X-e.W/2&&o<e.X+e.W/2&&(void 0===e.BottomObjID||""==e.BottomObjID)&&(v="Y",T=C),"SHELF"==O||"PALLET"==O?wpdSetFixed(e.X+e.W/2)>o&&wpdSetFixed(e.Y-e.H/2)==P&&(b.push(e.X-parseFloat(o)),D.push(C)):e.X+e.W/2>o&&(b.push(e.X-parseFloat(o)),D.push(C))}C++}}else{C=0;for(const e of h){if(h[C].Exists="E","Y"==t&&n!==C||"N"==t){R=e.X-e.W/2,y=e.X+e.W/2;!(o>=R&&o<y&&(l<=e.W||"N"==g_item_stack_valid)&&"N"==e.Fixed&&"N"==d&&("0"==e.CapStyle||null==e.CapStyle)&&("0"==a||null==a)&&g-s/2<e.Y+e.H/2&&g-s/2>e.Y&&"DIVIDER"!==e.Item&&1==e.BHoriz&&-1!==g&&"N"==d)||"SHELF"!=j&&"PALLET"!=O||void 0!==e.TopObjID&&""!=e.TopObjID||-1!=x||(bottom_y_arr.push(g-e.Y+e.H/2),bottom_index_arr.push(C)),o>e.X-e.W/2&&o<e.X+e.W/2&&(void 0===e.BottomObjID||""==e.BottomObjID)&&(v="Y",T=C),"SHELF"==O||"PALLET"==O?wpdSetFixed(e.X-e.W/2)<o&&wpdSetFixed(e.Y-e.H/2)==P&&(b.push(parseFloat(o)-e.X),D.push(C)):e.X-e.W/2<o&&(b.push(parseFloat(o)-e.X),D.push(C))}C++}}if(bottom_y_arr.length>0&&1==p.BVert&&1==p.BHoriz){var H=Math.min.apply(Math,bottom_y_arr),Y=bottom_y_arr.findIndex((function(e){return e==H}));if(N=bottom_index_arr[Y],E="Y",(i>h[N].D||"N"==g_item_stack_valid)&&g_pog_json[m].ModuleInfo[I].ShelfInfo[r].ItemInfo[n].BaseD>1){new_depth=g_pog_json[m].ModuleInfo[I].ShelfInfo[r].ItemInfo[n].RD/g_pog_json[m].ModuleInfo[I].ShelfInfo[r].ItemInfo[n].BaseD;var A=Math.floor(100*h[N].D/(100*new_depth));A=(F=nvl(g_pog_json[m].ModuleInfo[I].ShelfInfo[r].ItemInfo[n].MPogDepthFacings)>0?g_pog_json[m].ModuleInfo[I].ShelfInfo[r].ItemInfo[n].MPogDepthFacings:items.MDepthFacings)<A&&F>-1?F:A,g_pog_json[m].ModuleInfo[I].ShelfInfo[r].ItemInfo[n].D=new_depth*(A>0?A:1),g_pog_json[m].ModuleInfo[I].ShelfInfo[r].ItemInfo[n].BaseD=A>0?A:1,g_pog_json[m].ModuleInfo[I].ShelfInfo[r].ItemInfo[n].RD=g_pog_json[u].ModuleInfo[I].ShelfInfo[r].ItemInfo[n].D}else if(i>h[N].D&&1==g_pog_json[m].ModuleInfo[I].ShelfInfo[r].ItemInfo[n].BaseD)N=-1,E="N";else if((i<=h[N].D||"N"==g_item_stack_valid)&&g_pog_json[m].ModuleInfo[I].ShelfInfo[r].ItemInfo.length>0){new_depth=g_pog_json[m].ModuleInfo[I].ShelfInfo[r].ItemInfo[n].RD/g_pog_json[m].ModuleInfo[I].ShelfInfo[r].ItemInfo[n].BaseD;var F;A=Math.floor(100*h[N].D/(100*new_depth));A=(F=nvl(h[N].MPogDepthFacings)>0?h[N].MPogDepthFacings:h[N].MDepthFacings)<A&&F>-1?F:A,g_pog_json[m].ModuleInfo[I].ShelfInfo[r].ItemInfo[n].D=new_depth*(A>0?A:1),g_pog_json[m].ModuleInfo[I].ShelfInfo[r].ItemInfo[n].BaseD=A>0?A:1,g_pog_json[m].ModuleInfo[I].ShelfInfo[r].ItemInfo[n].RD=g_pog_json[m].ModuleInfo[I].ShelfInfo[r].ItemInfo[n].D}}if("N"==v)if(b.length>0){var L=[];H=Math.min.apply(Math,b);b.filter((function(e,_){e==H&&L.push(_)}));Y=L[L.length-1];T="R"==S?D[Y]>0?"B"==f?D[Y]:D[Y]-1:0:e==I&&_==r?"S"==f||"B"==f||"F"==f?D[Y]+1:D[Y]:D[Y]+1}else T=0;else"N"==t&&"R"!==S&&T>-1&&o>=h[T].X&&(T+=1);return logDebug("function : get_nearest_item","E"),[T,N,E]}catch(e){error_handling(e)}}function open_pog_modal(e,_,o="N"){try{logDebug("function : open_pog_modal","S");var n=[],t={},g="",l="",i="",d="N";if(g_pog_json[_].ModuleInfo.length>1)for(modobj of g_pog_json[_].ModuleInfo){if(null==modobj.ParentModule||"undefined"==modobj.ParentModule){var a=parseFloat(modobj.NotchW),s=parseFloat(modobj.NotchStart),f=parseFloat(modobj.NotchSpacing);if(""!==g&&(g!==a||l!==s||i!==f)){d="Y";break}g=a,l=s,i=f}0}t.NotchCheck=d,t.POGCode=g_pog_json[_].POGCode,t.Version=g_pog_json[_].Version,t.W=(100*g_pog_json[_].W).toFixed(2),t.H=(100*g_pog_json[_].H).toFixed(2),t.D=(100*g_pog_json[_].D).toFixed(2),t.Name=g_pog_json[_].Name,t.Type=g_pog_json[_].Type,t.PogHeight=(100*g_pog_json[_].H).toFixed(2),t.PogSegmentWidth=(100*g_pog_json[_].SegmentW).toFixed(2),t.PogWidth=(100*g_pog_json[_].W).toFixed(2),t.BackDepth=(100*g_pog_json[_].BackDepth).toFixed(2),t.TrafficFlow=g_pog_json[_].TrafficFlow,t.BaseH=(100*g_pog_json[_].BaseH).toFixed(2),t.BaseW=(100*g_pog_json[_].BaseW).toFixed(2),t.BaseD=(100*g_pog_json[_].BaseD).toFixed(2),t.NotchW=(100*g_pog_json[_].NotchW).toFixed(2),t.NotchStart=(100*g_pog_json[_].NotchStart).toFixed(2),t.NotchSpacing=(100*g_pog_json[_].NotchSpacing).toFixed(2),t.Color=g_pog_json[_].Color,t.HorzStart=(100*g_pog_json[_].HorzStart).toFixed(2),t.HorzSpacing=(100*g_pog_json[_].HorzSpacing).toFixed(2),t.VertStart=(100*g_pog_json[_].VertStart).toFixed(2),t.VertSpacing=(100*g_pog_json[_].VertSpacing).toFixed(2),t.AllowOverlap=g_pog_json[_].AllowOverlap,t.SpecialType=g_pog_json[_].SpecialType,t.SpecialTypeDesc=g_pog_json[_].SpecialTypeDesc,t.DisplayMeterage=g_pog_json[_].DisplayMeterage,t.Category=g_pog_json[_].Category,t.SubCategory=g_pog_json[_].SubCategory,t.RPTMeterage=nvl(g_pog_json[_].RPTMeterage),t.EffStartDate=g_pog_json[_].EffStartDate,t.BrandGroupID=g_pog_json[_].BrandGroupID,t.Remarks=g_pog_json[_].Remarks,t.StoreSegment=g_pog_json[_].StoreSegment,t.Desc7=g_pog_json[_].Desc7,t.Area=g_pog_json[_].Area,t.PLNDept=g_pog_json[_].PLNDept,t.SubDept=g_pog_json[_].SubDept,t.Dept=g_pog_json[_].Dept,t.Division=g_pog_json[_].Division,t.FixtureGeneration=g_pog_json[_].FixtureGeneration,t.FixtureFamily=g_pog_json[_].FixtureFamily,t.FixtureType=g_pog_json[_].FixtureType,t.FixtureTypeDesc=g_pog_json[_].FixtureTypeDesc,t.FixtureCodes=g_pog_json[_].FixtureCodes,t.FixtureCount=g_pog_json[_].FixtureCount,t.Flex_Text_1=g_pog_json[_].Flex_Text_1,t.Flex_Text_2=g_pog_json[_].Flex_Text_2,t.Flex_Text_3=g_pog_json[_].Flex_Text_3,t.Flex_Text_4=g_pog_json[_].Flex_Text_4,t.Flex_Lov_1=g_pog_json[_].Flex_Lov_1,t.Flex_Lov_2=g_pog_json[_].Flex_Lov_2,t.Flex_Lov_3=g_pog_json[_].Flex_Lov_3,t.Flex_Lov_4=g_pog_json[_].Flex_Lov_4,t.Flex_Lov_5=g_pog_json[_].Flex_Lov_5,t.Flex_Lov_6=g_pog_json[_].Flex_Lov_6,t.PogDepth=(100*g_pog_json[_].D).toFixed(2),t.SegmentW=(100*g_pog_json[_].SegmentW).toFixed(2),t.PromStartDt=g_pog_json[_].PromStartDt,t.PromEndDt=g_pog_json[_].PromEndDt,t.PromName=g_pog_json[_].PromName,t.PDFTemplateName=g_pog_json[_].PDFTemplateName,t.ComparePogVersion=g_pog_json[_].ComparePogVersion,t.Flex_Text_15=g_pog_json[_].Flex_Text_15,t.StoreFormat=g_pog_json[_].StoreFormat,t.pog_recreate="";var I="";if(g_pog_json.length>1&&"M"==o){t.MultiEdit="Y";var r=0;for(pogs of g_pog_json)r>0&&(I+=","),I+=pogs.POGCode+"$$"+pogs.Version,r++}else t.MultiEdit="N",t.Flex_Text_11=g_pog_json[_].Flex_Text_11,t.Flex_Text_12=g_pog_json[_].Flex_Text_12,t.Flex_Text_13=g_pog_json[_].Flex_Text_13,I=g_pog_json[_].POGCode+"$$"+g_pog_json[_].Version;t.pog_codes=I,n.push(t),g_is_pog_template_open,sessionStorage.setItem("openpogjson",JSON.stringify(n)),"Y"==g_is_pog_template_open?openCustomDialog(e,$v("P25_POG_TEMPLATE_URL"),"P25_POG_TRIGGER_ELEMENT"):openCustomDialog(e,$v("P25_POG_URL"),"P25_POG_TRIGGER_ELEMENT"),logDebug("function : open_pog_modal","E")}catch(e){error_handling(e)}}async function open_edit_modal_popup(e,_,o,n,t,g="N"){logDebug("function : open_edit_modal_popup; object_ind : "+e+"; module_ind : "+_+"; shelf_ind : "+o+"; duplicate_fixel : "+n,"S");var l="N";if("Y"==g_carpark_item_flag?l="N":"I"==e&&(l=g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[g_item_index].Item),"M"==e){if("undefined"!=typeof g_pog_json&&g_pog_json[t].ModuleInfo.length>0){var i=[],d=0;for(const e of g_pog_json[t].ModuleInfo)g_module_index!==d&&i.push(e.Module.toUpperCase()),d++}var a=[],s={};s.PogModule=g_pog_json[t].ModuleInfo[_].Module,s.ModuleName=g_pog_json[t].ModuleInfo[_].POGModuleName,s.Remarks=g_pog_json[t].ModuleInfo[_].Remarks,s.H=(100*g_pog_json[t].ModuleInfo[_].H).toFixed(2),s.W=(100*g_pog_json[t].ModuleInfo[_].W).toFixed(2),s.D=(100*g_pog_json[t].ModuleInfo[_].D).toFixed(2),s.Rotation=(100*g_pog_json[t].ModuleInfo[_].Rotation).toFixed(2),s.NotchW=(100*g_pog_json[t].ModuleInfo[_].NotchW).toFixed(2),s.NStart=(100*g_pog_json[t].ModuleInfo[_].NotchStart).toFixed(2),s.Nspacing=(100*g_pog_json[t].ModuleInfo[_].NotchSpacing).toFixed(2),s.HorzStart=(100*g_pog_json[t].ModuleInfo[_].HorzStart).toFixed(2),s.HorzSpacing=(100*g_pog_json[t].ModuleInfo[_].HorzSpacing).toFixed(2),s.VertStart=(100*g_pog_json[t].ModuleInfo[_].VertStart).toFixed(2),s.VertSpacing=(100*g_pog_json[t].ModuleInfo[_].VertSpacing).toFixed(2),s.AllowOvrelap=g_pog_json[t].ModuleInfo[_].AllowOverlap,s.LeftNotch=g_pog_json[t].ModuleInfo[_].LNotch,s.MBackBoard=g_pog_json[t].ModuleInfo[_].Backboard,s.RightNotch=g_pog_json[t].ModuleInfo[_].RNotch,s.LastCompCount=g_pog_json[t].ModuleInfo[_].LastCount,s.Division=g_pog_json[t].Division,s.Dept=g_pog_json[t].Dept,s.Subdept=g_pog_json[t].ModuleInfo[_].SubDept,s.Color=g_pog_json[t].ModuleInfo[_].Color,s.ModNames=i,s.Type="E",s.IsTemplate=g_is_pog_template_open,a.push(s),sessionStorage.setItem("modulelist",JSON.stringify(a)),$s("P25_MODULE_EDIT_IND","Y"),openCustomDialog("create_module",$v("P25_CREATE_MODAL_URL"),"P25_MODALPOG_TRIGGER"),g_temp_POG_arr=JSON.stringify(g_pog_json),apex.item("P25_MODULE_NAME").setFocus(),$("#DELETE_MODULE").css("display","inline")}else if("S"==e)if("TEXTBOX"==g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ObjType){if($s("P25_OBJECT_TYPE",g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ObjType),$s("P25_TEXT_NAME",g_pog_json[t].ModuleInfo[_].ShelfInfo[o].Desc),$s("P25_TEXT_HEIGHT",(100*g_pog_json[t].ModuleInfo[_].ShelfInfo[o].H).toFixed(2)),$s("P25_TEXT_WIDTH",(100*g_pog_json[t].ModuleInfo[_].ShelfInfo[o].W).toFixed(2)),$s("P25_TEXT_ROTATION",g_pog_json[t].ModuleInfo[_].ShelfInfo[o].Rotation),$s("P25_TEXT_SLOPE",g_pog_json[t].ModuleInfo[_].ShelfInfo[o].Slope),$s("P25_TEXT_COLOR",g_pog_json[t].ModuleInfo[_].ShelfInfo[o].Color),$s("P25_TEXT",g_pog_json[t].ModuleInfo[_].ShelfInfo[o].InputText),$s("P25_WRAP_TEXT",g_pog_json[t].ModuleInfo[_].ShelfInfo[o].WrapText),$s("P25_REDUCETOFIT",g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ReduceToFit),$s("P25_TEXT_DIRECTION",g_pog_json[t].ModuleInfo[_].ShelfInfo[o].TextDirection),$s("P25_FONT_STYLE",g_pog_json[t].ModuleInfo[_].ShelfInfo[o].FStyle),$s("P25_FONT_SIZE",g_pog_json[t].ModuleInfo[_].ShelfInfo[o].FSize),$s("P25_BOLD",g_pog_json[t].ModuleInfo[_].ShelfInfo[o].FBold),apex.item("P25_TEXT_NAME").setFocus(),"N"==n?($s("P25_TEXT_ID",g_pog_json[t].ModuleInfo[_].ShelfInfo[o].Shelf),$s("P25_SHELF_EDIT_IND","Y"),$("#DELETE_TEXT").css("display","inline")):($s("P25_TEXT_ID",""),$s("P25_SHELF_EDIT_IND","N")),g_temp_image_arr=[],""!==g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].TextImg){var f={};if(f.FileName=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].TextImgName,f.MimeType=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].TextImgMime,f.Image=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].TextImg,g_temp_image_arr.push(f),g_temp_image_arr.length>0){var I=new Image;I.src="data:image/png;base64,"+g_temp_image_arr[0].Image,I.onload=function(){const e=document.createElement("canvas");e.width=500,e.height=100;e.getContext("2d").drawImage(I,0,0,500,100),$("#VIEW_IMAGE canvas").remove(),document.getElementById("VIEW_IMAGE").append(e)}}}else"N"===$v("P25_UPDATE_TXTFLD_ON_IMG_UPD")&&($s("P25_IMG_FILENAME",""),$("#IMAGE_AREA canvas").remove(),$("#VIEW_IMAGE canvas").remove());const e=["P25_TEXT_WIDTH","P25_TEXT_HEIGHT","P25_TEXT_COLOR","P25_TEXT_SLOPE","P25_TEXT_ROTATION","P25_FONT_STYLE","P25_FONT_SIZE","P25_BOLD","P25_TEXT","P25_WRAP_TEXT","P25_REDUCETOFIT","P25_IMG_FILENAME"];for(const _ of e)$("#"+_+"_CONTAINER .inc_tag_icon").remove(),$("#"+_).removeClass("apex-item-has-icon"),$("#"+_+"_CONTAINER").removeClass("apex-item-wrapper--has-icon");$("#P25_TEXT_ID, #P25_TEXT_NAME").hasClass("apex_disabled")&&$("#P25_TEXT_ID, #P25_TEXT_NAME").removeClass("apex_disabled"),openInlineDialog("add_textbox",75,85),g_initial_camera||(g_initial_camera=g_camera.clone())}else{"N"==n?$s("P25_SHELF_EDIT_IND","Y"):$s("P25_SHELF_EDIT_IND","N");var r=[];if("undefined"!=typeof g_pog_json&&g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.length>0){d=0;for(const e of g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo)g_shelf_index!==d&&r.push(e.Shelf.toUpperCase().trim()),d++}var p=[],c={};c.Allowcrush=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].AllowAutoCrush,c.Module=g_pog_json[t].ModuleInfo[g_module_index].Module,c.ShelfLen=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.length,c.ModW=g_pog_json[t].ModuleInfo[g_module_index].W,c.ModH=g_pog_json[t].ModuleInfo[g_module_index].H,c.ModD=g_pog_json[t].ModuleInfo[g_module_index].D,c.ModX=g_pog_json[t].ModuleInfo[g_module_index].X,c.POGLen=g_pog_json.length,c.POGCode=g_pog_json[t].POGCode,void 0===g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ManualCrush||""==g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ManualCrush?$v("P25_POGCR_MANUAL_CRUSH_ITEM"):g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ManualCrush,c.ShelfInfo=g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index],c.module_index=_,c.shelf_index=o,c.duplicate_fixel=n,c.mod_disp_ind=$v("P25_MODULE_DISP"),c.edited_ind=$v("P25_SHELF_EDIT_IND"),c.g_duplicating=g_duplicating,c.g_item_edit_flag=g_item_edit_flag,c.delete_details=g_delete_details,c.g_overhung_shelf_active=g_overhung_shelf_active,c.g_multiselect=g_multiselect,c.object_type=g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ObjType,c.ShlfNames=r,c.dividerchecked=g_default_checkbox,p.push(c),sessionStorage.setItem("shelf_arr",JSON.stringify(p)),sessionStorage.setItem("pog_json",JSON.stringify(g_pog_json[t])),sessionStorage.setItem("current_shelf_index",g_shelf_index),sessionStorage.setItem("current_module_index",g_module_index),openCustomDialog("SHELF_EDIT",$v("P25_SHELF_URL"),"P25_SHELF_TRIGGER_ELEMENT")}else if("I"==e&&"DIVIDER"!==l){var u={},m=0;"Y"==g_carpark_item_flag?(u=JSON.parse(JSON.stringify(g_pog_json[t].ModuleInfo[_].Carpark[0].ItemInfo[g_item_index])),m=g_pog_json[t].ModuleInfo[_].H):(u=JSON.parse(JSON.stringify(g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[g_item_index])),m=get_max_merch(_,o,g_item_index,"N",-1,t));var h=JSON.parse(JSON.stringify(g_pog_json[t].ModuleInfo[_].ShelfInfo[o]));h.ItemInfo="",u.ItemInfo=g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo,u.MIndex=g_module_index,u.SIndex=g_shelf_index,u.IIndex=g_item_index,u.ShelfInfo=[h],u.Maxmerch=m,u.PIndex=t,u.ShelfAutoCrush=g_pog_json[t].ModuleInfo[_].ShelfInfo[o].AllowAutoCrush,u.g_combinedShelfs=g_combinedShelfs,u.g_multiselect=g_multiselect,u.g_ctrl_select=g_ctrl_select,u.g_carpark_item_flag=g_carpark_item_flag;var[S,O,j,x,M,T]=get_new_orientation_dim(u.Orientation,u.OW,u.OH,u.OD),b=g_orientation_json[u.Orientation];u.item_width=S,u.item_height=O,u.item_depth=j,u.actualHeight=x,u.actualWidth=M,u.actualDepth=T,u.Orientdetails=b,u.Shelf=g_pog_json[t].ModuleInfo[_].ShelfInfo[o].Shelf,u.ObjType=g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ObjType,u.BsktFill=g_pog_json[t].ModuleInfo[_].ShelfInfo[o].BsktFill,u.Combine=g_pog_json[t].ModuleInfo[_].ShelfInfo[o].Combine,"N"==g_carpark_item_flag&&(u.UnitperCase=g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[g_item_index].UnitperCase,u.UnitperTray=g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[g_item_index].UnitperTray,u.CapDepthChanged=g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[g_item_index].CapDepthChanged),u.g_overhung_shelf_active=g_overhung_shelf_active,u.g_auto_cal_depth_fac=g_auto_cal_depth_fac,sessionStorage.setItem("items_details",JSON.stringify(u)),openCustomDialog("OPEN_",$v("P25_PRODUCT_DETAILS_URL"),"P25_PRODUCT_DETAILS_TRIGGER"),logDebug("function : item region image loading","E")}else"I"==e&&"DIVIDER"==l?($s("P25_OBJECT_TYPE","DIVIDER"),$s("P25_DIVIDER_NAME",g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[g_item_index].Desc),$s("P25_DIV_HEIGHT",(100*g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[g_item_index].H).toFixed(2)),$s("P25_DIV_WIDTH",(100*g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[g_item_index].W).toFixed(2)),$s("P25_DIV_DEPTH",(100*g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[g_item_index].D).toFixed(2)),$s("P25_DIV_ROTATION",g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[g_item_index].Rotation),$s("P25_DIV_COLOR",g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[g_item_index].Color),$s("P25_DIVIDER_FIXED",g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[g_item_index].Fixed),$s("P25_SLOT_DIVIDER",g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[g_item_index].SlotDivider),$s("P25_SLOT_ORIENTATION",g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[g_item_index].Orientation),"N"==n?($s("P25_DIVIDER_ID",g_pog_json[t].ModuleInfo[_].ShelfInfo[o].ItemInfo[g_item_index].ItemID),$s("P25_ITEM_EDIT_IND","Y"),$("#DELETE_DIVIDER").css("display","inline")):($s("P25_DIVIDER_ID",g_pog_json[t].ModuleInfo[g_module_index].Module+(g_pog_json[t].ModuleInfo[g_module_index].ShelfInfo.length+1)),$s("P25_ITEM_EDIT_IND","N")),apex.item("P25_DIVIDER_NAME").setFocus(),openInlineDialog("add_divider",75,85)):"B"==e&&(open_pog_modal("edit_pog",t,g),$s("P25_MODULE_DISP",""));logDebug("function : open_edit_modal_popup","E")}function hide_show_page_items(e){logDebug("function : hide_show_page_items; p_object_type : "+e,"S");try{"SHELF"==e?($("#P25_HEIGHT_CONTAINER").show(),$("#P25_BASE_HEIGHT_CONTAINER").hide(),$("#P25_WALL_THICKNESS_CONTAINER").hide(),$("#P25_UPPER_OVERHANG_CONTAINER").hide(),$("#P25_WALL_HEIGHT_CONTAINER").hide(),$("#P25_SNAP_TO_SHELF_CONTAINER").hide(),$("#P25_BASKET_FILL_CONTAINER").hide(),$("#P25_SPREAD_PRODUCT_BASKET_CONTAINER").hide(),$("#P25_LOWER_OVERHANG_CONTAINER").hide(),$("#P25_LEFT_OVERHANG_CONTAINER").show(),$("#P25_RIGHT_OVERHANG_CONTAINER").show(),$("#P25_HORIZ_SPACING_CONTAINER").show(),$("#P25_HORIZ_START_CONTAINER").hide(),$("#P25_VERT_START_CONTAINER").hide(),$("#P25_VERT_SPACING_CONTAINER").hide(),$("#P25_GRILL_HEIGHT_CONTAINER").show(),$("#P25_SPACER_THICKNESS_CONTAINER").show(),$("#P25_HORIZ_GAP_CONTAINER").show(),$("#P25_SPREAD_PRODUCTS_CONTAINER").show(),$("#P25_COMBINE_CONTAINER").show(),$("#P25_ALLOW_AUTO_CRUSH_CONTAINER").show(),$("#P25_DEPTH_SLOT_START_CONTAINER").hide(),$("#P25_DEPTH_SLOT_SPACING_CONTAINER").hide(),$("#P25_CHEST_HORZ_GAP_CONTAINER").hide(),$("#P25_DEPTH_GAP_CONTAINER").hide(),$("#P25_ROD_SPREAD_PRODUCTS_CONTAINER").hide(),$("#P25_MAX_MERCH_CONTAINER").show(),$("#P25_FRONT_OVERHANG_CONTAINER").hide(),$("#P25_BACK_OVERHANG_CONTAINER").hide(),$("#P25_SHELF_OVERLAP_CONTAINER").hide(),$("#P25_SHELF_SLOPE_CONTAINER").show(),$("#P25_ROTATION_CONTAINER").show(),$("#P25_AUTO_PLACING_CONTAINER").hide(),$("#divider").show(),$("#shelf_image").show(),$("#pegboard_image").hide(),$("#basket_image").hide(),$("#rod_image").hide(),$("#hanging_bar_image").hide(),$("#chest_image").hide(),$("#pallet_image").hide(),$('[aria-describedby="add_shelf"] span.ui-dialog-title').text(get_message("SHELF_LABEL"))):"PEGBOARD"==e?($("#P25_HEIGHT_CONTAINER").show(),$("#P25_SNAP_TO_SHELF_CONTAINER").hide(),$("#P25_BASKET_FILL_CONTAINER").hide(),$("#P25_SPREAD_PRODUCT_BASKET_CONTAINER").hide(),$("#P25_GRILL_HEIGHT_CONTAINER").hide(),$("#P25_WALL_HEIGHT_CONTAINER").hide(),$("#P25_BASE_HEIGHT_CONTAINER").hide(),$("#P25_WALL_THICKNESS_CONTAINER").hide(),$("#P25_SPACER_THICKNESS_CONTAINER").hide(),$("#P25_HORIZ_GAP_CONTAINER").hide(),$("#P25_SPREAD_PRODUCTS_CONTAINER").hide(),$("#P25_COMBINE_CONTAINER").hide(),$("#P25_UPPER_OVERHANG_CONTAINER").show(),$("#P25_LOWER_OVERHANG_CONTAINER").show(),$("#P25_HORIZ_START_CONTAINER").show(),$("#P25_VERT_START_CONTAINER").show(),$("#P25_VERT_SPACING_CONTAINER").show(),$("#P25_HORIZ_SPACING_CONTAINER").show(),$("#P25_LEFT_OVERHANG_CONTAINER").show(),$("#P25_RIGHT_OVERHANG_CONTAINER").show(),$("#P25_ALLOW_AUTO_CRUSH_CONTAINER").hide(),$("#P25_CHEST_HORZ_GAP_CONTAINER").hide(),$("#P25_DEPTH_GAP_CONTAINER").hide(),$("#P25_ROD_SPREAD_PRODUCTS_CONTAINER").hide(),$("#P25_MAX_MERCH_CONTAINER").show(),$("#P25_FRONT_OVERHANG_CONTAINER").hide(),$("#P25_BACK_OVERHANG_CONTAINER").hide(),$("#P25_SHELF_OVERLAP_CONTAINER").show(),$("#P25_SHELF_SLOPE_CONTAINER").show(),$("#P25_ROTATION_CONTAINER").show(),$("#P25_AUTO_PLACING_CONTAINER").show(),$("#divider").hide(),$("#shelf_image").hide(),$("#basket_image").hide(),$("#pegboard_image").show(),$("#hanging_bar_image").hide(),$("#chest_image").hide(),$("#rod_image").hide(),$("#pallet_image").hide(),$('[aria-describedby="add_shelf"] span.ui-dialog-title').text(get_message("PEGBOARD_LABEL"))):"HANGINGBAR"==e?($("#P25_HEIGHT_CONTAINER").show(),$("#P25_SNAP_TO_SHELF_CONTAINER").hide(),$("#P25_BASKET_FILL_CONTAINER").hide(),$("#P25_SPREAD_PRODUCT_BASKET_CONTAINER").hide(),$("#P25_GRILL_HEIGHT_CONTAINER").hide(),$("#P25_WALL_HEIGHT_CONTAINER").hide(),$("#P25_BASE_HEIGHT_CONTAINER").hide(),$("#P25_WALL_THICKNESS_CONTAINER").hide(),$("#P25_SPACER_THICKNESS_CONTAINER").hide(),$("#P25_HORIZ_GAP_CONTAINER").show(),$("#P25_SPREAD_PRODUCTS_CONTAINER").show(),$("#P25_COMBINE_CONTAINER").show(),$("#P25_UPPER_OVERHANG_CONTAINER").hide(),$("#P25_LOWER_OVERHANG_CONTAINER").hide(),$("#P25_LEFT_OVERHANG_CONTAINER").show(),$("#P25_RIGHT_OVERHANG_CONTAINER").show(),$("#P25_ALLOW_AUTO_CRUSH_CONTAINER").hide(),$("#P25_HORIZ_START_CONTAINER").hide(),$("#P25_HORIZ_SPACING_CONTAINER").hide(),$("#P25_VERT_START_CONTAINER").hide(),$("#P25_VERT_SPACING_CONTAINER").hide(),$("#P25_CHEST_HORZ_GAP_CONTAINER").hide(),$("#P25_DEPTH_GAP_CONTAINER").hide(),$("#P25_ROD_SPREAD_PRODUCTS_CONTAINER").hide(),$("#P25_MAX_MERCH_CONTAINER").show(),$("#P25_FRONT_OVERHANG_CONTAINER").hide(),$("#P25_BACK_OVERHANG_CONTAINER").hide(),$("#P25_SHELF_OVERLAP_CONTAINER").hide(),$("#P25_SHELF_SLOPE_CONTAINER").hide(),$("#P25_ROTATION_CONTAINER").hide(),$("#P25_AUTO_PLACING_CONTAINER").hide(),$("#divider").hide(),$("#shelf_image").hide(),$("#pegboard_image").hide(),$("#basket_image").hide(),$("#hanging_bar_image").show(),$("#chest_image").hide(),$("#rod_image").hide(),$("#pallet_image").hide(),$('[aria-describedby="add_shelf"] span.ui-dialog-title').text(get_message("HANGINGBAR_LABEL"))):"BASKET"==e?($("#P25_GRILL_HEIGHT_CONTAINER").hide(),$("#P25_WALL_HEIGHT_CONTAINER").show(),$("#P25_SNAP_TO_SHELF_CONTAINER").show(),$("#P25_BASKET_FILL_CONTAINER").show(),$("#P25_SPREAD_PRODUCT_BASKET_CONTAINER").show(),$("#P25_HEIGHT_CONTAINER").hide(),$("#P25_BASE_HEIGHT_CONTAINER").show(),$("#P25_WALL_THICKNESS_CONTAINER").show(),$("#P25_SPACER_THICKNESS_CONTAINER").hide(),$("#P25_HORIZ_GAP_CONTAINER").hide(),$("#P25_SPREAD_PRODUCTS_CONTAINER").hide(),$("#P25_COMBINE_CONTAINER").hide(),$("#P25_LEFT_OVERHANG_CONTAINER").hide(),$("#P25_RIGHT_OVERHANG_CONTAINER").hide(),$("#P25_UPPER_OVERHANG_CONTAINER").hide(),$("#P25_LOWER_OVERHANG_CONTAINER").hide(),$("#P25_ALLOW_AUTO_CRUSH_CONTAINER").hide(),$("#P25_HORIZ_START_CONTAINER").hide(),$("#P25_HORIZ_SPACING_CONTAINER").hide(),$("#P25_VERT_START_CONTAINER").hide(),$("#P25_VERT_SPACING_CONTAINER").hide(),$("#P25_CHEST_HORZ_GAP_CONTAINER").hide(),$("#P25_DEPTH_GAP_CONTAINER").hide(),$("#P25_ROD_SPREAD_PRODUCTS_CONTAINER").hide(),$("#P25_MAX_MERCH_CONTAINER").show(),$("#P25_FRONT_OVERHANG_CONTAINER").hide(),$("#P25_BACK_OVERHANG_CONTAINER").hide(),$("#P25_SHELF_OVERLAP_CONTAINER").hide(),$("#P25_SHELF_SLOPE_CONTAINER").hide(),$("#P25_ROTATION_CONTAINER").hide(),$("#P25_AUTO_PLACING_CONTAINER").hide(),$("#P25_SNAP_TO_SHELF").addClass("apex_disabled"),$("#divider").hide(),$("#shelf_image").hide(),$("#pegboard_image").hide(),$("#hanging_bar_image").hide(),$("#basket_image").show(),$("#chest_image").hide(),$("#rod_image").hide(),$("#pallet_image").hide(),$('[aria-describedby="add_shelf"] span.ui-dialog-title').text(get_message("BASKET_LABEL"))):"CHEST"==e?($("#P25_GRILL_HEIGHT_CONTAINER").hide(),$("#P25_WALL_HEIGHT_CONTAINER").show(),$("#P25_SNAP_TO_SHELF_CONTAINER").hide(),$("#P25_BASKET_FILL_CONTAINER").hide(),$("#P25_SPREAD_PRODUCT_BASKET_CONTAINER").hide(),$("#P25_HEIGHT_CONTAINER").hide(),$("#P25_BASE_HEIGHT_CONTAINER").show(),$("#P25_WALL_THICKNESS_CONTAINER").show(),$("#P25_SPACER_THICKNESS_CONTAINER").hide(),$("#P25_HORIZ_GAP_CONTAINER").hide(),$("#P25_SPREAD_PRODUCTS_CONTAINER").hide(),$("#P25_COMBINE_CONTAINER").hide(),$("#P25_LEFT_OVERHANG_CONTAINER").hide(),$("#P25_RIGHT_OVERHANG_CONTAINER").hide(),$("#P25_UPPER_OVERHANG_CONTAINER").hide(),$("#P25_LOWER_OVERHANG_CONTAINER").hide(),$("#P25_ALLOW_AUTO_CRUSH_CONTAINER").hide(),$("#P25_HORIZ_START_CONTAINER").hide(),$("#P25_HORIZ_SPACING_CONTAINER").hide(),$("#P25_VERT_START_CONTAINER").hide(),$("#P25_VERT_SPACING_CONTAINER").hide(),$("#P25_DEPTH_SLOT_START_CONTAINER").show(),$("#P25_DEPTH_SLOT_SPACING_CONTAINER").show(),$("#P25_CHEST_HORZ_GAP_CONTAINER").show(),$("#P25_DEPTH_GAP_CONTAINER").hide(),$("#P25_ROD_SPREAD_PRODUCTS_CONTAINER").hide(),$("#P25_MAX_MERCH_CONTAINER").show(),$("#P25_FRONT_OVERHANG_CONTAINER").hide(),$("#P25_BACK_OVERHANG_CONTAINER").hide(),$("#P25_SHELF_OVERLAP_CONTAINER").hide(),$("#P25_SHELF_SLOPE_CONTAINER").hide(),$("#P25_ROTATION_CONTAINER").hide(),$("#P25_AUTO_PLACING_CONTAINER").hide(),$("#divider").show(),$("#shelf_image").hide(),$("#pegboard_image").hide(),$("#hanging_bar_image").hide(),$("#basket_image").hide(),$("#rod_image").hide(),$("#chest_image").show(),$("#pallet_image").hide(),$('[aria-describedby="add_shelf"] span.ui-dialog-title').text(get_message("CHEST_LABEL"))):"ROD"==e?($("#P25_GRILL_HEIGHT_CONTAINER").hide(),$("#P25_WALL_HEIGHT_CONTAINER").hide(),$("#P25_SNAP_TO_SHELF_CONTAINER").hide(),$("#P25_BASKET_FILL_CONTAINER").hide(),$("#P25_SPREAD_PRODUCT_BASKET_CONTAINER").hide(),$("#P25_HEIGHT_CONTAINER").show(),$("#P25_BASE_HEIGHT_CONTAINER").hide(),$("#P25_WALL_THICKNESS_CONTAINER").hide(),$("#P25_SPACER_THICKNESS_CONTAINER").hide(),$("#P25_HORIZ_GAP_CONTAINER").hide(),$("#P25_SPREAD_PRODUCTS_CONTAINER").hide(),$("#P25_COMBINE_CONTAINER").hide(),$("#P25_LEFT_OVERHANG_CONTAINER").hide(),$("#P25_RIGHT_OVERHANG_CONTAINER").hide(),$("#P25_UPPER_OVERHANG_CONTAINER").hide(),$("#P25_LOWER_OVERHANG_CONTAINER").hide(),$("#P25_ALLOW_AUTO_CRUSH_CONTAINER").hide(),$("#P25_HORIZ_START_CONTAINER").hide(),$("#P25_HORIZ_SPACING_CONTAINER").hide(),$("#P25_VERT_START_CONTAINER").hide(),$("#P25_VERT_SPACING_CONTAINER").hide(),$("#P25_CHEST_HORZ_GAP_CONTAINER").hide(),$("#P25_DEPTH_GAP_CONTAINER").show(),$("#P25_ROD_SPREAD_PRODUCTS_CONTAINER").show(),$("#P25_MAX_MERCH_CONTAINER").hide(),$("#P25_FRONT_OVERHANG_CONTAINER").hide(),$("#P25_BACK_OVERHANG_CONTAINER").hide(),$("#P25_SHELF_OVERLAP_CONTAINER").hide(),$("#P25_SHELF_SLOPE_CONTAINER").hide(),$("#P25_ROTATION_CONTAINER").hide(),$("#P25_AUTO_PLACING_CONTAINER").hide(),$("#divider").hide(),$("#shelf_image").hide(),$("#pegboard_image").hide(),$("#hanging_bar_image").hide(),$("#basket_image").hide(),$("#rod_image").show(),$("#chest_image").hide(),$("#pallet_image").hide(),$('[aria-describedby="add_shelf"] span.ui-dialog-title').text(get_message("ROD_LABEL"))):"PALLET"==e&&($("#P25_GRILL_HEIGHT_CONTAINER").hide(),$("#P25_WALL_HEIGHT_CONTAINER").hide(),$("#P25_SNAP_TO_SHELF_CONTAINER").hide(),$("#P25_BASKET_FILL_CONTAINER").hide(),$("#P25_SPREAD_PRODUCT_BASKET_CONTAINER").hide(),$("#P25_HEIGHT_CONTAINER").show(),$("#P25_BASE_HEIGHT_CONTAINER").hide(),$("#P25_WALL_THICKNESS_CONTAINER").hide(),$("#P25_SPACER_THICKNESS_CONTAINER").hide(),$("#P25_HORIZ_GAP_CONTAINER").hide(),$("#P25_SPREAD_PRODUCTS_CONTAINER").hide(),$("#P25_COMBINE_CONTAINER").hide(),$("#P25_LEFT_OVERHANG_CONTAINER").show(),$("#P25_RIGHT_OVERHANG_CONTAINER").show(),$("#P25_UPPER_OVERHANG_CONTAINER").hide(),$("#P25_LOWER_OVERHANG_CONTAINER").hide(),$("#P25_ALLOW_AUTO_CRUSH_CONTAINER").hide(),$("#P25_HORIZ_START_CONTAINER").hide(),$("#P25_HORIZ_SPACING_CONTAINER").hide(),$("#P25_VERT_START_CONTAINER").hide(),$("#P25_VERT_SPACING_CONTAINER").hide(),$("#P25_CHEST_HORZ_GAP_CONTAINER").show(),$("#P25_DEPTH_GAP_CONTAINER").hide(),$("#P25_ROD_SPREAD_PRODUCTS_CONTAINER").hide(),$("#P25_MAX_MERCH_CONTAINER").show(),$("#P25_FRONT_OVERHANG_CONTAINER").show(),$("#P25_BACK_OVERHANG_CONTAINER").show(),$("#P25_DEPTH_SLOT_START_CONTAINER").show(),$("#P25_DEPTH_SLOT_SPACING_CONTAINER").show(),$("#P25_SHELF_OVERLAP_CONTAINER").hide(),$("#P25_SHELF_SLOPE_CONTAINER").hide(),$("#P25_ROTATION_CONTAINER").hide(),$("#P25_AUTO_PLACING_CONTAINER").hide(),$("#divider").show(),$("#shelf_image").hide(),$("#pegboard_image").hide(),$("#hanging_bar_image").hide(),$("#basket_image").hide(),$("#chest_image").hide(),$("#rod_image").hide(),$("#pallet_image").show(),$('[aria-describedby="add_shelf"] span.ui-dialog-title').text(get_message("PALLET_LABEL"))),logDebug("function : hide_show_page_items","E")}catch(e){error_handling(e)}}function create_pog_modal(e,_,o){logDebug("function : create_pog_modal; bar_class : "+e+"; icon_class : "+_+"; modal_id : "+o,"S");try{if($s("P25_DRAFT_LIST",""),$s("P25_POG_DESCRIPTION",""),$s("P25_EXISTING_DRAFT_VER",""),"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&"Y"==g_pog_edited_ind)apex.event.trigger("#P25_COL_FLEX_LOV_1","apexrefresh"),apex.event.trigger("#P25_COL_FLEX_LOV_2","apexrefresh"),apex.event.trigger("#P25_COL_FLEX_LOV_3","apexrefresh"),apex.event.trigger("#P25_COL_FLEX_LOV_4","apexrefresh"),apex.event.trigger("#P25_COL_FLEX_LOV_5","apexrefresh"),apex.event.trigger("#P25_COL_FLEX_LOV_6","apexrefresh"),confirm(get_message("POGCR_CHANGE_REVERT_WARN"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){$("#chng_view_btn").css("display","none"),$("#pog_list_btn").css("display","none"),g_scene_objects=[],g_canvas_objects=[],g_pog_index=0,g_multi_pog_json=[],appendMultiCanvasRowCol(1),g_pog_json=[],g_module_obj_array=[],init(0),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects);try{open_modal(e,_,o)}catch(e){error_handling(e)}null!==apex.region("draggable_table")&&(save_pog_to_json(g_pog_json),apex.region("draggable_table").widget().interactiveGrid("getActions").set("edit",!1),apex.region("draggable_table").widget().interactiveGrid("getViews","grid").model.clearChanges())}));else{$("#chng_view_btn").css("display","none"),$("#pog_list_btn").css("display","none"),g_scene_objects=[],g_canvas_objects=[],g_pog_index=0,g_multi_pog_json=[],appendMultiCanvasRowCol(1),g_pog_json=[],g_module_obj_array=[],init(0),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects);try{open_modal(e,_,o)}catch(e){error_handling(e)}null!==apex.region("draggable_table")&&(save_pog_to_json(g_pog_json),apex.region("draggable_table").widget().interactiveGrid("getActions").set("edit",!1),apex.region("draggable_table").widget().interactiveGrid("getViews","grid").model.clearChanges(),apex.region("draggable_table").refresh())}logDebug("function : create_pog_modal","E")}catch(e){error_handling(e)}}function set_shelf_values(e,_,o,n,t,g,l,i,d,a){var s=[],f={},I=[];if("undefined"!=typeof g_pog_json&&g_pog_json[a].ModuleInfo[e].ShelfInfo.length>0){var r=0;for(const o of g_pog_json[a].ModuleInfo[e].ShelfInfo)_!==r&&-1!==_&&I.push(o.Shelf.toUpperCase()),r++}"undefined"!=typeof g_pog_json&&g_pog_json.length>0?(f.POGLen=g_pog_json.length,f.POGCode=g_pog_json[a].POGCode,f.Module=g_pog_json[a].ModuleInfo[e].Module,f.ShelfLen=g_pog_json[a].ModuleInfo[e].ShelfInfo.length,f.ModW=g_pog_json[a].ModuleInfo[e].W,f.ModH=g_pog_json[a].ModuleInfo[e].W,f.ModD=g_pog_json[a].ModuleInfo[e].D,f.ModX=g_pog_json[a].ModuleInfo[e].X,f.ShelfInfo=g_pog_json[a].ModuleInfo[e].ShelfInfo[_]):(f.POGLen=0,f.POGCode="",f.Module="A",f.ShelfLen=0,f.ModW=0,f.ModH=0,f.ModD=0,f.ModX=0,f.ShelfInfo=[]),f.Shelf=d,f.module_index=e,f.shelf_index=_,f.duplicate_fixel=o,f.mod_disp_ind=n,f.edited_ind=t,f.g_duplicating=g,f.i_item_edit_flag=l,f.object_type=i,f.ShlfNames=I,f.ManualCrush=$v("P25_POGCR_MANUAL_CRUSH_ITEM"),s.push(f),sessionStorage.setItem("shelf_arr",JSON.stringify(s))}function open_modal(e,_,o){if(logDebug("function : open_modal; bar_class : "+e+"; icon_class : "+_+"; modal_id : "+o,"S"),$(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),$(" ."+_).addClass("active"),$s("P25_SHELF_EDIT_IND","N"),g_dblclick_opened="Y",g_shelf_edit_flag="N",g_module_edit_flag="N","undefined"!=typeof g_pog_json&&g_pog_json.length>0&&"create_pog"!==_&&"create_module"!==_&&"create_template"!==_){if(-1==g_module_index&&"undefined"!=typeof g_pog_json&&g_pog_json.length>0){var n=0;for(const e of g_pog_json[g_pog_index].ModuleInfo){if(null==e.ParentModule||void 0===e.ParentModule){g_module_index=n;break}n++}}var t="N",g=g_pog_json[g_pog_index].ModuleInfo[g_module_index].Module+(g_pog_json[g_pog_index].ModuleInfo[g_module_index].ShelfInfo.length+1);$s("P25_ID",g),"create_rod"!==_&&$s("P25_WIDTH",(100*g_pog_json[g_pog_index].ModuleInfo[g_module_index].W).toFixed(2)),"create_pegboard"==_&&"create_divider"!==_?$s("P25_DEPTH",1):$s("P25_DEPTH",(100*g_pog_json[g_pog_index].ModuleInfo[g_module_index].D).toFixed(2))}if("create_shelf"==_)set_shelf_values(g_module_index,-1,"N",$v("P25_MODULE_DISP"),$v("P25_SHELF_EDIT_IND"),g_duplicating,g_item_edit_flag,"SHELF",g,g_pog_index),t="Y",g_dblclick_opened="N";else if("create_pegboard"==_)$s("P25_OBJ_NAME",`${get_message("PEGBOARD_LABEL")}`),set_shelf_values(g_module_index,-1,"N",$v("P25_MODULE_DISP"),$v("P25_SHELF_EDIT_IND"),g_duplicating,g_item_edit_flag,"PEGBOARD",g,g_pog_index),t="Y",g_dblclick_opened="N";else if("create_hangingbar"==_)set_shelf_values(g_module_index,-1,"N",$v("P25_MODULE_DISP"),$v("P25_SHELF_EDIT_IND"),g_duplicating,g_item_edit_flag,"HANGINGBAR",g,g_pog_index),t="Y",g_dblclick_opened="N";else if("create_text"==_){const e=["P25_TEXT_WIDTH","P25_TEXT_HEIGHT","P25_TEXT_COLOR","P25_TEXT_SLOPE","P25_TEXT_ROTATION","P25_FONT_STYLE","P25_FONT_SIZE","P25_BOLD","P25_TEXT","P25_WRAP_TEXT","P25_REDUCETOFIT","P25_IMG_FILENAME"];for(const _ of e)$("#"+_+"_CONTAINER .inc_tag_icon").remove(),$("#"+_).removeClass("apex-item-has-icon"),$("#"+_+"_CONTAINER").removeClass("apex-item-wrapper--has-icon");$s("P25_IMG_FILENAME",""),$("#IMAGE_AREA canvas").remove(),$("#VIEW_IMAGE canvas").remove(),g_dblclick_opened="Y",$s("P25_OBJECT_TYPE","TEXTBOX"),$s("P25_TEXT_ID",""),$("#DELETE_TEXT").css("display","none"),$("#REMOVE_IMAGE").css("display","none"),g_temp_image_arr=[],$("#IMAGE_AREA canvas").remove(),$s("P25_IMG_FILENAME",""),$("#VIEW_IMAGE canvas").remove(),$s("P25_TEXT",""),$s("P25_TEXT_HEIGHT",0),$s("P25_TEXT_NAME",""),$s("P25_TEXT_COLOR","#EBE6EB"),$s("P25_WRAP_TEXT","Y"),$s("P25_REDUCETOFIT","Y"),$s("P25_TEXT_DIRECTION","H"),$s("P25_TEXT_ROTATION",0),$s("P25_TEXT_SLOPE",0),$s("P25_TEXT_WIDTH",(100*g_pog_json[g_pog_index].ModuleInfo[g_module_index].W).toFixed(2))}else if("create_basket"==_)set_shelf_values(g_module_index,-1,"N",$v("P25_MODULE_DISP"),$v("P25_SHELF_EDIT_IND"),g_duplicating,g_item_edit_flag,"BASKET",g,g_pog_index),t="Y",g_dblclick_opened="N";else if("create_chest"==_)set_shelf_values(g_module_index,-1,"N",$v("P25_MODULE_DISP"),$v("P25_SHELF_EDIT_IND"),g_duplicating,g_item_edit_flag,"CHEST",g,g_pog_index),t="Y",g_dblclick_opened="N";else if("create_rod"==_)set_shelf_values(g_module_index,-1,"N",$v("P25_MODULE_DISP"),$v("P25_SHELF_EDIT_IND"),g_duplicating,g_item_edit_flag,"ROD",g,g_pog_index),t="Y",g_dblclick_opened="N";else if("create_pallet"==_)set_shelf_values(g_module_index,-1,"N",$v("P25_MODULE_DISP"),$v("P25_SHELF_EDIT_IND"),g_duplicating,g_item_edit_flag,"PALLET",g,g_pog_index),t="Y",g_dblclick_opened="N";else if("create_divider"==_)g_dblclick_opened="Y",$s("P25_OBJECT_TYPE","DIVIDER"),$s("P25_DIVIDER_NAME",""),$s("P25_DIV_HEIGHT",0),$s("P25_DIV_WIDTH",0),$s("P25_DIV_DEPTH",0),$s("P25_DIV_ROTATION",0),$s("P25_DIV_COLOR","#3D393D"),$s("P25_DIVIDER_ID",g),$("#DELETE_DIVIDER").css("display","none"),$s("P25_ITEM_EDIT_IND","N");else if("create_module"==_){if("undefined"!=typeof g_pog_json&&g_pog_json.length>0){var l=-1;n=0;for(const e of g_pog_json[g_pog_index].ModuleInfo)null!=e.ParentModule&&void 0!==e.ParentModule||(l=n),n++;if(-1!==l)if("A"==$v("P25_POG_MODULE_NAME_TYPE"))var i=nextLetter(g_pog_json[g_pog_index].ModuleInfo[l].Module);else i=l+1;else if("A"==$v("P25_POG_MODULE_NAME_TYPE"))i="a";else i=1}else if("A"==$v("P25_POG_MODULE_NAME_TYPE"))i="A";else i=1;if("undefined"!=typeof g_pog_json&&g_pog_json.length>0){var d=[];for(const e of g_pog_json[g_pog_index].ModuleInfo)d.push(e.Module.toUpperCase());var a=[],s={TextHeight:"0"};s.PogModule=i,s.NotchW=$v("P25_POG_NOTCH_WIDTH"),s.Nstart=$v("P25_POG_NOTCH_START"),s.Nspacing=$v("P25_POG_NOTCH_SPACING"),s.HorzStart=$v("P25_HORZ_START"),s.HorzSpacing=$v("P25_HORZ_SPACING"),s.VertStart=$v("P25_POG_VERT_START"),s.VertSpacing=$v("P25_POG_VERT_SPACING"),s.H=(100*(g_pog_json[g_pog_index].H-g_pog_json[g_pog_index].BaseH)).toFixed(2),s.Color=$v("P25_POG_MODULE_DEFAULT_COLOR"),s.D=(100*g_pog_json[g_pog_index].D).toFixed(2),s.W=(100*g_pog_json[g_pog_index].SegmentW).toFixed(2),s.ModNames=d,s.Division=g_pog_json[g_pog_index].Division,s.Dept=g_pog_json[g_pog_index].Dept,s.Subdept=g_pog_json[g_pog_index].SubDept,s.Type="N",a.push(s),sessionStorage.setItem("modulelist",JSON.stringify(a)),$s("P25_MODULE_EDIT_IND","N"),g_dblclick_opened="N",t="Y",openCustomDialog("create_module",$v("P25_CREATE_MODAL_URL"),"P25_MODALPOG_TRIGGER")}}else if("create_pog"==_||"create_template"==_){t="Y",g_dblclick_opened="N",sessionStorage.removeItem("openpogjson"),sessionStorage.removeItem("fixtureDimension");var f="create_pog"==_?$v("P25_POG_URL"):$v("P25_POG_TEMPLATE_URL");apex.server.process("DELETE_ITEMS_COLL",{x01:""},{dataType:"text",success:async function(e){openCustomDialog("CREATE_POG",f,"P25_POG_TRIGGER_ELEMENT")},loadingIndicatorPosition:"page"})}"N"==t?openInlineDialog(o,75,85):"create_pog"!==_&&"create_module"!==_&&"undefined"!=typeof g_pog_json&&g_pog_json.length>0&&openCustomDialog("SHELF_EDIT",$v("P25_SHELF_URL"),"P25_SHELF_TRIGGER_ELEMENT"),logDebug("function : open_modal","E")}async function update_multi_pog_edit(e){for(const _ of g_pog_json)_.Flex_Text_1=e[0].Flex_Text_1,_.Flex_Text_2=e[0].Flex_Text_2,_.Flex_Text_3=e[0].Flex_Text_3,_.Flex_Text_4=e[0].Flex_Text_4,_.Flex_Text_11=e[0].Flex_Text_11,_.Flex_Text_12=e[0].Flex_Text_12,_.Flex_Text_13=e[0].Flex_Text_13,_.Flex_Lov_1=e[0].Flex_Lov_1,_.Flex_Lov_2=e[0].Flex_Lov_2,_.Flex_Lov_3=e[0].Flex_Lov_3,_.Flex_Lov_4=e[0].Flex_Lov_4,_.Flex_Lov_5=e[0].Flex_Lov_5,_.Flex_Lov_6=e[0].Flex_Lov_6;g_dblclick_opened="N",apex.message.showPageSuccess(g_pog_refresh_msg)}async function create_pog(){logDebug("function : create_pog","S");try{var e={},_=[];_=null!==sessionStorage.getItem("openpogjson")?JSON.parse(sessionStorage.getItem("openpogjson")):[],g_upload_file_flag=_[0].fileUPloadedFlag;apex.item("P25_POG_CODE").getValue();var o=$v("P25_POG_EDIT_IND"),n=parseInt(_[0].Color.replace("#","0x"),16),t=new THREE.Color(n);g_temp_POG_arr=JSON.stringify(g_pog_json);var g,l,i,d="N",a="N";if("undefined"!=typeof g_pog_json&&g_pog_json.length>0?(e=g_pog_json[g_pog_index],g_pog_json[g_pog_index].POGCode,o="Y",g_pog_json[g_pog_index].BaseW===parseFloat($v("P25_POG_BASE_WIDTH"))/100&&g_pog_json[g_pog_index].BaseH===parseFloat($v("P25_POG_BASE_HEIGHT"))/100||"Y"):(g_pog_json=[],o="N",sessionStorage.setItem("pog_opened","N")),"Y"==o){d=_[0].pog_recreate;var s=0;for(const e of g_pog_json[g_pog_index].ModuleInfo)null!=e.ParentModule&&"undefined"!=e.ParentModule||(g_pog_json[g_pog_index].ModuleInfo[s].SubDept=_[0].SubDept),s++;g_pog_json[g_pog_index].Division===_[0].Division&&g_pog_json[g_pog_index].Dept===_[0].Dept&&g_pog_json[g_pog_index].SubDept===_[0].SubDept||(a="Y")}else d="Y";if("Y"==o)var f=await get_pog_exist_flag(_[0].POGCode,g_pog_json[g_pog_index].POGCode);else f="N";$s("P25_OPEN_POG_CODE",_[0].POGCode),"undefined"!=g_autofill_detail.AFVersion&&(g_autofill_detail.AFPOGCode=$v("P25_OPEN_POG_CODE"));var I=g_pog_json&&g_pog_json[g_pog_index]&&g_pog_json[g_pog_index]?.ModuleInfo?g_pog_json[g_pog_index]?.ModuleInfo:[],r=0;for(s=0;s<I?.length;s++){var p=I[s];p&&(null==p.ParentModule&&r++)}if(parseFloat(_[0]?.PogSegmentWidth)*r>parseFloat(_[0]?.PogWidth)?e.W=parseFloat(_[0]?.PogSegmentWidth)*r/100:e.W=parseFloat(_[0]?.PogWidth)/100,e.NewPOG=f,e.DesignType="D",e.Action="C",e.POGCode=_[0].POGCode,e.Version=e.Version,e.Opened="N",e.Name=_[0].Name,e.Division=_[0].Division,e.Dept=_[0].Dept,e.SubDept=_[0].SubDept,e.Type=_[0].Type,e.H=parseFloat(_[0].PogHeight)/100,e.D=parseFloat(_[0].PogDepth)/100,e.BackDepth=parseFloat(_[0].BackDepth)/100,e.SegmentW=parseFloat(_[0].PogSegmentWidth)/100,e.TrafficFlow=_[0].TrafficFlow,e.BaseH=parseFloat(_[0].BaseH)/100,e.BaseW=parseFloat(_[0].BaseW)/100,e.BaseD=parseFloat(_[0].BaseD)/100,e.NotchW=parseFloat(_[0].NotchW)/100,e.NotchStart=parseFloat(_[0].NotchStart)/100,e.NotchSpacing=parseFloat(_[0].NotchSpacing)/100,e.Color=_[0].Color,e.HorzStart=parseFloat(_[0].HorzStart)/100,e.HorzSpacing=parseFloat(_[0].HorzSpacing)/100,e.VertStart=parseFloat(_[0].VertStart)/100,e.VertSpacing=parseFloat(_[0].VertSpacing)/100,e.AllowOverlap=_[0].AllowOverlap,e.SpecialType=_[0].SpecialType,e.SpecialTypeDesc=_[0].SpecialTypeDesc,e.DisplayMeterage=_[0].DisplayMeterage,e.RPTMeterage=_[0].RPTMeterage,e.EffStartDate=_[0].EffStartDate,e.BrandGroupID=_[0].BrandGroupID,e.Remarks=_[0].Remarks,e.FixtureGeneration=_[0].FixtureGeneration,e.FixtureFamily=_[0].FixtureFamily,e.FixtureFamilyHidden=_[0].FixtureFamilyHidden,e.FixtureType=_[0].FixtureType.toString().split("-")[0].trim(),e.FixtureTypeDesc=_[0].FixtureTypeDesc,e.FixtureCodes=_[0].FixtureCodes,e.FixtureCount=_[0].FixtureCount,e.Flex_Text_1=_[0].Flex_Text_1,e.Flex_Text_2=_[0].Flex_Text_2,e.Flex_Text_3=_[0].Flex_Text_3,e.Flex_Text_4=_[0].Flex_Text_4,e.Flex_Text_11=_[0].Flex_Text_11,e.Flex_Text_12=_[0].Flex_Text_12,e.Flex_Text_13=_[0].Flex_Text_13,e.Flex_Text_15=_[0].Flex_Text_15,e.StoreFormat=_[0].StoreFormat,e.Flex_Lov_1=_[0].Flex_Lov_1,e.Flex_Lov_2=_[0].Flex_Lov_2,e.Flex_Lov_3=_[0].Flex_Lov_3,e.Flex_Lov_4=_[0].Flex_Lov_4,e.Flex_Lov_5=_[0].Flex_Lov_5,e.Flex_Lov_6=_[0].Flex_Lov_6,e.StoreSegment=_[0].StoreSegment,e.Desc7=_[0].Desc7,e.Area=_[0].Area,e.PLNDept=_[0].PLNDept,e.ModuleDIR=_[0].ModuleDIR,e.Direction=_[0].Direction,e.OrderType=_[0].OrderType,e.StartOneFixel=_[0].StartOneFixel,e.StartOneModuleLoc=_[0].StartOneModuleLoc,e.Ignore=_[0].IGNORE,e.IncludeModName=_[0].IncludeModName,e.PromStartDt=_[0].PromStartDt,e.PromEndDt=_[0].PromEndDt,e.PromName=_[0].PromName,e.PDFTemplateName=_[0].PDFTemplateName,e.ComparePogVersion=_[0].ComparePogVersion,e.Separator=_[0].SEPARATOR,e.LeadingText=_[0].LeadingText,e.TrailingText=_[0].TrailingText,e.Category=_[0].Category,e.SubCategory=_[0].SubCategory,e.SalesRrshDtl=_[0].SalesRrshDtl,e.Cal_Width=0,e.Cal_height=0,"N"==o?(e.ModuleInfo=[],g_pog_json.push(e),g_module_index=0):g_pog_json[g_pog_index]=e,l=e.W/2,i=e.H/2-e.BaseH/2+e.BaseH,e.X=l,e.Y=i,g=parseFloat(e.BaseH)/2,$s("25_OPEN_POG_CODE",_[0].POGCode),e.BaseH>0)add_pog_base("BASE1",e.BaseW,e.BaseH,e.BaseD,t,l,g,o,g_pog_index);if("Y"==d){!async function(){g_pog_edited_ind="Y",await add_pog(e.POGCode,e.W,e.H,e.D,e.Color,t,e.X,e.Y,o,g_camera,g_pog_index),render(g_pog_index),(g_show_live_image="Y")&&animate_pog(g_pog_index),logDebug("function : create_pog","E")}()}"Y"==a&&save_pog_to_json(g_pog_json),$(".create_module").css("visibility","visible"),$(".create_shelf").css("visibility","visible"),$(".create_pegboard").css("visibility","visible"),$(".create_text").css("visibility","visible"),$(".create_hangingbar").css("visibility","visible"),$(".create_basket").css("visibility","visible"),$(".create_chest").css("visibility","visible"),$(".create_rod").css("visibility","visible"),$(".create_pallet").css("visibility","visible"),$(".create_divider").css("visibility","visible"),$(".fixel_label").css("visibility","visible"),$(".item_label").css("visibility","visible"),$(".item_desc").css("visibility","visible"),$(".open_fixel").css("visibility","visible"),$(".clear_item").css("visibility","visible"),$(".clear_pog_att").css("visibility","visible"),$(".clear_pog_info").css("visibility","visible"),$(".icon-bar ul").css("margin","2%"),g_dblclick_opened="N",add_pog_code_header(),generateMultiPogDropdown(),set_indicator_objects(g_pog_index),apex.message.showPageSuccess(g_pog_refresh_msg)}catch(e){error_handling(e)}}async function create_pog_module(e,_){logDebug("function : create_pog_module","S");var o=[],n={},t={},g=(o=null!==sessionStorage.getItem("mod_details")?JSON.parse(sessionStorage.getItem("mod_details")):[])[0].Module,l=$v("P25_MODULE_EDIT_IND"),i=parseInt(o[0].Color.replace("#","0x"),16),d=new THREE.Color(i),a=0,s="N",f=0,I="N",r=[],p=-1;try{if("undefined"!=typeof g_pog_json&&g_pog_json[_].ModuleInfo.length>0){var c=0;for(const e of g_pog_json[_].ModuleInfo){if(e.Module.toUpperCase()==g.toUpperCase()){if(n=e,"Y"==l&&g_module_index!==c){"Y";break}if("N"==l){"Y";break}}c++}}if("Y"==l){n=g_pog_json[_].ModuleInfo[g_module_index];var u=g_pog_json[_].ModuleInfo;c=0;for(const e of u)e.ParentModule==g_pog_json[_].ModuleInfo[g_module_index].Module&&(g_pog_json[_].ModuleInfo[c].ParentModule=o[0].Module,g_pog_json[_].ModuleInfo[c].SubDept=o[0].Subdept,g_pog_json[_].ModuleInfo[c].SeqNo=c+1),c++}if(g_pog_json[_].ModuleInfo.length>0){c=0;for(const e of g_pog_json[_].ModuleInfo)null!=e.ParentModule&&"undefined"!=e.ParentModule||(c!==g_module_index&&(f+=parseFloat(e.W)),c!==g_module_index&&"N"==s?a+=parseFloat(e.W):c==g_module_index&&(f=wpdSetFixed(f+parseFloat(o[0].W)/100),s="Y"),r.push(e.H)),c++;"Y"==l&&(0==g_module_index?r.splice(g_module_index,g_module_index+1):r.splice(g_module_index,1))}if(r.push(parseFloat(o[0].H)/100),g_pog_json[_].W=f,g_pog_json[_].H=Math.max.apply(Math,r)+g_pog_json[_].BaseH,g_pog_json[_].X=parseFloat(o[0].W)/2,g_pog_json[_].Y=parseFloat(o[0].H)/2,"Y"==l&&g_pog_json[_].ModuleInfo[g_module_index].H===parseFloat(o[0].H)/100&&g_pog_json[_].ModuleInfo[g_module_index].W===parseFloat(o[0].W)/100&&g_pog_json[_].ModuleInfo[g_module_index].Color===o[0].Color&&g_pog_json[_].ModuleInfo[g_module_index].Rotation===parseFloat(o[0].Rotation)&&g_pog_json[_].ModuleInfo[g_module_index].NotchW===parseFloat(o[0].ModuleNwidth)/100&&g_pog_json[_].ModuleInfo[g_module_index].NotchStart===parseFloat(o[0].ModuleNstart)/100&&g_pog_json[_].ModuleInfo[g_module_index].NotchSpacing===parseFloat(o[0].ModuleNspacing)/100&&g_pog_json[_].ModuleInfo[g_module_index].HorzStart===parseFloat(o[0].HorzStart)/100&&g_pog_json[_].ModuleInfo[g_module_index].HorzSpacing===parseFloat(o[0].HorzSpacing)/100&&g_pog_json[_].ModuleInfo[g_module_index].VertStart===parseFloat(o[0].VertStart)/100&&g_pog_json[_].ModuleInfo[g_module_index].VertSpacing===parseFloat(o[0].VertSpacing)/100||(I="Y"),"Y"==l&&"N"==I){var m=g_scene_objects[_].scene.children[2].getObjectById(g_pog_json[_].ModuleInfo[g_module_index].MObjID);o[0].Remarks!==g_pog_json[_].ModuleInfo[g_module_index].Remarks&&(m.Remarks=o[0].Remarks),o[0].Module!==g_pog_json[_].ModuleInfo[g_module_index].Module&&(m.Module=o[0].Module)}if(n.SeqNo=g_module_index+1,n.Module=o[0].Module,n.ParentModule=null,n.POGModuleName=o[0].ModuleName,n.SubDept=o[0].Subdept,n.Remarks=o[0].Remarks,n.H=parseFloat(o[0].H)/100,n.W=parseFloat(o[0].W)/100,n.D=parseFloat(o[0].D)/100,n.Color=o[0].Color,n.Rotation=parseFloat(o[0].Rotation),n.NotchW=parseFloat(o[0].ModuleNwidth)/100,n.NotchStart=parseFloat(o[0].ModuleNstart)/100,n.NotchSpacing=parseFloat(o[0].ModuleNspacing)/100,n.HorzStart=parseFloat(o[0].HorzStart)/100,n.HorzSpacing=parseFloat(o[0].HorzSpacing)/100,n.VertStart=parseFloat(o[0].VertStart)/100,n.VertSpacing=parseFloat(o[0].VertSpacing)/100,n.AllowOverlap=o[0].ModuleAllowOverlap,n.LNotch="",n.Backboard="",n.RNotch="",n.X=a+n.W/2,n.Y=parseFloat(o[0].H)/100/2+g_pog_json[_].BaseH,n.Z=0,n.LastCount=0,n.Carpark=[],"N"==l?(n.ShelfInfo=[],n.EditFlag="N",g_pog_json[_].ModuleInfo.push(n),p=g_pog_json[_].ModuleInfo.length-1,n.NotchW>0&&((t={}).Shelf=get_message("LEFT_NOTCH",o[0].Module),t.ObjType="NOTCH",t.Desc="",t.MaxMerch=0,t.GrillH=0,t.LOverhang=0,t.ROverhang=0,t.SpacerThick=0,t.HorizGap=0,t.SpreadItem="L",t.Combine="N",t.AllowAutoCrush="N",t.H=n.H,t.W=n.NotchW,t.D=n.D,t.Rotation=0,t.Slope=0,t.Color=n.Color,t.LiveImage="",t.HorizSlotStart=0,t.HorizSlotSpacing=0,t.HorizStart=0,t.HorizSpacing=0,t.UOverHang=0,t.LoOverHang=0,t.VertiStart=0,t.VertiSpacing=0,t.X=n.X-n.W/2,t.Y=n.Y,t.Z=0,t.InputText="",t.WrapText="",t.ReduceToFit="",t.TextDirection="",t.BsktFill="",t.BsktSpreadProduct="",t.SnapTo="",t.BsktWallH=0,t.BsktBaseH=0,t.BsktWallThickness=0,t.DSlotStart=0,t.DSlotSpacing=0,t.DGap=0,t.FrontOverHang=0,t.BackOverHang=0,t.SlotDivider="",t.AllowOverLap="N",t.AutoPlacing="N",t.AutoFillPeg="N",t.SlotOrientation="",t.DividerFixed="N",t.LObjID=-1,t.NotchLabelObjID=-1,t.FStyle="",t.FSize="",t.FBold="",t.TextImg="",t.TextImgName="",t.TextImgMime="",t.ItemInfo=[],t.Overhung="N",g_pog_json[_].ModuleInfo[g_pog_json[_].ModuleInfo.length-1].ShelfInfo.push(t),(t={}).Shelf=get_message("RIGHT_NOTCH",o[0].Module),t.ObjType="NOTCH",t.Desc="",t.MaxMerch=0,t.GrillH=0,t.LOverhang=0,t.ROverhang=0,t.SpacerThick=0,t.HorizGap=0,t.SpreadItem="L",t.Combine="N",t.AllowAutoCrush="N",t.H=n.H,t.W=n.NotchW,t.D=n.D,t.Rotation=0,t.Slope=0,t.Color=n.Color,t.LiveImage="",t.HorizSlotStart=0,t.HorizSlotSpacing=0,t.HorizStart=0,t.HorizSpacing=0,t.UOverHang=0,t.LoOverHang=0,t.VertiStart=0,t.VertiSpacing=0,t.X=n.X+n.W/2-n.NotchW,t.Y=n.Y,t.Z=0,t.InputText="",t.WrapText="",t.ReduceToFit="",t.TextDirection="",t.BsktFill="",t.BsktSpreadProduct="",t.SnapTo="",t.BsktWallH=0,t.BsktBaseH=0,t.BsktWallThickness=0,t.DSlotStart=0,t.DSlotSpacing=0,t.DGap=0,t.FrontOverHang=0,t.BackOverHang=0,t.SlotDivider="",t.AllowOverLap="N",t.AutoPlacing="N",t.AutoFillPeg="N",t.SlotOrientation="",t.DividerFixed="N",t.LObjID=-1,t.NotchLabelObjID=-1,t.FStyle="",t.FSize="",t.FBold="",t.TextImg="",t.TextImgName="",t.TextImgMime="",t.ItemInfo=[],t.Overhung="N",g_pog_json[_].ModuleInfo[g_pog_json[_].ModuleInfo.length-1].ShelfInfo.push(t))):(n.EditFlag=g_pog_json[_].ModuleInfo[g_module_index].EditFlag,n.Carpark=g_pog_json[_].ModuleInfo[g_module_index].Carpark,g_pog_json[_].ModuleInfo[g_module_index]=n,p=g_module_index),"Y"==I){g_pog_edited_ind="Y","Y"==l&&update_module_coords(n.H,n.W,g_module_index,_);await add_module(n.Module,n.W,n.H,n.D,d,n.X,n.Y,l,"N",n.VertStart,n.VertSpacing,n.HorzStart,n.HorzSpacing,"N",e,p,_);render(_),(g_show_live_image="Y")&&animate_pog(_),"N"==l&&n.NotchW>0&&(g_pog_json[_].ModuleInfo[p].ShelfInfo[g_pog_json[_].ModuleInfo[p].ShelfInfo.length-2].X=g_pog_json[_].ModuleInfo[p].X-n.W/2,g_pog_json[_].ModuleInfo[p].ShelfInfo[g_pog_json[_].ModuleInfo[p].ShelfInfo.length-2].Y=g_pog_json[_].ModuleInfo[p].Y,g_pog_json[_].ModuleInfo[p].ShelfInfo[g_pog_json[_].ModuleInfo[p].ShelfInfo.length-1].X=g_pog_json[_].ModuleInfo[p].X+n.W/2-n.NotchW,g_pog_json[_].ModuleInfo[p].ShelfInfo[g_pog_json[_].ModuleInfo[p].ShelfInfo.length-1].Y=g_pog_json[_].ModuleInfo[p].Y),async function(){await recreate_compare_views(g_compare_view,"N")}()}apex.item("P25_MODULE_EDIT_IND").setValue("N"),g_dblclick_opened="N",apex.message.showPageSuccess(g_pog_refresh_msg),render(_),logDebug("function : create_pog_module","E")}catch(e){error_handling(e)}}async function create_shelf(e){logDebug("function : create_shelf","S");var _,o,n={},t=g_shelf_details[0].Shelf,g=parseInt(g_shelf_details[0].Color.replace("#","0x"),16),l=new THREE.Color(g),i=$v("P25_SHELF_EDIT_IND"),d=0,a="N",s=-1,f=-1,I=[],r=[],p=-1;try{if(""==$v("P25_MODULE_DISP")&&"N"==i&&$.each(g_pog_json[e].ModuleInfo,(function(e,_){if(null==_.ParentModule||void 0===_.ParentModule)return g_module_index=e,!1})),"BASKET"!=g_shelf_details[0].ObjType&&"CHEST"!=g_shelf_details[0].ObjType||"Y",_=null!=g_shelf_details[0].MaxMerch?parseFloat(g_shelf_details[0].MaxMerch)/100:0,"Y"==i){n=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index],o=JSON.parse(JSON.stringify(g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index])),g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].SObjID;var c=wpdSetFixed(g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y+g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].H/2);if(g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.length>0&&"ROD"!==g_shelf_details[0].ObjType){$.each(g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo,(function(e,_){wpdSetFixed(_.Y-_.H/2)==c&&_.W,I.push(_.D),r.push(_.H)})),s=I.findIndex((function(e){return e>parseFloat(g_shelf_details[0].D)/100}));r.findIndex((function(e){return e>_}));if("CHEST"==g_shelf_details[0].ObjType||"PALLET"==g_shelf_details[0].ObjType)var u=parseFloat(g_shelf_details[0].ChestHorz)/100;else u=parseFloat(g_shelf_details[0].HorizGap)/100;u*(g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.length-1)}else g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.length>0&&"ROD"==g_shelf_details[0].ObjType&&($.each(g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo,(function(e,_){_.D})),parseFloat(g_shelf_details[0].DGap)/100*(g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.length-1));if(0!==parseFloat(g_shelf_details[0].Rotation)){var m=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X-parseFloat(g_shelf_details[0].W)/2,h=g_pog_json[e].ModuleInfo[g_module_index].X-g_pog_json[e].ModuleInfo[g_module_index].W/2,S=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X+parseFloat(g_shelf_details[0].W)/2,O=g_pog_json[e].ModuleInfo[g_module_index].X+g_pog_json[e].ModuleInfo[g_module_index].W/2,j=(c=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y+parseFloat(g_shelf_details[0].H)/2,g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y-parseFloat(g_shelf_details[0].H)/2);(m>=h||S<=O||g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X>h&&g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X<O)&&c<g_pog_json[e].ModuleInfo[g_module_index].H&&j>0&&"Y"}}"Y"==g_duplicating&&"Y"==g_item_edit_flag&&(g_shelf_details[0].Shelf="C"+g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo.length,g_shelf_details[0].H=2,g_shelf_details[0].W=100*g_pog_json[e].ModuleInfo[g_module_index].W,g_shelf_details[0].D=100,n.creationType="A");var x="Y";"Y"!=i||n.SpreadItem===g_shelf_details[0].SpreadItem&&n.LOverhang===parseFloat(g_shelf_details[0].LOverhang)/100&&n.ROverhang===parseFloat(g_shelf_details[0].ROverhang)/100||(x="N",n.SpreadItem!==g_shelf_details[0].SpreadItem&&"Y"),"Y"==i&&n.Shelf!==g_shelf_details[0].Shelf&&([A,F]=getCombinationShelf(e,n.Shelf),-1!==F&&updateObjID(g_shelf_details[0].OldObjID,g_shelf_details[0].OldObjID,"S",n.Shelf,g_shelf_details[0].Shelf));const g=100*n.Z-100*n.D/2;n.Shelf=g_shelf_details[0].Shelf,n.ObjType=g_shelf_details[0].ObjType,n.Desc=g_shelf_details[0].Desc,n.MaxMerch=wpdSetFixed(g_shelf_details[0].MaxMerch/100),n.GrillH=wpdSetFixed(g_shelf_details[0].GrillH/100),n.LOverhang=wpdSetFixed(g_shelf_details[0].LOverhang/100),n.ROverhang=wpdSetFixed(g_shelf_details[0].ROverhang/100),n.SpacerThick=wpdSetFixed(g_shelf_details[0].SpacerThick/100),n.BsktWallH=wpdSetFixed(g_shelf_details[0].BsktWallH/100),n.BsktBaseH=wpdSetFixed(g_shelf_details[0].BsktBaseH/100),n.H=wpdSetFixed(g_shelf_details[0].H/100),n.D=wpdSetFixed(g_shelf_details[0].D/100),n.NotchNo=g_shelf_details[0].NotchNo,n.ManualCrush=g_shelf_details[0].ManualCrush,"CHEST"==g_shelf_details[0].ObjType||"PALLET"==g_shelf_details[0].ObjType?n.HorizGap=wpdSetFixed(g_shelf_details[0].ChestHorz/100):n.HorizGap=wpdSetFixed(g_shelf_details[0].HorizGap/100),n.SpreadItem=g_shelf_details[0].SpreadItem,n.Combine=g_shelf_details[0].Combine,n.AllowAutoCrush=""==g_shelf_details[0].AllowAutoCrush?"N":g_shelf_details[0].AllowAutoCrush;var M=0;"BASKET"==n.ObjType||"CHEST"==n.ObjType?"Y"==g_chest_as_pegboard&&"CHEST"==n.ObjType?(M=n.D,n.H=n.D):(M=n.BsktBaseH,n.H=n.BsktBaseH):M=n.H,n.H=M,n.W=wpdSetFixed(g_shelf_details[0].W/100),n.Slope=wpdSetFixed(g_shelf_details[0].Slope),n.Rotation=wpdSetFixed(g_shelf_details[0].Rotation),n.Color=g_shelf_details[0].Color,n.LiveImage=g_shelf_details[0].LiveImage,n.HorizSlotStart=wpdSetFixed(g_shelf_details[0].HorizSlotStart/100),n.HorizSlotSpacing=wpdSetFixed(g_shelf_details[0].HorizSlotSpacing/100),n.HorizStart=wpdSetFixed(g_shelf_details[0].HorizStart/100),n.HorizSpacing=wpdSetFixed(g_shelf_details[0].HorizSpacing/100),n.UOverHang=wpdSetFixed(g_shelf_details[0].UOverHang/100),n.LoOverHang=wpdSetFixed(g_shelf_details[0].LoOverHang/100),n.VertiStart=wpdSetFixed(g_shelf_details[0].VertiStart/100),n.VertiSpacing=wpdSetFixed(g_shelf_details[0].VertiSpacing/100),n.InputText=g_shelf_details[0].InputText,n.WrapText=g_shelf_details[0].WrapText,n.ReduceToFit=g_shelf_details[0].ReduceToFit,n.TextDirection=g_shelf_details[0].TextDirection,n.BsktFill=g_shelf_details[0].BsktFill,n.BsktSpreadProduct=g_shelf_details[0].BsktSpreadProduct,n.SnapTo=g_shelf_details[0].SnapTo,n.BsktWallThickness=wpdSetFixed(g_shelf_details[0].BsktWallThickness/100),n.DSlotStart=wpdSetFixed(g_shelf_details[0].DSlotStart/100),n.DSlotSpacing=wpdSetFixed(g_shelf_details[0].DSlotSpacing/100),n.DGap=wpdSetFixed(g_shelf_details[0].DGap/100),n.FrontOverHang=wpdSetFixed(g_shelf_details[0].FrontOverHang/100),n.BackOverHang=wpdSetFixed(g_shelf_details[0].BackOverHang/100),n.SlotDivider=g_shelf_details[0].SlotDivider,n.AllowOverLap=g_shelf_details[0].AllowOverLap,n.AutoPlacing=g_shelf_details[0].AutoPlacing,n.AutoFillPeg=g_shelf_details[0].AutoFillPeg,n.SlotOrientation=g_shelf_details[0].SlotOrientation,n.DividerFixed=g_shelf_details[0].DividerFixed,n.LObjID=g_shelf_details[0].LObjID,n.NotchLabelObjID=g_shelf_details[0].NotchLabelObjID,n.FStyle=g_shelf_details[0].FStyle,n.FSize=$v("P25_POGCR_TEXT_DEFAULT_SIZE"),n.FBold=g_shelf_details[0].FBold,n.TextImg=g_shelf_details[0].TextImg,n.TextImgName=g_shelf_details[0].TextImgName,n.TextImgMime=g_shelf_details[0].TextImgMime,n.OldObjID=g_shelf_details[0].SObjID,n.Overhung=g_shelf_details[0].Overhung,n.DivHeight=wpdSetFixed(g_shelf_details[0].DivHeight/100),n.DivWidth=wpdSetFixed(g_shelf_details[0].DivWidth/100),n.DivPst=g_shelf_details[0].DivPst,n.DivPed=g_shelf_details[0].DivPed,n.DivCreated=g_shelf_details[0].DivCreated,n.DivPbtwFace=g_shelf_details[0].DivPbtwFace,n.DivStX=wpdSetFixed(g_shelf_details[0].DivStX/100),n.DivSpaceX=wpdSetFixed(g_shelf_details[0].DivSpaceX/100),n.DivFillCol=g_shelf_details[0].DivFillCol,n.NoDivIDShow=g_shelf_details[0].NoDivIDShow,n.InsidePegboard=g_shelf_details[0].InsidePegboard,"SHELF"==g_shelf_details[0].ObjType&&(n.AvlSpace=n.W+n.LOverhang+n.ROverhang);var T=.003;if("Y"==i){f=g_shelf_index;var b=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X,D=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y}else{f=-1;var E=[],v=[];g_pog_json[e].ModuleInfo[g_module_index].LastCount=g_pog_json[e].ModuleInfo[g_module_index].LastCount+1,0==g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo.length?d=n.H/2+g_pog_json[e].BaseH:($.each(g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo,(function(e,_){"BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType&&(E.push(_.Y),v.push(e))})),E.length>0?(d=Math.max.apply(Math,E),s=E.findIndex((function(e){return e==d})),d=d>0?d+g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[v[s]].H/2+g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[v[s]].MaxMerch+n.H/2:n.H/2+g_pog_json[e].BaseH):d=n.H/2+g_pog_json[e].BaseH),d>g_pog_json[e].H&&(d=g_pog_json[e].H+.02);b=g_pog_json[e].ModuleInfo[g_module_index].X;if("N"==g_duplicate_fixel_flag)D=d;else D=g_pog_json[e].ModuleInfo[g_module_index].H+n.H/2+g_pog_json[e].BaseH}if("Y"==g_duplicating&&"Y"==g_item_edit_flag){var N=g_intersects[0].point.x,P=g_intersects[0].point.y,C=g_intersects[0].point.z,R=new THREE.Vector3(N,P,C);g_scene_objects[e].scene.children[2].worldToLocal(R),b=Math.min(19,Math.max(-19,R.x)),D=Math.min(19,Math.max(-19,R.y))}n.X=b,n.Y=D,n.Z=void 0===n.Z||""==n.Z?g_pog_json[e].BackDepth/2+n.D/2:g/100+n.D/2,"N"==i?(n.ItemInfo=[],g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo.push(n),g_shelf_index=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo.length-1):g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index]=n;var y=[],H=(r=[],[]),Y=[];if("Y"==i){var[A,F]=[-1,-1];"N"===g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Combine&&"N"===o.Combine||(await generateCombinedShelfs(e,g_module_index,g_shelf_index,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y","","Y"),"N"!==g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Combine&&([A,F]=getCombinationShelf(e,n.Shelf),-1==A&&alert(get_message("COMBINE_NOT_ACTIVE",n.Shelf)))),o.ItemInfo=JSON.parse(JSON.stringify(g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo)),"CHEST"==n.ObjType&&"Y"==g_chest_as_pegboard||await set_all_items(g_module_index,g_shelf_index,n.X,n.Y,"Y","N","Y",e,e)," "!==g_shelf_details[0].DivPbtwFace&&g_shelf_details[0].DivHeight>0&&g_shelf_details[0].DivWidth>0&&"Y"==g_shelf_details[0].DivCreated&&await create_shelf_dividers(e,g_module_index,g_shelf_index);var L="N";o.AllowAutoCrush===n.AllowAutoCrush&&o.H===n.H&&o.W===n.W&&o.D===n.D||(L="Y"),"PEGBOARD"!==n.ObjType&&"Y"==L&&reset_auto_crush(g_module_index,g_shelf_index,-1,e,g_module_index,g_shelf_index,e);var B=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo;await set_auto_facings(g_module_index,g_shelf_index,-1,B,"B","S","D",e,e),B=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo;if($.each(B,(function(_,o){void 0!==o.BottomObjID&&""!=o.BottomObjID||(y.push(wpdSetFixed(o.W)),r.push(wpdSetFixed(o.H)),H.push(wpdSetFixed(o.D)),Y.push(_)),g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[_].Exists="E"})),"ROD"===n.ObjType||"PEGBOARD"===n.ObjType||"CHEST"==n.ObjType&&"Y"==g_chest_as_pegboard)a="Y";else if(reorder_items(g_module_index,g_shelf_index,e)){var w=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index];a=validate_shelf_min_distance(g_module_index,g_shelf_index,D,B,n.AllowAutoCrush,g_module_index,b,"Y",w,e)}var X="N";if(("CHEST"!=n.ObjType||"Y"!=g_chest_as_pegboard)&&"PEGBOARD"!=n.ObjType)if(-1!==A)for(shelf_info of g_combinedShelfs[A]){var G=shelf_info.MIndex,W=shelf_info.SIndex,k=g_pog_json[e].ModuleInfo[G].ShelfInfo[W].ItemInfo,V=0;for(item of k){if(!(void 0!==item.BottomObjID&&""!=item.BottomObjID||void 0!==item.TopObjID&&""!=item.TopObjID))X=update_validate_item_height(item,G,W,V,item.X,n.ObjType,-1,e);V++}}else{V=0;for(item of B){if(!(void 0!==item.BottomObjID&&""!=item.BottomObjID||void 0!==item.TopObjID&&""!=item.TopObjID))X=update_validate_item_height(item,g_module_index,g_shelf_index,V,item.X,n.ObjType,-1,e);V++}}if("Y"!=a&&"R"!=a||"F"!=X&&"N"!=X||!validate_items(y,r,H,Y,g_shelf_details[0].ObjType,g_module_index,g_shelf_index,-1,"N",0,0,0,-1,"N","N","Y","N","N",[],"Y","Y","Y",e))" "!==g_shelf_details[0].DivPbtwFace&&g_shelf_details[0].DivHeight>0&&g_shelf_details[0].DivWidth>0&&"Y"==g_shelf_details[0].DivCreated&&remove_shelf_dividers(e,g_module_index,n.Shelf),0==f?g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo.splice(f,f+1):g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo.splice(f,1),g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo.splice(f,0,o);else{if(g_pog_edited_ind="Y","PEGBOARD"==n.ObjType)X=await add_pegboard(t,n.W,n.H,n.D,l,b,D,T,i,n.VertiStart,n.VertiSpacing,n.HorizStart,n.HorizSpacing,g_module_index,f,n.Rotation,n.Slope,"Y",$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),e);else if("ROD"==n.ObjType)X=await add_rod(t,n.ObjType,n.W,n.H,n.D,l,b,D,T,i,g_module_index,f,e);else{var[X,U]=await add_shelf(t,n.ObjType,n.W,n.H,n.D,l,b,D,T,i,g_module_index,n.Rotation,n.Slope,f,"Y","N",x,-1,$v("P25_POG_CP_SHELF_DFLT_COLOR"),$v("P25_NOTCH_HEAD"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),e);updateObjID(n.OldObjID,X,"S");p=U}if(apex.item("P25_SHELF_EDIT_IND").setValue("N"),g_dblclick_opened="N",g_duplicate_fixel_flag="N","Y"!==g_duplicating&&"Y"!==g_item_edit_flag&&apex.message.showPageSuccess(g_pog_refresh_msg),"Y"==g_show_max_merch){!async function(){await add_merch("N",e),await add_merch("Y",e)}()}}}else{if("N"!==g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Combine){await generateCombinedShelfs(e,g_module_index,g_shelf_index,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y","","Y");var[A,F]=getCombinationShelf(e,n.Shelf);-1==A&&alert(get_message("COMBINE_NOT_ACTIVE",n.Shelf))}if("PEGBOARD"==n.ObjType)X=await add_pegboard(t,n.W,n.H,n.D,l,b,D,T,i,n.VertiStart,n.VertiSpacing,n.HorizStart,n.HorizSpacing,g_module_index,f,n.Rotation,n.Slope,"Y",$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),e);else if("ROD"==n.ObjType)X=await add_rod(t,n.ObjType,n.W,n.H,n.D,l,b,D,T,i,g_module_index,f,e);else{var[X,U]=await add_shelf(t,n.ObjType,n.W,n.H,n.D,l,b,D,T,i,g_module_index,n.Rotation,n.Slope,f,"Y","N","Y",-1,$v("P25_POG_CP_SHELF_DFLT_COLOR"),$v("P25_NOTCH_HEAD"),$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),e);updateObjID(n.OldObjID,X,"S");p=U}"Y"==g_show_max_merch&&add_merch("Y",e),apex.item("P25_SHELF_EDIT_IND").setValue("N"),g_dblclick_opened="N",g_duplicate_fixel_flag="N","Y"!==g_duplicating&&"Y"!==g_item_edit_flag&&apex.message.showPageSuccess(g_pog_refresh_msg)}return async function(){await recreate_compare_views(g_compare_view,"N")}(),g_pog_json[e].ModuleInfo[g_module_index].EditFlag="Y","CHEST"==n.ObjType&&"Y"==g_chest_as_pegboard&&(g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ChestEdit="Y"),g_shelf_index,g_dragItem={},render(e),"Y"==g_show_live_image&&animate_all_pog(),logDebug("function : create_shelf","E"),p}catch(e){error_handling(e)}}async function create_textbox(e,_){logDebug("function : create_textbox","S");var o,n,t,g,l={},i={},d=-1,a=$v("P25_TEXT_ID"),s=apex.item("P25_SHELF_EDIT_IND").getValue(),f=0,I="N",r=-1,p="N";try{if("Y"==g_multiselect){var c=[],u=[];if(parseFloat($v("P25_TEXT_ROTATION"))>0||parseFloat($v("P25_TEXT_ROTATION"))<0)for(const Y of g_delete_details){c=g_pog_json[_].ModuleInfo[Y.MIndex];const A=(u=g_pog_json[_].ModuleInfo[Y.MIndex].ShelfInfo[Y.SIndex]).X-parseFloat($v("P25_TEXT_WIDTH"))/2,F=c.X-c.W/2,L=u.X+parseFloat($v("P25_TEXT_WIDTH"))/2,$=c.X+c.W/2,B=u.Y+parseFloat($v("P25_TEXT_HEIGHT"))/2,w=u.Y-parseFloat($v("P25_TEXT_HEIGHT"))/2;if(!(A>=F||L<=$||u.X>F&&u.X<$)&&B<c.H&&w>0){I="N";break}I="Y"}if(""!==$v("P25_TEXT_ROTATION")&&(parseFloat($v("P25_TEXT_ROTATION"))>359||parseFloat($v("P25_TEXT_ROTATION"))<0))alert(get_message("ROTATION_BTW_RANGE"));else if("Y"==I)alert(get_message("LOST_FROM_SHELF_ROTATION_ERR",u.Shelf,g_pog_json[_].POGCode+c.Module));else{for(const X of g_delete_details)if("TEXTBOX"==X.ObjType){var m=g_pog_json[_].ModuleInfo[X.MIndex].ShelfInfo[X.SIndex];g=m.Z,t=g_world.getObjectById(m.SObjID).position.z,d=-1;var h=0;i={};for(const G of g_pog_json[_].ModuleInfo){if(G.ObjID==m.SObjID){i=g_pog_json[_].ModuleInfo[h],d=h;break}h++}var S=m.X,O=m.Y,j=.0021,x=m.Shelf;if(r=X.SIndex,m.W=nvl($v("P25_TEXT_WIDTH"))<=0?m.W:parseFloat($v("P25_TEXT_WIDTH"))/100,m.H=nvl($v("P25_TEXT_HEIGHT"))<=0?m.H:parseFloat($v("P25_TEXT_HEIGHT"))/100,m.Color=0==nvl($v("P25_TEXT_COLOR"))?m.Color:$v("P25_TEXT_COLOR"),m.Slope=nvl($v("P25_TEXT_SLOPE"))<=0?m.Slope:parseFloat($v("P25_TEXT_SLOPE")),m.Rotation=nvl($v("P25_TEXT_ROTATION"))<=0?m.Rotation:parseFloat($v("P25_TEXT_ROTATION")),m.FStyle=0==nvl($v("P25_FONT_STYLE"))?m.FStyle:$v("P25_FONT_STYLE"),m.FSize=0==nvl($v("P25_FONT_SIZE"))?m.FSize:$v("P25_FONT_SIZE"),m.FBold=$v("P25_BOLD"),m.InputText=0==nvl($v("P25_TEXT"))?m.InputText:$v("P25_TEXT"),m.WrapText=0==nvl($v("P25_WRAP_TEXT"))?m.InputText:$v("P25_WRAP_TEXT"),m.ReduceToFit=0==nvl($v("P25_REDUCETOFIT"))?m.InputText:$v("P25_REDUCETOFIT"),m.TextDirection=0==nvl($v("P25_TEXT_DIRECTION"))?m.InputText:$v("P25_TEXT_DIRECTION"),g_temp_image_arr.length>0&&(m.TextImg=g_temp_image_arr[0].Image,m.TextImgName=g_temp_image_arr[0].FileName,m.TextImgMime=g_temp_image_arr[0].MimeType),o=parseInt(m.Color.replace("#","0x"),16),n=new THREE.Color(o),i.H=m.H,i.W=m.W,i.Color=m.Color,l.Z=g_pog_json[_].ModuleInfo[X.MIndex].ShelfInfo[r].Z,g_pog_edited_ind="Y","Y"==g_show_live_image&&""!==m.TextImg&&void 0!==m.TextImg&&null!==m.TextImg)var M=await add_text_box_with_image(x,"SHELF",m.W,m.H,m.D,n,S,O,j,s,X.MIndex,m.InputText,o,m.WrapText,m.ReduceToFit,m.Color,r,m.Rotation,m.Slope,"Y",m.FStyle,m.FSize,m.FBold,$v("P25_NOTCH_HEAD"),_);else M=add_text_box(x,"SHELF",m.W,m.H,m.D,n,S,O,j,s,X.MIndex,m.InputText,o,m.WrapText,m.ReduceToFit,m.Color,r,m.Rotation,m.Slope,"Y",m.FStyle,m.FSize,m.FBold,2,_,g_pogcr_enhance_textbox_fontsize,m.TextDirection);var T=get_textbox_z(X.MIndex,r,S,O,m.W,m.H,_);g_pog_json[_].ModuleInfo[X.MIndex].ShelfInfo[r].Z=T;var b=g_scene_objects[_].scene.children[2].getObjectById(M);T==g_pog_json[_].BackDepth?b.position.z=.001:b.position.z=T>.0021?.0021:0==T?6e-4:T,-1==d&&(i.SeqNo=g_pog_json[_].ModuleInfo.length+1,i.Module=x,i.ParentModule=g_pog_json[_].ModuleInfo[X.MIndex].Module,i.POGModuleName=m.Desc,i.SubDept=g_pog_json[_].ModuleInfo[X.MIndex].SubDept,i.Remarks=g_pog_json[_].ModuleInfo[X.MIndex].Remarks,i.D=0,i.Rotation=0,i.NotchW=0,i.NotchStart=0,i.NotchSpacing=0,i.HorzStart=0,i.HorzSpacing=0,i.VertStart=0,i.VertSpacing=0,i.AllowOverlap=0,i.LNotch=0,i.Backboard=0,i.RNotch=0,i.X=0,i.Y=0,i.Z=0,i.LastCount=0,i.EditFlag="N",i.Carpark=[],i.ShelfInfo=[],g_pog_json[_].ModuleInfo.push(i),d=g_pog_json[_].ModuleInfo.length-1),g_pog_json[_].ModuleInfo[d].ObjID=M,b.position.z=t,g_pog_json[_].ModuleInfo[X.MIndex].ShelfInfo[r].Z=g}async function D(){await recreate_compare_views(g_compare_view,"N")}D(),$s("P25_SHELF_EDIT_IND","N"),closeInlineDialog("add_textbox"),g_dblclick_opened="N",g_duplicate_fixel_flag="N",apex.message.showPageSuccess(g_pog_refresh_msg),render(_),g_multiselect="N",g_mselect_drag="N",g_temp_image_arr=[],$s("P25_SHELF_EDIT_IND","N")}}else{if(o=parseInt(apex.item("P25_TEXT_COLOR").getValue().replace("#","0x"),16),n=new THREE.Color(o),""==$v("P25_MODULE_DISP")&&"N"==s){h=0;for(const W of g_pog_json[_].ModuleInfo){if(null==W.ParentModule||void 0===W.ParentModule){g_module_index=h;break}h++}}if("undefined"!=typeof g_pog_json){h=0;for(const k of g_pog_json[_].ModuleInfo){if((null==k.ParentModule||void 0===k.ParentModule)&&k.ShelfInfo.length>0){var E=0;for(const V of k.ShelfInfo){if(V.Shelf.toUpperCase()==a.toUpperCase())if(l=V,"Y"==s){if(g_module_index==h&&g_shelf_index!==E){p="Y";break}if(g_module_index!==h){p="Y";break}}else if("N"==s){p="Y";break}E++}}h++}}if("Y"==s){l=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index],g=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Z,t=g_world.getObjectById(g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].SObjID).position.z;var v=g_pog_json[_].ModuleInfo;h=0;for(const U of v){if(U.ObjID==g_dblclick_objid){i=g_pog_json[_].ModuleInfo[h],d=h;break}h++}if(parseFloat($v("P25_TEXT_ROTATION"))>0||parseFloat($v("P25_TEXT_ROTATION"))<0){var N=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X-parseFloat($v("P25_TEXT_WIDTH"))/2,P=g_pog_json[_].ModuleInfo[g_module_index].X-g_pog_json[_].ModuleInfo[g_module_index].W/2,C=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X+parseFloat($v("P25_TEXT_WIDTH"))/2,R=g_pog_json[_].ModuleInfo[g_module_index].X+g_pog_json[_].ModuleInfo[g_module_index].W/2,y=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y+parseFloat($v("P25_TEXT_HEIGHT"))/2,H=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y-parseFloat($v("P25_TEXT_HEIGHT"))/2;(N>=P||C<=R||g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X>P&&g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X<R)&&y<g_pog_json[_].ModuleInfo[g_module_index].H&&H>0&&(I="Y")}}if(null!=apex.item("P25_MAX_MERCH").getValue()?l_shelf_max_merch=parseFloat(apex.item("P25_MAX_MERCH").getValue())/100:l_shelf_max_merch=0,"Y"==p)alert(get_message("COMPONENT_UNIQUE_ID"));else if(""==$v("P25_TEXT_HEIGHT")||""==$v("P25_TEXT_WIDTH")||""==$v("P25_TEXT_ID")||""==$v("P25_TEXT_COLOR"))alert(get_message("ENTER_MANDATORY_FIELDS"));else if(0==$v("P25_TEXT_HEIGHT"))alert(get_message("HEIGHT_GRT_THAN_ZERO"));else if(0==$v("P25_TEXT_WIDTH"))alert(get_message("WIDTH_GRT_THAN_ZERO"));else if(""!==$v("P25_TEXT_ROTATION")&&(parseFloat($v("P25_TEXT_ROTATION"))>359||parseFloat($v("P25_TEXT_ROTATION"))<0))alert(get_message("ROTATION_BTW_RANGE"));else if("Y"==I)alert(get_message("LOST_FROM_SHELF_ROTATION_ERR",g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Shelf,g_pog_json[_].POGCode+g_pog_json[_].ModuleInfo[g_module_index].Module));else{j=.0021;if(""==$v("P25_TEXT")&&$s("P25_TEXT"," "),"Y"==s)S=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X,O=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y;else{if(g_pog_json[_].ModuleInfo[g_module_index].LastCount=g_pog_json[_].ModuleInfo[g_module_index].LastCount+1,0==g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo.length)f=parseFloat($v("P25_TEXT_HEIGHT"))/100/2+g_pog_json[_].BaseH;else{h=0;for(const z of g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo){if("BASE"!==z.ObjType&&"NOTCH"!==z.ObjType&&"DIVIDER"!==z.ObjType)f+=z.MaxMerch+z.H;h++}f+=parseFloat($v("P25_TEXT_HEIGHT"))/100/2,g_pog_json[_].BaseH>0&&(f+=g_pog_json[_].BaseH)}f>g_pog_json[_].H&&(f=g_pog_json[_].H+.02);S=g_pog_json[_].ModuleInfo[g_module_index].X;if("N"==g_duplicate_fixel_flag)O=f;else O=g_pog_json[_].ModuleInfo[g_module_index].H+parseFloat($v("P25_TEXT_HEIGHT"))/100/2+g_pog_json[_].BaseH}if(l.Shelf=$v("P25_TEXT_ID"),l.ObjType=$v("P25_OBJECT_TYPE"),l.Desc=$v("P25_TEXT_NAME"),l.MaxMerch=0,l.GrillH=0,l.LOverhang=0,l.ROverhang=0,l.SpacerThick=0,l.HorizGap=0,l.SpreadItem="L",l.Combine="N",l.AllowAutoCrush="N",l.H=parseFloat($v("P25_TEXT_HEIGHT"))/100,l.W=parseFloat($v("P25_TEXT_WIDTH"))/100,l.D=.005,l.Rotation=parseFloat($v("P25_TEXT_ROTATION")),l.Slope=parseFloat($v("P25_TEXT_SLOPE")),l.Color=$v("P25_TEXT_COLOR"),l.LiveImage="",l.HorizSlotStart=0,l.HorizSlotSpacing=0,l.HorizStart=0,l.HorizSpacing=0,l.UOverHang=0,l.LoOverHang=0,l.VertiStart=0,l.VertiSpacing=0,l.X=S,l.Y=O,l.InputText=$v("P25_TEXT"),l.WrapText=$v("P25_WRAP_TEXT"),l.ReduceToFit=$v("P25_REDUCETOFIT"),l.TextDirection=$v("P25_TEXT_DIRECTION"),l.BsktFill="",l.BsktSpreadProduct="",l.SnapTo="",l.BsktWallH=0,l.BsktBaseH=0,l.BsktWallThickness=0,l.DSlotStart=0,l.DSlotSpacing=0,l.DGap=0,l.FrontOverHang=0,l.BackOverHang=0,l.SlotDivider="",l.AllowOverLap="N",l.SlotOrientation="",l.DividerFixed="N",l.LObjID=-1,l.NotchLabelObjID=-1,l.ChestEdit="N",l.FStyle=$v("P25_FONT_STYLE"),l.FSize=$v("P25_FONT_SIZE"),l.FBold=$v("P25_BOLD"),g_temp_image_arr.length>0?(l.TextImg=g_temp_image_arr[0].Image,l.TextImgName=g_temp_image_arr[0].FileName,l.TextImgMime=g_temp_image_arr[0].MimeType):(l.TextImg="",l.TextImgName="",l.TextImgMime=""),i.SeqNo=g_pog_json[_].ModuleInfo.length+1,i.Module=$v("P25_TEXT_ID"),i.ParentModule=g_pog_json[_].ModuleInfo[g_module_index].Module,i.POGModuleName=$v("P25_TEXT_NAME"),i.SubDept=g_pog_json[_].ModuleInfo[g_module_index].SubDept,i.Remarks=g_pog_json[_].ModuleInfo[g_module_index].Remarks,i.H=parseFloat($v("P25_TEXT_HEIGHT"))/100,i.W=parseFloat($v("P25_TEXT_WIDTH"))/100,i.D=0,i.Color=$v("P25_TEXT_COLOR"),i.Rotation=0,i.NotchW=0,i.NotchStart=0,i.NotchSpacing=0,i.HorzStart=0,i.HorzSpacing=0,i.VertStart=0,i.VertSpacing=0,i.AllowOverlap=0,i.LNotch=0,i.Backboard=0,i.RNotch=0,i.X=0,i.Y=0,i.Z=0,i.LastCount=0,i.EditFlag="N",i.Carpark=[],i.ShelfInfo=[],"N"==s?(l.Z=g_pog_json[_].BackDepth+l.D/2,l.ItemInfo=[],g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo.push(l),l.SIndex=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo.length-1,g_pog_json[_].ModuleInfo.push(i),g_pog_json[_].ModuleInfo[g_pog_json[_].ModuleInfo.length-1].ShelfInfo.push(l)):(l.Z=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Z,r=g_shelf_index,g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index]=l,-1==d?(g_pog_json[_].ModuleInfo.push(i),g_pog_json[_].ModuleInfo[g_pog_json[_].ModuleInfo.length-1].ShelfInfo.push(l),d=g_pog_json[_].ModuleInfo.length-1):(g_pog_json[_].ModuleInfo[d]=i,g_pog_json[_].ModuleInfo[d].ShelfInfo[0]=l)),g_pog_edited_ind="Y","Y"==g_show_live_image&&""!==l.TextImg&&void 0!==l.TextImg&&null!==l.TextImg)M=await add_text_box_with_image(a,"SHELF",l.W,l.H,l.D,n,S,O,j,s,g_module_index,l.InputText,o,l.WrapText,l.ReduceToFit,l.Color,r,l.Rotation,l.Slope,"Y",l.FStyle,l.FSize,l.FBold,$v("P25_NOTCH_HEAD"),_);else M=add_text_box(a,"SHELF",l.W,l.H,l.D,n,S,O,j,s,g_module_index,l.InputText,o,l.WrapText,l.ReduceToFit,l.Color,r,l.Rotation,l.Slope,"Y",l.FStyle,l.FSize,l.FBold,2,_,g_pogcr_enhance_textbox_fontsize,l.TextDirection);"N"==s&&(r=g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo.length-1);T=get_textbox_z(g_module_index,r,S,O,l.W,l.H,_);g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[r].Z=T;b=g_scene_objects[_].scene.children[2].getObjectById(M);async function D(){await recreate_compare_views(g_compare_view,"N")}T==g_pog_json[_].BackDepth?b.position.z=.001:b.position.z=T>.0021?.0021:0==T?6e-4:T,"N"==s?g_pog_json[_].ModuleInfo[g_pog_json[_].ModuleInfo.length-1].ObjID=M:(g_pog_json[_].ModuleInfo[d].ObjID=M,b.position.z=t,g_pog_json[_].ModuleInfo[g_module_index].ShelfInfo[r].Z=g),D(),$s("P25_SHELF_EDIT_IND","N"),closeInlineDialog("add_textbox"),g_dblclick_opened="N",g_duplicate_fixel_flag="N",g_temp_image_arr=[],apex.message.showPageSuccess(g_pog_refresh_msg),render(_)}}logDebug("function : create_textbox","E")}catch(Z){error_handling(Z)}}function create_divider(e){logDebug("function : create_divider","S");var _={},o=$v("P25_DIVIDER_ID"),n=apex.item("P25_ITEM_EDIT_IND").getValue(),t=parseInt(apex.item("P25_DIV_COLOR").getValue().replace("#","0x"),16),g=(new THREE.Color(t),-1),l="Y",i=-1,d="N",a={};d="N";try{if(""==$v("P25_MODULE_DISP")&&"N"==n){var s=0;for(const _ of g_pog_json[e].ModuleInfo){if(null==_.ParentModule||void 0===_.ParentModule){g_module_index=s;break}s++}}const t=o.toUpperCase().trim();if(d=g_pog_json[e].ModuleInfo.some((e=>e.ShelfInfo.some((e=>("Y"!==n||e.ShelfDivObjID!==g_dblclick_objid)&&(!(!e.Shelf||e.Shelf.toUpperCase().trim()!==t)||!!Array.isArray(e.ItemInfo)&&e.ItemInfo.some((e=>("Y"!==n||e.ObjID!==g_dblclick_objid)&&(e.ItemID&&e.ItemID.toUpperCase().trim()===t))))))))?"Y":"N","Y"==n){s=0;for(const o of g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo){if(o.ShelfDivObjID==g_dblclick_objid){_=o,i=s;break}s++}if(0!==parseFloat($v("P25_DIV_ROTATION"))){var f=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X-parseFloat($v("P25_DIV_WIDTH"))/2,I=g_pog_json[e].ModuleInfo[g_module_index].X-g_pog_json[e].ModuleInfo[g_module_index].W/2,r=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X+parseFloat($v("P25_DIV_WIDTH"))/2,p=g_pog_json[e].ModuleInfo[g_module_index].X+g_pog_json[e].ModuleInfo[g_module_index].W/2,c=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y+parseFloat($v("P25_DIV_HEIGHT"))/2,u=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y-parseFloat($v("P25_DIV_HEIGHT"))/2;(f>=I||r<=p||g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X>I&&g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X<p)&&c<g_pog_json[e].ModuleInfo[g_module_index].H&&u>0&&"Y"}a=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index],"PALLET"!==g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType&&"CHEST"!==g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType&&(l="N")}if("Y"==d)alert(get_message("COMPONENT_UNIQUE_ID"));else if(""==$v("P25_DIV_HEIGHT")||""==$v("P25_DIV_WIDTH")||""==$v("P25_DIV_DEPTH")||""==$v("P25_DIV_COLOR")||""==$v("P25_DIVIDER_ID"))alert(get_message("ENTER_MANDATORY_FIELDS"));else if(""!==$v("P25_DIV_ROTATION")&&(parseFloat($v("P25_DIV_ROTATION"))>359||parseFloat($v("P25_DIV_ROTATION"))<0))alert(get_message("ROTATION_BTW_RANGE"));else if(0==$v("P25_DIV_HEIGHT"))alert(get_message("HEIGHT_GRT_THAN_ZERO"));else if(0==$v("P25_DIV_WIDTH"))alert(get_message("WIDTH_GRT_THAN_ZERO"));else if(0==$v("P25_DIV_DEPTH"))alert(get_message("DEPTH_GRT_THAN_ZERO"));else if(0==g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo.length)alert(get_message("DIVIDER_WTOT_SHELF"));else if(parseFloat($v("P25_DIV_ROTATION"))>0&&"N"==l)alert(get_message("DIV_NOT_ROTATE"));else{if(g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo.length>0&&"N"==n){var m=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo,h=[],S=[];s=0;for(const e of m)"BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType&&(h.push(e.Y),S.push(s)),s++;var O=Math.max.apply(Math,h),j=h.findIndex((function(e){return e==O}));g_shelf_index=S[j]}if("Y"==n)var x=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].X,M=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Y;else x=g_pog_json[e].ModuleInfo[g_module_index].X-g_pog_json[e].ModuleInfo[g_module_index].W/2+parseFloat($v("P25_DIV_WIDTH"))/100/2,M=g_pog_json[e].ModuleInfo[g_module_index].Y+g_pog_json[e].ModuleInfo[g_module_index].H/2+parseFloat($v("P25_DIV_HEIGHT"))/100/2;if("Y"==n)var T=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index],b=T.ItemInfo[g_item_index].W;if(_.Shelf=o,_.ObjType=$v("P25_OBJECT_TYPE"),_.Desc=$v("P25_DIVIDER_NAME"),_.MaxMerch=0,_.GrillH=0,_.LOverhang=0,_.ROverhang=0,_.SpacerThick=0,_.HorizGap=0,_.SpreadItem="L",_.Combine="N",_.AllowAutoCrush="N",_.H=parseFloat($v("P25_DIV_HEIGHT"))/100,_.W=parseFloat($v("P25_DIV_WIDTH"))/100,_.D=parseFloat($v("P25_DIV_DEPTH"))/100,"PALLET"==g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType||"CHEST"==g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType?_.Rotation=parseFloat($v("P25_DIV_ROTATION")):_.Rotation=0,_.Slope=0,_.Color=$v("P25_DIV_COLOR"),_.LiveImage="",_.HorizSlotStart=0,_.HorizSlotSpacing=0,_.HorizStart=0,_.HorizSpacing=0,_.UOverHang=0,_.LoOverHang=0,_.VertiStart=0,_.VertiSpacing=0,_.X=x,_.Y=M,_.InputText="",_.WrapText="",_.ReduceToFit="",_.TextDirection="",_.BsktFill="",_.BsktSpreadProduct="",_.SnapTo="",_.BsktWallH=0,_.BsktBaseH=0,_.BsktWallThickness=0,_.DSlotStart=0,_.DSlotSpacing=0,_.DGap=0,_.FrontOverHang=0,_.BackOverHang=0,_.SlotDivider=$v("P25_SLOT_DIVIDER"),_.AllowOverLap="N",_.AutoPlacing="N",_.AutoFillPeg="N",_.SlotOrientation=$v("P25_SLOT_ORIENTATION"),_.DividerFixed=$v("P25_DIVIDER_FIXED"),_.LObjID=-1,_.NotchLabelObjID=-1,_.FStyle="",_.FSize="",_.FBold="",_.TextImg="",_.TextImgName="",_.TextImgMime="",_.TextImageBlob="",_.Overhung="N",a.ItemID=o,a.Item=$v("P25_OBJECT_TYPE"),a.W=parseFloat($v("P25_DIV_WIDTH"))/100,a.H=parseFloat($v("P25_DIV_HEIGHT"))/100,a.D=parseFloat($v("P25_DIV_DEPTH"))/100,a.Color=$v("P25_DIV_COLOR"),a.DimT="",a.Desc=$v("P25_DIVIDER_NAME"),a.Barcode="",a.LocID="",a.PegID="",a.PegSpread="",a.PegPerFacing="",a.Fixed=$v("P25_DIVIDER_FIXED"),a.CapStyle="","PALLET"==g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType||"CHEST"==g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ObjType?a.Rotation=parseFloat($v("P25_DIV_ROTATION")):a.Rotation=0,a.BHoriz=1,a.BVert=1,a.BaseD=1,a.CrushHoriz=0,a.CrushVert=0,a.CrushD=0,a.Orientation=$v("P25_SLOT_ORIENTATION"),a.MerchStyle="0",a.Supplier="",a.Brand="",a.Group="",a.Dept="",a.Class="",a.SubClass="",a.StdUOM="",a.SizeDesc="",a.Price="",a.Cost="",a.RegMovement="",a.AvgSales="",a.ItemStatus="",a.MoveBasis="",a.CHPerc=0,a.CWPerc=0,a.CDPerc=0,a.ItemNesting=0,a.NVal=0,a.ItemContain=0,a.CnVal=0,a.IsContainer=$v("P25_PRODUCT_IS_CONT"),a.BsktFactor=0,a.OverHang=0,a.HorizGap=0,a.VertGap=0,a.UW=0,a.UH=0,a.UD=0,a.CW=0,a.CH=0,a.CD=0,a.TW=0,a.TH=0,a.TD=0,a.DW=0,a.DH=0,a.DD=0,a.CWPerc=0,a.CHPerc=0,a.CDPerc=0,a.CnW=0,a.CnH=0,a.CnD=0,a.NW=0,a.NH=0,a.ND=0,a.OrgUW=0,a.OrgUH=0,a.OrgUD=0,a.OrgCW=0,a.OrgCH=0,a.OrgCD=0,a.OrgTW=0,a.OrgTH=0,a.OrgTD=0,a.OrgDW=0,a.OrgDH=0,a.OrgDD=0,a.OrgCHPerc=0,a.OrgCWPerc=0,a.OrgCDPerc=0,a.OrgCnW=0,a.OrgCnH=0,a.OrgCnD=0,a.OrgNW=0,a.OrgNH=0,a.OrgND=0,a.SIndex=g_shelf_index,a.Dragged="N",a.Quantity=0,a.X=x,a.Y=M,a.Z=g_pog_json[e].BackDepth+_.D/2,a.SlotDivider=$v("P25_SLOT_DIVIDER"),a.ImgExists="N",a.CapCount=0,a.Exists="E",a.DimUpdate="N",a.TopObjID="",a.BottomObjID="",a.SecondTier="N",a.SellingPrice="",a.SalesUnit="",a.NetSales="",a.CogsAdj="",a.GrossProfit="",a.WeeksCount="",a.MovingItem="",a.Profit="",a.TotalMargin="",a.MHorizFacings=-1,a.MVertFacings=-1,a.MDepthFacings=-1,a.Status="",a.DaysOfSupply="",a.OrientationDesc="",a.StoreCnt="",a.CapMaxH="",a.MaxHCapStyle="",a.NewYN="",a.Delist="N",a.DescSecond="",a.ItemCondition="",a.AUR="",a.ItemRanking="",a.WeeklySales="",a.WeeklyNetMargin="",a.WeeklyQty="",a.NetMarginPercent="",a.CumulativeNM="",a.TOP80B2="",a.ItemBrandC="",a.ItemPOGDept="",a.ItemRemark="",a.RTVStatus="",a.Pusher="",a.Divider="",a.BackSupport="",a.ShelfPrice="",a.PromoPrice="",a.DiscountRate="",a.PriceChangeDate="",a.WeeksOfInventory="",a.Qty="",a.WhStock="",a.StoreStock="",a.StockIntransit="",a.OOSPerc="",a.InitialItemDesc="",a.InitialBrand="",a.InitialBarcode="","N"==n)_.Z=g_pog_json[e].BackDepth+_.D/2,_.ItemInfo=[],g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo.push(_),i=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo.length-1,a.OW=parseFloat($v("P25_DIV_WIDTH"))/100,a.OH=parseFloat($v("P25_DIV_HEIGHT"))/100,a.OD=parseFloat($v("P25_DIV_DEPTH"))/100,a.SpreadItem=0,a.MHorizCrushed="N",a.MVertCrushed="N",a.MDepthCrushed="N",a.RW=a.OW,a.RH=a.OH,a.RD=a.OD,a.LObjID=-1,a.SubLblObjID=-1,g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo.length>0?(a.SIndex=g_shelf_index,g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.push(a)):(g_pog_json[e].ModuleInfo[g_module_index].ItemInfo=[],g_pog_json[e].ModuleInfo[g_module_index].ItemInfo.push(a)),g=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.length-1;else{var D=100*(parseFloat($v("P25_DIV_WIDTH"))/100-b);if(D>0&&D>T.AvlSpace)return void alert(get_message("LOST_FROM_SHELF_ERR_HORIZ",T.Shelf));T.AvlSpace=parseFloat((T.AvlSpace-D).toFixed(2));var E=g_world.getObjectById(T.SObjID);E&&(E.AvlSpace=T.AvlSpace),showFixelAvailableSpace("N","N",e),_.Z=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Z,g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[i]=_,a.OW=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].OW,a.OH=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].OH,a.OD=g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].OD,g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index]=a,g=g_item_index}if("Y"==n){var v=g_scene_objects[e].scene.children[2].getObjectById(g_dblclick_objid);g_scene_objects[e].scene.children[2].remove(v),render(e)}g_pog_edited_ind="Y";var N=add_items(o,a.W,a.H,a.D,a.Color,x,M,.004,g_module_index,g_shelf_index,g,a.Rotation,e);"N"==n?g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo.length-1].ObjID=N:g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].ObjID=N,g_pog_json[e].ModuleInfo[g_module_index].ShelfInfo[i].ShelfDivObjID=N,async function(){await recreate_compare_views(g_compare_view,"N")}(),$s("P25_ITEM_EDIT_IND","N"),closeInlineDialog("add_divider"),g_dblclick_opened="N",g_duplicate_fixel_flag="N",apex.message.showPageSuccess(g_pog_refresh_msg),render(e)}logDebug("function : create_divider","E")}catch(e){error_handling(e)}}async function fixture_numbering(e,_,o,n,t,g,l,i,d,a){logDebug("function : fixture_numbering; module_dir : "+e+"; order_dir : "+_+"; ignore : "+o+"; order_type : "+n+"; start_one_mod : "+t+"; include_mod_num : "+g+"; separator : "+l+"; leading_text : "+i+"; trailing_text : "+d,"S");var s,f,I=0,r=0,p="",c=g_pog_json[a].ModuleInfo,u=[],m={};g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[],89==g_keyCode||90==g_keyCode||(g_redo_all_obj_arr=[],g_redo_final_obj_arr=[],undoType="U",g_undoRedoAction="REDO"),f="REDO"==g_undoRedoAction?"U":"R",g_pog_json[a].ShelfIgnore=o,g_prev_undo_action="FIXTURE_NUMBERING",""===g_l_module_dir&&"undefined"==typeof g_l_module_dir||(m.MODULE_DIR=g_l_module_dir,m.DIRECTION=g_l_direction,m.IGNORE=g_l_ignore,m.ORDER_TYPE=g_l_order_type,m.START_ONE_MOD=g_l_start_one_mod,m.INCLUDE_MOD_NAME=g_l_include_mod_name,m.SEPARATOR=g_l_separator,m.LEADING_TEXT=g_l_leading_text,m.TRAILING_TEXT=g_l_trailing_text,g_cut_copy_arr.push(m),m={},"U"==f?(g_delete_details.multi_delete_shelf_ind="N",g_undo_all_obj_arr=[],g_undo_all_obj_arr.push(g_cut_copy_arr),g_undo_all_obj_arr.push(g_cut_copy_arr),g_undo_all_obj_arr.previousAction="FIXTURE_NUMBERING",g_cut_support_obj_arr.length>0?g_undo_all_obj_arr.hasSupportArr="Y":g_undo_all_obj_arr.hasSupportArr="N",g_undo_all_obj_arr.g_MultiObjects="N",g_undo_all_obj_arr.multi_delete_shelf_ind="N",g_undo_final_obj_arr.push(g_undo_all_obj_arr),g_undo_all_obj_arr=[],g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]):(g_delete_details.multi_delete_shelf_ind="N",g_redo_all_obj_arr=[],g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.previousAction="FIXTURE_NUMBERING",g_cut_support_obj_arr.length>0?g_redo_all_obj_arr.hasSupportArr="Y":g_redo_all_obj_arr.hasSupportArr="N",g_redo_all_obj_arr.g_MultiObjects="N",g_redo_all_obj_arr.multi_delete_shelf_ind="N",g_redo_final_obj_arr.push(g_redo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[],g_redo_all_obj_arr=[]));try{var h=0,S=0;if("Y"===$v("P25_POG_FIXEL_ID_PAD_SHELF_NO")){for(const e of c)if(void 0===e.ParentModule||null===e.ParentModule){var O=g_pog_json[a].ModuleInfo[S].ShelfInfo||[];for(const e of O)"TEXTBOX"!==e.ObjType&&"DIVIDER"!==e.ObjType&&h++}S++}if("LR"==e){var j=0;for(const e of c){if(void 0===e.ParentModule||null==e.ParentModule){r+=1;var x=e.X-e.W/2,M=e.X+e.W/2,T=e.Y+e.H/2,b=e.Y-e.H/2;if(g_pog_json[a].ModuleInfo[j].ShelfInfo.length>0)if("BTLR"==_||"LRBT"==_&&2==n){if((O=g_pog_json[a].ModuleInfo[j].ShelfInfo).forEach((function(e){e.CalcX=e.X-e.W/2})),"BTLR"==_){var D={CalcX:"asc",Y:"asc"};O.keySort(D)}else{D={Y:"asc"};O.keySort(D)}var E=0,v=0;if("Y"===$v("P25_POG_FIXEL_ID_PAD_SHELF_NO"))for(const e of O)"TEXTBOX"!==e.ObjType&&"DIVIDER"!==e.ObjType&&v++;for(const _ of O){var N="N",P=_.X-_.W/2,C=_.X+_.W/2;if((_.X>x&&_.X<=M||P>=x&&P<M||C>x&&C<M)&&_.Y>b&&_.Y<T&&(N="Y"),"BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"Y"==N)if("T:D"==o&&"DIVIDER"!==_.ObjType&&"TEXTBOX"!==_.ObjType||"T"==o&&"TEXTBOX"!==_.ObjType||"D"==o&&"DIVIDER"!==_.ObjType||""==o){if("1"==n?(I+=1,p=h>9&&I<10&&"Y"==$v("P25_POG_FIXEL_ID_PAD_SHELF_NO")?"0"+I:I):(e.Module==s&&""!=s||"2"!=t||(I=0),I+=1,s=e.Module,p="3"==g?r+l+(p=v>9&&I<10&&"Y"==$v("P25_POG_FIXEL_ID_PAD_SHELF_NO")?"0"+I:I):v>9&&I<10&&"Y"==$v("P25_POG_FIXEL_ID_PAD_SHELF_NO")?"0"+I:I),w=(w=i+" "+p+" "+d).trim(),"DIVIDER"==_.ObjType){var R=g_pog_json[a].ModuleInfo[j].ShelfInfo,y=0;for(const e of R){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType){var H=0;for(const o of e.ItemInfo)"DIVIDER"==o.Item&&_.ShelfDivObjID==o.ObjID&&(g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].OldItemID=g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID,g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID=w,g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Namechange=""),H++}y++}}else if("TEXTBOX"==_.ObjType){c=g_pog_json[a].ModuleInfo;$.each(c,(function(e,o){void 0!==o.ParentModule&&null!==o.ParentModule&&_.SObjID==o.ObjID&&(g_pog_json[a].ModuleInfo[e].OldPOGModule=g_pog_json[a].ModuleInfo[e].Module,g_pog_json[a].ModuleInfo[e].Module=w,$.each(o.ShelfInfo,(function(_,o){g_pog_json[a].ModuleInfo[e].ShelfInfo[_].OldShelf=g_pog_json[a].ModuleInfo[e].Module,g_pog_json[a].ModuleInfo[e].ShelfInfo[_].Shelf=w,g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Namechange=""})))}))}g_pog_json[a].ModuleInfo[j].ShelfInfo[E].OldShelf=g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Shelf,g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Shelf=w}else{var Y="",A="N";if("DIVIDER"!=_.ObjType||void 0!==_.Namechange&&""!=_.Namechange){if("TEXTBOX"==_.ObjType&&(void 0===_.Namechange||""==_.Namechange)){c=g_pog_json[a].ModuleInfo;if($.each(c,(function(e,o){if(void 0!==o.ParentModule&&null!==o.ParentModule){var n=g_pog_json[a].ModuleInfo[e].Module.split("_")[0];_.SObjID==o.ObjID&&($v("P25_FIXTURE_LABEL_TYPES").includes(n)||(A="Y",Y=$v("P25_TEXTBOX_START_WITH")+""+g_pog_json[a].ModuleInfo[e].Module,g_pog_json[a].ModuleInfo[e].OldPOGModule=g_pog_json[a].ModuleInfo[e].Module,g_pog_json[a].ModuleInfo[e].Module=Y,g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Namechange="Y",$.each(o.ShelfInfo,(function(_,o){g_pog_json[a].ModuleInfo[e].ShelfInfo[_].OldShelf=g_pog_json[a].ModuleInfo[e].Module,g_pog_json[a].ModuleInfo[e].ShelfInfo[_].Shelf=Y}))))}})),"N"==A){var F=g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Shelf.split("_")[0];$v("P25_FIXTURE_LABEL_TYPES").includes(F)||(Y=$v("P25_TEXTBOX_START_WITH")+""+g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Shelf,g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Namechange="Y")}}}else{R=g_pog_json[a].ModuleInfo[j].ShelfInfo,y=0;for(const e of R){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType){H=0;for(const o of e.ItemInfo)"DIVIDER"==o.Item&&_.ShelfDivObjID==o.ObjID&&(Y=$v("P25_DIVIDER_START_WITH")+""+g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID,g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].OldItemID=g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID,g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID=Y,g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Namechange="Y"),H++}y++}}""!==Y&&(g_pog_json[a].ModuleInfo[j].ShelfInfo[E].OldShelf=g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Shelf,g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Shelf=Y)}E+=1}}else if("TBLR"==_||"LRTB"==_&&2==n){O=g_pog_json[a].ModuleInfo[j].ShelfInfo;if("TBLR"==_){O.forEach((function(e){e.CalcX=wpdSetFixed(e.X-e.W/2)}));D={CalcX:"desc",Y:"asc"};O.keySort(D)}else{D={Y:"asc"};O.keySort(D)}v=0;if("Y"===$v("P25_POG_FIXEL_ID_PAD_SHELF_NO"))for(const e of O)"TEXTBOX"!==e.ObjType&&"DIVIDER"!==e.ObjType&&v++;var L=O.length;for(E=O.length-1;E>=0;E--){L-=1;N="N",P=O[E].X-O[E].W/2,C=O[E].X+O[E].W/2;if((O[E].X>x&&O[E].X<=M||P>=x&&P<M||C>x&&C<M)&&O[E].Y>b&&O[E].Y<T&&(N="Y"),"BASE"!==O[E].ObjType&&"NOTCH"!==O[E].ObjType&&"Y"==N)if("T:D"==o&&"DIVIDER"!==O[E].ObjType&&"TEXTBOX"!==O[E].ObjType||"T"==o&&"TEXTBOX"!==O[E].ObjType||"D"==o&&"DIVIDER"!==O[E].ObjType||""==o){if("1"==n?(I+=1,p=h>9&&I<10&&"Y"==$v("P25_POG_FIXEL_ID_PAD_SHELF_NO")?"0"+I:I):(e.Module==s&&""!=s||"2"!=t||(I=0),I+=1,s=e.Module,p="3"==g?r+l+(p=v>9&&I<10&&"Y"==$v("P25_POG_FIXEL_ID_PAD_SHELF_NO")?"0"+I:I):v>9&&I<10&&"Y"==$v("P25_POG_FIXEL_ID_PAD_SHELF_NO")?"0"+I:I),w=(w=i+" "+p+" "+d).trim(),"DIVIDER"==O[E].ObjType){R=g_pog_json[a].ModuleInfo[j].ShelfInfo,y=0;for(const e of R){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType){H=0;for(const _ of e.ItemInfo)"DIVIDER"==_.Item&&O[E].ShelfDivObjID==_.ObjID&&(g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].OldItemID=g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID,g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID=w,g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Namechange=""),H++}y++}}else if("TEXTBOX"==O[E].ObjType){c=g_pog_json[a].ModuleInfo,y=0;for(const e of c){if(void 0!==e.ParentModule&&null!==e.ParentModule&&O[E].SObjID==e.ObjID){g_pog_json[a].ModuleInfo[y].OldPOGModule=g_pog_json[a].ModuleInfo[y].Module,g_pog_json[a].ModuleInfo[y].Module=w;H=0;for(const _ of e.ShelfInfo)g_pog_json[a].ModuleInfo[y].ShelfInfo[H].OldShelf=g_pog_json[a].ModuleInfo[y].Module,g_pog_json[a].ModuleInfo[y].ShelfInfo[H].Shelf=w,g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Namechange="",H++}y++}}g_pog_json[a].ModuleInfo[j].ShelfInfo[L].OldShelf=g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Shelf,g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Shelf=w}else{Y="",A="N";if("DIVIDER"!=O[E].ObjType||void 0!==O[E].Namechange&&""!=O[E].Namechange){if("TEXTBOX"==O[E].ObjType&&(void 0===O[E].Namechange||""==O[E].Namechange)){c=g_pog_json[a].ModuleInfo,y=0;for(const e of c){if(void 0!==e.ParentModule&&null!==e.ParentModule){F=g_pog_json[a].ModuleInfo[y].Module.split("_")[0];if(O[E].SObjID==e.ObjID&&!$v("P25_FIXTURE_LABEL_TYPES").includes(F)){A="Y",Y=$v("P25_TEXTBOX_START_WITH")+""+g_pog_json[a].ModuleInfo[y].Module,g_pog_json[a].ModuleInfo[y].OldPOGModule=g_pog_json[a].ModuleInfo[y].Module,g_pog_json[a].ModuleInfo[y].Module=Y;H=0;for(const _ of e.ShelfInfo)g_pog_json[a].ModuleInfo[y].ShelfInfo[H].OldShelf=g_pog_json[a].ModuleInfo[y].Module,g_pog_json[a].ModuleInfo[y].ShelfInfo[H].Shelf=Y,g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Namechange="Y",H++}}y++}if("N"==A){F=g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Shelf.split("_")[0];$v("P25_FIXTURE_LABEL_TYPES").includes(F)||(Y=$v("P25_TEXTBOX_START_WITH")+""+g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Shelf,g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Namechange="Y")}}}else{R=g_pog_json[a].ModuleInfo[j].ShelfInfo;var y=0;for(const e of R){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType){var H=0;for(const _ of e.ItemInfo)"DIVIDER"==_.Item&&O[E].ShelfDivObjID==_.ObjID&&(Y=$v("P25_DIVIDER_START_WITH")+""+g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID,g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].OldItemID=g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID,g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID=Y,g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Namechange="Y"),H++}y++}}""!==Y&&(g_pog_json[a].ModuleInfo[j].ShelfInfo[L].OldShelf=g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Shelf,g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Shelf=Y)}}}else if(("LRBT"==_||"LRTB"==_)&&1==n){O=g_pog_json[a].ModuleInfo[j].ShelfInfo,E=0;for(const e of O){N="N",P=e.X-e.W/2,C=e.X+e.W/2;if((e.X>x&&e.X<=M||P>=x&&P<M||C>x&&C<M)&&e.Y>b&&e.Y<T&&(N="Y"),"BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"Y"==N)if("T:D"==o&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType||"T"==o&&"TEXTBOX"!==e.ObjType||"D"==o&&"DIVIDER"!==e.ObjType||""==o){var B={};B.Y=e.Y-e.H/2,B.SIndex=E,B.MIndex=j,B.ObjType=e.ObjType,B.Shelf=e.Shelf,B.ShelfDivObjID=e.ShelfDivObjID,B.SObjID=e.SObjID,e.Namechange="",u.push(B)}else{Y="",A="N";if("DIVIDER"!=e.ObjType||void 0!==e.Namechange&&""!=e.Namechange){if("TEXTBOX"==e.ObjType&&(void 0===e.Namechange||""==e.Namechange)){c=g_pog_json[a].ModuleInfo,y=0;for(const _ of c){if(void 0!==_.ParentModule&&null!==_.ParentModule){F=g_pog_json[a].ModuleInfo[y].Module.split("_")[0];if(e.SObjID==_.ObjID&&!$v("P25_FIXTURE_LABEL_TYPES").includes(F)){A="Y",Y=$v("P25_TEXTBOX_START_WITH")+""+g_pog_json[a].ModuleInfo[y].Module,g_pog_json[a].ModuleInfo[y].OldPOGModule=g_pog_json[a].ModuleInfo[y].Module,g_pog_json[a].ModuleInfo[y].Module=Y;H=0;for(const e of _.ShelfInfo)g_pog_json[a].ModuleInfo[y].ShelfInfo[H].OldShelf=g_pog_json[a].ModuleInfo[y].Module,g_pog_json[a].ModuleInfo[y].ShelfInfo[H].Shelf=Y,g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Namechange="Y",H++}}y++}if("N"==A){F=g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Shelf.split("_")[0];$v("P25_FIXTURE_LABEL_TYPES").includes(F)||(Y=$v("P25_TEXTBOX_START_WITH")+""+g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Shelf,g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Namechange="Y")}}}else{R=g_pog_json[a].ModuleInfo[j].ShelfInfo,y=0;for(const _ of R){if("BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType){H=0;for(const o of _.ItemInfo)"DIVIDER"==o.Item&&e.ShelfDivObjID==o.ObjID&&(Y=$v("P25_DIVIDER_START_WITH")+""+g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID,g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].OldItemID=g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID,g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID=Y,g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Namechange="Y"),H++}y++}}""!==Y&&(g_pog_json[a].ModuleInfo[j].ShelfInfo[E].OldShelf=g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Shelf,g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Shelf=Y)}E+=1}"LRBT"==_?u.sort(((e,_)=>e.Y>_.Y||e.Y==_.Y&&e.MIndex>_.MIndex?1:-1)):u.sort(((e,_)=>e.Y<_.Y||e.Y==_.Y&&e.MIndex>_.MIndex?1:-1))}}j+=1}}else if("RL"==e)for((c=g_pog_json[a].ModuleInfo).length,r=0,j=c.length-1;j>=0;j--)if(void 0===c[j].ParentModule||null==c[j].ParentModule){r+=1;x=c[j].X-c[j].W/2,M=c[j].X+c[j].W/2,T=c[j].Y+c[j].H/2,b=c[j].Y-c[j].H/2;if(c[j].ShelfInfo.length>0)if("BTLR"==_||"LRBT"==_&&2==n){O=c[j].ShelfInfo;if("BTLR"==_){O.forEach((function(e){e.CalcX=e.X-e.W/2}));D={CalcX:"asc",Y:"asc"};O.keySort(D)}else{D={Y:"asc"};O.keySort(D)}E=0,v=0;if("Y"===$v("P25_POG_FIXEL_ID_PAD_SHELF_NO"))for(const e of O)"TEXTBOX"!==e.ObjType&&"DIVIDER"!==e.ObjType&&v++;for(const e of O){N="N",P=O[E].X-O[E].W/2,C=O[E].X+O[E].W/2;if((O[E].X>x&&O[E].X<=M||P>=x&&P<M||C>x&&C<M)&&O[E].Y>b&&O[E].Y<T&&(N="Y"),"BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"Y"==N)if("T:D"==o&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType||"T"==o&&"TEXTBOX"!==e.ObjType||"D"==o&&"DIVIDER"!==e.ObjType||""==o){if("1"==n?(I+=1,p=h>9&&I<10&&"Y"==$v("P25_POG_FIXEL_ID_PAD_SHELF_NO")?"0"+I:I):(c[j].Module==s&&""!=s||"2"!=t||(I=0),I+=1,s=c[j].Module,p="3"==g?r+l+(p=v>9&&I<10&&"Y"==$v("P25_POG_FIXEL_ID_PAD_SHELF_NO")?"0"+I:I):v>9&&I<10&&"Y"==$v("P25_POG_FIXEL_ID_PAD_SHELF_NO")?"0"+I:I),w=(w=i+" "+p+" "+d).trim(),"DIVIDER"==e.ObjType){R=g_pog_json[a].ModuleInfo[j].ShelfInfo,y=0;for(const _ of R){if("BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType){H=0;for(const o of _.ItemInfo)"DIVIDER"==o.Item&&e.ShelfDivObjID==o.ObjID&&(g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].OldItemID=g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID,g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID=w,g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Namechange=""),H++}y++}}else if("TEXTBOX"==e.ObjType){c=g_pog_json[a].ModuleInfo,y=0;for(const e of c){if(void 0!==e.ParentModule&&null!==e.ParentModule&&O[E].SObjID==e.ObjID){g_pog_json[a].ModuleInfo[y].OldPOGModule=g_pog_json[a].ModuleInfo[y].Module,g_pog_json[a].ModuleInfo[y].Module=w;H=0;for(const _ of e.ShelfInfo)g_pog_json[a].ModuleInfo[y].ShelfInfo[H].OldShelf=g_pog_json[a].ModuleInfo[y].Module,g_pog_json[a].ModuleInfo[y].ShelfInfo[H].Shelf=w,g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Namechange="",H++}y++}}g_pog_json[a].ModuleInfo[j].ShelfInfo[E].OldShelf=g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Shelf,g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Shelf=w}else{Y="",A="N";if("DIVIDER"!=e.ObjType||void 0!==e.Namechange&&""!=e.Namechange){if("TEXTBOX"==e.ObjType&&(void 0===e.Namechange||""==e.Namechange)){c=g_pog_json[a].ModuleInfo,y=0;for(const e of c){if(void 0!==e.ParentModule&&null!==e.ParentModule){F=g_pog_json[a].ModuleInfo[y].Module.split("_")[0];if(O[E].SObjID==e.ObjID&&(A="Y",!$v("P25_FIXTURE_LABEL_TYPES").includes(F))){Y=$v("P25_TEXTBOX_START_WITH")+""+g_pog_json[a].ModuleInfo[y].Module,g_pog_json[a].ModuleInfo[y].OldPOGModule=g_pog_json[a].ModuleInfo[y].Module,g_pog_json[a].ModuleInfo[y].Module=Y;H=0;for(const _ of e.ShelfInfo)g_pog_json[a].ModuleInfo[y].ShelfInfo[H].OldShelf=g_pog_json[a].ModuleInfo[y].Module,g_pog_json[a].ModuleInfo[y].ShelfInfo[H].Shelf=Y,g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Namechange="Y",H++}}y++}if("N"==A){F=g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Shelf.split("_")[0];$v("P25_FIXTURE_LABEL_TYPES").includes(F)||(Y=$v("P25_TEXTBOX_START_WITH")+""+g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Shelf,g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Namechange="Y")}}}else{R=g_pog_json[a].ModuleInfo[j].ShelfInfo,y=0;for(const _ of R){if("BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType){H=0;for(const o of _.ItemInfo)"DIVIDER"==o.Item&&e.ShelfDivObjID==o.ObjID&&(Y=$v("P25_DIVIDER_START_WITH")+""+g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID,g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].OldItemID=g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID,g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID=w,g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Namechange="Y"),H++}y++}}""!==Y&&(g_pog_json[a].ModuleInfo[j].ShelfInfo[E].OldShelf=g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Shelf,g_pog_json[a].ModuleInfo[j].ShelfInfo[E].Shelf=Y)}E+=1}}else if("TBLR"==_||"LRTB"==_&&2==n){O=g_pog_json[a].ModuleInfo[j].ShelfInfo;if("TBLR"==_){O.forEach((function(e){e.CalcX=wpdSetFixed(e.X-e.W/2)}));D={CalcX:"desc",Y:"asc"};O.keySort(D)}else{D={Y:"asc"};O.keySort(D)}v=0;if("Y"===$v("P25_POG_FIXEL_ID_PAD_SHELF_NO"))for(const e of O)"TEXTBOX"!==e.ObjType&&"DIVIDER"!==e.ObjType&&v++;for(L=O.length,E=O.length-1;E>=0;E--){L-=1;N="N",P=O[E].X-O[E].W/2,C=O[E].X+O[E].W/2;if((O[E].X>x&&O[E].X<=M||P>=x&&P<M||C>x&&C<M)&&O[E].Y>b&&O[E].Y<T&&(N="Y"),"BASE"!==O[E].ObjType&&"NOTCH"!==O[E].ObjType&&"Y"==N)if("T:D"==o&&"DIVIDER"!==O[E].ObjType&&"TEXTBOX"!==O[E].ObjType||"T"==o&&"TEXTBOX"!==O[E].ObjType||"D"==o&&"DIVIDER"!==O[E].ObjType||""==o){if("1"==n?(I+=1,p=h>9&&I<10&&"Y"==$v("P25_POG_FIXEL_ID_PAD_SHELF_NO")?"0"+I:I):(c[j].Module==s&&""!=s||"2"!=t||(I=0),I+=1,s=c[j].Module,p="3"==g?r+l+(p=v>9&&I<10&&"Y"==$v("P25_POG_FIXEL_ID_PAD_SHELF_NO")?"0"+I:I):v>9&&I<10&&"Y"==$v("P25_POG_FIXEL_ID_PAD_SHELF_NO")?"0"+I:I),w=(w=i+" "+p+" "+d).trim(),"DIVIDER"==O[E].ObjType){R=g_pog_json[a].ModuleInfo[j].ShelfInfo,y=0;for(const e of R){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType){H=0;for(const _ of e.ItemInfo)"DIVIDER"==_.Item&&O[E].ShelfDivObjID==_.ObjID&&(g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].OldItemID=g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID,g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID=w,g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Namechange=""),H++}y++}}else if("TEXTBOX"==O[E].ObjType){c=g_pog_json[a].ModuleInfo,y=0;for(const e of c){if(void 0!==e.ParentModule&&null!==e.ParentModule&&O[E].SObjID==e.ObjID){g_pog_json[a].ModuleInfo[y].OldPOGModule=g_pog_json[a].ModuleInfo[y].Module,g_pog_json[a].ModuleInfo[y].Module=w;H=0;for(const _ of e.ShelfInfo)g_pog_json[a].ModuleInfo[y].ShelfInfo[H].OldShelf=g_pog_json[a].ModuleInfo[y].Module,g_pog_json[a].ModuleInfo[y].ShelfInfo[H].Shelf=w,g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Namechange="",H++}y++}}g_pog_json[a].ModuleInfo[j].ShelfInfo[L].OldShelf=g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Shelf,g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Shelf=w}else{Y="",A="";if("DIVIDER"!=O[E].ObjType||void 0!==O[E].Namechange&&""!=O[E].Namechange){if("TEXTBOX"==O[E].ObjType&&(void 0===O[E].Namechange||""==O[E].Namechange)){c=g_pog_json[a].ModuleInfo,y=0;for(const e of c){if(void 0!==e.ParentModule&&null!==e.ParentModule){F=g_pog_json[a].ModuleInfo[y].Module.split("_")[0];if(O[E].SObjID==e.ObjID&&!$v("P25_FIXTURE_LABEL_TYPES").includes(F)){A="Y",Y=$v("P25_TEXTBOX_START_WITH")+""+g_pog_json[a].ModuleInfo[y].Module,g_pog_json[a].ModuleInfo[y].OldPOGModule=g_pog_json[a].ModuleInfo[y].Module,g_pog_json[a].ModuleInfo[y].Module=Y;H=0;for(const _ of e.ShelfInfo)g_pog_json[a].ModuleInfo[y].ShelfInfo[H].OldShelf=g_pog_json[a].ModuleInfo[y].Module,g_pog_json[a].ModuleInfo[y].ShelfInfo[H].Shelf=Y,g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Namechange="Y",H++}}y++}if("N"==A){F=g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Shelf.split("_")[0];$v("P25_FIXTURE_LABEL_TYPES").includes(F)||(Y=$v("P25_TEXTBOX_START_WITH")+""+g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Shelf,g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Namechange="Y")}}}else{R=g_pog_json[a].ModuleInfo[j].ShelfInfo,y=0;for(const e of R){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType){H=0;for(const _ of e.ItemInfo)"DIVIDER"==_.Item&&O[E].ShelfDivObjID==_.ObjID&&(Y=$v("P25_DIVIDER_START_WITH")+""+g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID,g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].OldItemID=g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID,g_pog_json[a].ModuleInfo[j].ShelfInfo[y].ItemInfo[H].ItemID=Y,g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Namechange="Y"),H++}y++}}""!==Y&&(g_pog_json[a].ModuleInfo[j].ShelfInfo[L].OldShelf=g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Shelf,g_pog_json[a].ModuleInfo[j].ShelfInfo[L].Shelf=Y)}}}}if(("LRBT"==_||"LRTB"==_)&&1==n){E=0;I=0;for(const e of u){var w;if(I+=1,p=h>9&&I<10&&"Y"==$v("P25_POG_FIXEL_ID_PAD_SHELF_NO")?"0"+I:I,w=(w=i+" "+p+" "+d).trim(),"DIVIDER"==e.ObjType){R=g_pog_json[a].ModuleInfo[e.MIndex].ShelfInfo,y=0;for(const _ of R){if("BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType){H=0;for(const o of _.ItemInfo)"DIVIDER"==o.Item&&e.ShelfDivObjID==o.ObjID&&(g_pog_json[a].ModuleInfo[e.MIndex].ShelfInfo[y].ItemInfo[H].OldItemID=g_pog_json[a].ModuleInfo[e.MIndex].ShelfInfo[y].ItemInfo[H].ItemID,g_pog_json[a].ModuleInfo[e.MIndex].ShelfInfo[y].ItemInfo[H].ItemID=w),H++}y++}}else if("TEXTBOX"==e.ObjType){c=g_pog_json[a].ModuleInfo,y=0;for(const _ of c){if(void 0!==_.ParentModule&&null!==_.ParentModule&&e.SObjID==_.ObjID){g_pog_json[a].ModuleInfo[y].OldPOGModule=e.Shelf,g_pog_json[a].ModuleInfo[y].Module=w;H=0;for(const o of _.ShelfInfo)g_pog_json[a].ModuleInfo[y].ShelfInfo[H].OldShelf=e.Shelf,g_pog_json[a].ModuleInfo[y].ShelfInfo[H].Shelf=w,H++}y++}}g_pog_json[a].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].OldShelf=e.Shelf,g_pog_json[a].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].Shelf=w,E+=1}}j=0;for(const e of c)if(void 0===e.ParentModule||null==e.ParentModule){E=0;for(const _ of e.ShelfInfo){if("BASE"!==_.ObjType&&"NOTCH"!==_.ObjType)if(void 0!==(X=g_scene_objects[a].scene.children[2].getObjectById(_.SObjID))&&(X.FixelID=_.Shelf),"TEXTBOX"!==_.ObjType)for(const e of _.ItemInfo){var X;void 0!==(X=g_scene_objects[a].scene.children[2].getObjectById(e.ObjID))&&(X.Shelf=_.Shelf,"DIVIDER"==e.Item&&(X.FixelID=_.Shelf),X.LocID)}}}"Y"==g_show_fixel_label&&show_fixel_labels(g_show_fixel_label,a,a),g_dblclick_opened="N",closeInlineDialog("renumbering"),g_l_module_dir="",g_l_direction="",g_l_ignore="",g_l_order_type="",g_l_start_one_mod="",g_l_include_mod_name="",g_l_separator="",g_l_leading_text="",g_l_trailing_text="",g_l_start_one_mod_loc="",g_l_start_one_fixel="",logDebug("function : fixture_numbering","E")}catch(e){error_handling(e)}}function get_shelf_pallet_items(e,_,o){logDebug("function : get_shelf_pallet_items; p_module: "+e+"; p_shelf_index: "+_+"; p_module_index: "+o,"S");try{let t=[],g=!1,l=e.ShelfInfo[_];if(!l)return t;l.ItemInfo.forEach(((e,n)=>{t.push({CType:l.ObjType,MIndex:o,SIndex:_,IIndex:n,X:e.X,Y:e.Y,Z:e.Z,D:e.D,W:e.W,H:e.H,ItemID:e.ItemID,Item:e.Item,LocID:e.LocID})}));var n=$v("P25_POGCR_SUBSHELF_THRESHOLD")/100;return e.ShelfInfo.forEach(((_,i)=>{if("PALLET"!==_.ObjType&&"SHELF"!==_.ObjType)return;if(wpdSetFixed(_.W)>=wpdSetFixed(e.W))return;if(!(Math.abs(_.X-l.X)<=_.W/2+l.W/2))return;let d=_.Y-_.H/2,a=l.Y+l.H/2;Math.abs(d-a)<=Number(n)&&d>=a&&function(_){let o=_;for(;;){let _=[];if(e.ShelfInfo.forEach(((e,n)=>{e.Y<o.Y&&_.push({idx:n,ObjType:e.ObjType,Y:e.Y,W:e.W})})),0===_.length)return!1;_.sort(((e,_)=>_.Y-e.Y));let n=_[0],t=e.ShelfInfo[n.idx];if("SHELF"===t.ObjType&&wpdSetFixed(t.W)===wpdSetFixed(e.W))return!0;if(!("PALLET"===t.ObjType||"SHELF"===t.ObjType&&wpdSetFixed(t.W)<wpdSetFixed(e.W)))return!1;o=t}}(_)&&(g=!0,_.ItemInfo.forEach(((e,n)=>{t.push({CType:_.ObjType,MIndex:o,SIndex:i,IIndex:n,X:e.X,Y:e.Y,Z:e.Z,D:e.D,W:e.W,H:e.H,ItemID:e.ItemID,Item:e.Item,LocID:e.LocID})})))})),g?(t.sort(((e,_)=>e.X-_.X)),logDebug("function : get_shelf_pallet_items","E"),t):[]}catch(e){error_handling(e)}}function sortPalletItems(e=""){logDebug("function : sortPalletItems; p_pallet_dir: "+e,"S");try{let _;return _="FELR"==e?{Start:"asc",Front:"asc"}:"EFLR"==e?{Start:"asc",Back:"desc"}:"FERL"==e?{End:"desc",Front:"asc"}:{End:"desc",Back:"desc"},logDebug("function : sortPalletItems","E"),_}catch(e){error_handling(e)}}async function location_numbering(e,_,o,n,t,g,l){logDebug("function : location_numbering; module_dir : "+e+"; order_dir : "+_+"; order_type : "+o+"; start_one_fixel : "+n+"; start_one_mod : "+t,"S");var i,d=0,a=[],s={};g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[],89==g_keyCode||90==g_keyCode||(g_redo_all_obj_arr=[],g_redo_final_obj_arr=[],undoType="U",g_undoRedoAction="REDO"),i="REDO"==g_undoRedoAction?"U":"R",g_prev_undo_action="LOCATION_NUMBERING",""!==g_l_module_dir&&(s.MODULE_DIR=g_l_module_dir,s.DIRECTION=g_l_direction,s.ORDER_TYPE=g_l_order_type,s.START_ONE_FIXEL=g_l_start_one_fixel,s.START_ONE_MOD_LOC=g_l_start_one_mod_loc,g_cut_copy_arr.push(s),s={});var f=g_pog_json[g].ModuleInfo;try{if(1==n){var I=0;for(const e of f){if(void 0===e.ParentModule||null==e.ParentModule){var r=e.ShelfInfo,p=0;for(const o of r){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType){d=0;var c=!1;if("SHELF"==o.ObjType&&o.W>=e.W){var u=get_shelf_pallet_items(e,p,I);c=u?.length>0}if("PALLET"==o.ObjType||"SHELF"==o.ObjType&&o.W<e.W){var m=!1;if(e.ShelfInfo.forEach(((_,o)=>{"SHELF"===_.ObjType&&(get_shelf_pallet_items(e,o,I).some((e=>e.SIndex===p&&("PALLET"===e.CType||"SHELF"===e.CType)))&&(m=!0))})),m){p++;continue}}if(o.ItemInfo.length>0){if(c)var h=u;else h=o.ItemInfo;for(it of(z=0,h)){(v={}).ItemID=it.ItemID,v.Item=it.Item,v.IIndex=c?it.IIndex:z,v.MIndex=I,v.SIndex=c?it.SIndex:p,v.X=h[z].X,v.D=h[z].D,v.Start=wpdSetFixed(h[z].X-h[z].W/2),v.Front=wpdSetFixed(h[z].Z-h[z].D/2),v.End=wpdSetFixed(h[z].X+h[z].W/2),v.Back=wpdSetFixed(h[z].Z+h[z].D/2),v.Top=wpdSetFixed(h[z].Y+h[z].H/2),v.CType=c?it.CType:o.ObjType,"HANGINGBAR"==o.ObjType||"PEGBOARD"==o.ObjType?v.Y=wpdSetFixed(h[z].Y+h[z].H/2):v.Y=wpdSetFixed(h[z].Y-h[z].H/2),z++,a.push(v)}var S=0;if("PALLET"==o.ObjType)var O=sortPalletItems(l);else if("PEGBOARD"==o.ObjType)if("LRTB"==_)O={Y:"desc",X:"asc"};else if("LRBT"==_)O={Y:"asc",X:"asc"};else if("TBLR"==_)O={SIndex:"desc",X:"asc",Y:"desc"};else O={SIndex:"asc",X:"asc",Y:"asc"};else if("CHEST"==o.ObjType)if("LRTB"==_)O={Top:"desc",Start:"asc"};else if("LRBT"==_)O={Top:"asc",Start:"asc"};else if("TBLR"==_)O={SIndex:"desc",Start:"asc",Top:"desc"};else O={SIndex:"asc",Start:"asc",Top:"asc"};else if(c)if("LRTB"==_||"TBLR"==_)O={X:"asc",Y:"desc"};else O={X:"asc",Y:"asc"};else if("LRTB"==_||"TBLR"==_)O={SIndex:"desc",X:"asc",Y:"desc"};else O={SIndex:"asc",X:"asc",Y:"asc"};if(a.keySort(O),c){var j=a.filter((e=>"PALLET"===e.CType));let e=sortPalletItems(l);j.keySort(e);var x=[];for(let e of a)"PALLET"===e.CType?x.push(j.shift()):x.push(e);a=x}S=0;for(const e of a){var M=c?e.SIndex:p;"DIVIDER"!==e.Item&&(d+=1,g_pog_json[g].ModuleInfo[I].ShelfInfo[M].ItemInfo[e.IIndex].OldLocationID=g_pog_json[g].ModuleInfo[I].ShelfInfo[M].ItemInfo[e.IIndex].LocID,g_pog_json[g].ModuleInfo[I].ShelfInfo[M].ItemInfo[e.IIndex].LocID=d),S+=1}a=[]}}p+=1}}I+=1}}else{I=0;for(const e of f){if(void 0===e.ParentModule||null==e.ParentModule){r=e.ShelfInfo,p=0;for(const o of r){if("BASE"!==o.ObjType&&"NOTCH"!==o.ObjType&&"DIVIDER"!==o.ObjType&&"TEXTBOX"!==o.ObjType){m=!1;if(("PALLET"==o.ObjType||"SHELF"==o.ObjType&&o.W<e.W)&&e.ShelfInfo.forEach(((_,o)=>{"SHELF"===_.ObjType&&(get_shelf_pallet_items(e,o,I).some((e=>e.SIndex===p&&("PALLET"===e.CType||"SHELF"===e.CType)))&&(m=!0))})),o.ItemInfo.length>0){var T=wpdSetFixed(o.Y+o.H/2);(h=o.ItemInfo).sort(((e,_)=>e.X>_.X||e.X==_.X&&e.Y>_.Y?1:-1));S=0;var b=0,D=0,E=0;for(const e of h){if("DIVIDER"!==e.Item){var v;if((v={}).ItemID=e.ItemID,void 0!==e.TopObjID&&""!==e.TopObjID||void 0!==e.BottomObjID&&""!==e.BottomObjID?(""!==e.TopObjID&&""==e.BottomObjID&&(E=wpdSetFixed(e.X-e.W/2),D=e.X),D==e.X?b+=1:(E=0,b=0),""==e.TopObjID&&""!==e.BottomObjID&&(D=0)):(b=0,D=0,E=0),void 0!==e.BottomObjID&&""!==e.BottomObjID?v.X="LRTB"==_?E-.001*b:"TBLR"!==_&&"BTLR"!==_?E+.001*b:e.X:void 0===e.TopObjID||""===e.TopObjID||"TBLR"!=_&&"BTLR"!=_?v.X=wpdSetFixed(e.X-e.W/2):v.X=e.X,"HANGINGBAR"==o.ObjType||"PEGBOARD"==o.ObjType||"CHEST"==o.ObjType)v.Y=wpdSetFixed(e.Y+e.H/2);else if(m){var N=wpdSetFixed(r[p-1]?.Y+r[p-1]?.H/2);v.Y=N}else void 0!==e.BottomObjID&&""!==e.BottomObjID?v.Y="TBLR"!==_?T:wpdSetFixed(e.Y-e.H/2):v.Y=wpdSetFixed(e.Y-e.H/2);v.ObjID=e.ObjID,v.CType=e.CType,v.H=e.H,v.W=e.W,v.LObjID=e.LObjID,v.SubLblObjID=e.SubLblObjID,"PALLET"==o.ObjType?v.D=e.D:v.D=0,v.MIndex=I,v.SIndex=p,v.Shelf=o.Shelf,v.IIndex=S,v.ObjID=e.ObjID,a.push(v)}S+=1}}}p+=1}}I+=1}if("LR"==e)var P="asc";else P="desc";if(1==o){if("LRBT"==_){O={Y:"asc",X:"asc",MIndex:P};a.keySort(O)}else if("LRTB"==_){O={Y:"desc",X:"asc",MIndex:P};a.keySort(O)}}else if("LRBT"==_){O={MIndex:P,Y:"asc",X:"asc"};a.keySort(O)}else if("LRTB"==_){O={MIndex:P,Y:"desc",X:"asc"};a.keySort(O)}if("BTLR"==_){O={MIndex:P,X:"asc",Y:"asc"};a.keySort(O)}else if("TBLR"==_){O={MIndex:P,X:"asc",Y:"desc"};a.keySort(O)}j=a.filter((e=>"PALLET"===e.CType));var C=sortPalletItems(l);j.keySort(C);x=[];for(let e of a)"PALLET"===e.CType?x.push(j.shift()):x.push(e);a=x;S=0;var R=-1;for(const e of a)d+=1,R!==e.MIndex&&2==t&&(d=1),g_pog_json[g].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].OldLocationID=g_pog_json[g].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].LocID,g_pog_json[g].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo[e.IIndex].LocID=d,R=e.MIndex,S+=1;g_undo_details=[],""!==g_l_module_dir&&("U"==i?(g_delete_details.multi_delete_shelf_ind="N",g_undo_all_obj_arr=[],g_undo_all_obj_arr.push(g_cut_copy_arr),g_undo_all_obj_arr.push(g_cut_copy_arr),g_undo_all_obj_arr.previousAction="LOCATION_NUMBERING",g_undo_all_obj_arr.hasSupportArr="N",g_undo_all_obj_arr.g_MultiObjects="N",g_undo_all_obj_arr.multi_delete_shelf_ind="N",g_undo_final_obj_arr.push(g_undo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]):(g_delete_details.multi_delete_shelf_ind="N",g_redo_all_obj_arr=[],g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.push(g_cut_copy_arr),g_redo_all_obj_arr.previousAction="LOCATION_NUMBERING",g_redo_all_obj_arr.hasSupportArr="N",g_redo_all_obj_arr.g_MultiObjects="N",g_redo_all_obj_arr.multi_delete_shelf_ind="N",g_redo_final_obj_arr.push(g_redo_all_obj_arr),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_cut_copy_arr=[],g_undo_details=[]))}I=0;for(const e of f)if(void 0===e.ParentModule||null==e.ParentModule){p=0;for(const _ of e.ShelfInfo)if("BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"TEXTBOX"!==_.ObjType&&"DIVIDER"!==_.ObjType)for(const e of _.ItemInfo){var y=g_scene_objects[g].scene.children[2].getObjectById(e.ObjID);void 0!==y&&(y.LocID=e.LocID)}}"Y"==g_show_item_label&&show_item_labels(g_show_item_label,$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),g),"Y"==g_itemSubLabelInd&&showItemSubLabel(g_itemSubLabel,g_itemSubLabelInd,$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),g),g_dblclick_opened="N",closeInlineDialog("renumbering"),g_l_module_dir="",g_l_direction="",g_l_ignore="",g_l_order_type="",g_l_start_one_mod="",g_l_include_mod_name="",g_l_separator="",g_l_leading_text="",g_l_trailing_text="",g_l_start_one_mod_loc="",g_l_start_one_fixel="",logDebug("function : location_numbering","E")}catch(e){error_handling(e)}}async function context_delete(e,_,o,n,t,g,l,i,d,a,s,f,I){logDebug("function : context_delete; action : "+e+"; moduleIndex : "+_+"; shelfIndex : "+o+"; itemIndex : "+n+"; i_item_edit_flag : "+t+"; i_module_edit_flag : "+g+"; i_shelf_edit_flag : "+l+"; objectHitID : "+i+"; shelfObjType : "+d,"S");try{var r="N",p=g;if("DELETE"==e){if("Y"!==a.multi_carpark_ind&&await get_delist_item(f,g_multiselect,o,_,n,l,g,t,a),void 0!==a&&a.length>0&&(p="N"),await deleteObject(f,a,I,p,_,"U"),"Y"==g&&"N"==g_manual_zoom_ind){var c=get_min_max_xy(f).split("###");set_camera_z(s,parseFloat(c[2]),parseFloat(c[3]),parseFloat(c[0]),parseFloat(c[1]),g_offset_z,parseFloat(c[4]),parseFloat(c[5]),!0,f),render(f)}}else{var u="N",m=g_pog_json[f].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index];"N"==g_carpark_item_flag&&-1!==n&&(u=m.ItemInfo[n].Item),"Y"==g?delete_module(i,_,s,f):"Y"==l||"Y"==t&&"DIVIDER"==u?("Y"==t&&"DIVIDER"==u&&(r="Y"),d=m.ObjType,delete_shelf(i,_,o,n,d,r,"N",f)):"Y"==t&&"DIVIDER"!==u&&delete_item(i,_,o,n,e,"Y",f)}"Y"==g_show_live_image&&animate_pog(f);await recreate_compare_views(g_compare_view,"N");logDebug("function : context_delete","E")}catch(e){error_handling(e)}}function getAutoFillCurrModule(e,_,o,n){logDebug("function : getAutoFillCurrModule; pfinalX : "+e+"; pFinalY : "+_+"; p_module_index : "+o,"S");try{var t=-1,g=0;g=0;for(modules of g_pog_json[n].ModuleInfo){if(parseFloat(e)>parseFloat(modules.X)-modules.W/2&&parseFloat(e)<parseFloat(modules.X)+modules.W/2&&parseFloat(_)>parseFloat(modules.Y)-modules.H/2&&parseFloat(_)<parseFloat(modules.Y)+modules.H/2&&(null==modules.ParentModule||void 0===modules.ParentModule)){t=g;break}g++}return logDebug("function : getAutoFillCurrModule","E"),t}catch(e){error_handling(e)}}function getAutoFillCurrShelf(e,_,o,n){logDebug("function : getAutoFillCurrShelf; pBlockStart : "+e+"; pBlockEnd : "+_+"; p_module_index : "+o,"S");try{var t=-1,g=0;for(shelfs of g_pog_json[n].ModuleInfo[o].ShelfInfo){if(parseFloat(e.y)>parseFloat(shelfs.Y)-shelfs.H/2&&parseFloat(_.y)<parseFloat(shelfs.Y)+shelfs.H/2){t=g;break}g++}return logDebug("function : getAutoFillCurrShelf","E"),t}catch(e){error_handling(e)}}async function swapColoredBlocks(e,_,o){logDebug("function : swapColoredBlocks; pSwapBlock : "+e,"S");var n=_.BlockDim.ColorObj,t=parseFloat(_.BlockDim.CalcX),g=parseFloat(_.BlockDim.CalcY),l=parseFloat(_.BlockDim.FinalTop),i=parseFloat(_.BlockDim.FinalBtm),d=parseFloat(_.BlockDim.BlkWidth),a=parseFloat(_.BlockDim.BlkHeight),s=JSON.parse(JSON.stringify(_.g_delete_details)),f=JSON.parse(JSON.stringify(_.mod_index)),I=n.getObjectByProperty("uuid",g_dragItem.uuid),r=e.BlockDim.ColorObj,p=parseFloat(e.BlockDim.CalcX),c=parseFloat(e.BlockDim.CalcY),u=parseFloat(e.BlockDim.FinalTop),m=parseFloat(e.BlockDim.FinalBtm),h=parseFloat(e.BlockDim.BlkWidth),S=parseFloat(e.BlockDim.BlkHeight),O=JSON.parse(JSON.stringify(e.g_delete_details)),j=JSON.parse(JSON.stringify(e.mod_index)),x=r.getObjectByProperty("uuid",e.BlkName);for(g_shelf of(e.BlockDim.CalcX=t,e.BlockDim.CalcY=g,e.BlockDim.FinalTop=l,e.BlockDim.FinalBtm=i,e.BlockDim.BlkWidth=d,e.BlockDim.BlkHeight=a,e.mod_index=f,e.g_delete_details=s,e.g_delete_details))g_shelf.BlkName=e.BlkName;for(g_shelf of(x.position.x=t,x.position.y=g,x.geometry.dispose(),x.geometry=new THREE.BoxGeometry(d,a,.001),_.BlockDim.CalcX=p,_.BlockDim.CalcY=c,_.BlockDim.FinalTop=u,_.BlockDim.FinalBtm=m,_.BlockDim.BlkWidth=h,_.BlockDim.BlkHeight=S,_.mod_index=j,_.g_delete_details=O,_.g_delete_details))g_shelf.BlkName=_.BlkName;I.position.x=p,I.position.y=c,I.geometry.dispose(),I.geometry=new THREE.BoxGeometry(h,S,.001),r.remove(x),n.remove(I),r.add(I),n.add(x),_.BlockDim.ColorObj=r,e.BlockDim.ColorObj=n,n.updateMatrix(),r.updateMatrix(),I.updateMatrix(),x.updateMatrix(),swapBlockIndex(_,e),render(o),logDebug("function : swapColoredBlocks","E")}function swapBlockIndex(e,_){if(!Array.isArray(g_mod_block_list))return;const o=g_mod_block_list,n=o.findIndex((_=>_.BlkName===e.BlkName)),t=o.findIndex((e=>e.BlkName===_.BlkName));-1!==n&&-1!==t&&([o[n],o[t]]=[o[t],o[n]])}function clickInsideElementMulti(e){var _=e.srcElement||e.target,o=null!==e.target.getAttribute("data-canvas")&&e.target.getAttribute("data-canvas");if(o)return _;for(;_=_.parentNode;)if(o=null!==e.target.getAttribute("data-canvas")&&e.target.getAttribute("data-canvas"))return _;return!1}async function deleteWorldObject(e,_){logDebug("function : deleteWorldObject; pDeleteShelf : "+e,"S"),g_cut_copy_arr=[],delete_details_temp=_,g_undo_details=[];var o=void 0!==_.multi_carpark_ind&&""!==_.multi_carpark_ind?_.multi_carpark_ind:"N";try{for(const u of _){if("SHELF"==u.Object&&"Y"==e){if("N"==u.IsDivider&&g_pog_json[u.p_pog_index].ModuleInfo[u.MIndex].ShelfInfo[u.SIndex].ItemInfo.length>0){var n=g_pog_json[u.p_pog_index].ModuleInfo[u.MIndex].ShelfInfo[u.SIndex].ItemInfo,t=0;for(const e of n){g_deletedItems.push(e.ItemID);var g=g_scene_objects[u.p_pog_index].scene.children[2].getObjectById(e.ObjID);g_scene_objects[u.p_pog_index].scene.children[2].remove(g),t++}g_pog_json[u.p_pog_index].ModuleInfo[u.MIndex].EditFlag="Y"}g=g_scene_objects[u.p_pog_index].scene.children[2].getObjectById(u.ObjID);if(g_scene_objects[u.p_pog_index].scene.children[2].remove(g),"Y"==u.IsDivider){shelf_arr=g_pog_json[u.p_pog_index].ModuleInfo[u.MIndex].ShelfInfo;var l=-1,i=g_pog_json[u.p_pog_index].ModuleInfo[u.MIndex].ShelfInfo[u.SIndex].ItemInfo[u.IIndex].ItemID;t=0;for(const e of shelf_arr)e.Shelf==i&&(l=t),t++;-1!==l&&g_cut_support_obj_arr.push(g_pog_json[u.p_pog_index].ModuleInfo[u.MIndex].ShelfInfo[l]),g_cut_copy_arr.push(JSON.parse(JSON.stringify(g_pog_json[u.p_pog_index].ModuleInfo[u.MIndex].ShelfInfo[u.SIndex].ItemInfo[u.IIndex])))}else{if("TEXTBOX"==u.ObjType){var d=g_pog_json[u.p_pog_index].ModuleInfo[u.MIndex].ShelfInfo[u.SIndex].SObjID,a=-1,s=g_pog_json[u.p_pog_index].ModuleInfo;$.each(s,(function(e,_){_.ObjID!=d||(a=e)})),-1!==a&&g_cut_support_obj_arr.push(g_pog_json[u.p_pog_index].ModuleInfo[a])}g_cut_copy_arr.push(JSON.parse(JSON.stringify(g_pog_json[u.p_pog_index].ModuleInfo[u.MIndex].ShelfInfo[u.SIndex])))}}else if("N"==e&&("ITEM"==u.Object||"CARPARK_ITEM"==u.Object&&"Y"==o)){t=0;var f=-1,I="N"==o?g_pog_json[u.p_pog_index].ModuleInfo[u.MIndex].ShelfInfo[u.SIndex].ItemInfo:g_pog_json[u.p_pog_index].ModuleInfo[u.MIndex].Carpark[0].ItemInfo;for(let e of I){if(e.ObjID==u.ObjID){f=t;break}t++}var r="N"==o?g_pog_json[u.p_pog_index].ModuleInfo[u.MIndex].ShelfInfo[u.SIndex].ItemInfo[f]:g_pog_json[u.p_pog_index].ModuleInfo[u.MIndex].Carpark[0].ItemInfo[f];d=r.ObjID,g=g_scene_objects[u.p_pog_index].scene.children[2].getObjectById(d);if(g_scene_objects[u.p_pog_index].scene.children[2].remove(g),u.ObjID=d.ObjID,void 0!==r.TopObjID&&""!==r.TopObjID||void 0!==r.BottomObjID&&""!==r.BottomObjID)reset_bottom_item(u.MIndex,u.SIndex,f,u.MIndex,u.SIndex,-1,u.p_pog_index);if(g_cut_copy_arr.push(JSON.parse(JSON.stringify(r))),g_deletedItems.push(r.ItemID),"N"==o){if(g_pog_json[u.p_pog_index].ModuleInfo[u.MIndex].ShelfInfo[u.SIndex].ItemInfo.splice(f,1),multi_pog_index!==u.p_pog_index||multi_pog_index==u.p_pog_index&&u.SIndex!==g_multi_shelf_index||-1==g_multi_shelf_index){g_multi_shelf_ind="Y";var p={};p.p_pog_index=u.p_pog_index,p.MIndex=u.MIndex,p.SIndex=u.SIndex,p.ObjType=u.ObjType,g_multi_shelf_arr.push(p)}multi_pog_index=u.p_pog_index,g_multi_shelf_index=u.SIndex,g_multi_mod_index=u.MIndex,g_multi_shelf_obj_type=u.ObjType}else if(g_pog_json[u.p_pog_index].ModuleInfo[u.MIndex].Carpark[0].ItemInfo.splice(f,1),0==g_pog_json[u.p_pog_index].ModuleInfo[u.MIndex].Carpark[0].ItemInfo.length){var c=g_scene_objects[u.p_pog_index].scene.children[2].getObjectById(g_pog_json[u.p_pog_index].ModuleInfo[u.MIndex].Carpark[0].SObjID);g_scene_objects[u.p_pog_index].scene.children[2].remove(c),g_pog_json[u.p_pog_index].ModuleInfo[u.MIndex].Carpark.splice(0,1)}g_pog_json[u.p_pog_index].ModuleInfo[u.MIndex].EditFlag="Y"}0}logDebug("function : deleteWorldObject","E")}catch(e){error_handling(e)}}async function deleteObjectLib(e,_,o,n,t,g,l){logDebug("function : deleteObjectLib; pDeleteShelf : "+_,"S");try{if("Y"==t){await update_undo_details("","",g,"","","","ITEM","","","N","","","","","","MODULE_DELETE","","","","","",l,"","","","",e);var i=g_scene_objects[e].scene.children[0];if(g_pog_json[e].ModuleInfo[g].ShelfInfo.length>0)for(const _ of g_pog_json[e].ModuleInfo[g].ShelfInfo){var d=g_scene_objects[e].scene.children[2].getObjectById(_.SObjID);if(g_scene_objects[e].scene.children[2].remove(d),void 0!==typeof _.ItemInfo){var a=0;for(const o of _.ItemInfo){d=g_scene_objects[e].scene.children[2].getObjectById(o.ObjID);g_scene_objects[e].scene.children[2].remove(d),a++}}}d=g_scene_objects[e].scene.children[2].getObjectById(g_pog_json[e].ModuleInfo[g].MObjID);g_scene_objects[e].scene.children[2].remove(d);for(const _ of g_scene_objects[e].scene.children[2].children){d=g_scene_objects[e].scene.children[2].getObjectByProperty("uuid","BASE1");g_scene_objects[e].scene.children[2].remove(d)}var s=(h=get_min_max_xy(e)).split("###");set_camera_z(i,parseFloat(s[2]),parseFloat(s[3]),parseFloat(s[0]),parseFloat(s[1]),g_offset_z,parseFloat(s[4]),parseFloat(s[5]),!0,g_pog_index),render(e);a=0;if(g_pog_json[e].ModuleInfo[g].ShelfInfo.length>0)for(const _ of g_pog_json[e].ModuleInfo[g].ShelfInfo){var f=g_pog_json[e].ModuleInfo[g].ShelfInfo[a].ItemInfo;for(const e of f)g_deletedItems.push(e.ItemID);a+=1}g_pog_json[e].W=g_pog_json[e].W-g_pog_json[e].ModuleInfo[g].W,g_pog_json[e].ModuleInfo=g_pog_json[e].ModuleInfo.filter((_=>_.ParentModule!=g_pog_json[e].ModuleInfo[g].Module)),0==g?g_pog_json[e].ModuleInfo.splice(g,g+1):g_pog_json[e].ModuleInfo.splice(g,1);var I=g_pog_json[e].W,r=0;for(const _ of g_pog_json[e].ModuleInfo)null!=_.ParentModule&&"undefined"!=_.ParentModule||r++;var p=0,c=0;for(const _ of g_pog_json[e].ModuleInfo)p=Math.max(p,_.H),null!=_.ParentModule&&void 0!==_.ParentModule||(c+=_.W);if(g_pog_json[e].PrevH=g_pog_json[e].H,g_pog_json[e].PrevW=g_pog_json[e].W,g_pog_json[e].H=p+g_pog_json[e].BaseH,g_pog_json[e].W=c,r>0){await deleted_items_log(g_deletedItems,"D",e),await context_create_module("",i,"Y",e,"N");if(g_pog_json[e].BaseH>0){var u=parseInt(g_pog_json[e].Color.replace("#","0x"),16),m=new THREE.Color(u);g_pog_json[e].BaseW=I,g_pog_json[e].BaseX=I/2;add_base("BASE1",I,g_pog_json[e].BaseH,g_pog_json[e].BaseD,m,I/2,g_pog_json[e].BaseY,"Y",e)}var h;s=(h=get_min_max_xy(e)).split("###");set_camera_z(i,parseFloat(s[2]),parseFloat(s[3]),parseFloat(s[0]),parseFloat(s[1]),g_offset_z,parseFloat(s[4]),parseFloat(s[5]),!0,g_pog_index),"Y"==g_scene_objects[e].Indicators.LiveImage&&animate_pog(e)}$s("P25_MODULE_DISP","")}else{var S=[],O="Y"==_?"SHELF_DELETE":"ITEM_DELETE";multi_pog_index=-1,multi_pog_ind="N",g_multi_shelf_index=-1,g_multi_shelf_ind="N",g_multi_mod_index="",g_multi_shelf_obj_type="",g_multi_shelf_arr=[],g_multi_delete_shelf_ind=_,g_multi_delete_done="Y";var j=[];89===g_keyCode&&90===g_keyCode||(g_redo_all_obj_arr=[],g_redo_final_obj_arr=[],g_undoRedoAction="REDO"),o.sort(((e,_)=>"ITEM"==e.Object&&"ITEM"==_.Object||"Y"==e.IsDivider&&"Y"==_.IsDivider?1:-1));if(o.keySort({p_pog_index:"asc",MIndex:"desc",SIndex:"desc",IIndex:"desc"}),"Y"!==o.multi_carpark_ind){var x={},M=o,T=[];g_allUndoObjectsInfo=[];var b;for(a=0;b=M[a++];){var D=b.SIndex+"-"+b.MIndex;if(!(D in x)){x[D]=1,T.push(D);j=[];var E=g_pog_json[b.p_pog_index].ModuleInfo[b.MIndex].ShelfInfo[b.SIndex].SObjID;j.moduleIndex=b.MIndex,j.module=g_pog_json[b.p_pog_index].ModuleInfo[b.MIndex].Module,j.moduleObjectID=g_pog_json[b.p_pog_index].ModuleInfo[b.MIndex].MObjID,j.shelfIndex=b.SIndex,j.actionType=O,j.startCanvas=b.p_pog_index,j.objectID=E,j.push(JSON.parse(JSON.stringify(g_pog_json[b.p_pog_index].ModuleInfo[b.MIndex].ShelfInfo[b.SIndex]))),g_allUndoObjectsInfo.push(j)}}for(const e of o)S.push(e.p_pog_index),"ITEM"==e.Object&&g_deletedItems.push(e.ItemID);j.g_deletedItems=g_deletedItems,S=[...new Set(S)];for(const e of S){await calculateFixelAndSupplyDays("N",e),await deleted_items_log(g_deletedItems,"D",e);render(e)}if(o.length>0){""!==o.multi_delete_shelf_ind?_=o.multi_delete_shelf_ind:o.multi_delete_shelf_ind,await deleteWorldObject(_,o);var v="N";if("Y"==_){for(const e of o){var N=g_pog_json[e.p_pog_index].ModuleInfo,P=g_pog_json[e.p_pog_index].ModuleInfo[e.MIndex].ShelfInfo;if("SHELF"==e.Object)if("SHELF"==e.ObjType&&"N"==e.IsDivider){var C=-1;a=0;for(obj of P){if(obj.SObjID==e.ObjID){C=a;break}a++}var R=g_pog_json[e.p_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo;if(R.length>0)for(var M of R)if("DIVIDER"==M.Item)for(a=0;a<P.length;a++){if(P[a].ItemID==M.Shelf){P.splice(a,1),a--;break}}-1!==C&&"N"!==g_pog_json[e.p_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].Combine?(g_pog_json[e.p_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo=[],g_pog_json[e.p_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].Combine="N",await generateCombinedShelfs(e.p_pog_index,e.MIndex,C,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y","","Y")):v="Y",P.splice(e.SIndex,1)}else if("TEXTBOX"==e.ObjType){var y=-1;$.each(N,(function(_,o){o.ObjID!=e.ObjID||(y=_)})),-1!==y&&N.splice(y,1),P.splice(e.SIndex,1)}else if("Y"==e.IsDivider){var H=-1;$.each(P,(function(_,o){"DIVIDER"==o.ObjType&&o.ShelfDivObjID==e.ObjID&&(H=_)})),-1!==H&&P.splice(H,1);var Y=0;for(const _ of P){var A=0;for(const o of _.ItemInfo)o.ObjID==e.ObjID&&(e.SIndex=Y,e.IIndex=A),A++;Y++}g_pog_json[e.p_pog_index].ModuleInfo[e.MIndex].ShelfInfo[e.SIndex].ItemInfo.splice(e.IIndex,1)}else P.splice(e.SIndex,1);0}if(g_combinedShelfs.length>0&&"Y"==v){a=0;for(var F of g_combinedShelfs){for(var L of F){if(L.PIndex==e){var B=g_pog_json[L.PIndex].ModuleInfo[L.MIndex].ShelfInfo,w=0;for(var X of B)"SHELF"!=X.ObjType&&"HANGINGBAR"!=X.ObjType||L.SObjID!=X.SObjID||(L.SIndex=w),w++}0}a++}}}if("Y"==g_multi_shelf_ind){for(const o of g_multi_shelf_arr){var[G,W]=getCombinationShelf(o.p_pog_index,g_pog_json[o.p_pog_index].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex].Shelf);if(-1!==G&&-1!==W&&await setCombinedShelfItems(o.p_pog_index,G,W,-1,"N","N",-1,-1,[]),"N"==_&&g_pog_json[o.p_pog_index].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex].ItemInfo.length>0){if("SHELF"==o.ObjType||"PALLET"==o.ObjType)reset_top_bottom_objects(o.MIndex,o.SIndex,"N",o.p_pog_index);if("PEGBOARD"!==o.ObjType&&await reset_auto_crush(o.MIndex,o.SIndex,-1,o.p_pog_index,o.MIndex,o.SIndex,e),"F"==g_pog_json[o.p_pog_index].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex].SpreadItem&&$.each(g_pog_json[o.p_pog_index].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex].ItemInfo,(function(e,_){_.W=_.RW})),"PALLET"!==o.ObjType&&reorder_items(o.MIndex,o.SIndex,o.p_pog_index))await recreate_all_items(o.MIndex,o.SIndex,o.ObjType,"N",-1,-1,g_pog_json[o.p_pog_index].ModuleInfo[o.MIndex].ShelfInfo[o.SIndex].ItemInfo.length,"N","N",-1,-1,g_start_canvas,"",o.p_pog_index,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")}0}}else if("N"==_&&g_pog_json[e].ModuleInfo[g_multi_mod_index].ShelfInfo[g_multi_shelf_index].ItemInfo.length>0){var[G,W]=getCombinationShelf(e,g_pog_json[e].ModuleInfo[g_multi_mod_index].ShelfInfo[g_multi_shelf_index].Shelf);if(-1!==G&&-1!==W&&await setCombinedShelfItems(e,G,W,-1,"N","N",-1,-1,[]),"SHELF"==g_multi_shelf_obj_type||"PALLET"==g_multi_shelf_obj_type)reset_top_bottom_objects(g_multi_mod_index,g_multi_shelf_index,"N",e);if("PEGBOARD"!==g_pog_json[e].ModuleInfo[g_multi_mod_index].ShelfInfo[g_multi_shelf_index].ObjType&&await reset_auto_crush(g_multi_mod_index,g_multi_shelf_index,-1,e,g_multi_mod_index,g_multi_shelf_index,e),"F"==g_pog_json[e].ModuleInfo[g_multi_mod_index].ShelfInfo[g_multi_shelf_index].SpreadItem&&$.each(g_pog_json[e].ModuleInfo[g_multi_mod_index].ShelfInfo[g_multi_shelf_index].ItemInfo,(function(e,_){_.W=_.RW})),"PALLET"!==h.ObjType&&reorder_items(g_multi_mod_index,g_multi_shelf_index,e))await recreate_all_items(g_multi_mod_index,g_multi_shelf_index,g_multi_shelf_obj_type,"N",-1,-1,g_pog_json[e].ModuleInfo[g_multi_mod_index].ShelfInfo[g_multi_shelf_index].ItemInfo.length,"N","N",-1,-1,g_start_canvas,"",e,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")}}for(const e of o)S.push(e.p_pog_index),"ITEM"==e.Object&&g_deletedItems.push(e.ItemID);j.g_deletedItems=g_deletedItems,S=[...new Set(S)];for(const e of S){await calculateFixelAndSupplyDays("N",e),await deleted_items_log(g_deletedItems,"D",e);render(e)}logFinalUndoObjectsInfo(O,"U",g_allUndoObjectsInfo,"","Y","N","N","N","N","Y"),g_allUndoObjectsInfo=[]}else await deleteWorldObject(_,o);"Y"==n&&null!==apex.region("draggable_table")&&("N"==g_all_pog_flag?($s("P25_OPEN_POG_CODE",`${g_pog_json[e].POGCode}`),$s("P25_OPEN_POG_VERSION",`${g_pog_json[e].Version}`)):($s("P25_OPEN_POG_CODE",""),$s("P25_OPEN_POG_VERSION",""))),"Y"==g_all_pog_flag&&await render_all_pog(),g_multiselect="N",g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[]}logDebug("function : deleteObjectLib","E")}catch(e){error_handling(e)}}async function deleteObject(e,_,o,n="N",t=-1,g){logDebug("function : deleteObject; p_pog_index : "+e+"; pProductListOpen : "+o+"; pDeleteModule : "+n+"; pModuleIndex : "+t,"S");try{g_mselect_drag="N";var l="N";if("Y"!==n){var i="N",d="";for(const e of _)e.Object!==d&&""!==d&&(i="Y"),d=e.Object,"SHELF"==e.Object&&(l="Y");"Y"==i&&"Y"==l?confirm(get_message("ITEM_FIXEL_DELETE"),get_message("SHCT_YES"),get_message("SHCT_NO"),(async function(){await deleteObjectLib(e,l,_,o,"N",-1,"")}),(async function(){l="N",await deleteObjectLib(e,l,_,o,"N",-1,"")})):await deleteObjectLib(e,l,_,o,"N",-1,"")}else await deleteObjectLib(e,l,_,o,"Y",t,g);g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],logDebug("function : deleteObject","E")}catch(e){error_handling(e)}}function getFieldValue(e,_,o){var n=_.split("."),t=e;for(const e of n){if(!t||"object"!=typeof t||!(e in t))return"";t=void 0!==t[e]&&null!==t[e]&&""!==t[e]||"number"==typeof t[e]&&!isNaN(t[e])?"F"!=o||"W"!=e&&"H"!=e&&"D"!=e&&"ROverhang"!=e&&"LOverhang"!=e?"ASP"==_||"EDLP"==_?g_msg_dollar+t[e]:"W"==e||"H"==e||"D"==e||"ROverhang"==e||"LOverhang"==e||"X"==e||"Y"==e||"Z"==e?parseFloat(parseFloat(t[e]).toFixed(2)):t[e]:parseFloat(parseFloat(100*t[e]).toFixed(2)):g_msg_na}if("OW"!=_&&"OH"!=_&&"OD"!=_||(t=parseFloat(parseFloat(t).toFixed(2))),"ItemDim"==_&&"Y"==$v("P25_ITEM_DIMENSION_FORMAT_SWITCH")){var g=get_message("POGCR_MSG_H"),l=get_message("POGCR_MSG_W"),i=get_message("POGCR_MSG_D");t=l+":"+Math.round(10*e.OW)/10+" ("+Math.round(e.OW*(1-e.CrushW/100)*10)/10+"/"+e.CrushW+") "+g+":"+Math.round(10*e.OH)/10+" ("+Math.round(e.OH*(1-e.CrushH/100)*10)/10+"/"+e.CrushH+") "+i+":"+Math.round(10*e.OD)/10+" ("+Math.round(e.OD*(1-e.CrushD/100)*10)/10+"/"+e.CrushD+")"}return t}async function call_sales_refresh(e){var _,o=$v("P25_STORE");if(o||(o=(o=$v("P25_MULTIPLE_STORE")).replace(/,/g,":")),"Y"==$v("P25_SHOW_HIDE_WEEK_SELECTION")&&(_=$v("P25_WEEK_SELECTION")),$s("P25_REFRESH_SALE_CALL","Y"),"N"==g_all_pog_flag)var n=e;else n=0;addLoadingIndicator();for(const e of g_pog_json)if(("Y"==g_pog_json[n].NewPOG||void 0===g_pog_json[n].NewPOG)&&""==o&&"N"==$v("P25_POGCR_SALES_REFRESH_HIDE_STORE")||("Y"==g_pog_json[n].NewPOG||void 0===g_pog_json[n].NewPOG)&&""==$v("P25_SALES_POG_CODE")&&"Y"==$v("P25_POGCR_SALES_REFRESH_HIDE_STORE"))raise_error("N"==$v("P25_POGCR_SALES_REFRESH_HIDE_STORE")?get_message("POGCR_STORE_VALIDATE"):get_message("POGCR_SALES_POG_CODE_VALID"));else{$s("P25_OPEN_POG_CODE",g_pog_json[n].POGCode);var t="Y"!=g_pog_json[n].NewPOG&&void 0!==g_pog_json[n].NewPOG||"Y"!=$v("P25_POGCR_SALES_REFRESH_HIDE_STORE")?g_pog_json[n].POGCode:$v("P25_SALES_POG_CODE");if(await refresh_sales_data(_,o,$v("P25_POGCR_FONTSIZE_DAYSOFSUPP"),g_hide_show_dos_label,g_show_days_of_supply,"Y","N","Y",g_pog_json[n].POGCode,t,"N",n),"Y"!=g_all_pog_flag)break;n++}removeLoadingIndicator(regionloadWait)}function multiSelectItemsWithShift(e,_){try{logDebug("function : multiSelectItemsWithShift; p_pog_index : "+e+"; p_offset_perc : "+_,"S");var o,n,t,g,l,i,d,a,s,f,I,r,p="CARPARK_ITEM",c="N";if(!$.isEmptyObject(g_shift_multi_item_last)){g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],c="Y"==g_shift_multi_item_first.isCarpark||"Y"==g_shift_multi_item_last.isCarpark?"Y":"N",a=g_shift_multi_item_first.Y+g_shift_multi_item_first.H/2,i=g_shift_multi_item_first.X+g_shift_multi_item_first.W/2,d=g_shift_multi_item_first.Y-g_shift_multi_item_first.H/2,l=g_shift_multi_item_first.X-g_shift_multi_item_first.W/2,r=g_shift_multi_item_last.Y+g_shift_multi_item_last.H/2,f=g_shift_multi_item_last.X+g_shift_multi_item_last.W/2,I=g_shift_multi_item_last.Y-g_shift_multi_item_last.H/2,s=g_shift_multi_item_last.X-g_shift_multi_item_last.W/2,o=Math.min(l,s),n=Math.max(a,r),t=Math.max(i,f),g=Math.min(d,I);var u=0;for(const l of g_pog_json[e].ModuleInfo){if(null==l.ParentModule||"undefined"==l.ParentModule){var m=0;for(const i of l.ShelfInfo){if(void 0!==i&&"NOTCH"!==i.ObjType&&"BASE"!==i.ObjType&&"DIVIDER"!==i.ObjType&&"TEXTBOX"!==i.ObjType){var h=0;for(const d of i.ItemInfo){var S=d.Y+d.H/2,O=d.X-d.W/2,j=d.Y-d.H/2,x=d.X+d.W/2;if(S<=n&&x<=t&&j>=g&&O>=o||_>0&&(S>n&&x<=t&&j>=g&&O>=o&&n>j&&(n-j)/d.H>=_/100||S<=n&&x>t&&j>=g&&O>=o&&t>O&&(t-O)/d.W>=_/100||S<=n&&x<=t&&j<g&&O>=o&&g<S&&(S-g)/d.H>=_/100||S<=n&&x<=t&&j>=g&&O<o&&o<x&&(x-o)/d.W>=_/100||S>n&&x<=t&&j<g&&O>=o&&(n-g)/d.H>=_/100||S<=n&&x>t&&j>=g&&O<o&&(t-o)/d.W>=_/100||S>n&&n>j&&x>t&&t>O&&j>=g&&O>=o&&(t-O)/d.W>=_/100&&(n-j)/d.H>=_/100||S<=n&&x<=t&&O<o&&o<x&&j<g&&g<S&&(S-g)/d.H>=_/100&&(x-o)/d.W>=_/100||S<=n&&j<g&&g<S&&x>t&&t>O&&O>=o&&(S-g)/d.H>=_/100&&(t-O)/d.W>=_/100||S>n&&n>j&&j>=g&&x<=t&&o<x&&O<o&&(x-o)/d.W>=_/100&&(n-j)/d.H>=_/100)){var M="N",T="ITEM";"DIVIDER"==d.Item&&(M="Y",T="SHELF"),(D=setDetailsArray(d.ObjID,u,m,d.W,d.H,d.X,d.Y,d.Z,h,i.ObjType,M,T,l.MObjID,i.SObjID,d.ItemID,d.Item,"N",0,0,d.Distance,d.TopObjID,d.BottomObjID,g_start_canvas,g_present_canvas,e)).W=d.W,D.RW=d.RW,D.H=d.H,D.X=d.X,D.Y=d.Y,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(D)}h++}}m++}if("Y"==c){var b=l.Carpark;if(void 0!==b&&b.length>0){h=0;for(const i of l.Carpark[0].ItemInfo){var D;S=i.Y+i.H/2,O=i.X+i.W/2,j=i.Y-i.H/2,x=i.X-i.W/2;if(S<=n&&x<=t&&j>=g&&O>=o||_>0&&(S>n&&x<=t&&j>=g&&O>=o&&n>j&&(n-j)/i.H>=_/100||S<=n&&x>t&&j>=g&&O>=o&&t>O&&(t-O)/i.W>=_/100||S<=n&&x<=t&&j<g&&O>=o&&g<S&&(S-g)/i.H>=_/100||S<=n&&x<=t&&j>=g&&O<o&&o<x&&(x-o)/i.W>=_/100||S>n&&x<=t&&j<g&&O>=o&&(n-g)/i.H>=_/100||S<=n&&x>t&&j>=g&&O<o&&(t-o)/i.W>=_/100||S>n&&n>j&&x>t&&t>O&&j>=g&&O>=o&&(t-O)/i.W>=_/100&&(n-j)/i.H>=_/100||S<=n&&x<=t&&O<o&&o<x&&j<g&&g<S&&(S-g)/i.H>=_/100&&(x-o)/i.W>=_/100||S<=n&&j<g&&g<S&&x>t&&t>O&&O>=o&&(S-g)/i.H>=_/100&&(t-O)/i.W>=_/100||S>n&&n>j&&j>=g&&x<=t&&o<x&&O<o&&(x-o)/i.W>=_/100&&(n-j)/i.H>=_/100))(D=setDetailsArray(i.ObjID,u,0,i.W,i.H,i.X,i.Y,i.Z,h,b.ObjType,"N",p,l.MObjID,b.SObjID,i.ItemID,i.Item,"N",0,0,i.Distance,i.TopObjID,i.BottomObjID,g_start_canvas,g_present_canvas,e)).W=items.W,D.RW=items.RW,D.H=items.H,D.X=items.X,D.Y=items.Y,D.IsCarpark="Y",g_delete_details.multi_delete_shelf_ind="",g_delete_details.multi_carpark_ind="Y",g_delete_details.push(D);h++}}}}u++}g_delete_details.StartCanvas=g_start_canvas,g_delete_details.g_present_canvas=g_present_canvas,"Y"==g_delete_details.multi_carpark_ind&&g_delete_details.some((e=>e.Object!==p))&&confirm(get_message("CARPARK_MULTI_SEL_CONF"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){for(var _=g_delete_details.length-1;_>=0;--_)g_delete_details[_].Object!==p&&g_delete_details.splice(_,1);set_multi_blink(g_pog_json,e)}),(function(){g_delete_details=[],set_multi_blink(g_pog_json,e)})),g_delete_details.length>0&&(g_multiselect="Y",g_mselect_drag="Y",g_intersected=[],"undefined"!=typeof g_delete_details&&($.each(g_delete_details,(function(_,o){var n=g_scene_objects[e].scene.children[2].getObjectById(o.ObjID);g_intersected.push(n)})),render_animate_selected()))}logDebug("function : multiSelectItemsWithShift","E")}catch(e){error_handling(e)}}async function set_btn_attr_onload(){0}async function upld_recom_autofill_items(e,_){return logDebug("function : upld_recom_autofill_items"),new Promise((function(o,n){var t=0;for(const o of e[_].ModuleInfo){if((void 0===o.ParentModule||null==o.ParentModule)&&o.ShelfInfo.length>0){var g=0;for(const n of o.ShelfInfo)e[_].ModuleInfo[t].ShelfInfo[g].ItemInfo=[],g++}t++}apex.server.process("UPLD_RECOM_AUTOFILL_ITEMS",{},{dataType:"text",success:function(e){""==$.trim(e)?($s("P25_CASE_ID",""),$s("P25_SCENARIO_ID",""),o("SUCCESS")):(raise_error(e),o("ERROR"))}})}))}function itemOverShelfInsidePegboard(e,_,o,n,t,g){logDebug("function : itemOverShelfInsidePegboard; Start");try{var l,i=-1,d=0,a=0,s="N",f="N",I=0,r=wpdSetFixed(e-g.W/2),p=wpdSetFixed(e+g.W/2),c=wpdSetFixed(_+g.H/2),u=wpdSetFixed(_-g.H/2),m=wpdSetFixed(g_pog_json[t].ModuleInfo[o].ShelfInfo[n].X-g_pog_json[t].ModuleInfo[o].ShelfInfo[n].W/2),h=wpdSetFixed(g_pog_json[t].ModuleInfo[o].ShelfInfo[n].X+g_pog_json[t].ModuleInfo[o].ShelfInfo[n].W/2),S=wpdSetFixed(g_pog_json[t].ModuleInfo[o].ShelfInfo[n].Y+g_pog_json[t].ModuleInfo[o].ShelfInfo[n].H/2),O=wpdSetFixed(g_pog_json[t].ModuleInfo[o].ShelfInfo[n].Y-g_pog_json[t].ModuleInfo[o].ShelfInfo[n].H/2),j=g_pog_json[t].ModuleInfo[o].ShelfInfo;for(const e of j){if("SHELF"==e.ObjType){var x=wpdSetFixed(e.X-e.W/2),M=wpdSetFixed(e.X+e.W/2),T=wpdSetFixed(e.Y+e.H/2),b=wpdSetFixed(e.Y-e.H/2);if(m<x&&h>M&&S>T&&O<b&&r<M&&p>x&&c>b&&u<T){l=e.ObjType,d=e.Y,a=e.H,i=I,s="Y",f="Y";break}}I++}return"N"==s&&(l="PEGBOARD",d=g_pog_json[t].ModuleInfo[o].ShelfInfo[n].Y,a=g_pog_json[t].ModuleInfo[o].ShelfInfo[n].H,i=n,s="Y"),logDebug("function : itemOverShelfInsidePegboard; End"),[o,l,d,a,i,s,f]}catch(e){throw error_handling(e),e}}async function doItemMoveConf(e,_,o,n=-1,t=-1){try{var g=!1,l=0,i=0,d=0;for(const a of e){l=0;for(const e of _[o].ModuleInfo){i=0;for(const _ of e.ShelfInfo){d=0;for(const e of _.ItemInfo){if(e.ItemID==a){if(-1==n&&-1==t){g=!0;break}if(-1!=n){for(const e of n)if(a==e.ItemID&&(e.MIndex!=l||e.SIndex!=i||e.IIndex!=d)){g=!0;break}if(g)break}else if(l!=t){g=!0;break}}d++}if(g)break;i++}if(g)break;l++}if(g)break}return g?new Promise(((e,_)=>{confirm(get_message("POG_MULTI_CANVAS_DRAG_CONFIRM"),get_message("SHCT_YES"),get_message("SHCT_NO"),(function(){e("Y")}),(function(){e("N")}))})):-1}catch(e){throw error_handling(e),e}}function itemInPegboardOverhang(e,_,o,n){try{var t=wpdSetFixed(e-n.W/2),g=wpdSetFixed(e+n.W/2),l=wpdSetFixed(_+n.H/2),i=wpdSetFixed(_-n.H/2),d=0;for(const e of g_pog_json[o].ModuleInfo){if(void 0===e.ParentModule||null==e.ParentModule){var a=0;for(const _ of e.ShelfInfo){if("PEGBOARD"===_.ObjType){var s=wpdSetFixed(_.X-_.W/2),f=wpdSetFixed(_.X+_.W/2),I=wpdSetFixed(_.Y+_.H/2),r=wpdSetFixed(_.Y-_.H/2);if(!(l<r||i>I||g<s||t>f)){var p=wpdSetFixed(_.X-_.W/2-_.LOverhang),c=wpdSetFixed(_.X+_.W/2+_.ROverhang),u=wpdSetFixed(_.Y+_.H/2+_.UOverHang),m=wpdSetFixed(_.Y-_.H/2-_.LoOverHang);if(l<=u&&i>=m&&t>=p&&g<=c){var h="Y";return(l>I||i<r||t<s||g>f)&&(h="N"),[!0,"Y",d,"PEGBOARD",_.Y,_.H,a,"Y",h]}}}a++}}d++}return[!1,"",-1,"",-1,-1,-1,"",""]}catch(e){error_handling(e)}}async function itemDimUpdate(e){logDebug("function : itemDimUpdate;");try{var _,o=0;for(const l of g_pog_json[e].ModuleInfo){if(void 0===l.ParentModule||null==l.ParentModule){var n=0;for(const i of l.ShelfInfo){if("BASE"!==i.ObjType&&"NOTCH"!==i.ObjType&&"DIVIDER"!==i.ObjType&&"TEXTBOX"!==i.ObjType&&i.ItemInfo.length>0){var t=0;for(const l of i.ItemInfo)"DIVIDER"!==l.Item&&check_dim_difference(o,n,t,e)&&(g_dragItem=l,"F"==(g=await check_item_dim_valid(l,o,n,t,e,"N"))&&(_=g)),t++;if("F"==_&&reorder_items(o,n,e))var g=await recreate_all_items(o,n,i.ObjType,"Y",-1,-1,i.ItemInfo.length,"Y","N",-1,-1,g_start_canvas,"N",e,$v("P25_POGCR_DELIST_ITEM_DFT_COL"),$v("P25_MERCH_STYLE"),$v("P25_POGCR_LOAD_IMG_FROM"),$v("P25_BU_ID"),$v("P25_POGCR_ITEM_NUM_LBL_COLOR"),$v("P25_POGCR_ITEM_NUM_LABEL_POS"),$v("P25_POGCR_DISPLAY_ITEM_INFO"),"Y")}n++}}o++}}catch(e){error_handling(e)}}