var l_selected_mod,l_pog_type="";function setUpMouseHander(e,_,t,o,s,i){try{if("string"==typeof e&&(e=document.getElementById(e)),!e||!e.addEventListener)throw"first argument in setUpMouseHander is not a valid element";var a,n;document.addEventListener("mousemove",(function(e){if(_){var t=document.getElementById("maincanvas"),o=g_pog_json;void 0!==g_scene_objects[i]?(new_camera=g_scene_objects[i].scene.children[0],new_world=g_scene_objects[i].scene.children[2]):(new_camera=g_camera,new_world=g_world);var s=t.getBoundingClientRect(),g=(s.height,e.clientX-s.left),r=e.clientY-s.top;_(g,r,e,a,n,t,o,"#maincanvas",i)}a=g,n=r})),s.domElement.addEventListener("mousedown",(function(e){if(!g_dragging&&1==window.event.which){g_taskItemInContext=clickInsideElement(e,"canvasregion"),g_taskItemInContext1=clickInsideElement(e,"canvasregion1"),g_taskItemInContext?g_canvas=document.getElementById("maincanvas"):g_canvas=document.getElementById("maincanvas1");var _=g_canvas.getBoundingClientRect(),o=_.left,s=_.top,g=e.clientX-_.left,r=e.clientY-_.top;a=g,n=r,g_dragging=t(g,r,o,s,e,g_canvas,"N",i)}})),s.domElement.addEventListener("mouseup",(function(e){if(g_dragging){g_taskItemInContext=clickInsideElement(e,"canvasregion"),g_taskItemInContext1=clickInsideElement(e,"canvasregion1");var _=[];if(g_taskItemInContext?(g_canvas=document.getElementById("maincanvas"),_=g_pog_json,void 0!==g_scene_objects[i]?(g_scene_objects[i].scene.children[0],g_scene_objects[i].scene.children[2]):(g_camera,g_world)):(g_canvas=document.getElementById("maincanvas1"),_=g_pog_json_comp,g_camera_comp,g_world_comp),o){var t=g_canvas.getBoundingClientRect(),s=e.clientX-t.left,g=e.clientY-t.top;o(s,g,e,a,n,g_canvas,_,i)}g_dragging=!1}}))}catch(e){error_handling(e)}}function init(){try{g_canvas_region=document.getElementById("drawing_region"),g_selection=document.getElementById("selection"),g_renderer=new THREE.WebGLRenderer({canvas:g_canvas,antialias:!0});try{var e=window.devicePixelRatio||1;if(g_renderer&&"function"==typeof g_renderer.getPixelRatio?g_renderer.__origPixelRatio=g_renderer.getPixelRatio():g_renderer.__origPixelRatio=e,g_start_pixel_ratio=g_renderer.__origPixelRatio,g_renderer&&"function"==typeof g_renderer.getSize){var _=new THREE.Vector2;g_renderer.getSize(_),g_renderer.__origSize={w:_.x,h:_.y}}else g_renderer&&g_renderer.domElement&&(g_renderer.__origSize={w:g_renderer.domElement.width||g_renderer.domElement.clientWidth||null,h:g_renderer.domElement.height||g_renderer.domElement.clientHeight||null})}catch(e){console.warn("Could not record renderer origin state",e)}g_canvas_objects.push(g_canvas)}catch(e){return void(document.getElementById("canvas-holder").innerHTML="<p><b>Sorry, an error occurred:<br>"+e+"</b></p>")}createWorld(),g_raycaster=new THREE.Raycaster,render(),g_multiselect="N",g_ctrl_select="N";var t=window.devicePixelRatio||1;g_start_pixel_ratio=t;var o=document.getElementById("ig_mod_details");if(o)var s=o.offsetWidth;else s=0;windowWidth=window.innerWidth-s,setUpMouseHander("maincanvas",doMouseMove,doMouseDown,doMouseUp,g_renderer,g_pog_index),g_tanFOV=Math.tan(Math.PI/180*g_camera.fov/2),g_windowHeight=window.innerHeight,g_initial_windowHeight=window.innerHeight,g_camera.aspect=windowWidth/g_windowHeight,g_camera.fov=360/Math.PI*Math.atan(g_tanFOV*(g_windowHeight/g_initial_windowHeight)),g_camera.updateProjectionMatrix(),render(),window.addEventListener("resize",onWindowResize,!1),onWindowResize("F")}function onWindowResize(e){try{var _=document.getElementById("ig_mod_details");if(_)var t=_.offsetWidth;else t=0;windowWidth=window.innerWidth-t,g_windowHeight=window.innerHeight,g_camera.aspect=windowWidth/g_windowHeight,g_camera.fov=360/Math.PI*Math.atan(g_tanFOV*(g_windowHeight/g_initial_windowHeight));window.devicePixelRatio;g_renderer.setSize(windowWidth,g_windowHeight),g_camera.updateProjectionMatrix(),g_renderer.render(g_scene,g_camera)}catch(e){error_handling(e)}}async function create_module_from_json(e,_,t,o,s,i,a,n,g,r,l,c){try{if(load_orientation_json(),$("#LIVE_IMAGE").addClass("apex_disabled"),"Y"==$v("P36_POGCR_DFT_NOTCH_LABEL")&&(g_show_notch_label="Y"),"Y"==$v("P36_POGCR_DFT_FIXEL_LABEL")&&(g_show_fixel_label="Y"),"Y"==$v("P36_POGCR_SHOW_DFLT_ITEM_LOC")&&(g_show_item_label="Y"),console.log("values",e,_,t,o,s,n,g,$v("P36_VDATE"),$v("P36_POG_DEFAULT_COLOR"),$v("P36_MODULE_DEFAULT_COLOR"),null,!1,r,l,$v("P36_POGCR_DFT_SPREAD_PRODUCT"),parseFloat($v("P36_PEGBOARD_DFT_HORZ_SPC")),parseFloat($v("P36_PEGBOARD_DFT_VERT_SPC")),parseFloat($v("P36_BASKET_WALL_THICK")),parseFloat($v("P36_CHEST_WALL_THICK")),$v("P36_POGCR_PEG_ITEM_AUTO_PLACE"),$v("P36_POGCR_DEFAULT_WRAP_TEXT"),parseInt($v("P36_POGCR_TEXT_DEFAULT_SIZE")),$v("P36_POG_TEXTBOX_DEFAULT_COLOR"),$v("P36_SHELF_DEFAULT_COLOR"),$v("P36_DIV_COLOR"),$v("P36_SLOT_DIVIDER"),$v("P36_SLOT_ORIENTATION"),$v("P36_DIVIDER_FIXED"),$v("P36_ITEM_DFT_COLOR"),$v("P36_POGCR_DELIST_ITEM_DFT_COLOR"),"Y",null,1,$v("P36_MERCH_STYLE"),$v("P36_POGCR_LOAD_IMG_FROM"),$v("P36_BU_ID"),$v("P36_POGCR_DELIST_ITEM_DFT_COLOR"),$v("P36_POGCR_ITEM_NUM_LBL_COLOR"),$v("P36_POGCR_DISPLAY_ITEM_INFO"),$v("P36_POGCR_ITEM_NUM_LBL_COLOR"),$v("P36_POGCR_ITEM_NUM_LABEL_POS"),$v("P36_NOTCH_HEAD"),"N",$v("P36_POGCR_DFT_BASKET_FILL"),$v("P36_POGCR_DFT_BASKET_SPREAD"),g_scene_objects[0].scene.children[0],c,l,$v("P36_POGCR_NOTCH_START_VALUE"),"N","Y","N"),await create_module_from_json_lib(e,_,t,o,s,n,g,$v("P36_VDATE"),$v("P36_POG_DEFAULT_COLOR"),$v("P36_MODULE_DEFAULT_COLOR"),null,!1,r,l,$v("P36_POGCR_DFT_SPREAD_PRODUCT"),parseFloat($v("P36_PEGBOARD_DFT_HORZ_SPC")),parseFloat($v("P36_PEGBOARD_DFT_VERT_SPC")),parseFloat($v("P36_BASKET_WALL_THICK")),parseFloat($v("P36_CHEST_WALL_THICK")),$v("P36_POGCR_PEG_ITEM_AUTO_PLACE"),$v("P36_POGCR_DEFAULT_WRAP_TEXT"),parseInt($v("P36_POGCR_TEXT_DEFAULT_SIZE")),$v("P36_POG_TEXTBOX_DEFAULT_COLOR"),$v("P36_SHELF_DEFAULT_COLOR"),$v("P36_DIV_COLOR"),$v("P36_SLOT_DIVIDER"),$v("P36_SLOT_ORIENTATION"),$v("P36_DIVIDER_FIXED"),$v("P36_ITEM_DFT_COLOR"),$v("P36_POGCR_DELIST_ITEM_DFT_COLOR"),"Y",null,1,$v("P36_MERCH_STYLE"),$v("P36_POGCR_LOAD_IMG_FROM"),$v("P36_BU_ID"),$v("P36_POGCR_DELIST_ITEM_DFT_COLOR"),$v("P36_POGCR_ITEM_NUM_LBL_COLOR"),$v("P36_POGCR_DISPLAY_ITEM_INFO"),$v("P36_POGCR_ITEM_NUM_LBL_COLOR"),$v("P36_POGCR_ITEM_NUM_LABEL_POS"),$v("P36_NOTCH_HEAD"),"N",$v("P36_POGCR_DFT_BASKET_FILL"),$v("P36_POGCR_DFT_BASKET_SPREAD"),g_scene_objects[0].scene.children[0],c,l,$v("P36_POGCR_NOTCH_START_VALUE"),"N","Y","N"),("Y"==$v("P36_POGCR_DFT_ITEM_DESC")||0==g_ItemImages.length&&"Y"==$v("P36_POGCR_DFLT_LIVE_IMAGES"))&&(await showHideItemDescription("Y",$v("P36_POGCR_ITEM_NUM_LBL_COLOR"),$v("P36_POGCR_DISPLAY_ITEM_INFO"),c),"Y"==$v("P36_POGCR_DFT_ITEM_DESC")&&(g_show_live_image="N"),g_show_item_desc="Y"),await get_all_images(c,"N","N",$v("P36_POGCR_IMG_MAX_WIDTH"),$v("P36_POGCR_IMG_MAX_HEIGHT"),$v("P36_IMAGE_COMPRESS_RATIO")),$("#LIVE_IMAGE").removeClass("apex_disabled"),g_ItemImages.length>0&&"N"==a&&"Y"==$v("P36_POGCR_DFLT_LIVE_IMAGES")&&"N"==$v("P36_POGCR_DFT_ITEM_DESC"))try{g_show_live_image="Y";await recreate_image_items("Y",$v("P36_MERCH_STYLE"),$v("P36_POGCR_LOAD_IMG_FROM"),$v("P36_BU_ID"),$v("P36_POGCR_ITEM_NUM_LBL_COLOR"),$v("P36_POGCR_ITEM_NUM_LABEL_POS"),$v("P36_POGCR_DISPLAY_ITEM_INFO"),$v("P36_POGCR_DELIST_ITEM_DFT_COL"),$v("P36_NOTCH_HEAD"),c,"N");animate_pog(c)}catch(e){error_handling(e)}console.log("P36_POGCR_DFT_NOTCH_LABEL",$v("P36_POGCR_DFT_NOTCH_LABEL"),$v("P36_POGCR_DFT_FIXEL_LABEL"),$v("P36_POGCR_SHOW_DFLT_ITEM_LOC"));var d=get_min_max_xy(c).split("###");set_camera_z(g_scene_objects[c].scene.children[0],parseFloat(d[2]),parseFloat(d[3]),parseFloat(d[0]),parseFloat(d[1]),g_offset_z,parseFloat(d[4]),parseFloat(d[5]),!0,c),render(),"undefined"!=typeof regionloadWait&&null!==regionloadWait&&"Y"==i&&removeLoadingIndicator(regionloadWait)}catch(e){error_handling(e)}return"SUCCESS"}function doMouseMove(e,_,t,o,s,a,n,g,r){try{var l=a.width/window.devicePixelRatio,c=a.height/window.devicePixelRatio,d=2*e/l-1,m=1-2*_/c,u=(parseFloat($("#ig_mod_details").css("padding-left").replace("px","")),devicePixelRatio,document.getElementById("ig_mod_details").offsetWidth+40),I=$(document).scrollTop(),O=$(".t-Region-body").scrollLeft();g_scene_objects[0].scene.children[0].updateProjectionMatrix(),g_raycaster.setFromCamera(new THREE.Vector2(d,m),g_scene_objects[0].scene.children[0]),void 0!==g_scene_objects[r]?g_intersects=g_raycaster.intersectObjects(g_scene_objects[r].scene.children[2].children):g_intersects=g_raycaster.intersectObjects(g_world.children);var p=$(document),f=$(window),D=$("#object_info"),E=D.offset(),h=E.top-p.scrollTop(),P=(f.height(),D.height(),E.left-p.scrollLeft());f.width(),D.width();g_mouse.x=t.clientX+O-u,g_mouse.y=t.clientY+I;var v=g_startMouse.x,M=g_mouse.x,b=g_startMouse.y,T=g_mouse.y;if(v>M){var y=v;v=M,M=y}if(b>T){var S=b;b=T,T=S}if(g_dragging){g_raycaster.setFromCamera(new THREE.Vector2(d,m),g_scene_objects[0].scene.children[0]),g_intersects=g_raycaster.intersectObject(g_targetForDragging);g_drag_z;var L=g_intersects[0].point.x,R=g_intersects[0].point.y,x=g_intersects[0].point.z,j=new THREE.Vector3(L,R,x);g_scene_objects[r].scene.children[2].worldToLocal(j),d=Math.min(19,Math.max(-19,j.x)),_=Math.min(19,Math.max(-19,j.y)),g_selecting&&(g_multiselect="Y",g_DragMouseEnd.x=d,g_DragMouseEnd.y=_,g_selection.style.left=v+"px",g_selection.style.top=b+"px",g_selection.style.width=M-v-5+"px",g_selection.style.height=T-b-5+"px",console.log("g_selection.style.left",g_selection.style.left,g_selection.style.top,g_selection.style.width)),g_DragMouseEnd.x=d,g_DragMouseEnd.y=_}else g_selecting&&(g_selecting=!1,g_selection.style.visibility="hidden");var C=document.getElementById("object_info");$("#object_info").contents().filter((function(){return 3==this.nodeType})).remove();var w="",G=0,A=[],N=" | ";if(g_intersects.length>0&&void 0!==g_intersects[0].object.ItemID&&""!==g_intersects[0].object.ItemID&&"DIVIDER"!==g_intersects[0].object.ItemID){var F=$v("P36_POGCR_ITEM_DESC_LIST").split(":");for(i=0;i<F.length;i++){var H=0;N=i>0?" | ":"";if("ITEM"==F[i]&&(w=w+N+get_message("ITEM_ID_LBL")+': <span style="color:yellow">'+g_intersects[0].object.ItemID+"</span>",H=(" | "+get_message("ITEM_ID_LBL")+": "+g_intersects[0].object.ItemID).visualLength("ruler")),"UPC"==F[i]&&(w=w+N+get_message("POGCR_REP_TEMP_HEAD_BARCODE")+': <span style="color:yellow">'+g_intersects[0].object.Barcode+"</span>",H=(" | "+get_message("POGCR_REP_TEMP_HEAD_BARCODE")+": "+g_intersects[0].object.Barcode).visualLength("ruler")),"DESC"==F[i]&&(w=w+N+get_message("DESCRIPTION_DETAIL")+': <span style="color:yellow">'+g_intersects[0].object.Description+"</span>",H=(" | "+get_message("DESCRIPTION_DETAIL")+": "+g_intersects[0].object.Description).visualLength("ruler")),"BRAND"==F[i]&&(w=w+N+get_message("POGCR_BRAND")+': <span style="color:yellow">'+g_intersects[0].object.Brand+"</span>",H=(" | "+get_message("POGCR_BRAND")+": "+g_intersects[0].object.Brand).visualLength("ruler")),"GROUP"==F[i]&&(w=w+N+get_message("POGCR_GROUP_LBL")+': <span style="color:yellow">'+g_intersects[0].object.Group+"</span>",H=(" | "+get_message("POGCR_GROUP_LBL")+": "+g_intersects[0].object.Group).visualLength("ruler")),"DEPT"==F[i]&&(w=w+N+get_message("POGCR_TEMP_HEAD_DEPARTMENT")+': <span style="color:yellow">'+g_intersects[0].object.Dept+"</span>",H=(" | "+get_message("POGCR_TEMP_HEAD_DEPARTMENT")+": "+g_intersects[0].object.Dept).visualLength("ruler")),"CLASS"==F[i]&&(w=w+N+get_message("POGCR_CLASS_LBL")+': <span style="color:yellow">'+g_intersects[0].object.Class+"</span>",H=(" | "+get_message("POGCR_CLASS_LBL")+": "+g_intersects[0].object.Class).visualLength("ruler")),"SUBCLASS"==F[i]&&(w=w+N+get_message("POGCR_SUBCLASS_LBL")+': <span style="color:yellow">'+g_intersects[0].object.SubClass+"</span>",H=(" | "+get_message("POGCR_SUBCLASS_LBL")+": "+g_intersects[0].object.SubClass).visualLength("ruler")),"ITEM_SIZE"==F[i]&&(w=w+N+get_message("POGCR_ITEMSIZE_LBL")+': <span style="color:yellow">'+g_intersects[0].object.SizeDesc+"</span>",H=(" | "+get_message("POGCR_ITEMSIZE_LBL")+": "+g_intersects[0].object.SizeDesc).visualLength("ruler")),"SUPPLIER"==F[i]&&(w=w+N+get_message("POGCR_REP_HEAD_SUPPLIERS")+': <span style="color:yellow">'+g_intersects[0].object.Supplier+"</span>",H=(" | "+get_message("POGCR_REP_HEAD_SUPPLIERS")+": "+g_intersects[0].object.Supplier).visualLength("ruler")),"WIDTH"==F[i]&&(w=w+N+get_message("POGCR_WIDTH_LBL")+': <span style="color:yellow">'+(100*g_intersects[0].object.OW).toFixed(2)+"</span>",H=(" | "+get_message("POGCR_WIDTH_LBL")+": "+(100*g_intersects[0].object.OW).toFixed(2)).visualLength("ruler")),"HEIGHT"==F[i]&&(w=w+N+get_message("POGCR_HEIGHT_LBL")+': <span style="color:yellow">'+(100*g_intersects[0].object.OH).toFixed(2)+"</span>",H=(" | "+get_message("POGCR_HEIGHT_LBL")+": "+(100*g_intersects[0].object.OH).toFixed(2)).visualLength("ruler")),"DEPTH"==F[i]&&(w=w+N+get_message("POGCR_DEPTH_LBL")+': <span style="color:yellow">'+(100*g_intersects[0].object.OD).toFixed(2)+"</span>",H=(" | "+get_message("POGCR_DEPTH_LBL")+": "+(100*g_intersects[0].object.OD).toFixed(2)).visualLength("ruler")),"STORE"==F[i]&&(w=w+N+get_message("POGCR_STORE_LBL")+': <span style="color:yellow">'+g_intersects[0].object.StoreCnt+"</span>",H=(" | "+get_message("POGCR_STORE_LBL")+": "+g_intersects[0].object.StoreCnt).visualLength("ruler")),"ITEM_DIM"==F[i]&&(w=w+N+get_message("POGCR_ITEM_DIM_LBL")+': <span style="color:yellow">'+g_intersects[0].object.ItemDim+"</span>",H=(" | "+get_message("POGCR_ITEM_DIM_LBL")+": "+g_intersects[0].object.ItemDim).visualLength("ruler")),"POSITION"==F[i]&&(w=w+N+get_message("POGCR_POSITION_LBL")+': <span style="color:yellow">'+g_intersects[0].object.LocID+"</span>",H=(" | "+get_message("POGCR_POSITION_LBL")+": "+g_intersects[0].object.LocID).visualLength("ruler")),"SHELF"==F[i]&&(w=w+N+get_message("POGCR_SHELF_LBL")+': <span style="color:yellow">'+g_intersects[0].object.Shelf+"</span>",H=(" | "+get_message("POGCR_SHELF_LBL")+": "+g_intersects[0].object.Shelf).visualLength("ruler")),"ORIENTATION"==F[i]&&(w=w+N+get_message("POGCR_ORIENTATION_LBL")+': <span style="color:yellow">'+g_intersects[0].object.OrientationDesc+"</span>",H=(" | "+get_message("POGCR_ORIENTATION_LBL")+": "+g_intersects[0].object.OrientationDesc).visualLength("ruler")),"DEPTH_FACING"==F[i]&&(w=w+N+get_message("POGCR_DEPTH_FACING_LBL")+': <span style="color:yellow">'+g_intersects[0].object.DFacing+"</span>",H=(" | "+get_message("POGCR_DEPTH_FACING_LBL")+": "+g_intersects[0].object.DFacing).visualLength("ruler")),"HORIZ_FACING"==F[i]&&(w=w+N+get_message("TEMP_HEAD_HORIZ_FACING")+': <span style="color:yellow">'+g_intersects[0].object.HorizFacing+"</span>",H=(" | "+get_message("TEMP_HEAD_HORIZ_FACING")+": "+g_intersects[0].object.HorizFacing).visualLength("ruler")),"VERT_FACING"==F[i]&&(w=w+N+get_message("TEMP_HEAD_VERT_FACING")+': <span style="color:yellow">'+g_intersects[0].object.VertFacing+"</span>",H=(" | "+get_message("TEMP_HEAD_VERT_FACING")+": "+g_intersects[0].object.VertFacing).visualLength("ruler")),"SELLING_PRICE"==F[i]&&(w=w+N+get_message("SELLING_PRICE_LBL")+': <span style="color:yellow">'+parseFloat(g_intersects[0].object.SellingPrice).toFixed(2)+"</span>",H=(" | "+get_message("SELLING_PRICE_LBL")+": "+g_intersects[0].object.SellingPrice).visualLength("ruler")),"SALES_UNIT"==F[i]&&(w=w+N+get_message("SALES_UNIT_LBL")+': <span style="color:yellow">'+parseFloat(g_intersects[0].object.SalesUnit).toFixed(2)+"</span>",H=(" | "+get_message("SALES_UNIT_LBL")+": "+g_intersects[0].object.SalesUnit).visualLength("ruler")),"NET_SALES"==F[i]&&(w=w+N+get_message("NET_SALES_LBL")+': <span style="color:yellow">'+parseFloat(g_intersects[0].object.NetSales).toFixed(2)+"</span>",H=(" | "+get_message("NET_SALES_LBL")+": "+g_intersects[0].object.NetSales).visualLength("ruler")),"PROFIT"==F[i]&&(w=w+N+get_message("PROFIT_LBL")+': <span style="color:yellow">'+parseFloat(g_intersects[0].object.Profit).toFixed(2)+"</span>",H=(" | "+get_message("PROFIT_LBL")+": "+g_intersects[0].object.Profit).visualLength("ruler")),"TOTAL_MARGIN"==F[i]&&(w=w+N+get_message("POGCR_TOTAL_MARGIN")+': <span style="color:yellow">'+parseFloat(g_intersects[0].object.TotalMargin).toFixed(2)+"</span>",H=(" | "+get_message("POGCR_TOTAL_MARGIN")+": "+g_intersects[0].object.TotalMargin).visualLength("ruler")),"COGS_ADJ"==F[i]&&(w=w+N+get_message("COGS_ADJ")+': <span style="color:yellow">'+parseFloat(nvl(g_intersects[0].object.CogsAdj)).toFixed(2)+"</span>",H=(" | "+get_message("COGS_ADJ")+": "+nvl(g_intersects[0].object.CogsAdj)).visualLength("ruler")),"GP"==F[i]&&(w=w+N+get_message("GROSS_PROFIT")+': <span style="color:yellow">'+parseFloat(nvl(g_intersects[0].object.GrossProfit)).toFixed(2)+"</span>",H=(" | "+get_message("GROSS_PROFIT")+": "+nvl(g_intersects[0].object.GrossProfit)).visualLength("ruler")),"WK_COUNT"==F[i]&&(w=w+N+get_message("WEEKS_COUNT")+': <span style="color:yellow">'+parseFloat(nvl(g_intersects[0].object.WeeksCount)).toFixed(2)+"</span>",H=(" | "+get_message("WEEKS_COUNT")+": "+nvl(g_intersects[0].object.WeeksCount)).visualLength("ruler")),"REG_MOV"==F[i]&&(w=w+N+get_message("REG_MOV")+': <span style="color:yellow">'+parseFloat(nvl(g_intersects[0].object.RegMovement)).toFixed(2)+"</span>",H=(" | "+get_message("REG_MOV")+": "+nvl(g_intersects[0].object.RegMovement)).visualLength("ruler")),"AVG_SALES"==F[i]&&(w=w+N+get_message("AVG_SALES")+': <span style="color:yellow">'+parseFloat(nvl(g_intersects[0].object.AvgSales)).toFixed(2)+"</span>",H=(" | "+get_message("AVG_SALES")+": "+nvl(g_intersects[0].object.AvgSales)).visualLength("ruler")),"DESC_SECOND"==F[i]&&(w=w+N+get_message("DESC_SECOND_LBL")+': <span style="color:yellow">'+g_intersects[0].object.DescSecond+"</span>",H=(" | "+get_message("DESC_SECOND_LBL")+": "+g_intersects[0].object.DescSecond).visualLength("ruler")),"ITEM_STATUS"==F[i]&&(w=w+N+get_message("ITEM_STATUS")+': <span style="color:yellow">'+g_intersects[0].object.ItemStatus+"</span>",H=(" | "+get_message("ITEM_STATUS")+": "+Y).visualLength("ruler")),"TOTAL_UNIT"==F[i]){var Y=g_intersects[0].object.HorizFacing*g_intersects[0].object.VertFacing*g_intersects[0].object.DFacing;w=w+N+get_message("TOTAL_UNIT")+': <span style="color:yellow">'+Y+"</span>",H=(" | "+get_message("TOTAL_UNIT")+": "+Y).visualLength("ruler")}(G+=H)>1300&&(w+="<br>",A.push(G),G=0)}}else if(g_intersects.length>0&&void 0!==g_intersects[0].object.FixelID&&""!==g_intersects[0].object.FixelID&&void 0!==n[r]){var B=void 0!==n[r].Version&&null!==n[r].Version?n[r].Version:"";if("Y"==sessionStorage.getItem("new_pog_ind"))var W=N+get_message("POGCR_DRAFT_VERSION")+': <span style="color:yellow">'+sessionStorage.getItem("P36_EXISTING_DRAFT_VER")+" </span> ",U="";else W="",U=N+get_message("POGCR_POG_VERSION")+': <span style="color:yellow">'+B+" </span> ";w=void 0!==g_intersects[0].object.AvlSpace?w+get_message("POGCR_POG_CODE")+': <span style="color:yellow">'+n[r].POGCode+" </span> "+U+W+N+get_message("POGCR_POG_MOD")+': <span style="color:yellow">'+g_intersects[r].object.Module+" </span> "+N+get_message("POGCR_FIXEL_ID")+': <span style="color:yellow">'+g_intersects[r].object.FixelID+" </span> "+N+get_message("POGC_FIXEL_SPACE")+': <span style="color:yellow">'+g_intersects[0].object.AvlSpace+"</span>":w+get_message("POGCR_POG_CODE")+': <span style="color:yellow">'+n[r].POGCode+" </span> "+U+W+N+get_message("POGCR_POG_MOD")+': <span style="color:yellow">'+g_intersects[r].object.Module+" </span> "+N+get_message("POGCR_FIXEL_ID")+': <span style="color:yellow">'+g_intersects[r].object.FixelID+" </span> "+N+"</span>",C.classList.add("active")}else if(g_intersects.length>0&&void 0!==g_intersects[0].object.Module&&""!==g_intersects[0].object.Module&&void 0!==n[r]){B=void 0!==n[r].Version&&null!==n[r].Version?n[r].Version:"";if("Y"==sessionStorage.getItem("new_pog_ind"))W=N+get_message("POGCR_DRAFT_VERSION")+': <span style="color:yellow">'+sessionStorage.getItem("P36_EXISTING_DRAFT_VER")+" </span> ",U="";else W="",U=N+get_message("POGCR_POG_VERSION")+': <span style="color:yellow">'+B+" </span> ";w=w+get_message("POGCR_POG_CODE")+': <span style="color:yellow">'+n[r].POGCode+" </span> "+U+W+N+get_message("POGCR_POG_MOD")+': <span style="color:yellow">'+g_intersects[0].object.Module+"</span>",C.classList.add("active")}else if(void 0!==n&&n.length>0&&void 0!==n[r]){B=void 0!==n[r].Version&&null!==n[r].Version?n[r].Version:"";if("Y"==sessionStorage.getItem("new_pog_ind"))W=N+get_message("POGCR_DRAFT_VERSION")+': <span style="color:yellow">'+sessionStorage.getItem("P36_EXISTING_DRAFT_VER")+" </span> ",U="";else W="",U=N+get_message("POGCR_POG_VERSION")+': <span style="color:yellow">'+B+" </span> ";w=w+get_message("POGCR_POG_CODE")+': <span style="color:yellow">'+n[r].POGCode+" </span> "+U+W,C.classList.add("active")}else C.classList.remove("active");if(g_intersects.length>0)if(void 0!==g_intersects[0].object.ItemID&&""!==g_intersects[0].object.ItemID&&"DIVIDER"!==g_intersects[0].object.ItemID){c=36;var V=F.length>7?150:50;if(A.length>0)l=Math.max.apply(Math,A)+V;else l=w.visualLength("ruler")+V}else c=31,l=w.visualLength("ruler")+50;else c=31,l=w.visualLength("ruler")+50;$("#object_info").html(w),C.style.top=window.innerHeight-D.height()+"px",C.style.width=l+"px",C.style.height=c+5+"px",C.style.fontSize="large",C.style.fontFamily="Tahoma",C.style.left="0px"}catch(e){error_handling(e)}}function get_textbox_z(e,_,t,o,s,i,a,n){try{var g=t-s/2,r=t+s/2,l=o+i/2,c=o-i/2,d=a[n].ModuleInfo,m="N",u=0;for(const e of d){if("Y"==m)break;if(void 0===e.ParentModule||null==e.ParentModule){var I=e.ShelfInfo;for(const e of I){if("Y"==m)break;if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType)if(e.ItemInfo.length>0){var O=e.ItemInfo;for(const _ of O){var p=_.X-_.W/2,f=_.X+_.W/2,D=_.Y+_.H/2,E=_.Y-_.H/2;if(g>=p&&g<f&&(l>E&&l<=D||c>=E&&c<D)||r>p&&r<=f&&(l>E&&l<=D||c>=E&&c<D)||g<p&&r>f&&(l>E&&l<=D||c>=E&&c<D)){m="Y",u=a[n].BackDepth/2+e.D+.005;break}if(g>=p&&g&&l>D&&c<E||r>p&&r<=f&&l>D&&c<E){m="Y",u=a[n].BackDepth/2+e.D+.005;break}1}}else{p=e.X-e.W/2,f=e.X+e.W/2,D=e.Y+e.H/2,E=e.Y-e.H/2;if(g>=p&&g<f&&(l>E&&l<=D||c>=E&&c<D)||r>p&&r<=f&&(l>E&&l<=D||c>=E&&c<D)||g<p&&r>f&&(l>E&&l<=D||c>=E&&c<D)){m="Y",u=a[n].BackDepth/2+e.D+.005;break}if(g>=p&&g&&l>D&&c<E||r>p&&r<=f&&l>D&&c<E){m="Y",u=a[n].BackDepth/2+e.D+.005;break}}1}}1}return"N"==m&&a[n].ModuleInfo[e].ShelfInfo[_].Y-a[n].ModuleInfo[e].ShelfInfo[_].H/2<=0?u=a[n].BackDepth/2+.005+a[n].BaseD:"N"==m&&(u=a[n].BackDepth/2+.005),parseFloat(u.toFixed(3))}catch(e){error_handling(e)}}async function set_scene(e,_,t,o,s,i,a,n,g,r,l,c,d,m,u,I,O="N",p="",f,D,E,h){logDebug("function : set_scene; template_id : "+e+"; save_pdf : "+_+"; notch_label : "+t+"; fixel_label : "+o+"; item_label : "+s+"; pdf_lang : "+i+"; save_pog : "+a+"; mime_type : "+n+"; new_item_label : "+g,"S");var P=.5;"Y"==$v("P36_POGCR_ENHANCE_PDF_IMG")&&(P=parseFloat($v("P36_POGCR_PDF_IMG_ENHANCE_RATIO")));var v=$v("P36_POGCR_PDF_CANVAS_SIZE").split(":"),M=g_canvas,b=[];render();var T=JSON.parse(JSON.stringify(g_pog_json)),y="",S=-1,L=0,R=0;for(const e of T[u].ModuleInfo)if(void 0===e.ParentModule||null==e.ParentModule){y=e.Module,L=e.W,R=e.H,S=0;break}if("Y"==(w=f.split("###"))[0]){if("Y"==w[1]){if("N"==m)await recreate_image_items("N",$v("P36_MERCH_STYLE"),$v("P36_POGCR_LOAD_IMG_FROM"),$v("P36_BU_ID"),$v("P36_POGCR_ITEM_NUM_LBL_COLOR"),$v("P36_POGCR_ITEM_NUM_LABEL_POS"),$v("P36_POGCR_DISPLAY_ITEM_INFO"),$v("P36_POGCR_DELIST_ITEM_DFT_COL"),$v("P36_NOTCH_HEAD"),u,"N");bay=(100*L).toFixed(2),(j={Module:"COMBINE"}).Bay=bay,bay="";var x=await M.toDataURL("image/jpeg",.9);j.ImgData=x.match(/,(.*)$/)[1],b.push(j)}if("N"!=typeof w[2]){var j;await showHideItemDescription("Y",$v("P414_ITEM_DFT_COLOR"),$v("P414_POGCR_DISPLAY_ITEM_INFO"),u),bay=(100*L).toFixed(2),(j={Module:"COMBINE"}).Bay=bay,j.TotalBay=(100*R).toFixed(2)+"*"+bay,bay="";x=await M.toDataURL("image/jpeg",.9);j.ImgData=x.match(/,(.*)$/)[1],b.push(j)}}var C=JSON.parse(JSON.stringify(g_pog_json));await get_chest_split_details(g_pogcr_pdf_chest_split,u);var w,G=T[u].ModuleInfo[S],A=(w=get_min_max_xy_module(G,S,G.W,G.H,0,T[u].W,S)).split("###");g_scene_objects[0].scene.children[0].position.z=0;var[N,F]=set_camera_z_offside(g_scene_objects[u].scene.children[0],parseFloat(A[2]),parseFloat(A[3]),parseFloat(A[0]),parseFloat(A[1]),g_offset_z,0,parseFloat(A[5]),!0,u);g_scene_objects[0].scene.children[0].position.y=F-.09,g_scene_objects[0].scene.children[0].position.z=N,g_scene_objects[0].scene.children[0].position.x=parseFloat(A[2]);let $=2*g_canvas.width,H=2*g_canvas.height;M=await get_full_canvas_module($,H,u,1),x=await M.toDataURL("image/jpeg",.5);(Y={Module:"POG"}).ImgData=x.match(/,(.*)$/)[1],b.push(Y);var Y;M=await get_full_canvas_module(parseInt(v[0]),parseInt(v[1]),u,3+(.5==P?0:3*P)),x=await M.toDataURL("image/jpeg",.5);(Y={}).Module=y,Y.ImgData=x.match(/,(.*)$/)[1],b.push(Y);await send_to_db(T[u].POGCode,b);logDebug("function : Download PDF","S"),apex.server.process("DOWNLOAD_PDF",{x01:e.SeqNo,x02:e.POGCode,x03:e.POGVersion,x04:e.Selection_Type,x05:e.Print_Type,x06:e.TemplateId,x07:e.SequenceId,x08:"",x09:e.POGModule,p_clob_01:JSON.stringify(T)},{dataType:"html"}).done((function(e){g_pog_json=C,g_show_fixel_label="Y"==o?"Y":"N",g_show_item_label="Y"==s?"Y":"N",g_show_notch_label="Y"==t?"Y":"N",g_show_item_desc="Y"==c?"Y":"N",console.log("old_live_iamge",d,m);var _="f?p="+$v("pFlowId")+":"+$v("pFlowStepId")+":"+$v("pInstance")+":APPLICATION_PROCESS=OPEN_PDF:NO::AI_RANDOM_STRING:"+(new Date).getTime();removeLoadingIndicator(regionloadWait),logDebug("function : Download PDF","E"),window.open(_,"new data"),async function(){if(console.log("item_desc",c,r,d,m),"N"==c&&"Y"==r)showHideItemDescription("N",$v("P414_ITEM_DFT_COLOR"),$v("P414_POGCR_DISPLAY_ITEM_INFO"),u);else if("Y"==c&&"N"==r)showHideItemDescription("Y",$v("P414_ITEM_DFT_COLOR"),$v("P414_POGCR_DISPLAY_ITEM_INFO"),u);if("N"==d&&"Y"==m)await recreate_image_items("N",$v("P36_MERCH_STYLE"),$v("P36_POGCR_LOAD_IMG_FROM"),$v("P36_BU_ID"),$v("P36_POGCR_ITEM_NUM_LBL_COLOR"),$v("P36_POGCR_ITEM_NUM_LABEL_POS"),$v("P36_POGCR_DISPLAY_ITEM_INFO"),$v("P36_POGCR_DELIST_ITEM_DFT_COL"),$v("P36_NOTCH_HEAD"),u,"N");else if("Y"==d&&"N"==m&&"N"==c)await recreate_image_items("Y",$v("P36_MERCH_STYLE"),$v("P36_POGCR_LOAD_IMG_FROM"),$v("P36_BU_ID"),$v("P36_POGCR_ITEM_NUM_LBL_COLOR"),$v("P36_POGCR_ITEM_NUM_LABEL_POS"),$v("P36_POGCR_DISPLAY_ITEM_INFO"),$v("P36_POGCR_DELIST_ITEM_DFT_COL"),$v("P36_NOTCH_HEAD"),u,"N");show_notch_labels(g_show_notch_label,$v("P36_NOTCH_HEAD"),"Y",u),show_fixel_labels(g_show_fixel_label,u),show_item_labels(g_show_item_label,$v("P36_POGCR_ITEM_NUM_LBL_COLOR"),$v("P36_POGCR_ITEM_NUM_LABEL_POS"),u),reset_zoom(u)}(),"undefined"!=typeof g_renderer_pdf&&null!==g_renderer_pdf&&""!==g_renderer_pdf&&(g_renderer_pdf.forceContextLoss(),g_renderer_pdf.context=null,g_renderer_pdf.domElement=null,g_renderer_pdf=null)})),logDebug("function : set_scene","E")}async function doMouseUp(e,_,t,o,s,i,a,n){logDebug("function : doMouseUp; x : "+e+"; y : "+_+"; prevX : "+o+"; prevY : "+s,"S");try{var g=i.width/window.devicePixelRatio,r=i.height/window.devicePixelRatio,l=2*e/g-1,c=1-2*_/r;if(g_raycaster.setFromCamera(new THREE.Vector2(l,c),g_scene_objects[0].scene.children[0]),g_intersects=g_raycaster.intersectObject(g_targetForDragging),0==g_intersects.length)return;var d=g_intersects[0].point.x,m=g_intersects[0].point.y,u=g_intersects[0].point.z,I=new THREE.Vector3(d,m,u);g_scene_objects[n].scene.children[2].worldToLocal(I);Math.min(19,Math.max(-19,I.x)),Math.min(19,Math.max(-19,I.y)),g_drag_z;if("Y"==g_shelf_edit_flag&&("PEGBOARD"==g_shelf_object_type?g_dragItem.position.z=15e-5:"ROD"==g_shelf_object_type?g_dragItem.position.z=.005:"TEXTBOX"!==g_shelf_object_type&&(g_dragItem.position.z=5e-4)),g_delete_details.length>0?g_multiItemCopy="Y":g_multiItemCopy="N",g_selecting&&void 0!==a&&a.length>0){await get_multiselect_obj(a,n);"Y"==g_area_zoom_ind?(new_camera=get_canvas_camera("MOUSEUP"),new_pogjson=get_canvas_json("MOUSEUP"),select_zoom(g_scene_objects[n].scene.children[0],new_pogjson,n),g_area_zoom_ind="N"):g_selecting=!1,g_selection.style.visibility="hidden"}logDebug("function : doMouseUp","E")}catch(e){error_handling(e)}}function doMouseDown(e,_,t,o,s,i,a,n){logDebug("function : doMouseDown; x : "+e+"; y : "+_+"; startX : "+t+"; startY : "+o+"; context_call : "+a,"S");try{window.devicePixelRatio;var g=$(document).scrollTop(),r=$(".t-Region-body").scrollLeft(),l=document.getElementById("ig_mod_details").offsetWidth+40;g_multiselect="Y",g_global_counter+=1,g_start_coorX=t,g_start_coorY=o,g_taskItemInContext=clickInsideElement(s,"canvasregion"),g_taskItemInContext1=clickInsideElement(s,"canvasregion1"),g_selection.style.visibility="hidden";var c,d={};g_taskItemInContext&&(i=document.getElementById("maincanvas"),void 0!==g_scene_objects[n]?(d=g_scene_objects[n].scene.children[0],c=g_scene_objects[n].scene.children[2]):(d=g_camera,c=g_world));var m=get_canvas_json("LABEL"),u=i.width/window.devicePixelRatio,I=i.height/window.devicePixelRatio,O=2*e/u-1,p=1-2*_/I;if(g_carpark_item_flag="N",g_carpark_edit_flag="N",g_module_edit_flag="N",g_shelf_edit_flag="N",g_item_edit_flag="N",g_module_index=-1,g_shelf_index=-1,g_module_cnt=-1,g_item_index=-1,g_module_width=-1,comp_obj_id=-1,g_module_X="",g_shelf_max_merch="",g_shelf_basket_spread="",render(),d.updateProjectionMatrix(),g_raycaster.setFromCamera(new THREE.Vector2(O,p),d),g_intersects=g_raycaster.intersectObjects(c.children),$s("P36_SELECTED_CANVAS",`${g_curr_canvas}`),0==g_intersects.length){if(c.add(g_targetForDragging),g_targetForDragging.position.set(0,0,0),render(),g_intersects=g_raycaster.intersectObjects(c.children),g_intersects.length>0){var f=g_intersects[0].point.x,D=g_intersects[0].point.y;g_drag_z=g_intersects[0].point.z,g_drag_z+=.001;var E=new THREE.Vector3(f,D,M);c.worldToLocal(E);O=Math.min(19,Math.max(-19,E.x)),_=Math.min(19,Math.max(-19,E.y));if(g_DragMouseStart.x=O,g_DragMouseStart.y=_,g_DragMouseEnd.x=O,g_DragMouseEnd.y=_,g_startMouse.x=s.clientX+r-l,g_startMouse.y=s.clientY+g,g_prevMouse.x=O,g_prevMouse.y=_,g_nextMouse=g_prevMouse.clone(),c.remove(g_targetForDragging),g_intersected=[],g_select_zoom_arr=[],s.shiftKey)return!1;var h=g_startMouse.x,P=g_startMouse.y;return g_selecting=!0,g_selection.style.left=g_startMouse.x+"px",g_selection.style.top=g_startMouse.y+"px",g_selection.style.width=h-g_startMouse.x+"px",g_selection.style.height=P-g_startMouse.y+"px",g_selection.style.visibility="visible",!0}return g_intersected=[],g_select_zoom_arr=[],!1}if(g_intersects.length>0){if("drag_object"==g_intersects[0].object.uuid){var v=g_intersects[1];g_objectHit=v.object;f=g_intersects[1].point.x;g_mousedown_locx=g_intersects[1].point.x;D=g_intersects[1].point.y;var M=g_intersects[1].point.z;g_drag_z=g_intersects[1].point.z}else{v=g_intersects[0];g_objectHit=v.object;f=g_intersects[0].point.x;g_mousedown_locx=g_intersects[0].point.x;D=g_intersects[0].point.y,M=g_intersects[0].point.z;g_drag_z=g_objectHit.position.z}E=new THREE.Vector3(f,D,M);c.worldToLocal(E);O=Math.min(19,Math.max(-19,E.x));var b=g_drag_z;g_drag_z+=.001,g_itemDragZ=g_objectHit.position.z,g_itemDragX=g_objectHit.position.x;_=Math.min(19,Math.max(-19,E.y));if(g_objectHit_uuid=g_objectHit.uuid,g_objectHit_id=g_objectHit.id,console.log("g_objectHit_id",g_objectHit_id,g_objectHit_uuid,O,_,b),get_object_identity(m,n),-1!==g_module_index&&-1!==g_shelf_index&&update_item_distance(g_module_index,g_shelf_index,n),g_drag_x=g_module_X,render(),"Y"==g_module_edit_flag||-1!==g_module_obj_array.indexOf(g_objectHit)||g_objectHit_uuid.match(/BASE.*/)||g_objectHit_uuid.match(/NOTCH.*/)){g_startMouse.x=s.clientX+r-l,g_startMouse.y=s.clientY+g,g_prevMouse.x=O,g_prevMouse.y=_,g_nextMouse=g_prevMouse.clone(),g_DragMouseStart.x=O,g_DragMouseStart.y=_,g_DragMouseEnd.x=O,g_DragMouseEnd.y=_;h=g_startMouse.x+1,P=g_startMouse.y+1;return"N"!=g_context_opened||s.shiftKey||(g_selecting=!0,g_selection.style.left=g_startMouse.x+"px",g_selection.style.top=g_startMouse.y+"px",g_selection.style.width=h-g_startMouse.x+"px",g_selection.style.height=P-g_startMouse.y+"px",g_selection.style.visibility="visible"),!0}return g_dragItem=g_objectHit,console.log("evt.ctrlKey",s.ctrlKey,g_module_edit_flag,g_item_edit_flag,g_ctrl_select,g_mselect_drag,g_multiItemCopy),!1}if(g_intersected){for(var T=0;T<g_intersected.length;T++)g_select_color=g_intersected[T].BorderColour,g_intersected[T].WireframeObj.material.color.setHex(g_intersected[T].BorderColour),"Y"!=g_intersected[T].ImageExists||"Y"!=g_show_live_image&&"Y"!=g_show_live_image_comp||(g_intersected[T].WireframeObj.material.transparent=!0,g_intersected[T].WireframeObj.material.opacity=.0025);clearInterval(g_myVar),g_select_color=0,render(),g_intersected=[],g_select_zoom_arr=[]}logDebug("function : doMouseDown","E")}catch(e){error_handling(e)}}async function get_multiselect_obj(e,_){logDebug("function : get_multiselect_obj","S");try{if(console.log("g multiselect obj",e),g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],void 0!==e&&e.length>0){var t=e[_].ModuleInfo,o=0;for(const f of t){if(null==f.ParentModule||"undefined"==f.ParentModule){var s=0;for(const t of f.ShelfInfo){if(void 0!==t&&"NOTCH"!==t.ObjType&&"BASE"!==t.ObjType&&"DIVIDER"!==t.ObjType){if(0!==t.Rotation||0!==t.Slope)var i=t.X-t.ShelfRotateWidth/2,a=t.X+t.ShelfRotateWidth/2,n=t.Y-t.ShelfRotateHeight/2,g=t.Y+t.ShelfRotateHeight/2;else i=t.X-t.W/2,a=t.X+t.W/2,n=t.Y-t.H/2,g=t.Y+t.H/2;if(g_DragMouseStart.x<g_DragMouseEnd.x&&g_DragMouseStart.y>g_DragMouseEnd.y){if(i>g_DragMouseStart.x&&a>g_DragMouseStart.x&&n<g_DragMouseStart.y&&g<g_DragMouseStart.y&&i<g_DragMouseEnd.x&&a<g_DragMouseEnd.x&&n>g_DragMouseEnd.y&&g>g_DragMouseEnd.y)(u={}).ObjID=t.SObjID,u.MIndex=o,u.SIndex=s,u.ObjWidth=t.W,u.ObjHeight=t.H,u.XAxis=t.X,u.YAxis=t.Y,u.ZAxis=t.Z,u.IIndex=-1,u.ObjType=t.ObjType,u.IsDivider="N",u.Object="SHELF",u.MObjID=f.MObjID,u.SObjID=-1,u.ItemID="",u.Item="",u.Exists="N",u.Rotation=t.Rotation,u.Slope=t.Slope,u.Distance=0,u.TopObjID="",u.BottomObjID="",g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(u)}else if(g_DragMouseStart.x>g_DragMouseEnd.x&&g_DragMouseStart.y>g_DragMouseEnd.y){if(i>g_DragMouseEnd.x&&a>g_DragMouseEnd.x&&n>g_DragMouseEnd.y&&g>g_DragMouseEnd.y&&i<g_DragMouseStart.x&&a<g_DragMouseStart.x&&n<g_DragMouseStart.y&&g<g_DragMouseStart.y)(u={}).ObjID=t.SObjID,u.MIndex=o,u.SIndex=s,u.ObjWidth=t.W,u.ObjHeight=t.H,u.XAxis=t.X,u.YAxis=t.Y,u.ZAxis=t.Z,u.IIndex=-1,u.ObjType=t.ObjType,u.IsDivider="N",u.Object="SHELF",u.MObjID=f.MObjID,u.SObjID=-1,u.ItemID="",u.Item="",u.Exists="N",u.Rotation=t.Rotation,u.Slope=t.Slope,u.Distance=0,u.TopObjID="",u.BottomObjID="",g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(u)}else if(g_DragMouseStart.x<g_DragMouseEnd.x&&g_DragMouseStart.y<g_DragMouseEnd.y){if(i>g_DragMouseStart.x&&a>g_DragMouseStart.x&&n>g_DragMouseStart.y&&g>g_DragMouseStart.y&&i<g_DragMouseEnd.x&&a<g_DragMouseEnd.x&&n<g_DragMouseEnd.y&&g<g_DragMouseEnd.y)(u={}).ObjID=t.SObjID,u.MIndex=o,u.SIndex=s,u.ObjWidth=t.W,u.ObjHeight=t.H,u.XAxis=t.X,u.YAxis=t.Y,u.ZAxis=t.Z,u.IIndex=-1,u.ObjType=t.ObjType,u.IsDivider="N",u.Object="SHELF",u.MObjID=f.MObjID,u.SObjID=-1,u.ItemID="",u.Item="",u.Exists="N",u.Rotation=t.Rotation,u.Slope=t.Slope,u.Distance=0,u.TopObjID="",u.BottomObjID="",g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(u)}else if(g_DragMouseStart.x>g_DragMouseEnd.x&&g_DragMouseStart.y<g_DragMouseEnd.y){if(i<g_DragMouseStart.x&&a<g_DragMouseStart.x&&n>g_DragMouseStart.y&&g>g_DragMouseStart.y&&i>g_DragMouseEnd.x&&a>g_DragMouseEnd.x&&n<g_DragMouseEnd.y&&g<g_DragMouseEnd.y)(u={}).ObjID=t.SObjID,u.MIndex=o,u.SIndex=s,u.ObjWidth=t.W,u.ObjHeight=t.H,u.XAxis=t.X,u.YAxis=t.Y,u.ZAxis=t.Z,u.IIndex=-1,u.ObjType=t.ObjType,u.IsDivider="N",u.Object="SHELF",u.MObjID=f.MObjID,u.SObjID=-1,u.ItemID="",u.Item="",u.Exists="N",u.Rotation=t.Rotation,u.Slope=t.Slope,u.Distance=0,u.TopObjID="",u.BottomObjID="",g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(u)}var r=0;for(const i of t.ItemInfo){var l=i.X-i.W/2,c=i.X+i.W/2,d=i.Y-i.H/2,m=i.Y+i.H/2;if(g_DragMouseStart.x<g_DragMouseEnd.x&&g_DragMouseStart.y>g_DragMouseEnd.y){if(l>g_DragMouseStart.x&&c>g_DragMouseStart.x&&d<g_DragMouseStart.y&&m<g_DragMouseStart.y&&l<g_DragMouseEnd.x&&c<g_DragMouseEnd.x&&d>g_DragMouseEnd.y&&m>g_DragMouseEnd.y){var u={},I="N",O="ITEM";if("DIVIDER"==i.Item&&(I="Y",O="SHELF"),u.ObjID=i.ObjID,u.MIndex=o,u.SIndex=s,u.ObjWidth=i.W,u.ObjHeight=i.H,u.XAxis=i.X,u.YAxis=i.Y,u.ZAxis=i.Z,u.IIndex=r,u.ObjType=t.ObjType,u.IsDivider=I,u.Object=O,u.MObjID=f.MObjID,u.SObjID=t.SObjID,u.ItemID=i.ItemID,u.Item=i.Item,u.W=i.W,u.H=i.H,u.X=i.X,u.Y=i.Y,u.Exists="N",u.Rotation=0,u.Slope=0,u.Distance=i.Distance,u.TopObjID=i.TopObjID,u.BottomObjID=i.BottomObjID,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(u),void 0!==s&&void 0!==o&&g_delete_details.length>0){var p=e[_].ModuleInfo[o].ShelfInfo[s];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(p)}}}else if(g_DragMouseStart.x>g_DragMouseEnd.x&&g_DragMouseStart.y>g_DragMouseEnd.y){if(l>g_DragMouseEnd.x&&c>g_DragMouseEnd.x&&d>g_DragMouseEnd.y&&m>g_DragMouseEnd.y&&l<g_DragMouseStart.x&&c<g_DragMouseStart.x&&d<g_DragMouseStart.y&&m<g_DragMouseStart.y){u={},I="N",O="ITEM";if("DIVIDER"==i.Item&&(I="Y",O="SHELF"),u.ObjID=i.ObjID,u.MIndex=o,u.SIndex=s,u.ObjWidth=i.W,u.ObjHeight=i.H,u.XAxis=i.X,u.YAxis=i.Y,u.ZAxis=i.Z,u.IIndex=r,u.ObjType=t.ObjType,u.IsDivider=I,u.Object=O,u.MObjID=f.MObjID,u.SObjID=t.SObjID,u.ItemID=i.ItemID,u.Item=i.Item,u.W=i.W,u.H=i.H,u.X=i.X,u.Y=i.Y,u.Exists="N",u.Rotation=0,u.Slope=0,u.Distance=i.Distance,u.TopObjID=i.TopObjID,u.BottomObjID=i.BottomObjID,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(u),void 0!==s&&void 0!==o&&g_delete_details.length>0){p=e[_].ModuleInfo[o].ShelfInfo[s];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(p)}}}else if(g_DragMouseStart.x<g_DragMouseEnd.x&&g_DragMouseStart.y<g_DragMouseEnd.y){if(l>g_DragMouseStart.x&&c>g_DragMouseStart.x&&d>g_DragMouseStart.y&&m>g_DragMouseStart.y&&l<g_DragMouseEnd.x&&c<g_DragMouseEnd.x&&d<g_DragMouseEnd.y&&m<g_DragMouseEnd.y){u={},I="N",O="ITEM";if("DIVIDER"==i.Item&&(I="Y",O="SHELF"),u.ObjID=i.ObjID,u.MIndex=o,u.SIndex=s,u.ObjWidth=i.W,u.ObjHeight=i.H,u.XAxis=i.X,u.YAxis=i.Y,u.ZAxis=i.Z,u.IIndex=r,u.ObjType=t.ObjType,u.IsDivider=I,u.Object=O,u.MObjID=f.MObjID,u.SObjID=t.SObjID,u.ItemID=i.ItemID,u.Item=i.Item,u.W=i.W,u.H=i.H,u.X=i.X,u.Y=i.Y,u.Exists="N",u.Rotation=0,u.Slope=0,u.Distance=i.Distance,u.TopObjID=i.TopObjID,u.BottomObjID=i.BottomObjID,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(u),void 0!==s&&void 0!==o&&g_delete_details.length>0){p=e[_].ModuleInfo[o].ShelfInfo[s];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(p)}}}else if(g_DragMouseStart.x>g_DragMouseEnd.x&&g_DragMouseStart.y<g_DragMouseEnd.y&&l<g_DragMouseStart.x&&c<g_DragMouseStart.x&&d>g_DragMouseStart.y&&m>g_DragMouseStart.y&&l>g_DragMouseEnd.x&&c>g_DragMouseEnd.x&&d<g_DragMouseEnd.y&&m<g_DragMouseEnd.y){u={},I="N",O="ITEM";if("DIVIDER"==i.Item&&(I="Y",O="SHELF"),u.ObjID=i.ObjID,u.MIndex=o,u.SIndex=s,u.ObjWidth=i.W,u.ObjHeight=i.H,u.XAxis=i.X,u.YAxis=i.Y,u.ZAxis=i.Z,u.IIndex=r,u.ObjType=t.ObjType,u.IsDivider=I,u.Object=O,u.MObjID=f.MObjID,u.SObjID=t.SObjID,u.ItemID=i.ItemID,u.Item=i.Item,u.W=i.W,u.H=i.H,u.X=i.X,u.Y=i.Y,u.Exists="N",u.Rotation=0,u.Slope=0,u.Distance=i.Distance,u.TopObjID=i.TopObjID,u.BottomObjID=i.BottomObjID,g_delete_details.multi_delete_shelf_ind="",g_delete_details.push(u),void 0!==s&&void 0!==o&&g_delete_details.length>0){p=e[_].ModuleInfo[o].ShelfInfo[s];g_delete_details[g_delete_details.length-1].ShelfInfo=[],g_delete_details[g_delete_details.length-1].ShelfInfo.push(p)}}r++}}s++}}o++}}logDebug("function : get_multiselect_obj","E")}catch(e){error_handling(e)}}function select_zoom(e,_,t){logDebug("function : select_zoom","S");var o=g=r=l=0;try{if(g_cutaway_cam_detail=[],console.log("g_DragMouseStart",g_DragMouseStart,g_DragMouseEnd,g_multiselect),0!==g_DragMouseStart.x&&0!==g_DragMouseEnd.x&&"Y"==g_multiselect){if(g_DragMouseStart.x>g_DragMouseEnd.x?(o=g_DragMouseStart.x-g_DragMouseEnd.x,r=g_DragMouseEnd.x+o/2):(o=g_DragMouseEnd.x-g_DragMouseStart.x,r=g_DragMouseStart.x+o/2),g_DragMouseStart.y>g_DragMouseEnd.y?(g=g_DragMouseStart.y-g_DragMouseEnd.y,l=g_DragMouseEnd.y+g/2):(g=g_DragMouseEnd.y-g_DragMouseStart.y,l=g_DragMouseStart.y+g/2),set_camera_z(g_scene_objects[0].scene.children[0],r,l,o,g,0,r,l,!0,t),g_manual_zoom_ind="Y",(d={}).x=r,d.y=l,d.width=o,d.height=g,d.offset=0,g_cutaway_cam_detail.push(d),g_intersected){for(var s=0;s<g_intersected.length;s++)g_select_color=g_intersected[s].BorderColour,g_intersected[s].WireframeObj.material.color.setHex(g_select_color),"Y"!=g_intersected[s].ImageExists||"Y"!=g_show_live_image&&"Y"!=g_show_live_image_comp||(g_intersected[s].WireframeObj.material.transparent=!0,g_intersected[s].WireframeObj.material.opacity=.0025);clearInterval(g_myVar),g_select_color=0,render()}g_delete_details=[],g_multi_drag_shelf_arr=[],g_multi_drag_item_arr=[],g_multiselect="N",g_intersected=[]}else if(g_select_zoom_arr.length>0){var i=maxx=miny=maxy=-1;for(s=0;s<g_select_zoom_arr.length;s++){var a="N",n="N";$.each(_[t].ModuleInfo,(function(e,o){if("Y"==a)return!1;if(null==o.ParentModule||"undefined"==o.ParentModule){if(o.MObjID==g_select_zoom_arr[s].id)return i=-1==i?o.X-o.W/2:Math.min(i,o.X-o.W/2),-1==miny?miny=o.Y-o.H/2+_[t].BaseH:miny=Math.min(miny,o.Y-o.H/2+_[t].BaseH),maxx=Math.max(maxx,o.X+o.W/2),maxy=Math.max(maxy,o.Y+o.H/2+_[t].BaseH),a="Y",n="Y",!1;$.each(o.ShelfInfo,(function(e,_){if("Y"==a)return!1;if(void 0!==_&&"NOTCH"!==_.ObjType&&"BASE"!==_.ObjType&&"DIVIDER"!==_.ObjType){if(g_shelf.SObjID==g_select_zoom_arr[s].id)return 0!==_.Rotation||0!==_.Slope?(shelf_width=void 0===_.ShelfRotateWidth?_.W:_.ShelfRotateWidth,shelf_height=void 0===_.ShelfRotateHeight?_.W:_.ShelfRotateHeight):(shelf_width=_.W,shelf_height=_.H),i=-1==i?_.X-shelf_width/2:Math.min(i,_.X-shelf_width/2),-1==miny?miny=_.Y-shelf_height/2:miny=Math.min(miny,_.Y-shelf_height/2),maxx=Math.max(maxx,_.X+shelf_width/2),maxy=Math.max(maxy,_.Y+shelf_height/2),a="Y",n="Y",!1;_.ItemInfo.length>0&&$.each(_.ItemInfo,(function(e,t){if(t.ObjID==g_select_zoom_arr[s].id)return 0!==_.Rotation||0!==_.Slope?(item_width=void 0===t.RotationWidth||null==t.RotationWidth||0==t.RotationWidth?t.W:t.RotationWidth,item_height=void 0===t.RotationHeight||null==t.RotationHeight||0==t.RotationHeight?t.H:t.RotationHeight):(item_width=t.W,item_height=t.H),i=-1==i?t.X-item_width/2:Math.min(i,t.X-item_width/2),-1==miny?miny=t.Y-item_height/2:miny=Math.min(miny,t.Y-item_height/2),maxx=Math.max(maxx,t.X+item_width/2),maxy=Math.max(maxy,t.Y+item_height/2),a="Y",n="Y",!1}))}}))}}))}if("Y"==n){if(g_intersected){for(s=0;s<g_intersected.length;s++)g_select_color=g_intersected[s].BorderColour,g_intersected[s].WireframeObj.material.color.setHex(g_select_color),"Y"!=g_intersected[s].ImageExists||"Y"!=g_show_live_image&&"Y"!=g_show_live_image_comp||(g_intersected[s].WireframeObj.material.transparent=!0,g_intersected[s].WireframeObj.material.opacity=.0025);clearInterval(g_myVar),g_select_color=0,render()}o=maxx-i;var g=maxy-miny,r=i+o/2,l=miny+g/2;set_camera_z(g_scene_objects[0].scene.children[0],r,l,o,g,.5,r,l,!0,t),(d={}).x=r,d.y=l,d.width=o,d.height=g,d.offset=.5,g_cutaway_cam_detail.push(d),g_manual_zoom_ind="Y",g_select_zoom_arr=[],render()}}else{if("Y"==g_module_edit_flag){o=_[t].ModuleInfo[g_module_index].W,g=_[t].ModuleInfo[g_module_index].H,r=_[t].ModuleInfo[g_module_index].X,l=_[t].ModuleInfo[g_module_index].Y;var c=g_offset_z}else if("Y"==g_shelf_edit_flag){o=_[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].W,g=_[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].H,r=_[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].X,l=_[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].Y;c=0}else if("Y"==g_item_edit_flag){o=_[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].W,g=_[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].H,r=_[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].X,l=_[t].ModuleInfo[g_module_index].ShelfInfo[g_shelf_index].ItemInfo[g_item_index].Y;c=0}var d;if(o>0)set_camera_z(g_scene_objects[0].scene.children[0],r,l,o,g,c,r,l,!0,t),(d={}).x=r,d.y=l,d.width=o,d.height=g,d.offset=c,g_cutaway_cam_detail.push(d),g_manual_zoom_ind="Y",render()}}catch(e){error_handling(e)}logDebug("function : select_zoom","E")}function get_object_identity(e,_){logDebug("function : get_object_identity","S");try{var t=0;for(const s of e[_].ModuleInfo){if("Y"==g_carpark_edit_flag)break;if(null==s.ParentModule&&void 0!==s.Carpark&&s.Carpark.length>0&&s.Carpark[0].ItemInfo.length>0){var o=0;for(const e of s.Carpark){if(e.SObjID==g_objectHit_id){g_module_index=t,g_shelf_index=o,g_carpark_edit_flag="Y";break}g_carpark_edit_flag="N",o++}}t++}if("N"==g_carpark_edit_flag){t=0;for(const o of e[_].ModuleInfo){if(g_taskItemInContext||"POG"==g_compare_view||"EDIT_PALLET"==g_compare_view){if(o.MObjID==g_objectHit_id&&null==o.ParentModule){g_module_index=t,g_module_cnt=t,g_module_width=o.W,g_module_X=o.X,g_module_edit_flag="Y",comp_obj_id=o.CompMObjID,g_wireframe_id=o.WFrameID,apex.item("P400_MODULE_DISP").setValue(o.Module);break}g_module_edit_flag="N"}else{if(o.CompMObjID==g_objectHit_id&&null==o.ParentModule){g_module_index=t,g_module_cnt=t,g_module_width=o.W,g_module_X=o.X,g_module_edit_flag="Y",comp_obj_id=o.MObjID,g_wireframe_id=o.WFrameID,apex.item("P400_MODULE_DISP").setValue(o.Module);break}g_module_edit_flag="N"}t++}}if("N"==g_module_edit_flag&&"N"==g_carpark_edit_flag){o=0;for(const t of e[_].ModuleInfo){if("Y"==g_shelf_edit_flag)break;null==t.ParentModule&&$.each(t.ShelfInfo,(function(e,_){if("BASE"!==_.ObjType&&"NOTCH"!==_.ObjType&&"DIVIDER"!==_.ObjType)if(g_taskItemInContext||"POG"==g_compare_view||"EDIT_PALLET"==g_compare_view){if(_.SObjID==g_objectHit_id)return g_module_index=o,g_shelf_index=e,g_shelf_max_merch=_.MaxMerch,g_shelf_basket_spread=_.BsktSpreadProduct,g_shelf_edit_flag="Y",g_wireframe_id=_.WFrameID,g_shelf_object_type=_.ObjType,comp_obj_id=_.CompShelfObjID,g_rotation=_.Rotation,_.Slope>0?g_slope=0-_.Slope:_.Slope<0?g_slope=-_.Slope:g_slope=0,!1;g_shelf_edit_flag="N"}else{if(_.CompShelfObjID==g_objectHit_id)return g_module_index=o,g_shelf_index=e,g_shelf_max_merch=_.MaxMerch,g_shelf_edit_flag="Y",g_wireframe_id=_.WFrameID,g_shelf_object_type=_.ObjType,g_shelf_basket_spread=_.BsktSpreadProduct,g_rotation=_.Rotation,comp_obj_id=_.SObjID,_.Slope>0?g_slope=0-_.Slope:_.Slope<0?g_slope=-_.Slope:g_slope=0,!1;g_shelf_edit_flag="N"}})),o++}}if("N"==g_shelf_edit_flag&&"N"==g_module_edit_flag&&"N"==g_carpark_edit_flag){var s=0;for(const i of e[_].ModuleInfo){if("Y"==g_item_edit_flag)break;if(null==i.ParentModule){if(void 0!==i.Carpark&&void 0!==i.Carpark[0]&&i.Carpark.length>0&&i.Carpark[0].ItemInfo.length>0){o=0;for(const e of i.Carpark[0].ItemInfo){if(g_taskItemInContext||"POG"==g_compare_view||"EDIT_PALLET"==g_compare_view){if(e.ObjID==g_objectHit_id){g_module_index=s,g_shelf_index=0,g_item_index=o,g_item_edit_flag="Y",g_shelf_object_type=i.Carpark[0].ObjType,g_wireframe_id=e.WFrameID,comp_obj_id=e.CompItemObjID,g_carpark_item_flag="Y";break}g_item_edit_flag="N"}else{if(e.ObjID==g_objectHit_id){g_module_index=s,g_shelf_index=0,g_item_index=o,g_item_edit_flag="Y",g_shelf_object_type=i.Carpark[0].ObjType,g_wireframe_id=e.WFrameID,comp_obj_id=e.ObjID,g_carpark_item_flag="Y";break}g_item_edit_flag="N"}o++}}t=0;for(const e of i.ShelfInfo){if("BASE"!==e.ObjType&&"NOTCH"!==e.ObjType&&"DIVIDER"!==e.ObjType&&"TEXTBOX"!==e.ObjType){if("Y"==g_item_edit_flag)break;o=0;for(const _ of e.ItemInfo){if(g_taskItemInContext||"POG"==g_compare_view||"EDIT_PALLET"==g_compare_view){if(_.ObjID==g_objectHit_id){g_module_index=s,g_shelf_index=t,g_item_index=o,g_item_edit_flag="Y",g_shelf_object_type=e.ObjType,g_wireframe_id=_.WFrameID,comp_obj_id=_.CompItemObjID;break}g_item_edit_flag="N"}else{if(_.CompItemObjID==g_objectHit_id){g_module_index=s,g_shelf_index=t,g_item_index=o,g_item_edit_flag="Y",comp_obj_id=_.ObjID,g_shelf_object_type=e.ObjType,g_wireframe_id=_.WFrameID;break}g_item_edit_flag="N"}o++}}t++}}s++}}logDebug("function : get_object_identity","E")}catch(e){error_handling(e)}}function onDocumentMouseWheel(e){var _,t,o;if(logDebug("function : onDocumentMouseWheel","S"),g_taskItemInContext=clickInsideElement(e,"canvasregion"),g_taskItemInContext1=clickInsideElement(e,"canvasregion1"),g_taskItemInContext?(_=document.getElementById("maincanvas"),t=g_camera,o="#maincanvas"):(_=document.getElementById("maincanvas1"),t=g_camera_comp,o="#maincanvas1"),e.ctrlKey){g_duplicating="N",e.preventDefault(),e.stopPropagation(),g_manual_zoom_ind="Y";var s=_.getBoundingClientRect(),i=e.clientX-s.left,a=e.clientY-s.top,n=parseFloat($v("P36_POGCR_CAMERA_ZOOM_FACTOR")),g=2*i/(_.width/window.devicePixelRatio)-1,r=1-2*a/(_.height/window.devicePixelRatio),l=new THREE.Vector3(g,r,e.deltaY/500);l.unproject(t),l.sub(t.position),e.deltaY<0?($(o).css("cursor","zoom-in"),t.position.addVectors(t.position,l.setLength(n))):($(o).css("cursor","zoom-out"),t.position.subVectors(t.position,l.setLength(n))),render()}else if("Y"==g_manual_zoom_ind){var c=parseFloat($v("P36_POGCR_WHEEL_UP_DOWN_INTER"));e.deltaY<0?t.position.set(t.position.x,t.position.y+c,t.position.z):e.deltaY>0&&t.position.set(t.position.x,t.position.y-c,t.position.z),render()}logDebug("function : onDocumentMouseWheel","E")}function reset_zoom(e){logDebug("function : reset_zoom","S");try{if("undefined"!=typeof g_pog_json&&g_pog_json.length>0||"undefined"!=typeof g_pog_json_comp&&g_pog_json_comp.length>0){if($(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),$("#maincanvas").css("cursor","auto"),$("#maincanvas1").css("cursor","auto"),g_manual_zoom_ind="N",g_area_zoom_ind="N",g_select_zoom_arr=[],1==g_curr_canvas){var _=get_min_max_xy(g_pog_index).split("###");set_camera_z(g_scene_objects[e].scene.children[0],parseFloat(_[2]),parseFloat(_[3]),parseFloat(_[0]),parseFloat(_[1]),g_offset_z,parseFloat(_[4]),parseFloat(_[5]),!0,e)}if("undefined"!=typeof g_pog_json_comp&&g_pog_json_comp.length>0&&2==g_curr_canvas&&"CUTAWAY"!==g_compare_view){_=get_min_max_xy(g_pog_index).split("###");set_camera_z(g_camera_comp,parseFloat(_[2]),parseFloat(_[3]),parseFloat(_[0]),parseFloat(_[1]),g_offset_z,parseFloat(_[4]),parseFloat(_[5]),!0,e)}else 2==g_curr_canvas&&"CUTAWAY"!==g_compare_view&&set_camera_z(g_camera_comp,g_pog_json[e].CompCamX,g_pog_json[e].CompCamY,g_pog_json[e].CompCamWidth,g_pog_json[e].CompCamHeight,g_offset_z,g_pog_json[e].CompCamWidth,g_pog_json[e].CompCamHeight,!0,e);render(),g_intersected=[]}logDebug("function : reset_zoom","E")}catch(e){error_handling(e)}}function area_zoom(){logDebug("function : area_zoom","S"),"N"==g_area_zoom_ind?($(".top_icon").removeClass("active"),$(".left_icon").removeClass("active"),$(".area_zoom").addClass("active"),g_area_zoom_ind="Y",g_select_zoom_arr=[]):($(".area_zoom").removeClass("active"),g_area_zoom_ind="N"),logDebug("function : area_zoom","E")}function open_module(e){var _;if($s("P36_POG_MODULE",e),l_selected_mod!==e){l_selected_mod=e;var t=apex.region("ig_mod_details").widget().interactiveGrid("getViews","grid").model;t.forEach((function(e){t.getValue(e,"POG_MODULE")!==l_selected_mod?$('#ig_mod_details [data-id="'+t.getValue(e,"POG_MODULE")+'"] .pdfViewLink').addClass("nolink"):_=e})),g_pog_index=0,init(),g_scene_objects=[],objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects),apex.region("ig_mod_details").widget().interactiveGrid("getCurrentView").view$.grid("setSelectedRecords",[_],!0);var o="",s=-1,i=[],a=-1;if(""!==e){if(g_pog_json_data.length>0){$.each(g_pog_json_data[g_pog_index].ModuleInfo,(function(_,t){null==t.ParentModule&&t.Module==e&&(a=_,i.push(t),s=t.W)}));var n=0;$.each(g_pog_json_data[g_pog_index].ModuleInfo,(function(e,_){null==_.ParentModule&&e<a&&(n+=_.W)}))}console.log("if ",s,a),g_pog_json[g_pog_index].ModuleInfo=i,g_pog_json[g_pog_index].W=s,g_pog_json[g_pog_index].BaseW=s,g_pog_json[g_pog_index].TotalModWidth=n}o=void 0===e||""==e?"N":"Y";var g=JSON.parse(JSON.stringify(g_pog_json));module_obj_array=[],async function(){addLoadingIndicator(),g_pog_json=[],await create_module_from_json(g,"N",l_pog_type,"N","E","Y","N","Y","Y",o,a,g_pog_index);var e=apex.region("ig_mod_details").widget().interactiveGrid("getViews","grid").model;e.forEach((function(_){e.getValue(_,"POG_MODULE")==l_selected_mod&&$('#ig_mod_details [data-id="'+e.getValue(_,"POG_MODULE")+'"] .pdfViewLink').removeClass("nolink")}))}(),dblclick_opened="N"}}function get_pog_layout(){apex.server.process("GET_JSON_FROM_COLL",{x01:$v("P36_POG_CODE"),x02:$v("P36_POG_VERSION")},{dataType:"html"}).done((function(e){try{g_pog_json_data=JSON.parse($.trim(e))}catch{return apex.message.clearErrors(),apex.message.showErrors([{type:"error",location:"page",message:$.trim(e)}]),void $("#LIVE_IMAGE").css("display","none")}g_pog_index=0,init(),objects={},objects.scene=g_scene,objects.renderer=g_renderer,g_scene_objects.push(objects),g_pog_json=JSON.parse(JSON.stringify(g_pog_json_data));var _,t="",o=-1,s=[],i=-1,a=apex.region("ig_mod_details").widget().interactiveGrid("getViews","grid").model,n=!0;if(""!==$v("P36_POG_MODULE")&&(l_selected_mod=$v("P36_POG_MODULE")),console.log("l_selected_mod",l_selected_mod,""!==l_selected_mod),""==l_selected_mod||null==l_selected_mod?a.forEach((function(e){console.log("inside ",a.getValue(e,"CHANGED_IND").v,n,a.getValue(e,"POG_MODULE")),n&&(t=a.getValue(e,"POG_MODULE"),_=e,l_selected_mod=t,n=!1),console.log("aftr ",t,l_selected_mod,_)})):(a.forEach((function(e){a.getValue(e,"POG_MODULE")==l_selected_mod&&(_=e)})),t=l_selected_mod),$s("P36_POG_MODULE",l_selected_mod),console.log("moduleName 1",t,l_selected_mod,g_pog_json_data),""!==t){if(apex.region("ig_mod_details").widget().interactiveGrid("getCurrentView").view$.grid("setSelectedRecords",[_],!0),g_pog_json_data.length>0){$.each(g_pog_json[g_pog_index].ModuleInfo,(function(e,_){console.log("loop",_.Module,_.ParentModule,t),null==_.ParentModule&&_.Module==t&&(console.log("got "),i=e,s.push(_),o=_.W)})),console.log("backup",s,o,i);var g=0;$.each(g_pog_json[g_pog_index].ModuleInfo,(function(e,_){null==_.ParentModule&&e<i&&(g+=_.W)}))}g_pog_json[g_pog_index].ModuleInfo=s,g_pog_json[g_pog_index].W=o,g_pog_json[g_pog_index].TotalModWidth=g,console.log("ModuleInfo",g_pog_json[g_pog_index].ModuleInfo)}t=void 0===t||""==t?"N":"Y",module_obj_array=[],async function(){addLoadingIndicator();var e=JSON.parse(JSON.stringify(g_pog_json));g_pog_json=[],l_pog_type=e[0].DesignType,await create_module_from_json(e,"N",l_pog_type,"N","E","Y","N","Y","Y",t,i,g_pog_index),a.forEach((function(e){console.log("l_selected_modloop",l_selected_mod),a.getValue(e,"POG_MODULE")!==l_selected_mod?$('#ig_mod_details [data-id="'+a.getValue(e,"POG_MODULE")+'"] .pdfViewLink').addClass("nolink"):$('#ig_mod_details [data-id="'+a.getValue(e,"POG_MODULE")+'"] .pdfViewLink').removeClass("nolink")}))}(),dblclick_opened="N",removeParam("")}))}async function create_pdf_func(){if(""==$v("P36_DEFAULT_TEMPLATE"))alert("Default PDF template not available");else{addLoadingIndicator(),await clear_mod_collection();var e={SeqNo:"",POGCode:$v("P36_POG_CODE"),POGVersion:$v("P36_POG_VERSION"),POGModule:l_selected_mod,Selection_Type:"E",Print_Type:"P",SequenceId:"",TemplateId:$v("P36_DEFAULT_TEMPLATE").split("-")[0],TemplateDetails:$v("P36_DEFAULT_TEMPLATE")};await create_pdf(e,"N","N",g_pog_json,"E",$v("P36_POGCR_ITEM_NUM_LBL_COLOR"),$v("P36_POGCR_ITEM_NUM_LABEL_POS"),$v("P36_POGCR_DISPLAY_ITEM_INFO"),$v("P36_NOTCH_HEAD"),"N",g_pog_index,"N","N",$v("P36_MERCH_STYLE"),$v("P36_POGCR_LOAD_IMG_FROM"),$v("P36_BU_ID"),$v("P36_POGCR_ITEM_NUM_LBL_COLOR"),$v("P36_POGCR_ITEM_NUM_LABEL_POS"),$v("P36_POGCR_DISPLAY_ITEM_INFO"),$v("P36_POGCR_DELIST_ITEM_DFT_COL"),$v("P36_NOTCH_HEAD"),"",g_hide_show_dos_label,"",$v("P36_POGCR_ENHANCE_PDF_IMG"),$v("P36_POGCR_PDF_IMG_ENHANCE_RATIO"),$v("P36_POGCR_PDF_CANVAS_SIZE"),$v("P36_VDATE"),$v("P36_POG_POG_DEFAULT_COLOR"),$v("P36_POG_MODULE_DEFAULT_COLOR"),$v("P36_POGCR_DFT_SPREAD_PRODUCT"),$v("P36_PEGB_DFT_HORIZ_SPACING"),$v("P36_PEGBOARD_DFT_VERT_SPACING"),$v("P36_BASKET_DFT_WALL_THICKNESS"),$v("P36_CHEST_DFT_WALL_THICKNESS"),$v("P36_POGCR_PEGB_MAX_ARRANGE"),$v("P36_POGCR_DEFAULT_WRAP_TEXT"),$v("P36_POGCR_TEXT_DEFAULT_SIZE"),$v("P36_POG_TEXTBOX_DEFAULT_COLOR"),$v("P36_POG_SHELF_DEFAULT_COLOR"),$v("P36_DIV_COLOR"),$v("P36_SLOT_DIVIDER"),$v("P36_SLOT_ORIENTATION"),$v("P36_DIVIDER_FIXED"),$v("P36_POG_ITEM_DEFAULT_COLOR"),$v("P36_POGCR_DFT_BASKET_FILL"),$v("P36_POGCR_DFT_BASKET_SPREAD"),$v("P36_POGCR_BAY_LIVE_IMAGE"),$v("P36_POGCR_BAY_WITHOUT_LIVE_IMAGE"),"P")}}function clear_mod_collection(){try{return new Promise((function(e,_){apex.server.process("DELETE_MOD_IMG_COLL",{x01:""},{dataType:"html"}).done((function(_){-1==$.trim(_).indexOf("ERROR")?e("SUCCESS"):e($.trim(_))}))}))}catch(e){error_handling(e)}}async function get_full_canvas_module(e,_,t,o){try{var s=document.createElement("canvas");s.width=e*o,s.height=_*o,g_camera=g_scene_objects[t].scene.children[0],g_scene_objects[t].scene.children[0].aspect=s.width/s.height,g_scene_objects[t].scene.children[0].updateProjectionMatrix();var i=get_min_max_xy(t).split("###");set_camera_z(g_camera,parseFloat(i[2]),parseFloat(i[3]),parseFloat(i[0]),parseFloat(i[1]),g_offset_z,parseFloat(i[4]),parseFloat(i[5]),!0,t);var a=s.getContext("2d");a.imageSmoothingEnabled=!0;try{var n="undefined"!=typeof g_start_pixel_ratio&&g_start_pixel_ratio?g_start_pixel_ratio:window.devicePixelRatio||1,g=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0,alpha:!1});try{g.setPixelRatio(n),"function"==typeof g.setClearColor&&g.setClearColor(16777215,1),g.setSize(s.width,s.height,!1),g_scene_objects[t].scene.children[0].aspect=s.width/s.height,g_scene_objects[t].scene.children[0].updateProjectionMatrix(),g.render(g_scene_objects[t].scene,g_scene_objects[t].scene.children[0]);try{a.fillStyle="#ffffff",a.fillRect(0,0,s.width,s.height)}catch(e){}a.drawImage(g.domElement,0,0,s.width,s.height)}finally{try{"function"==typeof g.forceContextLoss&&g.forceContextLoss()}catch(e){}try{"function"==typeof g.dispose&&g.dispose()}catch(e){}g.context=null,g.domElement=null,g=null}try{g_scene_objects[t]&&g_canvas_objects[t]&&(g_scene_objects[t].scene.children[0].aspect=g_canvas_objects[t].width/g_canvas_objects[t].height,g_scene_objects[t].scene.children[0].updateProjectionMatrix())}catch(e){console.warn("Failed to restore camera aspect:",e)}}catch(e){console.warn("Offscreen capture failed, falling back to global renderer",e);try{var r=g_renderer&&"function"==typeof g_renderer.getPixelRatio?g_renderer.getPixelRatio():window.devicePixelRatio||1,l={w:null,h:null};if(g_renderer&&"function"==typeof g_renderer.getSize){var c=new THREE.Vector2;g_renderer.getSize(c),l.w=c.x,l.h=c.y}g_renderer&&"function"==typeof g_renderer.setPixelRatio&&g_renderer.setPixelRatio(n),g_renderer&&"function"==typeof g_renderer.setSize&&g_renderer.setSize(s.width,s.height,!1),g_renderer.render(g_scene_objects[t].scene,g_scene_objects[t].scene.children[0]);try{a.fillStyle="#ffffff",a.fillRect(0,0,s.width,s.height)}catch(e){}a.drawImage(g_renderer.domElement,0,0,s.width,s.height),g_renderer&&"function"==typeof g_renderer.setPixelRatio&&g_renderer.setPixelRatio(r),g_renderer&&"function"==typeof g_renderer.setSize&&l.w&&l.h&&g_renderer.setSize(l.w,l.h,!1)}catch(e){console.warn("Fallback capture also failed",e)}}return s}catch(e){throw error_handling(e),e}}function fetchPrevVersion(){try{$("#COMPARE_VIEW_BTN").addClass("display_none"),apex.server.process("GET_PREVIOUS_VERSION",{x01:$v("P36_POG_CODE"),x02:$v("P36_POG_VERSION"),x03:$v("P36_STORE"),x04:$v("P36_POG_MODULE")},{dataType:"text",success:function(e){-1==$.trim(e).indexOf("ERROR")?($s("P36_POG_PREV_VERSION",e),"Y"==$v("P36_PORTAL_COMPARE_BUTTON")&&""!=$v("P36_POG_PREV_VERSION")&&$("#COMPARE_VIEW_BTN").removeClass("display_none")):raise_error($.trim(e))}})}catch(e){error_handling(e)}}g_item_vertical_text_display=$v("P36_ITEM_CODE_VERT_ALN"),g_item_text_center_align=$v("P36_ITEM_CODE_CTR_ALN"),$(document).keydown((function(e){get_canvas_world("LABEL");var _=get_canvas_json("LABEL"),t=get_canvas_camera("LABEL");e.keyCode;38==e.keyCode&&1==e.ctrlKey&&void 0!==_&&_.length>0?($("#maincanvas").css("cursor","zoom-in"),t.position.set(t.position.x,t.position.y,t.position.z-parseFloat($v("P36_POGCR_CAMERA_ZOOM_FACTOR"))),g_manual_zoom_ind="Y",render()):40==e.keyCode&&1==e.ctrlKey&&void 0!==_&&_.length>0&&($("#maincanvas").css("cursor","zoom-out"),t.position.set(t.position.x,t.position.y,t.position.z+parseFloat($v("P36_POGCR_CAMERA_ZOOM_FACTOR"))),g_manual_zoom_ind="Y",render()),g_renderer.domElement.addEventListener("mousewheel",onDocumentMouseWheel,!1)}));