var routes;let graph;var drawOptions={mapSelector:"#map",className:"route-path",smoothing:5,lineColor:"rgb(242,0,0)",lineWidth:"2",speed:3};function drawPath(t,n){void 0===n&&(n=drawOptions),removePath(n.className);var e=document.querySelector(n.mapSelector);if(null!==e){var o=createPath();o.setAttribute("class",n.className),o.setAttribute("fill","none"),o.setAttribute("stroke",n.lineColor),o.setAttribute("stroke-width",n.lineWidth),o.setAttribute("d",getD(t,n.smoothing)),e.after(o),setStyle(o,getPathDistance(t)/100/n.speed)}}function removePath(t){document.querySelectorAll(".".concat(t)).forEach((function(t){return t.remove()}))}function getPathDistance(t){var n=t[0];return t[t.length-1].distance-n.distance}function getD(t,n){var e="M ".concat(t[0].x,",").concat(t[0].y);return t.forEach((function(o,a){if(a>0&&a<t.length-1){var r=getLinePoint(t[a],t[a-1],n),i=getLinePoint(t[a],t[a+1],n);e+=" L".concat(r.x,",").concat(r.y),e+=" Q".concat(o.x,",").concat(o.y),e+=" ".concat(i.x,",").concat(i.y)}else e+=" L".concat(o.x,",").concat(o.y)})),e}function getLinePoint(t,n,e){var o=n.x-t.x,a=n.y-t.y,r=Math.abs(t.distance-n.distance),i=Math.min(e,r/2)/r;return{x:t.x+o*i,y:t.y+a*i}}function setStyle(t,n){var e=t.getTotalLength(),o="stroke-dashoffset ".concat(n,"s ease-in-out 0.4s");t.style.strokeDasharray="".concat(e," ").concat(e),t.style.strokeDashoffset=e.toString(),t.getBoundingClientRect(),t.style.transition=o,t.style.strokeDashoffset="0"}function createPath(){return document.createElementNS("http://www.w3.org/2000/svg","path")}function isLine(t){return"line"===t.tagName}function getGraph(t,n,e){return void 0===n&&(n=[]),void 0===e&&(e=drawOptions),Array.from(t.children).forEach((function(t){isLine(t)?handleLine(t,n,e):console.error("Invalid element in routes: ".concat(t.tagName))})),n}function getPath(t,n,e){var o="point",a=filterPointsByLocationId(t,n,o),r=filterPointsByLocationId(t,e,o);return a.length&&r.length?(clearPath(t),a.forEach((function(t){return t.distance=0})),setPathPoints(t),getPathPoints(r)):[]}function handleLine(t,n,e){var o=t.id,a=addPoint(t.x1.baseVal.value,t.y1.baseVal.value,o,n),r=addPoint(t.x2.baseVal.value,t.y2.baseVal.value,o,n),i=getDistance(a,r);linkPoint(a,r,i),linkPoint(r,a,i)}function addPoint(t,n,e,o){var a=findPoint(o,t,n);if(a)return a;var r={x:t,y:n,id:e,distance:Number.POSITIVE_INFINITY,previous:void 0,links:[]};return o.push(r),r}function getDistance(t,n){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}function findPoint(t,n,e){return t.find((function(t){return t.x===n&&t.y===e}))}function linkPoint(t,n,e){findPoint(t.links.map((function(t){return t.to})),n.x,n.y)||t.links.push({to:n,distance:e})}function filterPointsByLocationId(t,n,e){console.log(t,"points"),console.log(n,"id"),console.log(e,"prefix");var o=t.filter((function(t){return t.id==="".concat(e,"-").concat(n)}));return console.log(o,"pointsById"),o.length?o:(console.error("There is no route to location: ".concat(n)),[])}function clearPath(t){for(var n=0,e=t;n<e.length;n++){var o=e[n];o.previous=void 0,o.distance=Number.POSITIVE_INFINITY}}function setPathPoints(t){for(var n=t;n.length>0;){for(var e=0,o=Number.POSITIVE_INFINITY,a=0;a<n.length;a++)n[a].distance<o&&(e=a,o=n[a].distance);var r=n[e];n.splice(e,1);for(var i=0,c=r.links;i<c.length;i++){var s=c[i],l=r.distance+s.distance;l<s.to.distance&&(s.to.distance=l,s.to.previous=r)}}}function getPathPoints(t){for(var n=[],e=null,o=Number.POSITIVE_INFINITY,a=0,r=t;a<r.length;a++){var i=r[a];i.distance<o&&(o=(e=i).distance)}if(!e)return[];for(n.push(e);void 0!==e.previous;)e=e.previous,n.unshift(e);return n}function findPathAndDraw(t,n){console.log(n,"routeTo"),routes=document.getElementById("routes"),console.log(routes,"routes"),graph=getGraph(routes);const e=getPath(graph,t,n);console.log(e,"path"),drawPath(e)}